!(function (a, b) {
  a(function () {
    "use strict";
    function a(a, b) {
      return null != a && null != b && a.toLowerCase() === b.toLowerCase();
    }
    function c(a, b) {
      var c,
        d,
        e = a.length;
      if (!e || !b) return !1;
      for (c = b.toLowerCase(), d = 0; d < e; ++d) if (c === a[d].toLowerCase()) return !0;
      return !1;
    }
    function d(a) {
      for (var b in a) i.call(a, b) && (a[b] = new RegExp(a[b], "i"));
    }
    function e(a) {
      return (a || "").substr(0, 500);
    }
    function f(a, b) {
      (this.ua = e(a)), (this._cache = {}), (this.maxPhoneWidth = b || 600);
    }
    var g = {};
    (g.mobileDetectRules = {
      phones: {
        iPhone: "\\biPhone\\b|\\biPod\\b",
        BlackBerry:
          "BlackBerry|\\bBB10\\b|rim[0-9]+|\\b(BBA100|BBB100|BBD100|BBE100|BBF100|STH100)\\b-[0-9]+",
        Pixel: "; \\bPixel\\b",
        HTC: "HTC|HTC.*(Sensation|Evo|Vision|Explorer|6800|8100|8900|A7272|S510e|C110e|Legend|Desire|T8282)|APX515CKT|Qtek9090|APA9292KT|HD_mini|Sensation.*Z710e|PG86100|Z715e|Desire.*(A8181|HD)|ADR6200|ADR6400L|ADR6425|001HT|Inspire 4G|Android.*\\bEVO\\b|T-Mobile G1|Z520m|Android [0-9.]+; Pixel",
        Nexus:
          "Nexus One|Nexus S|Galaxy.*Nexus|Android.*Nexus.*Mobile|Nexus 4|Nexus 5|Nexus 5X|Nexus 6",
        Dell: "Dell[;]? (Streak|Aero|Venue|Venue Pro|Flash|Smoke|Mini 3iX)|XCD28|XCD35|\\b001DL\\b|\\b101DL\\b|\\bGS01\\b",
        Motorola:
          "Motorola|DROIDX|DROID BIONIC|\\bDroid\\b.*Build|Android.*Xoom|HRI39|MOT-|A1260|A1680|A555|A853|A855|A953|A955|A956|Motorola.*ELECTRIFY|Motorola.*i1|i867|i940|MB200|MB300|MB501|MB502|MB508|MB511|MB520|MB525|MB526|MB611|MB612|MB632|MB810|MB855|MB860|MB861|MB865|MB870|ME501|ME502|ME511|ME525|ME600|ME632|ME722|ME811|ME860|ME863|ME865|MT620|MT710|MT716|MT720|MT810|MT870|MT917|Motorola.*TITANIUM|WX435|WX445|XT300|XT301|XT311|XT316|XT317|XT319|XT320|XT390|XT502|XT530|XT531|XT532|XT535|XT603|XT610|XT611|XT615|XT681|XT701|XT702|XT711|XT720|XT800|XT806|XT860|XT862|XT875|XT882|XT883|XT894|XT901|XT907|XT909|XT910|XT912|XT928|XT926|XT915|XT919|XT925|XT1021|\\bMoto E\\b|XT1068|XT1092|XT1052",
        Samsung:
          "\\bSamsung\\b|SM-G950F|SM-G955F|SM-G9250|GT-19300|SGH-I337|BGT-S5230|GT-B2100|GT-B2700|GT-B2710|GT-B3210|GT-B3310|GT-B3410|GT-B3730|GT-B3740|GT-B5510|GT-B5512|GT-B5722|GT-B6520|GT-B7300|GT-B7320|GT-B7330|GT-B7350|GT-B7510|GT-B7722|GT-B7800|GT-C3010|GT-C3011|GT-C3060|GT-C3200|GT-C3212|GT-C3212I|GT-C3262|GT-C3222|GT-C3300|GT-C3300K|GT-C3303|GT-C3303K|GT-C3310|GT-C3322|GT-C3330|GT-C3350|GT-C3500|GT-C3510|GT-C3530|GT-C3630|GT-C3780|GT-C5010|GT-C5212|GT-C6620|GT-C6625|GT-C6712|GT-E1050|GT-E1070|GT-E1075|GT-E1080|GT-E1081|GT-E1085|GT-E1087|GT-E1100|GT-E1107|GT-E1110|GT-E1120|GT-E1125|GT-E1130|GT-E1160|GT-E1170|GT-E1175|GT-E1180|GT-E1182|GT-E1200|GT-E1210|GT-E1225|GT-E1230|GT-E1390|GT-E2100|GT-E2120|GT-E2121|GT-E2152|GT-E2220|GT-E2222|GT-E2230|GT-E2232|GT-E2250|GT-E2370|GT-E2550|GT-E2652|GT-E3210|GT-E3213|GT-I5500|GT-I5503|GT-I5700|GT-I5800|GT-I5801|GT-I6410|GT-I6420|GT-I7110|GT-I7410|GT-I7500|GT-I8000|GT-I8150|GT-I8160|GT-I8190|GT-I8320|GT-I8330|GT-I8350|GT-I8530|GT-I8700|GT-I8703|GT-I8910|GT-I9000|GT-I9001|GT-I9003|GT-I9010|GT-I9020|GT-I9023|GT-I9070|GT-I9082|GT-I9100|GT-I9103|GT-I9220|GT-I9250|GT-I9300|GT-I9305|GT-I9500|GT-I9505|GT-M3510|GT-M5650|GT-M7500|GT-M7600|GT-M7603|GT-M8800|GT-M8910|GT-N7000|GT-S3110|GT-S3310|GT-S3350|GT-S3353|GT-S3370|GT-S3650|GT-S3653|GT-S3770|GT-S3850|GT-S5210|GT-S5220|GT-S5229|GT-S5230|GT-S5233|GT-S5250|GT-S5253|GT-S5260|GT-S5263|GT-S5270|GT-S5300|GT-S5330|GT-S5350|GT-S5360|GT-S5363|GT-S5369|GT-S5380|GT-S5380D|GT-S5560|GT-S5570|GT-S5600|GT-S5603|GT-S5610|GT-S5620|GT-S5660|GT-S5670|GT-S5690|GT-S5750|GT-S5780|GT-S5830|GT-S5839|GT-S6102|GT-S6500|GT-S7070|GT-S7200|GT-S7220|GT-S7230|GT-S7233|GT-S7250|GT-S7500|GT-S7530|GT-S7550|GT-S7562|GT-S7710|GT-S8000|GT-S8003|GT-S8500|GT-S8530|GT-S8600|SCH-A310|SCH-A530|SCH-A570|SCH-A610|SCH-A630|SCH-A650|SCH-A790|SCH-A795|SCH-A850|SCH-A870|SCH-A890|SCH-A930|SCH-A950|SCH-A970|SCH-A990|SCH-I100|SCH-I110|SCH-I400|SCH-I405|SCH-I500|SCH-I510|SCH-I515|SCH-I600|SCH-I730|SCH-I760|SCH-I770|SCH-I830|SCH-I910|SCH-I920|SCH-I959|SCH-LC11|SCH-N150|SCH-N300|SCH-R100|SCH-R300|SCH-R351|SCH-R400|SCH-R410|SCH-T300|SCH-U310|SCH-U320|SCH-U350|SCH-U360|SCH-U365|SCH-U370|SCH-U380|SCH-U410|SCH-U430|SCH-U450|SCH-U460|SCH-U470|SCH-U490|SCH-U540|SCH-U550|SCH-U620|SCH-U640|SCH-U650|SCH-U660|SCH-U700|SCH-U740|SCH-U750|SCH-U810|SCH-U820|SCH-U900|SCH-U940|SCH-U960|SCS-26UC|SGH-A107|SGH-A117|SGH-A127|SGH-A137|SGH-A157|SGH-A167|SGH-A177|SGH-A187|SGH-A197|SGH-A227|SGH-A237|SGH-A257|SGH-A437|SGH-A517|SGH-A597|SGH-A637|SGH-A657|SGH-A667|SGH-A687|SGH-A697|SGH-A707|SGH-A717|SGH-A727|SGH-A737|SGH-A747|SGH-A767|SGH-A777|SGH-A797|SGH-A817|SGH-A827|SGH-A837|SGH-A847|SGH-A867|SGH-A877|SGH-A887|SGH-A897|SGH-A927|SGH-B100|SGH-B130|SGH-B200|SGH-B220|SGH-C100|SGH-C110|SGH-C120|SGH-C130|SGH-C140|SGH-C160|SGH-C170|SGH-C180|SGH-C200|SGH-C207|SGH-C210|SGH-C225|SGH-C230|SGH-C417|SGH-C450|SGH-D307|SGH-D347|SGH-D357|SGH-D407|SGH-D415|SGH-D780|SGH-D807|SGH-D980|SGH-E105|SGH-E200|SGH-E315|SGH-E316|SGH-E317|SGH-E335|SGH-E590|SGH-E635|SGH-E715|SGH-E890|SGH-F300|SGH-F480|SGH-I200|SGH-I300|SGH-I320|SGH-I550|SGH-I577|SGH-I600|SGH-I607|SGH-I617|SGH-I627|SGH-I637|SGH-I677|SGH-I700|SGH-I717|SGH-I727|SGH-i747M|SGH-I777|SGH-I780|SGH-I827|SGH-I847|SGH-I857|SGH-I896|SGH-I897|SGH-I900|SGH-I907|SGH-I917|SGH-I927|SGH-I937|SGH-I997|SGH-J150|SGH-J200|SGH-L170|SGH-L700|SGH-M110|SGH-M150|SGH-M200|SGH-N105|SGH-N500|SGH-N600|SGH-N620|SGH-N625|SGH-N700|SGH-N710|SGH-P107|SGH-P207|SGH-P300|SGH-P310|SGH-P520|SGH-P735|SGH-P777|SGH-Q105|SGH-R210|SGH-R220|SGH-R225|SGH-S105|SGH-S307|SGH-T109|SGH-T119|SGH-T139|SGH-T209|SGH-T219|SGH-T229|SGH-T239|SGH-T249|SGH-T259|SGH-T309|SGH-T319|SGH-T329|SGH-T339|SGH-T349|SGH-T359|SGH-T369|SGH-T379|SGH-T409|SGH-T429|SGH-T439|SGH-T459|SGH-T469|SGH-T479|SGH-T499|SGH-T509|SGH-T519|SGH-T539|SGH-T559|SGH-T589|SGH-T609|SGH-T619|SGH-T629|SGH-T639|SGH-T659|SGH-T669|SGH-T679|SGH-T709|SGH-T719|SGH-T729|SGH-T739|SGH-T746|SGH-T749|SGH-T759|SGH-T769|SGH-T809|SGH-T819|SGH-T839|SGH-T919|SGH-T929|SGH-T939|SGH-T959|SGH-T989|SGH-U100|SGH-U200|SGH-U800|SGH-V205|SGH-V206|SGH-X100|SGH-X105|SGH-X120|SGH-X140|SGH-X426|SGH-X427|SGH-X475|SGH-X495|SGH-X497|SGH-X507|SGH-X600|SGH-X610|SGH-X620|SGH-X630|SGH-X700|SGH-X820|SGH-X890|SGH-Z130|SGH-Z150|SGH-Z170|SGH-ZX10|SGH-ZX20|SHW-M110|SPH-A120|SPH-A400|SPH-A420|SPH-A460|SPH-A500|SPH-A560|SPH-A600|SPH-A620|SPH-A660|SPH-A700|SPH-A740|SPH-A760|SPH-A790|SPH-A800|SPH-A820|SPH-A840|SPH-A880|SPH-A900|SPH-A940|SPH-A960|SPH-D600|SPH-D700|SPH-D710|SPH-D720|SPH-I300|SPH-I325|SPH-I330|SPH-I350|SPH-I500|SPH-I600|SPH-I700|SPH-L700|SPH-M100|SPH-M220|SPH-M240|SPH-M300|SPH-M305|SPH-M320|SPH-M330|SPH-M350|SPH-M360|SPH-M370|SPH-M380|SPH-M510|SPH-M540|SPH-M550|SPH-M560|SPH-M570|SPH-M580|SPH-M610|SPH-M620|SPH-M630|SPH-M800|SPH-M810|SPH-M850|SPH-M900|SPH-M910|SPH-M920|SPH-M930|SPH-N100|SPH-N200|SPH-N240|SPH-N300|SPH-N400|SPH-Z400|SWC-E100|SCH-i909|GT-N7100|GT-N7105|SCH-I535|SM-N900A|SGH-I317|SGH-T999L|GT-S5360B|GT-I8262|GT-S6802|GT-S6312|GT-S6310|GT-S5312|GT-S5310|GT-I9105|GT-I8510|GT-S6790N|SM-G7105|SM-N9005|GT-S5301|GT-I9295|GT-I9195|SM-C101|GT-S7392|GT-S7560|GT-B7610|GT-I5510|GT-S7582|GT-S7530E|GT-I8750|SM-G9006V|SM-G9008V|SM-G9009D|SM-G900A|SM-G900D|SM-G900F|SM-G900H|SM-G900I|SM-G900J|SM-G900K|SM-G900L|SM-G900M|SM-G900P|SM-G900R4|SM-G900S|SM-G900T|SM-G900V|SM-G900W8|SHV-E160K|SCH-P709|SCH-P729|SM-T2558|GT-I9205|SM-G9350|SM-J120F|SM-G920F|SM-G920V|SM-G930F|SM-N910C|SM-A310F|GT-I9190|SM-J500FN|SM-G903F|SM-J330F|SM-G610F|SM-G981B|SM-G892A|SM-A530F",
        LG: "\\bLG\\b;|LG[- ]?(C800|C900|E400|E610|E900|E-900|F160|F180K|F180L|F180S|730|855|L160|LS740|LS840|LS970|LU6200|MS690|MS695|MS770|MS840|MS870|MS910|P500|P700|P705|VM696|AS680|AS695|AX840|C729|E970|GS505|272|C395|E739BK|E960|L55C|L75C|LS696|LS860|P769BK|P350|P500|P509|P870|UN272|US730|VS840|VS950|LN272|LN510|LS670|LS855|LW690|MN270|MN510|P509|P769|P930|UN200|UN270|UN510|UN610|US670|US740|US760|UX265|UX840|VN271|VN530|VS660|VS700|VS740|VS750|VS910|VS920|VS930|VX9200|VX11000|AX840A|LW770|P506|P925|P999|E612|D955|D802|MS323|M257)|LM-G710",
        Sony: "SonyST|SonyLT|SonyEricsson|SonyEricssonLT15iv|LT18i|E10i|LT28h|LT26w|SonyEricssonMT27i|C5303|C6902|C6903|C6906|C6943|D2533|SOV34|601SO|F8332",
        Asus: "Asus.*Galaxy|PadFone.*Mobile",
        Xiaomi:
          "^(?!.*\\bx11\\b).*xiaomi.*$|POCOPHONE F1|MI 8|Redmi Note 9S|Redmi Note 5A Prime|N2G47H|M2001J2G|M2001J2I|M1805E10A|M2004J11G|M1902F1G|M2002J9G|M2004J19G|M2003J6A1G",
        NokiaLumia: "Lumia [0-9]{3,4}",
        Micromax:
          "Micromax.*\\b(A210|A92|A88|A72|A111|A110Q|A115|A116|A110|A90S|A26|A51|A35|A54|A25|A27|A89|A68|A65|A57|A90)\\b",
        Palm: "PalmSource|Palm",
        Vertu:
          "Vertu|Vertu.*Ltd|Vertu.*Ascent|Vertu.*Ayxta|Vertu.*Constellation(F|Quest)?|Vertu.*Monika|Vertu.*Signature",
        Pantech:
          "PANTECH|IM-A850S|IM-A840S|IM-A830L|IM-A830K|IM-A830S|IM-A820L|IM-A810K|IM-A810S|IM-A800S|IM-T100K|IM-A725L|IM-A780L|IM-A775C|IM-A770K|IM-A760S|IM-A750K|IM-A740S|IM-A730S|IM-A720L|IM-A710K|IM-A690L|IM-A690S|IM-A650S|IM-A630K|IM-A600S|VEGA PTL21|PT003|P8010|ADR910L|P6030|P6020|P9070|P4100|P9060|P5000|CDM8992|TXT8045|ADR8995|IS11PT|P2030|P6010|P8000|PT002|IS06|CDM8999|P9050|PT001|TXT8040|P2020|P9020|P2000|P7040|P7000|C790",
        Fly: "IQ230|IQ444|IQ450|IQ440|IQ442|IQ441|IQ245|IQ256|IQ236|IQ255|IQ235|IQ245|IQ275|IQ240|IQ285|IQ280|IQ270|IQ260|IQ250",
        Wiko: "KITE 4G|HIGHWAY|GETAWAY|STAIRWAY|DARKSIDE|DARKFULL|DARKNIGHT|DARKMOON|SLIDE|WAX 4G|RAINBOW|BLOOM|SUNSET|GOA(?!nna)|LENNY|BARRY|IGGY|OZZY|CINK FIVE|CINK PEAX|CINK PEAX 2|CINK SLIM|CINK SLIM 2|CINK +|CINK KING|CINK PEAX|CINK SLIM|SUBLIM",
        iMobile: "i-mobile (IQ|i-STYLE|idea|ZAA|Hitz)",
        SimValley:
          "\\b(SP-80|XT-930|SX-340|XT-930|SX-310|SP-360|SP60|SPT-800|SP-120|SPT-800|SP-140|SPX-5|SPX-8|SP-100|SPX-8|SPX-12)\\b",
        Wolfgang: "AT-B24D|AT-AS50HD|AT-AS40W|AT-AS55HD|AT-AS45q2|AT-B26D|AT-AS50Q",
        Alcatel: "Alcatel",
        Nintendo: "Nintendo (3DS|Switch)",
        Amoi: "Amoi",
        INQ: "INQ",
        OnePlus: "ONEPLUS",
        GenericPhone:
          "Tapatalk|PDA;|SAGEM|\\bmmp\\b|pocket|\\bpsp\\b|symbian|Smartphone|smartfon|treo|up.browser|up.link|vodafone|\\bwap\\b|nokia|Series40|Series60|S60|SonyEricsson|N900|MAUI.*WAP.*Browser",
      },
      tablets: {
        iPad: "iPad|iPad.*Mobile",
        NexusTablet: "Android.*Nexus[\\s]+(7|9|10)",
        GoogleTablet: "Android.*Pixel C",
        SamsungTablet:
          "SAMSUNG.*Tablet|Galaxy.*Tab|SC-01C|GT-P1000|GT-P1003|GT-P1010|GT-P3105|GT-P6210|GT-P6800|GT-P6810|GT-P7100|GT-P7300|GT-P7310|GT-P7500|GT-P7510|SCH-I800|SCH-I815|SCH-I905|SGH-I957|SGH-I987|SGH-T849|SGH-T859|SGH-T869|SPH-P100|GT-P3100|GT-P3108|GT-P3110|GT-P5100|GT-P5110|GT-P6200|GT-P7320|GT-P7511|GT-N8000|GT-P8510|SGH-I497|SPH-P500|SGH-T779|SCH-I705|SCH-I915|GT-N8013|GT-P3113|GT-P5113|GT-P8110|GT-N8010|GT-N8005|GT-N8020|GT-P1013|GT-P6201|GT-P7501|GT-N5100|GT-N5105|GT-N5110|SHV-E140K|SHV-E140L|SHV-E140S|SHV-E150S|SHV-E230K|SHV-E230L|SHV-E230S|SHW-M180K|SHW-M180L|SHW-M180S|SHW-M180W|SHW-M300W|SHW-M305W|SHW-M380K|SHW-M380S|SHW-M380W|SHW-M430W|SHW-M480K|SHW-M480S|SHW-M480W|SHW-M485W|SHW-M486W|SHW-M500W|GT-I9228|SCH-P739|SCH-I925|GT-I9200|GT-P5200|GT-P5210|GT-P5210X|SM-T311|SM-T310|SM-T310X|SM-T210|SM-T210R|SM-T211|SM-P600|SM-P601|SM-P605|SM-P900|SM-P901|SM-T217|SM-T217A|SM-T217S|SM-P6000|SM-T3100|SGH-I467|XE500|SM-T110|GT-P5220|GT-I9200X|GT-N5110X|GT-N5120|SM-P905|SM-T111|SM-T2105|SM-T315|SM-T320|SM-T320X|SM-T321|SM-T520|SM-T525|SM-T530NU|SM-T230NU|SM-T330NU|SM-T900|XE500T1C|SM-P605V|SM-P905V|SM-T337V|SM-T537V|SM-T707V|SM-T807V|SM-P600X|SM-P900X|SM-T210X|SM-T230|SM-T230X|SM-T325|GT-P7503|SM-T531|SM-T330|SM-T530|SM-T705|SM-T705C|SM-T535|SM-T331|SM-T800|SM-T700|SM-T537|SM-T807|SM-P907A|SM-T337A|SM-T537A|SM-T707A|SM-T807A|SM-T237|SM-T807P|SM-P607T|SM-T217T|SM-T337T|SM-T807T|SM-T116NQ|SM-T116BU|SM-P550|SM-T350|SM-T550|SM-T9000|SM-P9000|SM-T705Y|SM-T805|GT-P3113|SM-T710|SM-T810|SM-T815|SM-T360|SM-T533|SM-T113|SM-T335|SM-T715|SM-T560|SM-T670|SM-T677|SM-T377|SM-T567|SM-T357T|SM-T555|SM-T561|SM-T713|SM-T719|SM-T813|SM-T819|SM-T580|SM-T355Y?|SM-T280|SM-T817A|SM-T820|SM-W700|SM-P580|SM-T587|SM-P350|SM-P555M|SM-P355M|SM-T113NU|SM-T815Y|SM-T585|SM-T285|SM-T825|SM-W708|SM-T835|SM-T830|SM-T837V|SM-T720|SM-T510|SM-T387V|SM-P610|SM-T290|SM-T515|SM-T590|SM-T595|SM-T725|SM-T817P|SM-P585N0|SM-T395|SM-T295|SM-T865|SM-P610N|SM-P615|SM-T970|SM-T380|SM-T5950|SM-T905|SM-T231|SM-T500|SM-T860",
        Kindle:
          "Kindle|Silk.*Accelerated|Android.*\\b(KFOT|KFTT|KFJWI|KFJWA|KFOTE|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|WFJWAE|KFSAWA|KFSAWI|KFASWI|KFARWI|KFFOWI|KFGIWI|KFMEWI)\\b|Android.*Silk/[0-9.]+ like Chrome/[0-9.]+ (?!Mobile)",
        SurfaceTablet: "Windows NT [0-9.]+; ARM;.*(Tablet|ARMBJS)",
        HPTablet:
          "HP Slate (7|8|10)|HP ElitePad 900|hp-tablet|EliteBook.*Touch|HP 8|Slate 21|HP SlateBook 10",
        AsusTablet:
          "^.*PadFone((?!Mobile).)*$|Transformer|TF101|TF101G|TF300T|TF300TG|TF300TL|TF700T|TF700KL|TF701T|TF810C|ME171|ME301T|ME302C|ME371MG|ME370T|ME372MG|ME172V|ME173X|ME400C|Slider SL101|\\bK00F\\b|\\bK00C\\b|\\bK00E\\b|\\bK00L\\b|TX201LA|ME176C|ME102A|\\bM80TA\\b|ME372CL|ME560CG|ME372CG|ME302KL| K010 | K011 | K017 | K01E |ME572C|ME103K|ME170C|ME171C|\\bME70C\\b|ME581C|ME581CL|ME8510C|ME181C|P01Y|PO1MA|P01Z|\\bP027\\b|\\bP024\\b|\\bP00C\\b",
        BlackBerryTablet: "PlayBook|RIM Tablet",
        HTCtablet:
          "HTC_Flyer_P512|HTC Flyer|HTC Jetstream|HTC-P715a|HTC EVO View 4G|PG41200|PG09410",
        MotorolaTablet:
          "xoom|sholest|MZ615|MZ605|MZ505|MZ601|MZ602|MZ603|MZ604|MZ606|MZ607|MZ608|MZ609|MZ615|MZ616|MZ617",
        NookTablet:
          "Android.*Nook|NookColor|nook browser|BNRV200|BNRV200A|BNTV250|BNTV250A|BNTV400|BNTV600|LogicPD Zoom2",
        AcerTablet:
          "Android.*; \\b(A100|A101|A110|A200|A210|A211|A500|A501|A510|A511|A700|A701|W500|W500P|W501|W501P|W510|W511|W700|G100|G100W|B1-A71|B1-710|B1-711|A1-810|A1-811|A1-830)\\b|W3-810|\\bA3-A10\\b|\\bA3-A11\\b|\\bA3-A20\\b|\\bA3-A30|A3-A40",
        ToshibaTablet:
          "Android.*(AT100|AT105|AT200|AT205|AT270|AT275|AT300|AT305|AT1S5|AT500|AT570|AT700|AT830)|TOSHIBA.*FOLIO",
        LGTablet: "\\bL-06C|LG-V909|LG-V900|LG-V700|LG-V510|LG-V500|LG-V410|LG-V400|LG-VK810\\b",
        FujitsuTablet: "Android.*\\b(F-01D|F-02F|F-05E|F-10D|M532|Q572)\\b",
        PrestigioTablet:
          "PMP3170B|PMP3270B|PMP3470B|PMP7170B|PMP3370B|PMP3570C|PMP5870C|PMP3670B|PMP5570C|PMP5770D|PMP3970B|PMP3870C|PMP5580C|PMP5880D|PMP5780D|PMP5588C|PMP7280C|PMP7280C3G|PMP7280|PMP7880D|PMP5597D|PMP5597|PMP7100D|PER3464|PER3274|PER3574|PER3884|PER5274|PER5474|PMP5097CPRO|PMP5097|PMP7380D|PMP5297C|PMP5297C_QUAD|PMP812E|PMP812E3G|PMP812F|PMP810E|PMP880TD|PMT3017|PMT3037|PMT3047|PMT3057|PMT7008|PMT5887|PMT5001|PMT5002",
        LenovoTablet:
          "Lenovo TAB|Idea(Tab|Pad)( A1|A10| K1|)|ThinkPad([ ]+)?Tablet|YT3-850M|YT3-X90L|YT3-X90F|YT3-X90X|Lenovo.*(S2109|S2110|S5000|S6000|K3011|A3000|A3500|A1000|A2107|A2109|A1107|A5500|A7600|B6000|B8000|B8080)(-|)(FL|F|HV|H|)|TB-X103F|TB-X304X|TB-X304F|TB-X304L|TB-X505F|TB-X505L|TB-X505X|TB-X605F|TB-X605L|TB-8703F|TB-8703X|TB-8703N|TB-8704N|TB-8704F|TB-8704X|TB-8704V|TB-7304F|TB-7304I|TB-7304X|Tab2A7-10F|Tab2A7-20F|TB2-X30L|YT3-X50L|YT3-X50F|YT3-X50M|YT-X705F|YT-X703F|YT-X703L|YT-X705L|YT-X705X|TB2-X30F|TB2-X30L|TB2-X30M|A2107A-F|A2107A-H|TB3-730F|TB3-730M|TB3-730X|TB-7504F|TB-7504X|TB-X704F|TB-X104F|TB3-X70F|TB-X705F|TB-8504F|TB3-X70L|TB3-710F|TB-X704L",
        DellTablet: "Venue 11|Venue 8|Venue 7|Dell Streak 10|Dell Streak 7",
        YarvikTablet:
          "Android.*\\b(TAB210|TAB211|TAB224|TAB250|TAB260|TAB264|TAB310|TAB360|TAB364|TAB410|TAB411|TAB420|TAB424|TAB450|TAB460|TAB461|TAB464|TAB465|TAB467|TAB468|TAB07-100|TAB07-101|TAB07-150|TAB07-151|TAB07-152|TAB07-200|TAB07-201-3G|TAB07-210|TAB07-211|TAB07-212|TAB07-214|TAB07-220|TAB07-400|TAB07-485|TAB08-150|TAB08-200|TAB08-201-3G|TAB08-201-30|TAB09-100|TAB09-211|TAB09-410|TAB10-150|TAB10-201|TAB10-211|TAB10-400|TAB10-410|TAB13-201|TAB274EUK|TAB275EUK|TAB374EUK|TAB462EUK|TAB474EUK|TAB9-200)\\b",
        MedionTablet: "Android.*\\bOYO\\b|LIFE.*(P9212|P9514|P9516|S9512)|LIFETAB",
        ArnovaTablet:
          "97G4|AN10G2|AN7bG3|AN7fG3|AN8G3|AN8cG3|AN7G3|AN9G3|AN7dG3|AN7dG3ST|AN7dG3ChildPad|AN10bG3|AN10bG3DT|AN9G2",
        IntensoTablet: "INM8002KP|INM1010FP|INM805ND|Intenso Tab|TAB1004",
        IRUTablet: "M702pro",
        MegafonTablet: "MegaFon V9|\\bZTE V9\\b|Android.*\\bMT7A\\b",
        EbodaTablet: "E-Boda (Supreme|Impresspeed|Izzycomm|Essential)",
        AllViewTablet: "Allview.*(Viva|Alldro|City|Speed|All TV|Frenzy|Quasar|Shine|TX1|AX1|AX2)",
        ArchosTablet:
          "\\b(101G9|80G9|A101IT)\\b|Qilive 97R|Archos5|\\bARCHOS (70|79|80|90|97|101|FAMILYPAD|)(b|c|)(G10| Cobalt| TITANIUM(HD|)| Xenon| Neon|XSK| 2| XS 2| PLATINUM| CARBON|GAMEPAD)\\b",
        AinolTablet: "NOVO7|NOVO8|NOVO10|Novo7Aurora|Novo7Basic|NOVO7PALADIN|novo9-Spark",
        NokiaLumiaTablet: "Lumia 2520",
        SonyTablet:
          "Sony.*Tablet|Xperia Tablet|Sony Tablet S|SO-03E|SGPT12|SGPT13|SGPT114|SGPT121|SGPT122|SGPT123|SGPT111|SGPT112|SGPT113|SGPT131|SGPT132|SGPT133|SGPT211|SGPT212|SGPT213|SGP311|SGP312|SGP321|EBRD1101|EBRD1102|EBRD1201|SGP351|SGP341|SGP511|SGP512|SGP521|SGP541|SGP551|SGP621|SGP641|SGP612|SOT31|SGP771|SGP611|SGP612|SGP712",
        PhilipsTablet:
          "\\b(PI2010|PI3000|PI3100|PI3105|PI3110|PI3205|PI3210|PI3900|PI4010|PI7000|PI7100)\\b",
        CubeTablet:
          "Android.*(K8GT|U9GT|U10GT|U16GT|U17GT|U18GT|U19GT|U20GT|U23GT|U30GT)|CUBE U8GT",
        CobyTablet:
          "MID1042|MID1045|MID1125|MID1126|MID7012|MID7014|MID7015|MID7034|MID7035|MID7036|MID7042|MID7048|MID7127|MID8042|MID8048|MID8127|MID9042|MID9740|MID9742|MID7022|MID7010",
        MIDTablet:
          "M9701|M9000|M9100|M806|M1052|M806|T703|MID701|MID713|MID710|MID727|MID760|MID830|MID728|MID933|MID125|MID810|MID732|MID120|MID930|MID800|MID731|MID900|MID100|MID820|MID735|MID980|MID130|MID833|MID737|MID960|MID135|MID860|MID736|MID140|MID930|MID835|MID733|MID4X10",
        MSITablet:
          "MSI \\b(Primo 73K|Primo 73L|Primo 81L|Primo 77|Primo 93|Primo 75|Primo 76|Primo 73|Primo 81|Primo 91|Primo 90|Enjoy 71|Enjoy 7|Enjoy 10)\\b",
        SMiTTablet: "Android.*(\\bMID\\b|MID-560|MTV-T1200|MTV-PND531|MTV-P1101|MTV-PND530)",
        RockChipTablet: "Android.*(RK2818|RK2808A|RK2918|RK3066)|RK2738|RK2808A",
        FlyTablet: "IQ310|Fly Vision",
        bqTablet:
          "Android.*(bq)?.*\\b(Elcano|Curie|Edison|Maxwell|Kepler|Pascal|Tesla|Hypatia|Platon|Newton|Livingstone|Cervantes|Avant|Aquaris ([E|M]10|M8))\\b|Maxwell.*Lite|Maxwell.*Plus",
        HuaweiTablet:
          "MediaPad|MediaPad 7 Youth|IDEOS S7|S7-201c|S7-202u|S7-101|S7-103|S7-104|S7-105|S7-106|S7-201|S7-Slim|M2-A01L|BAH-L09|BAH-W09|AGS-L09|CMR-AL19",
        NecTablet: "\\bN-06D|\\bN-08D",
        PantechTablet: "Pantech.*P4100",
        BronchoTablet: "Broncho.*(N701|N708|N802|a710)",
        VersusTablet: "TOUCHPAD.*[78910]|\\bTOUCHTAB\\b",
        ZyncTablet: "z1000|Z99 2G|z930|z990|z909|Z919|z900",
        PositivoTablet: "TB07STA|TB10STA|TB07FTA|TB10FTA",
        NabiTablet: "Android.*\\bNabi",
        KoboTablet: "Kobo Touch|\\bK080\\b|\\bVox\\b Build|\\bArc\\b Build",
        DanewTablet: "DSlide.*\\b(700|701R|702|703R|704|802|970|971|972|973|974|1010|1012)\\b",
        TexetTablet:
          "NaviPad|TB-772A|TM-7045|TM-7055|TM-9750|TM-7016|TM-7024|TM-7026|TM-7041|TM-7043|TM-7047|TM-8041|TM-9741|TM-9747|TM-9748|TM-9751|TM-7022|TM-7021|TM-7020|TM-7011|TM-7010|TM-7023|TM-7025|TM-7037W|TM-7038W|TM-7027W|TM-9720|TM-9725|TM-9737W|TM-1020|TM-9738W|TM-9740|TM-9743W|TB-807A|TB-771A|TB-727A|TB-725A|TB-719A|TB-823A|TB-805A|TB-723A|TB-715A|TB-707A|TB-705A|TB-709A|TB-711A|TB-890HD|TB-880HD|TB-790HD|TB-780HD|TB-770HD|TB-721HD|TB-710HD|TB-434HD|TB-860HD|TB-840HD|TB-760HD|TB-750HD|TB-740HD|TB-730HD|TB-722HD|TB-720HD|TB-700HD|TB-500HD|TB-470HD|TB-431HD|TB-430HD|TB-506|TB-504|TB-446|TB-436|TB-416|TB-146SE|TB-126SE",
        PlaystationTablet: "Playstation.*(Portable|Vita)",
        TrekstorTablet:
          "ST10416-1|VT10416-1|ST70408-1|ST702xx-1|ST702xx-2|ST80208|ST97216|ST70104-2|VT10416-2|ST10216-2A|SurfTab",
        PyleAudioTablet:
          "\\b(PTBL10CEU|PTBL10C|PTBL72BC|PTBL72BCEU|PTBL7CEU|PTBL7C|PTBL92BC|PTBL92BCEU|PTBL9CEU|PTBL9CUK|PTBL9C)\\b",
        AdvanTablet:
          "Android.* \\b(E3A|T3X|T5C|T5B|T3E|T3C|T3B|T1J|T1F|T2A|T1H|T1i|E1C|T1-E|T5-A|T4|E1-B|T2Ci|T1-B|T1-D|O1-A|E1-A|T1-A|T3A|T4i)\\b ",
        DanyTechTablet:
          "Genius Tab G3|Genius Tab S2|Genius Tab Q3|Genius Tab G4|Genius Tab Q4|Genius Tab G-II|Genius TAB GII|Genius TAB GIII|Genius Tab S1",
        GalapadTablet: "Android [0-9.]+; [a-z-]+; \\bG1\\b",
        MicromaxTablet: "Funbook|Micromax.*\\b(P250|P560|P360|P362|P600|P300|P350|P500|P275)\\b",
        KarbonnTablet: "Android.*\\b(A39|A37|A34|ST8|ST10|ST7|Smart Tab3|Smart Tab2)\\b",
        AllFineTablet:
          "Fine7 Genius|Fine7 Shine|Fine7 Air|Fine8 Style|Fine9 More|Fine10 Joy|Fine11 Wide",
        PROSCANTablet:
          "\\b(PEM63|PLT1023G|PLT1041|PLT1044|PLT1044G|PLT1091|PLT4311|PLT4311PL|PLT4315|PLT7030|PLT7033|PLT7033D|PLT7035|PLT7035D|PLT7044K|PLT7045K|PLT7045KB|PLT7071KG|PLT7072|PLT7223G|PLT7225G|PLT7777G|PLT7810K|PLT7849G|PLT7851G|PLT7852G|PLT8015|PLT8031|PLT8034|PLT8036|PLT8080K|PLT8082|PLT8088|PLT8223G|PLT8234G|PLT8235G|PLT8816K|PLT9011|PLT9045K|PLT9233G|PLT9735|PLT9760G|PLT9770G)\\b",
        YONESTablet:
          "BQ1078|BC1003|BC1077|RK9702|BC9730|BC9001|IT9001|BC7008|BC7010|BC708|BC728|BC7012|BC7030|BC7027|BC7026",
        ChangJiaTablet:
          "TPC7102|TPC7103|TPC7105|TPC7106|TPC7107|TPC7201|TPC7203|TPC7205|TPC7210|TPC7708|TPC7709|TPC7712|TPC7110|TPC8101|TPC8103|TPC8105|TPC8106|TPC8203|TPC8205|TPC8503|TPC9106|TPC9701|TPC97101|TPC97103|TPC97105|TPC97106|TPC97111|TPC97113|TPC97203|TPC97603|TPC97809|TPC97205|TPC10101|TPC10103|TPC10106|TPC10111|TPC10203|TPC10205|TPC10503",
        GUTablet: "TX-A1301|TX-M9002|Q702|kf026",
        PointOfViewTablet:
          "TAB-P506|TAB-navi-7-3G-M|TAB-P517|TAB-P-527|TAB-P701|TAB-P703|TAB-P721|TAB-P731N|TAB-P741|TAB-P825|TAB-P905|TAB-P925|TAB-PR945|TAB-PL1015|TAB-P1025|TAB-PI1045|TAB-P1325|TAB-PROTAB[0-9]+|TAB-PROTAB25|TAB-PROTAB26|TAB-PROTAB27|TAB-PROTAB26XL|TAB-PROTAB2-IPS9|TAB-PROTAB30-IPS9|TAB-PROTAB25XXL|TAB-PROTAB26-IPS10|TAB-PROTAB30-IPS10",
        OvermaxTablet:
          "OV-(SteelCore|NewBase|Basecore|Baseone|Exellen|Quattor|EduTab|Solution|ACTION|BasicTab|TeddyTab|MagicTab|Stream|TB-08|TB-09)|Qualcore 1027",
        HCLTablet:
          "HCL.*Tablet|Connect-3G-2.0|Connect-2G-2.0|ME Tablet U1|ME Tablet U2|ME Tablet G1|ME Tablet X1|ME Tablet Y2|ME Tablet Sync",
        DPSTablet: "DPS Dream 9|DPS Dual 7",
        VistureTablet: "V97 HD|i75 3G|Visture V4( HD)?|Visture V5( HD)?|Visture V10",
        CrestaTablet:
          "CTP(-)?810|CTP(-)?818|CTP(-)?828|CTP(-)?838|CTP(-)?888|CTP(-)?978|CTP(-)?980|CTP(-)?987|CTP(-)?988|CTP(-)?989",
        MediatekTablet: "\\bMT8125|MT8389|MT8135|MT8377\\b",
        ConcordeTablet: "Concorde([ ]+)?Tab|ConCorde ReadMan",
        GoCleverTablet:
          "GOCLEVER TAB|A7GOCLEVER|M1042|M7841|M742|R1042BK|R1041|TAB A975|TAB A7842|TAB A741|TAB A741L|TAB M723G|TAB M721|TAB A1021|TAB I921|TAB R721|TAB I720|TAB T76|TAB R70|TAB R76.2|TAB R106|TAB R83.2|TAB M813G|TAB I721|GCTA722|TAB I70|TAB I71|TAB S73|TAB R73|TAB R74|TAB R93|TAB R75|TAB R76.1|TAB A73|TAB A93|TAB A93.2|TAB T72|TAB R83|TAB R974|TAB R973|TAB A101|TAB A103|TAB A104|TAB A104.2|R105BK|M713G|A972BK|TAB A971|TAB R974.2|TAB R104|TAB R83.3|TAB A1042",
        ModecomTablet:
          "FreeTAB 9000|FreeTAB 7.4|FreeTAB 7004|FreeTAB 7800|FreeTAB 2096|FreeTAB 7.5|FreeTAB 1014|FreeTAB 1001 |FreeTAB 8001|FreeTAB 9706|FreeTAB 9702|FreeTAB 7003|FreeTAB 7002|FreeTAB 1002|FreeTAB 7801|FreeTAB 1331|FreeTAB 1004|FreeTAB 8002|FreeTAB 8014|FreeTAB 9704|FreeTAB 1003",
        VoninoTablet:
          "\\b(Argus[ _]?S|Diamond[ _]?79HD|Emerald[ _]?78E|Luna[ _]?70C|Onyx[ _]?S|Onyx[ _]?Z|Orin[ _]?HD|Orin[ _]?S|Otis[ _]?S|SpeedStar[ _]?S|Magnet[ _]?M9|Primus[ _]?94[ _]?3G|Primus[ _]?94HD|Primus[ _]?QS|Android.*\\bQ8\\b|Sirius[ _]?EVO[ _]?QS|Sirius[ _]?QS|Spirit[ _]?S)\\b",
        ECSTablet: "V07OT2|TM105A|S10OT1|TR10CS1",
        StorexTablet: "eZee[_']?(Tab|Go)[0-9]+|TabLC7|Looney Tunes Tab",
        VodafoneTablet: "SmartTab([ ]+)?[0-9]+|SmartTabII10|SmartTabII7|VF-1497|VFD 1400",
        EssentielBTablet: "Smart[ ']?TAB[ ]+?[0-9]+|Family[ ']?TAB2",
        RossMoorTablet: "RM-790|RM-997|RMD-878G|RMD-974R|RMT-705A|RMT-701|RME-601|RMT-501|RMT-711",
        iMobileTablet: "i-mobile i-note",
        TolinoTablet: "tolino tab [0-9.]+|tolino shine",
        AudioSonicTablet: "\\bC-22Q|T7-QC|T-17B|T-17P\\b",
        AMPETablet: "Android.* A78 ",
        SkkTablet: "Android.* (SKYPAD|PHOENIX|CYCLOPS)",
        TecnoTablet: "TECNO P9|TECNO DP8D",
        JXDTablet:
          "Android.* \\b(F3000|A3300|JXD5000|JXD3000|JXD2000|JXD300B|JXD300|S5800|S7800|S602b|S5110b|S7300|S5300|S602|S603|S5100|S5110|S601|S7100a|P3000F|P3000s|P101|P200s|P1000m|P200m|P9100|P1000s|S6600b|S908|P1000|P300|S18|S6600|S9100)\\b",
        iJoyTablet:
          "Tablet (Spirit 7|Essentia|Galatea|Fusion|Onix 7|Landa|Titan|Scooby|Deox|Stella|Themis|Argon|Unique 7|Sygnus|Hexen|Finity 7|Cream|Cream X2|Jade|Neon 7|Neron 7|Kandy|Scape|Saphyr 7|Rebel|Biox|Rebel|Rebel 8GB|Myst|Draco 7|Myst|Tab7-004|Myst|Tadeo Jones|Tablet Boing|Arrow|Draco Dual Cam|Aurix|Mint|Amity|Revolution|Finity 9|Neon 9|T9w|Amity 4GB Dual Cam|Stone 4GB|Stone 8GB|Andromeda|Silken|X2|Andromeda II|Halley|Flame|Saphyr 9,7|Touch 8|Planet|Triton|Unique 10|Hexen 10|Memphis 4GB|Memphis 8GB|Onix 10)",
        FX2Tablet: "FX2 PAD7|FX2 PAD10",
        XoroTablet:
          "KidsPAD 701|PAD[ ]?712|PAD[ ]?714|PAD[ ]?716|PAD[ ]?717|PAD[ ]?718|PAD[ ]?720|PAD[ ]?721|PAD[ ]?722|PAD[ ]?790|PAD[ ]?792|PAD[ ]?900|PAD[ ]?9715D|PAD[ ]?9716DR|PAD[ ]?9718DR|PAD[ ]?9719QR|PAD[ ]?9720QR|TelePAD1030|Telepad1032|TelePAD730|TelePAD731|TelePAD732|TelePAD735Q|TelePAD830|TelePAD9730|TelePAD795|MegaPAD 1331|MegaPAD 1851|MegaPAD 2151",
        ViewsonicTablet:
          "ViewPad 10pi|ViewPad 10e|ViewPad 10s|ViewPad E72|ViewPad7|ViewPad E100|ViewPad 7e|ViewSonic VB733|VB100a",
        VerizonTablet: "QTAQZ3|QTAIR7|QTAQTZ3|QTASUN1|QTASUN2|QTAXIA1",
        OdysTablet:
          "LOOX|XENO10|ODYS[ -](Space|EVO|Xpress|NOON)|\\bXELIO\\b|Xelio10Pro|XELIO7PHONETAB|XELIO10EXTREME|XELIOPT2|NEO_QUAD10",
        CaptivaTablet: "CAPTIVA PAD",
        IconbitTablet:
          "NetTAB|NT-3702|NT-3702S|NT-3702S|NT-3603P|NT-3603P|NT-0704S|NT-0704S|NT-3805C|NT-3805C|NT-0806C|NT-0806C|NT-0909T|NT-0909T|NT-0907S|NT-0907S|NT-0902S|NT-0902S",
        TeclastTablet:
          "T98 4G|\\bP80\\b|\\bX90HD\\b|X98 Air|X98 Air 3G|\\bX89\\b|P80 3G|\\bX80h\\b|P98 Air|\\bX89HD\\b|P98 3G|\\bP90HD\\b|P89 3G|X98 3G|\\bP70h\\b|P79HD 3G|G18d 3G|\\bP79HD\\b|\\bP89s\\b|\\bA88\\b|\\bP10HD\\b|\\bP19HD\\b|G18 3G|\\bP78HD\\b|\\bA78\\b|\\bP75\\b|G17s 3G|G17h 3G|\\bP85t\\b|\\bP90\\b|\\bP11\\b|\\bP98t\\b|\\bP98HD\\b|\\bG18d\\b|\\bP85s\\b|\\bP11HD\\b|\\bP88s\\b|\\bA80HD\\b|\\bA80se\\b|\\bA10h\\b|\\bP89\\b|\\bP78s\\b|\\bG18\\b|\\bP85\\b|\\bA70h\\b|\\bA70\\b|\\bG17\\b|\\bP18\\b|\\bA80s\\b|\\bA11s\\b|\\bP88HD\\b|\\bA80h\\b|\\bP76s\\b|\\bP76h\\b|\\bP98\\b|\\bA10HD\\b|\\bP78\\b|\\bP88\\b|\\bA11\\b|\\bA10t\\b|\\bP76a\\b|\\bP76t\\b|\\bP76e\\b|\\bP85HD\\b|\\bP85a\\b|\\bP86\\b|\\bP75HD\\b|\\bP76v\\b|\\bA12\\b|\\bP75a\\b|\\bA15\\b|\\bP76Ti\\b|\\bP81HD\\b|\\bA10\\b|\\bT760VE\\b|\\bT720HD\\b|\\bP76\\b|\\bP73\\b|\\bP71\\b|\\bP72\\b|\\bT720SE\\b|\\bC520Ti\\b|\\bT760\\b|\\bT720VE\\b|T720-3GE|T720-WiFi",
        OndaTablet:
          "\\b(V975i|Vi30|VX530|V701|Vi60|V701s|Vi50|V801s|V719|Vx610w|VX610W|V819i|Vi10|VX580W|Vi10|V711s|V813|V811|V820w|V820|Vi20|V711|VI30W|V712|V891w|V972|V819w|V820w|Vi60|V820w|V711|V813s|V801|V819|V975s|V801|V819|V819|V818|V811|V712|V975m|V101w|V961w|V812|V818|V971|V971s|V919|V989|V116w|V102w|V973|Vi40)\\b[\\s]+|V10 \\b4G\\b",
        JaytechTablet: "TPC-PA762",
        BlaupunktTablet: "Endeavour 800NG|Endeavour 1010",
        DigmaTablet:
          "\\b(iDx10|iDx9|iDx8|iDx7|iDxD7|iDxD8|iDsQ8|iDsQ7|iDsQ8|iDsD10|iDnD7|3TS804H|iDsQ11|iDj7|iDs10)\\b",
        EvolioTablet:
          "ARIA_Mini_wifi|Aria[ _]Mini|Evolio X10|Evolio X7|Evolio X8|\\bEvotab\\b|\\bNeura\\b",
        LavaTablet: "QPAD E704|\\bIvoryS\\b|E-TAB IVORY|\\bE-TAB\\b",
        AocTablet: "MW0811|MW0812|MW0922|MTK8382|MW1031|MW0831|MW0821|MW0931|MW0712",
        MpmanTablet:
          "MP11 OCTA|MP10 OCTA|MPQC1114|MPQC1004|MPQC994|MPQC974|MPQC973|MPQC804|MPQC784|MPQC780|\\bMPG7\\b|MPDCG75|MPDCG71|MPDC1006|MP101DC|MPDC9000|MPDC905|MPDC706HD|MPDC706|MPDC705|MPDC110|MPDC100|MPDC99|MPDC97|MPDC88|MPDC8|MPDC77|MP709|MID701|MID711|MID170|MPDC703|MPQC1010",
        CelkonTablet:
          "CT695|CT888|CT[\\s]?910|CT7 Tab|CT9 Tab|CT3 Tab|CT2 Tab|CT1 Tab|C820|C720|\\bCT-1\\b",
        WolderTablet:
          "miTab \\b(DIAMOND|SPACE|BROOKLYN|NEO|FLY|MANHATTAN|FUNK|EVOLUTION|SKY|GOCAR|IRON|GENIUS|POP|MINT|EPSILON|BROADWAY|JUMP|HOP|LEGEND|NEW AGE|LINE|ADVANCE|FEEL|FOLLOW|LIKE|LINK|LIVE|THINK|FREEDOM|CHICAGO|CLEVELAND|BALTIMORE-GH|IOWA|BOSTON|SEATTLE|PHOENIX|DALLAS|IN 101|MasterChef)\\b",
        MediacomTablet:
          "M-MPI10C3G|M-SP10EG|M-SP10EGP|M-SP10HXAH|M-SP7HXAH|M-SP10HXBH|M-SP8HXAH|M-SP8MXA",
        MiTablet: "\\bMI PAD\\b|\\bHM NOTE 1W\\b",
        NibiruTablet: "Nibiru M1|Nibiru Jupiter One",
        NexoTablet:
          "NEXO NOVA|NEXO 10|NEXO AVIO|NEXO FREE|NEXO GO|NEXO EVO|NEXO 3G|NEXO SMART|NEXO KIDDO|NEXO MOBI",
        LeaderTablet:
          "TBLT10Q|TBLT10I|TBL-10WDKB|TBL-10WDKBO2013|TBL-W230V2|TBL-W450|TBL-W500|SV572|TBLT7I|TBA-AC7-8G|TBLT79|TBL-8W16|TBL-10W32|TBL-10WKB|TBL-W100",
        UbislateTablet: "UbiSlate[\\s]?7C",
        PocketBookTablet: "Pocketbook",
        KocasoTablet: "\\b(TB-1207)\\b",
        HisenseTablet: "\\b(F5281|E2371)\\b",
        Hudl: "Hudl HT7S3|Hudl 2",
        TelstraTablet: "T-Hub2",
        GenericTablet:
          "Android.*\\b97D\\b|Tablet(?!.*PC)|BNTV250A|MID-WCDMA|LogicPD Zoom2|\\bA7EB\\b|CatNova8|A1_07|CT704|CT1002|\\bM721\\b|rk30sdk|\\bEVOTAB\\b|M758A|ET904|ALUMIUM10|Smartfren Tab|Endeavour 1010|Tablet-PC-4|Tagi Tab|\\bM6pro\\b|CT1020W|arc 10HD|\\bTP750\\b|\\bQTAQZ3\\b|WVT101|TM1088|KT107",
      },
      oss: {
        AndroidOS: "Android",
        BlackBerryOS: "blackberry|\\bBB10\\b|rim tablet os",
        PalmOS: "PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino",
        SymbianOS: "Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\\bS60\\b",
        WindowsMobileOS:
          "Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Windows Mobile|Windows Phone [0-9.]+|WCE;",
        WindowsPhoneOS:
          "Windows Phone 10.0|Windows Phone 8.1|Windows Phone 8.0|Windows Phone OS|XBLWP7|ZuneWP7|Windows NT 6.[23]; ARM;",
        iOS: "\\biPhone.*Mobile|\\biPod|\\biPad|AppleCoreMedia",
        iPadOS: "CPU OS 13",
        SailfishOS: "Sailfish",
        MeeGoOS: "MeeGo",
        MaemoOS: "Maemo",
        JavaOS: "J2ME/|\\bMIDP\\b|\\bCLDC\\b",
        webOS: "webOS|hpwOS",
        badaOS: "\\bBada\\b",
        BREWOS: "BREW",
      },
      uas: {
        Chrome: "\\bCrMo\\b|CriOS|Android.*Chrome/[.0-9]* (Mobile)?",
        Dolfin: "\\bDolfin\\b",
        Opera: "Opera.*Mini|Opera.*Mobi|Android.*Opera|Mobile.*OPR/[0-9.]+$|Coast/[0-9.]+",
        Skyfire: "Skyfire",
        Edge: "\\bEdgiOS\\b|Mobile Safari/[.0-9]* Edge",
        IE: "IEMobile|MSIEMobile",
        Firefox: "fennec|firefox.*maemo|(Mobile|Tablet).*Firefox|Firefox.*Mobile|FxiOS",
        Bolt: "bolt",
        TeaShark: "teashark",
        Blazer: "Blazer",
        Safari: "Version((?!\\bEdgiOS\\b).)*Mobile.*Safari|Safari.*Mobile|MobileSafari",
        WeChat: "\\bMicroMessenger\\b",
        UCBrowser: "UC.*Browser|UCWEB",
        baiduboxapp: "baiduboxapp",
        baidubrowser: "baidubrowser",
        DiigoBrowser: "DiigoBrowser",
        Mercury: "\\bMercury\\b",
        ObigoBrowser: "Obigo",
        NetFront: "NF-Browser",
        GenericBrowser:
          "NokiaBrowser|OviBrowser|OneBrowser|TwonkyBeamBrowser|SEMC.*Browser|FlyFlow|Minimo|NetFront|Novarra-Vision|MQQBrowser|MicroMessenger",
        PaleMoon: "Android.*PaleMoon|Mobile.*PaleMoon",
      },
      props: {
        Mobile: "Mobile/[VER]",
        Build: "Build/[VER]",
        Version: "Version/[VER]",
        VendorID: "VendorID/[VER]",
        iPad: "iPad.*CPU[a-z ]+[VER]",
        iPhone: "iPhone.*CPU[a-z ]+[VER]",
        iPod: "iPod.*CPU[a-z ]+[VER]",
        Kindle: "Kindle/[VER]",
        Chrome: ["Chrome/[VER]", "CriOS/[VER]", "CrMo/[VER]"],
        Coast: ["Coast/[VER]"],
        Dolfin: "Dolfin/[VER]",
        Firefox: ["Firefox/[VER]", "FxiOS/[VER]"],
        Fennec: "Fennec/[VER]",
        Edge: "Edge/[VER]",
        IE: ["IEMobile/[VER];", "IEMobile [VER]", "MSIE [VER];", "Trident/[0-9.]+;.*rv:[VER]"],
        NetFront: "NetFront/[VER]",
        NokiaBrowser: "NokiaBrowser/[VER]",
        Opera: [" OPR/[VER]", "Opera Mini/[VER]", "Version/[VER]"],
        "Opera Mini": "Opera Mini/[VER]",
        "Opera Mobi": "Version/[VER]",
        UCBrowser: ["UCWEB[VER]", "UC.*Browser/[VER]"],
        MQQBrowser: "MQQBrowser/[VER]",
        MicroMessenger: "MicroMessenger/[VER]",
        baiduboxapp: "baiduboxapp/[VER]",
        baidubrowser: "baidubrowser/[VER]",
        SamsungBrowser: "SamsungBrowser/[VER]",
        Iron: "Iron/[VER]",
        Safari: ["Version/[VER]", "Safari/[VER]"],
        Skyfire: "Skyfire/[VER]",
        Tizen: "Tizen/[VER]",
        Webkit: "webkit[ /][VER]",
        PaleMoon: "PaleMoon/[VER]",
        SailfishBrowser: "SailfishBrowser/[VER]",
        Gecko: "Gecko/[VER]",
        Trident: "Trident/[VER]",
        Presto: "Presto/[VER]",
        Goanna: "Goanna/[VER]",
        iOS: " \\bi?OS\\b [VER][ ;]{1}",
        Android: "Android [VER]",
        Sailfish: "Sailfish [VER]",
        BlackBerry: ["BlackBerry[\\w]+/[VER]", "BlackBerry.*Version/[VER]", "Version/[VER]"],
        BREW: "BREW [VER]",
        Java: "Java/[VER]",
        "Windows Phone OS": ["Windows Phone OS [VER]", "Windows Phone [VER]"],
        "Windows Phone": "Windows Phone [VER]",
        "Windows CE": "Windows CE/[VER]",
        "Windows NT": "Windows NT [VER]",
        Symbian: ["SymbianOS/[VER]", "Symbian/[VER]"],
        webOS: ["webOS/[VER]", "hpwOS/[VER];"],
      },
      utils: {
        Bot: "Googlebot|facebookexternalhit|Google-AMPHTML|s~amp-validator|AdsBot-Google|Google Keyword Suggestion|Facebot|YandexBot|YandexMobileBot|bingbot|ia_archiver|AhrefsBot|Ezooms|GSLFbot|WBSearchBot|Twitterbot|TweetmemeBot|Twikle|PaperLiBot|Wotbox|UnwindFetchor|Exabot|MJ12bot|YandexImages|TurnitinBot|Pingdom|contentkingapp|AspiegelBot",
        MobileBot: "Googlebot-Mobile|AdsBot-Google-Mobile|YahooSeeker/M1A1-R2D2",
        DesktopMode: "WPDesktop",
        TV: "SonyDTV|HbbTV",
        WebKit: "(webkit)[ /]([\\w.]+)",
        Console: "\\b(Nintendo|Nintendo WiiU|Nintendo 3DS|Nintendo Switch|PLAYSTATION|Xbox)\\b",
        Watch: "SM-V700",
      },
    }),
      (g.detectMobileBrowsers = {
        fullPattern:
          /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,
        shortPattern:
          /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,
        tabletPattern: /android|ipad|playbook|silk/i,
      });
    var h,
      i = Object.prototype.hasOwnProperty;
    return (
      (g.FALLBACK_PHONE = "UnknownPhone"),
      (g.FALLBACK_TABLET = "UnknownTablet"),
      (g.FALLBACK_MOBILE = "UnknownMobile"),
      (h =
        "isArray" in Array
          ? Array.isArray
          : function (a) {
              return "[object Array]" === Object.prototype.toString.call(a);
            }),
      (function () {
        var a,
          b,
          c,
          e,
          f,
          j,
          k = g.mobileDetectRules;
        for (a in k.props)
          if (i.call(k.props, a)) {
            for (b = k.props[a], h(b) || (b = [b]), f = b.length, e = 0; e < f; ++e)
              (c = b[e]),
                (j = c.indexOf("[VER]")),
                j >= 0 && (c = c.substring(0, j) + "([\\w._\\+]+)" + c.substring(j + 5)),
                (b[e] = new RegExp(c, "i"));
            k.props[a] = b;
          }
        d(k.oss),
          d(k.phones),
          d(k.tablets),
          d(k.uas),
          d(k.utils),
          (k.oss0 = {
            WindowsPhoneOS: k.oss.WindowsPhoneOS,
            WindowsMobileOS: k.oss.WindowsMobileOS,
          });
      })(),
      (g.findMatch = function (a, b) {
        for (var c in a) if (i.call(a, c) && a[c].test(b)) return c;
        return null;
      }),
      (g.findMatches = function (a, b) {
        var c = [];
        for (var d in a) i.call(a, d) && a[d].test(b) && c.push(d);
        return c;
      }),
      (g.getVersionStr = function (a, b) {
        var c,
          d,
          e,
          f,
          h = g.mobileDetectRules.props;
        if (i.call(h, a))
          for (c = h[a], e = c.length, d = 0; d < e; ++d)
            if (((f = c[d].exec(b)), null !== f)) return f[1];
        return null;
      }),
      (g.getVersion = function (a, b) {
        var c = g.getVersionStr(a, b);
        return c ? g.prepareVersionNo(c) : NaN;
      }),
      (g.prepareVersionNo = function (a) {
        var b;
        return (
          (b = a.split(/[a-z._ \/\-]/i)),
          1 === b.length && (a = b[0]),
          b.length > 1 && ((a = b[0] + "."), b.shift(), (a += b.join(""))),
          Number(a)
        );
      }),
      (g.isMobileFallback = function (a) {
        return (
          g.detectMobileBrowsers.fullPattern.test(a) ||
          g.detectMobileBrowsers.shortPattern.test(a.substr(0, 4))
        );
      }),
      (g.isTabletFallback = function (a) {
        return g.detectMobileBrowsers.tabletPattern.test(a);
      }),
      (g.prepareDetectionCache = function (a, c, d) {
        if (a.mobile === b) {
          var e, h, i;
          return (h = g.findMatch(g.mobileDetectRules.tablets, c))
            ? ((a.mobile = a.tablet = h), void (a.phone = null))
            : (e = g.findMatch(g.mobileDetectRules.phones, c))
            ? ((a.mobile = a.phone = e), void (a.tablet = null))
            : void (g.isMobileFallback(c)
                ? ((i = f.isPhoneSized(d)),
                  i === b
                    ? ((a.mobile = g.FALLBACK_MOBILE), (a.tablet = a.phone = null))
                    : i
                    ? ((a.mobile = a.phone = g.FALLBACK_PHONE), (a.tablet = null))
                    : ((a.mobile = a.tablet = g.FALLBACK_TABLET), (a.phone = null)))
                : g.isTabletFallback(c)
                ? ((a.mobile = a.tablet = g.FALLBACK_TABLET), (a.phone = null))
                : (a.mobile = a.tablet = a.phone = null));
        }
      }),
      (g.mobileGrade = function (a) {
        var b = null !== a.mobile();
        return (a.os("iOS") && a.version("iPad") >= 4.3) ||
          (a.os("iOS") && a.version("iPhone") >= 3.1) ||
          (a.os("iOS") && a.version("iPod") >= 3.1) ||
          (a.version("Android") > 2.1 && a.is("Webkit")) ||
          a.version("Windows Phone OS") >= 7 ||
          (a.is("BlackBerry") && a.version("BlackBerry") >= 6) ||
          a.match("Playbook.*Tablet") ||
          (a.version("webOS") >= 1.4 && a.match("Palm|Pre|Pixi")) ||
          a.match("hp.*TouchPad") ||
          (a.is("Firefox") && a.version("Firefox") >= 12) ||
          (a.is("Chrome") && a.is("AndroidOS") && a.version("Android") >= 4) ||
          (a.is("Skyfire") &&
            a.version("Skyfire") >= 4.1 &&
            a.is("AndroidOS") &&
            a.version("Android") >= 2.3) ||
          (a.is("Opera") && a.version("Opera Mobi") > 11 && a.is("AndroidOS")) ||
          a.is("MeeGoOS") ||
          a.is("Tizen") ||
          (a.is("Dolfin") && a.version("Bada") >= 2) ||
          ((a.is("UC Browser") || a.is("Dolfin")) && a.version("Android") >= 2.3) ||
          a.match("Kindle Fire") ||
          (a.is("Kindle") && a.version("Kindle") >= 3) ||
          (a.is("AndroidOS") && a.is("NookTablet")) ||
          (a.version("Chrome") >= 11 && !b) ||
          (a.version("Safari") >= 5 && !b) ||
          (a.version("Firefox") >= 4 && !b) ||
          (a.version("MSIE") >= 7 && !b) ||
          (a.version("Opera") >= 10 && !b)
          ? "A"
          : (a.os("iOS") && a.version("iPad") < 4.3) ||
            (a.os("iOS") && a.version("iPhone") < 3.1) ||
            (a.os("iOS") && a.version("iPod") < 3.1) ||
            (a.is("Blackberry") && a.version("BlackBerry") >= 5 && a.version("BlackBerry") < 6) ||
            (a.version("Opera Mini") >= 5 &&
              a.version("Opera Mini") <= 6.5 &&
              (a.version("Android") >= 2.3 || a.is("iOS"))) ||
            a.match("NokiaN8|NokiaC7|N97.*Series60|Symbian/3") ||
            (a.version("Opera Mobi") >= 11 && a.is("SymbianOS"))
          ? "B"
          : (a.version("BlackBerry") < 5 ||
              a.match("MSIEMobile|Windows CE.*Mobile") ||
              a.version("Windows Mobile") <= 5.2,
            "C");
      }),
      (g.detectOS = function (a) {
        return g.findMatch(g.mobileDetectRules.oss0, a) || g.findMatch(g.mobileDetectRules.oss, a);
      }),
      (g.getDeviceSmallerSide = function () {
        return window.screen.width < window.screen.height
          ? window.screen.width
          : window.screen.height;
      }),
      (f.prototype = {
        constructor: f,
        mobile: function () {
          return (
            g.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth), this._cache.mobile
          );
        },
        phone: function () {
          return (
            g.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth), this._cache.phone
          );
        },
        tablet: function () {
          return (
            g.prepareDetectionCache(this._cache, this.ua, this.maxPhoneWidth), this._cache.tablet
          );
        },
        userAgent: function () {
          return (
            this._cache.userAgent === b &&
              (this._cache.userAgent = g.findMatch(g.mobileDetectRules.uas, this.ua)),
            this._cache.userAgent
          );
        },
        userAgents: function () {
          return (
            this._cache.userAgents === b &&
              (this._cache.userAgents = g.findMatches(g.mobileDetectRules.uas, this.ua)),
            this._cache.userAgents
          );
        },
        os: function () {
          return this._cache.os === b && (this._cache.os = g.detectOS(this.ua)), this._cache.os;
        },
        version: function (a) {
          return g.getVersion(a, this.ua);
        },
        versionStr: function (a) {
          return g.getVersionStr(a, this.ua);
        },
        is: function (b) {
          return (
            c(this.userAgents(), b) ||
            a(b, this.os()) ||
            a(b, this.phone()) ||
            a(b, this.tablet()) ||
            c(g.findMatches(g.mobileDetectRules.utils, this.ua), b)
          );
        },
        match: function (a) {
          return a instanceof RegExp || (a = new RegExp(a, "i")), a.test(this.ua);
        },
        isPhoneSized: function (a) {
          return f.isPhoneSized(a || this.maxPhoneWidth);
        },
        mobileGrade: function () {
          return (
            this._cache.grade === b && (this._cache.grade = g.mobileGrade(this)), this._cache.grade
          );
        },
      }),
      "undefined" != typeof window && window.screen
        ? (f.isPhoneSized = function (a) {
            return a < 0 ? b : g.getDeviceSmallerSide() <= a;
          })
        : (f.isPhoneSized = function () {}),
      (f._impl = g),
      (f.version = "1.4.5 2021-03-13"),
      f
    );
  });
})(
  (function (a) {
    if ("undefined" != typeof module && module.exports)
      return function (a) {
        module.exports = a();
      };
    if ("function" == typeof define && define.amd) return define;
    if ("undefined" != typeof window)
      return function (a) {
        window.MobileDetect = a();
      };
    throw new Error("unknown environment");
  })()
); /*! howler.js v2.1.3 | (c) 2013-2019, James Simpson of GoldFire Studios | MIT License | howlerjs.com */
!(function () {
  "use strict";
  var e = function () {
    this.init();
  };
  e.prototype = {
    init: function () {
      var e = this || n;
      return (
        (e._counter = 1e3),
        (e._html5AudioPool = []),
        (e.html5PoolSize = 10),
        (e._codecs = {}),
        (e._howls = []),
        (e._muted = !1),
        (e._volume = 1),
        (e._canPlayEvent = "canplaythrough"),
        (e._navigator = "undefined" != typeof window && window.navigator ? window.navigator : null),
        (e.masterGain = null),
        (e.noAudio = !1),
        (e.usingWebAudio = !0),
        (e.autoSuspend = !0),
        (e.ctx = null),
        (e.autoUnlock = !0),
        e._setup(),
        e
      );
    },
    volume: function (e) {
      var o = this || n;
      if (((e = parseFloat(e)), o.ctx || _(), void 0 !== e && e >= 0 && e <= 1)) {
        if (((o._volume = e), o._muted)) return o;
        o.usingWebAudio && o.masterGain.gain.setValueAtTime(e, n.ctx.currentTime);
        for (var t = 0; t < o._howls.length; t++)
          if (!o._howls[t]._webAudio)
            for (var r = o._howls[t]._getSoundIds(), a = 0; a < r.length; a++) {
              var u = o._howls[t]._soundById(r[a]);
              u && u._node && (u._node.volume = u._volume * e);
            }
        return o;
      }
      return o._volume;
    },
    mute: function (e) {
      var o = this || n;
      o.ctx || _(),
        (o._muted = e),
        o.usingWebAudio && o.masterGain.gain.setValueAtTime(e ? 0 : o._volume, n.ctx.currentTime);
      for (var t = 0; t < o._howls.length; t++)
        if (!o._howls[t]._webAudio)
          for (var r = o._howls[t]._getSoundIds(), a = 0; a < r.length; a++) {
            var u = o._howls[t]._soundById(r[a]);
            u && u._node && (u._node.muted = !!e || u._muted);
          }
      return o;
    },
    unload: function () {
      for (var e = this || n, o = e._howls.length - 1; o >= 0; o--) e._howls[o].unload();
      return (
        e.usingWebAudio && e.ctx && void 0 !== e.ctx.close && (e.ctx.close(), (e.ctx = null), _()),
        e
      );
    },
    codecs: function (e) {
      return (this || n)._codecs[e.replace(/^x-/, "")];
    },
    _setup: function () {
      var e = this || n;
      if (
        ((e.state = e.ctx ? e.ctx.state || "suspended" : "suspended"),
        e._autoSuspend(),
        !e.usingWebAudio)
      )
        if ("undefined" != typeof Audio)
          try {
            var o = new Audio();
            void 0 === o.oncanplaythrough && (e._canPlayEvent = "canplay");
          } catch (n) {
            e.noAudio = !0;
          }
        else e.noAudio = !0;
      try {
        var o = new Audio();
        o.muted && (e.noAudio = !0);
      } catch (e) {}
      return e.noAudio || e._setupCodecs(), e;
    },
    _setupCodecs: function () {
      var e = this || n,
        o = null;
      try {
        o = "undefined" != typeof Audio ? new Audio() : null;
      } catch (n) {
        return e;
      }
      if (!o || "function" != typeof o.canPlayType) return e;
      var t = o.canPlayType("audio/mpeg;").replace(/^no$/, ""),
        r = e._navigator && e._navigator.userAgent.match(/OPR\/([0-6].)/g),
        a = r && parseInt(r[0].split("/")[1], 10) < 33;
      return (
        (e._codecs = {
          mp3: !(a || (!t && !o.canPlayType("audio/mp3;").replace(/^no$/, ""))),
          mpeg: !!t,
          opus: !!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/, ""),
          ogg: !!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, ""),
          oga: !!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, ""),
          wav: !!o.canPlayType('audio/wav; codecs="1"').replace(/^no$/, ""),
          aac: !!o.canPlayType("audio/aac;").replace(/^no$/, ""),
          caf: !!o.canPlayType("audio/x-caf;").replace(/^no$/, ""),
          m4a: !!(
            o.canPlayType("audio/x-m4a;") ||
            o.canPlayType("audio/m4a;") ||
            o.canPlayType("audio/aac;")
          ).replace(/^no$/, ""),
          mp4: !!(
            o.canPlayType("audio/x-mp4;") ||
            o.canPlayType("audio/mp4;") ||
            o.canPlayType("audio/aac;")
          ).replace(/^no$/, ""),
          weba: !!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/, ""),
          webm: !!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/, ""),
          dolby: !!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/, ""),
          flac: !!(o.canPlayType("audio/x-flac;") || o.canPlayType("audio/flac;")).replace(
            /^no$/,
            ""
          ),
        }),
        e
      );
    },
    _unlockAudio: function () {
      var e = this || n;
      if (!e._audioUnlocked && e.ctx) {
        (e._audioUnlocked = !1),
          (e.autoUnlock = !1),
          e._mobileUnloaded || 44100 === e.ctx.sampleRate || ((e._mobileUnloaded = !0), e.unload()),
          (e._scratchBuffer = e.ctx.createBuffer(1, 1, 22050));
        var o = function (n) {
          for (var t = 0; t < e.html5PoolSize; t++)
            try {
              var r = new Audio();
              (r._unlocked = !0), e._releaseHtml5Audio(r);
            } catch (n) {
              e.noAudio = !0;
            }
          for (var t = 0; t < e._howls.length; t++)
            if (!e._howls[t]._webAudio)
              for (var a = e._howls[t]._getSoundIds(), u = 0; u < a.length; u++) {
                var i = e._howls[t]._soundById(a[u]);
                i && i._node && !i._node._unlocked && ((i._node._unlocked = !0), i._node.load());
              }
          e._autoResume();
          var d = e.ctx.createBufferSource();
          (d.buffer = e._scratchBuffer),
            d.connect(e.ctx.destination),
            void 0 === d.start ? d.noteOn(0) : d.start(0),
            "function" == typeof e.ctx.resume && e.ctx.resume(),
            (d.onended = function () {
              d.disconnect(0),
                (e._audioUnlocked = !0),
                document.removeEventListener("touchstart", o, !0),
                document.removeEventListener("touchend", o, !0),
                document.removeEventListener("click", o, !0);
              for (var n = 0; n < e._howls.length; n++) e._howls[n]._emit("unlock");
            });
        };
        return (
          document.addEventListener("touchstart", o, !0),
          document.addEventListener("touchend", o, !0),
          document.addEventListener("click", o, !0),
          e
        );
      }
    },
    _obtainHtml5Audio: function () {
      var e = this || n;
      if (e._html5AudioPool.length) return e._html5AudioPool.pop();
      var o = new Audio().play();
      return (
        o &&
          "undefined" != typeof Promise &&
          (o instanceof Promise || "function" == typeof o.then) &&
          o.catch(function () {
            console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.");
          }),
        new Audio()
      );
    },
    _releaseHtml5Audio: function (e) {
      var o = this || n;
      return e._unlocked && o._html5AudioPool.push(e), o;
    },
    _autoSuspend: function () {
      var e = this;
      if (e.autoSuspend && e.ctx && void 0 !== e.ctx.suspend && n.usingWebAudio) {
        for (var o = 0; o < e._howls.length; o++)
          if (e._howls[o]._webAudio)
            for (var t = 0; t < e._howls[o]._sounds.length; t++)
              if (!e._howls[o]._sounds[t]._paused) return e;
        return (
          e._suspendTimer && clearTimeout(e._suspendTimer),
          (e._suspendTimer = setTimeout(function () {
            e.autoSuspend &&
              ((e._suspendTimer = null),
              (e.state = "suspending"),
              e.ctx.suspend().then(function () {
                (e.state = "suspended"),
                  e._resumeAfterSuspend && (delete e._resumeAfterSuspend, e._autoResume());
              }));
          }, 3e4)),
          e
        );
      }
    },
    _autoResume: function () {
      var e = this;
      if (e.ctx && void 0 !== e.ctx.resume && n.usingWebAudio)
        return (
          "running" === e.state && e._suspendTimer
            ? (clearTimeout(e._suspendTimer), (e._suspendTimer = null))
            : "suspended" === e.state
            ? (e.ctx.resume().then(function () {
                e.state = "running";
                for (var n = 0; n < e._howls.length; n++) e._howls[n]._emit("resume");
              }),
              e._suspendTimer && (clearTimeout(e._suspendTimer), (e._suspendTimer = null)))
            : "suspending" === e.state && (e._resumeAfterSuspend = !0),
          e
        );
    },
  };
  var n = new e(),
    o = function (e) {
      var n = this;
      if (!e.src || 0 === e.src.length)
        return void console.error("An array of source files must be passed with any new Howl.");
      n.init(e);
    };
  o.prototype = {
    init: function (e) {
      var o = this;
      return (
        n.ctx || _(),
        (o._autoplay = e.autoplay || !1),
        (o._format = "string" != typeof e.format ? e.format : [e.format]),
        (o._html5 = e.html5 || !1),
        (o._muted = e.mute || !1),
        (o._loop = e.loop || !1),
        (o._pool = e.pool || 5),
        (o._preload = "boolean" != typeof e.preload || e.preload),
        (o._rate = e.rate || 1),
        (o._sprite = e.sprite || {}),
        (o._src = "string" != typeof e.src ? e.src : [e.src]),
        (o._volume = void 0 !== e.volume ? e.volume : 1),
        (o._xhrWithCredentials = e.xhrWithCredentials || !1),
        (o._duration = 0),
        (o._state = "unloaded"),
        (o._sounds = []),
        (o._endTimers = {}),
        (o._queue = []),
        (o._playLock = !1),
        (o._onend = e.onend ? [{ fn: e.onend }] : []),
        (o._onfade = e.onfade ? [{ fn: e.onfade }] : []),
        (o._onload = e.onload ? [{ fn: e.onload }] : []),
        (o._onloaderror = e.onloaderror ? [{ fn: e.onloaderror }] : []),
        (o._onplayerror = e.onplayerror ? [{ fn: e.onplayerror }] : []),
        (o._onpause = e.onpause ? [{ fn: e.onpause }] : []),
        (o._onplay = e.onplay ? [{ fn: e.onplay }] : []),
        (o._onstop = e.onstop ? [{ fn: e.onstop }] : []),
        (o._onmute = e.onmute ? [{ fn: e.onmute }] : []),
        (o._onvolume = e.onvolume ? [{ fn: e.onvolume }] : []),
        (o._onrate = e.onrate ? [{ fn: e.onrate }] : []),
        (o._onseek = e.onseek ? [{ fn: e.onseek }] : []),
        (o._onunlock = e.onunlock ? [{ fn: e.onunlock }] : []),
        (o._onresume = []),
        (o._webAudio = n.usingWebAudio && !o._html5),
        void 0 !== n.ctx && n.ctx && n.autoUnlock && n._unlockAudio(),
        n._howls.push(o),
        o._autoplay &&
          o._queue.push({
            event: "play",
            action: function () {
              o.play();
            },
          }),
        o._preload && o.load(),
        o
      );
    },
    load: function () {
      var e = this,
        o = null;
      if (n.noAudio) return void e._emit("loaderror", null, "No audio support.");
      "string" == typeof e._src && (e._src = [e._src]);
      for (var r = 0; r < e._src.length; r++) {
        var u, i;
        if (e._format && e._format[r]) u = e._format[r];
        else {
          if ("string" != typeof (i = e._src[r])) {
            e._emit("loaderror", null, "Non-string found in selected audio sources - ignoring.");
            continue;
          }
          (u = /^data:audio\/([^;,]+);/i.exec(i)),
            u || (u = /\.([^.]+)$/.exec(i.split("?", 1)[0])),
            u && (u = u[1].toLowerCase());
        }
        if (
          (u ||
            console.warn(
              'No file extension was found. Consider using the "format" property or specify an extension.'
            ),
          u && n.codecs(u))
        ) {
          o = e._src[r];
          break;
        }
      }
      return o
        ? ((e._src = o),
          (e._state = "loading"),
          "https:" === window.location.protocol &&
            "http:" === o.slice(0, 5) &&
            ((e._html5 = !0), (e._webAudio = !1)),
          new t(e),
          e._webAudio && a(e),
          e)
        : void e._emit("loaderror", null, "No codec support for selected audio sources.");
    },
    play: function (e, o) {
      var t = this,
        r = null;
      if ("number" == typeof e) (r = e), (e = null);
      else {
        if ("string" == typeof e && "loaded" === t._state && !t._sprite[e]) return null;
        if (void 0 === e && ((e = "__default"), !t._playLock)) {
          for (var a = 0, u = 0; u < t._sounds.length; u++)
            t._sounds[u]._paused && !t._sounds[u]._ended && (a++, (r = t._sounds[u]._id));
          1 === a ? (e = null) : (r = null);
        }
      }
      var i = r ? t._soundById(r) : t._inactiveSound();
      if (!i) return null;
      if ((r && !e && (e = i._sprite || "__default"), "loaded" !== t._state)) {
        (i._sprite = e), (i._ended = !1);
        var d = i._id;
        return (
          t._queue.push({
            event: "play",
            action: function () {
              t.play(d);
            },
          }),
          d
        );
      }
      if (r && !i._paused) return o || t._loadQueue("play"), i._id;
      t._webAudio && n._autoResume();
      var _ = Math.max(0, i._seek > 0 ? i._seek : t._sprite[e][0] / 1e3),
        s = Math.max(0, (t._sprite[e][0] + t._sprite[e][1]) / 1e3 - _),
        l = (1e3 * s) / Math.abs(i._rate),
        c = t._sprite[e][0] / 1e3,
        f = (t._sprite[e][0] + t._sprite[e][1]) / 1e3;
      (i._sprite = e), (i._ended = !1);
      var p = function () {
        (i._paused = !1),
          (i._seek = _),
          (i._start = c),
          (i._stop = f),
          (i._loop = !(!i._loop && !t._sprite[e][2]));
      };
      if (_ >= f) return void t._ended(i);
      var m = i._node;
      if (t._webAudio) {
        var v = function () {
          (t._playLock = !1), p(), t._refreshBuffer(i);
          var e = i._muted || t._muted ? 0 : i._volume;
          m.gain.setValueAtTime(e, n.ctx.currentTime),
            (i._playStart = n.ctx.currentTime),
            void 0 === m.bufferSource.start
              ? i._loop
                ? m.bufferSource.noteGrainOn(0, _, 86400)
                : m.bufferSource.noteGrainOn(0, _, s)
              : i._loop
              ? m.bufferSource.start(0, _, 86400)
              : m.bufferSource.start(0, _, s),
            l !== 1 / 0 && (t._endTimers[i._id] = setTimeout(t._ended.bind(t, i), l)),
            o ||
              setTimeout(function () {
                t._emit("play", i._id), t._loadQueue();
              }, 0);
        };
        "running" === n.state
          ? v()
          : ((t._playLock = !0), t.once("resume", v), t._clearTimer(i._id));
      } else {
        var h = function () {
          (m.currentTime = _),
            (m.muted = i._muted || t._muted || n._muted || m.muted),
            (m.volume = i._volume * n.volume()),
            (m.playbackRate = i._rate);
          try {
            var r = m.play();
            if (
              (r &&
              "undefined" != typeof Promise &&
              (r instanceof Promise || "function" == typeof r.then)
                ? ((t._playLock = !0),
                  p(),
                  r
                    .then(function () {
                      (t._playLock = !1),
                        (m._unlocked = !0),
                        o || (t._emit("play", i._id), t._loadQueue());
                    })
                    .catch(function () {
                      (t._playLock = !1),
                        t._emit(
                          "playerror",
                          i._id,
                          "Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."
                        ),
                        (i._ended = !0),
                        (i._paused = !0);
                    }))
                : o || ((t._playLock = !1), p(), t._emit("play", i._id), t._loadQueue()),
              (m.playbackRate = i._rate),
              m.paused)
            )
              return void t._emit(
                "playerror",
                i._id,
                "Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."
              );
            "__default" !== e || i._loop
              ? (t._endTimers[i._id] = setTimeout(t._ended.bind(t, i), l))
              : ((t._endTimers[i._id] = function () {
                  t._ended(i), m.removeEventListener("ended", t._endTimers[i._id], !1);
                }),
                m.addEventListener("ended", t._endTimers[i._id], !1));
          } catch (e) {
            t._emit("playerror", i._id, e);
          }
        };
        "data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA" ===
          m.src && ((m.src = t._src), m.load());
        var y = (window && window.ejecta) || (!m.readyState && n._navigator.isCocoonJS);
        if (m.readyState >= 3 || y) h();
        else {
          t._playLock = !0;
          var g = function () {
            h(), m.removeEventListener(n._canPlayEvent, g, !1);
          };
          m.addEventListener(n._canPlayEvent, g, !1), t._clearTimer(i._id);
        }
      }
      return i._id;
    },
    pause: function (e) {
      var n = this;
      if ("loaded" !== n._state || n._playLock)
        return (
          n._queue.push({
            event: "pause",
            action: function () {
              n.pause(e);
            },
          }),
          n
        );
      for (var o = n._getSoundIds(e), t = 0; t < o.length; t++) {
        n._clearTimer(o[t]);
        var r = n._soundById(o[t]);
        if (
          r &&
          !r._paused &&
          ((r._seek = n.seek(o[t])),
          (r._rateSeek = 0),
          (r._paused = !0),
          n._stopFade(o[t]),
          r._node)
        )
          if (n._webAudio) {
            if (!r._node.bufferSource) continue;
            void 0 === r._node.bufferSource.stop
              ? r._node.bufferSource.noteOff(0)
              : r._node.bufferSource.stop(0),
              n._cleanBuffer(r._node);
          } else (isNaN(r._node.duration) && r._node.duration !== 1 / 0) || r._node.pause();
        arguments[1] || n._emit("pause", r ? r._id : null);
      }
      return n;
    },
    stop: function (e, n) {
      var o = this;
      if ("loaded" !== o._state || o._playLock)
        return (
          o._queue.push({
            event: "stop",
            action: function () {
              o.stop(e);
            },
          }),
          o
        );
      for (var t = o._getSoundIds(e), r = 0; r < t.length; r++) {
        o._clearTimer(t[r]);
        var a = o._soundById(t[r]);
        a &&
          ((a._seek = a._start || 0),
          (a._rateSeek = 0),
          (a._paused = !0),
          (a._ended = !0),
          o._stopFade(t[r]),
          a._node &&
            (o._webAudio
              ? a._node.bufferSource &&
                (void 0 === a._node.bufferSource.stop
                  ? a._node.bufferSource.noteOff(0)
                  : a._node.bufferSource.stop(0),
                o._cleanBuffer(a._node))
              : (isNaN(a._node.duration) && a._node.duration !== 1 / 0) ||
                ((a._node.currentTime = a._start || 0),
                a._node.pause(),
                a._node.duration === 1 / 0 && o._clearSound(a._node))),
          n || o._emit("stop", a._id));
      }
      return o;
    },
    mute: function (e, o) {
      var t = this;
      if ("loaded" !== t._state || t._playLock)
        return (
          t._queue.push({
            event: "mute",
            action: function () {
              t.mute(e, o);
            },
          }),
          t
        );
      if (void 0 === o) {
        if ("boolean" != typeof e) return t._muted;
        t._muted = e;
      }
      for (var r = t._getSoundIds(o), a = 0; a < r.length; a++) {
        var u = t._soundById(r[a]);
        u &&
          ((u._muted = e),
          u._interval && t._stopFade(u._id),
          t._webAudio && u._node
            ? u._node.gain.setValueAtTime(e ? 0 : u._volume, n.ctx.currentTime)
            : u._node && (u._node.muted = !!n._muted || e),
          t._emit("mute", u._id));
      }
      return t;
    },
    volume: function () {
      var e,
        o,
        t = this,
        r = arguments;
      if (0 === r.length) return t._volume;
      if (1 === r.length || (2 === r.length && void 0 === r[1])) {
        t._getSoundIds().indexOf(r[0]) >= 0 ? (o = parseInt(r[0], 10)) : (e = parseFloat(r[0]));
      } else r.length >= 2 && ((e = parseFloat(r[0])), (o = parseInt(r[1], 10)));
      var a;
      if (!(void 0 !== e && e >= 0 && e <= 1))
        return (a = o ? t._soundById(o) : t._sounds[0]), a ? a._volume : 0;
      if ("loaded" !== t._state || t._playLock)
        return (
          t._queue.push({
            event: "volume",
            action: function () {
              t.volume.apply(t, r);
            },
          }),
          t
        );
      void 0 === o && (t._volume = e), (o = t._getSoundIds(o));
      for (var u = 0; u < o.length; u++)
        (a = t._soundById(o[u])) &&
          ((a._volume = e),
          r[2] || t._stopFade(o[u]),
          t._webAudio && a._node && !a._muted
            ? a._node.gain.setValueAtTime(e, n.ctx.currentTime)
            : a._node && !a._muted && (a._node.volume = e * n.volume()),
          t._emit("volume", a._id));
      return t;
    },
    fade: function (e, o, t, r) {
      var a = this;
      if ("loaded" !== a._state || a._playLock)
        return (
          a._queue.push({
            event: "fade",
            action: function () {
              a.fade(e, o, t, r);
            },
          }),
          a
        );
      (e = parseFloat(e)), (o = parseFloat(o)), (t = parseFloat(t)), a.volume(e, r);
      for (var u = a._getSoundIds(r), i = 0; i < u.length; i++) {
        var d = a._soundById(u[i]);
        if (d) {
          if ((r || a._stopFade(u[i]), a._webAudio && !d._muted)) {
            var _ = n.ctx.currentTime,
              s = _ + t / 1e3;
            (d._volume = e),
              d._node.gain.setValueAtTime(e, _),
              d._node.gain.linearRampToValueAtTime(o, s);
          }
          a._startFadeInterval(d, e, o, t, u[i], void 0 === r);
        }
      }
      return a;
    },
    _startFadeInterval: function (e, n, o, t, r, a) {
      var u = this,
        i = n,
        d = o - n,
        _ = Math.abs(d / 0.01),
        s = Math.max(4, _ > 0 ? t / _ : t),
        l = Date.now();
      (e._fadeTo = o),
        (e._interval = setInterval(function () {
          var r = (Date.now() - l) / t;
          (l = Date.now()),
            (i += d * r),
            (i = Math.max(0, i)),
            (i = Math.min(1, i)),
            (i = Math.round(100 * i) / 100),
            u._webAudio ? (e._volume = i) : u.volume(i, e._id, !0),
            a && (u._volume = i),
            ((o < n && i <= o) || (o > n && i >= o)) &&
              (clearInterval(e._interval),
              (e._interval = null),
              (e._fadeTo = null),
              u.volume(o, e._id),
              u._emit("fade", e._id));
        }, s));
    },
    _stopFade: function (e) {
      var o = this,
        t = o._soundById(e);
      return (
        t &&
          t._interval &&
          (o._webAudio && t._node.gain.cancelScheduledValues(n.ctx.currentTime),
          clearInterval(t._interval),
          (t._interval = null),
          o.volume(t._fadeTo, e),
          (t._fadeTo = null),
          o._emit("fade", e)),
        o
      );
    },
    loop: function () {
      var e,
        n,
        o,
        t = this,
        r = arguments;
      if (0 === r.length) return t._loop;
      if (1 === r.length) {
        if ("boolean" != typeof r[0]) return !!(o = t._soundById(parseInt(r[0], 10))) && o._loop;
        (e = r[0]), (t._loop = e);
      } else 2 === r.length && ((e = r[0]), (n = parseInt(r[1], 10)));
      for (var a = t._getSoundIds(n), u = 0; u < a.length; u++)
        (o = t._soundById(a[u])) &&
          ((o._loop = e),
          t._webAudio &&
            o._node &&
            o._node.bufferSource &&
            ((o._node.bufferSource.loop = e),
            e &&
              ((o._node.bufferSource.loopStart = o._start || 0),
              (o._node.bufferSource.loopEnd = o._stop))));
      return t;
    },
    rate: function () {
      var e,
        o,
        t = this,
        r = arguments;
      if (0 === r.length) o = t._sounds[0]._id;
      else if (1 === r.length) {
        var a = t._getSoundIds(),
          u = a.indexOf(r[0]);
        u >= 0 ? (o = parseInt(r[0], 10)) : (e = parseFloat(r[0]));
      } else 2 === r.length && ((e = parseFloat(r[0])), (o = parseInt(r[1], 10)));
      var i;
      if ("number" != typeof e) return (i = t._soundById(o)), i ? i._rate : t._rate;
      if ("loaded" !== t._state || t._playLock)
        return (
          t._queue.push({
            event: "rate",
            action: function () {
              t.rate.apply(t, r);
            },
          }),
          t
        );
      void 0 === o && (t._rate = e), (o = t._getSoundIds(o));
      for (var d = 0; d < o.length; d++)
        if ((i = t._soundById(o[d]))) {
          t.playing(o[d]) &&
            ((i._rateSeek = t.seek(o[d])),
            (i._playStart = t._webAudio ? n.ctx.currentTime : i._playStart)),
            (i._rate = e),
            t._webAudio && i._node && i._node.bufferSource
              ? i._node.bufferSource.playbackRate.setValueAtTime(e, n.ctx.currentTime)
              : i._node && (i._node.playbackRate = e);
          var _ = t.seek(o[d]),
            s = (t._sprite[i._sprite][0] + t._sprite[i._sprite][1]) / 1e3 - _,
            l = (1e3 * s) / Math.abs(i._rate);
          (!t._endTimers[o[d]] && i._paused) ||
            (t._clearTimer(o[d]), (t._endTimers[o[d]] = setTimeout(t._ended.bind(t, i), l))),
            t._emit("rate", i._id);
        }
      return t;
    },
    seek: function () {
      var e,
        o,
        t = this,
        r = arguments;
      if (0 === r.length) o = t._sounds[0]._id;
      else if (1 === r.length) {
        var a = t._getSoundIds(),
          u = a.indexOf(r[0]);
        u >= 0
          ? (o = parseInt(r[0], 10))
          : t._sounds.length && ((o = t._sounds[0]._id), (e = parseFloat(r[0])));
      } else 2 === r.length && ((e = parseFloat(r[0])), (o = parseInt(r[1], 10)));
      if (void 0 === o) return t;
      if ("loaded" !== t._state || t._playLock)
        return (
          t._queue.push({
            event: "seek",
            action: function () {
              t.seek.apply(t, r);
            },
          }),
          t
        );
      var i = t._soundById(o);
      if (i) {
        if (!("number" == typeof e && e >= 0)) {
          if (t._webAudio) {
            var d = t.playing(o) ? n.ctx.currentTime - i._playStart : 0,
              _ = i._rateSeek ? i._rateSeek - i._seek : 0;
            return i._seek + (_ + d * Math.abs(i._rate));
          }
          return i._node.currentTime;
        }
        var s = t.playing(o);
        s && t.pause(o, !0),
          (i._seek = e),
          (i._ended = !1),
          t._clearTimer(o),
          t._webAudio || !i._node || isNaN(i._node.duration) || (i._node.currentTime = e);
        var l = function () {
          t._emit("seek", o), s && t.play(o, !0);
        };
        if (s && !t._webAudio) {
          var c = function () {
            t._playLock ? setTimeout(c, 0) : l();
          };
          setTimeout(c, 0);
        } else l();
      }
      return t;
    },
    playing: function (e) {
      var n = this;
      if ("number" == typeof e) {
        var o = n._soundById(e);
        return !!o && !o._paused;
      }
      for (var t = 0; t < n._sounds.length; t++) if (!n._sounds[t]._paused) return !0;
      return !1;
    },
    duration: function (e) {
      var n = this,
        o = n._duration,
        t = n._soundById(e);
      return t && (o = n._sprite[t._sprite][1] / 1e3), o;
    },
    state: function () {
      return this._state;
    },
    unload: function () {
      for (var e = this, o = e._sounds, t = 0; t < o.length; t++)
        o[t]._paused || e.stop(o[t]._id),
          e._webAudio ||
            (e._clearSound(o[t]._node),
            o[t]._node.removeEventListener("error", o[t]._errorFn, !1),
            o[t]._node.removeEventListener(n._canPlayEvent, o[t]._loadFn, !1),
            n._releaseHtml5Audio(o[t]._node)),
          delete o[t]._node,
          e._clearTimer(o[t]._id);
      var a = n._howls.indexOf(e);
      a >= 0 && n._howls.splice(a, 1);
      var u = !0;
      for (t = 0; t < n._howls.length; t++)
        if (n._howls[t]._src === e._src || e._src.indexOf(n._howls[t]._src) >= 0) {
          u = !1;
          break;
        }
      return (
        r && u && delete r[e._src],
        (n.noAudio = !1),
        (e._state = "unloaded"),
        (e._sounds = []),
        (e = null),
        null
      );
    },
    on: function (e, n, o, t) {
      var r = this,
        a = r["_on" + e];
      return "function" == typeof n && a.push(t ? { id: o, fn: n, once: t } : { id: o, fn: n }), r;
    },
    off: function (e, n, o) {
      var t = this,
        r = t["_on" + e],
        a = 0;
      if (("number" == typeof n && ((o = n), (n = null)), n || o))
        for (a = 0; a < r.length; a++) {
          var u = o === r[a].id;
          if ((n === r[a].fn && u) || (!n && u)) {
            r.splice(a, 1);
            break;
          }
        }
      else if (e) t["_on" + e] = [];
      else {
        var i = Object.keys(t);
        for (a = 0; a < i.length; a++)
          0 === i[a].indexOf("_on") && Array.isArray(t[i[a]]) && (t[i[a]] = []);
      }
      return t;
    },
    once: function (e, n, o) {
      var t = this;
      return t.on(e, n, o, 1), t;
    },
    _emit: function (e, n, o) {
      for (var t = this, r = t["_on" + e], a = r.length - 1; a >= 0; a--)
        (r[a].id && r[a].id !== n && "load" !== e) ||
          (setTimeout(
            function (e) {
              e.call(this, n, o);
            }.bind(t, r[a].fn),
            0
          ),
          r[a].once && t.off(e, r[a].fn, r[a].id));
      return t._loadQueue(e), t;
    },
    _loadQueue: function (e) {
      var n = this;
      if (n._queue.length > 0) {
        var o = n._queue[0];
        o.event === e && (n._queue.shift(), n._loadQueue()), e || o.action();
      }
      return n;
    },
    _ended: function (e) {
      var o = this,
        t = e._sprite;
      if (
        !o._webAudio &&
        e._node &&
        !e._node.paused &&
        !e._node.ended &&
        e._node.currentTime < e._stop
      )
        return setTimeout(o._ended.bind(o, e), 100), o;
      var r = !(!e._loop && !o._sprite[t][2]);
      if (
        (o._emit("end", e._id),
        !o._webAudio && r && o.stop(e._id, !0).play(e._id),
        o._webAudio && r)
      ) {
        o._emit("play", e._id),
          (e._seek = e._start || 0),
          (e._rateSeek = 0),
          (e._playStart = n.ctx.currentTime);
        var a = (1e3 * (e._stop - e._start)) / Math.abs(e._rate);
        o._endTimers[e._id] = setTimeout(o._ended.bind(o, e), a);
      }
      return (
        o._webAudio &&
          !r &&
          ((e._paused = !0),
          (e._ended = !0),
          (e._seek = e._start || 0),
          (e._rateSeek = 0),
          o._clearTimer(e._id),
          o._cleanBuffer(e._node),
          n._autoSuspend()),
        o._webAudio || r || o.stop(e._id, !0),
        o
      );
    },
    _clearTimer: function (e) {
      var n = this;
      if (n._endTimers[e]) {
        if ("function" != typeof n._endTimers[e]) clearTimeout(n._endTimers[e]);
        else {
          var o = n._soundById(e);
          o && o._node && o._node.removeEventListener("ended", n._endTimers[e], !1);
        }
        delete n._endTimers[e];
      }
      return n;
    },
    _soundById: function (e) {
      for (var n = this, o = 0; o < n._sounds.length; o++)
        if (e === n._sounds[o]._id) return n._sounds[o];
      return null;
    },
    _inactiveSound: function () {
      var e = this;
      e._drain();
      for (var n = 0; n < e._sounds.length; n++)
        if (e._sounds[n]._ended) return e._sounds[n].reset();
      return new t(e);
    },
    _drain: function () {
      var e = this,
        n = e._pool,
        o = 0,
        t = 0;
      if (!(e._sounds.length < n)) {
        for (t = 0; t < e._sounds.length; t++) e._sounds[t]._ended && o++;
        for (t = e._sounds.length - 1; t >= 0; t--) {
          if (o <= n) return;
          e._sounds[t]._ended &&
            (e._webAudio && e._sounds[t]._node && e._sounds[t]._node.disconnect(0),
            e._sounds.splice(t, 1),
            o--);
        }
      }
    },
    _getSoundIds: function (e) {
      var n = this;
      if (void 0 === e) {
        for (var o = [], t = 0; t < n._sounds.length; t++) o.push(n._sounds[t]._id);
        return o;
      }
      return [e];
    },
    _refreshBuffer: function (e) {
      var o = this;
      return (
        (e._node.bufferSource = n.ctx.createBufferSource()),
        (e._node.bufferSource.buffer = r[o._src]),
        e._panner ? e._node.bufferSource.connect(e._panner) : e._node.bufferSource.connect(e._node),
        (e._node.bufferSource.loop = e._loop),
        e._loop &&
          ((e._node.bufferSource.loopStart = e._start || 0),
          (e._node.bufferSource.loopEnd = e._stop || 0)),
        e._node.bufferSource.playbackRate.setValueAtTime(e._rate, n.ctx.currentTime),
        o
      );
    },
    _cleanBuffer: function (e) {
      var o = this,
        t = n._navigator && n._navigator.vendor.indexOf("Apple") >= 0;
      if (
        n._scratchBuffer &&
        e.bufferSource &&
        ((e.bufferSource.onended = null), e.bufferSource.disconnect(0), t)
      )
        try {
          e.bufferSource.buffer = n._scratchBuffer;
        } catch (e) {}
      return (e.bufferSource = null), o;
    },
    _clearSound: function (e) {
      /MSIE |Trident\//.test(n._navigator && n._navigator.userAgent) ||
        (e.src =
          "data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA");
    },
  };
  var t = function (e) {
    (this._parent = e), this.init();
  };
  t.prototype = {
    init: function () {
      var e = this,
        o = e._parent;
      return (
        (e._muted = o._muted),
        (e._loop = o._loop),
        (e._volume = o._volume),
        (e._rate = o._rate),
        (e._seek = 0),
        (e._paused = !0),
        (e._ended = !0),
        (e._sprite = "__default"),
        (e._id = ++n._counter),
        o._sounds.push(e),
        e.create(),
        e
      );
    },
    create: function () {
      var e = this,
        o = e._parent,
        t = n._muted || e._muted || e._parent._muted ? 0 : e._volume;
      return (
        o._webAudio
          ? ((e._node = void 0 === n.ctx.createGain ? n.ctx.createGainNode() : n.ctx.createGain()),
            e._node.gain.setValueAtTime(t, n.ctx.currentTime),
            (e._node.paused = !0),
            e._node.connect(n.masterGain))
          : n.noAudio ||
            ((e._node = n._obtainHtml5Audio()),
            (e._errorFn = e._errorListener.bind(e)),
            e._node.addEventListener("error", e._errorFn, !1),
            (e._loadFn = e._loadListener.bind(e)),
            e._node.addEventListener(n._canPlayEvent, e._loadFn, !1),
            (e._node.src = o._src),
            (e._node.preload = "auto"),
            (e._node.volume = t * n.volume()),
            e._node.load()),
        e
      );
    },
    reset: function () {
      var e = this,
        o = e._parent;
      return (
        (e._muted = o._muted),
        (e._loop = o._loop),
        (e._volume = o._volume),
        (e._rate = o._rate),
        (e._seek = 0),
        (e._rateSeek = 0),
        (e._paused = !0),
        (e._ended = !0),
        (e._sprite = "__default"),
        (e._id = ++n._counter),
        e
      );
    },
    _errorListener: function () {
      var e = this;
      e._parent._emit("loaderror", e._id, e._node.error ? e._node.error.code : 0),
        e._node.removeEventListener("error", e._errorFn, !1);
    },
    _loadListener: function () {
      var e = this,
        o = e._parent;
      (o._duration = Math.ceil(10 * e._node.duration) / 10),
        0 === Object.keys(o._sprite).length && (o._sprite = { __default: [0, 1e3 * o._duration] }),
        "loaded" !== o._state && ((o._state = "loaded"), o._emit("load"), o._loadQueue()),
        e._node.removeEventListener(n._canPlayEvent, e._loadFn, !1);
    },
  };
  var r = {},
    a = function (e) {
      var n = e._src;
      if (r[n]) return (e._duration = r[n].duration), void d(e);
      if (/^data:[^;]+;base64,/.test(n)) {
        for (var o = atob(n.split(",")[1]), t = new Uint8Array(o.length), a = 0; a < o.length; ++a)
          t[a] = o.charCodeAt(a);
        i(t.buffer, e);
      } else {
        var _ = new XMLHttpRequest();
        _.open("GET", n, !0),
          (_.withCredentials = e._xhrWithCredentials),
          (_.responseType = "arraybuffer"),
          (_.onload = function () {
            var n = (_.status + "")[0];
            if ("0" !== n && "2" !== n && "3" !== n)
              return void e._emit(
                "loaderror",
                null,
                "Failed loading audio file with status: " + _.status + "."
              );
            i(_.response, e);
          }),
          (_.onerror = function () {
            e._webAudio &&
              ((e._html5 = !0), (e._webAudio = !1), (e._sounds = []), delete r[n], e.load());
          }),
          u(_);
      }
    },
    u = function (e) {
      try {
        e.send();
      } catch (n) {
        e.onerror();
      }
    },
    i = function (e, o) {
      var t = function () {
          o._emit("loaderror", null, "Decoding audio data failed.");
        },
        a = function (e) {
          e && o._sounds.length > 0 ? ((r[o._src] = e), d(o, e)) : t();
        };
      "undefined" != typeof Promise && 1 === n.ctx.decodeAudioData.length
        ? n.ctx.decodeAudioData(e).then(a).catch(t)
        : n.ctx.decodeAudioData(e, a, t);
    },
    d = function (e, n) {
      n && !e._duration && (e._duration = n.duration),
        0 === Object.keys(e._sprite).length && (e._sprite = { __default: [0, 1e3 * e._duration] }),
        "loaded" !== e._state && ((e._state = "loaded"), e._emit("load"), e._loadQueue());
    },
    _ = function () {
      if (n.usingWebAudio) {
        try {
          "undefined" != typeof AudioContext
            ? (n.ctx = new AudioContext())
            : "undefined" != typeof webkitAudioContext
            ? (n.ctx = new webkitAudioContext())
            : (n.usingWebAudio = !1);
        } catch (e) {
          n.usingWebAudio = !1;
        }
        n.ctx || (n.usingWebAudio = !1);
        var e = /iP(hone|od|ad)/.test(n._navigator && n._navigator.platform),
          o = n._navigator && n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),
          t = o ? parseInt(o[1], 10) : null;
        if (e && t && t < 9) {
          var r = /safari/.test(n._navigator && n._navigator.userAgent.toLowerCase());
          ((n._navigator && n._navigator.standalone && !r) ||
            (n._navigator && !n._navigator.standalone && !r)) &&
            (n.usingWebAudio = !1);
        }
        n.usingWebAudio &&
          ((n.masterGain =
            void 0 === n.ctx.createGain ? n.ctx.createGainNode() : n.ctx.createGain()),
          n.masterGain.gain.setValueAtTime(n._muted ? 0 : n._volume, n.ctx.currentTime),
          n.masterGain.connect(n.ctx.destination)),
          n._setup();
      }
    };
  "function" == typeof define &&
    define.amd &&
    define([], function () {
      return { Howler: n, Howl: o };
    }),
    "undefined" != typeof exports && ((exports.Howler = n), (exports.Howl = o)),
    "undefined" != typeof window
      ? ((window.HowlerGlobal = e), (window.Howler = n), (window.Howl = o), (window.Sound = t))
      : "undefined" != typeof global &&
        ((global.HowlerGlobal = e), (global.Howler = n), (global.Howl = o), (global.Sound = t));
})();
/*! Spatial Plugin */
!(function () {
  "use strict";
  (HowlerGlobal.prototype._pos = [0, 0, 0]),
    (HowlerGlobal.prototype._orientation = [0, 0, -1, 0, 1, 0]),
    (HowlerGlobal.prototype.stereo = function (e) {
      var n = this;
      if (!n.ctx || !n.ctx.listener) return n;
      for (var t = n._howls.length - 1; t >= 0; t--) n._howls[t].stereo(e);
      return n;
    }),
    (HowlerGlobal.prototype.pos = function (e, n, t) {
      var r = this;
      return r.ctx && r.ctx.listener
        ? ((n = "number" != typeof n ? r._pos[1] : n),
          (t = "number" != typeof t ? r._pos[2] : t),
          "number" != typeof e
            ? r._pos
            : ((r._pos = [e, n, t]),
              void 0 !== r.ctx.listener.positionX
                ? (r.ctx.listener.positionX.setTargetAtTime(r._pos[0], Howler.ctx.currentTime, 0.1),
                  r.ctx.listener.positionY.setTargetAtTime(r._pos[1], Howler.ctx.currentTime, 0.1),
                  r.ctx.listener.positionZ.setTargetAtTime(r._pos[2], Howler.ctx.currentTime, 0.1))
                : r.ctx.listener.setPosition(r._pos[0], r._pos[1], r._pos[2]),
              r))
        : r;
    }),
    (HowlerGlobal.prototype.orientation = function (e, n, t, r, o, i) {
      var a = this;
      if (!a.ctx || !a.ctx.listener) return a;
      var s = a._orientation;
      return (
        (n = "number" != typeof n ? s[1] : n),
        (t = "number" != typeof t ? s[2] : t),
        (r = "number" != typeof r ? s[3] : r),
        (o = "number" != typeof o ? s[4] : o),
        (i = "number" != typeof i ? s[5] : i),
        "number" != typeof e
          ? s
          : ((a._orientation = [e, n, t, r, o, i]),
            void 0 !== a.ctx.listener.forwardX
              ? (a.ctx.listener.forwardX.setTargetAtTime(e, Howler.ctx.currentTime, 0.1),
                a.ctx.listener.forwardY.setTargetAtTime(n, Howler.ctx.currentTime, 0.1),
                a.ctx.listener.forwardZ.setTargetAtTime(t, Howler.ctx.currentTime, 0.1),
                a.ctx.listener.upX.setTargetAtTime(r, Howler.ctx.currentTime, 0.1),
                a.ctx.listener.upY.setTargetAtTime(o, Howler.ctx.currentTime, 0.1),
                a.ctx.listener.upZ.setTargetAtTime(i, Howler.ctx.currentTime, 0.1))
              : a.ctx.listener.setOrientation(e, n, t, r, o, i),
            a)
      );
    }),
    (Howl.prototype.init = (function (e) {
      return function (n) {
        var t = this;
        return (
          (t._orientation = n.orientation || [1, 0, 0]),
          (t._stereo = n.stereo || null),
          (t._pos = n.pos || null),
          (t._pannerAttr = {
            coneInnerAngle: void 0 !== n.coneInnerAngle ? n.coneInnerAngle : 360,
            coneOuterAngle: void 0 !== n.coneOuterAngle ? n.coneOuterAngle : 360,
            coneOuterGain: void 0 !== n.coneOuterGain ? n.coneOuterGain : 0,
            distanceModel: void 0 !== n.distanceModel ? n.distanceModel : "inverse",
            maxDistance: void 0 !== n.maxDistance ? n.maxDistance : 1e4,
            panningModel: void 0 !== n.panningModel ? n.panningModel : "HRTF",
            refDistance: void 0 !== n.refDistance ? n.refDistance : 1,
            rolloffFactor: void 0 !== n.rolloffFactor ? n.rolloffFactor : 1,
          }),
          (t._onstereo = n.onstereo ? [{ fn: n.onstereo }] : []),
          (t._onpos = n.onpos ? [{ fn: n.onpos }] : []),
          (t._onorientation = n.onorientation ? [{ fn: n.onorientation }] : []),
          e.call(this, n)
        );
      };
    })(Howl.prototype.init)),
    (Howl.prototype.stereo = function (n, t) {
      var r = this;
      if (!r._webAudio) return r;
      if ("loaded" !== r._state)
        return (
          r._queue.push({
            event: "stereo",
            action: function () {
              r.stereo(n, t);
            },
          }),
          r
        );
      var o = void 0 === Howler.ctx.createStereoPanner ? "spatial" : "stereo";
      if (void 0 === t) {
        if ("number" != typeof n) return r._stereo;
        (r._stereo = n), (r._pos = [n, 0, 0]);
      }
      for (var i = r._getSoundIds(t), a = 0; a < i.length; a++) {
        var s = r._soundById(i[a]);
        if (s) {
          if ("number" != typeof n) return s._stereo;
          (s._stereo = n),
            (s._pos = [n, 0, 0]),
            s._node &&
              ((s._pannerAttr.panningModel = "equalpower"),
              (s._panner && s._panner.pan) || e(s, o),
              "spatial" === o
                ? void 0 !== s._panner.positionX
                  ? (s._panner.positionX.setValueAtTime(n, Howler.ctx.currentTime),
                    s._panner.positionY.setValueAtTime(0, Howler.ctx.currentTime),
                    s._panner.positionZ.setValueAtTime(0, Howler.ctx.currentTime))
                  : s._panner.setPosition(n, 0, 0)
                : s._panner.pan.setValueAtTime(n, Howler.ctx.currentTime)),
            r._emit("stereo", s._id);
        }
      }
      return r;
    }),
    (Howl.prototype.pos = function (n, t, r, o) {
      var i = this;
      if (!i._webAudio) return i;
      if ("loaded" !== i._state)
        return (
          i._queue.push({
            event: "pos",
            action: function () {
              i.pos(n, t, r, o);
            },
          }),
          i
        );
      if (
        ((t = "number" != typeof t ? 0 : t), (r = "number" != typeof r ? -0.5 : r), void 0 === o)
      ) {
        if ("number" != typeof n) return i._pos;
        i._pos = [n, t, r];
      }
      for (var a = i._getSoundIds(o), s = 0; s < a.length; s++) {
        var p = i._soundById(a[s]);
        if (p) {
          if ("number" != typeof n) return p._pos;
          (p._pos = [n, t, r]),
            p._node &&
              ((p._panner && !p._panner.pan) || e(p, "spatial"),
              void 0 !== p._panner.positionX
                ? (p._panner.positionX.setValueAtTime(n, Howler.ctx.currentTime),
                  p._panner.positionY.setValueAtTime(t, Howler.ctx.currentTime),
                  p._panner.positionZ.setValueAtTime(r, Howler.ctx.currentTime))
                : p._panner.setPosition(n, t, r)),
            i._emit("pos", p._id);
        }
      }
      return i;
    }),
    (Howl.prototype.orientation = function (n, t, r, o) {
      var i = this;
      if (!i._webAudio) return i;
      if ("loaded" !== i._state)
        return (
          i._queue.push({
            event: "orientation",
            action: function () {
              i.orientation(n, t, r, o);
            },
          }),
          i
        );
      if (
        ((t = "number" != typeof t ? i._orientation[1] : t),
        (r = "number" != typeof r ? i._orientation[2] : r),
        void 0 === o)
      ) {
        if ("number" != typeof n) return i._orientation;
        i._orientation = [n, t, r];
      }
      for (var a = i._getSoundIds(o), s = 0; s < a.length; s++) {
        var p = i._soundById(a[s]);
        if (p) {
          if ("number" != typeof n) return p._orientation;
          (p._orientation = [n, t, r]),
            p._node &&
              (p._panner || (p._pos || (p._pos = i._pos || [0, 0, -0.5]), e(p, "spatial")),
              void 0 !== p._panner.orientationX
                ? (p._panner.orientationX.setValueAtTime(n, Howler.ctx.currentTime),
                  p._panner.orientationY.setValueAtTime(t, Howler.ctx.currentTime),
                  p._panner.orientationZ.setValueAtTime(r, Howler.ctx.currentTime))
                : p._panner.setOrientation(n, t, r)),
            i._emit("orientation", p._id);
        }
      }
      return i;
    }),
    (Howl.prototype.pannerAttr = function () {
      var n,
        t,
        r,
        o = this,
        i = arguments;
      if (!o._webAudio) return o;
      if (0 === i.length) return o._pannerAttr;
      if (1 === i.length) {
        if ("object" != typeof i[0])
          return (r = o._soundById(parseInt(i[0], 10))), r ? r._pannerAttr : o._pannerAttr;
        (n = i[0]),
          void 0 === t &&
            (n.pannerAttr ||
              (n.pannerAttr = {
                coneInnerAngle: n.coneInnerAngle,
                coneOuterAngle: n.coneOuterAngle,
                coneOuterGain: n.coneOuterGain,
                distanceModel: n.distanceModel,
                maxDistance: n.maxDistance,
                refDistance: n.refDistance,
                rolloffFactor: n.rolloffFactor,
                panningModel: n.panningModel,
              }),
            (o._pannerAttr = {
              coneInnerAngle:
                void 0 !== n.pannerAttr.coneInnerAngle
                  ? n.pannerAttr.coneInnerAngle
                  : o._coneInnerAngle,
              coneOuterAngle:
                void 0 !== n.pannerAttr.coneOuterAngle
                  ? n.pannerAttr.coneOuterAngle
                  : o._coneOuterAngle,
              coneOuterGain:
                void 0 !== n.pannerAttr.coneOuterGain
                  ? n.pannerAttr.coneOuterGain
                  : o._coneOuterGain,
              distanceModel:
                void 0 !== n.pannerAttr.distanceModel
                  ? n.pannerAttr.distanceModel
                  : o._distanceModel,
              maxDistance:
                void 0 !== n.pannerAttr.maxDistance ? n.pannerAttr.maxDistance : o._maxDistance,
              refDistance:
                void 0 !== n.pannerAttr.refDistance ? n.pannerAttr.refDistance : o._refDistance,
              rolloffFactor:
                void 0 !== n.pannerAttr.rolloffFactor
                  ? n.pannerAttr.rolloffFactor
                  : o._rolloffFactor,
              panningModel:
                void 0 !== n.pannerAttr.panningModel ? n.pannerAttr.panningModel : o._panningModel,
            }));
      } else 2 === i.length && ((n = i[0]), (t = parseInt(i[1], 10)));
      for (var a = o._getSoundIds(t), s = 0; s < a.length; s++)
        if ((r = o._soundById(a[s]))) {
          var p = r._pannerAttr;
          p = {
            coneInnerAngle: void 0 !== n.coneInnerAngle ? n.coneInnerAngle : p.coneInnerAngle,
            coneOuterAngle: void 0 !== n.coneOuterAngle ? n.coneOuterAngle : p.coneOuterAngle,
            coneOuterGain: void 0 !== n.coneOuterGain ? n.coneOuterGain : p.coneOuterGain,
            distanceModel: void 0 !== n.distanceModel ? n.distanceModel : p.distanceModel,
            maxDistance: void 0 !== n.maxDistance ? n.maxDistance : p.maxDistance,
            refDistance: void 0 !== n.refDistance ? n.refDistance : p.refDistance,
            rolloffFactor: void 0 !== n.rolloffFactor ? n.rolloffFactor : p.rolloffFactor,
            panningModel: void 0 !== n.panningModel ? n.panningModel : p.panningModel,
          };
          var c = r._panner;
          c
            ? ((c.coneInnerAngle = p.coneInnerAngle),
              (c.coneOuterAngle = p.coneOuterAngle),
              (c.coneOuterGain = p.coneOuterGain),
              (c.distanceModel = p.distanceModel),
              (c.maxDistance = p.maxDistance),
              (c.refDistance = p.refDistance),
              (c.rolloffFactor = p.rolloffFactor),
              (c.panningModel = p.panningModel))
            : (r._pos || (r._pos = o._pos || [0, 0, -0.5]), e(r, "spatial"));
        }
      return o;
    }),
    (Sound.prototype.init = (function (e) {
      return function () {
        var n = this,
          t = n._parent;
        (n._orientation = t._orientation),
          (n._stereo = t._stereo),
          (n._pos = t._pos),
          (n._pannerAttr = t._pannerAttr),
          e.call(this),
          n._stereo ? t.stereo(n._stereo) : n._pos && t.pos(n._pos[0], n._pos[1], n._pos[2], n._id);
      };
    })(Sound.prototype.init)),
    (Sound.prototype.reset = (function (e) {
      return function () {
        var n = this,
          t = n._parent;
        return (
          (n._orientation = t._orientation),
          (n._stereo = t._stereo),
          (n._pos = t._pos),
          (n._pannerAttr = t._pannerAttr),
          n._stereo
            ? t.stereo(n._stereo)
            : n._pos
            ? t.pos(n._pos[0], n._pos[1], n._pos[2], n._id)
            : n._panner && (n._panner.disconnect(0), (n._panner = void 0), t._refreshBuffer(n)),
          e.call(this)
        );
      };
    })(Sound.prototype.reset));
  var e = function (e, n) {
    (n = n || "spatial"),
      "spatial" === n
        ? ((e._panner = Howler.ctx.createPanner()),
          (e._panner.coneInnerAngle = e._pannerAttr.coneInnerAngle),
          (e._panner.coneOuterAngle = e._pannerAttr.coneOuterAngle),
          (e._panner.coneOuterGain = e._pannerAttr.coneOuterGain),
          (e._panner.distanceModel = e._pannerAttr.distanceModel),
          (e._panner.maxDistance = e._pannerAttr.maxDistance),
          (e._panner.refDistance = e._pannerAttr.refDistance),
          (e._panner.rolloffFactor = e._pannerAttr.rolloffFactor),
          (e._panner.panningModel = e._pannerAttr.panningModel),
          void 0 !== e._panner.positionX
            ? (e._panner.positionX.setValueAtTime(e._pos[0], Howler.ctx.currentTime),
              e._panner.positionY.setValueAtTime(e._pos[1], Howler.ctx.currentTime),
              e._panner.positionZ.setValueAtTime(e._pos[2], Howler.ctx.currentTime))
            : e._panner.setPosition(e._pos[0], e._pos[1], e._pos[2]),
          void 0 !== e._panner.orientationX
            ? (e._panner.orientationX.setValueAtTime(e._orientation[0], Howler.ctx.currentTime),
              e._panner.orientationY.setValueAtTime(e._orientation[1], Howler.ctx.currentTime),
              e._panner.orientationZ.setValueAtTime(e._orientation[2], Howler.ctx.currentTime))
            : e._panner.setOrientation(e._orientation[0], e._orientation[1], e._orientation[2]))
        : ((e._panner = Howler.ctx.createStereoPanner()),
          e._panner.pan.setValueAtTime(e._stereo, Howler.ctx.currentTime)),
      e._panner.connect(e._node),
      e._paused || e._parent.pause(e._id, !0).play(e._id, !0);
  };
})();
!(function (t, i) {
  "object" == typeof exports && "undefined" != typeof module
    ? (module.exports = i())
    : "function" == typeof define && define.amd
    ? define(i)
    : ((t = "undefined" != typeof globalThis ? globalThis : t || self).Flatbush = i());
})(this, function () {
  "use strict";
  var t = function () {
    (this.ids = []), (this.values = []), (this.length = 0);
  };
  (t.prototype.clear = function () {
    this.length = 0;
  }),
    (t.prototype.push = function (t, i) {
      var s = this.length++;
      for (this.ids[s] = t, this.values[s] = i; s > 0; ) {
        var e = (s - 1) >> 1,
          h = this.values[e];
        if (i >= h) break;
        (this.ids[s] = this.ids[e]), (this.values[s] = h), (s = e);
      }
      (this.ids[s] = t), (this.values[s] = i);
    }),
    (t.prototype.pop = function () {
      if (0 !== this.length) {
        var t = this.ids[0];
        if ((this.length--, this.length > 0)) {
          for (
            var i = (this.ids[0] = this.ids[this.length]),
              s = (this.values[0] = this.values[this.length]),
              e = this.length >> 1,
              h = 0;
            h < e;

          ) {
            var r = 1 + (h << 1),
              n = r + 1,
              o = this.ids[r],
              a = this.values[r],
              u = this.values[n];
            if ((n < this.length && u < a && ((r = n), (o = this.ids[n]), (a = u)), a >= s)) break;
            (this.ids[h] = o), (this.values[h] = a), (h = r);
          }
          (this.ids[h] = i), (this.values[h] = s);
        }
        return t;
      }
    }),
    (t.prototype.peek = function () {
      if (0 !== this.length) return this.ids[0];
    }),
    (t.prototype.peekValue = function () {
      if (0 !== this.length) return this.values[0];
    });
  var i = [
      Int8Array,
      Uint8Array,
      Uint8ClampedArray,
      Int16Array,
      Uint16Array,
      Int32Array,
      Uint32Array,
      Float32Array,
      Float64Array,
    ],
    s = function (s, e, h, r) {
      if ((void 0 === e && (e = 16), void 0 === h && (h = Float64Array), void 0 === s))
        throw new Error("Missing required argument: numItems.");
      if (isNaN(s) || s <= 0) throw new Error("Unpexpected numItems value: " + s + ".");
      (this.numItems = +s), (this.nodeSize = Math.min(Math.max(+e, 2), 65535));
      var n = s,
        o = n;
      this._levelBounds = [4 * n];
      do {
        (o += n = Math.ceil(n / this.nodeSize)), this._levelBounds.push(4 * o);
      } while (1 !== n);
      (this.ArrayType = h || Float64Array),
        (this.IndexArrayType = o < 16384 ? Uint16Array : Uint32Array);
      var a = i.indexOf(this.ArrayType),
        u = 4 * o * this.ArrayType.BYTES_PER_ELEMENT;
      if (a < 0) throw new Error("Unexpected typed array class: " + h + ".");
      r && r instanceof ArrayBuffer
        ? ((this.data = r),
          (this._boxes = new this.ArrayType(this.data, 8, 4 * o)),
          (this._indices = new this.IndexArrayType(this.data, 8 + u, o)),
          (this._pos = 4 * o),
          (this.minX = this._boxes[this._pos - 4]),
          (this.minY = this._boxes[this._pos - 3]),
          (this.maxX = this._boxes[this._pos - 2]),
          (this.maxY = this._boxes[this._pos - 1]))
        : ((this.data = new ArrayBuffer(8 + u + o * this.IndexArrayType.BYTES_PER_ELEMENT)),
          (this._boxes = new this.ArrayType(this.data, 8, 4 * o)),
          (this._indices = new this.IndexArrayType(this.data, 8 + u, o)),
          (this._pos = 0),
          (this.minX = 1 / 0),
          (this.minY = 1 / 0),
          (this.maxX = -1 / 0),
          (this.maxY = -1 / 0),
          new Uint8Array(this.data, 0, 2).set([251, 48 + a]),
          (new Uint16Array(this.data, 2, 1)[0] = e),
          (new Uint32Array(this.data, 4, 1)[0] = s)),
        (this._queue = new t());
    };
  function e(t, i, s) {
    return t < i ? i - t : t <= s ? 0 : t - s;
  }
  function h(t, i) {
    for (var s = 0, e = i.length - 1; s < e; ) {
      var h = (s + e) >> 1;
      i[h] > t ? (e = h) : (s = h + 1);
    }
    return i[s];
  }
  function r(t, i, s, e, h, o) {
    if (!(Math.floor(e / o) >= Math.floor(h / o))) {
      for (var a = t[(e + h) >> 1], u = e - 1, d = h + 1; ; ) {
        do {
          u++;
        } while (t[u] < a);
        do {
          d--;
        } while (t[d] > a);
        if (u >= d) break;
        n(t, i, s, u, d);
      }
      r(t, i, s, e, d, o), r(t, i, s, d + 1, h, o);
    }
  }
  function n(t, i, s, e, h) {
    var r = t[e];
    (t[e] = t[h]), (t[h] = r);
    var n = 4 * e,
      o = 4 * h,
      a = i[n],
      u = i[n + 1],
      d = i[n + 2],
      p = i[n + 3];
    (i[n] = i[o]),
      (i[n + 1] = i[o + 1]),
      (i[n + 2] = i[o + 2]),
      (i[n + 3] = i[o + 3]),
      (i[o] = a),
      (i[o + 1] = u),
      (i[o + 2] = d),
      (i[o + 3] = p);
    var f = s[e];
    (s[e] = s[h]), (s[h] = f);
  }
  function o(t, i) {
    var s = t ^ i,
      e = 65535 ^ s,
      h = 65535 ^ (t | i),
      r = t & (65535 ^ i),
      n = s | (e >> 1),
      o = (s >> 1) ^ s,
      a = (h >> 1) ^ (e & (r >> 1)) ^ h,
      u = (s & (h >> 1)) ^ (r >> 1) ^ r;
    (o = ((s = n) & ((e = o) >> 2)) ^ (e & ((s ^ e) >> 2))),
      (a ^= (s & ((h = a) >> 2)) ^ (e & ((r = u) >> 2))),
      (u ^= (e & (h >> 2)) ^ ((s ^ e) & (r >> 2))),
      (o = ((s = n = (s & (s >> 2)) ^ (e & (e >> 2))) & ((e = o) >> 4)) ^ (e & ((s ^ e) >> 4))),
      (a ^= (s & ((h = a) >> 4)) ^ (e & ((r = u) >> 4))),
      (u ^= (e & (h >> 4)) ^ ((s ^ e) & (r >> 4))),
      (a ^=
        ((s = n = (s & (s >> 4)) ^ (e & (e >> 4))) & ((h = a) >> 8)) ^ ((e = o) & ((r = u) >> 8)));
    var d = t ^ i,
      p =
        (e = (u ^= (e & (h >> 8)) ^ ((s ^ e) & (r >> 8))) ^ (u >> 1)) |
        (65535 ^ (d | (s = a ^ (a >> 1))));
    return (
      (((p =
        1431655765 &
        ((p =
          858993459 & ((p = 252645135 & ((p = 16711935 & (p | (p << 8))) | (p << 4))) | (p << 2))) |
          (p << 1))) <<
        1) |
        (d =
          1431655765 &
          ((d =
            858993459 &
            ((d = 252645135 & ((d = 16711935 & (d | (d << 8))) | (d << 4))) | (d << 2))) |
            (d << 1)))) >>>
      0
    );
  }
  return (
    (s.from = function (t) {
      if (!(t instanceof ArrayBuffer)) throw new Error("Data must be an instance of ArrayBuffer.");
      var e = new Uint8Array(t, 0, 2),
        h = e[0],
        r = e[1];
      if (251 !== h) throw new Error("Data does not appear to be in a Flatbush format.");
      if (r >> 4 != 3) throw new Error("Got v" + (r >> 4) + " data when expected v3.");
      var n = new Uint16Array(t, 2, 1)[0],
        o = new Uint32Array(t, 4, 1)[0];
      return new s(o, n, i[15 & r], t);
    }),
    (s.prototype.add = function (t, i, s, e) {
      var h = this._pos >> 2;
      return (
        (this._indices[h] = h),
        (this._boxes[this._pos++] = t),
        (this._boxes[this._pos++] = i),
        (this._boxes[this._pos++] = s),
        (this._boxes[this._pos++] = e),
        t < this.minX && (this.minX = t),
        i < this.minY && (this.minY = i),
        s > this.maxX && (this.maxX = s),
        e > this.maxY && (this.maxY = e),
        h
      );
    }),
    (s.prototype.finish = function () {
      if (this._pos >> 2 !== this.numItems)
        throw new Error(
          "Added " + (this._pos >> 2) + " items when expected " + this.numItems + "."
        );
      if (this.numItems <= this.nodeSize)
        return (
          (this._boxes[this._pos++] = this.minX),
          (this._boxes[this._pos++] = this.minY),
          (this._boxes[this._pos++] = this.maxX),
          void (this._boxes[this._pos++] = this.maxY)
        );
      for (
        var t = this.maxX - this.minX || 1,
          i = this.maxY - this.minY || 1,
          s = new Uint32Array(this.numItems),
          e = 0;
        e < this.numItems;
        e++
      ) {
        var h = 4 * e,
          n = this._boxes[h++],
          a = this._boxes[h++],
          u = this._boxes[h++],
          d = this._boxes[h++],
          p = Math.floor((65535 * ((n + u) / 2 - this.minX)) / t),
          f = Math.floor((65535 * ((a + d) / 2 - this.minY)) / i);
        s[e] = o(p, f);
      }
      r(s, this._boxes, this._indices, 0, this.numItems - 1, this.nodeSize);
      for (var _ = 0, l = 0; _ < this._levelBounds.length - 1; _++)
        for (var x = this._levelBounds[_]; l < x; ) {
          for (
            var m = l, v = 1 / 0, y = 1 / 0, b = -1 / 0, c = -1 / 0, w = 0;
            w < this.nodeSize && l < x;
            w++
          )
            (v = Math.min(v, this._boxes[l++])),
              (y = Math.min(y, this._boxes[l++])),
              (b = Math.max(b, this._boxes[l++])),
              (c = Math.max(c, this._boxes[l++]));
          (this._indices[this._pos >> 2] = m),
            (this._boxes[this._pos++] = v),
            (this._boxes[this._pos++] = y),
            (this._boxes[this._pos++] = b),
            (this._boxes[this._pos++] = c);
        }
    }),
    (s.prototype.search = function (t, i, s, e, r) {
      if (this._pos !== this._boxes.length)
        throw new Error("Data not yet indexed - call index.finish().");
      for (var n = this._boxes.length - 4, o = [], a = []; void 0 !== n; ) {
        for (
          var u = Math.min(n + 4 * this.nodeSize, h(n, this._levelBounds)), d = n;
          d < u;
          d += 4
        ) {
          var p = 0 | this._indices[d >> 2];
          s < this._boxes[d] ||
            e < this._boxes[d + 1] ||
            t > this._boxes[d + 2] ||
            i > this._boxes[d + 3] ||
            (n < 4 * this.numItems ? (void 0 === r || r(p)) && a.push(p) : o.push(p));
        }
        n = o.pop();
      }
      return a;
    }),
    (s.prototype.neighbors = function (t, i, s, r, n) {
      if (
        (void 0 === s && (s = 1 / 0), void 0 === r && (r = 1 / 0), this._pos !== this._boxes.length)
      )
        throw new Error("Data not yet indexed - call index.finish().");
      for (var o = this._boxes.length - 4, a = this._queue, u = [], d = r * r; void 0 !== o; ) {
        for (
          var p = Math.min(o + 4 * this.nodeSize, h(o, this._levelBounds)), f = o;
          f < p;
          f += 4
        ) {
          var _ = 0 | this._indices[f >> 2],
            l = e(t, this._boxes[f], this._boxes[f + 2]),
            x = e(i, this._boxes[f + 1], this._boxes[f + 3]),
            m = l * l + x * x;
          o < 4 * this.numItems
            ? (void 0 === n || n(_)) && a.push(1 + (_ << 1), m)
            : a.push(_ << 1, m);
        }
        for (; a.length && 1 & a.peek(); ) {
          if (a.peekValue() > d) return a.clear(), u;
          if ((u.push(a.pop() >> 1), u.length === s)) return a.clear(), u;
        }
        o = a.pop() >> 1;
      }
      return a.clear(), u;
    }),
    s
  );
});
("use strict");
var LZString = (function () {
  let c = String.fromCharCode,
    d = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
    e = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",
    f = {},
    g = new Array(2097152),
    a = new Array(1048576);
  function h(a, c) {
    if (!f[a]) {
      f[a] = {};
      for (var b = 0; b < a.length; b++) f[a][a[b]] = b;
    }
    return f[a][c];
  }
  (a[0] = 0), (a[1] = 1), (a[2] = 2);
  var b = {
    compressToBase64: function (c) {
      if (null == c) return "";
      var a = b._compress(c, 6, function (a) {
        return d[a];
      });
      switch (a.length % 4) {
        default:
        case 0:
          return a;
        case 1:
          return a + "===";
        case 2:
          return a + "==";
        case 3:
          return a + "=";
      }
    },
    decompressFromBase64: function (a) {
      return null == a
        ? ""
        : "" == a
        ? null
        : b._decompress(a.length, 32, function (b) {
            return h(d, a[b]);
          });
    },
    compressToUTF16: function (a) {
      return null == a
        ? ""
        : b._compress(a, 15, function (a) {
            return c(a + 32);
          }) + " ";
    },
    decompressFromUTF16: function (a) {
      return null == a
        ? ""
        : "" == a
        ? null
        : b._decompress(a.length, 16384, function (b) {
            return a.charCodeAt(b) - 32;
          });
    },
    compressToUint8Array: function (f) {
      for (
        var c = b.compress(f), d = new Uint8Array(2 * c.length), a = 0, g = c.length;
        a < g;
        a++
      ) {
        var e = c.charCodeAt(a);
        (d[2 * a] = e >>> 8), (d[2 * a + 1] = e % 256);
      }
      return d;
    },
    decompressFromUint8Array: function (a) {
      if (null == a) return b.decompress(a);
      {
        let d = new Array(a.length / 2);
        for (var c = 0, e = d.length; c < e; c++)
          d[c] = String.fromCharCode(256 * a[2 * c] + a[2 * c + 1]);
        return b.decompress(d.join(""));
      }
    },
    decompressFromUint8Array_Fast: function (a) {
      let d = new Uint16Array(a.buffer, 0, a.length / 2);
      for (let c = 0, e = d.length; c < e; c++) d[c] = 256 * a[2 * c] + a[2 * c + 1];
      return b._decompress2(a.length, d);
    },
    _decompress2: function (r, j) {
      a.fill(0, 3, 1.5 * r);
      let k = 4,
        m = 4,
        n = 3,
        o = "",
        p,
        c,
        e,
        f,
        b,
        i,
        q = 0,
        h = j[0],
        d = 32768,
        l = 1;
      for (c = 0, f = 4, b = 1; b !== f; )
        (e = h & d),
          0 == (d >>= 1) && ((d = 32768), (h = j[l++])),
          (c |= (e > 0 ? 1 : 0) * b),
          (b <<= 1);
      if (0 === c) {
        for (c = 0, f = 256, b = 1; b != f; )
          (e = h & d),
            0 == (d >>= 1) && ((d = 32768), (h = j[l++])),
            (c |= (e > 0 ? 1 : 0) * b),
            (b <<= 1);
        i = String.fromCharCode(c);
      } else if (1 === c) {
        for (c = 0, f = 65536, b = 1; b != f; )
          (e = h & d),
            0 == (d >>= 1) && ((d = 32768), (h = j[l++])),
            (c |= (e > 0 ? 1 : 0) * b),
            (b <<= 1);
        i = String.fromCharCode(c);
      } else if (2 === c) return "";
      for (a[3] = i, p = i, g[q++] = i; ; ) {
        if (l > r) return "";
        for (c = 0, f = Math.pow(2, n), b = 1; b != f; )
          (e = h & d),
            0 == (d >>= 1) && ((d = 32768), (h = j[l++])),
            (c |= (e > 0 ? 1 : 0) * b),
            (b <<= 1);
        if (((i = c), 0 === c)) {
          for (c = 0, f = 256, b = 1; b !== f; )
            (e = h & d),
              0 == (d >>= 1) && ((d = 32768), (h = j[l++])),
              (c |= (e > 0 ? 1 : 0) * b),
              (b <<= 1);
          (a[m++] = String.fromCharCode(c)), (i = m - 1), k--;
        } else if (1 === c) {
          for (c = 0, f = 65536, b = 1; b != f; )
            (e = h & d),
              0 == (d >>= 1) && ((d = 32768), (h = j[l++])),
              (c |= (e > 0 ? 1 : 0) * b),
              (b <<= 1);
          (a[m++] = String.fromCharCode(c)), (i = m - 1), k--;
        } else if (2 === c) return g.slice(0, q).join("");
        if ((0 === k && ((k = Math.pow(2, n)), n++), a[i])) o = a[i];
        else {
          if (i !== m) return null;
          o = p + p[0];
        }
        (g[q++] = o), (a[m++] = p + o[0]), k--, (p = o), 0 === k && ((k = Math.pow(2, n)), n++);
      }
    },
    decompress: function (a) {
      return null == a
        ? ""
        : "" == a
        ? null
        : b._decompress(a.length, 32768, function (b) {
            return a.charCodeAt(b);
          });
    },
    compressToEncodedURIComponent: function (a) {
      return null == a
        ? ""
        : b._compress(a, 6, function (a) {
            return e[a];
          });
    },
    decompressFromEncodedURIComponent: function (a) {
      return null == a
        ? ""
        : "" == a
        ? null
        : ((a = a.replace(/ /g, "+")),
          b._decompress(a.length, 32, function (b) {
            return h(e, a[b]);
          }));
    },
    compress: function (a) {
      return b._compress(a, 16, function (a) {
        return c(a);
      });
    },
    _compress: function (p, h, i) {
      if (null == p) return "";
      var c,
        d,
        n,
        k = {},
        m = {},
        l = "",
        o = "",
        e = "",
        j = 2,
        q = 3,
        f = 2,
        g = [],
        a = 0,
        b = 0;
      for (n = 0; n < p.length; n += 1)
        if (
          ((l = p[n]),
          Object.prototype.hasOwnProperty.call(k, l) || ((k[l] = q++), (m[l] = !0)),
          (o = e + l),
          Object.prototype.hasOwnProperty.call(k, o))
        )
          e = o;
        else {
          if (Object.prototype.hasOwnProperty.call(m, e)) {
            if (256 > e.charCodeAt(0)) {
              for (c = 0; c < f; c++)
                (a <<= 1), b == h - 1 ? ((b = 0), g.push(i(a)), (a = 0)) : b++;
              for (c = 0, d = e.charCodeAt(0); c < 8; c++)
                (a = (a << 1) | (1 & d)),
                  b == h - 1 ? ((b = 0), g.push(i(a)), (a = 0)) : b++,
                  (d >>= 1);
            } else {
              for (c = 0, d = 1; c < f; c++)
                (a = (a << 1) | d), b == h - 1 ? ((b = 0), g.push(i(a)), (a = 0)) : b++, (d = 0);
              for (c = 0, d = e.charCodeAt(0); c < 16; c++)
                (a = (a << 1) | (1 & d)),
                  b == h - 1 ? ((b = 0), g.push(i(a)), (a = 0)) : b++,
                  (d >>= 1);
            }
            0 == --j && ((j = Math.pow(2, f)), f++), delete m[e];
          } else
            for (c = 0, d = k[e]; c < f; c++)
              (a = (a << 1) | (1 & d)),
                b == h - 1 ? ((b = 0), g.push(i(a)), (a = 0)) : b++,
                (d >>= 1);
          0 == --j && ((j = Math.pow(2, f)), f++), (k[o] = q++), (e = String(l));
        }
      if ("" !== e) {
        if (Object.prototype.hasOwnProperty.call(m, e)) {
          if (256 > e.charCodeAt(0)) {
            for (c = 0; c < f; c++) (a <<= 1), b == h - 1 ? ((b = 0), g.push(i(a)), (a = 0)) : b++;
            for (c = 0, d = e.charCodeAt(0); c < 8; c++)
              (a = (a << 1) | (1 & d)),
                b == h - 1 ? ((b = 0), g.push(i(a)), (a = 0)) : b++,
                (d >>= 1);
          } else {
            for (c = 0, d = 1; c < f; c++)
              (a = (a << 1) | d), b == h - 1 ? ((b = 0), g.push(i(a)), (a = 0)) : b++, (d = 0);
            for (c = 0, d = e.charCodeAt(0); c < 16; c++)
              (a = (a << 1) | (1 & d)),
                b == h - 1 ? ((b = 0), g.push(i(a)), (a = 0)) : b++,
                (d >>= 1);
          }
          0 == --j && ((j = Math.pow(2, f)), f++), delete m[e];
        } else
          for (c = 0, d = k[e]; c < f; c++)
            (a = (a << 1) | (1 & d)),
              b == h - 1 ? ((b = 0), g.push(i(a)), (a = 0)) : b++,
              (d >>= 1);
        0 == --j && ((j = Math.pow(2, f)), f++);
      }
      for (c = 0, d = 2; c < f; c++)
        (a = (a << 1) | (1 & d)), b == h - 1 ? ((b = 0), g.push(i(a)), (a = 0)) : b++, (d >>= 1);
      for (;;) {
        if (((a <<= 1), b == h - 1)) {
          g.push(i(a));
          break;
        }
        b++;
      }
      return g.join("");
    },
    compressToUint8Array_Fast: function (o, e, p) {
      let c,
        d,
        j = {},
        k = {},
        l = "",
        n = "",
        g = "",
        i = 2,
        q = 3,
        h = 2,
        a = 0,
        f = 0,
        b = p,
        m;
      for (m = 0; m < o.length; m += 1)
        if ((void 0 === j[(l = o[m])] && ((j[l] = q++), (k[l] = !0)), void 0 !== j[(n = g + l)]))
          g = n;
        else {
          if (void 0 !== k[g]) {
            if (256 > g.charCodeAt(0)) {
              for (c = 0; c < h; c++)
                (a <<= 1),
                  15 == f++ && ((f = 0), (e[b] = a >>> 8), (e[b + 1] = a % 256), (b += 2), (a = 0));
              for (c = 0, d = g.charCodeAt(0); c < 8; c++)
                (a = (a << 1) | (1 & d)),
                  15 == f++ && ((f = 0), (e[b] = a >>> 8), (e[b + 1] = a % 256), (b += 2), (a = 0)),
                  (d >>= 1);
            } else {
              for (c = 0, d = 1; c < h; c++)
                (a = (a << 1) | d),
                  15 == f++ && ((f = 0), (e[b] = a >>> 8), (e[b + 1] = a % 256), (b += 2), (a = 0)),
                  (d = 0);
              for (c = 0, d = g.charCodeAt(0); c < 16; c++)
                (a = (a << 1) | (1 & d)),
                  15 == f++ && ((f = 0), (e[b] = a >>> 8), (e[b + 1] = a % 256), (b += 2), (a = 0)),
                  (d >>= 1);
            }
            0 == --i && ((i = Math.pow(2, h)), h++), (k[g] = void 0);
          } else
            for (c = 0, d = j[g]; c < h; c++)
              (a = (a << 1) | (1 & d)),
                15 == f++ && ((f = 0), (e[b] = a >>> 8), (e[b + 1] = a % 256), (b += 2), (a = 0)),
                (d >>= 1);
          0 == --i && ((i = Math.pow(2, h)), h++), (j[n] = q++), (g = l);
        }
      if ("" !== g) {
        if (void 0 !== k[g]) {
          if (256 > g.charCodeAt(0)) {
            for (c = 0; c < h; c++)
              (a <<= 1),
                15 == f++ && ((f = 0), (e[b] = a >>> 8), (e[b + 1] = a % 256), (b += 2), (a = 0));
            for (c = 0, d = g.charCodeAt(0); c < 8; c++)
              (a = (a << 1) | (1 & d)),
                15 == f++ && ((f = 0), (e[b] = a >>> 8), (e[b + 1] = a % 256), (b += 2), (a = 0)),
                (d >>= 1);
          } else {
            for (c = 0, d = 1; c < h; c++)
              (a = (a << 1) | d),
                15 == f++ && ((f = 0), (e[b] = a >>> 8), (e[b + 1] = a % 256), (b += 2), (a = 0)),
                (d = 0);
            for (c = 0, d = g.charCodeAt(0); c < 16; c++)
              (a = (a << 1) | (1 & d)),
                15 == f++ && ((f = 0), (e[b] = a >>> 8), (e[b + 1] = a % 256), (b += 2), (a = 0)),
                (d >>= 1);
          }
          0 == --i && ((i = Math.pow(2, h)), h++), (k[g] = void 0);
        } else
          for (c = 0, d = j[g]; c < h; c++)
            (a = (a << 1) | (1 & d)),
              15 == f++ && ((f = 0), (e[b] = a >>> 8), (e[b + 1] = a % 256), (b += 2), (a = 0)),
              (d >>= 1);
        0 == --i && ((i = Math.pow(2, h)), h++);
      }
      for (c = 0, d = 2; c < h; c++)
        (a = (a << 1) | (1 & d)),
          15 == f++ && ((f = 0), (e[b] = a >>> 8), (e[b + 1] = a % 256), (b += 2), (a = 0)),
          (d >>= 1);
      return f < 16 && (a <<= 16 - f), (e[b] = a >>> 8), (e[b + 1] = a % 256), b + 2 - p;
    },
    decompress: function (a) {
      return null == a
        ? ""
        : "" == a
        ? null
        : b._decompress(a.length, 32768, function (b) {
            return a.charCodeAt(b);
          });
    },
    _decompress: function (r, h, i) {
      var m,
        n,
        d,
        e,
        f,
        b,
        g,
        j = [],
        k = 4,
        l = 4,
        o = 3,
        p = "",
        q = [],
        a = { val: i(0), position: h, index: 1 };
      for (m = 0; m < 3; m += 1) j[m] = m;
      for (d = 0, f = 4, b = 1; b != f; )
        (e = a.val & a.position),
          (a.position >>= 1),
          0 == a.position && ((a.position = h), (a.val = i(a.index++))),
          (d |= (e > 0 ? 1 : 0) * b),
          (b <<= 1);
      switch (d) {
        case 0:
          for (d = 0, f = 256, b = 1; b != f; )
            (e = a.val & a.position),
              (a.position >>= 1),
              0 == a.position && ((a.position = h), (a.val = i(a.index++))),
              (d |= (e > 0 ? 1 : 0) * b),
              (b <<= 1);
          g = c(d);
          break;
        case 1:
          for (d = 0, f = 65536, b = 1; b != f; )
            (e = a.val & a.position),
              (a.position >>= 1),
              0 == a.position && ((a.position = h), (a.val = i(a.index++))),
              (d |= (e > 0 ? 1 : 0) * b),
              (b <<= 1);
          g = c(d);
          break;
        case 2:
          return "";
      }
      for (j[3] = g, n = g, q.push(g); ; ) {
        if (a.index > r) return "";
        for (d = 0, f = Math.pow(2, o), b = 1; b != f; )
          (e = a.val & a.position),
            (a.position >>= 1),
            0 == a.position && ((a.position = h), (a.val = i(a.index++))),
            (d |= (e > 0 ? 1 : 0) * b),
            (b <<= 1);
        switch ((g = d)) {
          case 0:
            for (d = 0, f = 256, b = 1; b != f; )
              (e = a.val & a.position),
                (a.position >>= 1),
                0 == a.position && ((a.position = h), (a.val = i(a.index++))),
                (d |= (e > 0 ? 1 : 0) * b),
                (b <<= 1);
            (j[l++] = c(d)), (g = l - 1), k--;
            break;
          case 1:
            for (d = 0, f = 65536, b = 1; b != f; )
              (e = a.val & a.position),
                (a.position >>= 1),
                0 == a.position && ((a.position = h), (a.val = i(a.index++))),
                (d |= (e > 0 ? 1 : 0) * b),
                (b <<= 1);
            (j[l++] = c(d)), (g = l - 1), k--;
            break;
          case 2:
            return q.join("");
        }
        if ((0 == k && ((k = Math.pow(2, o)), o++), j[g])) p = j[g];
        else {
          if (g !== l) return null;
          p = n + n[0];
        }
        q.push(p), (j[l++] = n + p[0]), k--, (n = p), 0 == k && ((k = Math.pow(2, o)), o++);
      }
    },
  };
  return b;
})();
"function" == typeof define && define.amd
  ? define(function () {
      return LZString;
    })
  : "undefined" != typeof module && null != module
  ? (module.exports = LZString)
  : "undefined" != typeof angular &&
    null != angular &&
    angular.module("LZString", []).factory("LZString", function () {
      return LZString;
    });
("use strict");
const Box2D = {};
!(function (t) {
  function i() {}
  (t.inherit = function (t, o) {
    let e = t;
    (i.prototype = o.prototype), (t.prototype = new i()), (t.prototype.constructor = e);
  }),
    (t.NVector = function (t) {
      return 4 === t
        ? [0, 0, 0, 0]
        : 3 === t
        ? [0, 0, 0]
        : 2 === t
        ? [0, 0]
        : 1 === t
        ? [0]
        : new Array(t).fill(0);
    }),
    (t.is = function (t, i) {
      return (
        null != t &&
        ((i instanceof Function && t instanceof i) ||
          !(void 0 === t.constructor.__implements || !t.constructor.__implements[i]))
      );
    }),
    (t.parseUInt = function (t) {
      return Math.abs(parseInt(t, 10));
    });
})(Box2D),
  void 0 === Box2D && (Box2D = {}),
  void 0 === Box2D.Collision && (Box2D.Collision = {}),
  void 0 === Box2D.Collision.Shapes && (Box2D.Collision.Shapes = {}),
  void 0 === Box2D.Common && (Box2D.Common = {}),
  void 0 === Box2D.Common.Math && (Box2D.Common.Math = {}),
  void 0 === Box2D.Dynamics && (Box2D.Dynamics = {}),
  void 0 === Box2D.Dynamics.Contacts && (Box2D.Dynamics.Contacts = {}),
  void 0 === Box2D.Dynamics.Controllers && (Box2D.Dynamics.Controllers = {}),
  void 0 === Box2D.Dynamics.Joints && (Box2D.Dynamics.Joints = {}),
  (function () {
    Box2D.Collision.IBroadPhase = "Box2D.Collision.IBroadPhase";
    const t = (Box2D.Common.Math.b2Vec2 = function (t, i) {
      (this.x = t || 0), (this.y = i || 0);
    });
    function i(i, o, e, s) {
      (this.lowerBound = new t(i, o)), (this.upperBound = new t(e, s));
    }
    function o() {
      (this.features = new a()), (this.features._m_id = this);
    }
    function e() {}
    function s() {
      (this.m_root = null),
        (this.m_freeList = null),
        (this.m_path = 0),
        (this.m_insertionCount = 0);
    }
    function n() {
      (this.m_tree = new s()),
        (this.m_moveBuffer = []),
        (this.m_pairBuffer = []),
        (this.m_pairCount = 0),
        (this.m_proxyCount = 0);
    }
    function l() {
      (this.m_pointCount = 0),
        (this.m_points = [new m(), new m()]),
        (this.m_localPlaneNormal = new t()),
        (this.m_localPoint = new t());
    }
    function m() {
      (this.m_localPoint = new t()), (this.m_id = new o());
    }
    function r() {}
    function a() {}
    function _() {
      (this.m_type = _.e_unknownShape), (this.m_radius = h.b2_linearSlop);
    }
    function h() {}
    function c() {
      (this.col1 = new t(1, 0)), (this.col2 = new t(0, 1));
    }
    function y(t, i, o) {
      (this.col1 = t ? new x(t.x, t.y, t.z) : new x(0, 0, 0)),
        (this.col2 = i ? new x(i.x, i.y, i.z) : new x(0, 0, 0)),
        (this.col3 = o ? new x(o.x, o.y, o.z) : new x(0, 0, 0));
    }
    function p(i) {
      (this.position = void 0 !== i ? i : new t()), (this.R = new c());
    }
    function u() {
      (this.localCenter = new t()), (this.c0 = new t()), (this.c = new t());
    }
    function x(t, i, o) {
      (this.x = t), (this.y = i), (this.z = o);
    }
    function d(i, o) {
      (this.m_world = o),
        (this.m_xf = new p(i.position)),
        this.m_xf.R.Set(i.angle),
        (this.m_sweep = new u()),
        (this.m_linearVelocity = new t()),
        (this.m_force = new t()),
        (this.m_gravityScale = 1),
        (this.m_flags = 0),
        (this._parent = void 0),
        (this._local = void 0),
        i.bullet && (this.m_flags |= d.e_bulletFlag),
        i.fixedRotation && (this.m_flags |= d.e_fixedRotationFlag),
        i.allowSleep && (this.m_flags |= d.e_allowSleepFlag),
        i.awake ? ((this.m_flags |= d.e_awakeFlag), (this.m_isAwake = !0)) : (this.m_isAwake = !1),
        i.active && (this.m_flags |= d.e_activeFlag),
        this.m_sweep.localCenter.SetZero(),
        (this.m_sweep.t0 = 1),
        (this.m_sweep.a0 = this.m_sweep.a = i.angle);
      let e = this.m_xf.R,
        s = this.m_sweep.localCenter;
      (this.m_sweep.c.x = e.col1.x * s.x + e.col2.x * s.y),
        (this.m_sweep.c.y = e.col1.y * s.x + e.col2.y * s.y),
        (this.m_sweep.c.x += this.m_xf.position.x),
        (this.m_sweep.c.y += this.m_xf.position.y),
        this.m_sweep.c0.SetV(this.m_sweep.c),
        (this.m_jointList = null),
        (this.m_controllerList = null),
        (this.m_contactList = null),
        (this.m_controllerCount = 0),
        (this.m_prev = null),
        (this.m_next = null),
        this.m_linearVelocity.SetV(i.linearVelocity),
        (this.m_angularVelocity = i.angularVelocity),
        (this.m_linearDamping = i.linearDamping),
        (this.m_angularDamping = i.angularDamping),
        this.m_force.Set(0, 0),
        (this.m_torque = 0),
        (this.m_sleepTime = 0),
        (this.m_type = i.type),
        this.m_type === d.b2_dynamicBody
          ? ((this.m_mass = 1), (this.m_invMass = 1))
          : ((this.m_mass = 0), (this.m_invMass = 0)),
        (this.m_I = 0),
        (this.m_invI = 0),
        (this.m_inertiaScale = i.inertiaScale),
        (this.m_userData = i.userData),
        (this.m_fixtureList = null),
        (this.m_fixtureCount = 0);
    }
    function f() {
      (this.position = new t()),
        (this.linearVelocity = new t()),
        (this.userData = null),
        (this.angle = 0),
        (this.angularVelocity = 0),
        (this.linearDamping = 0),
        (this.angularDamping = 0),
        (this.allowSleep = !0),
        (this.awake = !0),
        (this.fixedRotation = !1),
        (this.bullet = !1),
        (this.type = d.b2_staticBody),
        (this.active = !0),
        (this.inertiaScale = 1);
    }
    function b() {}
    function B() {}
    function A() {
      (this.m_world = null),
        (this.m_contactCount = 0),
        (this.m_contactFilter = b.b2_defaultFilter),
        (this.m_contactListener = B.b2_defaultListener),
        (this.m_contactFactory = new S(this.m_allocator)),
        (this.m_broadPhase = new n());
    }
    function D() {
      (this.categoryBits = 1), (this.maskBits = 16777215), (this.groupIndex = 0);
    }
    function C() {
      (this.m_bodies = []), (this.m_contacts = []), (this.m_joints = []);
    }
    function w() {}
    function v() {
      (this.localPoint = new t()), (this.rA = new t()), (this.rB = new t());
    }
    function g() {
      (this.contact = null), (this.prev = null), (this.next = null), (this.other = null);
    }
    function S(t) {
      (this.m_allocator = t), this.InitializeRegisters();
    }
    function M() {
      (this.m_step = new w()), (this.m_constraints = []);
    }
    function V() {
      V.b2Joint.apply(this, arguments),
        this.constructor === V && this.b2Joint.apply(this, arguments);
    }
    function I() {}
    (t.Buffer = []),
      (t.Alloc = function (i = 0, o = 0) {
        return 0 === t.Buffer.length ? new t(i, o) : t.Buffer.pop().Set2(i, o);
      }),
      (t.Free = function (i) {
        t.Buffer.push(i);
      }),
      (i.Buffer = []),
      (i.Alloc = function (t, o, e, s) {
        let n;
        return (
          i.Buffer.length > 0
            ? (((n = i.Buffer.pop()).lowerBound.x = t),
              (n.lowerBound.y = o),
              (n.upperBound.x = e),
              (n.upperBound.y = s))
            : (n = new i(t, o, e, s)),
          n
        );
      }),
      (i.Free = function (t) {
        i.Buffer.push(t);
      }),
      (Box2D.Collision.b2AABB = i),
      (Box2D.Collision.b2Bound = function () {}),
      (Box2D.Collision.b2BoundValues = function () {
        (this.lowerValues = [0, 0]), (this.upperValues = [0, 0]);
      }),
      (Box2D.Collision.b2Collision = function () {}),
      (Box2D.Collision.b2ContactID = o),
      (Box2D.Collision.b2ContactPoint = function () {
        (this.position = new t()),
          (this.velocity = new t()),
          (this.normal = new t()),
          (this.id = new o());
      }),
      (Box2D.Collision.b2Distance = function () {}),
      (Box2D.Collision.b2DistanceInput = function () {
        (this.proxyA = new e()),
          (this.proxyB = new e()),
          (this.transformA = void 0),
          (this.transformB = void 0),
          (this.useRadii = !0);
      }),
      (Box2D.Collision.b2DistanceOutput = function () {
        (this.pointA = new t()),
          (this.pointB = new t()),
          (this.distance = 0),
          (this.iterations = 0);
      }),
      (Box2D.Collision.b2DistanceProxy = e),
      (Box2D.Collision.b2DynamicTree = s),
      (Box2D.Collision.b2DynamicTreeBroadPhase = n),
      (Box2D.Collision.b2DynamicTreeNode = function () {
        this.aabb = new i();
      }),
      (Box2D.Collision.b2DynamicTreePair = function (t, i) {
        (this.proxyA = t), (this.proxyB = i);
      }),
      (Box2D.Collision.b2Manifold = l),
      (Box2D.Collision.b2ManifoldPoint = m),
      (Box2D.Collision.b2Point = function t() {
        t.b2Point.apply(this, arguments);
      }),
      (Box2D.Collision.b2RayCastInput = function (t, i) {
        (this.p1 = t), (this.p2 = i), (this.maxFraction = 1);
      }),
      (Box2D.Collision.b2RayCastOutput = function () {
        this.normal = new t();
      }),
      (Box2D.Collision.b2Segment = function () {
        (this.p1 = new t()), (this.p2 = new t());
      }),
      (Box2D.Collision.b2SeparationFunction = function () {
        (this.m_localPoint = new t()), (this.m_axis = new t());
      }),
      (Box2D.Collision.b2Simplex = function () {
        (this.m_v1 = new r()),
          (this.m_v2 = new r()),
          (this.m_v3 = new r()),
          (this.m_vertices = [this.m_v1, this.m_v2, this.m_v3]);
      }),
      (Box2D.Collision.b2SimplexCache = function () {
        (this.indexA = [0, 0, 0]), (this.indexB = [0, 0, 0]);
      }),
      (Box2D.Collision.b2SimplexVertex = r),
      (Box2D.Collision.b2TimeOfImpact = function () {}),
      (Box2D.Collision.b2TOIInput = function () {
        (this.proxyA = new e()),
          (this.proxyB = new e()),
          (this.sweepA = new u()),
          (this.sweepB = new u());
      }),
      (Box2D.Collision.b2WorldManifold = function () {
        (this.m_normal = new t()), (this.m_points = [new t(), new t()]);
      }),
      (Box2D.Collision.ClipVertex = function () {
        (this.v = new t()), (this.id = new o());
      }),
      (Box2D.Collision.Features = a),
      (Box2D.Collision.Shapes.b2CircleShape = function (i) {
        (this.m_p = new t()), (this.m_type = _.e_circleShape), (this.m_radius = i || 0);
      }),
      (Box2D.Collision.Shapes.b2EdgeChainDef = function () {
        (this.vertexCount = 0), (this.isALoop = !0), (this.vertices = []);
      }),
      (Box2D.Collision.Shapes.b2EdgeShape = function (i, o) {
        (this.m_type = _.e_edgeShape),
          (this.m_prevEdge = null),
          (this.m_nextEdge = null),
          (this.m_v1 = i),
          (this.m_v2 = o),
          this.m_direction.Set(this.m_v2.x - this.m_v1.x, this.m_v2.y - this.m_v1.y),
          (this.m_length = this.m_direction.Normalize()),
          this.m_normal.Set(this.m_direction.y, -this.m_direction.x),
          this.m_coreV1.Set(
            -h.b2_toiSlop * (this.m_normal.x - this.m_direction.x) + this.m_v1.x,
            -h.b2_toiSlop * (this.m_normal.y - this.m_direction.y) + this.m_v1.y
          ),
          this.m_coreV2.Set(
            -h.b2_toiSlop * (this.m_normal.x + this.m_direction.x) + this.m_v2.x,
            -h.b2_toiSlop * (this.m_normal.y + this.m_direction.y) + this.m_v2.y
          ),
          (this.m_cornerDir1 = this.m_normal),
          this.m_cornerDir2.Set(-this.m_normal.x, -this.m_normal.y),
          (this.s_supportVec = new t()),
          (this.m_v1 = new t()),
          (this.m_v2 = new t()),
          (this.m_coreV1 = new t()),
          (this.m_coreV2 = new t()),
          (this.m_normal = new t()),
          (this.m_direction = new t()),
          (this.m_cornerDir1 = new t()),
          (this.m_cornerDir2 = new t()),
          (this.m_radius = h.b2_linearSlop);
      }),
      (Box2D.Collision.Shapes.b2MassData = function () {
        (this.mass = 0), (this.center = new t()), (this.I = 0);
      }),
      (Box2D.Collision.Shapes.b2PolygonShape = function () {
        (this.m_type = _.e_polygonShape),
          (this.m_radius = h.b2_linearSlop),
          (this.m_centroid = new t()),
          (this.m_vertices = []),
          (this.m_normals = []);
      }),
      (Box2D.Collision.Shapes.b2Shape = _),
      (Box2D.Common.b2internal = "Box2D.Common.b2internal"),
      (Box2D.Common.b2Settings = h),
      (Box2D.Common.Math.b2Mat22 = c),
      (Box2D.Common.Math.b2Mat33 = y),
      (Box2D.Common.Math.b2Math = function () {}),
      (Box2D.Common.Math.b2Sweep = u),
      (Box2D.Common.Math.b2Transform = p),
      (Box2D.Common.Math.b2Vec3 = x),
      (Box2D.Dynamics.b2Body = d),
      (Box2D.Dynamics.b2BodyDef = f),
      (Box2D.Dynamics.b2ContactFilter = b),
      (Box2D.Dynamics.b2ContactImpulse = function () {
        (this.normalImpulses = [0, 0]), (this.tangentImpulses = [0, 0]);
      }),
      (Box2D.Dynamics.b2ContactListener = B),
      (Box2D.Dynamics.b2ContactManager = A),
      (Box2D.Dynamics.b2DestructionListener = function () {}),
      (Box2D.Dynamics.b2FilterData = D),
      (Box2D.Dynamics.b2Fixture = function (t, o) {
        (this.m_filter = o.filter.Copy()),
          (this.m_aabb = i.Alloc()),
          (this.m_userData = o.userData),
          (this.m_body = t),
          (this.m_next = null),
          (this.m_shape = o.shape.Copy()),
          (this.m_density = o.density),
          (this.m_friction = o.friction),
          (this.m_restitution = o.restitution),
          (this.m_isSensor = o.isSensor);
      }),
      (Box2D.Dynamics.b2FixtureDef = function () {
        (this.filter = new D()),
          (this.shape = null),
          (this.userData = null),
          (this.friction = 0.2),
          (this.restitution = 0),
          (this.density = 0),
          (this.isSensor = !1);
      }),
      (Box2D.Dynamics.b2Island = C),
      (Box2D.Dynamics.b2TimeStep = w),
      (Box2D.Dynamics.b2World = function t(i, o, e = !1) {
        if (
          ((this.s_stack = []),
          (this.m_contactManager = new A()),
          (this.m_contactManager.m_world = this),
          (this.m_contactSolver = new M()),
          (this.m_island = new C()),
          (this.m_destructionListener = null),
          (this.m_bodyList = null),
          (this.m_last = null),
          (this.m_contactList = null),
          (this.m_jointList = null),
          (this.m_controllerList = null),
          (this.m_bodyCount = 0),
          (this.m_contactCount = 0),
          (this.m_jointCount = 0),
          (this.m_controllerCount = 0),
          (t.m_warmStarting = !0),
          (t.m_continuousPhysics = !0),
          (this.m_allowSleep = o),
          (this.m_gravity = i),
          (this.m_inv_dt0 = 0),
          e)
        ) {
          let t = new f();
          this.m_groundBody = this.CreateBody(t);
        }
      }),
      (Box2D.Dynamics.Contacts.b2CircleContact = function () {
        (this.m_nodeA = new g()),
          (this.m_nodeB = new g()),
          (this.m_manifold = new l()),
          (this.m_oldManifold = new l()),
          (this.m_swapped = !1);
      }),
      (Box2D.Dynamics.Contacts.b2Contact = function () {
        (this.m_nodeA = new g()),
          (this.m_nodeB = new g()),
          (this.m_manifold = new l()),
          (this.m_oldManifold = new l()),
          (this.m_swapped = !1);
      }),
      (Box2D.Dynamics.Contacts.b2ContactConstraint = function () {
        (this.localPlaneNormal = new t()),
          (this.localPoint = new t()),
          (this.normal = new t()),
          (this.normalMass = new c()),
          (this.K = new c()),
          (this.points = [new v(), new v()]);
      }),
      (Box2D.Dynamics.Contacts.b2ContactConstraintPoint = v),
      (Box2D.Dynamics.Contacts.b2ContactEdge = g),
      (Box2D.Dynamics.Contacts.b2ContactFactory = S),
      (Box2D.Dynamics.Contacts.b2ContactRegister = function () {}),
      (Box2D.Dynamics.Contacts.b2ContactResult = function () {
        (this.position = new t()), (this.normal = new t()), (this.id = new o());
      }),
      (Box2D.Dynamics.Contacts.b2ContactSolver = M),
      (Box2D.Dynamics.Contacts.b2EdgeAndCircleContact = function () {
        (this.m_nodeA = new g()),
          (this.m_nodeB = new g()),
          (this.m_manifold = new l()),
          (this.m_oldManifold = new l()),
          (this.m_swapped = !1);
      }),
      (Box2D.Dynamics.Contacts.b2NullContact = function () {
        (this.m_nodeA = new g()),
          (this.m_nodeB = new g()),
          (this.m_manifold = new l()),
          (this.m_oldManifold = new l()),
          (this.m_swapped = !1);
      }),
      (Box2D.Dynamics.Contacts.b2PolyAndCircleContact = function () {
        (this.m_nodeA = new g()),
          (this.m_nodeB = new g()),
          (this.m_manifold = new l()),
          (this.m_oldManifold = new l()),
          (this.m_swapped = !1);
      }),
      (Box2D.Dynamics.Contacts.b2PolyAndEdgeContact = function () {
        (this.m_nodeA = new g()),
          (this.m_nodeB = new g()),
          (this.m_manifold = new l()),
          (this.m_oldManifold = new l()),
          (this.m_swapped = !1);
      }),
      (Box2D.Dynamics.Contacts.b2PolygonContact = function () {
        (this.m_nodeA = new g()),
          (this.m_nodeB = new g()),
          (this.m_manifold = new l()),
          (this.m_oldManifold = new l()),
          (this.m_swapped = !1);
      }),
      (Box2D.Dynamics.Contacts.b2PositionSolverManifold = function () {
        (this.m_normal = new t()),
          (this.m_separations = [0, 0]),
          (this.m_points = [new t(), new t()]);
      }),
      (Box2D.Dynamics.Controllers.b2BuoyancyController = function t() {
        t.b2BuoyancyController.apply(this, arguments);
      }),
      (Box2D.Dynamics.Controllers.b2ConstantAccelController = function t() {
        t.b2ConstantAccelController.apply(this, arguments);
      }),
      (Box2D.Dynamics.Controllers.b2ConstantForceController = function t() {
        t.b2ConstantForceController.apply(this, arguments);
      }),
      (Box2D.Dynamics.Controllers.b2Controller = function t() {
        t.b2Controller.apply(this, arguments);
      }),
      (Box2D.Dynamics.Controllers.b2ControllerEdge = function t() {
        t.b2ControllerEdge.apply(this, arguments);
      }),
      (Box2D.Dynamics.Controllers.b2GravityController = function t() {
        t.b2GravityController.apply(this, arguments);
      }),
      (Box2D.Dynamics.Controllers.b2TensorDampingController = function t() {
        t.b2TensorDampingController.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2DistanceJoint = function t() {
        t.b2DistanceJoint.apply(this, arguments),
          this.constructor === t && this.b2DistanceJoint.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2DistanceJointDef = function t() {
        t.b2DistanceJointDef.apply(this, arguments),
          this.constructor === t && this.b2DistanceJointDef.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2FrictionJoint = function t() {
        t.b2FrictionJoint.apply(this, arguments),
          this.constructor === t && this.b2FrictionJoint.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2FrictionJointDef = function t() {
        t.b2FrictionJointDef.apply(this, arguments),
          this.constructor === t && this.b2FrictionJointDef.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2GearJoint = function t() {
        t.b2GearJoint.apply(this, arguments),
          this.constructor === t && this.b2GearJoint.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2GearJointDef = function t() {
        t.b2GearJointDef.apply(this, arguments),
          this.constructor === t && this.b2GearJointDef.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2Jacobian = function t() {
        t.b2Jacobian.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2Joint = V),
      (Box2D.Dynamics.Joints.b2JointDef = function t() {
        t.b2JointDef.apply(this, arguments),
          this.constructor === t && this.b2JointDef.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2JointEdge = I),
      (Box2D.Dynamics.Joints.b2LineJoint = function t() {
        t.b2LineJoint.apply(this, arguments),
          this.constructor === t && this.b2LineJoint.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2LineJointDef = function t() {
        t.b2LineJointDef.apply(this, arguments),
          this.constructor === t && this.b2LineJointDef.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2MouseJoint = function t() {
        t.b2MouseJoint.apply(this, arguments),
          this.constructor === t && this.b2MouseJoint.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2MouseJointDef = function t() {
        t.b2MouseJointDef.apply(this, arguments),
          this.constructor === t && this.b2MouseJointDef.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2PrismaticJoint = function t() {
        t.b2PrismaticJoint.apply(this, arguments),
          this.constructor === t && this.b2PrismaticJoint.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2PrismaticJointDef = function t() {
        t.b2PrismaticJointDef.apply(this, arguments),
          this.constructor === t && this.b2PrismaticJointDef.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2PulleyJoint = function t() {
        t.b2PulleyJoint.apply(this, arguments),
          this.constructor === t && this.b2PulleyJoint.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2PulleyJointDef = function t() {
        t.b2PulleyJointDef.apply(this, arguments),
          this.constructor === t && this.b2PulleyJointDef.apply(this, arguments);
      }),
      (Box2D.Dynamics.Joints.b2RevoluteJoint = function (i) {
        (this.m_edgeA = new I()),
          (this.m_edgeB = new I()),
          (this.m_localCenterA = new t()),
          (this.m_localCenterB = new t()),
          (this.K = new c()),
          (this.impulse3 = new x(0, 0, 0)),
          (this.impulse2 = new t()),
          (this.reduced = new t()),
          (this.m_localAnchor1 = new t()),
          (this.m_localAnchor2 = new t()),
          (this.m_impulse = new x(0, 0, 0)),
          (this.m_mass = new y()),
          (this.m_type = i.type),
          (this.m_prev = null),
          (this.m_next = null),
          (this.m_bodyA = i.bodyA),
          (this.m_bodyB = i.bodyB),
          (this.m_collideConnected = i.collideConnected),
          (this.m_islandFlag = !1),
          (this.m_userData = i.userData),
          this.m_localAnchor1.SetV(i.localAnchorA),
          this.m_localAnchor2.SetV(i.localAnchorB),
          (this.m_referenceAngle = i.referenceAngle),
          this.m_impulse.SetZero(),
          (this.m_motorImpulse = 0),
          (this.m_lowerAngle = i.lowerAngle),
          (this.m_upperAngle = i.upperAngle),
          (this.m_maxMotorTorque = i.maxMotorTorque),
          (this.m_motorSpeed = i.motorSpeed),
          (this.m_enableLimit = i.enableLimit),
          (this.m_enableMotor = i.enableMotor),
          (this.m_limitState = V.e_inactiveLimit);
      }),
      (Box2D.Dynamics.Joints.b2RevoluteJointDef = function () {
        (this.userData = null),
          (this.bodyA = null),
          (this.bodyB = null),
          (this.collideConnected = !1),
          (this.localAnchorA = new t()),
          (this.localAnchorB = new t()),
          (this.type = V.e_revoluteJoint),
          (this.referenceAngle = 0),
          (this.lowerAngle = 0),
          (this.upperAngle = 0),
          (this.maxMotorTorque = 0),
          (this.motorSpeed = 0),
          (this.enableLimit = !1),
          (this.enableMotor = !1);
      }),
      (Box2D.Dynamics.Joints.b2WeldJoint = function (i) {
        (this.m_edgeA = new I()),
          (this.m_edgeB = new I()),
          (this.m_localCenterA = new t()),
          (this.m_localCenterB = new t()),
          (this.m_localAnchor1 = new t()),
          (this.m_localAnchor2 = new t()),
          (this.m_u = new t()),
          (this.m_localAnchorA = new t(i.localAnchorA.x, i.localAnchorA.y)),
          (this.m_localAnchorB = new t(i.localAnchorB.x, i.localAnchorB.y)),
          (this.m_impulse = new x(0, 0, 0)),
          (this.m_mass = new y()),
          (this.m_referenceAngle = i.referenceAngle),
          (this.m_type = V.e_weldJoint),
          (this.m_prev = null),
          (this.m_next = null),
          (this.m_bodyA = i.bodyA),
          (this.m_bodyB = i.bodyB),
          (this.m_collideConnected = i.collideConnected),
          (this.m_islandFlag = !1),
          (this.m_userData = i.userData);
      }),
      (Box2D.Dynamics.Joints.b2WeldJointDef = function () {
        (this.localAnchorA = new t()),
          (this.localAnchorB = new t()),
          (this.userData = null),
          (this.bodyA = null),
          (this.bodyB = null),
          (this.collideConnected = !1),
          (this.type = V.e_weldJoint),
          (this.referenceAngle = 0);
      });
  })(),
  (Box2D.postDefs = []),
  (function () {
    let t = Box2D.Collision.Shapes.b2Shape,
      i = Box2D.Common.b2Settings,
      o = Box2D.Common.Math.b2Math,
      e = Box2D.Common.Math.b2Transform,
      s = Box2D.Common.Math.b2Vec2,
      n = Box2D.Collision.b2AABB,
      l = Box2D.Collision.b2Bound,
      m = Box2D.Collision.b2Collision,
      r = Box2D.Collision.b2ContactID,
      a = Box2D.Collision.b2Distance,
      _ = Box2D.Collision.b2DistanceInput,
      h = Box2D.Collision.b2DistanceOutput,
      c = Box2D.Collision.b2DistanceProxy,
      y = Box2D.Collision.b2DynamicTree,
      p = Box2D.Collision.b2DynamicTreeBroadPhase,
      u = Box2D.Collision.b2DynamicTreeNode,
      x = Box2D.Collision.b2DynamicTreePair,
      d = Box2D.Collision.b2Manifold,
      f = Box2D.Collision.b2ManifoldPoint,
      b = Box2D.Collision.b2Point,
      B = Box2D.Collision.b2RayCastInput,
      A = Box2D.Collision.b2Segment,
      D = Box2D.Collision.b2SeparationFunction,
      C = Box2D.Collision.b2Simplex,
      w = Box2D.Collision.b2SimplexCache,
      v = Box2D.Collision.b2SimplexVertex,
      g = Box2D.Collision.b2TimeOfImpact,
      S = Box2D.Collision.b2WorldManifold,
      M = Box2D.Collision.ClipVertex,
      V = Box2D.Collision.Features,
      I = Box2D.Collision.IBroadPhase;
    (n.prototype.IsValid = function () {
      let t = this.upperBound.x - this.lowerBound.x,
        i = this.upperBound.y - this.lowerBound.y,
        o = t >= 0 && i >= 0;
      return (o = o && this.lowerBound.IsValid() && this.upperBound.IsValid());
    }),
      (n.prototype.GetCenter = function () {
        return new s(
          (this.lowerBound.x + this.upperBound.x) / 2,
          (this.lowerBound.y + this.upperBound.y) / 2
        );
      }),
      (n.prototype.GetExtents = function () {
        return new s(
          (this.upperBound.x - this.lowerBound.x) / 2,
          (this.upperBound.y - this.lowerBound.y) / 2
        );
      }),
      (n.prototype.Contains = function (t) {
        return !(
          this.lowerBound.x > t.lowerBound.x ||
          this.lowerBound.y > t.lowerBound.y ||
          t.upperBound.x > this.upperBound.x ||
          t.upperBound.y > this.upperBound.y
        );
      }),
      (n.prototype.RayCast = function (t, i) {
        let o = -Number.MAX_VALUE,
          e = Number.MAX_VALUE,
          s = i.p1.x,
          n = i.p1.y,
          l = i.p2.x - i.p1.x,
          m = i.p2.y - i.p1.y,
          r = Math.abs(l),
          a = Math.abs(m),
          _ = t.normal,
          h = 0,
          c = 0,
          y = 0,
          p = 0,
          u = 0;
        if (r < Number.MIN_VALUE) {
          if (s < this.lowerBound.x || this.upperBound.x < s) return !1;
        } else if (
          ((h = 1 / l),
          (u = -1),
          (c = (this.lowerBound.x - s) * h) > (y = (this.upperBound.x - s) * h) &&
            ((p = c), (c = y), (y = p), (u = 1)),
          c > o && ((_.x = u), (_.y = 0), (o = c)),
          o > (e = Math.min(e, y)))
        )
          return !1;
        if (a < Number.MIN_VALUE) {
          if (n < this.lowerBound.y || this.upperBound.y < n) return !1;
        } else if (
          ((h = 1 / m),
          (u = -1),
          (c = (this.lowerBound.y - n) * h) > (y = (this.upperBound.y - n) * h) &&
            ((p = c), (c = y), (y = p), (u = 1)),
          c > o && ((_.y = u), (_.x = 0), (o = c)),
          o > (e = Math.min(e, y)))
        )
          return !1;
        return (t.fraction = o), !0;
      }),
      (n.prototype.TestOverlap = function (t) {
        return !(
          t.lowerBound.x - this.upperBound.x > 0 ||
          t.lowerBound.y - this.upperBound.y > 0 ||
          this.lowerBound.x - t.upperBound.x > 0 ||
          this.lowerBound.y - t.upperBound.y > 0
        );
      }),
      (n.prototype.Combine = function (t, i) {
        (this.lowerBound.x = Math.min(t.lowerBound.x, i.lowerBound.x)),
          (this.lowerBound.y = Math.min(t.lowerBound.y, i.lowerBound.y)),
          (this.upperBound.x = Math.max(t.upperBound.x, i.upperBound.x)),
          (this.upperBound.y = Math.max(t.upperBound.y, i.upperBound.y));
      }),
      (l.prototype.IsLower = function () {
        return 0 == (1 & this.value);
      }),
      (l.prototype.IsUpper = function () {
        return 1 == (1 & this.value);
      }),
      (l.prototype.Swap = function (t) {
        let i = this.value,
          o = this.proxy,
          e = this.stabbingCount;
        (this.value = t.value),
          (this.proxy = t.proxy),
          (this.stabbingCount = t.stabbingCount),
          (t.value = i),
          (t.proxy = o),
          (t.stabbingCount = e);
      }),
      (m.ClipSegmentToLine = function (t, i, o, e) {
        let s = 0,
          n = i[0].v,
          l = i[1].v,
          m = o.x * n.x + o.y * n.y - e,
          r = o.x * l.x + o.y * l.y - e;
        if ((m <= 0 && t[s++].Set(i[0]), r <= 0 && t[s++].Set(i[1]), m * r < 0)) {
          let o = m / (m - r),
            e = t[s];
          (e.v.x = n.x + o * (l.x - n.x)),
            (e.v.y = n.y + o * (l.y - n.y)),
            (t[s].id = i[m > 0 ? 0 : 1].id),
            ++s;
        }
        return s;
      }),
      (m.EdgeSeparation = function (t, i, o, e, s) {
        let n = e.m_vertices,
          l = i.R,
          m = t.m_normals[o],
          r = l.col1.x * m.x + l.col2.x * m.y,
          a = l.col1.y * m.x + l.col2.y * m.y,
          _ = (l = s.R).col1.x * r + l.col1.y * a,
          h = l.col2.x * r + l.col2.y * a,
          c = 0,
          y = Number.MAX_VALUE,
          p = e.m_vertexCount;
        for (; p > 0; ) {
          let t = (m = n[--p]).x * _ + m.y * h;
          t < y && ((y = t), (c = p));
        }
        (m = t.m_vertices[o]), (l = i.R);
        let u = i.position.x + (l.col1.x * m.x + l.col2.x * m.y),
          x = i.position.y + (l.col1.y * m.x + l.col2.y * m.y);
        return (
          (m = n[c]),
          (l = s.R),
          (s.position.x + (l.col1.x * m.x + l.col2.x * m.y) - u) * r +
            (s.position.y + (l.col1.y * m.x + l.col2.y * m.y) - x) * a
        );
      }),
      (m.FindMaxSeparation = function (t, i, o, e, s) {
        let n = i.m_vertexCount,
          l = i.m_normals,
          r = s.R,
          a = e.m_centroid,
          _ = s.position.x + (r.col1.x * a.x + r.col2.x * a.y),
          h = s.position.y + (r.col1.y * a.x + r.col2.y * a.y);
        (r = o.R),
          (a = i.m_centroid),
          (_ -= o.position.x + (r.col1.x * a.x + r.col2.x * a.y)),
          (h -= o.position.y + (r.col1.y * a.x + r.col2.y * a.y));
        let c = _ * o.R.col1.x + h * o.R.col1.y,
          y = _ * o.R.col2.x + h * o.R.col2.y,
          p = 0,
          u = -Number.MAX_VALUE,
          x = n;
        for (; x > 0; ) {
          let t = (a = l[--x]).x * c + a.y * y;
          t > u && ((u = t), (p = x));
        }
        let d = m.EdgeSeparation(i, o, p, e, s),
          f = p - 1 >= 0 ? p - 1 : n - 1,
          b = m.EdgeSeparation(i, o, f, e, s),
          B = p + 1 < n ? p + 1 : 0,
          A = m.EdgeSeparation(i, o, B, e, s),
          D = 0,
          C = 0,
          w = 0;
        if (b > d && b > A) (w = -1), (D = f), (C = b);
        else {
          if (!(A > d)) return (t.v = p), d;
          (w = 1), (D = B), (C = A);
        }
        for (
          ;
          (p = -1 === w ? (D - 1 >= 0 ? D - 1 : n - 1) : D + 1 < n ? D + 1 : 0),
            (d = m.EdgeSeparation(i, o, p, e, s)) > C;

        )
          (D = p), (C = d);
        return (t.v = D), C;
      }),
      (m.FindIncidentEdge = function (t, i, o, e, s, n) {
        let l = s.m_normals,
          m = o.R,
          r = i.m_normals[e],
          a = m.col1.x * r.x + m.col2.x * r.y,
          _ = m.col1.y * r.x + m.col2.y * r.y,
          h = (m = n.R).col1.x * a + m.col1.y * _;
        (_ = m.col2.x * a + m.col2.y * _), (a = h);
        let c = 0,
          y = Number.MAX_VALUE,
          p = s.m_vertexCount;
        for (; p > 0; ) {
          let t = a * (r = l[--p]).x + _ * r.y;
          t < y && ((y = t), (c = p));
        }
        let u = c + 1 < s.m_vertexCount ? c + 1 : 0,
          x = t[0];
        (r = s.m_vertices[c]),
          (m = n.R),
          (x.v.x = n.position.x + (m.col1.x * r.x + m.col2.x * r.y)),
          (x.v.y = n.position.y + (m.col1.y * r.x + m.col2.y * r.y)),
          (x.id.features.referenceEdge = e),
          (x.id.features.incidentEdge = c),
          (x.id.features.incidentVertex = 0),
          (x = t[1]),
          (r = s.m_vertices[u]),
          (m = n.R),
          (x.v.x = n.position.x + (m.col1.x * r.x + m.col2.x * r.y)),
          (x.v.y = n.position.y + (m.col1.y * r.x + m.col2.y * r.y)),
          (x.id.features.referenceEdge = e),
          (x.id.features.incidentEdge = u),
          (x.id.features.incidentVertex = 1);
      }),
      (m.MakeClipPointVector = function () {
        return [new M(), new M()];
      }),
      (m.CollidePolygons = function (t, o, e, s, n) {
        t.m_pointCount = 0;
        let l = o.m_radius + s.m_radius;
        m.s_edgeAO.v = 0;
        let r = m.FindMaxSeparation(m.s_edgeAO, o, e, s, n);
        if (r > l) return;
        m.s_edgeBO.v = 0;
        let a,
          _,
          h,
          c,
          y,
          p = m.FindMaxSeparation(m.s_edgeBO, s, n, o, e);
        if (p > l) return;
        let u = 0;
        p > 0.98 * r + 0.001
          ? ((a = s),
            (_ = o),
            (h = n),
            (c = e),
            (y = m.s_edgeBO.v),
            (t.m_type = d.e_faceB),
            (u = 1))
          : ((a = o), (_ = s), (h = e), (c = n), (y = m.s_edgeAO.v), (t.m_type = d.e_faceA));
        let x = m.s_incidentEdge;
        m.FindIncidentEdge(x, a, h, y, _, c);
        let f,
          b = a.m_vertexCount,
          B = a.m_vertices,
          A = B[y];
        f = y + 1 < b ? B[y + 1] : B[0];
        let D = m.s_localTangent;
        (D.x = f.x - A.x), (D.y = f.y - A.y), D.Normalize();
        let C = m.s_tangent,
          w = h.R;
        (C.x = w.col1.x * D.x + w.col2.x * D.y), (C.y = w.col1.y * D.x + w.col2.y * D.y);
        let v = m.s_tangent2;
        (v.x = -C.x), (v.y = -C.y);
        let g = m.s_normal;
        (g.x = C.y), (g.y = -C.x);
        let S = m.s_v11,
          M = m.s_v12;
        (S.x = h.position.x + (w.col1.x * A.x + w.col2.x * A.y)),
          (S.y = h.position.y + (w.col1.y * A.x + w.col2.y * A.y)),
          (M.x = h.position.x + (w.col1.x * f.x + w.col2.x * f.y)),
          (M.y = h.position.y + (w.col1.y * f.x + w.col2.y * f.y));
        let V = m.s_clipPoints2,
          I = m.ClipSegmentToLine(m.s_clipPoints1, x, v, -C.x * S.x - C.y * S.y + l);
        if (I < 2) return;
        if ((I = m.ClipSegmentToLine(V, m.s_clipPoints1, C, C.x * M.x + C.y * M.y + l)) < 2) return;
        (t.m_localPlaneNormal.x = D.y),
          (t.m_localPlaneNormal.y = -D.x),
          (t.m_localPoint.x = 0.5 * (A.x + f.x)),
          (t.m_localPoint.y = 0.5 * (A.y + f.y));
        let R = 0;
        for (let o = 0; o < i.b2_maxManifoldPoints; ++o) {
          let i = V[o];
          if (g.x * i.v.x + g.y * i.v.y - (g.x * S.x + g.y * S.y) <= l) {
            let o = t.m_points[R];
            w = c.R;
            let e = i.v.x - c.position.x,
              s = i.v.y - c.position.y;
            (o.m_localPoint.x = e * w.col1.x + s * w.col1.y),
              (o.m_localPoint.y = e * w.col2.x + s * w.col2.y),
              o.m_id.Set(i.id),
              (o.m_id.features.flip = u),
              ++R;
          }
        }
        t.m_pointCount = R;
      }),
      (m.CollideCircles = function (t, i, o, e, s) {
        let n = o.R,
          l = i.m_p,
          m = o.position.x + (n.col1.x * l.x + n.col2.x * l.y),
          r = o.position.y + (n.col1.y * l.x + n.col2.y * l.y);
        (n = s.R), (l = e.m_p);
        let a = s.position.x + (n.col1.x * l.x + n.col2.x * l.y) - m,
          _ = s.position.y + (n.col1.y * l.x + n.col2.y * l.y) - r,
          h = a * a + _ * _,
          c = i.m_radius + e.m_radius;
        h > c * c
          ? (t.m_pointCount = 0)
          : ((t.m_type = d.e_circles),
            t.m_localPoint.SetV(i.m_p),
            t.m_localPlaneNormal.SetZero(),
            (t.m_pointCount = 1),
            t.m_points[0].m_localPoint.SetV(e.m_p),
            (t.m_points[0].m_id.key = 0));
      }),
      (m.CollidePolygonAndCircle = function (t, i, o, e, s) {
        t.m_pointCount = 0;
        let n = s.R,
          l = e.m_p,
          m = s.position.x + (n.col1.x * l.x + n.col2.x * l.y),
          r = s.position.y + (n.col1.y * l.x + n.col2.y * l.y),
          a = m - o.position.x,
          _ = r - o.position.y,
          h = a * (n = o.R).col1.x + _ * n.col1.y,
          c = a * n.col2.x + _ * n.col2.y,
          y = 0,
          p = -Number.MAX_VALUE,
          u = i.m_radius + e.m_radius,
          x = i.m_vertexCount,
          f = i.m_vertices,
          b = i.m_normals;
        for (let t = 0; t < x; ++t) {
          (a = h - (l = f[t]).x), (_ = c - l.y);
          let i = (l = b[t]).x * a + l.y * _;
          if (i > u) return;
          i > p && ((p = i), (y = t));
        }
        let B = y,
          A = B + 1 < x ? B + 1 : 0,
          D = f[B],
          C = f[A];
        if (p < Number.MIN_VALUE)
          return (
            (t.m_pointCount = 1),
            (t.m_type = d.e_faceA),
            t.m_localPlaneNormal.SetV(b[y]),
            (t.m_localPoint.x = 0.5 * (D.x + C.x)),
            (t.m_localPoint.y = 0.5 * (D.y + C.y)),
            t.m_points[0].m_localPoint.SetV(e.m_p),
            void (t.m_points[0].m_id.key = 0)
          );
        let w = (h - D.x) * (C.x - D.x) + (c - D.y) * (C.y - D.y),
          v = (h - C.x) * (D.x - C.x) + (c - C.y) * (D.y - C.y);
        if (w <= 0) {
          if ((h - D.x) * (h - D.x) + (c - D.y) * (c - D.y) > u * u) return;
          (t.m_pointCount = 1),
            (t.m_type = d.e_faceA),
            (t.m_localPlaneNormal.x = h - D.x),
            (t.m_localPlaneNormal.y = c - D.y),
            t.m_localPlaneNormal.Normalize(),
            t.m_localPoint.SetV(D),
            t.m_points[0].m_localPoint.SetV(e.m_p),
            (t.m_points[0].m_id.key = 0);
        } else if (v <= 0) {
          if ((h - C.x) * (h - C.x) + (c - C.y) * (c - C.y) > u * u) return;
          (t.m_pointCount = 1),
            (t.m_type = d.e_faceA),
            (t.m_localPlaneNormal.x = h - C.x),
            (t.m_localPlaneNormal.y = c - C.y),
            t.m_localPlaneNormal.Normalize(),
            t.m_localPoint.SetV(C),
            t.m_points[0].m_localPoint.SetV(e.m_p),
            (t.m_points[0].m_id.key = 0);
        } else {
          let i = 0.5 * (D.x + C.x),
            o = 0.5 * (D.y + C.y);
          if ((p = (h - i) * b[B].x + (c - o) * b[B].y) > u) return;
          (t.m_pointCount = 1),
            (t.m_type = d.e_faceA),
            (t.m_localPlaneNormal.x = b[B].x),
            (t.m_localPlaneNormal.y = b[B].y),
            t.m_localPlaneNormal.Normalize(),
            t.m_localPoint.Set(i, o),
            t.m_points[0].m_localPoint.SetV(e.m_p),
            (t.m_points[0].m_id.key = 0);
        }
      }),
      (m.TestOverlap = function (t, i) {
        return (
          !(i.lowerBound.x - t.upperBound.x > 0 || i.lowerBound.y - t.upperBound.y > 0) &&
          !(t.lowerBound.x - i.upperBound.x > 0 || t.lowerBound.y - i.upperBound.y > 0)
        );
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Collision.b2Collision.s_incidentEdge = m.MakeClipPointVector()),
          (Box2D.Collision.b2Collision.s_clipPoints1 = m.MakeClipPointVector()),
          (Box2D.Collision.b2Collision.s_clipPoints2 = m.MakeClipPointVector()),
          (Box2D.Collision.b2Collision.s_edgeAO = { v: 0 }),
          (Box2D.Collision.b2Collision.s_edgeBO = { v: 0 }),
          (Box2D.Collision.b2Collision.s_localTangent = new s()),
          (Box2D.Collision.b2Collision.s_localNormal = new s()),
          (Box2D.Collision.b2Collision.s_planePoint = new s()),
          (Box2D.Collision.b2Collision.s_normal = new s()),
          (Box2D.Collision.b2Collision.s_tangent = new s()),
          (Box2D.Collision.b2Collision.s_tangent2 = new s()),
          (Box2D.Collision.b2Collision.s_v11 = new s()),
          (Box2D.Collision.b2Collision.s_v12 = new s()),
          (Box2D.Collision.b2Collision.b2CollidePolyTempVec = new s()),
          (Box2D.Collision.b2Collision.b2_nullFeature = 255);
      }),
      (r.prototype.Set = function (t) {
        this.key = t._key;
      }),
      (r.prototype.Copy = function () {
        let t = new r();
        return (t.key = this.key), t;
      }),
      Object.defineProperty(r.prototype, "key", {
        enumerable: !1,
        configurable: !0,
        get: function () {
          return this._key;
        },
      }),
      Object.defineProperty(r.prototype, "key", {
        enumerable: !1,
        configurable: !0,
        set: function (t) {
          (this._key = t),
            (this.features._referenceEdge = 255 & this._key),
            (this.features._incidentEdge = ((65280 & this._key) >> 8) & 255),
            (this.features._incidentVertex = ((16711680 & this._key) >> 16) & 255),
            (this.features._flip = ((4278190080 & this._key) >> 24) & 255);
        },
      }),
      (a.DVector1 = new s()),
      (a.DVector2 = new s()),
      (a.Distance = function (t, i, e) {
        let s = e.proxyA,
          n = e.proxyB,
          l = e.transformA,
          m = e.transformB,
          r = a.s_simplex;
        r.ReadCache(i, s, l, n, m);
        let _ = r.m_vertices,
          h = a.s_saveA,
          c = a.s_saveB,
          y = 0,
          p = 0,
          u = 0;
        t: for (; u < 20; ) {
          for (y = r.m_count, p = 0; p < y; p++) (h[p] = _[p].indexA), (c[p] = _[p].indexB);
          if ((3 === r.m_count ? r.Solve3() : 2 === r.m_count && r.Solve2(), 3 === r.m_count))
            break;
          let t = a.DVector1;
          if (2 === r.m_count) {
            let i = r.m_v2.w.x - r.m_v1.w.x,
              o = r.m_v2.w.y - r.m_v1.w.y;
            i * -r.m_v1.w.y - o * -r.m_v1.w.x > 0
              ? ((t.x = -o), (t.y = i))
              : ((t.x = o), (t.y = -i));
          } else {
            if (1 !== r.m_count) break;
            (t.x = -r.m_v1.w.x), (t.y = -r.m_v1.w.y);
          }
          if (t.x * t.x + t.y * t.y < Number.MIN_VALUE) break;
          let i = _[r.m_count];
          if (
            ((a.DVector2.x = -t.x * l.R.col1.x - t.y * l.R.col1.y),
            (a.DVector2.y = -t.x * l.R.col2.x - t.y * l.R.col2.y),
            (i.indexA = s.GetSupport(a.DVector2)),
            (a.DVector2.x = t.x * m.R.col1.x + t.y * m.R.col1.y),
            (a.DVector2.y = t.x * m.R.col2.x + t.y * m.R.col2.y),
            (i.indexB = n.GetSupport(a.DVector2)),
            void 0 !== i.w)
          ) {
            let t = s.GetVertex(i.indexA);
            (i.wA.x = l.R.col1.x * t.x + l.R.col2.x * t.y + l.position.x),
              (i.wA.y = l.R.col1.y * t.x + l.R.col2.y * t.y + l.position.y);
            let o = n.GetVertex(i.indexB);
            (i.wB.x = m.R.col1.x * o.x + m.R.col2.x * o.y + m.position.x),
              (i.wB.y = m.R.col1.y * o.x + m.R.col2.y * o.y + m.position.y),
              (i.w.x = i.wB.x - i.wA.x),
              (i.w.y = i.wB.y - i.wA.y);
          } else
            (i.wA = o.MulX(l, s.GetVertex(i.indexA))),
              (i.wB = o.MulX(m, n.GetVertex(i.indexB))),
              (i.w = o.SubtractVV(i.wB, i.wA));
          for (++u, p = 0; p < y; p++) if (i.indexA === h[p] && i.indexB === c[p]) break t;
          ++r.m_count;
        }
        (a.b2_gjkMaxIters = Math.max(a.b2_gjkMaxIters, u)),
          r.GetWitnessPoints(t.pointA, t.pointB),
          (t.iterations = u),
          r.WriteCache(i);
        let x = t.pointB.x - t.pointA.x,
          d = t.pointB.y - t.pointA.y;
        if (((t.distance = Math.sqrt(x * x + d * d)), e.useRadii))
          if (t.distance < Number.EPSILON) {
            let i = t.pointA.x + t.pointB.x,
              o = t.pointA.y + t.pointB.y;
            (t.pointA.x = i),
              (t.pointA.y = o),
              (t.pointB.x = i),
              (t.pointB.y = o),
              (t.distance = 0);
          } else
            t.distance >= Number.MIN_VALUE && ((x /= t.distance), (d /= t.distance)),
              (t.distance = Math.max(0, t.distance - s.m_radius - n.m_radius)),
              (t.pointA.x += s.m_radius * x),
              (t.pointA.y += s.m_radius * d),
              (t.pointB.x -= n.m_radius * x),
              (t.pointB.y -= n.m_radius * d);
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Collision.b2Distance.s_simplex = new C()),
          (Box2D.Collision.b2Distance.s_saveA = [0, 0, 0]),
          (Box2D.Collision.b2Distance.s_saveB = [0, 0, 0]);
      }),
      (c.prototype.Set = function (i) {
        i.m_type === t.e_circleShape
          ? ((this.m_vertices = [i.m_p, !0]), (this.m_count = 1), (this.m_radius = i.m_radius))
          : i.m_type === t.e_polygonShape &&
            ((this.m_vertices = i.m_vertices),
            (this.m_count = i.m_vertexCount),
            (this.m_radius = i.m_radius));
      }),
      (c.prototype.GetSupport = function (t) {
        let i = 0,
          o = this.m_vertices[0].x * t.x + this.m_vertices[0].y * t.y;
        for (let e = 1; e < this.m_count; ++e) {
          let s = this.m_vertices[e].x * t.x + this.m_vertices[e].y * t.y;
          s > o && ((i = e), (o = s));
        }
        return i;
      }),
      (c.prototype.GetSupportVertex = function (t) {
        let i = 0,
          o = this.m_vertices[0].x * t.x + this.m_vertices[0].y * t.y;
        for (let e = 1; e < this.m_count; ++e) {
          let s = this.m_vertices[e].x * t.x + this.m_vertices[e].y * t.y;
          s > o && ((i = e), (o = s));
        }
        return this.m_vertices[i];
      }),
      (c.prototype.GetVertexCount = function () {
        return this.m_count;
      }),
      (c.prototype.GetVertex = function (t) {
        return this.m_vertices[t];
      }),
      (y.prototype.CreateProxy = function (t, o) {
        let e = this.AllocateNode(),
          s = i.b2_aabbExtension,
          n = i.b2_aabbExtension;
        return (
          (e.aabb.lowerBound.x = t.lowerBound.x - s),
          (e.aabb.lowerBound.y = t.lowerBound.y - n),
          (e.aabb.upperBound.x = t.upperBound.x + s),
          (e.aabb.upperBound.y = t.upperBound.y + n),
          (e.userData = o),
          this.InsertLeaf(e),
          e
        );
      }),
      (y.prototype.DestroyProxy = function (t) {
        this.RemoveLeaf(t), this.FreeNode(t);
      }),
      (y.prototype.MoveProxy = function (t, o, e) {
        if (t.aabb.Contains(o)) return !1;
        this.RemoveLeaf(t);
        let s = i.b2_aabbExtension + i.b2_aabbMultiplier * (e.x > 0 ? e.x : -e.x),
          n = i.b2_aabbExtension + i.b2_aabbMultiplier * (e.y > 0 ? e.y : -e.y);
        return (
          (t.aabb.lowerBound.x = o.lowerBound.x - s),
          (t.aabb.lowerBound.y = o.lowerBound.y - n),
          (t.aabb.upperBound.x = o.upperBound.x + s),
          (t.aabb.upperBound.y = o.upperBound.y + n),
          this.InsertLeaf(t),
          !0
        );
      }),
      (y.prototype.MoveProxy2 = function (t, i) {
        return (
          this.RemoveLeaf(t),
          (t.aabb.lowerBound.x = i.lowerBound.x),
          (t.aabb.lowerBound.y = i.lowerBound.y),
          (t.aabb.upperBound.x = i.upperBound.x),
          (t.aabb.upperBound.y = i.upperBound.y),
          this.InsertLeaf(t),
          !0
        );
      }),
      (y.prototype.Rebalance = function (t) {
        if (null !== this.m_root)
          for (let i = 0; i < t; i++) {
            let t = this.m_root,
              i = 0;
            for (; null != t.child1; )
              (t = (this.m_path >> i) & 1 ? t.child2 : t.child1), (i = (i + 1) & 31);
            ++this.m_path, this.RemoveLeaf(t), this.InsertLeaf(t);
          }
      }),
      (y.prototype.GetFatAABB = function (t) {
        return t.aabb;
      }),
      (y.prototype.GetUserData = function (t) {
        return t.userData;
      }),
      (y.prototype.Query = function (t, i, o, e) {
        if (null === this.m_root) return;
        let s = [this.m_root],
          n = 1;
        for (; n > 0; ) {
          let l = s[--n];
          if (l.aabb.TestOverlap(i))
            if (null == l.child1) {
              if (l !== o && !t(l, o, e)) return;
            } else (s[n++] = l.child1), (s[n++] = l.child2);
        }
      }),
      (y.b2AABBInst = new n()),
      (y.b2RayCastInputInst = new B()),
      (y.prototype.RayCast = function (t, i) {
        let o = t.p1,
          e = t.p2,
          s = o.x - e.x,
          n = e.y - o.y,
          l = Math.sqrt(s * s + n * n);
        l > 0 && ((s /= l), (n /= l));
        let m = Math.abs(n),
          r = Math.abs(s),
          a = t.maxFraction,
          _ = o.x + a * (e.x - o.x),
          h = o.y + a * (e.y - o.y);
        (y.b2AABBInst.lowerBound.x = Math.min(o.x, _)),
          (y.b2AABBInst.lowerBound.y = Math.min(o.y, h)),
          (y.b2AABBInst.upperBound.x = Math.max(o.x, _)),
          (y.b2AABBInst.upperBound.y = Math.max(o.y, h));
        let c = [this.m_root],
          p = 1;
        for (; p > 0; ) {
          let l = c[--p];
          if (!l || !l.aabb.TestOverlap(y.b2AABBInst)) continue;
          let u = 0.5 * (l.aabb.lowerBound.x + l.aabb.upperBound.x),
            x = 0.5 * (l.aabb.lowerBound.y + l.aabb.upperBound.y),
            d = 0.5 * (l.aabb.upperBound.x - l.aabb.lowerBound.x),
            f = 0.5 * (l.aabb.upperBound.y - l.aabb.lowerBound.y);
          if (!(Math.abs(n * (o.x - u) + s * (o.y - x)) - m * d - r * f > 0))
            if (null == l.child1) {
              (y.b2RayCastInputInst.p1 = t.p1),
                (y.b2RayCastInputInst.p2 = t.p2),
                (y.b2RayCastInputInst.maxFraction = a);
              let s = Box2D.Dynamics.b2World.RayCastCallback(y.b2RayCastInputInst, l, i);
              if (0 === s) return;
              s > 0 &&
                ((a = s),
                (_ = o.x + a * (e.x - o.x)),
                (h = o.y + a * (e.y - o.y)),
                (y.b2AABBInst.lowerBound.x = Math.min(o.x, _)),
                (y.b2AABBInst.lowerBound.y = Math.min(o.y, h)),
                (y.b2AABBInst.upperBound.x = Math.max(o.x, _)),
                (y.b2AABBInst.upperBound.y = Math.max(o.y, h)));
            } else (c[p++] = l.child1), (c[p++] = l.child2);
        }
      }),
      (y.prototype.AllocateNode = function () {
        if (this.m_freeList) {
          let t = this.m_freeList;
          return (
            (this.m_freeList = t.parent), (t.parent = null), (t.child1 = null), (t.child2 = null), t
          );
        }
        return new u();
      }),
      (y.prototype.FreeNode = function (t) {
        (t.parent = this.m_freeList), (this.m_freeList = t);
      }),
      (y.prototype.InsertLeaf = function (t) {
        if ((++this.m_insertionCount, null == this.m_root))
          return (this.m_root = t), void (this.m_root.parent = null);
        let i = (t.aabb.lowerBound.x + t.aabb.upperBound.x) / 2,
          o = (t.aabb.lowerBound.y + t.aabb.upperBound.y) / 2,
          e = this.m_root;
        if (null != e.child1)
          do {
            let t = e.child1,
              s = e.child2;
            e =
              Math.abs((t.aabb.lowerBound.x + t.aabb.upperBound.x) / 2 - i) +
                Math.abs((t.aabb.lowerBound.y + t.aabb.upperBound.y) / 2 - o) <
              Math.abs((s.aabb.lowerBound.x + s.aabb.upperBound.x) / 2 - i) +
                Math.abs((s.aabb.lowerBound.y + s.aabb.upperBound.y) / 2 - o)
                ? t
                : s;
          } while (null != e.child1);
        let s = e.parent,
          n = this.AllocateNode();
        if (((n.parent = s), (n.userData = null), n.aabb.Combine(t.aabb, e.aabb), s)) {
          e.parent.child1 === e ? (s.child1 = n) : (s.child2 = n),
            (n.child1 = e),
            (n.child2 = t),
            (e.parent = n),
            (t.parent = n);
          do {
            if (s.aabb.Contains(n.aabb)) break;
            s.aabb.Combine(s.child1.aabb, s.child2.aabb), (n = s), (s = s.parent);
          } while (s);
        } else (n.child1 = e), (n.child2 = t), (e.parent = n), (t.parent = n), (this.m_root = n);
      }),
      (y.b2AABBBuffer = new n()),
      (y.prototype.RemoveLeaf = function (t) {
        if (t === this.m_root) return void (this.m_root = null);
        let i,
          o = t.parent,
          e = o.parent;
        if (((i = o.child1 === t ? o.child2 : o.child1), e))
          for (
            e.child1 === o ? (e.child1 = i) : (e.child2 = i), i.parent = e, this.FreeNode(o);
            e;

          ) {
            let t = e.aabb;
            if (
              ((e.aabb = y.b2AABBBuffer),
              (e.aabb.lowerBound.x = Math.min(
                e.child1.aabb.lowerBound.x,
                e.child2.aabb.lowerBound.x
              )),
              (e.aabb.lowerBound.y = Math.min(
                e.child1.aabb.lowerBound.y,
                e.child2.aabb.lowerBound.y
              )),
              (e.aabb.upperBound.x = Math.max(
                e.child1.aabb.upperBound.x,
                e.child2.aabb.upperBound.x
              )),
              (e.aabb.upperBound.y = Math.max(
                e.child1.aabb.upperBound.y,
                e.child2.aabb.upperBound.y
              )),
              (y.b2AABBBuffer = t),
              t.Contains(e.aabb))
            )
              break;
            e = e.parent;
          }
        else (this.m_root = i), (i.parent = null), this.FreeNode(o);
      }),
      (p.prototype.CreateProxy = function (t, i) {
        let o = this.m_tree.CreateProxy(t, i);
        return ++this.m_proxyCount, this.BufferMove(o), o;
      }),
      (p.prototype.DestroyProxy = function (t) {
        this.UnBufferMove(t), --this.m_proxyCount, this.m_tree.DestroyProxy(t);
      }),
      (p.prototype.MoveProxy = function (t, i, o) {
        this.m_tree.MoveProxy(t, i, o) && this.BufferMove(t);
      }),
      (p.prototype.MoveProxy2 = function (t, i) {
        !t.aabb.Contains(i) && this.m_tree.MoveProxy2(t, i) && this.BufferMove(t);
      }),
      (p.prototype.TestOverlap = function (t, i) {
        return t.aabb.TestOverlap(i.aabb);
      }),
      (p.prototype.GetUserData = function (t) {
        return t.userData;
      }),
      (p.prototype.GetFatAABB = function (t) {
        return t.aabb;
      }),
      (p.prototype.GetProxyCount = function () {
        return this.m_proxyCount;
      }),
      (p.QueryCallback = function (t, i, o) {
        if (
          t.userData.m_body._parent &&
          i.userData.m_body._parent &&
          !t.userData.m_body._local &&
          !i.userData.m_body._local
        )
          return !0;
        if (o.m_pairCount === o.m_pairBuffer.length) o.m_pairBuffer.push(new x(i, t));
        else {
          let e = o.m_pairBuffer[o.m_pairCount];
          (e.proxyA = i), (e.proxyB = t);
        }
        return ++o.m_pairCount, !0;
      }),
      (p.prototype.UpdatePairs = function (t) {
        let i, o, e;
        this.m_pairCount = 0;
        for (let t = 0; t < this.m_moveBuffer.length; ++t)
          (i = this.m_moveBuffer[t]), this.m_tree.Query(p.QueryCallback, i.aabb, i, this);
        this.m_moveBuffer.length = 0;
        for (let i = 0; i < this.m_pairCount; )
          for (
            (e = this.m_pairBuffer[i]).proxyA.userData.m_body !== e.proxyB.userData.m_body &&
              t.AddPair(e.proxyA.userData, e.proxyB.userData),
              ++i;
            i < this.m_pairCount &&
            (o = this.m_pairBuffer[i]).proxyB === e.proxyB &&
            o.proxyA === e.proxyA;

          )
            ++i;
      }),
      (p.prototype.Query = function (t, i, o) {
        this.m_tree.Query(t, i, o);
      }),
      (p.prototype.RayCast = function (t, i) {
        this.m_tree.RayCast(t, i);
      }),
      (p.prototype.Validate = function () {}),
      (p.prototype.Rebalance = function (t) {
        this.m_tree.Rebalance(t);
      }),
      (p.prototype.BufferMove = function (t) {
        this.m_moveBuffer[this.m_moveBuffer.length] = t;
      }),
      (p.prototype.UnBufferMove = function (t) {
        for (let i = 0, o = this.m_moveBuffer.length; i < o; i++)
          this.m_moveBuffer[i] === t && fastSplice(this.m_moveBuffer, i--);
      }),
      (p.__implements = {}),
      (p.__implements[I] = !0),
      (u.prototype.IsLeaf = function () {
        return null == this.child1;
      }),
      (d.prototype.Reset = function () {
        for (let t = 0; t < i.b2_maxManifoldPoints; t++) this.m_points[t].Reset();
        this.m_localPlaneNormal.SetZero(),
          this.m_localPoint.SetZero(),
          (this.m_type = 0),
          (this.m_pointCount = 0);
      }),
      (d.prototype.Set = function (t) {
        this.m_pointCount = t.m_pointCount;
        for (let o = 0; o < i.b2_maxManifoldPoints; o++) this.m_points[o].Set(t.m_points[o]);
        this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),
          this.m_localPoint.SetV(t.m_localPoint),
          (this.m_type = t.m_type);
      }),
      (d.prototype.Copy = function () {
        let t = new d();
        return t.Set(this), t;
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Collision.b2Manifold.e_circles = 1),
          (Box2D.Collision.b2Manifold.e_faceA = 2),
          (Box2D.Collision.b2Manifold.e_faceB = 4);
      }),
      (f.b2ManifoldPoint = function () {
        (this.m_localPoint = new s()), (this.m_id = new r());
      }),
      (f.prototype.b2ManifoldPoint = function () {
        this.Reset();
      }),
      (f.prototype.Reset = function () {
        this.m_localPoint.SetZero(),
          (this.m_normalImpulse = 0),
          (this.m_tangentImpulse = 0),
          (this.m_id.key = 0);
      }),
      (f.prototype.Set = function (t) {
        this.m_localPoint.SetV(t.m_localPoint),
          (this.m_normalImpulse = t.m_normalImpulse),
          (this.m_tangentImpulse = t.m_tangentImpulse),
          this.m_id.Set(t.m_id);
      }),
      (b.b2Point = function () {
        this.p = new s();
      }),
      (b.prototype.Support = function (t, i, o) {
        return void 0 === i && (i = 0), void 0 === o && (o = 0), this.p;
      }),
      (b.prototype.GetFirstVertex = function (t) {
        return this.p;
      }),
      (A.prototype.TestSegment = function (t, i, o, e) {
        let s = o.p1,
          n = o.p2.x - s.x,
          l = o.p2.y - s.y,
          m = this.p2.x - this.p1.x,
          r = this.p2.y - this.p1.y,
          a = -m,
          _ = 100 * Number.MIN_VALUE,
          h = -(n * r + l * a);
        if (h > _) {
          let o = s.x - this.p1.x,
            m = s.y - this.p1.y,
            c = o * r + m * a;
          if (0 <= c && c <= e * h) {
            let e = -n * m + l * o;
            if (-_ * h <= e && e <= h * (1 + _)) {
              c /= h;
              let o = Math.sqrt(r * r + a * a);
              return (r /= o), (a /= o), (t[0] = c), i.Set(r, a), !0;
            }
          }
        }
        return !1;
      }),
      (A.prototype.Extend = function (t) {
        this.ExtendForward(t), this.ExtendBackward(t);
      }),
      (A.prototype.ExtendForward = function (t) {
        let i = this.p2.x - this.p1.x,
          o = this.p2.y - this.p1.y,
          e = Math.min(
            i > 0
              ? (t.upperBound.x - this.p1.x) / i
              : i < 0
              ? (t.lowerBound.x - this.p1.x) / i
              : Number.POSITIVE_INFINITY,
            o > 0
              ? (t.upperBound.y - this.p1.y) / o
              : o < 0
              ? (t.lowerBound.y - this.p1.y) / o
              : Number.POSITIVE_INFINITY
          );
        (this.p2.x = this.p1.x + i * e), (this.p2.y = this.p1.y + o * e);
      }),
      (A.prototype.ExtendBackward = function (t) {
        let i = -this.p2.x + this.p1.x,
          o = -this.p2.y + this.p1.y,
          e = Math.min(
            i > 0
              ? (t.upperBound.x - this.p2.x) / i
              : i < 0
              ? (t.lowerBound.x - this.p2.x) / i
              : Number.POSITIVE_INFINITY,
            o > 0
              ? (t.upperBound.y - this.p2.y) / o
              : o < 0
              ? (t.lowerBound.y - this.p2.y) / o
              : Number.POSITIVE_INFINITY
          );
        (this.p1.x = this.p2.x + i * e), (this.p1.y = this.p2.y + o * e);
      }),
      (D.prototype.Initialize = function (t, i, e, n, l) {
        if (((this.m_proxyA = i), (this.m_proxyB = n), 1 === t.count)) {
          this.m_type = D.e_points;
          let i = this.m_proxyA.m_vertices[t.indexA[0]],
            o = this.m_proxyB.m_vertices[t.indexB[0]],
            s = i,
            n = e.R,
            m = e.position.x + (n.col1.x * s.x + n.col2.x * s.y),
            r = e.position.y + (n.col1.y * s.x + n.col2.y * s.y);
          (s = o), (n = l.R);
          let a = l.position.x + (n.col1.x * s.x + n.col2.x * s.y),
            _ = l.position.y + (n.col1.y * s.x + n.col2.y * s.y);
          (this.m_axis.x = a - m), (this.m_axis.y = _ - r), this.m_axis.Normalize();
        } else if (t.indexB[0] === t.indexB[1]) {
          this.m_type = D.e_faceA;
          let i = this.m_proxyA.m_vertices[t.indexA[0]],
            o = this.m_proxyA.m_vertices[t.indexA[1]],
            s = this.m_proxyB.m_vertices[t.indexB[0]];
          (this.m_localPoint.x = 0.5 * (i.x + o.x)),
            (this.m_localPoint.y = 0.5 * (i.y + o.y)),
            (this.m_axis.x = o.y - i.y),
            (this.m_axis.y = -1 * (o.x - i.x)),
            this.m_axis.Normalize();
          let n = this.m_axis,
            m = e.R,
            r = m.col1.x * n.x + m.col2.x * n.y,
            a = m.col1.y * n.x + m.col2.y * n.y;
          (n = this.m_localPoint), (m = e.R);
          let _ = e.position.x + (m.col1.x * n.x + m.col2.x * n.y),
            h = e.position.y + (m.col1.y * n.x + m.col2.y * n.y);
          (n = s),
            (m = l.R),
            (l.position.x + (m.col1.x * n.x + m.col2.x * n.y) - _) * r +
              (l.position.y + (m.col1.y * n.x + m.col2.y * n.y) - h) * a <
              0 && this.m_axis.NegativeSelf();
        } else if (t.indexA[0] == t.indexA[0]) {
          this.m_type = D.e_faceB;
          let i = this.m_proxyB.m_vertices[t.indexB[0]],
            o = this.m_proxyB.m_vertices[t.indexB[1]],
            s = this.m_proxyA.m_vertices[t.indexA[0]];
          (this.m_localPoint.x = 0.5 * (i.x + o.x)),
            (this.m_localPoint.y = 0.5 * (i.y + o.y)),
            (this.m_axis.x = o.y - i.y),
            (this.m_axis.y = -1 * (o.x - i.x)),
            this.m_axis.Normalize();
          let n = this.m_axis,
            m = l.R,
            r = m.col1.x * n.x + m.col2.x * n.y,
            a = m.col1.y * n.x + m.col2.y * n.y;
          (n = this.m_localPoint), (m = l.R);
          let _ = l.position.x + (m.col1.x * n.x + m.col2.x * n.y),
            h = l.position.y + (m.col1.y * n.x + m.col2.y * n.y);
          (n = s),
            (m = e.R),
            (e.position.x + (m.col1.x * n.x + m.col2.x * n.y) - _) * r +
              (e.position.y + (m.col1.y * n.x + m.col2.y * n.y) - h) * a <
              0 && this.m_axis.NegativeSelf();
        } else {
          let i = this.m_proxyA.m_vertices[t.indexA[0]],
            n = this.m_proxyA.m_vertices[t.indexA[1]],
            m = this.m_proxyB.m_vertices[t.indexB[0]],
            r = this.m_proxyB.m_vertices[t.indexB[1]],
            a = o.SubtractVV(n, i),
            _ = o.SubtractVV(r, m),
            h = o.MulMV(e.R, a),
            c = o.MulMV(l.R, _),
            y = h.x * h.x + h.y * h.y,
            p = c.x * c.x + c.y * c.y,
            u = o.SubtractVV(c, h),
            x = h.x * u.x + h.y * u.y,
            d = c.x * u.x + c.y * u.y,
            f = h.x * c.x + h.y * c.y,
            b = y * p - f * f,
            B = 0;
          0 !== b && (B = Math.min(Math.max((f * d - x * p) / b, 0), 1));
          let A = (f * B + d) / p;
          A < 0 && ((A = 0), (B = Math.min(Math.max((f - x) / y, 0), 1)));
          let C = new s();
          (C.x = i.x + B * (n.x - i.x)), (C.y = i.y + B * (n.y - i.y));
          let w = new s();
          (w.x = m.x + B * (r.x - m.x)),
            (w.y = m.y + B * (r.y - m.y)),
            0 === B || 1 === B
              ? ((this.m_type = D.e_faceB),
                (this.m_axis.x = r.y - m.y),
                (this.m_axis.y = -1 * (r.x - m.x)),
                this.m_axis.Normalize(),
                (this.m_localPoint = w),
                B < 0 && this.m_axis.NegativeSelf())
              : ((this.m_type = D.e_faceA),
                (this.m_axis.x = n.y - i.y),
                (this.m_axis.y = -1 * (n.x - i.x)),
                (this.m_localPoint = C),
                B < 0 && this.m_axis.NegativeSelf());
        }
      }),
      (D.Axis = new s()),
      (D.prototype.Evaluate = function (t, i) {
        if (this.m_type === D.e_faceB) {
          let o = i.R.col1.x * this.m_axis.x + i.R.col2.x * this.m_axis.y,
            e = i.R.col1.y * this.m_axis.x + i.R.col2.y * this.m_axis.y;
          (D.Axis.x = -o * t.R.col1.x - e * t.R.col1.y),
            (D.Axis.y = -o * t.R.col2.x - e * t.R.col2.y);
          let s = this.m_proxyA.GetSupportVertex(D.Axis);
          return (
            (t.R.col1.x * s.x +
              t.R.col2.x * s.y +
              t.position.x -
              (i.R.col1.x * this.m_localPoint.x +
                i.R.col2.x * this.m_localPoint.y +
                i.position.x)) *
              o +
            (t.R.col1.y * s.x +
              t.R.col2.y * s.y +
              t.position.y -
              (i.R.col1.y * this.m_localPoint.x +
                i.R.col2.y * this.m_localPoint.y +
                i.position.y)) *
              e
          );
        }
        if (this.m_type === D.e_faceA) {
          let o = t.R.col1.x * this.m_axis.x + t.R.col2.x * this.m_axis.y,
            e = t.R.col1.y * this.m_axis.x + t.R.col2.y * this.m_axis.y;
          (D.Axis.x = -o * i.R.col1.x - e * i.R.col1.y),
            (D.Axis.y = -o * i.R.col2.x - e * i.R.col2.y);
          let s = this.m_proxyB.GetSupportVertex(D.Axis);
          return (
            (i.R.col1.x * s.x +
              i.R.col2.x * s.y +
              i.position.x -
              (t.R.col1.x * this.m_localPoint.x +
                t.R.col2.x * this.m_localPoint.y +
                t.position.x)) *
              o +
            (i.R.col1.y * s.x +
              i.R.col2.y * s.y +
              i.position.y -
              (t.R.col1.y * this.m_localPoint.x +
                t.R.col2.y * this.m_localPoint.y +
                t.position.y)) *
              e
          );
        }
        if (this.m_type === D.e_points) {
          (D.Axis.x = this.m_axis.x * t.R.col1.x + this.m_axis.y * t.R.col1.y),
            (D.Axis.y = this.m_axis.x * t.R.col2.x + this.m_axis.y * t.R.col2.y);
          let o = this.m_proxyA.GetSupportVertex(D.Axis);
          (D.Axis.x = -this.m_axis.x * i.R.col1.x - this.m_axis.y * i.R.col1.y),
            (D.Axis.y = -this.m_axis.x * i.R.col2.x - this.m_axis.y * i.R.col2.y);
          let e = this.m_proxyB.GetSupportVertex(D.Axis);
          return (
            (i.R.col1.x * e.x +
              i.R.col2.x * e.y +
              i.position.x -
              (t.R.col1.x * o.x + t.R.col2.x * o.y + t.position.x)) *
              this.m_axis.x +
            (i.R.col1.y * e.x +
              i.R.col2.y * e.y +
              i.position.y -
              (t.R.col1.y * o.x + t.R.col2.y * o.y + t.position.y)) *
              this.m_axis.y
          );
        }
        return 0;
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Collision.b2SeparationFunction.e_points = 1),
          (Box2D.Collision.b2SeparationFunction.e_faceA = 2),
          (Box2D.Collision.b2SeparationFunction.e_faceB = 4);
      }),
      (C.prototype.ReadCache = function (t, i, e, n, l) {
        this.m_count = t.count;
        let m = this.m_vertices,
          r = this.m_count;
        for (; r > 0; ) {
          let o = m[--r];
          (o.indexA = t.indexA[r]), (o.indexB = t.indexB[r]);
          let s = i.m_vertices[o.indexA],
            a = n.m_vertices[o.indexB];
          (o.wA.x = e.R.col1.x * s.x + e.R.col2.x * s.y + e.position.x),
            (o.wA.y = e.R.col1.y * s.x + e.R.col2.y * s.y + e.position.y),
            (o.wB.x = l.R.col1.x * a.x + l.R.col2.x * a.y + l.position.x),
            (o.wB.y = l.R.col1.y * a.x + l.R.col2.y * a.y + l.position.y),
            (o.w.x = o.wB.x - o.wA.x),
            (o.w.y = o.wB.y - o.wA.y),
            (o.a = 0);
        }
        if (this.m_count > 1) {
          let i = t.metric,
            o = this.GetMetric();
          (o < 0.5 * i || 2 * i < o || o < Number.MIN_VALUE) && (this.m_count = 0);
        }
        if (0 === this.m_count) {
          let t = m[0];
          if (((t.indexA = 0), (t.indexB = 0), void 0 !== t.w)) {
            let o = i.m_vertices[0],
              s = n.m_vertices[0];
            (t.wA.x = e.R.col1.x * o.x + e.R.col2.x * o.y + e.position.x),
              (t.wA.y = e.R.col1.y * o.x + e.R.col2.y * o.y + e.position.y),
              (t.wB.x = l.R.col1.x * s.x + l.R.col2.x * s.y + l.position.x),
              (t.wB.y = l.R.col1.y * s.x + l.R.col2.y * s.y + l.position.y),
              (t.w.x = t.wB.x - t.wA.x),
              (t.w.y = t.wB.y - t.wA.y);
          } else
            (t.wA = o.MulX(e, i.m_vertices[0])),
              (t.wB = o.MulX(l, n.m_vertices[0])),
              (t.w = new s(t.wB.x - t.wA.x, t.wB.y - t.wA.y));
          this.m_count = 1;
        }
      }),
      (C.prototype.WriteCache = function (t) {
        (t.metric = this.GetMetric()), (t.count = this.m_count);
        let i = this.m_count;
        for (; i--; )
          (t.indexA[i] = this.m_vertices[i].indexA), (t.indexB[i] = this.m_vertices[i].indexB);
      }),
      (C.prototype.GetClosestPoint = function () {
        switch (this.m_count) {
          case 1:
            return this.m_v1.w;
          case 2:
            return new s(
              this.m_v1.a * this.m_v1.w.x + this.m_v2.a * this.m_v2.w.x,
              this.m_v1.a * this.m_v1.w.y + this.m_v2.a * this.m_v2.w.y
            );
          default:
            return new s();
        }
      }),
      (C.prototype.GetWitnessPoints = function (t, i) {
        2 === this.m_count
          ? ((t.x = this.m_v1.a * this.m_v1.wA.x + this.m_v2.a * this.m_v2.wA.x),
            (t.y = this.m_v1.a * this.m_v1.wA.y + this.m_v2.a * this.m_v2.wA.y),
            (i.x = this.m_v1.a * this.m_v1.wB.x + this.m_v2.a * this.m_v2.wB.x),
            (i.y = this.m_v1.a * this.m_v1.wB.y + this.m_v2.a * this.m_v2.wB.y))
          : 1 === this.m_count
          ? ((t.x = this.m_v1.wA.x),
            (t.y = this.m_v1.wA.y),
            (i.x = this.m_v1.wB.x),
            (i.y = this.m_v1.wB.y))
          : 3 === this.m_count &&
            ((i.x = t.x =
              this.m_v1.a * this.m_v1.wA.x +
              this.m_v2.a * this.m_v2.wA.x +
              this.m_v3.a * this.m_v3.wA.x),
            (i.y = t.y =
              this.m_v1.a * this.m_v1.wA.y +
              this.m_v2.a * this.m_v2.wA.y +
              this.m_v3.a * this.m_v3.wA.y));
      }),
      (C.prototype.GetMetric = function () {
        if (3 === this.m_count)
          return (
            (this.m_v2.w.x - this.m_v1.w.x) * (this.m_v3.w.y - this.m_v1.w.y) -
            (this.m_v2.w.y - this.m_v1.w.y) * (this.m_v3.w.x - this.m_v1.w.x)
          );
        if (2 === this.m_count) {
          let t = this.m_v1.w.x - this.m_v2.w.x,
            i = this.m_v1.w.y - this.m_v2.w.y;
          return Math.sqrt(t * t + i * i);
        }
        return 0;
      }),
      (C.prototype.Solve2 = function () {
        let t = this.m_v1.w,
          i = this.m_v2.w,
          o = i.x - t.x,
          e = i.y - t.y,
          s = -(t.x * o + t.y * e);
        if (s <= 0) return (this.m_v1.a = 1), void (this.m_count = 1);
        let n = i.x * o + i.y * e;
        if (n <= 0) return (this.m_v2.a = 1), (this.m_count = 1), void this.m_v1.Set(this.m_v2);
        let l = 1 / (n + s);
        (this.m_v1.a = n * l), (this.m_v2.a = s * l), (this.m_count = 2);
      }),
      (C.prototype.Solve3 = function () {
        let t = this.m_v1.w,
          i = this.m_v2.w,
          o = this.m_v3.w,
          e = i.x - t.x,
          s = i.y - t.y,
          n = -(t.x * e + t.y * s),
          l = o.x - t.x,
          m = o.y - t.y,
          r = -(t.x * l + t.y * m);
        if (n <= 0 && r <= 0) return (this.m_v1.a = 1), void (this.m_count = 1);
        let a = i.x * e + i.y * s,
          _ = e * m - s * l,
          h = _ * (t.x * i.y - t.y * i.x);
        if (a > 0 && n > 0 && h <= 0) {
          let t = 1 / (a + n);
          return (this.m_v1.a = a * t), (this.m_v2.a = n * t), void (this.m_count = 2);
        }
        let c = _ * (o.x * t.y - o.y * t.x),
          y = o.x * l + o.y * m;
        if (y > 0 && r > 0 && c <= 0) {
          let t = 1 / (y + r);
          return (
            (this.m_v1.a = y * t),
            (this.m_v3.a = r * t),
            (this.m_count = 2),
            void this.m_v2.Set(this.m_v3)
          );
        }
        let p = o.y - i.y,
          u = o.x - i.x,
          x = -(i.x * u + i.y * p);
        if (a <= 0 && x <= 0)
          return (this.m_v2.a = 1), (this.m_count = 1), void this.m_v1.Set(this.m_v2);
        let d = o.x * u + o.y * p;
        if (y <= 0 && d <= 0)
          return (this.m_v3.a = 1), (this.m_count = 1), void this.m_v1.Set(this.m_v3);
        let f = _ * (i.x * o.y - i.y * o.x);
        if (d > 0 && x > 0 && f <= 0) {
          let t = 1 / (d + x);
          return (
            (this.m_v2.a = d * t),
            (this.m_v3.a = x * t),
            (this.m_count = 2),
            void this.m_v1.Set(this.m_v3)
          );
        }
        let b = 1 / (f + c + h);
        (this.m_v1.a = f * b), (this.m_v2.a = c * b), (this.m_v3.a = h * b), (this.m_count = 3);
      }),
      (v.prototype.Set = function (t) {
        this.wA.SetV(t.wA),
          this.wB.SetV(t.wB),
          this.w.SetV(t.w),
          (this.a = t.a),
          (this.indexA = t.indexA),
          (this.indexB = t.indexB);
      }),
      (g.TimeOfImpact = function (t) {
        ++g.b2_toiCalls;
        let i = t.proxyA,
          o = t.proxyB,
          e = t.sweepA,
          s = t.sweepB,
          n = i.m_radius + o.m_radius,
          l = t.tolerance,
          m = 0,
          r = 0,
          _ = 0;
        for (g.s_cache.count = 0, g.s_distanceInput.useRadii = !1; ; ) {
          if (
            (e.GetTransform(g.s_xfA, m),
            s.GetTransform(g.s_xfB, m),
            (g.s_distanceInput.proxyA = i),
            (g.s_distanceInput.proxyB = o),
            (g.s_distanceInput.transformA = g.s_xfA),
            (g.s_distanceInput.transformB = g.s_xfB),
            a.Distance(g.s_distanceOutput, g.s_cache, g.s_distanceInput),
            g.s_distanceOutput.distance <= 0)
          ) {
            m = 1;
            break;
          }
          g.s_fcn.Initialize(g.s_cache, i, g.s_xfA, o, g.s_xfB);
          let t = g.s_fcn.Evaluate(g.s_xfA, g.s_xfB);
          if (t <= 0) {
            m = 1;
            break;
          }
          if (
            (0 === r && (_ = t > n ? Math.max(n - l, 0.75 * n) : Math.max(t - l, 0.02 * n)),
            t - _ < 0.5 * l)
          ) {
            0 === r && (m = 1);
            break;
          }
          let h = m,
            c = m,
            y = 1,
            p = t;
          e.GetTransform(g.s_xfA, y), s.GetTransform(g.s_xfB, y);
          let u = g.s_fcn.Evaluate(g.s_xfA, g.s_xfB);
          if (u >= _) {
            m = 1;
            break;
          }
          let x = 0,
            d = 0;
          for (;;) {
            (d = 1 & x ? c + ((_ - p) * (y - c)) / (u - p) : 0.5 * (c + y)),
              e.GetTransform(g.s_xfA, d),
              s.GetTransform(g.s_xfB, d);
            let t = g.s_fcn.Evaluate(g.s_xfA, g.s_xfB);
            if (Math.abs(t - _) < 0.025 * l) {
              h = d;
              break;
            }
            if ((t > _ ? ((c = d), (p = t)) : ((y = d), (u = t)), ++g.b2_toiRootIters, 50 == ++x))
              break;
          }
          if (
            ((g.b2_toiMaxRootIters = Math.max(g.b2_toiMaxRootIters, x)),
            h < (1 + 100 * Number.MIN_VALUE) * m)
          )
            break;
          if (((m = h), r++, ++g.b2_toiIters, 1e3 === r)) break;
        }
        return (g.b2_toiMaxIters = Math.max(g.b2_toiMaxIters, r)), m;
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Collision.b2TimeOfImpact.b2_toiCalls = 0),
          (Box2D.Collision.b2TimeOfImpact.b2_toiIters = 0),
          (Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters = 0),
          (Box2D.Collision.b2TimeOfImpact.b2_toiRootIters = 0),
          (Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters = 0),
          (Box2D.Collision.b2TimeOfImpact.s_cache = new w()),
          (Box2D.Collision.b2TimeOfImpact.s_distanceInput = new _()),
          (Box2D.Collision.b2TimeOfImpact.s_xfA = new e()),
          (Box2D.Collision.b2TimeOfImpact.s_xfB = new e()),
          (Box2D.Collision.b2TimeOfImpact.s_fcn = new D()),
          (Box2D.Collision.b2TimeOfImpact.s_distanceOutput = new h());
      }),
      (S.prototype.Initialize = function (t, i, o, e, s) {
        if (t.m_type === d.e_faceA) {
          let n = i.R,
            l = t.m_localPlaneNormal,
            m = n.col1.x * l.x + n.col2.x * l.y,
            r = n.col1.y * l.x + n.col2.y * l.y;
          (n = i.R), (l = t.m_localPoint);
          let a = i.position.x + n.col1.x * l.x + n.col2.x * l.y,
            _ = i.position.y + n.col1.y * l.x + n.col2.y * l.y;
          (this.m_normal.x = m), (this.m_normal.y = r);
          let h = t.m_pointCount;
          for (; h > 0; ) {
            (n = e.R), (l = t.m_points[--h].m_localPoint);
            let i = e.position.x + n.col1.x * l.x + n.col2.x * l.y,
              c = e.position.y + n.col1.y * l.x + n.col2.y * l.y;
            (this.m_points[h].x = i + 0.5 * (o - (i - a) * m - (c - _) * r - s) * m),
              (this.m_points[h].y = c + 0.5 * (o - (i - a) * m - (c - _) * r - s) * r);
          }
        } else if (t.m_type === d.e_faceB) {
          let n = e.R,
            l = t.m_localPlaneNormal,
            m = n.col1.x * l.x + n.col2.x * l.y,
            r = n.col1.y * l.x + n.col2.y * l.y;
          (n = e.R), (l = t.m_localPoint);
          let a = e.position.x + n.col1.x * l.x + n.col2.x * l.y,
            _ = e.position.y + n.col1.y * l.x + n.col2.y * l.y;
          (this.m_normal.x = -m), (this.m_normal.y = -r);
          let h = t.m_pointCount;
          for (; h > 0; ) {
            (n = i.R), (l = t.m_points[--h].m_localPoint);
            let e = i.position.x + n.col1.x * l.x + n.col2.x * l.y,
              c = i.position.y + n.col1.y * l.x + n.col2.y * l.y;
            (this.m_points[h].x = e + 0.5 * (s - (e - a) * m - (c - _) * r - o) * m),
              (this.m_points[h].y = c + 0.5 * (s - (e - a) * m - (c - _) * r - o) * r);
          }
        } else if (t.m_type === d.e_circles) {
          let n = i.R,
            l = t.m_localPoint,
            m = i.position.x + n.col1.x * l.x + n.col2.x * l.y,
            r = i.position.y + n.col1.y * l.x + n.col2.y * l.y;
          (n = e.R), (l = t.m_points[0].m_localPoint);
          let a = e.position.x + n.col1.x * l.x + n.col2.x * l.y,
            _ = e.position.y + n.col1.y * l.x + n.col2.y * l.y,
            h = a - m,
            c = _ - r,
            y = h * h + c * c;
          if (y > Number.MIN_VALUE * Number.MIN_VALUE) {
            let t = Math.sqrt(y);
            (this.m_normal.x = h / t), (this.m_normal.y = c / t);
          } else (this.m_normal.x = 1), (this.m_normal.y = 0);
          let p = m + o * this.m_normal.x,
            u = r + o * this.m_normal.y,
            x = a - s * this.m_normal.x,
            d = _ - s * this.m_normal.y;
          (this.m_points[0].x = 0.5 * (p + x)), (this.m_points[0].y = 0.5 * (u + d));
        }
      }),
      (M.prototype.Set = function (t) {
        this.v.SetV(t.v), this.id.Set(t.id);
      }),
      Object.defineProperty(V.prototype, "referenceEdge", {
        enumerable: !1,
        configurable: !0,
        get: function () {
          return this._referenceEdge;
        },
      }),
      Object.defineProperty(V.prototype, "referenceEdge", {
        enumerable: !1,
        configurable: !0,
        set: function (t) {
          (this._referenceEdge = t),
            (this._m_id._key = (4294967040 & this._m_id._key) | (255 & this._referenceEdge));
        },
      }),
      Object.defineProperty(V.prototype, "incidentEdge", {
        enumerable: !1,
        configurable: !0,
        get: function () {
          return this._incidentEdge;
        },
      }),
      Object.defineProperty(V.prototype, "incidentEdge", {
        enumerable: !1,
        configurable: !0,
        set: function (t) {
          (this._incidentEdge = t),
            (this._m_id._key =
              (4294902015 & this._m_id._key) | ((this._incidentEdge << 8) & 65280));
        },
      }),
      Object.defineProperty(V.prototype, "incidentVertex", {
        enumerable: !1,
        configurable: !0,
        get: function () {
          return this._incidentVertex;
        },
      }),
      Object.defineProperty(V.prototype, "incidentVertex", {
        enumerable: !1,
        configurable: !0,
        set: function (t) {
          (this._incidentVertex = t),
            (this._m_id._key =
              (4278255615 & this._m_id._key) | ((this._incidentVertex << 16) & 16711680));
        },
      }),
      Object.defineProperty(V.prototype, "flip", {
        enumerable: !1,
        configurable: !0,
        get: function () {
          return this._flip;
        },
      }),
      Object.defineProperty(V.prototype, "flip", {
        enumerable: !1,
        configurable: !0,
        set: function (t) {
          (this._flip = t),
            (this._m_id._key = (16777215 & this._m_id._key) | ((this._flip << 24) & 4278190080));
        },
      });
  })(),
  (function () {
    let t = Box2D.Common.b2Settings,
      i = Box2D.Collision.Shapes.b2CircleShape,
      o = Box2D.Collision.Shapes.b2EdgeShape,
      e = Box2D.Collision.Shapes.b2MassData,
      s = Box2D.Collision.Shapes.b2PolygonShape,
      n = Box2D.Collision.Shapes.b2Shape,
      l = Box2D.Common.Math.b2Mat22,
      m = Box2D.Common.Math.b2Math,
      r = (Box2D.Collision.b2AABB, Box2D.Common.Math.b2Transform),
      a = Box2D.Common.Math.b2Vec2,
      _ = Box2D.Collision.b2Distance,
      h = Box2D.Collision.b2DistanceInput,
      c = Box2D.Collision.b2DistanceOutput,
      y = Box2D.Collision.b2SimplexCache;
    Box2D.inherit(i, Box2D.Collision.Shapes.b2Shape),
      (i.prototype.__super = Box2D.Collision.Shapes.b2Shape.prototype),
      (i.prototype.Copy = function () {
        let t = new i();
        return t.Set(this), t;
      }),
      (i.prototype.Set = function (t) {
        (this.m_radius = t.m_radius), this.m_p.SetV(t.m_p);
      }),
      (i.prototype.TestPoint = function (t, i) {
        let o = t.R,
          e = t.position.x + (o.col1.x * this.m_p.x + o.col2.x * this.m_p.y),
          s = t.position.y + (o.col1.y * this.m_p.x + o.col2.y * this.m_p.y);
        return (e = i.x - e) * e + (s = i.y - s) * s <= this.m_radius * this.m_radius;
      }),
      (i.prototype.RayCast = function (t, i, o) {
        let e = o.R,
          s = o.position.x + (e.col1.x * this.m_p.x + e.col2.x * this.m_p.y),
          n = o.position.y + (e.col1.y * this.m_p.x + e.col2.y * this.m_p.y),
          l = i.p1.x - s,
          m = i.p1.y - n,
          r = l * l + m * m - this.m_radius * this.m_radius,
          a = i.p2.x - i.p1.x,
          _ = i.p2.y - i.p1.y,
          h = l * a + m * _,
          c = a * a + _ * _,
          y = h * h - c * r;
        if (y < 0 || c < Number.MIN_VALUE) return !1;
        let p = -(h + Math.sqrt(y));
        return (
          0 <= p &&
          p <= i.maxFraction * c &&
          ((p /= c),
          (t.fraction = p),
          (t.normal.x = l + p * a),
          (t.normal.y = m + p * _),
          t.normal.Normalize(),
          !0)
        );
      }),
      (i.prototype.ComputeAABB = function (t, i) {
        let o = i.position.x + (i.R.col1.x * this.m_p.x + i.R.col2.x * this.m_p.y),
          e = i.position.y + (i.R.col1.y * this.m_p.x + i.R.col2.y * this.m_p.y);
        (t.lowerBound.x = o - this.m_radius),
          (t.lowerBound.y = e - this.m_radius),
          (t.upperBound.x = o + this.m_radius),
          (t.upperBound.y = e + this.m_radius);
      }),
      (i.prototype.ComputeMass = function (i, o) {
        (i.mass = o * t.b2_pi * this.m_radius * this.m_radius),
          i.center.SetV(this.m_p),
          (i.I =
            i.mass *
            (0.5 * this.m_radius * this.m_radius +
              (this.m_p.x * this.m_p.x + this.m_p.y * this.m_p.y)));
      }),
      (i.prototype.ComputeSubmergedArea = function (t, i, o, e) {
        let s = m.MulX(o, this.m_p),
          n = -(m.Dot(t, s) - i);
        if (n < -this.m_radius + Number.MIN_VALUE) return 0;
        if (n > this.m_radius) return e.SetV(s), Math.PI * this.m_radius * this.m_radius;
        let l = this.m_radius * this.m_radius,
          r = n * n,
          a = l * (Math.asin(n / this.m_radius) + Math.PI / 2) + n * Math.sqrt(l - r),
          _ = ((-2 / 3) * Math.pow(l - r, 1.5)) / a;
        return (e.x = s.x + t.x * _), (e.y = s.y + t.y * _), a;
      }),
      (i.prototype.GetLocalPosition = function () {
        return this.m_p;
      }),
      (i.prototype.SetLocalPosition = function (t) {
        this.m_p.SetV(t);
      }),
      (i.prototype.GetRadius = function () {
        return this.m_radius;
      }),
      (i.prototype.SetRadius = function (t) {
        this.m_radius = t;
      }),
      Box2D.inherit(o, Box2D.Collision.Shapes.b2Shape),
      (o.prototype.__super = Box2D.Collision.Shapes.b2Shape.prototype),
      (o.prototype.TestPoint = function (t, i) {
        return !1;
      }),
      (o.prototype.RayCast = function (t, i, o) {
        let e = i.p2.x - i.p1.x,
          s = i.p2.y - i.p1.y,
          n = o.R,
          l = o.position.x + (n.col1.x * this.m_v1.x + n.col2.x * this.m_v1.y),
          m = o.position.y + (n.col1.y * this.m_v1.x + n.col2.y * this.m_v1.y),
          r = o.position.y + (n.col1.y * this.m_v2.x + n.col2.y * this.m_v2.y) - m,
          a = -(o.position.x + (n.col1.x * this.m_v2.x + n.col2.x * this.m_v2.y) - l),
          _ = 100 * Number.MIN_VALUE,
          h = -(e * r + s * a);
        if (h > _) {
          let o = i.p1.x - l,
            n = i.p1.y - m,
            c = o * r + n * a;
          if (0 <= c && c <= i.maxFraction * h) {
            let i = -e * n + s * o;
            if (-_ * h <= i && i <= h * (1 + _)) {
              (c /= h), (t.fraction = c);
              let i = Math.sqrt(r * r + a * a);
              return (t.normal.x = r / i), (t.normal.y = a / i), !0;
            }
          }
        }
        return !1;
      }),
      (o.prototype.ComputeAABB = function (t, i) {
        let o = i.position.x + (i.R.col1.x * this.m_v1.x + i.R.col2.x * this.m_v1.y),
          e = i.position.y + (i.R.col1.y * this.m_v1.x + i.R.col2.y * this.m_v1.y),
          s = i.position.x + (i.R.col1.x * this.m_v2.x + i.R.col2.x * this.m_v2.y),
          n = i.position.y + (i.R.col1.y * this.m_v2.x + i.R.col2.y * this.m_v2.y);
        o < s
          ? ((t.lowerBound.x = o), (t.upperBound.x = s))
          : ((t.lowerBound.x = s), (t.upperBound.x = o)),
          e < n
            ? ((t.lowerBound.y = e), (t.upperBound.y = n))
            : ((t.lowerBound.y = n), (t.upperBound.y = e));
      }),
      (o.prototype.ComputeMass = function (t, i) {
        void 0 === i && (i = 0), (t.mass = 0), t.center.SetV(this.m_v1), (t.I = 0);
      }),
      (o.prototype.ComputeSubmergedArea = function (t, i, o, e) {
        let s = new a(t.x * i, t.y * i),
          n = m.MulX(o, this.m_v1),
          l = m.MulX(o, this.m_v2),
          r = m.Dot(t, n) - i,
          _ = m.Dot(t, l) - i;
        if (r > 0) {
          if (_ > 0) return 0;
          (n.x = (-_ / (r - _)) * n.x + (r / (r - _)) * l.x),
            (n.y = (-_ / (r - _)) * n.y + (r / (r - _)) * l.y);
        } else
          _ > 0 &&
            ((l.x = (-_ / (r - _)) * n.x + (r / (r - _)) * l.x),
            (l.y = (-_ / (r - _)) * n.y + (r / (r - _)) * l.y));
        return (
          (e.x = (s.x + n.x + l.x) / 3),
          (e.y = (s.y + n.y + l.y) / 3),
          0.5 * ((n.x - s.x) * (l.y - s.y) - (n.y - s.y) * (l.x - s.x))
        );
      }),
      (o.prototype.GetLength = function () {
        return this.m_length;
      }),
      (o.prototype.GetVertex1 = function () {
        return this.m_v1;
      }),
      (o.prototype.GetVertex2 = function () {
        return this.m_v2;
      }),
      (o.prototype.GetCoreVertex1 = function () {
        return this.m_coreV1;
      }),
      (o.prototype.GetCoreVertex2 = function () {
        return this.m_coreV2;
      }),
      (o.prototype.GetNormalVector = function () {
        return this.m_normal;
      }),
      (o.prototype.GetDirectionVector = function () {
        return this.m_direction;
      }),
      (o.prototype.GetCorner1Vector = function () {
        return this.m_cornerDir1;
      }),
      (o.prototype.GetCorner2Vector = function () {
        return this.m_cornerDir2;
      }),
      (o.prototype.Corner1IsConvex = function () {
        return this.m_cornerConvex1;
      }),
      (o.prototype.Corner2IsConvex = function () {
        return this.m_cornerConvex2;
      }),
      (o.prototype.GetFirstVertex = function (t) {
        let i = t.R;
        return new a(
          t.position.x + (i.col1.x * this.m_coreV1.x + i.col2.x * this.m_coreV1.y),
          t.position.y + (i.col1.y * this.m_coreV1.x + i.col2.y * this.m_coreV1.y)
        );
      }),
      (o.prototype.GetNextEdge = function () {
        return this.m_nextEdge;
      }),
      (o.prototype.GetPrevEdge = function () {
        return this.m_prevEdge;
      }),
      (o.prototype.Support = function (t, i, o) {
        void 0 === i && (i = 0), void 0 === o && (o = 0);
        let e = t.R,
          s = t.position.x + (e.col1.x * this.m_coreV1.x + e.col2.x * this.m_coreV1.y),
          n = t.position.y + (e.col1.y * this.m_coreV1.x + e.col2.y * this.m_coreV1.y),
          l = t.position.x + (e.col1.x * this.m_coreV2.x + e.col2.x * this.m_coreV2.y),
          m = t.position.y + (e.col1.y * this.m_coreV2.x + e.col2.y * this.m_coreV2.y);
        return (
          s * i + n * o > l * i + m * o
            ? ((this.s_supportVec.x = s), (this.s_supportVec.y = n))
            : ((this.s_supportVec.x = l), (this.s_supportVec.y = m)),
          this.s_supportVec
        );
      }),
      (o.prototype.SetPrevEdge = function (t, i, o, e) {
        (this.m_prevEdge = t),
          (this.m_coreV1 = i),
          (this.m_cornerDir1 = o),
          (this.m_cornerConvex1 = e);
      }),
      (o.prototype.SetNextEdge = function (t, i, o, e) {
        (this.m_nextEdge = t),
          (this.m_coreV2 = i),
          (this.m_cornerDir2 = o),
          (this.m_cornerConvex2 = e);
      }),
      Box2D.inherit(s, Box2D.Collision.Shapes.b2Shape),
      (s.prototype.__super = Box2D.Collision.Shapes.b2Shape.prototype),
      (s.prototype.Copy = function () {
        let t = new s();
        return t.Set(this), t;
      }),
      (s.prototype.Set = function (t) {
        (this.m_radius = t.m_radius),
          this.m_centroid.SetV(t.m_centroid),
          (this.m_vertexCount = t.m_vertexCount),
          this.Reserve(this.m_vertexCount);
        for (let i = 0; i < this.m_vertexCount; i++)
          this.m_vertices[i].SetV(t.m_vertices[i]), this.m_normals[i].SetV(t.m_normals[i]);
      }),
      (s.prototype.SetAsArray = function (t, i) {
        let o,
          e = [];
        for (let i = 0; i < t.length; ++i) (o = t[i]), e.push(o);
        this.SetAsVector(e, i);
      }),
      (s.AsArray = function (t, i) {
        void 0 === i && (i = 0);
        let o = new s();
        return o.SetAsArray(t, i), o;
      }),
      (s.prototype.SetAsVector = function (t, i) {
        this.m_vertexCount = i;
        let o = 0;
        for (let i = 0; i < this.m_vertexCount; i++) {
          let e = (this.m_vertices[i] = t[i]),
            s = t[i + 1 < this.m_vertexCount ? i + 1 : 0],
            n = s.y - e.y,
            l = e.x - s.x,
            m = Math.sqrt(n * n + l * l);
          m >= Number.MIN_VALUE && ((n /= m), (l /= m)), (this.m_normals[i] = new a(n, l));
          let r = e.x - 0,
            _ = e.y - 0,
            h = s.x - 0,
            c = 0.5 * (r * (s.y - 0) - _ * h);
          (o += c),
            (this.m_centroid.x += c * (1 / 3) * (0 + e.x + s.x)),
            (this.m_centroid.y += c * (1 / 3) * (0 + e.y + s.y));
        }
        (this.m_centroid.x *= 1 / o), (this.m_centroid.y *= 1 / o);
      }),
      (s.AsVector = function (t, i) {
        void 0 === i && (i = 0);
        let o = new s();
        return o.SetAsVector(t, i), o;
      }),
      (s.prototype.SetAsBox = function (t, i) {
        (this.m_vertexCount = 4),
          (this.m_vertices[0] = new a(-t, -i)),
          (this.m_vertices[1] = new a(t, -i)),
          (this.m_vertices[2] = new a(t, i)),
          (this.m_vertices[3] = new a(-t, i)),
          (this.m_normals[0] = new a(0, -1)),
          (this.m_normals[1] = new a(1, 0)),
          (this.m_normals[2] = new a(0, 1)),
          (this.m_normals[3] = new a(-1, 0)),
          this.m_centroid.SetZero();
      }),
      (s.AsBox = function (t, i) {
        void 0 === t && (t = 0), void 0 === i && (i = 0);
        let o = new s();
        return o.SetAsBox(t, i), o;
      }),
      (s.prototype.SetAsOrientedBox = function (t, i, o, e = 0) {
        this.m_centroid = o;
        let s = new r(o);
        s.R.Set(e),
          (this.m_vertexCount = 4),
          (this.m_vertices[0] = new a(
            s.R.col1.x * -t + s.R.col2.x * -i + s.position.x,
            s.R.col1.y * -t + s.R.col2.y * -i + s.position.y
          )),
          (this.m_vertices[1] = new a(
            s.R.col1.x * t + s.R.col2.x * -i + s.position.x,
            s.R.col1.y * t + s.R.col2.y * -i + s.position.y
          )),
          (this.m_vertices[2] = new a(
            s.R.col1.x * t + s.R.col2.x * i + s.position.x,
            s.R.col1.y * t + s.R.col2.y * i + s.position.y
          )),
          (this.m_vertices[3] = new a(
            s.R.col1.x * -t + s.R.col2.x * i + s.position.x,
            s.R.col1.y * -t + s.R.col2.y * i + s.position.y
          )),
          (this.m_normals[0] = new a(-s.R.col2.x, -s.R.col2.y)),
          (this.m_normals[1] = new a(s.R.col1.x, s.R.col1.y)),
          (this.m_normals[2] = new a(s.R.col2.x, s.R.col2.y)),
          (this.m_normals[3] = new a(-s.R.col1.x, -s.R.col1.y));
      }),
      (s.AsOrientedBox = function (t, i, o, e = 0) {
        let n = new s();
        return n.SetAsOrientedBox(t, i, o, e), n;
      }),
      (s.prototype.SetAsEdge = function (t, i) {
        (this.m_vertexCount = 2),
          this.Reserve(2),
          this.m_vertices[0].SetV(t),
          this.m_vertices[1].SetV(i),
          (this.m_centroid.x = 0.5 * (t.x + i.x)),
          (this.m_centroid.y = 0.5 * (t.y + i.y));
        let o = new a(i.x - t.x, i.y - t.y);
        (this.m_normals[0] = m.CrossVF(o, 1)),
          this.m_normals[0].Normalize(),
          (this.m_normals[1].x = -this.m_normals[0].x),
          (this.m_normals[1].y = -this.m_normals[0].y);
      }),
      (s.AsEdge = function (t, i) {
        let o = new s();
        return o.SetAsEdge(t, i), o;
      }),
      (s.prototype.TestPoint = function (t, i) {
        let o,
          e = i.x - t.position.x,
          s = i.y - t.position.y,
          n = e * t.R.col1.x + s * t.R.col1.y,
          l = e * t.R.col2.x + s * t.R.col2.y;
        for (let t = 0; t < this.m_vertexCount; ++t)
          if (
            ((e = n - (o = this.m_vertices[t]).x),
            (s = l - o.y),
            (o = this.m_normals[t]).x * e + o.y * s > 0)
          )
            return !1;
        return !0;
      }),
      (s.prototype.RayCast = function (t, i, o) {
        let e,
          s = 0,
          n = i.maxFraction,
          l = i.p1.x - o.position.x,
          m = i.p1.y - o.position.y,
          r = o.R,
          a = l * r.col1.x + m * r.col1.y,
          _ = l * r.col2.x + m * r.col2.y;
        (l = i.p2.x - o.position.x), (m = i.p2.y - o.position.y);
        let h = l * (r = o.R).col1.x + m * r.col1.y - a,
          c = l * r.col2.x + m * r.col2.y - _,
          y = -1;
        for (let t = 0; t < this.m_vertexCount; ++t) {
          (l = (e = this.m_vertices[t]).x - a), (m = e.y - _);
          let i = (e = this.m_normals[t]).x * l + e.y * m,
            o = e.x * h + e.y * c;
          if (0 === o) {
            if (i < 0) return !1;
          } else o < 0 && i < s * o ? ((s = i / o), (y = t)) : o > 0 && i < n * o && (n = i / o);
          if (n < s - 1.1920929e-7) return !1;
        }
        return (
          y >= 0 &&
          ((t.fraction = s),
          (r = o.R),
          (e = this.m_normals[y]),
          (t.normal.x = r.col1.x * e.x + r.col2.x * e.y),
          (t.normal.y = r.col1.y * e.x + r.col2.y * e.y),
          !0)
        );
      }),
      (s.prototype.ComputeAABB = function (t, i) {
        let o = this.m_vertices[0],
          e = i.position.x + (i.R.col1.x * o.x + i.R.col2.x * o.y),
          s = i.position.y + (i.R.col1.y * o.x + i.R.col2.y * o.y),
          n = e,
          l = s;
        for (let t = 1; t < this.m_vertexCount; ++t) {
          o = this.m_vertices[t];
          let m = i.position.x + (i.R.col1.x * o.x + i.R.col2.x * o.y),
            r = i.position.y + (i.R.col1.y * o.x + i.R.col2.y * o.y);
          (e = e < m ? e : m), (s = s < r ? s : r), (n = n > m ? n : m), (l = l > r ? l : r);
        }
        (t.lowerBound.x = e - this.m_radius),
          (t.lowerBound.y = s - this.m_radius),
          (t.upperBound.x = n + this.m_radius),
          (t.upperBound.y = l + this.m_radius);
      }),
      (s.prototype.ComputeMass = function (t, i) {
        if ((void 0 === i && (i = 0), 2 === this.m_vertexCount))
          return (
            (t.center.x = 0.5 * (this.m_vertices[0].x + this.m_vertices[1].x)),
            (t.center.y = 0.5 * (this.m_vertices[0].y + this.m_vertices[1].y)),
            (t.mass = 0),
            void (t.I = 0)
          );
        let o = 0,
          e = 0,
          s = 0,
          n = 0;
        for (let t = 0; t < this.m_vertexCount; ++t) {
          let i = this.m_vertices[t],
            l = t + 1 < this.m_vertexCount ? this.m_vertices[t + 1] : this.m_vertices[0],
            m = i.x * l.y - i.y * l.x,
            r = 0.5 * m;
          (s += r),
            (o += r * (1 / 3) * (i.x + l.x)),
            (e += r * (1 / 3) * (i.y + l.y)),
            (n +=
              (1 / 3) *
              0.25 *
              m *
              (i.x * i.x + l.x * i.x + l.x * l.x + (i.y * i.y + l.y * i.y + l.y * l.y)));
        }
        (t.mass = i * s), (o *= 1 / s), (e *= 1 / s), t.center.Set(o, e), (t.I = i * n);
      }),
      (s.prototype.ComputeSubmergedArea = function (t, i, o, s) {
        let n = m.MulTMV(o.R, t),
          l = i - m.Dot(t, o.position),
          r = [],
          _ = 0,
          h = -1,
          c = -1,
          y = !1,
          p = 0;
        for (p = 0; p < this.m_vertexCount; ++p) {
          r[p] = m.Dot(n, this.m_vertices[p]) - l;
          let t = r[p] < -Number.MIN_VALUE;
          p > 0 && (t ? y || ((h = p - 1), _++) : y && ((c = p - 1), _++)), (y = t);
        }
        switch (_) {
          case 0:
            if (y) {
              let t = new e();
              return this.ComputeMass(t, 1), s.SetV(m.MulX(o, t.center)), t.mass;
            }
            return 0;
          case 1:
            -1 === h ? (h = this.m_vertexCount - 1) : (c = this.m_vertexCount - 1);
        }
        let u,
          x = (h + 1) % this.m_vertexCount,
          d = (c + 1) % this.m_vertexCount,
          f = (0 - r[h]) / (r[x] - r[h]),
          b = (0 - r[c]) / (r[d] - r[c]),
          B = new a(
            this.m_vertices[h].x * (1 - f) + this.m_vertices[x].x * f,
            this.m_vertices[h].y * (1 - f) + this.m_vertices[x].y * f
          ),
          A = new a(
            this.m_vertices[c].x * (1 - b) + this.m_vertices[d].x * b,
            this.m_vertices[c].y * (1 - b) + this.m_vertices[d].y * b
          ),
          D = 0,
          C = new a(),
          w = this.m_vertices[x];
        for (p = x; p !== d; ) {
          u = (p = (p + 1) % this.m_vertexCount) === d ? A : this.m_vertices[p];
          let t = 0.5 * ((w.x - B.x) * (u.y - B.y) - (w.y - B.y) * (u.x - B.x));
          (D += t),
            (C.x += (t * (B.x + w.x + u.x)) / 3),
            (C.y += (t * (B.y + w.y + u.y)) / 3),
            (w = u);
        }
        return C.Multiply(1 / D), s.SetV(m.MulX(o, C)), D;
      }),
      (s.prototype.GetVertexCount = function () {
        return this.m_vertexCount;
      }),
      (s.prototype.GetVertices = function () {
        return this.m_vertices;
      }),
      (s.prototype.GetNormals = function () {
        return this.m_normals;
      }),
      (s.prototype.GetSupport = function (t) {
        let i = 0,
          o = this.m_vertices[0].x * t.x + this.m_vertices[0].y * t.y;
        for (let e = 1; e < this.m_vertexCount; ++e) {
          let s = this.m_vertices[e].x * t.x + this.m_vertices[e].y * t.y;
          s > o && ((i = e), (o = s));
        }
        return i;
      }),
      (s.prototype.GetSupportVertex = function (t) {
        let i = 0,
          o = this.m_vertices[0].x * t.x + this.m_vertices[0].y * t.y;
        for (let e = 1; e < this.m_vertexCount; ++e) {
          let s = this.m_vertices[e].x * t.x + this.m_vertices[e].y * t.y;
          s > o && ((i = e), (o = s));
        }
        return this.m_vertices[i];
      }),
      (s.prototype.Validate = function () {
        return !1;
      }),
      (s.prototype.Reserve = function (t) {
        for (let i = this.m_vertices.length; i < t; i++)
          (this.m_vertices[i] = new a()), (this.m_normals[i] = new a());
      }),
      (s.ComputeCentroid = function (t, i) {
        let o = new a(),
          e = 0;
        for (let s = 0; s < i; ++s) {
          let n = t[s],
            l = s + 1 < i ? t[s + 1] : t[0],
            m = n.x - 0,
            r = n.y - 0,
            a = l.x - 0,
            _ = 0.5 * (m * (l.y - 0) - r * a);
          (e += _), (o.x += _ * (1 / 3) * (0 + n.x + l.x)), (o.y += _ * (1 / 3) * (0 + n.y + l.y));
        }
        return (o.x *= 1 / e), (o.y *= 1 / e), o;
      }),
      (s.ComputeOBB = function (t, i, o) {
        let e = 0,
          s = [];
        for (e = 0; e < o; ++e) s.push(i[e]);
        s[o] = s[0];
        let n = Number.MAX_VALUE;
        for (e = 1; e <= o; ++e) {
          let i = s[e - 1],
            l = s[e].x - i.x,
            m = s[e].y - i.y,
            r = Math.sqrt(l * l + m * m),
            a = -(m /= r),
            _ = (l /= r),
            h = Number.MAX_VALUE,
            c = Number.MAX_VALUE,
            y = -Number.MAX_VALUE,
            p = -Number.MAX_VALUE;
          for (let t = 0; t < o; ++t) {
            let o = s[t].x - i.x,
              e = s[t].y - i.y,
              n = l * o + m * e,
              r = a * o + _ * e;
            n < h && (h = n), r < c && (c = r), n > y && (y = n), r > p && (p = r);
          }
          let u = (y - h) * (p - c);
          if (u < 0.95 * n) {
            (n = u), (t.R.col1.x = l), (t.R.col1.y = m), (t.R.col2.x = a), (t.R.col2.y = _);
            let o = 0.5 * (h + y),
              e = 0.5 * (c + p),
              s = t.R;
            (t.center.x = i.x + (s.col1.x * o + s.col2.x * e)),
              (t.center.y = i.y + (s.col1.y * o + s.col2.y * e)),
              (t.extents.x = 0.5 * (y - h)),
              (t.extents.y = 0.5 * (p - c));
          }
        }
      }),
      Box2D.postDefs.push(function () {
        Box2D.Collision.Shapes.b2PolygonShape.s_mat = new l();
      }),
      (n.b2Shape = function () {}),
      (n.prototype.Copy = function () {
        return null;
      }),
      (n.prototype.Set = function (t) {
        this.m_radius = t.m_radius;
      }),
      (n.prototype.GetType = function () {
        return this.m_type;
      }),
      (n.prototype.TestPoint = function (t, i) {
        return !1;
      }),
      (n.prototype.RayCast = function (t, i, o) {
        return !1;
      }),
      (n.prototype.ComputeAABB = function (t, i) {}),
      (n.prototype.ComputeMass = function (t, i) {}),
      (n.prototype.ComputeSubmergedArea = function (t, i, o, e) {
        return 0;
      }),
      (n.DistanceInput = new h()),
      (n.DistanceOutput = new c()),
      (n.SimplexCacheInst = new y()),
      (n.TestOverlap = function (t, i, o, e) {
        let s = n.DistanceInput;
        return (
          s.proxyA.Set(t),
          s.proxyB.Set(o),
          (s.transformA = i),
          (s.transformB = e),
          (n.SimplexCacheInst.count = 0),
          _.Distance(n.DistanceOutput, n.SimplexCacheInst, s),
          n.DistanceOutput.distance < 10 * Number.MIN_VALUE
        );
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Collision.Shapes.b2Shape.e_unknownShape = -1),
          (Box2D.Collision.Shapes.b2Shape.e_circleShape = 0),
          (Box2D.Collision.Shapes.b2Shape.e_polygonShape = 1),
          (Box2D.Collision.Shapes.b2Shape.e_edgeShape = 2),
          (Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount = 3),
          (Box2D.Collision.Shapes.b2Shape.e_hitCollide = 1),
          (Box2D.Collision.Shapes.b2Shape.e_missCollide = 0),
          (Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide = -1);
      });
  })(),
  (function () {
    let t = Box2D.Common.b2Settings;
    (t.b2MixFriction = function (t, i) {
      return Math.sqrt(t * i);
    }),
      (t.b2MixRestitution = function (t, i) {
        return t > i ? t : i;
      }),
      (t.b2MixRestitutionMin = function (t, i) {
        return t > 1 ? t : i;
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Common.b2Settings.VERSION = "2.1c2"),
          (Box2D.Common.b2Settings.USHRT_MAX = 65535),
          (Box2D.Common.b2Settings.b2_pi = Math.PI),
          (Box2D.Common.b2Settings.b2_maxManifoldPoints = 2),
          (Box2D.Common.b2Settings.b2_aabbExtension = 0.1),
          (Box2D.Common.b2Settings.b2_aabbMultiplier = 2),
          (Box2D.Common.b2Settings.b2_linearSlop = 0.005),
          (Box2D.Common.b2Settings.b2_polygonRadius = 2 * t.b2_linearSlop),
          (Box2D.Common.b2Settings.b2_angularSlop = (2 / 180) * t.b2_pi),
          (Box2D.Common.b2Settings.b2_toiSlop = 8 * t.b2_linearSlop),
          (Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland = 32),
          (Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland = 32),
          (Box2D.Common.b2Settings.b2_velocityThreshold = 1),
          (Box2D.Common.b2Settings.b2_maxLinearCorrection = 0.2),
          (Box2D.Common.b2Settings.b2_maxAngularCorrection = (2 / 180) * t.b2_pi),
          (Box2D.Common.b2Settings.b2_maxTranslation = 2),
          (Box2D.Common.b2Settings.b2_maxTranslationSquared =
            t.b2_maxTranslation * t.b2_maxTranslation),
          (Box2D.Common.b2Settings.b2_maxRotation = 0.5 * t.b2_pi),
          (Box2D.Common.b2Settings.b2_maxRotationSquared = t.b2_maxRotation * t.b2_maxRotation),
          (Box2D.Common.b2Settings.b2_toiBaumgarte = 0.75),
          (Box2D.Common.b2Settings.b2_contactBaumgarte = 0.2),
          (Box2D.Common.b2Settings.b2_timeToSleep = 0.5),
          (Box2D.Common.b2Settings.b2_linearSleepTolerance = 0.01),
          (Box2D.Common.b2Settings.b2_angularSleepTolerance = (2 / 180) * t.b2_pi);
      });
  })(),
  (function () {
    let t = Box2D.Common.Math.b2Mat22,
      i = Box2D.Common.Math.b2Mat33,
      o = Box2D.Common.Math.b2Math,
      e = Box2D.Common.Math.b2Sweep,
      s = Box2D.Common.Math.b2Transform,
      n = Box2D.Common.Math.b2Vec2,
      l = Box2D.Common.Math.b2Vec3;
    (t.FromAngle = function (i) {
      let o = new t();
      return o.Set(i), o;
    }),
      (t.FromVV = function (i, o) {
        let e = new t();
        return e.SetVV(i, o), e;
      }),
      (t.prototype.Set = function (t) {
        let i = Math.cos(t),
          o = Math.sin(t);
        (this.col1.x = i), (this.col2.x = -o), (this.col1.y = o), (this.col2.y = i);
      }),
      (t.prototype.SetVV = function (t, i) {
        this.col1.SetV(t), this.col2.SetV(i);
      }),
      (t.prototype.Copy = function () {
        let i = new t();
        return i.SetM(this), i;
      }),
      (t.prototype.SetM = function (t) {
        this.col1.SetV(t.col1), this.col2.SetV(t.col2);
      }),
      (t.prototype.AddM = function (t) {
        (this.col1.x += t.col1.x),
          (this.col1.y += t.col1.y),
          (this.col2.x += t.col2.x),
          (this.col2.y += t.col2.y);
      }),
      (t.prototype.SetIdentity = function () {
        (this.col1.x = 1), (this.col2.x = 0), (this.col1.y = 0), (this.col2.y = 1);
      }),
      (t.prototype.SetZero = function () {
        (this.col1.x = 0), (this.col2.x = 0), (this.col1.y = 0), (this.col2.y = 0);
      }),
      (t.prototype.GetAngle = function () {
        return Math.atan2(this.col1.y, this.col1.x);
      }),
      (t.prototype.GetInverse = function (t) {
        let i = this.col1.x,
          o = this.col2.x,
          e = this.col1.y,
          s = this.col2.y,
          n = i * s - o * e;
        return 0 === n
          ? ((t.col1.x = 0), (t.col2.x = 0), (t.col1.y = 0), (t.col2.y = 0), t)
          : ((t.col1.x = s / n), (t.col2.x = o / -n), (t.col1.y = e / -n), (t.col2.y = i / n), t);
      }),
      (t.prototype.Solve = function (t, i, o) {
        let e = this.col1.x,
          s = this.col2.x,
          n = this.col1.y,
          l = this.col2.y,
          m = e * l - s * n;
        return 0 === m
          ? ((t.x = 0), (t.y = 0), t)
          : ((t.x = (l * i - s * o) / m), (t.y = (e * o - n * i) / m), t);
      }),
      (t.prototype.Abs = function () {
        this.col1.Abs(), this.col2.Abs();
      }),
      (i.prototype.SetVVV = function (t, i, o) {
        this.col1.SetV(t), this.col2.SetV(i), this.col3.SetV(o);
      }),
      (i.prototype.Copy = function () {
        return new i(this.col1, this.col2, this.col3);
      }),
      (i.prototype.SetM = function (t) {
        this.col1.SetV(t.col1), this.col2.SetV(t.col2), this.col3.SetV(t.col3);
      }),
      (i.prototype.AddM = function (t) {
        (this.col1.x += t.col1.x),
          (this.col1.y += t.col1.y),
          (this.col1.z += t.col1.z),
          (this.col2.x += t.col2.x),
          (this.col2.y += t.col2.y),
          (this.col2.z += t.col2.z),
          (this.col3.x += t.col3.x),
          (this.col3.y += t.col3.y),
          (this.col3.z += t.col3.z);
      }),
      (i.prototype.SetIdentity = function () {
        (this.col1.x = 1),
          (this.col2.x = 0),
          (this.col3.x = 0),
          (this.col1.y = 0),
          (this.col2.y = 1),
          (this.col3.y = 0),
          (this.col1.z = 0),
          (this.col2.z = 0),
          (this.col3.z = 1);
      }),
      (i.prototype.SetZero = function () {
        (this.col1.x = 0),
          (this.col2.x = 0),
          (this.col3.x = 0),
          (this.col1.y = 0),
          (this.col2.y = 0),
          (this.col3.y = 0),
          (this.col1.z = 0),
          (this.col2.z = 0),
          (this.col3.z = 0);
      }),
      (i.prototype.Solve22 = function (t, i, o) {
        let e = this.col1.x * this.col2.y - this.col2.x * this.col1.y;
        return 0 === e
          ? ((t.x = 0), (t.y = 0), t)
          : ((t.x = (this.col2.y * i - this.col2.x * o) / e),
            (t.y = (this.col1.x * o - this.col1.y * i) / e),
            t);
      }),
      (i.prototype.Solve33 = function (t, i, o, e) {
        let s =
          this.col1.x * (this.col2.y * this.col3.z - this.col2.z * this.col3.y) +
          this.col1.y * (this.col2.z * this.col3.x - this.col2.x * this.col3.z) +
          this.col1.z * (this.col2.x * this.col3.y - this.col2.y * this.col3.x);
        return 0 === s
          ? ((t.x = 0), (t.y = 0), (t.z = 0), t)
          : ((t.x =
              (i * (this.col2.y * this.col3.z - this.col2.z * this.col3.y) +
                o * (this.col2.z * this.col3.x - this.col2.x * this.col3.z) +
                e * (this.col2.x * this.col3.y - this.col2.y * this.col3.x)) /
              s),
            (t.y =
              (this.col1.x * (o * this.col3.z - e * this.col3.y) +
                this.col1.y * (e * this.col3.x - i * this.col3.z) +
                this.col1.z * (i * this.col3.y - o * this.col3.x)) /
              s),
            (t.z =
              (this.col1.x * (this.col2.y * e - this.col2.z * o) +
                this.col1.y * (this.col2.z * i - this.col2.x * e) +
                this.col1.z * (this.col2.x * o - this.col2.y * i)) /
              s),
            t);
      }),
      (o.IsValid = function (t) {
        return isFinite(t);
      }),
      (o.Dot = function (t, i) {
        return t.x * i.x + t.y * i.y;
      }),
      (o.CrossVV = function (t, i) {
        return t.x * i.y - t.y * i.x;
      }),
      (o.CrossVF = function (t, i) {
        return new n(i * t.y, -i * t.x);
      }),
      (o.CrossFV = function (t, i) {
        return new n(-t * i.y, t * i.x);
      }),
      (o.MulMV = function (t, i) {
        return new n(t.col1.x * i.x + t.col2.x * i.y, t.col1.y * i.x + t.col2.y * i.y);
      }),
      (o.MulTMV = function (t, i) {
        return new n(o.Dot(i, t.col1), o.Dot(i, t.col2));
      }),
      (o.MulX = function (t, i) {
        return new n(
          t.R.col1.x * i.x + t.R.col2.x * i.y + t.position.x,
          t.R.col1.y * i.x + t.R.col2.y * i.y + t.position.y
        );
      }),
      (o.MulXT = function (t, i) {
        let e = o.SubtractVV(i, t.position),
          s = e.x * t.R.col1.x + e.y * t.R.col1.y;
        return (e.y = e.x * t.R.col2.x + e.y * t.R.col2.y), (e.x = s), e;
      }),
      (o.AddVV = function (t, i) {
        return new n(t.x + i.x, t.y + i.y);
      }),
      (o.SubtractVV = function (t, i) {
        return new n(t.x - i.x, t.y - i.y);
      }),
      (o.Distance = function (t, i) {
        let o = t.x - i.x,
          e = t.y - i.y;
        return Math.sqrt(o * o + e * e);
      }),
      (o.DistanceSquared = function (t, i) {
        let o = t.x - i.x,
          e = t.y - i.y;
        return o * o + e * e;
      }),
      (o.MulFV = function (t, i) {
        return new n(t * i.x, t * i.y);
      }),
      (o.AddMM = function (i, e) {
        return t.FromVV(o.AddVV(i.col1, e.col1), o.AddVV(i.col2, e.col2));
      }),
      (o.MulMM = function (i, e) {
        return t.FromVV(o.MulMV(i, e.col1), o.MulMV(i, e.col2));
      }),
      (o.MulTMM = function (i, e) {
        let s = new n(o.Dot(i.col1, e.col1), o.Dot(i.col2, e.col1)),
          l = new n(o.Dot(i.col1, e.col2), o.Dot(i.col2, e.col2));
        return t.FromVV(s, l);
      }),
      (o.Abs = function (t) {
        return t > 0 ? t : -t;
      }),
      (o.AbsV = function (t) {
        return new n(Math.abs(t.x), Math.abs(t.y));
      }),
      (o.AbsM = function (i) {
        return t.FromVV(o.AbsV(i.col1), o.AbsV(i.col2));
      }),
      (o.Min = function (t, i) {
        return t < i ? t : i;
      }),
      (o.MinV = function (t, i) {
        return new n(Math.min(t.x, i.x), Math.min(t.y, i.y));
      }),
      (o.Max = function (t, i) {
        return t > i ? t : i;
      }),
      (o.MaxV = function (t, i) {
        return new n(Math.max(t.x, i.x), Math.max(t.y, i.y));
      }),
      (o.Clamp = function (t, i, o) {
        return Math.min(Math.max(t, i), o);
      }),
      (o.ClampV = function (t, i, e) {
        return o.MaxV(i, o.MinV(t, e));
      }),
      (o.Swap = function (t, i) {
        let o = t[0];
        (t[0] = i[0]), (i[0] = o);
      }),
      (o.Random = function () {
        return 2 * Math.random() - 1;
      }),
      (o.RandomRange = function (t, i) {
        return (i - t) * Math.random() + t;
      }),
      (o.NextPowerOfTwo = function (t) {
        return (
          (t |= (t >> 1) & 2147483647),
          (t |= (t >> 2) & 1073741823),
          (t |= (t >> 4) & 268435455),
          (t |= (t >> 8) & 16777215),
          (t |= (t >> 16) & 65535) + 1
        );
      }),
      (o.IsPowerOfTwo = function (t) {
        return t > 0 && 0 == (t & (t - 1));
      }),
      (e.prototype.Set = function (t) {
        this.localCenter.SetV(t.localCenter),
          this.c0.SetV(t.c0),
          this.c.SetV(t.c),
          (this.a0 = t.a0),
          (this.a = t.a),
          (this.t0 = t.t0);
      }),
      (e.prototype.Copy = function () {
        let t = new e();
        return (
          t.localCenter.SetV(this.localCenter),
          t.c0.SetV(this.c0),
          t.c.SetV(this.c),
          (t.a0 = this.a0),
          (t.a = this.a),
          (t.t0 = this.t0),
          t
        );
      }),
      (e.prototype.GetTransform = function (t, i) {
        (t.position.x = (1 - i) * this.c0.x + i * this.c.x),
          (t.position.y = (1 - i) * this.c0.y + i * this.c.y),
          t.R.Set((1 - i) * this.a0 + i * this.a);
        let o = t.R;
        (t.position.x -= o.col1.x * this.localCenter.x + o.col2.x * this.localCenter.y),
          (t.position.y -= o.col1.y * this.localCenter.x + o.col2.y * this.localCenter.y);
      }),
      (e.prototype.Advance = function (t) {
        if (this.t0 < t && 1 - this.t0 > Number.MIN_VALUE) {
          let i = (t - this.t0) / (1 - this.t0);
          (this.c0.x = (1 - i) * this.c0.x + i * this.c.x),
            (this.c0.y = (1 - i) * this.c0.y + i * this.c.y),
            (this.a0 = (1 - i) * this.a0 + i * this.a),
            (this.t0 = t);
        }
      }),
      (s.prototype.Initialize = function (t, i) {
        this.position.SetV(t), this.R.SetM(i);
      }),
      (s.prototype.SetIdentity = function () {
        this.position.SetZero(), this.R.SetIdentity();
      }),
      (s.prototype.Set = function (t) {
        this.position.SetV(t.position), this.R.SetM(t.R);
      }),
      (s.prototype.GetAngle = function () {
        return Math.atan2(this.R.col1.y, this.R.col1.x);
      }),
      (n.prototype.SetZero = function () {
        (this.x = 0), (this.y = 0);
      }),
      (n.prototype.Set = function (t, i) {
        (this.x = t), (this.y = i);
      }),
      (n.prototype.Set2 = function (t, i) {
        return (this.x = t), (this.y = i), this;
      }),
      (n.prototype.SetV = function (t) {
        (this.x = t.x), (this.y = t.y);
      }),
      (n.prototype.GetNegative = function () {
        return new n(-this.x, -this.y);
      }),
      (n.prototype.NegativeSelf = function () {
        (this.x = -this.x), (this.y = -this.y);
      }),
      (n.Make = function (t, i) {
        return new n(t, i);
      }),
      (n.prototype.Copy = function () {
        return new n(this.x, this.y);
      }),
      (n.prototype.Add = function (t) {
        (this.x += t.x), (this.y += t.y);
      }),
      (n.prototype.Subtract = function (t) {
        (this.x -= t.x), (this.y -= t.y);
      }),
      (n.prototype.Multiply = function (t) {
        (this.x *= t), (this.y *= t);
      }),
      (n.prototype.MulM = function (t) {
        let i = this.x;
        (this.x = t.col1.x * i + t.col2.x * this.y), (this.y = t.col1.y * i + t.col2.y * this.y);
      }),
      (n.prototype.MulTM = function (t) {
        let i = o.Dot(this, t.col1);
        (this.y = o.Dot(this, t.col2)), (this.x = i);
      }),
      (n.prototype.CrossVF = function (t) {
        let i = this.x;
        (this.x = t * this.y), (this.y = -t * i);
      }),
      (n.prototype.CrossFV = function (t) {
        let i = this.x;
        (this.x = -t * this.y), (this.y = t * i);
      }),
      (n.prototype.MinV = function (t) {
        (this.x = this.x < t.x ? this.x : t.x), (this.y = this.y < t.y ? this.y : t.y);
      }),
      (n.prototype.MaxV = function (t) {
        (this.x = this.x > t.x ? this.x : t.x), (this.y = this.y > t.y ? this.y : t.y);
      }),
      (n.prototype.Abs = function () {
        this.x < 0 && (this.x = -this.x), this.y < 0 && (this.y = -this.y);
      }),
      (n.prototype.Length = function () {
        return Math.sqrt(this.x * this.x + this.y * this.y);
      }),
      (n.prototype.LengthSquared = function () {
        return this.x * this.x + this.y * this.y;
      }),
      (n.prototype.Normalize = function () {
        let t = Math.sqrt(this.x * this.x + this.y * this.y);
        return t < Number.MIN_VALUE ? 0 : ((this.x /= t), (this.y /= t), t);
      }),
      (n.prototype.IsValid = function () {
        return o.IsValid(this.x) && o.IsValid(this.y);
      }),
      (l.prototype.SetZero = function () {
        this.x = this.y = this.z = 0;
      }),
      (l.prototype.Set = function (t, i, o) {
        (this.x = t || 0), (this.y = i || 0), (this.z = o || 0);
      }),
      (l.prototype.SetV = function (t) {
        (this.x = t.x), (this.y = t.y), (this.z = t.z);
      }),
      (l.prototype.GetNegative = function () {
        return new l(-this.x, -this.y, -this.z);
      }),
      (l.prototype.NegativeSelf = function () {
        (this.x = -this.x), (this.y = -this.y), (this.z = -this.z);
      }),
      (l.prototype.Copy = function () {
        return new l(this.x, this.y, this.z);
      }),
      (l.prototype.Add = function (t) {
        (this.x += t.x), (this.y += t.y), (this.z += t.z);
      }),
      (l.prototype.Subtract = function (t) {
        (this.x -= t.x), (this.y -= t.y), (this.z -= t.z);
      }),
      (l.prototype.Multiply = function (t) {
        void 0 === t && (t = 0), (this.x *= t), (this.y *= t), (this.z *= t);
      });
  })(),
  (function () {
    let t = Box2D.Common.Math.b2Math,
      i = Box2D.Common.Math.b2Sweep,
      o = Box2D.Common.Math.b2Transform,
      e = Box2D.Common.Math.b2Vec2,
      s = Box2D.Common.b2Settings,
      n = Box2D.Collision.b2AABB,
      l = Box2D.Collision.b2ContactPoint,
      m = Box2D.Collision.b2RayCastInput,
      r = Box2D.Collision.b2RayCastOutput,
      a = Box2D.Collision.Shapes.b2MassData,
      _ = Box2D.Collision.Shapes.b2Shape,
      h = Box2D.Dynamics.b2Body,
      c = Box2D.Dynamics.b2BodyDef,
      y = Box2D.Dynamics.b2ContactFilter,
      p = Box2D.Dynamics.b2ContactImpulse,
      u = Box2D.Dynamics.b2ContactListener,
      x = Box2D.Dynamics.b2ContactManager,
      d = Box2D.Dynamics.b2DestructionListener,
      f = Box2D.Dynamics.b2FilterData,
      b = Box2D.Dynamics.b2Fixture,
      B = Box2D.Dynamics.b2FixtureDef,
      A = Box2D.Dynamics.b2Island,
      D = Box2D.Dynamics.b2TimeStep,
      C = Box2D.Dynamics.b2World,
      w = Box2D.Dynamics.Contacts.b2Contact,
      v = Box2D.Dynamics.Joints.b2Joint;
    (h.prototype.connectEdges = function (i, o, e) {
      let n = Math.atan2(o.GetDirectionVector().y, o.GetDirectionVector().x),
        l = Math.tan(0.5 * (n - e)),
        m = t.MulFV(l, o.GetDirectionVector());
      (m = t.SubtractVV(m, o.GetNormalVector())),
        (m = t.MulFV(s.b2_toiSlop, m)),
        (m = t.AddVV(m, o.GetVertex1()));
      let r = t.AddVV(i.GetDirectionVector(), o.GetDirectionVector());
      r.Normalize();
      let a = t.Dot(i.GetDirectionVector(), o.GetNormalVector()) > 0;
      return i.SetNextEdge(o, m, r, a), o.SetPrevEdge(i, m, r, a), n;
    }),
      (h.prototype.CreateFixture = function (t) {
        let i = new b(this, t);
        if (this.m_flags & h.e_activeFlag) {
          let t = this.m_world.m_contactManager.m_broadPhase;
          i.CreateProxy(t, this.m_xf);
        }
        return (
          (i.m_next = this.m_fixtureList),
          (this.m_fixtureList = i),
          ++this.m_fixtureCount,
          (i.m_body = this),
          i.m_density > 0 && this.ResetMassData(),
          (this.m_world.m_flags |= C.e_newFixture),
          i
        );
      }),
      (h.prototype.CreateFixture2 = function (t) {
        let i = new B();
        return (i.shape = t), (i.density = density), this.CreateFixture(i);
      }),
      (h.prototype.CreateFixture3 = function (t) {
        let i = new b(this, t);
        return (
          (i.m_next = this.m_fixtureList),
          (this.m_fixtureList = i),
          (i.m_body = this),
          i.m_density > 0 && this.ResetMassData(),
          i
        );
      }),
      (h.prototype.ClearForces = function () {
        this.m_force.SetZero(), (this.m_torque = 0);
      }),
      (h.prototype.DestroyFixture = function (t) {
        let i = this.m_fixtureList,
          o = null;
        for (; null !== i; ) {
          if (i === t) {
            o ? (o.m_next = t.m_next) : (this.m_fixtureList = t.m_next);
            break;
          }
          (o = i), (i = i.m_next);
        }
        let e = this.m_contactList;
        for (; e; ) {
          let i = e.contact;
          e = e.next;
          let o = i.m_fixtureA,
            s = i.m_fixtureB;
          (t !== o && t !== s) || this.m_world.m_contactManager.Destroy(i);
        }
        if (this.m_flags & h.e_activeFlag) {
          let i = this.m_world.m_contactManager.m_broadPhase;
          t.DestroyProxy(i);
        }
        t.Destroy(),
          (t.m_body = null),
          (t.m_next = null),
          --this.m_fixtureCount,
          t.m_density > 0 && this.ResetMassData();
      }),
      (h.prototype.SetPositionAndAngle = function (t, i, o = !0) {
        this.m_xf.R.Set(i), (this.m_xf.position.x = t.x), (this.m_xf.position.y = t.y);
        let e = this.m_xf.R,
          s = this.m_sweep.localCenter;
        if (
          ((this.m_sweep.c.x = e.col1.x * s.x + e.col2.x * s.y + this.m_xf.position.x),
          (this.m_sweep.c.y = e.col1.y * s.x + e.col2.y * s.y + this.m_xf.position.y),
          (this.m_sweep.c0.x = this.m_sweep.c.x),
          (this.m_sweep.c0.y = this.m_sweep.c.y),
          (this.m_sweep.a0 = this.m_sweep.a = i),
          !o)
        )
          return;
        let n = this.m_fixtureList;
        if (1 === this.m_fixtureCount) {
          if (!n.m_proxy) return;
          n.Synchronize2(this.m_world.m_contactManager.m_broadPhase, this.m_xf);
        } else {
          let t = this.m_world.m_contactManager.m_broadPhase;
          for (; n; ) n.m_proxy ? (n.Synchronize2(t, this.m_xf), (n = n.m_next)) : (n = n.m_next);
        }
        this.m_world.m_contactManager.FindNewContacts();
      }),
      (h.prototype.SetTransform = function (t, i = !0) {
        this.SetPositionAndAngle(t.position, t.GetAngle(), i);
      }),
      (h.prototype.GetTransform = function () {
        return this.m_xf;
      }),
      (h.prototype.GetPosition = function () {
        return this.m_xf.position;
      }),
      (h.prototype.SetPosition = function (t, i = !0) {
        this.SetPositionAndAngle(t, this.GetAngle(), i);
      }),
      (h.prototype.GetAngle = function () {
        return this.m_sweep.a;
      }),
      (h.prototype.SetAngle = function (t, i = !0) {
        this.SetPositionAndAngle(this.GetPosition(), t, i);
      }),
      (h.prototype.SetGravityScale = function (t) {
        this.m_gravityScale = t;
      }),
      (h.prototype.GetGravityScale = function () {
        return this.m_gravityScale;
      }),
      (h.prototype.GetWorldCenter = function () {
        return this.m_sweep.c;
      }),
      (h.prototype.GetLocalCenter = function () {
        return this.m_sweep.localCenter;
      }),
      (h.prototype.SetLinearVelocity = function (t) {
        (this.m_linearVelocity.x = t.x), (this.m_linearVelocity.y = t.y);
      }),
      (h.prototype.GetLinearVelocity = function () {
        return this.m_linearVelocity;
      }),
      (h.prototype.SetAngularVelocity = function (t) {
        this.m_type !== h.b2_staticBody && (void 0 === t && (t = 0), (this.m_angularVelocity = t));
      }),
      (h.prototype.GetAngularVelocity = function () {
        return this.m_angularVelocity;
      }),
      (h.prototype.GetDefinition = function () {
        let t = new c();
        return (
          (t.type = this.m_type),
          (t.allowSleep = (this.m_flags & h.e_allowSleepFlag) === h.e_allowSleepFlag),
          (t.angle = this.GetAngle()),
          (t.angularDamping = this.m_angularDamping),
          (t.angularVelocity = this.m_angularVelocity),
          (t.fixedRotation = (this.m_flags & h.e_fixedRotationFlag) === h.e_fixedRotationFlag),
          (t.bullet = (this.m_flags & h.e_bulletFlag) === h.e_bulletFlag),
          (t.awake = (this.m_flags & h.e_awakeFlag) === h.e_awakeFlag),
          (t.linearDamping = this.m_linearDamping),
          t.linearVelocity.SetV(this.m_linearVelocity),
          (t.position = this.GetPosition()),
          (t.userData = this.GetUserData()),
          t
        );
      }),
      (h.prototype.ApplyForce = function (t, i) {
        this.m_type === h.b2_dynamicBody &&
          (this.m_isAwake || this.SetAwake(!0),
          (this.m_force.x += t.x),
          (this.m_force.y += t.y),
          (this.m_torque += (i.x - this.m_sweep.c.x) * t.y - (i.y - this.m_sweep.c.y) * t.x));
      }),
      (h.prototype.ApplyTorque = function (t) {
        this.m_type === h.b2_dynamicBody &&
          (void 0 === t && (t = 0), this.m_isAwake || this.SetAwake(!0), (this.m_torque += t));
      }),
      (h.prototype.ApplyImpulse = function (t, i) {
        this.m_isAwake || this.SetAwake(!0),
          (this.m_linearVelocity.x += this.m_invMass * t.x),
          (this.m_linearVelocity.y += this.m_invMass * t.y),
          (this.m_angularVelocity +=
            this.m_invI * ((i.x - this.m_sweep.c.x) * t.y - (i.y - this.m_sweep.c.y) * t.x));
      }),
      (h.prototype.Split = function (i) {
        let o,
          e = this.m_linearVelocity.Copy(),
          s = this.m_angularVelocity,
          n = this.GetWorldCenter(),
          l = this,
          m = this.m_world.CreateBody(this.GetDefinition());
        for (let t = l.m_fixtureList; t; )
          if (i(t)) {
            let i = t.m_next;
            o ? (o.m_next = i) : (l.m_fixtureList = i),
              l.m_fixtureCount--,
              (t.m_next = m.m_fixtureList),
              (m.m_fixtureList = t),
              m.m_fixtureCount++,
              (t.m_body = m),
              (t = i);
          } else (o = t), (t = t.m_next);
        l.ResetMassData(), m.ResetMassData();
        let r = l.GetWorldCenter(),
          a = m.GetWorldCenter(),
          _ = t.CrossFV(s, t.SubtractVV(r, n)),
          h = t.CrossFV(s, t.SubtractVV(a, n)),
          c = t.AddVV(e, _),
          y = t.AddVV(e, h);
        return (
          l.SetLinearVelocity(c),
          m.SetLinearVelocity(y),
          l.SetAngularVelocity(s),
          m.SetAngularVelocity(s),
          l.SynchronizeFixtures(),
          m.SynchronizeFixtures(),
          m
        );
      }),
      (h.prototype.Merge = function (t) {
        let i,
          o = t;
        for (i = t.m_fixtureList; i; ) {
          let e = i.m_next;
          t.m_fixtureCount--,
            (i.m_next = this.m_fixtureList),
            (this.m_fixtureList = i),
            this.m_fixtureCount++,
            (i.m_body = o),
            (i = e);
        }
        (this.m_fixtureCount = 0), this.ResetMassData(), this.SynchronizeFixtures();
      }),
      (h.prototype.GetMass = function () {
        return this.m_mass;
      }),
      (h.prototype.GetInertia = function () {
        return this.m_I;
      }),
      (h.prototype.GetMassData = function (t) {
        (t.mass = this.m_mass), (t.I = this.m_I), t.center.SetV(this.m_sweep.localCenter);
      }),
      (h.prototype.SetMassData = function (t) {
        this.m_type === h.b2_dynamicBody &&
          ((this.m_invMass = 0),
          (this.m_I = 0),
          (this.m_invI = 0),
          (this.m_mass = t.mass),
          this.m_mass <= 0 && (this.m_mass = 1),
          (this.m_invMass = 1 / this.m_mass),
          t.I > 0 &&
            0 == (this.m_flags & h.e_fixedRotationFlag) &&
            ((this.m_I = t.I - this.m_mass * (t.center.x * t.center.x + t.center.y * t.center.y)),
            (this.m_invI = 1 / this.m_I)),
          (this.m_sweep.localCenter.x = t.center.x),
          (this.m_sweep.localCenter.y = t.center.y),
          (this.m_sweep.c0.x =
            this.m_xf.R.col1.x * t.center.x +
            this.m_xf.R.col2.x * t.center.y +
            this.m_xf.position.x),
          (this.m_sweep.c0.y =
            this.m_xf.R.col1.y * t.center.x +
            this.m_xf.R.col2.y * t.center.y +
            this.m_xf.position.y),
          (this.m_linearVelocity.x +=
            this.m_angularVelocity * (this.m_sweep.c0.y - this.m_sweep.c.y) * -1),
          (this.m_linearVelocity.y +=
            this.m_angularVelocity * (this.m_sweep.c0.x - this.m_sweep.c.x)),
          (this.m_sweep.c.x = this.m_sweep.c0.x),
          (this.m_sweep.c.y = this.m_sweep.c0.y));
      }),
      (h.prototype.ResetMassData = function () {
        if (this.m_type !== h.b2_dynamicBody) return;
        (this.m_mass = 0), (this.m_invMass = 0), (this.m_I = 0), (this.m_invI = 0);
        let t = new e(),
          i = this.m_fixtureList;
        for (; i; ) {
          if (0 === i.m_density) {
            i = i.m_next;
            continue;
          }
          let o = i.GetMassData();
          (this.m_mass += o.mass),
            (t.x += o.center.x * o.mass),
            (t.y += o.center.y * o.mass),
            (this.m_I += o.I),
            (i = i.m_next);
        }
        this.m_mass > 0
          ? ((this.m_invMass = 1 / this.m_mass), (t.x *= this.m_invMass), (t.y *= this.m_invMass))
          : ((this.m_mass = 1), (this.m_invMass = 1)),
          this.m_I > 0 && 0 == (this.m_flags & h.e_fixedRotationFlag)
            ? ((this.m_I -= this.m_mass * (t.x * t.x + t.y * t.y)),
              (this.m_I *= this.m_inertiaScale),
              (this.m_invI = 1 / this.m_I))
            : ((this.m_I = 0), (this.m_invI = 0)),
          (this.m_sweep.localCenter.x = t.x),
          (this.m_sweep.localCenter.y = t.y),
          (this.m_sweep.c0.x =
            this.m_xf.R.col1.x * t.x + this.m_xf.R.col2.x * t.y + this.m_xf.position.x),
          (this.m_sweep.c0.y =
            this.m_xf.R.col1.y * t.x + this.m_xf.R.col2.y * t.y + this.m_xf.position.y),
          (this.m_linearVelocity.x +=
            this.m_angularVelocity * (this.m_sweep.c0.y - this.m_sweep.c.y) * -1),
          (this.m_linearVelocity.y +=
            this.m_angularVelocity * (this.m_sweep.c0.x - this.m_sweep.c.x)),
          (this.m_sweep.c.x = this.m_sweep.c0.x),
          (this.m_sweep.c.y = this.m_sweep.c0.y);
      }),
      (h.prototype.GetWorldPoint = function (t) {
        let i = this.m_xf.R,
          o = new e(i.col1.x * t.x + i.col2.x * t.y, i.col1.y * t.x + i.col2.y * t.y);
        return (o.x += this.m_xf.position.x), (o.y += this.m_xf.position.y), o;
      }),
      (h.prototype.GetWorldVector = function (i) {
        return t.MulMV(this.m_xf.R, i);
      }),
      (h.prototype.GetLocalPoint = function (i) {
        return t.MulXT(this.m_xf, i);
      }),
      (h.prototype.GetLocalVector = function (i) {
        return t.MulTMV(this.m_xf.R, i);
      }),
      (h.prototype.GetLinearVelocityFromWorldPoint = function (t) {
        return new e(
          this.m_linearVelocity.x - this.m_angularVelocity * (t.y - this.m_sweep.c.y),
          this.m_linearVelocity.y + this.m_angularVelocity * (t.x - this.m_sweep.c.x)
        );
      }),
      (h.prototype.GetLinearVelocityFromLocalPoint = function (t) {
        let i = this.m_xf.R,
          o = new e(i.col1.x * t.x + i.col2.x * t.y, i.col1.y * t.x + i.col2.y * t.y);
        return (
          (o.x += this.m_xf.position.x),
          (o.y += this.m_xf.position.y),
          new e(
            this.m_linearVelocity.x - this.m_angularVelocity * (o.y - this.m_sweep.c.y),
            this.m_linearVelocity.y + this.m_angularVelocity * (o.x - this.m_sweep.c.x)
          )
        );
      }),
      (h.prototype.GetLinearDamping = function () {
        return this.m_linearDamping;
      }),
      (h.prototype.SetLinearDamping = function (t) {
        void 0 === t && (t = 0), (this.m_linearDamping = t);
      }),
      (h.prototype.GetAngularDamping = function () {
        return this.m_angularDamping;
      }),
      (h.prototype.SetAngularDamping = function (t) {
        void 0 === t && (t = 0), (this.m_angularDamping = t);
      }),
      (h.prototype.SetType = function (t) {
        if ((void 0 === t && (t = 0), this.m_type !== t)) {
          (this.m_type = t),
            this.ResetMassData(),
            this.m_type === h.b2_staticBody &&
              (this.m_linearVelocity.SetZero(), (this.m_angularVelocity = 0)),
            this.SetAwake(!0),
            this.m_force.SetZero(),
            (this.m_torque = 0);
          for (let t = this.m_contactList; t; t = t.next) t.contact.m_isFiltered = !0;
        }
      }),
      (h.prototype.GetType = function () {
        return this.m_type;
      }),
      (h.prototype.SetBullet = function (t) {
        t ? (this.m_flags |= h.e_bulletFlag) : (this.m_flags &= ~h.e_bulletFlag);
      }),
      (h.prototype.IsBullet = function () {
        return (this.m_flags & h.e_bulletFlag) === h.e_bulletFlag;
      }),
      (h.prototype.SetSleepingAllowed = function (t) {
        t
          ? (this.m_flags |= h.e_allowSleepFlag)
          : ((this.m_flags &= ~h.e_allowSleepFlag), this.SetAwake(!0));
      }),
      (h.prototype.SetAwake = function (t) {
        (this.m_isAwake = t),
          t
            ? (this.m_sleepTime = 0)
            : ((this.m_sleepTime = 0),
              this.m_linearVelocity.SetZero(),
              (this.m_angularVelocity = 0),
              this.m_force.SetZero(),
              (this.m_torque = 0));
      }),
      (h.prototype.IsAwake = function () {
        return this.m_isAwake;
      }),
      (h.prototype.SetFixedRotation = function (t) {
        t ? (this.m_flags |= h.e_fixedRotationFlag) : (this.m_flags &= ~h.e_fixedRotationFlag),
          this.ResetMassData();
      }),
      (h.prototype.IsFixedRotation = function () {
        return (this.m_flags & h.e_fixedRotationFlag) === h.e_fixedRotationFlag;
      }),
      (h.prototype.SetActive = function (t) {
        if (t === this.IsActive()) return;
        let i = this.m_fixtureList;
        if (t) {
          this.m_flags |= h.e_activeFlag;
          let t = this.m_world.m_contactManager.m_broadPhase;
          for (; i; ) i.CreateProxy(t, this.m_xf), (i = i.m_next);
        } else {
          this.m_flags &= ~h.e_activeFlag;
          let t = this.m_world.m_contactManager.m_broadPhase;
          for (; i; ) i.DestroyProxy(t), (i = i.m_next);
          let o = this.m_contactList;
          for (; o; ) {
            let t = o;
            (o = o.next), this.m_world.m_contactManager.Destroy(t.contact);
          }
          this.m_contactList = null;
        }
      }),
      (h.prototype.IsActive = function () {
        return (this.m_flags & h.e_activeFlag) === h.e_activeFlag;
      }),
      (h.prototype.IsSleepingAllowed = function () {
        return (this.m_flags & h.e_allowSleepFlag) === h.e_allowSleepFlag;
      }),
      (h.prototype.GetFixtureList = function () {
        return this.m_fixtureList;
      }),
      (h.prototype.GetJointList = function () {
        return this.m_jointList;
      }),
      (h.prototype.GetControllerList = function () {
        return this.m_controllerList;
      }),
      (h.prototype.GetContactList = function () {
        return this.m_contactList;
      }),
      (h.prototype.GetNext = function () {
        return this.m_next;
      }),
      (h.prototype.GetUserData = function () {
        return this.m_userData;
      }),
      (h.prototype.SetUserData = function (t) {
        this.m_userData = t;
      }),
      (h.prototype.GetWorld = function () {
        return this.m_world;
      }),
      (h.prototype.SynchronizeFixtures = function () {
        let t = h.s_xf1;
        t.R.Set(this.m_sweep.a0);
        let i = t.R,
          o = this.m_sweep.localCenter;
        (t.position.x = this.m_sweep.c0.x - (i.col1.x * o.x + i.col2.x * o.y)),
          (t.position.y = this.m_sweep.c0.y - (i.col1.y * o.x + i.col2.y * o.y));
        let e = this.m_world.m_contactManager.m_broadPhase,
          s = this.m_fixtureList;
        for (; s; ) s.Synchronize(e, t, this.m_xf), (s = s.m_next);
      }),
      (h.prototype.SynchronizeTransform = function () {
        this.m_xf.R.Set(this.m_sweep.a);
        let t = this.m_xf.R,
          i = this.m_sweep.localCenter;
        (this.m_xf.position.x = this.m_sweep.c.x - (t.col1.x * i.x + t.col2.x * i.y)),
          (this.m_xf.position.y = this.m_sweep.c.y - (t.col1.y * i.x + t.col2.y * i.y));
      }),
      (h.prototype.ShouldCollide = function (t) {
        if (this.m_type !== h.b2_dynamicBody && t.m_type !== h.b2_dynamicBody) return !1;
        let i = this.m_jointList;
        for (; i; ) {
          if (i.other === t && !i.joint.m_collideConnected) return !1;
          i = i.next;
        }
        return !0;
      }),
      (h.prototype.Advance = function (t) {
        this.m_sweep.Advance(t),
          this.m_sweep.c.SetV(this.m_sweep.c0),
          (this.m_sweep.a = this.m_sweep.a0),
          this.SynchronizeTransform();
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Dynamics.b2Body.s_xf1 = new o()),
          (Box2D.Dynamics.b2Body.e_islandFlag = 1),
          (Box2D.Dynamics.b2Body.e_awakeFlag = 2),
          (Box2D.Dynamics.b2Body.e_allowSleepFlag = 4),
          (Box2D.Dynamics.b2Body.e_bulletFlag = 8),
          (Box2D.Dynamics.b2Body.e_fixedRotationFlag = 16),
          (Box2D.Dynamics.b2Body.e_activeFlag = 32),
          (Box2D.Dynamics.b2Body.b2_staticBody = 0),
          (Box2D.Dynamics.b2Body.b2_kinematicBody = 1),
          (Box2D.Dynamics.b2Body.b2_dynamicBody = 2),
          (Box2D.Dynamics.b2Body.b2_particleBody = 3);
      }),
      (y.prototype.ShouldCollide = function (t, i) {
        let o = t.GetFilterData(),
          e = i.GetFilterData();
        return o.groupIndex === e.groupIndex && 0 !== o.groupIndex
          ? o.groupIndex > 0
          : 0 != (o.maskBits & e.categoryBits) && 0 != (o.categoryBits & e.maskBits);
      }),
      (y.prototype.RayCollide = function (t, i) {
        return !t || this.ShouldCollide(t, i);
      }),
      Box2D.postDefs.push(function () {
        Box2D.Dynamics.b2ContactFilter.b2_defaultFilter = new y();
      }),
      (u.prototype.BeginContact = function (t) {}),
      (u.prototype.EndContact = function (t) {}),
      (u.prototype.PreSolve = function (t, i) {}),
      (u.prototype.PostSolve = function (t, i) {}),
      Box2D.postDefs.push(function () {
        Box2D.Dynamics.b2ContactListener.b2_defaultListener = new u();
      }),
      (x.prototype.AddPair = function (t, i) {
        let o = i.m_body.m_contactList;
        for (; o; ) {
          if (o.other === t.m_body) {
            if (o.contact.m_fixtureA === t && o.contact.m_fixtureB === i) return;
            if (o.contact.m_fixtureA === i && o.contact.m_fixtureB === t) return;
          }
          o = o.next;
        }
        if (!1 === i.m_body.ShouldCollide(t.m_body)) return;
        if (!1 === this.m_contactFilter.ShouldCollide(t, i)) return;
        let e = this.m_contactFactory.Create(t, i),
          s = e.m_fixtureA.m_body,
          n = e.m_fixtureB.m_body;
        (e.m_prev = null),
          (e.m_next = this.m_world.m_contactList),
          null !== this.m_world.m_contactList && (this.m_world.m_contactList.m_prev = e),
          (this.m_world.m_contactList = e),
          (e.m_nodeA.contact = e),
          (e.m_nodeA.other = n),
          (e.m_nodeA.prev = null),
          (e.m_nodeA.next = s.m_contactList),
          null !== s.m_contactList && (s.m_contactList.prev = e.m_nodeA),
          (s.m_contactList = e.m_nodeA),
          (e.m_nodeB.contact = e),
          (e.m_nodeB.other = s),
          (e.m_nodeB.prev = null),
          (e.m_nodeB.next = n.m_contactList),
          null !== n.m_contactList && (n.m_contactList.prev = e.m_nodeB),
          (n.m_contactList = e.m_nodeB),
          ++this.m_world.m_contactCount;
      }),
      (x.prototype.FindNewContacts = function () {
        this.m_broadPhase.UpdatePairs(this);
      }),
      (x.prototype.Destroy = function (t) {
        let i = t.m_fixtureA,
          o = t.m_fixtureB,
          e = i.m_body,
          s = o.m_body;
        t.m_isTouching && this.m_contactListener.EndContact(t),
          t.m_prev && (t.m_prev.m_next = t.m_next),
          t.m_next && (t.m_next.m_prev = t.m_prev),
          t === this.m_world.m_contactList && (this.m_world.m_contactList = t.m_next),
          t.m_nodeA.prev && (t.m_nodeA.prev.next = t.m_nodeA.next),
          t.m_nodeA.next && (t.m_nodeA.next.prev = t.m_nodeA.prev),
          t.m_nodeA === e.m_contactList && (e.m_contactList = t.m_nodeA.next),
          t.m_nodeB.prev && (t.m_nodeB.prev.next = t.m_nodeB.next),
          t.m_nodeB.next && (t.m_nodeB.next.prev = t.m_nodeB.prev),
          t.m_nodeB === s.m_contactList && (s.m_contactList = t.m_nodeB.next),
          this.m_contactFactory.Destroy(t),
          --this.m_contactCount;
      }),
      (x.prototype.Collide = function () {
        let t = this.m_world.m_contactList;
        for (; t; ) {
          let i = t.m_fixtureA,
            o = t.m_fixtureB,
            e = i.m_body,
            s = o.m_body;
          if (!1 !== e.m_isAwake || !1 !== s.m_isAwake) {
            if (t.m_isFiltered) {
              if (!s.ShouldCollide(e)) {
                let i = t;
                (t = i.m_next), this.Destroy(i);
                continue;
              }
              if (!this.m_contactFilter.ShouldCollide(i, o)) {
                let i = t;
                (t = i.m_next), this.Destroy(i);
                continue;
              }
              t.m_isFiltered = !1;
            }
            if (this.m_broadPhase.TestOverlap(i.m_proxy, o.m_proxy))
              t.Update(this.m_contactListener), (t = t.m_next);
            else {
              let i = t;
              (t = i.m_next), this.Destroy(i);
            }
          } else t = t.m_next;
        }
      }),
      Box2D.postDefs.push(function () {
        Box2D.Dynamics.b2ContactManager.s_evalCP = new l();
      }),
      (d.prototype.SayGoodbyeJoint = function (t) {}),
      (d.prototype.SayGoodbyeFixture = function (t) {}),
      (f.prototype.Copy = function () {
        let t = new f();
        return (
          (t.categoryBits = this.categoryBits),
          (t.maskBits = this.maskBits),
          (t.groupIndex = this.groupIndex),
          t
        );
      }),
      (b.prototype.GetType = function () {
        return this.m_shape.GetType();
      }),
      (b.prototype.GetShape = function () {
        return this.m_shape;
      }),
      (b.prototype.SetSensor = function (t) {
        if (this.m_isSensor === t) return;
        if (((this.m_isSensor = t), null === this.m_body)) return;
        let i = this.m_body.GetContactList();
        for (; i; ) {
          let t = i.contact,
            o = t.m_fixtureA,
            e = t.m_fixtureB;
          (o !== this && e !== this) || t.SetSensor(o.m_isSensor || e.m_isSensor), (i = i.next);
        }
      }),
      (b.prototype.IsSensor = function () {
        return this.m_isSensor;
      }),
      (b.prototype.SetFilterData = function (t) {
        if (((this.m_filter = t.Copy()), !this.m_body)) return;
        let i = this.m_body.GetContactList();
        for (; i; )
          (i.contact.m_fixtureA !== this && i.contact.m_fixtureB !== this) ||
            (i.contact.m_isFiltered = !0),
            (i = i.next);
      }),
      (b.prototype.SyncFilterData = function () {
        let t = this.m_body.GetContactList();
        for (; t; )
          (t.contact.m_fixtureA !== this && t.contact.m_fixtureB !== this) ||
            (t.contact.m_isFiltered = !0),
            (t = t.next);
      }),
      (b.prototype.GetFilterData = function () {
        return this.m_filter.Copy();
      }),
      (b.prototype.GetBody = function () {
        return this.m_body;
      }),
      (b.prototype.GetNext = function () {
        return this.m_next;
      }),
      (b.prototype.GetUserData = function () {
        return this.m_userData;
      }),
      (b.prototype.SetUserData = function (t) {
        this.m_userData = t;
      }),
      (b.prototype.TestPoint = function (t) {
        return this.m_shape.TestPoint(this.m_body.m_xf, t);
      }),
      (b.prototype.RayCast = function (t, i) {
        return this.m_shape.RayCast(t, i, this.m_body.m_xf);
      }),
      (b.prototype.GetMassData = function (t) {
        return void 0 === t && (t = new a()), this.m_shape.ComputeMass(t, this.m_density), t;
      }),
      (b.prototype.SetDensity = function (t) {
        this.m_density = t;
      }),
      (b.prototype.GetDensity = function () {
        return this.m_density;
      }),
      (b.prototype.GetFriction = function () {
        return this.m_friction;
      }),
      (b.prototype.SetFriction = function (t) {
        this.m_friction = t;
      }),
      (b.prototype.GetRestitution = function () {
        return this.m_restitution;
      }),
      (b.prototype.SetRestitution = function (t) {
        this.m_restitution = t;
      }),
      (b.prototype.GetAABB = function () {
        return this.m_aabb;
      }),
      (b.prototype.Create = function (t, i, o) {
        (this.m_userData = o.userData),
          (this.m_friction = o.friction),
          (this.m_restitution = o.restitution),
          (this.m_body = t),
          (this.m_next = null),
          (this.m_filter = o.filter.Copy()),
          (this.m_isSensor = o.isSensor),
          (this.m_shape = o.shape.Copy()),
          (this.m_density = o.density);
      }),
      (b.prototype.Destroy = function () {
        this.m_shape = null;
      }),
      (b.prototype.CreateProxy = function (t, i) {
        this.m_shape.ComputeAABB(this.m_aabb, i), (this.m_proxy = t.CreateProxy(this.m_aabb, this));
      }),
      (b.prototype.DestroyProxy = function (t) {
        null != this.m_proxy &&
          (t.DestroyProxy(this.m_proxy), n.Free(this.m_aabb), (this.m_proxy = null));
      }),
      (b.AABB1 = new n()),
      (b.AABB2 = new n()),
      (b.prototype.Synchronize = function (t, i, o) {
        this.m_shape.ComputeAABB(b.AABB1, i),
          this.m_shape.ComputeAABB(b.AABB2, o),
          (this.m_aabb.lowerBound.x = Math.min(b.AABB1.lowerBound.x, b.AABB2.lowerBound.x)),
          (this.m_aabb.lowerBound.y = Math.min(b.AABB1.lowerBound.y, b.AABB2.lowerBound.y)),
          (this.m_aabb.upperBound.x = Math.max(b.AABB1.upperBound.x, b.AABB2.upperBound.x)),
          (this.m_aabb.upperBound.y = Math.max(b.AABB1.upperBound.y, b.AABB2.upperBound.y)),
          (b.AABB1.lowerBound.x = o.position.x - i.position.x),
          (b.AABB1.lowerBound.y = o.position.y - i.position.y),
          t.MoveProxy(this.m_proxy, this.m_aabb, b.AABB1.lowerBound);
      }),
      (b.prototype.Synchronize2 = function (t, i) {
        this.m_shape.ComputeAABB(this.m_aabb, i),
          this.m_proxy.aabb.Contains(this.m_aabb) || t.MoveProxy2(this.m_proxy, this.m_aabb);
      }),
      (A.prototype.Initialize = function (t, i, o, e, s, n) {
        (this.m_contactCapacity = i),
          (this.m_jointCapacity = o),
          (this.m_staticIndex = 0),
          (this.m_bodyCount = 0),
          (this.m_contactCount = 0),
          (this.m_jointCount = 0),
          (this.m_allocator = e),
          (this.m_listener = s),
          (this.m_contactSolver = n);
      }),
      (A.prototype.Clear = function () {
        (this.m_bodyCount = 0),
          (this.m_contactCount = 0),
          (this.m_jointCount = 0),
          (this.m_staticIndex = 0);
      }),
      (A.prototype.Solve = function (i, o, e) {
        let n, l;
        for (n = 0; n < this.m_staticIndex; ++n) {
          if ((l = this.m_bodies[n]).m_type === h.b2_kinematicBody) continue;
          let e = Math.min(Math.max(1 - i.dt * l.m_linearDamping, 0), 1);
          (l.m_linearVelocity.x =
            (l.m_linearVelocity.x + i.dt * (o.x * l.m_gravityScale + l.m_invMass * l.m_force.x)) *
            e),
            (l.m_linearVelocity.y =
              (l.m_linearVelocity.y + i.dt * (o.y * l.m_gravityScale + l.m_invMass * l.m_force.y)) *
              e),
            (l.m_angularVelocity += i.dt * l.m_invI * l.m_torque),
            (l.m_angularVelocity *= t.Clamp(1 - i.dt * l.m_angularDamping, 0, 1));
        }
        this.m_contactSolver.Initialize(i, this.m_contacts, this.m_contactCount, this.m_allocator);
        let m,
          r = this.m_contactSolver;
        for (r.InitVelocityConstraints(i), n = 0; n < this.m_jointCount; ++n)
          this.m_joints[n].InitVelocityConstraints(i);
        for (n = 0; n < i.velocityIterations; ++n) {
          for (m = 0; m < this.m_jointCount; ++m) this.m_joints[m].SolveVelocityConstraints(i);
          r.SolveVelocityConstraints();
        }
        for (n = 0; n < this.m_jointCount; ++n) this.m_joints[n].FinalizeVelocityConstraints();
        for (r.FinalizeVelocityConstraints(), n = 0; n < this.m_staticIndex; ++n) {
          l = this.m_bodies[n];
          let t = i.dt * l.m_linearVelocity.x,
            o = i.dt * l.m_linearVelocity.y;
          t * t + o * o > s.b2_maxTranslationSquared &&
            (l.m_linearVelocity.Normalize(),
            (l.m_linearVelocity.x *= s.b2_maxTranslation * i.inv_dt),
            (l.m_linearVelocity.y *= s.b2_maxTranslation * i.inv_dt));
          let e = i.dt * l.m_angularVelocity;
          e * e > s.b2_maxRotationSquared &&
            (l.m_angularVelocity =
              (l.m_angularVelocity < 0 ? -s.b2_maxRotation : s.b2_maxRotation) * i.inv_dt),
            l.m_sweep.c0.SetV(l.m_sweep.c),
            (l.m_sweep.a0 = l.m_sweep.a),
            (l.m_sweep.c.x += i.dt * l.m_linearVelocity.x),
            (l.m_sweep.c.y += i.dt * l.m_linearVelocity.y),
            (l.m_sweep.a += i.dt * l.m_angularVelocity),
            l.SynchronizeTransform();
        }
        for (n = 0; n < i.positionIterations; ++n) {
          let t = r.SolvePositionConstraints(s.b2_contactBaumgarte),
            i = !0;
          for (m = 0; m < this.m_jointCount; ++m) {
            let t = this.m_joints[m].SolvePositionConstraints(s.b2_contactBaumgarte);
            i = i && t;
          }
          if (t && i) break;
        }
        if ((this.Report(r.m_constraints), e)) {
          let o = Number.MAX_VALUE,
            e = s.b2_linearSleepTolerance * s.b2_linearSleepTolerance,
            m = s.b2_angularSleepTolerance * s.b2_angularSleepTolerance;
          for (n = 0; n < this.m_staticIndex; ++n)
            0 == ((l = this.m_bodies[n]).m_flags & h.e_allowSleepFlag) &&
              ((l.m_sleepTime = 0), (o = 0)),
              0 == (l.m_flags & h.e_allowSleepFlag) ||
              l.m_angularVelocity * l.m_angularVelocity > m ||
              t.Dot(l.m_linearVelocity, l.m_linearVelocity) > e
                ? ((l.m_sleepTime = 0), (o = 0))
                : ((l.m_sleepTime += i.dt), (o = Math.min(o, l.m_sleepTime)));
          if (o >= s.b2_timeToSleep)
            for (n = 0; n < this.m_staticIndex; ++n) this.m_bodies[n].SetAwake(!1);
        }
      }),
      (A.prototype.SolveTOI = function (t) {
        let i, o;
        this.m_contactSolver.Initialize(t, this.m_contacts, this.m_contactCount, this.m_allocator);
        let e = this.m_contactSolver;
        for (i = 0; i < this.m_jointCount; ++i) this.m_joints[i].InitVelocityConstraints(t);
        for (i = 0; i < t.velocityIterations; ++i)
          for (e.SolveVelocityConstraints(), o = 0; o < this.m_jointCount; ++o)
            this.m_joints[o].SolveVelocityConstraints(t);
        for (i = 0; i < this.m_staticIndex; ++i) {
          let o = this.m_bodies[i],
            e = t.dt * o.m_linearVelocity.x,
            n = t.dt * o.m_linearVelocity.y;
          e * e + n * n > s.b2_maxTranslationSquared &&
            (o.m_linearVelocity.Normalize(),
            (o.m_linearVelocity.x *= s.b2_maxTranslation * t.inv_dt),
            (o.m_linearVelocity.y *= s.b2_maxTranslation * t.inv_dt));
          let l = t.dt * o.m_angularVelocity;
          l * l > s.b2_maxRotationSquared &&
            (o.m_angularVelocity < 0
              ? (o.m_angularVelocity = -s.b2_maxRotation * t.inv_dt)
              : (o.m_angularVelocity = s.b2_maxRotation * t.inv_dt)),
            o.m_sweep.c0.SetV(o.m_sweep.c),
            (o.m_sweep.a0 = o.m_sweep.a),
            (o.m_sweep.c.x += t.dt * o.m_linearVelocity.x),
            (o.m_sweep.c.y += t.dt * o.m_linearVelocity.y),
            (o.m_sweep.a += t.dt * o.m_angularVelocity),
            o.SynchronizeTransform();
        }
        for (i = 0; i < t.positionIterations; ++i) {
          let t = e.SolvePositionConstraints(s.b2_toiBaumgarte),
            i = !0;
          for (o = 0; o < this.m_jointCount; ++o) {
            let t = this.m_joints[o].SolvePositionConstraints(s.b2_contactBaumgarte);
            i = i && t;
          }
          if (t && i) break;
        }
        this.Report(e.m_constraints);
      }),
      (A.prototype.Report = function (t) {
        if (null != this.m_listener)
          for (let i = 0; i < this.m_contactCount; ++i) {
            let o = t[i];
            A.s_impulse.normalImpulses.length > o.pointCount &&
              ((A.s_impulse.normalImpulses.length = o.pointCount),
              (A.s_impulse.tangentImpulses.length = o.pointCount));
            for (let t = 0; t < o.pointCount; ++t)
              (A.s_impulse.normalImpulses[t] = o.points[t].normalImpulse),
                (A.s_impulse.tangentImpulses[t] = o.points[t].tangentImpulse);
            this.m_listener.PostSolve(this.m_contacts[i], A.s_impulse);
          }
      }),
      (A.prototype.AddBody = function (t) {
        if (t.m_type === h.b2_staticBody) this.m_bodies[this.m_bodyCount] = t;
        else {
          let i = this.m_bodies[this.m_staticIndex];
          i
            ? ((this.m_bodies[this.m_bodyCount] = i), (this.m_bodies[this.m_staticIndex] = t))
            : (this.m_bodies[this.m_bodyCount] = t),
            this.m_staticIndex++;
        }
        this.m_bodyCount++;
      }),
      (A.prototype.AddStaticBody = function (t) {
        (this.m_bodies[this.m_bodyCount] = t), this.m_bodyCount++;
      }),
      (A.prototype.AddNonStaticBody = function (t) {
        let i = this.m_bodies[this.m_staticIndex];
        i
          ? ((this.m_bodies[this.m_bodyCount] = i), (this.m_bodies[this.m_staticIndex] = t))
          : (this.m_bodies[this.m_bodyCount] = t),
          this.m_staticIndex++,
          this.m_bodyCount++;
      }),
      (A.prototype.AddContact = function (t) {
        this.m_contacts[this.m_contactCount++] = t;
      }),
      (A.prototype.AddJoint = function (t) {
        this.m_joints[this.m_jointCount++] = t;
      }),
      Box2D.postDefs.push(function () {
        Box2D.Dynamics.b2Island.s_impulse = new p();
      }),
      (D.prototype.Set = function (t) {
        (this.dt = t.dt),
          (this.inv_dt = t.inv_dt),
          (this.positionIterations = t.positionIterations),
          (this.velocityIterations = t.velocityIterations),
          (this.warmStarting = t.warmStarting);
      }),
      (C.prototype.SetDestructionListener = function (t) {
        this.m_destructionListener = t;
      }),
      (C.prototype.SetContactFilter = function (t) {
        this.m_contactManager.m_contactFilter = t;
      }),
      (C.prototype.SetContactListener = function (t) {
        this.m_contactManager.m_contactListener = t;
      }),
      (C.prototype.SetBroadPhase = function (t) {
        this.m_contactManager.m_broadPhase = t;
        let i = this.m_bodyList.m_fixtureList;
        for (; i; ) (i.m_proxy = t.CreateProxy(i.m_proxy.aabb, i)), (i = i.m_next);
      }),
      (C.prototype.Validate = function () {
        this.m_contactManager.m_broadPhase.Validate();
      }),
      (C.prototype.GetProxyCount = function () {
        return this.m_contactManager.m_broadPhase.GetProxyCount();
      }),
      (C.prototype.CreateBody = function (t) {
        let i = new h(t, this);
        return (
          t.type === h.b2_staticBody
            ? (this.m_last &&
                ((this.m_last.m_next = i), (i.m_prev = this.m_last), (i.m_next = null)),
              (this.m_last = i),
              0 === this.m_bodyCount && (this.m_bodyList = i))
            : ((i.m_prev = null),
              (i.m_next = this.m_bodyList),
              this.m_bodyList && (this.m_bodyList.m_prev = i),
              0 === this.m_bodyCount && (this.m_last = i),
              (this.m_bodyList = i)),
          ++this.m_bodyCount,
          i
        );
      }),
      (C.prototype.DestroyBody = function (t) {
        let i = t.m_jointList;
        for (; i; ) {
          let t = i;
          (i = i.next),
            this.m_destructionListener && this.m_destructionListener.SayGoodbyeJoint(t.joint),
            null != t.joint && this.DestroyJoint(t.joint);
        }
        let o = t.m_controllerList;
        for (; o; ) {
          let i = o;
          (o = o.nextController), i.controller.RemoveBody(t);
        }
        let e = t.m_contactList;
        for (; e; ) {
          let t = e;
          (e = e.next), this.m_contactManager.Destroy(t.contact);
        }
        t.m_contactList = null;
        let s = t.m_fixtureList;
        for (; s; ) {
          let t = s;
          (s = s.m_next),
            this.m_destructionListener && this.m_destructionListener.SayGoodbyeFixture(t),
            t.DestroyProxy(this.m_contactManager.m_broadPhase),
            t.Destroy();
        }
        (t.m_fixtureList = null),
          (t.m_fixtureCount = 0),
          t.m_prev && (t === this.m_last && (this.m_last = t.m_prev), (t.m_prev.m_next = t.m_next)),
          t.m_next && (t.m_next.m_prev = t.m_prev),
          t === this.m_bodyList && (this.m_bodyList = t.m_next),
          (t.m_userData = null),
          (t.m_sweep = null),
          (t.m_xf = null),
          (t.m_linearVelocity = null),
          (t.m_force = null),
          (t.m_world = null),
          (t.m_prev = null),
          (t.m_next = null),
          (t.m_controllerList = null),
          (t.m_jointList = null),
          (t.m_type = 0),
          (t.m_flags &= ~h.e_activeFlag),
          (t.m_isAwake = !1),
          --this.m_bodyCount;
      }),
      (C.prototype.CreateJoint = function (t) {
        let i = v.Create(t, null);
        (i.m_prev = null),
          (i.m_next = this.m_jointList),
          this.m_jointList && (this.m_jointList.m_prev = i),
          (this.m_jointList = i),
          ++this.m_jointCount,
          (i.m_edgeA.joint = i),
          (i.m_edgeA.other = i.m_bodyB),
          (i.m_edgeA.prev = null),
          (i.m_edgeA.next = i.m_bodyA.m_jointList),
          i.m_bodyA.m_jointList && (i.m_bodyA.m_jointList.prev = i.m_edgeA),
          (i.m_bodyA.m_jointList = i.m_edgeA),
          (i.m_edgeB.joint = i),
          (i.m_edgeB.other = i.m_bodyA),
          (i.m_edgeB.prev = null),
          (i.m_edgeB.next = i.m_bodyB.m_jointList),
          i.m_bodyB.m_jointList && (i.m_bodyB.m_jointList.prev = i.m_edgeB),
          (i.m_bodyB.m_jointList = i.m_edgeB);
        let o = t.bodyA,
          e = t.bodyB;
        if (!t.collideConnected) {
          let t = e.GetContactList();
          for (; t; ) t.other === o && (t.contact.m_isFiltered = !0), (t = t.next);
        }
        return i;
      }),
      (C.prototype.DestroyJoint = function (t) {
        let i = t.m_collideConnected;
        t.m_prev && (t.m_prev.m_next = t.m_next),
          t.m_next && (t.m_next.m_prev = t.m_prev),
          t === this.m_jointList && (this.m_jointList = t.m_next);
        let o = t.m_bodyA,
          e = t.m_bodyB;
        if (
          (o.SetAwake(!0),
          e.SetAwake(!0),
          t.m_edgeA.prev && (t.m_edgeA.prev.next = t.m_edgeA.next),
          t.m_edgeA.next && (t.m_edgeA.next.prev = t.m_edgeA.prev),
          t.m_edgeA === o.m_jointList && (o.m_jointList = t.m_edgeA.next),
          (t.m_edgeA.prev = null),
          (t.m_edgeA.next = null),
          t.m_edgeB.prev && (t.m_edgeB.prev.next = t.m_edgeB.next),
          t.m_edgeB.next && (t.m_edgeB.next.prev = t.m_edgeB.prev),
          t.m_edgeB === e.m_jointList && (e.m_jointList = t.m_edgeB.next),
          (t.m_edgeB.prev = null),
          (t.m_edgeB.next = null),
          v.Destroy(t, null),
          --this.m_jointCount,
          !1 === i)
        ) {
          let t = e.GetContactList();
          for (; t; ) t.other === o && (t.contact.m_isFiltered = !0), (t = t.next);
        }
      }),
      (C.prototype.AddController = function (t) {
        return (
          null !== this.m_controllerList && (this.m_controllerList.m_prev = t),
          (t.m_next = this.m_controllerList),
          (t.m_prev = null),
          (this.m_controllerList = t),
          (t.m_world = this),
          this.m_controllerCount++,
          t
        );
      }),
      (C.prototype.RemoveController = function (t) {
        t.m_prev && (t.m_prev.m_next = t.m_next),
          t.m_next && (t.m_next.m_prev = t.m_prev),
          this.m_controllerList === t && (this.m_controllerList = t.m_next),
          this.m_controllerCount--;
      }),
      (C.prototype.CreateController = function (t) {
        if (t.m_world !== this) throw new Error("Controller can only be a member of one world");
        return (
          (t.m_next = this.m_controllerList),
          (t.m_prev = null),
          this.m_controllerList && (this.m_controllerList.m_prev = t),
          (this.m_controllerList = t),
          ++this.m_controllerCount,
          (t.m_world = this),
          t
        );
      }),
      (C.prototype.DestroyController = function (t) {
        t.Clear(),
          t.m_next && (t.m_next.m_prev = t.m_prev),
          t.m_prev && (t.m_prev.m_next = t.m_next),
          t === this.m_controllerList && (this.m_controllerList = t.m_next),
          --this.m_controllerCount;
      }),
      (C.prototype.SetWarmStarting = function (t) {
        C.m_warmStarting = t;
      }),
      (C.prototype.SetContinuousPhysics = function (t) {
        C.m_continuousPhysics = t;
      }),
      (C.prototype.GetBodyCount = function () {
        return this.m_bodyCount;
      }),
      (C.prototype.GetJointCount = function () {
        return this.m_jointCount;
      }),
      (C.prototype.GetContactCount = function () {
        return this.m_contactCount;
      }),
      (C.prototype.SetGravity = function (t) {
        this.m_gravity = t;
      }),
      (C.prototype.GetGravity = function () {
        return this.m_gravity;
      }),
      (C.prototype.GetGroundBody = function () {
        return this.m_groundBody;
      }),
      (C.prototype.Step = function (t, i, o) {
        this.m_flags & C.e_newFixture &&
          (this.m_contactManager.FindNewContacts(), (this.m_flags &= ~C.e_newFixture)),
          (this.m_flags |= C.e_locked);
        let e = C.s_timestep2;
        (e.dt = t),
          (e.velocityIterations = i),
          (e.positionIterations = o),
          (e.inv_dt = 1 / t),
          (e.dtRatio = this.m_inv_dt0 * t),
          (e.warmStarting = C.m_warmStarting),
          this.m_contactManager.Collide(),
          this.Solve(e),
          C.m_continuousPhysics && this.SolveTOI(e),
          (this.m_inv_dt0 = e.inv_dt),
          (this.m_flags &= ~C.e_locked);
      }),
      (C.prototype.ClearForces = function () {
        for (let t = this.m_bodyList; t; t = t.m_next) t.m_force.SetZero(), (t.m_torque = 0);
      }),
      (C.QueryProxyCallback = function (t) {
        return C.QueryCallback(t.userData);
      }),
      (C.QueryCallback = null),
      (C.prototype.QueryAABB = function (t, i) {
        let o = this.m_contactManager.m_broadPhase;
        (C.QueryCallback = t), o.Query(C.QueryProxyCallback, i);
      }),
      (C.QueryShapeWrapper = function (t) {
        let i = t.userData;
        return (
          !_.TestOverlap(
            C.QueryShapeWrapperShape,
            C.QueryShapeWrapperTransform,
            i.m_shape,
            i.m_body.m_xf
          ) || C.QueryShapeWrapperCallback(i)
        );
      }),
      (C.QueryShapeWrapperShape = null),
      (C.QueryShapeWrapperCallback = null),
      (C.QueryShapeWrapperTransform = null),
      (C.QueryShapeWrapperAABB = new n()),
      (C.prototype.QueryShape = function (t, i, e) {
        e || (e = new o()).SetIdentity(),
          (C.QueryShapeWrapperCallback = t),
          (C.QueryShapeWrapperShape = i),
          (C.QueryShapeWrapperTransform = e);
        let s = this.m_contactManager.m_broadPhase;
        i.ComputeAABB(C.QueryShapeWrapperAABB, e),
          s.Query(C.QueryShapeWrapper, C.QueryShapeWrapperAABB);
      }),
      (C.QueryPointWrapper = function (t) {
        let i = t.userData;
        return !i.TestPoint(C.QueryPointWrapperPoint) || C.QueryPointWrapperCallback(i);
      }),
      (C.QueryPointWrapperPoint = null),
      (C.QueryPointWrapperCallback = null),
      (C.QueryPointWrapperAABB = new n()),
      (C.prototype.QueryPoint = function (t, i) {
        let o = this.m_contactManager.m_broadPhase;
        (C.QueryPointWrapperCallback = t),
          (C.QueryPointWrapperPoint = i),
          (C.QueryPointWrapperAABB.lowerBound.x = i.x - s.b2_linearSlop),
          (C.QueryPointWrapperAABB.lowerBound.y = i.y - s.b2_linearSlop),
          (C.QueryPointWrapperAABB.upperBound.x = i.x + s.b2_linearSlop),
          (C.QueryPointWrapperAABB.upperBound.y = i.y + s.b2_linearSlop),
          o.Query(C.QueryPointWrapper, C.QueryPointWrapperAABB);
      }),
      (C.RayCastOutputInst = new r()),
      (C.RayCastCallback = function (t, i, o) {
        if (i.userData.RayCast(C.RayCastOutputInst, t)) {
          let s = C.RayCastOutputInst.fraction,
            n = new e((1 - s) * t.p1.x + s * t.p2.x, (1 - s) * t.p1.y + s * t.p2.y);
          return o.ReportFixture(i.userData, n, C.RayCastOutputInst.normal, s);
        }
        return t.maxFraction;
      }),
      (C.RayCastInput = new m(new e(), new e())),
      (C.prototype.RayCast = function (t, i, o) {
        let e = this.m_contactManager.m_broadPhase;
        (C.RayCastInput.p1.x = i.x),
          (C.RayCastInput.p1.y = i.y),
          (C.RayCastInput.p2.x = o.x),
          (C.RayCastInput.p2.y = o.y),
          e.RayCast(C.RayCastInput, t);
      }),
      (C.prototype.RayCastOne = function (t, i) {
        let o;
        return (
          this.RayCast(
            function (t, i, e, s) {
              return void 0 === s && (s = 0), (o = t), s;
            },
            t,
            i
          ),
          o
        );
      }),
      (C.prototype.RayCastAll = function (t, i) {
        let o = [];
        return (
          this.RayCast(
            function (t, i, e, s) {
              return void 0 === s && (s = 0), (o[o.length] = t), 1;
            },
            t,
            i
          ),
          o
        );
      }),
      (C.prototype.GetBodyList = function () {
        return this.m_bodyList;
      }),
      (C.prototype.GetJointList = function () {
        return this.m_jointList;
      }),
      (C.prototype.GetContactList = function () {
        return this.m_contactList;
      }),
      (C.prototype.IsLocked = function () {
        return (this.m_flags & C.e_locked) > 0;
      }),
      (C.prototype.Solve = function (t) {
        let i;
        for (let i = this.m_controllerList; i; i = i.m_next) i.Step(t);
        let o,
          e = this.m_island;
        for (
          e.Initialize(
            this.m_bodyCount,
            this.m_contactCount,
            this.m_jointCount,
            null,
            this.m_contactManager.m_contactListener,
            this.m_contactSolver
          ),
            i = this.m_bodyList;
          i;
          i = i.m_next
        )
          i.m_flags &= ~h.e_islandFlag;
        for (let t = this.m_contactList; t; t = t.m_next) t.m_flags &= ~w.e_islandFlag;
        for (let t = this.m_jointList; t; t = t.m_next) t.m_islandFlag = !1;
        let s = this.s_stack;
        for (let n = this.m_bodyList; n && n.m_type !== h.b2_staticBody; n = n.m_next) {
          if (n.m_flags & h.e_islandFlag) continue;
          if (!n.m_isAwake || !n.IsActive()) continue;
          e.Clear();
          let l = 0;
          for (s[l++] = n, n.m_flags |= h.e_islandFlag; 0 !== l; ) {
            if ((i = s[--l]).m_type === h.b2_staticBody) {
              e.AddStaticBody(i);
              continue;
            }
            let t;
            e.AddNonStaticBody(i), i.m_isAwake || i.SetAwake(!0);
            for (let o = i.m_contactList; o; o = o.next)
              o.contact.m_flags & w.e_islandFlag ||
                (o.contact.m_isTouching &&
                  !o.contact.m_isSensor &&
                  o.contact.m_isEnabled &&
                  (e.AddContact(o.contact),
                  (o.contact.m_flags |= w.e_islandFlag),
                  (t = o.other).m_flags & h.e_islandFlag ||
                    ((s[l++] = t), (t.m_flags |= h.e_islandFlag))));
            for (let o = i.m_jointList; o; o = o.next)
              o.joint.m_islandFlag ||
                ((t = o.other).IsActive() &&
                  (e.AddJoint(o.joint),
                  (o.joint.m_islandFlag = !0),
                  t.m_flags & h.e_islandFlag || ((s[l++] = t), (t.m_flags |= h.e_islandFlag))));
          }
          for (
            e.Solve(t, this.m_gravity, this.m_allowSleep), o = e.m_bodyCount - 1;
            o >= e.m_staticIndex;
            o--
          )
            (i = e.m_bodies[o]).m_flags &= ~h.e_islandFlag;
        }
        for (o = 0; s[o]; ) s[o++] = null;
        for (i = this.m_bodyList; i && i.m_type !== h.b2_staticBody; i = i.m_next)
          i.m_isAwake && i.IsActive() && i.SynchronizeFixtures();
        this.m_contactManager.FindNewContacts();
      }),
      (C.prototype.SolveTOI = function (t) {
        let i,
          o,
          e,
          n,
          l = this.m_island;
        l.Initialize(
          this.m_bodyCount,
          s.b2_maxTOIContactsPerIsland,
          s.b2_maxTOIJointsPerIsland,
          null,
          this.m_contactManager.m_contactListener,
          this.m_contactSolver
        );
        let m,
          r,
          a,
          _ = C.s_queue;
        for (let t = this.m_bodyList; t; t = t.m_next)
          (t.m_flags &= ~h.e_islandFlag), (t.m_sweep.t0 = 0);
        for (m = this.m_contactList; m; m = m.m_next) m.m_flags &= ~(w.e_toiFlag | w.e_islandFlag);
        for (let t = this.m_jointList; t; t = t.m_next) t.m_islandFlag = !1;
        let c = 50;
        for (; c-- > 0; ) {
          let s = null,
            c = 1;
          for (m = this.m_contactList; m; m = m.m_next) {
            if (!m.m_isContinuous || m.m_isSensor || !m.m_isEnabled) continue;
            let t = 1;
            if (m.m_flags & w.e_toiFlag) t = m.m_toi;
            else {
              if (
                ((i = m.m_fixtureA),
                (o = m.m_fixtureB),
                (e = i.m_body),
                (n = o.m_body),
                !(
                  (e.m_type === h.b2_dynamicBody && e.m_isAwake) ||
                  (n.m_type === h.b2_dynamicBody && n.m_isAwake)
                ))
              )
                continue;
              let s = e.m_sweep.t0;
              e.m_sweep.t0 < n.m_sweep.t0
                ? ((s = n.m_sweep.t0), e.m_sweep.Advance(s))
                : n.m_sweep.t0 < e.m_sweep.t0 && ((s = e.m_sweep.t0), n.m_sweep.Advance(s)),
                (t = m.ComputeTOI(e.m_sweep, n.m_sweep)) > 0 &&
                  t < 1 &&
                  (t = (1 - t) * s + t) > 1 &&
                  (t = 1),
                (m.m_toi = t),
                (m.m_flags |= w.e_toiFlag);
            }
            Number.MIN_VALUE < t && t < c && ((s = m), (c = t));
          }
          if (null === s || 1 - 100 * Number.MIN_VALUE < c) break;
          if (
            ((i = s.m_fixtureA),
            (o = s.m_fixtureB),
            (e = i.m_body),
            (n = o.m_body),
            C.s_backupA.Set(e.m_sweep),
            C.s_backupB.Set(n.m_sweep),
            e.Advance(c),
            n.Advance(c),
            s.Update(this.m_contactManager.m_contactListener),
            (s.m_flags &= ~w.e_toiFlag),
            s.m_isSensor || !s.m_isEnabled)
          ) {
            e.m_sweep.Set(C.s_backupA),
              n.m_sweep.Set(C.s_backupB),
              e.SynchronizeTransform(),
              n.SynchronizeTransform();
            continue;
          }
          if (!s.m_isTouching) continue;
          let y = e.m_type !== h.b2_dynamicBody ? n : e;
          l.Clear();
          let p = 0,
            u = 1;
          for (_[0] = y, y.m_flags |= h.e_islandFlag; 0 != u--; )
            if (
              ((r = _[p++]),
              l.AddBody(r),
              r.m_isAwake || r.SetAwake(!0),
              r.m_type === h.b2_dynamicBody)
            ) {
              for (
                let t = r.m_contactList;
                t && l.m_contactCount !== l.m_contactCapacity;
                t = t.next
              ) {
                if (t.contact.m_flags & w.e_islandFlag) continue;
                if (!t.contact.m_isTouching || t.contact.m_isSensor || !t.contact.m_isEnabled)
                  continue;
                l.AddContact(t.contact), (t.contact.m_flags |= w.e_islandFlag);
                let i = t.other;
                t.other.m_flags & h.e_islandFlag ||
                  (i.m_type !== h.b2_staticBody && (i.Advance(c), i.SetAwake(!0)),
                  (_[p + u++] = i),
                  (i.m_flags |= h.e_islandFlag));
              }
              for (let t = r.m_jointList; t; t = t.next) {
                if (l.m_jointCount === l.m_jointCapacity) continue;
                if (t.joint.m_islandFlag) continue;
                let i = t.other;
                i.IsActive() &&
                  (l.AddJoint(t.joint),
                  (t.joint.m_islandFlag = !0),
                  i.m_flags & h.e_islandFlag ||
                    (i.m_type !== h.b2_staticBody && (i.Advance(c), i.SetAwake(!0)),
                    (_[p + u++] = i),
                    (i.m_flags |= h.e_islandFlag)));
              }
            }
          let x,
            d = C.s_timestep;
          for (
            d.warmStarting = !1,
              d.dt = (1 - c) * t.dt,
              d.inv_dt = 1 / d.dt,
              d.dtRatio = 0,
              d.velocityIterations = t.velocityIterations,
              d.positionIterations = t.positionIterations,
              l.SolveTOI(d),
              x = 0;
            x < l.m_bodyCount;
            x++
          )
            if (
              (((r = l.m_bodies[x]).m_flags &= ~h.e_islandFlag),
              r.m_type === h.b2_dynamicBody && r.m_isAwake)
            )
              for (r.SynchronizeFixtures(), a = r.m_contactList; a; a = a.next)
                a.contact.m_flags &= ~w.e_toiFlag;
          for (x = l.m_contactCount; x > 0; )
            l.m_contacts[--x].m_flags &= ~(w.e_toiFlag | w.e_islandFlag);
          for (x = l.m_jointCount; x > 0; ) l.m_joints[--x].m_islandFlag = !1;
          this.m_contactManager.FindNewContacts();
        }
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Dynamics.b2World.s_timestep2 = new D()),
          (Box2D.Dynamics.b2World.s_xf = new o()),
          (Box2D.Dynamics.b2World.s_backupA = new i()),
          (Box2D.Dynamics.b2World.s_backupB = new i()),
          (Box2D.Dynamics.b2World.s_timestep = new D()),
          (Box2D.Dynamics.b2World.s_queue = []),
          (Box2D.Dynamics.b2World.e_newFixture = 1),
          (Box2D.Dynamics.b2World.e_locked = 2);
      });
  })(),
  (function () {
    Box2D.Collision.Shapes.b2CircleShape,
      Box2D.Collision.Shapes.b2EdgeShape,
      Box2D.Collision.Shapes.b2PolygonShape;
    let t = Box2D.Collision.Shapes.b2Shape,
      i = Box2D.Dynamics.Contacts.b2CircleContact,
      o = Box2D.Dynamics.Contacts.b2Contact,
      e = Box2D.Dynamics.Contacts.b2ContactConstraint,
      s = Box2D.Dynamics.Contacts.b2ContactFactory,
      n = Box2D.Dynamics.Contacts.b2ContactRegister,
      l = Box2D.Dynamics.Contacts.b2ContactSolver,
      m = Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,
      r = Box2D.Dynamics.Contacts.b2NullContact,
      a = Box2D.Dynamics.Contacts.b2PolyAndCircleContact,
      _ = Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,
      h = Box2D.Dynamics.Contacts.b2PolygonContact,
      c = Box2D.Dynamics.Contacts.b2PositionSolverManifold,
      y = Box2D.Dynamics.b2Body,
      p = Box2D.Common.b2Settings,
      u = Box2D.Common.Math.b2Math,
      x = Box2D.Common.Math.b2Vec2,
      d = Box2D.Collision.b2Collision,
      f = Box2D.Collision.b2Manifold,
      b = Box2D.Collision.b2TimeOfImpact,
      B = Box2D.Collision.b2TOIInput,
      A = Box2D.Collision.b2WorldManifold;
    Box2D.inherit(i, Box2D.Dynamics.Contacts.b2Contact),
      (i.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype),
      (i.Create = function (t) {
        return new i();
      }),
      (i.Destroy = function (t, i) {}),
      (i.prototype.Reset = function (t, i) {
        if (((this.m_flags = o.e_enabledFlag), !t || !i))
          return (this.m_fixtureA = null), void (this.m_fixtureB = null);
        (this.m_isSensor = t.m_isSensor || i.m_isSensor),
          (this.m_isEnabled = !0),
          (this.m_isFiltered = !1),
          (this.m_isTouching = !1);
        let e = t.m_body,
          s = i.m_body;
        (this.m_isContinuous =
          e.m_type !== y.b2_dynamicBody ||
          e.IsBullet() ||
          s.m_type !== y.b2_dynamicBody ||
          s.IsBullet()),
          (this.m_fixtureA = t),
          (this.m_fixtureB = i),
          (this.m_manifold.m_pointCount = 0),
          (this.m_prev = null),
          (this.m_next = null),
          (this.m_nodeA.contact = null),
          (this.m_nodeA.prev = null),
          (this.m_nodeA.next = null),
          (this.m_nodeA.other = null),
          (this.m_nodeB.contact = null),
          (this.m_nodeB.prev = null),
          (this.m_nodeB.next = null),
          (this.m_nodeB.other = null);
      }),
      (i.prototype.Evaluate = function () {
        let t = this.m_fixtureA.m_body,
          i = this.m_fixtureB.m_body;
        d.CollideCircles(
          this.m_manifold,
          this.m_fixtureA.m_shape,
          t.m_xf,
          this.m_fixtureB.m_shape,
          i.m_xf
        );
      }),
      (o.prototype.GetManifold = function () {
        return this.m_manifold;
      }),
      (o.prototype.GetWorldManifold = function (t) {
        let i = this.m_fixtureA.m_body,
          o = this.m_fixtureB.m_body,
          e = this.m_fixtureA.m_shape,
          s = this.m_fixtureB.m_shape;
        t.Initialize(this.m_manifold, i.m_xf, e.m_radius, o.m_xf, s.m_radius);
      }),
      (o.prototype.IsTouching = function () {
        return this.m_isTouching;
      }),
      (o.prototype.IsContinuous = function () {
        return this.m_isContinuous;
      }),
      (o.prototype.SetSensor = function (t) {
        this.m_isSensor = t;
      }),
      (o.prototype.IsSensor = function () {
        return this.m_isSensor;
      }),
      (o.prototype.SetEnabled = function (t) {
        this.m_isEnabled = t;
      }),
      (o.prototype.IsEnabled = function () {
        return this.m_isEnabled;
      }),
      (o.prototype.GetNext = function () {
        return this.m_next;
      }),
      (o.prototype.GetFixtureA = function () {
        return this.m_fixtureA;
      }),
      (o.prototype.GetFixtureB = function () {
        return this.m_fixtureB;
      }),
      (o.prototype.FlagForFiltering = function () {
        this.m_isFiltered = !0;
      }),
      (o.prototype.b2Contact = function () {}),
      (o.prototype.Reset = function (t, i) {
        if (((this.m_flags = o.e_enabledFlag), !t || !i))
          return (this.m_fixtureA = null), void (this.m_fixtureB = null);
        (this.m_isSensor = t.m_isSensor || i.m_isSensor),
          (this.m_isEnabled = !0),
          (this.m_isFiltered = !1),
          (this.m_isTouching = !1);
        let e = t.m_body,
          s = i.m_body;
        (this.m_isContinuous =
          e.m_type !== y.b2_dynamicBody ||
          e.IsBullet() ||
          s.m_type !== y.b2_dynamicBody ||
          s.IsBullet()),
          (this.m_fixtureA = t),
          (this.m_fixtureB = i),
          (this.m_manifold.m_pointCount = 0),
          (this.m_prev = null),
          (this.m_next = null),
          (this.m_nodeA.contact = null),
          (this.m_nodeA.prev = null),
          (this.m_nodeA.next = null),
          (this.m_nodeA.other = null),
          (this.m_nodeB.contact = null),
          (this.m_nodeB.prev = null),
          (this.m_nodeB.next = null),
          (this.m_nodeB.other = null);
      }),
      (o.prototype.Update = function (i) {
        let o = this.m_oldManifold;
        (this.m_oldManifold = this.m_manifold), (this.m_manifold = o), (this.m_isEnabled = !0);
        let e = !1,
          s = this.m_isTouching,
          n = this.m_fixtureA.m_body,
          l = this.m_fixtureB.m_body,
          m = this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);
        if (this.m_isSensor) {
          if (m) {
            let i = this.m_fixtureA.m_shape,
              o = this.m_fixtureB.m_shape,
              s = n.m_xf,
              m = l.m_xf;
            e = t.TestOverlap(i, s, o, m);
          }
          this.m_manifold.m_pointCount = 0;
        } else {
          if (
            ((this.m_isContinuous =
              n.m_type !== y.b2_dynamicBody ||
              n.IsBullet() ||
              l.m_type !== y.b2_dynamicBody ||
              l.IsBullet()),
            m)
          ) {
            this.Evaluate(), (e = this.m_manifold.m_pointCount > 0);
            for (let t = 0; t < this.m_manifold.m_pointCount; ++t) {
              let i = this.m_manifold.m_points[t];
              (i.m_normalImpulse = 0), (i.m_tangentImpulse = 0);
              let o = i.m_id;
              for (let t = 0; t < this.m_oldManifold.m_pointCount; ++t) {
                let e = this.m_oldManifold.m_points[t];
                if (e.m_id.key === o.key) {
                  (i.m_normalImpulse = e.m_normalImpulse),
                    (i.m_tangentImpulse = e.m_tangentImpulse);
                  break;
                }
              }
            }
          } else this.m_manifold.m_pointCount = 0;
          e !== s && (n.SetAwake(!0), l.SetAwake(!0));
        }
        (this.m_isTouching = e),
          !s && e && i.BeginContact(this),
          s && !e && i.EndContact(this),
          this.m_isSensor || i.PreSolve(this, this.m_oldManifold);
      }),
      (o.prototype.Evaluate = function () {}),
      (o.prototype.ComputeTOI = function (t, i) {
        return (
          o.s_input.proxyA.Set(this.m_fixtureA.m_shape),
          o.s_input.proxyB.Set(this.m_fixtureB.m_shape),
          (o.s_input.sweepA = t),
          (o.s_input.sweepB = i),
          (o.s_input.tolerance = p.b2_linearSlop),
          b.TimeOfImpact(o.s_input)
        );
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag = 1),
          (Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag = 2),
          (Box2D.Dynamics.Contacts.b2Contact.e_islandFlag = 4),
          (Box2D.Dynamics.Contacts.b2Contact.e_toiFlag = 8),
          (Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag = 16),
          (Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag = 32),
          (Box2D.Dynamics.Contacts.b2Contact.e_filterFlag = 64),
          (Box2D.Dynamics.Contacts.b2Contact.s_input = new B());
      }),
      (s.prototype.AddType = function (t, i, o, e) {
        void 0 === o && (o = 0),
          void 0 === e && (e = 0),
          (this.m_registers[o][e].createFcn = t),
          (this.m_registers[o][e].destroyFcn = i),
          (this.m_registers[o][e].primary = !0),
          o !== e &&
            ((this.m_registers[e][o].createFcn = t),
            (this.m_registers[e][o].destroyFcn = i),
            (this.m_registers[e][o].primary = !1));
      }),
      (s.prototype.InitializeRegisters = function () {
        (this.m_registers = [
          [new n(), new n(), new n()],
          [new n(), new n(), new n()],
          [new n(), new n(), new n()],
        ]),
          this.AddType(i.Create, i.Destroy, t.e_circleShape, t.e_circleShape),
          this.AddType(a.Create, a.Destroy, t.e_polygonShape, t.e_circleShape),
          this.AddType(h.Create, h.Destroy, t.e_polygonShape, t.e_polygonShape),
          this.AddType(m.Create, m.Destroy, t.e_edgeShape, t.e_circleShape),
          this.AddType(_.Create, _.Destroy, t.e_polygonShape, t.e_edgeShape);
      }),
      (s.prototype.Create = function (t, i) {
        let o = t.GetType(),
          e = i.GetType(),
          s = this.m_registers[o][e];
        if (s.pool) {
          let o = s.pool;
          return (s.pool = o.m_next), o.m_swapped ? o.Reset(i, t) : o.Reset(t, i), o;
        }
        let n = s.createFcn;
        if (n) {
          let o = n(this.m_allocator);
          return (
            s.primary ? (o.Reset(t, i), (o.m_swapped = !1)) : (o.Reset(i, t), (o.m_swapped = !0)), o
          );
        }
        return null;
      }),
      (s.prototype.Destroy = function (t) {
        t.m_manifold.m_pointCount > 0 &&
          (t.m_fixtureA.m_body.SetAwake(!0), t.m_fixtureB.m_body.SetAwake(!0));
        let i,
          o = t.m_fixtureA.GetType(),
          e = t.m_fixtureB.GetType();
        (i = t.m_swapped ? this.m_registers[e][o] : this.m_registers[o][e]),
          t.Reset(null, null),
          (t.m_next = i.pool),
          (i.pool = t),
          (0, i.destroyFcn)(t, this.m_allocator);
      }),
      (l.prototype.Initialize = function (t, i, o, s) {
        for (
          this.m_step.Set(t), this.m_allocator = s, this.m_constraintCount = o;
          this.m_constraints.length < this.m_constraintCount;

        )
          this.m_constraints.push(new e());
        let n;
        for (let t = 0; t < o; ++t) {
          let o = (n = i[t]).m_fixtureA,
            e = n.m_fixtureB,
            s = o.m_body,
            m = e.m_body,
            r = n.m_manifold,
            a = s.m_linearVelocity.x,
            _ = s.m_linearVelocity.y,
            h = m.m_linearVelocity.x,
            c = m.m_linearVelocity.y;
          l.s_worldManifold.Initialize(r, s.m_xf, o.m_shape.m_radius, m.m_xf, e.m_shape.m_radius);
          let y = l.s_worldManifold.m_normal.x,
            u = l.s_worldManifold.m_normal.y,
            x = this.m_constraints[t];
          (x.bodyA = s),
            (x.bodyB = m),
            (x.manifold = r),
            (x.normal.x = y),
            (x.normal.y = u),
            (x.pointCount = r.m_pointCount),
            (x.friction = Math.sqrt(o.m_friction * e.m_friction)),
            (x.restitution =
              o.minRestitution || e.minRestitution
                ? p.b2MixRestitutionMin(o.m_restitution, e.m_restitution)
                : p.b2MixRestitution(o.m_restitution, e.m_restitution)),
            (x.localPlaneNormal.x = r.m_localPlaneNormal.x),
            (x.localPlaneNormal.y = r.m_localPlaneNormal.y),
            (x.localPoint.x = r.m_localPoint.x),
            (x.localPoint.y = r.m_localPoint.y),
            (x.radius = o.m_shape.m_radius + e.m_shape.m_radius),
            (x.type = r.m_type);
          for (let t = 0; t < x.pointCount; ++t) {
            let i = r.m_points[t],
              o = l.s_worldManifold.m_points[t],
              e = x.points[t];
            (e.normalImpulse = i.m_normalImpulse),
              (e.tangentImpulse = i.m_tangentImpulse),
              (e.localPoint.x = i.m_localPoint.x),
              (e.localPoint.y = i.m_localPoint.y);
            let n = (e.rA.x = o.x - s.m_sweep.c.x),
              d = (e.rA.y = o.y - s.m_sweep.c.y),
              f = (e.rB.x = o.x - m.m_sweep.c.x),
              b = (e.rB.y = o.y - m.m_sweep.c.y),
              B = n * u - d * y,
              A = f * u - b * y;
            (B *= B),
              (A *= A),
              (e.normalMass = 1 / (s.m_invMass + m.m_invMass + s.m_invI * B + m.m_invI * A));
            let D = s.m_mass * s.m_invMass + m.m_mass * m.m_invMass;
            (D += s.m_mass * s.m_invI * B + m.m_mass * m.m_invI * A), (e.equalizedMass = 1 / D);
            let C = -n * y - d * u,
              w = -f * y - b * u;
            (e.tangentMass = 1 / (s.m_invMass + m.m_invMass + s.m_invI * C * C + m.m_invI * w * w)),
              (e.velocityBias = 0);
            let v = h + -m.m_angularVelocity * b - a - -s.m_angularVelocity * d,
              g = c + m.m_angularVelocity * f - _ - s.m_angularVelocity * n,
              S = x.normal.x * v + x.normal.y * g;
            S < -p.b2_velocityThreshold && (e.velocityBias -= x.restitution * S);
          }
          if (2 === x.pointCount) {
            let t = x.points[0],
              i = x.points[1],
              o = t.rA.x * u - t.rA.y * y,
              e = t.rB.x * u - t.rB.y * y,
              n = i.rA.x * u - i.rA.y * y,
              l = i.rB.x * u - i.rB.y * y,
              r = s.m_invMass + m.m_invMass + s.m_invI * o * o + m.m_invI * e * e,
              a = s.m_invMass + m.m_invMass + s.m_invI * n * n + m.m_invI * l * l,
              _ = s.m_invMass + m.m_invMass + s.m_invI * o * n + m.m_invI * e * l;
            r * r < 100 * (r * a - _ * _)
              ? (x.K.col1.Set(r, _), x.K.col2.Set(_, a), x.K.GetInverse(x.normalMass))
              : (x.pointCount = 1);
          }
        }
      }),
      (l.prototype.InitVelocityConstraints = function (t) {
        for (let i = 0; i < this.m_constraintCount; ++i) {
          let o = this.m_constraints[i];
          if (t.warmStarting)
            for (let i = 0; i < o.pointCount; ++i) {
              let e = o.points[i];
              (e.normalImpulse *= t.dtRatio), (e.tangentImpulse *= t.dtRatio);
              let s = e.normalImpulse * o.normal.x + e.tangentImpulse * o.normal.y,
                n = e.normalImpulse * o.normal.y - e.tangentImpulse * o.normal.x;
              (o.bodyA.m_angularVelocity -= o.bodyA.m_invI * (e.rA.x * n - e.rA.y * s)),
                (o.bodyA.m_linearVelocity.x -= o.bodyA.m_invMass * s),
                (o.bodyA.m_linearVelocity.y -= o.bodyA.m_invMass * n),
                (o.bodyB.m_angularVelocity += o.bodyB.m_invI * (e.rB.x * n - e.rB.y * s)),
                (o.bodyB.m_linearVelocity.x += o.bodyB.m_invMass * s),
                (o.bodyB.m_linearVelocity.y += o.bodyB.m_invMass * n);
            }
          else
            for (let t = 0; t < o.pointCount; ++t) {
              let i = o.points[t];
              (i.normalImpulse = 0), (i.tangentImpulse = 0);
            }
        }
      }),
      (l.prototype.SolveVelocityConstraints = function () {
        let t,
          i,
          o,
          e,
          s,
          n,
          l,
          m,
          r,
          a,
          _,
          h = this.m_constraintCount;
        for (; h > 0; ) {
          let c = this.m_constraints[--h],
            y = c.bodyA,
            p = c.bodyB,
            x = y.m_angularVelocity,
            d = p.m_angularVelocity,
            f = y.m_linearVelocity,
            b = p.m_linearVelocity,
            B = y.m_invMass,
            A = y.m_invI,
            D = p.m_invMass,
            C = p.m_invI,
            w = c.normal.x,
            v = c.normal.y;
          for (t = c.pointCount; t > 0; )
            (i = c.points[--t]),
              (n =
                (o = b.x - d * i.rB.y - f.x + x * i.rA.y) * v -
                (e = b.y + d * i.rB.x - f.y - x * i.rA.x) * w),
              (l = i.tangentMass * -n),
              (m = c.friction * i.normalImpulse),
              (a = (l = (r = u.Clamp(i.tangentImpulse + l, -m, m)) - i.tangentImpulse) * v),
              (_ = -l * w),
              (f.x -= B * a),
              (f.y -= B * _),
              (x -= A * (i.rA.x * _ - i.rA.y * a)),
              (b.x += D * a),
              (b.y += D * _),
              (d += C * (i.rB.x * _ - i.rB.y * a)),
              (i.tangentImpulse = r);
          if (1 === c.pointCount)
            (i = c.points[0]),
              (s =
                (o = b.x + -d * i.rB.y - f.x - -x * i.rA.y) * w +
                (e = b.y + d * i.rB.x - f.y - x * i.rA.x) * v),
              (l = -i.normalMass * (s - i.velocityBias)),
              (a = (l = (r = (r = i.normalImpulse + l) > 0 ? r : 0) - i.normalImpulse) * w),
              (_ = l * v),
              (f.x -= B * a),
              (f.y -= B * _),
              (x -= A * (i.rA.x * _ - i.rA.y * a)),
              (b.x += D * a),
              (b.y += D * _),
              (d += C * (i.rB.x * _ - i.rB.y * a)),
              (i.normalImpulse = r);
          else {
            let t,
              i,
              o,
              e,
              s,
              n,
              l = c.points[0],
              m = c.points[1],
              r = l.normalImpulse,
              a = m.normalImpulse,
              _ =
                (b.x - d * l.rB.y - f.x + x * l.rA.y) * w +
                (b.y + d * l.rB.x - f.y - x * l.rA.x) * v -
                l.velocityBias,
              h =
                (b.x - d * m.rB.y - f.x + x * m.rA.y) * w +
                (b.y + d * m.rB.x - f.y - x * m.rA.x) * v -
                m.velocityBias,
              y = c.K;
            for (_ -= y.col1.x * r + y.col2.x * a, h -= y.col1.y * r + y.col2.y * a; ; ) {
              let p = -((y = c.normalMass).col1.x * _ + y.col2.x * h),
                u = -(y.col1.y * _ + y.col2.y * h);
              if (p >= 0 && u >= 0) {
                (t = (s = p - r) * w),
                  (i = s * v),
                  (o = (n = u - a) * w),
                  (e = n * v),
                  (f.x -= B * (t + o)),
                  (f.y -= B * (i + e)),
                  (x -= A * (l.rA.x * i - l.rA.y * t + m.rA.x * e - m.rA.y * o)),
                  (b.x += D * (t + o)),
                  (b.y += D * (i + e)),
                  (d += C * (l.rB.x * i - l.rB.y * t + m.rB.x * e - m.rB.y * o)),
                  (l.normalImpulse = p),
                  (m.normalImpulse = u);
                break;
              }
              if ((p = -l.normalMass * _) >= 0 && c.K.col1.y * p + h >= 0) {
                (t = (s = p - r) * w),
                  (i = s * v),
                  (o = -a * w),
                  (e = -a * v),
                  (f.x -= B * (t + o)),
                  (f.y -= B * (i + e)),
                  (x -= A * (l.rA.x * i - l.rA.y * t + m.rA.x * e - m.rA.y * o)),
                  (b.x += D * (t + o)),
                  (b.y += D * (i + e)),
                  (d += C * (l.rB.x * i - l.rB.y * t + m.rB.x * e - m.rB.y * o)),
                  (l.normalImpulse = p),
                  (m.normalImpulse = 0);
                break;
              }
              if ((u = -m.normalMass * h) >= 0 && c.K.col2.x * u + _ >= 0) {
                (t = -r * w),
                  (i = -r * v),
                  (o = (n = u - a) * w),
                  (e = n * v),
                  (f.x -= B * (t + o)),
                  (f.y -= B * (i + e)),
                  (x -= A * (l.rA.x * i - l.rA.y * t + m.rA.x * e - m.rA.y * o)),
                  (b.x += D * (t + o)),
                  (b.y += D * (i + e)),
                  (d += C * (l.rB.x * i - l.rB.y * t + m.rB.x * e - m.rB.y * o)),
                  (l.normalImpulse = 0),
                  (m.normalImpulse = u);
                break;
              }
              if (_ >= 0 && h >= 0) {
                (t = -r * w),
                  (i = -r * v),
                  (o = -a * w),
                  (e = -a * v),
                  (f.x -= B * (t + o)),
                  (f.y -= B * (i + e)),
                  (x -= A * (l.rA.x * i - l.rA.y * t + m.rA.x * e - m.rA.y * o)),
                  (b.x += D * (t + o)),
                  (b.y += D * (i + e)),
                  (d += C * (l.rB.x * i - l.rB.y * t + m.rB.x * e - m.rB.y * o)),
                  (l.normalImpulse = 0),
                  (m.normalImpulse = 0);
                break;
              }
              break;
            }
          }
          (y.m_angularVelocity = x), (p.m_angularVelocity = d);
        }
      }),
      (l.prototype.FinalizeVelocityConstraints = function () {
        for (let t = 0; t < this.m_constraintCount; ++t) {
          let i = this.m_constraints[t];
          for (let t = 0; t < i.pointCount; ++t) {
            let o = i.manifold.m_points[t],
              e = i.points[t];
            (o.m_normalImpulse = e.normalImpulse), (o.m_tangentImpulse = e.tangentImpulse);
          }
        }
      }),
      (l.prototype.SolvePositionConstraints = function (t) {
        let i = 0;
        for (let o = 0; o < this.m_constraintCount; o++) {
          let e = this.m_constraints[o],
            s = e.bodyA,
            n = e.bodyB,
            m = s.m_mass * s.m_invMass,
            r = s.m_mass * s.m_invI,
            a = n.m_mass * n.m_invMass,
            _ = n.m_mass * n.m_invI;
          l.s_psm.Initialize(e);
          let h = l.s_psm.m_normal;
          for (let o = 0; o < e.pointCount; o++) {
            let c = l.s_psm.m_points[o],
              y = l.s_psm.m_separations[o],
              x = c.x - s.m_sweep.c.x,
              d = c.y - s.m_sweep.c.y,
              f = c.x - n.m_sweep.c.x,
              b = c.y - n.m_sweep.c.y;
            i = i < y ? i : y;
            let B = u.Clamp(t * (y + p.b2_linearSlop), -p.b2_maxLinearCorrection, 0),
              A = -e.points[o].equalizedMass * B,
              D = A * h.x,
              C = A * h.y;
            (s.m_sweep.c.x -= m * D),
              (s.m_sweep.c.y -= m * C),
              (s.m_sweep.a -= r * (x * C - d * D)),
              (n.m_sweep.c.x += a * D),
              (n.m_sweep.c.y += a * C),
              (n.m_sweep.a += _ * (f * C - b * D));
          }
          s.SynchronizeTransform(), n.SynchronizeTransform();
        }
        return i > -1.5 * p.b2_linearSlop;
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold = new A()),
          (Box2D.Dynamics.Contacts.b2ContactSolver.s_psm = new c());
      }),
      Box2D.inherit(m, Box2D.Dynamics.Contacts.b2Contact),
      (m.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype),
      (m.Create = function (t) {
        return new m();
      }),
      (m.Destroy = function (t, i) {}),
      (m.prototype.Reset = function (t, i) {
        if (((this.m_flags = o.e_enabledFlag), !t || !i))
          return (this.m_fixtureA = null), void (this.m_fixtureB = null);
        (this.m_isSensor = t.m_isSensor || i.m_isSensor),
          (this.m_isEnabled = !0),
          (this.m_isFiltered = !1),
          (this.m_isTouching = !1);
        let e = t.m_body,
          s = i.m_body;
        (this.m_isContinuous =
          e.m_type !== y.b2_dynamicBody ||
          e.IsBullet() ||
          s.m_type !== y.b2_dynamicBody ||
          s.IsBullet()),
          (this.m_fixtureA = t),
          (this.m_fixtureB = i),
          (this.m_manifold.m_pointCount = 0),
          (this.m_prev = null),
          (this.m_next = null),
          (this.m_nodeA.contact = null),
          (this.m_nodeA.prev = null),
          (this.m_nodeA.next = null),
          (this.m_nodeA.other = null),
          (this.m_nodeB.contact = null),
          (this.m_nodeB.prev = null),
          (this.m_nodeB.next = null),
          (this.m_nodeB.other = null);
      }),
      (m.prototype.Evaluate = function () {
        let t = this.m_fixtureA.m_body,
          i = this.m_fixtureB.m_body;
        this.b2CollideEdgeAndCircle(
          this.m_manifold,
          this.m_fixtureA.m_shape,
          t.m_xf,
          this.m_fixtureB.m_shape,
          i.m_xf
        );
      }),
      (m.prototype.b2CollideEdgeAndCircle = function (t, i, o, e, s) {}),
      Box2D.inherit(r, Box2D.Dynamics.Contacts.b2Contact),
      (r.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype),
      (r.prototype.Evaluate = function () {}),
      Box2D.inherit(a, Box2D.Dynamics.Contacts.b2Contact),
      (a.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype),
      (a.Create = function (t) {
        return new a();
      }),
      (a.Destroy = function (t, i) {}),
      (a.prototype.Reset = function (t, i) {
        if (((this.m_flags = o.e_enabledFlag), !t || !i))
          return (this.m_fixtureA = null), void (this.m_fixtureB = null);
        (this.m_isSensor = t.m_isSensor || i.m_isSensor),
          (this.m_isEnabled = !0),
          (this.m_isFiltered = !1),
          (this.m_isTouching = !1);
        let e = t.m_body,
          s = i.m_body;
        (this.m_isContinuous =
          e.m_type !== y.b2_dynamicBody ||
          e.IsBullet() ||
          s.m_type !== y.b2_dynamicBody ||
          s.IsBullet()),
          (this.m_fixtureA = t),
          (this.m_fixtureB = i),
          (this.m_manifold.m_pointCount = 0),
          (this.m_prev = null),
          (this.m_next = null),
          (this.m_nodeA.contact = null),
          (this.m_nodeA.prev = null),
          (this.m_nodeA.next = null),
          (this.m_nodeA.other = null),
          (this.m_nodeB.contact = null),
          (this.m_nodeB.prev = null),
          (this.m_nodeB.next = null),
          (this.m_nodeB.other = null);
      }),
      (a.prototype.Evaluate = function () {
        let t = this.m_fixtureA.m_body,
          i = this.m_fixtureB.m_body;
        d.CollidePolygonAndCircle(
          this.m_manifold,
          this.m_fixtureA.m_shape,
          t.m_xf,
          this.m_fixtureB.m_shape,
          i.m_xf
        );
      }),
      Box2D.inherit(_, Box2D.Dynamics.Contacts.b2Contact),
      (_.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype),
      (_.Create = function (t) {
        return new _();
      }),
      (_.Destroy = function (t, i) {}),
      (_.prototype.Reset = function (t, i) {
        if (((this.m_flags = o.e_enabledFlag), !t || !i))
          return (this.m_fixtureA = null), void (this.m_fixtureB = null);
        (this.m_isSensor = t.m_isSensor || i.m_isSensor),
          (this.m_isEnabled = !0),
          (this.m_isFiltered = !1),
          (this.m_isTouching = !1);
        let e = t.m_body,
          s = i.m_body;
        (this.m_isContinuous =
          e.m_type !== y.b2_dynamicBody ||
          e.IsBullet() ||
          s.m_type !== y.b2_dynamicBody ||
          s.IsBullet()),
          (this.m_fixtureA = t),
          (this.m_fixtureB = i),
          (this.m_manifold.m_pointCount = 0),
          (this.m_prev = null),
          (this.m_next = null),
          (this.m_nodeA.contact = null),
          (this.m_nodeA.prev = null),
          (this.m_nodeA.next = null),
          (this.m_nodeA.other = null),
          (this.m_nodeB.contact = null),
          (this.m_nodeB.prev = null),
          (this.m_nodeB.next = null),
          (this.m_nodeB.other = null);
      }),
      (_.prototype.Evaluate = function () {
        let t = this.m_fixtureA.m_body,
          i = this.m_fixtureB.m_body;
        this.b2CollidePolyAndEdge(
          this.m_manifold,
          this.m_fixtureA.m_shape,
          t.m_xf,
          this.m_fixtureB.m_shape,
          i.m_xf
        );
      }),
      (_.prototype.b2CollidePolyAndEdge = function (t, i, o, e, s) {}),
      Box2D.inherit(h, Box2D.Dynamics.Contacts.b2Contact),
      (h.prototype.__super = Box2D.Dynamics.Contacts.b2Contact.prototype),
      (h.Create = function (t) {
        return new h();
      }),
      (h.Destroy = function (t, i) {}),
      (h.prototype.Reset = function (t, i) {
        if (((this.m_flags = o.e_enabledFlag), !t || !i))
          return (this.m_fixtureA = null), void (this.m_fixtureB = null);
        (this.m_isSensor = t.m_isSensor || i.m_isSensor),
          (this.m_isEnabled = !0),
          (this.m_isFiltered = !1),
          (this.m_isTouching = !1);
        let e = t.m_body,
          s = i.m_body;
        (this.m_isContinuous =
          e.m_type !== y.b2_dynamicBody ||
          e.IsBullet() ||
          s.m_type !== y.b2_dynamicBody ||
          s.IsBullet()),
          (this.m_fixtureA = t),
          (this.m_fixtureB = i),
          (this.m_manifold.m_pointCount = 0),
          (this.m_prev = null),
          (this.m_next = null),
          (this.m_nodeA.contact = null),
          (this.m_nodeA.prev = null),
          (this.m_nodeA.next = null),
          (this.m_nodeA.other = null),
          (this.m_nodeB.contact = null),
          (this.m_nodeB.prev = null),
          (this.m_nodeB.next = null),
          (this.m_nodeB.other = null);
      }),
      (h.prototype.Evaluate = function () {
        let t = this.m_fixtureA.m_body,
          i = this.m_fixtureB.m_body;
        d.CollidePolygons(
          this.m_manifold,
          this.m_fixtureA.m_shape,
          t.m_xf,
          this.m_fixtureB.m_shape,
          i.m_xf
        );
      }),
      (c.prototype.Initialize = function (t) {
        let i,
          o,
          e = 0,
          s = 0,
          n = 0,
          l = 0,
          m = 0;
        switch (t.type) {
          case f.e_circles:
            {
              (i = t.bodyA.m_xf.R), (o = t.localPoint);
              let e = t.bodyA.m_xf.position.x + (i.col1.x * o.x + i.col2.x * o.y),
                s = t.bodyA.m_xf.position.y + (i.col1.y * o.x + i.col2.y * o.y);
              (i = t.bodyB.m_xf.R), (o = t.points[0].localPoint);
              let n = t.bodyB.m_xf.position.x + (i.col1.x * o.x + i.col2.x * o.y),
                l = t.bodyB.m_xf.position.y + (i.col1.y * o.x + i.col2.y * o.y),
                m = n - e,
                r = l - s,
                a = m * m + r * r;
              if (a > Number.MIN_VALUE * Number.MIN_VALUE) {
                let t = Math.sqrt(a);
                (this.m_normal.x = m / t), (this.m_normal.y = r / t);
              } else (this.m_normal.x = 1), (this.m_normal.y = 0);
              (this.m_points[0].x = 0.5 * (e + n)),
                (this.m_points[0].y = 0.5 * (s + l)),
                (this.m_separations[0] = m * this.m_normal.x + r * this.m_normal.y - t.radius);
            }
            break;
          case f.e_faceA:
            for (
              i = t.bodyA.m_xf.R,
                o = t.localPlaneNormal,
                this.m_normal.x = i.col1.x * o.x + i.col2.x * o.y,
                this.m_normal.y = i.col1.y * o.x + i.col2.y * o.y,
                i = t.bodyA.m_xf.R,
                o = t.localPoint,
                l = t.bodyA.m_xf.position.x + (i.col1.x * o.x + i.col2.x * o.y),
                m = t.bodyA.m_xf.position.y + (i.col1.y * o.x + i.col2.y * o.y),
                i = t.bodyB.m_xf.R,
                e = t.pointCount;
              e > 0;

            )
              (o = t.points[--e].localPoint),
                (s = t.bodyB.m_xf.position.x + (i.col1.x * o.x + i.col2.x * o.y)),
                (n = t.bodyB.m_xf.position.y + (i.col1.y * o.x + i.col2.y * o.y)),
                (this.m_separations[e] =
                  (s - l) * this.m_normal.x + (n - m) * this.m_normal.y - t.radius),
                (this.m_points[e].x = s),
                (this.m_points[e].y = n);
            break;
          case f.e_faceB:
            for (
              i = t.bodyB.m_xf.R,
                o = t.localPlaneNormal,
                this.m_normal.x = i.col1.x * o.x + i.col2.x * o.y,
                this.m_normal.y = i.col1.y * o.x + i.col2.y * o.y,
                i = t.bodyB.m_xf.R,
                o = t.localPoint,
                l = t.bodyB.m_xf.position.x + (i.col1.x * o.x + i.col2.x * o.y),
                m = t.bodyB.m_xf.position.y + (i.col1.y * o.x + i.col2.y * o.y),
                i = t.bodyA.m_xf.R,
                e = t.pointCount;
              e > 0;

            )
              (o = t.points[--e].localPoint),
                (s = t.bodyA.m_xf.position.x + (i.col1.x * o.x + i.col2.x * o.y)),
                (n = t.bodyA.m_xf.position.y + (i.col1.y * o.x + i.col2.y * o.y)),
                (this.m_separations[e] =
                  (s - l) * this.m_normal.x + (n - m) * this.m_normal.y - t.radius),
                this.m_points[e].Set(s, n);
            (this.m_normal.x *= -1), (this.m_normal.y *= -1);
        }
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA = new x()),
          (Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB = new x());
      });
  })(),
  (function () {
    let t = Box2D.Common.Math.b2Mat22,
      i = Box2D.Common.Math.b2Math,
      o = Box2D.Common.Math.b2Vec2,
      e = Box2D.Dynamics.Controllers.b2BuoyancyController,
      s = Box2D.Dynamics.Controllers.b2ConstantAccelController,
      n = Box2D.Dynamics.Controllers.b2ConstantForceController,
      l = Box2D.Dynamics.Controllers.b2Controller,
      m = Box2D.Dynamics.Controllers.b2ControllerEdge,
      r = Box2D.Dynamics.Controllers.b2GravityController,
      a = Box2D.Dynamics.Controllers.b2TensorDampingController;
    Box2D.inherit(e, Box2D.Dynamics.Controllers.b2Controller),
      (e.prototype.__super = Box2D.Dynamics.Controllers.b2Controller.prototype),
      (e.b2BuoyancyController = function () {
        Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this, arguments),
          (this.normal = new o(0, -1)),
          (this.offset = 0),
          (this.density = 0),
          (this.velocity = new o()),
          (this.linearDrag = 2),
          (this.angularDrag = 1),
          (this.useDensity = !1),
          (this.useWorldGravity = !0),
          (this.gravity = null);
      }),
      (e.prototype.Step = function (t) {
        if (this.m_bodyList) {
          this.useWorldGravity && (this.gravity = this.GetWorld().GetGravity().Copy());
          for (let t = this.m_bodyList; t; t = t.nextBody) {
            let i = t.body;
            if (!i.m_isAwake) continue;
            let e = new o(),
              s = new o(),
              n = 0,
              l = 0,
              m = i.m_fixtureList;
            do {
              let t = new o(),
                r = m.m_shape.ComputeSubmergedArea(this.normal, this.offset, i.m_xf, t);
              (n += r), (e.x += r * t.x), (e.y += r * t.y);
              let a = 0;
              (l += r * (a = (this.useDensity, 1))),
                (s.x += r * t.x * a),
                (s.y += r * t.y * a),
                (m = m.m_next);
            } while (m);
            if (((e.x /= n), (e.y /= n), (s.x /= l), (s.y /= l), n < Number.MIN_VALUE)) continue;
            let r = this.gravity.GetNegative();
            r.Multiply(this.density * n), i.ApplyForce(r, s);
            let a = i.GetLinearVelocityFromWorldPoint(e);
            a.Subtract(this.velocity),
              a.Multiply(-this.linearDrag * n),
              i.ApplyForce(a, e),
              i.ApplyTorque(
                (-i.GetInertia() / i.GetMass()) * n * i.m_angularVelocity * this.angularDrag
              );
          }
        }
      }),
      Box2D.inherit(s, Box2D.Dynamics.Controllers.b2Controller),
      (s.prototype.__super = Box2D.Dynamics.Controllers.b2Controller.prototype),
      (s.b2ConstantAccelController = function () {
        Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this, arguments),
          (this.A = new o());
      }),
      (s.prototype.Step = function (t) {
        let i = new o(this.A.x * t.dt, this.A.y * t.dt);
        for (let t = this.m_bodyList; t; t = t.nextBody) {
          let e = t.body;
          if (!e.m_isAwake) continue;
          let s = new o(e.m_linearVelocity.x + i.x, e.m_linearVelocity.y + i.y);
          e.SetLinearVelocity(s);
        }
      }),
      Box2D.inherit(n, Box2D.Dynamics.Controllers.b2Controller),
      (n.prototype.__super = Box2D.Dynamics.Controllers.b2Controller.prototype),
      (n.b2ConstantForceController = function () {
        Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this, arguments),
          (this.F = new o());
      }),
      (n.prototype.Step = function (t) {
        for (let t = this.m_bodyList; t; t = t.nextBody) {
          let i = t.body;
          i.m_isAwake && i.ApplyForce(this.F, i.GetWorldCenter());
        }
      }),
      (l.b2Controller = function () {}),
      (l.prototype.Step = function (t) {}),
      (l.prototype.AddBody = function (t) {
        let i = new m();
        (i.controller = this),
          (i.body = t),
          (i.nextBody = this.m_bodyList),
          (i.prevBody = null),
          (this.m_bodyList = i),
          i.nextBody && (i.nextBody.prevBody = i),
          this.m_bodyCount++,
          (i.nextController = t.m_controllerList),
          (i.prevController = null),
          (t.m_controllerList = i),
          i.nextController && (i.nextController.prevController = i),
          t.m_controllerCount++;
      }),
      (l.prototype.RemoveBody = function (t) {
        let i = t.m_controllerList;
        for (; i && i.controller !== this; ) i = i.nextController;
        i.prevBody && (i.prevBody.nextBody = i.nextBody),
          i.nextBody && (i.nextBody.prevBody = i.prevBody),
          i.nextController && (i.nextController.prevController = i.prevController),
          i.prevController && (i.prevController.nextController = i.nextController),
          this.m_bodyList === i && (this.m_bodyList = i.nextBody),
          t.m_controllerList === i && (t.m_controllerList = i.nextController),
          t.m_controllerCount--,
          this.m_bodyCount--;
      }),
      (l.prototype.Clear = function () {
        for (; this.m_bodyList; ) this.RemoveBody(this.m_bodyList.body);
      }),
      (l.prototype.GetNext = function () {
        return this.m_next;
      }),
      (l.prototype.GetWorld = function () {
        return this.m_world;
      }),
      (l.prototype.GetBodyList = function () {
        return this.m_bodyList;
      }),
      (m.b2ControllerEdge = function () {}),
      Box2D.inherit(r, Box2D.Dynamics.Controllers.b2Controller),
      (r.prototype.__super = Box2D.Dynamics.Controllers.b2Controller.prototype),
      (r.b2GravityController = function () {
        Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this, arguments),
          (this.G = 1),
          (this.invSqr = !0);
      }),
      (r.prototype.Step = function (t) {
        let i = null,
          e = null,
          s = null,
          n = 0,
          l = null,
          m = null,
          r = null,
          a = 0,
          _ = 0,
          h = 0,
          c = null;
        if (this.invSqr)
          for (i = this.m_bodyList; i; i = i.nextBody)
            for (
              s = (e = i.body).GetWorldCenter(), n = e.GetMass(), l = this.m_bodyList;
              l !== i;
              l = l.nextBody
            )
              (h = (a = (r = (m = l.body).GetWorldCenter()).x - s.x) * a + (_ = r.y - s.y) * _) <
                Number.MIN_VALUE ||
                ((c = new o(a, _)).Multiply((this.G / h / Math.sqrt(h)) * n * m.GetMass()),
                e.m_isAwake && e.ApplyForce(c, s),
                (c.x *= -1),
                (c.y *= -1),
                m.m_isAwake && m.ApplyForce(c, r));
        else
          for (i = this.m_bodyList; i; i = i.nextBody)
            for (
              s = (e = i.body).GetWorldCenter(), n = e.GetMass(), l = this.m_bodyList;
              l !== i;
              l = l.nextBody
            )
              (h = (a = (r = (m = l.body).GetWorldCenter()).x - s.x) * a + (_ = r.y - s.y) * _) <
                Number.MIN_VALUE ||
                ((c = new o(a, _)).Multiply((this.G / h) * n * m.GetMass()),
                e.m_isAwake && e.ApplyForce(c, s),
                (c.x *= -1),
                (c.y *= -1),
                m.m_isAwake && m.ApplyForce(c, r));
      }),
      Box2D.inherit(a, Box2D.Dynamics.Controllers.b2Controller),
      (a.prototype.__super = Box2D.Dynamics.Controllers.b2Controller.prototype),
      (a.b2TensorDampingController = function () {
        Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this, arguments),
          (this.T = new t()),
          (this.maxTimestep = 0);
      }),
      (a.prototype.SetAxisAligned = function (t, i) {
        void 0 === t && (t = 0),
          void 0 === i && (i = 0),
          (this.T.col1.x = -t),
          (this.T.col1.y = 0),
          (this.T.col2.x = 0),
          (this.T.col2.y = -i),
          (this.maxTimestep = t > 0 || i > 0 ? 1 / Math.max(t, i) : 0);
      }),
      (a.prototype.Step = function (t) {
        let e = t.dt;
        if (!(e <= Number.MIN_VALUE)) {
          e > this.maxTimestep && this.maxTimestep > 0 && (e = this.maxTimestep);
          for (let t = this.m_bodyList; t; t = t.nextBody) {
            let s = t.body;
            if (!s.m_isAwake) continue;
            let n = i.MulMV(this.T, s.GetLocalVector(s.m_linearVelocity)),
              l = s.GetWorldVector(n),
              m = new o(s.m_linearVelocity.x + l.x * e, s.m_linearVelocity.y + l.y * e);
            s.SetLinearVelocity(m);
          }
        }
      });
  })(),
  (function () {
    let t = Box2D.Common.b2Settings,
      i = Box2D.Common.Math.b2Mat22,
      o = Box2D.Common.Math.b2Mat33,
      e = Box2D.Common.Math.b2Math,
      s = Box2D.Common.Math.b2Vec2,
      n = Box2D.Common.Math.b2Vec3,
      l = Box2D.Dynamics.Joints.b2DistanceJoint,
      m = Box2D.Dynamics.Joints.b2DistanceJointDef,
      r = Box2D.Dynamics.Joints.b2FrictionJoint,
      a = Box2D.Dynamics.Joints.b2FrictionJointDef,
      _ = Box2D.Dynamics.Joints.b2GearJoint,
      h = Box2D.Dynamics.Joints.b2GearJointDef,
      c = Box2D.Dynamics.Joints.b2Jacobian,
      y = Box2D.Dynamics.Joints.b2Joint,
      p = Box2D.Dynamics.Joints.b2JointDef,
      u = Box2D.Dynamics.Joints.b2JointEdge,
      x = Box2D.Dynamics.Joints.b2LineJoint,
      d = Box2D.Dynamics.Joints.b2LineJointDef,
      f = Box2D.Dynamics.Joints.b2MouseJoint,
      b = Box2D.Dynamics.Joints.b2MouseJointDef,
      B = Box2D.Dynamics.Joints.b2PrismaticJoint,
      A = Box2D.Dynamics.Joints.b2PrismaticJointDef,
      D = Box2D.Dynamics.Joints.b2PulleyJoint,
      C = Box2D.Dynamics.Joints.b2PulleyJointDef,
      w = Box2D.Dynamics.Joints.b2RevoluteJoint,
      v = Box2D.Dynamics.Joints.b2RevoluteJointDef,
      g = Box2D.Dynamics.Joints.b2WeldJoint,
      S = Box2D.Dynamics.Joints.b2WeldJointDef;
    Box2D.inherit(l, Box2D.Dynamics.Joints.b2Joint),
      (l.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype),
      (l.b2DistanceJoint = function () {
        Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments),
          (this.m_localAnchor1 = new s()),
          (this.m_localAnchor2 = new s()),
          (this.m_u = new s());
      }),
      (l.prototype.GetAnchorA = function () {
        return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
      }),
      (l.prototype.GetAnchorB = function () {
        return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
      }),
      (l.prototype.GetReactionForce = function (t) {
        return new s(t * this.m_impulse * this.m_u.x, t * this.m_impulse * this.m_u.y);
      }),
      (l.prototype.GetReactionTorque = function (t) {
        return 0;
      }),
      (l.prototype.GetLength = function () {
        return this.m_length;
      }),
      (l.prototype.SetLength = function (t) {
        void 0 === t && (t = 0), (this.m_length = t);
      }),
      (l.prototype.GetFrequency = function () {
        return this.m_frequencyHz;
      }),
      (l.prototype.SetFrequency = function (t) {
        void 0 === t && (t = 0), (this.m_frequencyHz = t);
      }),
      (l.prototype.GetDampingRatio = function () {
        return this.m_dampingRatio;
      }),
      (l.prototype.SetDampingRatio = function (t) {
        this.m_dampingRatio = t;
      }),
      (l.prototype.b2DistanceJoint = function (t) {
        this.__super.b2Joint.call(this, t),
          this.m_localAnchor1.SetV(t.localAnchorA),
          this.m_localAnchor2.SetV(t.localAnchorB),
          (this.m_length = t.length),
          (this.m_frequencyHz = t.frequencyHz),
          (this.m_dampingRatio = t.dampingRatio),
          (this.m_impulse = 0),
          (this.m_gamma = 0),
          (this.m_bias = 0);
      }),
      (l.prototype.InitVelocityConstraints = function (i) {
        let o = this.m_bodyA,
          e = this.m_bodyB,
          s = o.m_xf.R,
          n = this.m_localAnchor1.x - o.m_sweep.localCenter.x,
          l = this.m_localAnchor1.y - o.m_sweep.localCenter.y,
          m = s.col1.x * n + s.col2.x * l;
        (l = s.col1.y * n + s.col2.y * l), (n = m), (s = e.m_xf.R);
        let r = this.m_localAnchor2.x - e.m_sweep.localCenter.x,
          a = this.m_localAnchor2.y - e.m_sweep.localCenter.y;
        (m = s.col1.x * r + s.col2.x * a),
          (a = s.col1.y * r + s.col2.y * a),
          (r = m),
          (this.m_u.x = e.m_sweep.c.x + r - o.m_sweep.c.x - n),
          (this.m_u.y = e.m_sweep.c.y + a - o.m_sweep.c.y - l);
        let _ = Math.sqrt(this.m_u.x * this.m_u.x + this.m_u.y * this.m_u.y);
        _ > t.b2_linearSlop ? this.m_u.Multiply(1 / _) : this.m_u.SetZero();
        let h = n * this.m_u.y - l * this.m_u.x,
          c = r * this.m_u.y - a * this.m_u.x,
          y = o.m_invMass + o.m_invI * h * h + e.m_invMass + e.m_invI * c * c;
        if (((this.m_mass = 0 !== y ? 1 / y : 0), this.m_frequencyHz > 0)) {
          let t = _ - this.m_length,
            o = 2 * Math.PI * this.m_frequencyHz,
            e = 2 * this.m_mass * this.m_dampingRatio * o,
            s = this.m_mass * o * o;
          (this.m_gamma = i.dt * (e + i.dt * s)),
            (this.m_gamma = 0 !== this.m_gamma ? 1 / this.m_gamma : 0),
            (this.m_bias = t * i.dt * s * this.m_gamma),
            (this.m_mass = y + this.m_gamma),
            (this.m_mass = 0 !== this.m_mass ? 1 / this.m_mass : 0);
        }
        if (i.warmStarting) {
          this.m_impulse *= i.dtRatio;
          let t = this.m_impulse * this.m_u.x,
            s = this.m_impulse * this.m_u.y;
          (o.m_linearVelocity.x -= o.m_invMass * t),
            (o.m_linearVelocity.y -= o.m_invMass * s),
            (o.m_angularVelocity -= o.m_invI * (n * s - l * t)),
            (e.m_linearVelocity.x += e.m_invMass * t),
            (e.m_linearVelocity.y += e.m_invMass * s),
            (e.m_angularVelocity += e.m_invI * (r * s - a * t));
        } else this.m_impulse = 0;
      }),
      (l.prototype.SolveVelocityConstraints = function () {
        let t = this.m_bodyA,
          i = this.m_bodyB,
          o = t.m_xf.R,
          e = this.m_localAnchor1.x - t.m_sweep.localCenter.x,
          s = this.m_localAnchor1.y - t.m_sweep.localCenter.y,
          n = o.col1.x * e + o.col2.x * s;
        (s = o.col1.y * e + o.col2.y * s), (e = n), (o = i.m_xf.R);
        let l = this.m_localAnchor2.x - i.m_sweep.localCenter.x,
          m = this.m_localAnchor2.y - i.m_sweep.localCenter.y;
        (n = o.col1.x * l + o.col2.x * m), (m = o.col1.y * l + o.col2.y * m), (l = n);
        let r = t.m_linearVelocity.x + -t.m_angularVelocity * s,
          a = t.m_linearVelocity.y + t.m_angularVelocity * e,
          _ = i.m_linearVelocity.x + -i.m_angularVelocity * m,
          h = i.m_linearVelocity.y + i.m_angularVelocity * l,
          c = this.m_u.x * (_ - r) + this.m_u.y * (h - a),
          y = -this.m_mass * (c + this.m_bias + this.m_gamma * this.m_impulse);
        this.m_impulse += y;
        let p = y * this.m_u.x,
          u = y * this.m_u.y;
        (t.m_linearVelocity.x -= t.m_invMass * p),
          (t.m_linearVelocity.y -= t.m_invMass * u),
          (t.m_angularVelocity -= t.m_invI * (e * u - s * p)),
          (i.m_linearVelocity.x += i.m_invMass * p),
          (i.m_linearVelocity.y += i.m_invMass * u),
          (i.m_angularVelocity += i.m_invI * (l * u - m * p));
      }),
      (l.prototype.SolvePositionConstraints = function () {
        if (this.m_frequencyHz > 0) return !0;
        let i = this.m_bodyA,
          o = this.m_bodyB,
          s = i.m_xf.R,
          n = this.m_localAnchor1.x - i.m_sweep.localCenter.x,
          l = this.m_localAnchor1.y - i.m_sweep.localCenter.y,
          m = s.col1.x * n + s.col2.x * l;
        (l = s.col1.y * n + s.col2.y * l), (n = m), (s = o.m_xf.R);
        let r = this.m_localAnchor2.x - o.m_sweep.localCenter.x,
          a = this.m_localAnchor2.y - o.m_sweep.localCenter.y;
        (m = s.col1.x * r + s.col2.x * a), (a = s.col1.y * r + s.col2.y * a), (r = m);
        let _ = o.m_sweep.c.x + r - i.m_sweep.c.x - n,
          h = o.m_sweep.c.y + a - i.m_sweep.c.y - l,
          c = Math.sqrt(_ * _ + h * h);
        (_ /= c), (h /= c);
        let y = c - this.m_length;
        y = e.Clamp(y, -t.b2_maxLinearCorrection, t.b2_maxLinearCorrection);
        let p = -this.m_mass * y;
        this.m_u.Set(_, h);
        let u = p * this.m_u.x,
          x = p * this.m_u.y;
        return (
          (i.m_sweep.c.x -= i.m_invMass * u),
          (i.m_sweep.c.y -= i.m_invMass * x),
          (i.m_sweep.a -= i.m_invI * (n * x - l * u)),
          (o.m_sweep.c.x += o.m_invMass * u),
          (o.m_sweep.c.y += o.m_invMass * x),
          (o.m_sweep.a += o.m_invI * (r * x - a * u)),
          i.SynchronizeTransform(),
          o.SynchronizeTransform(),
          Math.abs(y) < t.b2_linearSlop
        );
      }),
      Box2D.inherit(m, Box2D.Dynamics.Joints.b2JointDef),
      (m.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype),
      (m.b2DistanceJointDef = function () {
        Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments),
          (this.localAnchorA = new s()),
          (this.localAnchorB = new s());
      }),
      (m.prototype.b2DistanceJointDef = function () {
        this.__super.b2JointDef.call(this),
          (this.type = y.e_distanceJoint),
          (this.length = 1),
          (this.frequencyHz = 0),
          (this.dampingRatio = 0);
      }),
      (m.prototype.Initialize = function (t, i, o, e) {
        (this.bodyA = t),
          (this.bodyB = i),
          this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),
          this.localAnchorB.SetV(this.bodyB.GetLocalPoint(e));
        let s = e.x - o.x,
          n = e.y - o.y;
        (this.length = Math.sqrt(s * s + n * n)), (this.frequencyHz = 0), (this.dampingRatio = 0);
      }),
      Box2D.inherit(r, Box2D.Dynamics.Joints.b2Joint),
      (r.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype),
      (r.b2FrictionJoint = function () {
        Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments),
          (this.m_localAnchorA = new s()),
          (this.m_localAnchorB = new s()),
          (this.m_linearMass = new i()),
          (this.m_linearImpulse = new s());
      }),
      (r.prototype.GetAnchorA = function () {
        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA);
      }),
      (r.prototype.GetAnchorB = function () {
        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB);
      }),
      (r.prototype.GetReactionForce = function (t) {
        return new s(t * this.m_linearImpulse.x, t * this.m_linearImpulse.y);
      }),
      (r.prototype.GetReactionTorque = function (t) {
        return t * this.m_angularImpulse;
      }),
      (r.prototype.SetMaxForce = function (t) {
        this.m_maxForce = t;
      }),
      (r.prototype.GetMaxForce = function () {
        return this.m_maxForce;
      }),
      (r.prototype.SetMaxTorque = function (t) {
        this.m_maxTorque = t;
      }),
      (r.prototype.GetMaxTorque = function () {
        return this.m_maxTorque;
      }),
      (r.prototype.b2FrictionJoint = function (t) {
        this.__super.b2Joint.call(this, t),
          this.m_localAnchorA.SetV(t.localAnchorA),
          this.m_localAnchorB.SetV(t.localAnchorB),
          this.m_linearMass.SetZero(),
          (this.m_angularMass = 0),
          this.m_linearImpulse.SetZero(),
          (this.m_angularImpulse = 0),
          (this.m_maxForce = t.maxForce),
          (this.m_maxTorque = t.maxTorque);
      }),
      (r.prototype.InitVelocityConstraints = function (t) {
        let o = this.m_bodyA,
          e = this.m_bodyB,
          s = o.m_xf.R,
          n = this.m_localAnchorA.x - o.m_sweep.localCenter.x,
          l = this.m_localAnchorA.y - o.m_sweep.localCenter.y,
          m = s.col1.x * n + s.col2.x * l;
        (l = s.col1.y * n + s.col2.y * l), (n = m), (s = e.m_xf.R);
        let r = this.m_localAnchorB.x - e.m_sweep.localCenter.x,
          a = this.m_localAnchorB.y - e.m_sweep.localCenter.y;
        (m = s.col1.x * r + s.col2.x * a), (a = s.col1.y * r + s.col2.y * a), (r = m);
        let _ = o.m_invMass,
          h = e.m_invMass,
          c = o.m_invI,
          y = e.m_invI,
          p = new i();
        if (
          ((p.col1.x = _ + h),
          (p.col2.x = 0),
          (p.col1.y = 0),
          (p.col2.y = _ + h),
          (p.col1.x += c * l * l),
          (p.col2.x += -c * n * l),
          (p.col1.y += -c * n * l),
          (p.col2.y += c * n * n),
          (p.col1.x += y * a * a),
          (p.col2.x += -y * r * a),
          (p.col1.y += -y * r * a),
          (p.col2.y += y * r * r),
          p.GetInverse(this.m_linearMass),
          (this.m_angularMass = c + y),
          this.m_angularMass > 0 && (this.m_angularMass = 1 / this.m_angularMass),
          t.warmStarting)
        ) {
          (this.m_linearImpulse.x *= t.dtRatio),
            (this.m_linearImpulse.y *= t.dtRatio),
            (this.m_angularImpulse *= t.dtRatio);
          let i = this.m_linearImpulse;
          (o.m_linearVelocity.x -= _ * i.x),
            (o.m_linearVelocity.y -= _ * i.y),
            (o.m_angularVelocity -= c * (n * i.y - l * i.x + this.m_angularImpulse)),
            (e.m_linearVelocity.x += h * i.x),
            (e.m_linearVelocity.y += h * i.y),
            (e.m_angularVelocity += y * (r * i.y - a * i.x + this.m_angularImpulse));
        } else this.m_linearImpulse.SetZero(), (this.m_angularImpulse = 0);
      }),
      (r.prototype.SolveVelocityConstraints = function (t) {
        let i = this.m_bodyA,
          o = this.m_bodyB,
          n = i.m_linearVelocity,
          l = i.m_angularVelocity,
          m = o.m_linearVelocity,
          r = o.m_angularVelocity,
          a = i.m_invMass,
          _ = o.m_invMass,
          h = i.m_invI,
          c = o.m_invI,
          y = i.m_xf.R,
          p = this.m_localAnchorA.x - i.m_sweep.localCenter.x,
          u = this.m_localAnchorA.y - i.m_sweep.localCenter.y,
          x = y.col1.x * p + y.col2.x * u;
        (u = y.col1.y * p + y.col2.y * u), (p = x), (y = o.m_xf.R);
        let d = this.m_localAnchorB.x - o.m_sweep.localCenter.x,
          f = this.m_localAnchorB.y - o.m_sweep.localCenter.y;
        (x = y.col1.x * d + y.col2.x * f), (f = y.col1.y * d + y.col2.y * f), (d = x);
        let b = 0;
        {
          let i = -this.m_angularMass * (r - l),
            o = this.m_angularImpulse;
          (b = t.dt * this.m_maxTorque),
            (this.m_angularImpulse = e.Clamp(this.m_angularImpulse + i, -b, b)),
            (l -= h * (i = this.m_angularImpulse - o)),
            (r += c * i);
        }
        {
          let i = m.x - r * f - n.x + l * u,
            o = m.y + r * d - n.y - l * p,
            y = new s(-i, -o),
            x = e.MulMV(this.m_linearMass, y),
            B = this.m_linearImpulse.Copy();
          this.m_linearImpulse.Add(x),
            (b = t.dt * this.m_maxForce),
            this.m_linearImpulse.LengthSquared() > b * b &&
              (this.m_linearImpulse.Normalize(),
              (this.m_linearImpulse.x *= b),
              (this.m_linearImpulse.y *= b)),
            (x = new s(this.m_linearImpulse.x - B.x, this.m_linearImpulse.y - B.y)),
            (n.x -= a * x.x),
            (n.y -= a * x.y),
            (l -= h * (p * x.y - u * x.x)),
            (m.x += _ * x.x),
            (m.y += _ * x.y),
            (r += c * (d * x.y - f * x.x));
        }
        (i.m_angularVelocity = l), (o.m_angularVelocity = r);
      }),
      (r.prototype.SolvePositionConstraints = function () {
        return !0;
      }),
      Box2D.inherit(a, Box2D.Dynamics.Joints.b2JointDef),
      (a.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype),
      (a.b2FrictionJointDef = function () {
        Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments),
          (this.localAnchorA = new s()),
          (this.localAnchorB = new s());
      }),
      (a.prototype.b2FrictionJointDef = function () {
        this.__super.b2JointDef.call(this),
          (this.type = y.e_frictionJoint),
          (this.maxForce = 0),
          (this.maxTorque = 0);
      }),
      (a.prototype.Initialize = function (t, i, o) {
        (this.bodyA = t),
          (this.bodyB = i),
          this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),
          this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o));
      }),
      Box2D.inherit(_, Box2D.Dynamics.Joints.b2Joint),
      (_.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype),
      (_.b2GearJoint = function () {
        Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments),
          (this.m_groundAnchor1 = new s()),
          (this.m_groundAnchor2 = new s()),
          (this.m_localAnchor1 = new s()),
          (this.m_localAnchor2 = new s()),
          (this.m_J = new c());
      }),
      (_.prototype.GetAnchorA = function () {
        return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
      }),
      (_.prototype.GetAnchorB = function () {
        return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
      }),
      (_.prototype.GetReactionForce = function (t) {
        return new s(
          t * this.m_impulse * this.m_J.linearB.x,
          t * this.m_impulse * this.m_J.linearB.y
        );
      }),
      (_.prototype.GetReactionTorque = function (t) {
        void 0 === t && (t = 0);
        let i = this.m_bodyB.m_xf.R,
          o = this.m_localAnchor1.x - this.m_bodyB.m_sweep.localCenter.x,
          e = this.m_localAnchor1.y - this.m_bodyB.m_sweep.localCenter.y,
          s = i.col1.x * o + i.col2.x * e;
        (e = i.col1.y * o + i.col2.y * e), (o = s);
        let n = this.m_impulse * this.m_J.linearB.x,
          l = this.m_impulse * this.m_J.linearB.y;
        return t * (this.m_impulse * this.m_J.angularB - o * l + e * n);
      }),
      (_.prototype.GetRatio = function () {
        return this.m_ratio;
      }),
      (_.prototype.SetRatio = function (t) {
        void 0 === t && (t = 0), (this.m_ratio = t);
      }),
      (_.prototype.b2GearJoint = function (t) {
        this.__super.b2Joint.call(this, t);
        let i = t.joint1.m_type,
          o = t.joint2.m_type;
        (this.m_revolute1 = null),
          (this.m_prismatic1 = null),
          (this.m_revolute2 = null),
          (this.m_prismatic2 = null);
        let e = 0,
          s = 0;
        (this.m_ground1 = t.joint1.GetBodyA()),
          (this.m_bodyA = t.joint1.GetBodyB()),
          i === y.e_revoluteJoint
            ? ((this.m_revolute1 = t.joint1 instanceof w ? t.joint1 : null),
              this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),
              this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),
              (e = this.m_revolute1.GetJointAngle()))
            : ((this.m_prismatic1 = t.joint1 instanceof B ? t.joint1 : null),
              this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),
              this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),
              (e = this.m_prismatic1.GetJointTranslation())),
          (this.m_ground2 = t.joint2.GetBodyA()),
          (this.m_bodyB = t.joint2.GetBodyB()),
          o === y.e_revoluteJoint
            ? ((this.m_revolute2 = t.joint2 instanceof w ? t.joint2 : null),
              this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),
              this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),
              (s = this.m_revolute2.GetJointAngle()))
            : ((this.m_prismatic2 = t.joint2 instanceof B ? t.joint2 : null),
              this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),
              this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),
              (s = this.m_prismatic2.GetJointTranslation())),
          (this.m_ratio = t.ratio),
          (this.m_constant = e + this.m_ratio * s),
          (this.m_impulse = 0);
      }),
      (_.prototype.InitVelocityConstraints = function (t) {
        let i,
          o,
          e = this.m_ground1,
          s = this.m_ground2,
          n = this.m_bodyA,
          l = this.m_bodyB,
          m = 0,
          r = 0,
          a = 0,
          _ = 0,
          h = 0,
          c = 0,
          y = 0;
        this.m_J.SetZero(),
          this.m_revolute1
            ? ((this.m_J.angularA = -1), (y += n.m_invI))
            : ((i = e.m_xf.R),
              (o = this.m_prismatic1.m_localXAxis1),
              (m = i.col1.x * o.x + i.col2.x * o.y),
              (r = i.col1.y * o.x + i.col2.y * o.y),
              (i = n.m_xf.R),
              (a = this.m_localAnchor1.x - n.m_sweep.localCenter.x),
              (_ = this.m_localAnchor1.y - n.m_sweep.localCenter.y),
              (c = i.col1.x * a + i.col2.x * _),
              (_ = i.col1.y * a + i.col2.y * _),
              (h = (a = c) * r - _ * m),
              this.m_J.linearA.Set(-m, -r),
              (this.m_J.angularA = -h),
              (y += n.m_invMass + n.m_invI * h * h)),
          this.m_revolute2
            ? ((this.m_J.angularB = -this.m_ratio), (y += this.m_ratio * this.m_ratio * l.m_invI))
            : ((i = s.m_xf.R),
              (o = this.m_prismatic2.m_localXAxis1),
              (m = i.col1.x * o.x + i.col2.x * o.y),
              (r = i.col1.y * o.x + i.col2.y * o.y),
              (i = l.m_xf.R),
              (a = this.m_localAnchor2.x - l.m_sweep.localCenter.x),
              (_ = this.m_localAnchor2.y - l.m_sweep.localCenter.y),
              (c = i.col1.x * a + i.col2.x * _),
              (_ = i.col1.y * a + i.col2.y * _),
              (h = (a = c) * r - _ * m),
              this.m_J.linearB.Set(-this.m_ratio * m, -this.m_ratio * r),
              (this.m_J.angularB = -this.m_ratio * h),
              (y += this.m_ratio * this.m_ratio * (l.m_invMass + l.m_invI * h * h))),
          (this.m_mass = y > 0 ? 1 / y : 0),
          t.warmStarting
            ? ((n.m_linearVelocity.x += n.m_invMass * this.m_impulse * this.m_J.linearA.x),
              (n.m_linearVelocity.y += n.m_invMass * this.m_impulse * this.m_J.linearA.y),
              (n.m_angularVelocity += n.m_invI * this.m_impulse * this.m_J.angularA),
              (l.m_linearVelocity.x += l.m_invMass * this.m_impulse * this.m_J.linearB.x),
              (l.m_linearVelocity.y += l.m_invMass * this.m_impulse * this.m_J.linearB.y),
              (l.m_angularVelocity += l.m_invI * this.m_impulse * this.m_J.angularB))
            : (this.m_impulse = 0);
      }),
      (_.prototype.SolveVelocityConstraints = function () {
        let t = this.m_bodyA,
          i = this.m_bodyB,
          o = this.m_J.Compute(
            t.m_linearVelocity,
            t.m_angularVelocity,
            i.m_linearVelocity,
            i.m_angularVelocity
          ),
          e = -this.m_mass * o;
        (this.m_impulse += e),
          (t.m_linearVelocity.x += t.m_invMass * e * this.m_J.linearA.x),
          (t.m_linearVelocity.y += t.m_invMass * e * this.m_J.linearA.y),
          (t.m_angularVelocity += t.m_invI * e * this.m_J.angularA),
          (i.m_linearVelocity.x += i.m_invMass * e * this.m_J.linearB.x),
          (i.m_linearVelocity.y += i.m_invMass * e * this.m_J.linearB.y),
          (i.m_angularVelocity += i.m_invI * e * this.m_J.angularB);
      }),
      (_.prototype.SolvePositionConstraints = function () {
        let i = this.m_bodyA,
          o = this.m_bodyB,
          e = 0,
          s = 0;
        (e = this.m_revolute1
          ? this.m_revolute1.GetJointAngle()
          : this.m_prismatic1.GetJointTranslation()),
          (s = this.m_revolute2
            ? this.m_revolute2.GetJointAngle()
            : this.m_prismatic2.GetJointTranslation());
        let n = -this.m_mass * (this.m_constant - (e + this.m_ratio * s));
        return (
          (i.m_sweep.c.x += i.m_invMass * n * this.m_J.linearA.x),
          (i.m_sweep.c.y += i.m_invMass * n * this.m_J.linearA.y),
          (i.m_sweep.a += i.m_invI * n * this.m_J.angularA),
          (o.m_sweep.c.x += o.m_invMass * n * this.m_J.linearB.x),
          (o.m_sweep.c.y += o.m_invMass * n * this.m_J.linearB.y),
          (o.m_sweep.a += o.m_invI * n * this.m_J.angularB),
          i.SynchronizeTransform(),
          o.SynchronizeTransform(),
          0 < t.b2_linearSlop
        );
      }),
      Box2D.inherit(h, Box2D.Dynamics.Joints.b2JointDef),
      (h.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype),
      (h.b2GearJointDef = function () {
        Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments);
      }),
      (h.prototype.b2GearJointDef = function () {
        this.__super.b2JointDef.call(this),
          (this.type = y.e_gearJoint),
          (this.joint1 = null),
          (this.joint2 = null),
          (this.ratio = 1);
      }),
      (c.b2Jacobian = function () {
        (this.linearA = new s()), (this.linearB = new s());
      }),
      (c.prototype.SetZero = function () {
        this.linearA.SetZero(), (this.angularA = 0), this.linearB.SetZero(), (this.angularB = 0);
      }),
      (c.prototype.Set = function (t, i, o, e) {
        this.linearA.SetV(t),
          (this.angularA = i || 0),
          this.linearB.SetV(o),
          (this.angularB = e || 0);
      }),
      (c.prototype.Compute = function (t, i, o, e) {
        return (
          void 0 === i && (i = 0),
          void 0 === e && (e = 0),
          this.linearA.x * t.x +
            this.linearA.y * t.y +
            this.angularA * i +
            (this.linearB.x * o.x + this.linearB.y * o.y) +
            this.angularB * e
        );
      }),
      (y.b2Joint = function () {
        (this.m_edgeA = new u()),
          (this.m_edgeB = new u()),
          (this.m_localCenterA = new s()),
          (this.m_localCenterB = new s());
      }),
      (y.prototype.GetType = function () {
        return this.m_type;
      }),
      (y.prototype.GetAnchorA = function () {
        return null;
      }),
      (y.prototype.GetAnchorB = function () {
        return null;
      }),
      (y.prototype.GetReactionForce = function (t) {
        return null;
      }),
      (y.prototype.GetReactionTorque = function (t) {
        return void 0 === t && (t = 0), 0;
      }),
      (y.prototype.GetBodyA = function () {
        return this.m_bodyA;
      }),
      (y.prototype.GetBodyB = function () {
        return this.m_bodyB;
      }),
      (y.prototype.GetNext = function () {
        return this.m_next;
      }),
      (y.prototype.GetUserData = function () {
        return this.m_userData;
      }),
      (y.prototype.SetUserData = function (t) {
        this.m_userData = t;
      }),
      (y.prototype.IsActive = function () {
        return this.m_bodyA.IsActive() && this.m_bodyB.IsActive();
      }),
      (y.Create = function (t) {
        if (t.type === y.e_revoluteJoint) return new w(t);
        let i;
        switch (t.type) {
          case y.e_distanceJoint:
            i = new l(t);
            break;
          case y.e_mouseJoint:
            i = new f(t);
            break;
          case y.e_prismaticJoint:
            i = new B(t);
            break;
          case y.e_pulleyJoint:
            i = new D(t);
            break;
          case y.e_gearJoint:
            i = new _(t);
            break;
          case y.e_lineJoint:
            i = new x(t);
            break;
          case y.e_weldJoint:
            i = new g(t);
            break;
          case y.e_frictionJoint:
            i = new r(t);
        }
        return i;
      }),
      (y.Destroy = function () {}),
      (y.prototype.b2Joint = function (t) {
        (this.m_type = t.type),
          (this.m_prev = null),
          (this.m_next = null),
          (this.m_bodyA = t.bodyA),
          (this.m_bodyB = t.bodyB),
          (this.m_collideConnected = t.collideConnected),
          (this.m_islandFlag = !1),
          (this.m_userData = t.userData);
      }),
      (y.prototype.InitVelocityConstraints = function (t) {}),
      (y.prototype.SolveVelocityConstraints = function (t) {}),
      (y.prototype.FinalizeVelocityConstraints = function () {}),
      (y.prototype.SolvePositionConstraints = function (t) {
        return !1;
      }),
      Box2D.postDefs.push(function () {
        (Box2D.Dynamics.Joints.b2Joint.e_unknownJoint = 0),
          (Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint = 1),
          (Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint = 2),
          (Box2D.Dynamics.Joints.b2Joint.e_distanceJoint = 3),
          (Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint = 4),
          (Box2D.Dynamics.Joints.b2Joint.e_mouseJoint = 5),
          (Box2D.Dynamics.Joints.b2Joint.e_gearJoint = 6),
          (Box2D.Dynamics.Joints.b2Joint.e_lineJoint = 7),
          (Box2D.Dynamics.Joints.b2Joint.e_weldJoint = 8),
          (Box2D.Dynamics.Joints.b2Joint.e_frictionJoint = 9),
          (Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit = 0),
          (Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit = 1),
          (Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit = 2),
          (Box2D.Dynamics.Joints.b2Joint.e_equalLimits = 3);
      }),
      (p.b2JointDef = function () {}),
      (p.prototype.b2JointDef = function () {
        (this.type = y.e_unknownJoint),
          (this.userData = null),
          (this.bodyA = null),
          (this.bodyB = null),
          (this.collideConnected = !1);
      }),
      Box2D.inherit(x, Box2D.Dynamics.Joints.b2Joint),
      (x.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype),
      (x.b2LineJoint = function () {
        Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments),
          (this.m_localAnchor1 = new s()),
          (this.m_localAnchor2 = new s()),
          (this.m_localXAxis1 = new s()),
          (this.m_localYAxis1 = new s()),
          (this.m_axis = new s()),
          (this.m_perp = new s()),
          (this.m_K = new i()),
          (this.m_impulse = new s());
      }),
      (x.prototype.GetAnchorA = function () {
        return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
      }),
      (x.prototype.GetAnchorB = function () {
        return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
      }),
      (x.prototype.GetReactionForce = function (t) {
        return new s(
          t *
            (this.m_impulse.x * this.m_perp.x +
              (this.m_motorImpulse + this.m_impulse.y) * this.m_axis.x),
          t *
            (this.m_impulse.x * this.m_perp.y +
              (this.m_motorImpulse + this.m_impulse.y) * this.m_axis.y)
        );
      }),
      (x.prototype.GetReactionTorque = function (t) {
        return t * this.m_impulse.y;
      }),
      (x.prototype.GetJointTranslation = function () {
        let t = this.m_bodyA,
          i = this.m_bodyB,
          o = t.GetWorldPoint(this.m_localAnchor1),
          e = i.GetWorldPoint(this.m_localAnchor2),
          s = e.x - o.x,
          n = e.y - o.y,
          l = t.GetWorldVector(this.m_localXAxis1);
        return l.x * s + l.y * n;
      }),
      (x.prototype.GetJointSpeed = function () {
        let t = this.m_bodyA,
          i = this.m_bodyB,
          o = t.m_xf.R,
          e = this.m_localAnchor1.x - t.m_sweep.localCenter.x,
          s = this.m_localAnchor1.y - t.m_sweep.localCenter.y,
          n = o.col1.x * e + o.col2.x * s;
        (s = o.col1.y * e + o.col2.y * s), (e = n), (o = i.m_xf.R);
        let l = this.m_localAnchor2.x - i.m_sweep.localCenter.x,
          m = this.m_localAnchor2.y - i.m_sweep.localCenter.y;
        (n = o.col1.x * l + o.col2.x * m), (m = o.col1.y * l + o.col2.y * m), (l = n);
        let r = t.m_sweep.c.x + e,
          a = t.m_sweep.c.y + s,
          _ = i.m_sweep.c.x + l - r,
          h = i.m_sweep.c.y + m - a,
          c = t.GetWorldVector(this.m_localXAxis1),
          y = t.m_linearVelocity,
          p = i.m_linearVelocity,
          u = t.m_angularVelocity,
          x = i.m_angularVelocity;
        return (
          _ * (-u * c.y) +
          h * (u * c.x) +
          (c.x * (p.x + -x * m - y.x - -u * s) + c.y * (p.y + x * l - y.y - u * e))
        );
      }),
      (x.prototype.IsLimitEnabled = function () {
        return this.m_enableLimit;
      }),
      (x.prototype.EnableLimit = function (t) {
        this.m_bodyA.SetAwake(!0), this.m_bodyB.SetAwake(!0), (this.m_enableLimit = t);
      }),
      (x.prototype.GetLowerLimit = function () {
        return this.m_lowerTranslation;
      }),
      (x.prototype.GetUpperLimit = function () {
        return this.m_upperTranslation;
      }),
      (x.prototype.SetLimits = function (t, i) {
        void 0 === t && (t = 0),
          void 0 === i && (i = 0),
          this.m_bodyA.SetAwake(!0),
          this.m_bodyB.SetAwake(!0),
          (this.m_lowerTranslation = t),
          (this.m_upperTranslation = i);
      }),
      (x.prototype.IsMotorEnabled = function () {
        return this.m_enableMotor;
      }),
      (x.prototype.EnableMotor = function (t) {
        this.m_bodyA.SetAwake(!0), this.m_bodyB.SetAwake(!0), (this.m_enableMotor = t);
      }),
      (x.prototype.SetMotorSpeed = function (t) {
        void 0 === t && (t = 0),
          this.m_bodyA.SetAwake(!0),
          this.m_bodyB.SetAwake(!0),
          (this.m_motorSpeed = t);
      }),
      (x.prototype.GetMotorSpeed = function () {
        return this.m_motorSpeed;
      }),
      (x.prototype.SetMaxMotorForce = function (t) {
        void 0 === t && (t = 0),
          this.m_bodyA.SetAwake(!0),
          this.m_bodyB.SetAwake(!0),
          (this.m_maxMotorForce = t);
      }),
      (x.prototype.GetMaxMotorForce = function () {
        return this.m_maxMotorForce;
      }),
      (x.prototype.GetMotorForce = function () {
        return this.m_motorImpulse;
      }),
      (x.prototype.b2LineJoint = function (t) {
        this.__super.b2Joint.call(this, t),
          this.m_localAnchor1.SetV(t.localAnchorA),
          this.m_localAnchor2.SetV(t.localAnchorB),
          this.m_localXAxis1.SetV(t.localAxisA),
          (this.m_localYAxis1.x = -this.m_localXAxis1.y),
          (this.m_localYAxis1.y = this.m_localXAxis1.x),
          this.m_impulse.SetZero(),
          (this.m_motorMass = 0),
          (this.m_motorImpulse = 0),
          (this.m_lowerTranslation = t.lowerTranslation),
          (this.m_upperTranslation = t.upperTranslation),
          (this.m_maxMotorForce = t.maxMotorForce),
          (this.m_motorSpeed = t.motorSpeed),
          (this.m_enableLimit = t.enableLimit),
          (this.m_enableMotor = t.enableMotor),
          (this.m_limitState = y.e_inactiveLimit),
          this.m_axis.SetZero(),
          this.m_perp.SetZero();
      }),
      (x.prototype.InitVelocityConstraints = function (i) {
        let o = this.m_bodyA,
          s = this.m_bodyB;
        this.m_localCenterA.SetV(o.GetLocalCenter()), this.m_localCenterB.SetV(s.GetLocalCenter());
        let n = o.m_xf,
          l = o.m_xf.R,
          m = this.m_localAnchor1.x - this.m_localCenterA.x,
          r = this.m_localAnchor1.y - this.m_localCenterA.y,
          a = l.col1.x * m + l.col2.x * r;
        (r = l.col1.y * m + l.col2.y * r), (m = a), (l = s.m_xf.R);
        let _ = this.m_localAnchor2.x - this.m_localCenterB.x,
          h = this.m_localAnchor2.y - this.m_localCenterB.y;
        (a = l.col1.x * _ + l.col2.x * h), (h = l.col1.y * _ + l.col2.y * h), (_ = a);
        let c = s.m_sweep.c.x + _ - o.m_sweep.c.x - m,
          p = s.m_sweep.c.y + h - o.m_sweep.c.y - r;
        (this.m_invMassA = o.m_invMass),
          (this.m_invMassB = s.m_invMass),
          (this.m_invIA = o.m_invI),
          (this.m_invIB = s.m_invI);
        {
          let t = e.MulMV(n.R, this.m_localXAxis1);
          this.m_axis.SetV(t),
            (this.m_a1 = (c + m) * this.m_axis.y - (p + r) * this.m_axis.x),
            (this.m_a2 = _ * this.m_axis.y - h * this.m_axis.x),
            (this.m_motorMass =
              this.m_invMassA +
              this.m_invMassB +
              this.m_invIA * this.m_a1 * this.m_a1 +
              this.m_invIB * this.m_a2 * this.m_a2),
            (this.m_motorMass = this.m_motorMass > Number.MIN_VALUE ? 1 / this.m_motorMass : 0);
        }
        {
          let t = e.MulMV(n.R, this.m_localYAxis1);
          this.m_perp.SetV(t),
            (this.m_s1 = (c + m) * this.m_perp.y - (p + r) * this.m_perp.x),
            (this.m_s2 = _ * this.m_perp.y - h * this.m_perp.x);
          let i = this.m_invMassA,
            o = this.m_invMassB,
            s = this.m_invIA,
            l = this.m_invIB;
          (this.m_K.col1.x = i + o + s * this.m_s1 * this.m_s1 + l * this.m_s2 * this.m_s2),
            (this.m_K.col1.y = s * this.m_s1 * this.m_a1 + l * this.m_s2 * this.m_a2),
            (this.m_K.col2.x = this.m_K.col1.y),
            (this.m_K.col2.y = i + o + s * this.m_a1 * this.m_a1 + l * this.m_a2 * this.m_a2);
        }
        if (this.m_enableLimit) {
          let i = this.m_axis.x * c + this.m_axis.y * p;
          Math.abs(this.m_upperTranslation - this.m_lowerTranslation) < 2 * t.b2_linearSlop
            ? (this.m_limitState = y.e_equalLimits)
            : i <= this.m_lowerTranslation
            ? this.m_limitState !== y.e_atLowerLimit &&
              ((this.m_limitState = y.e_atLowerLimit), (this.m_impulse.y = 0))
            : i >= this.m_upperTranslation
            ? this.m_limitState !== y.e_atUpperLimit &&
              ((this.m_limitState = y.e_atUpperLimit), (this.m_impulse.y = 0))
            : ((this.m_limitState = y.e_inactiveLimit), (this.m_impulse.y = 0));
        } else this.m_limitState = y.e_inactiveLimit;
        if ((!1 === this.m_enableMotor && (this.m_motorImpulse = 0), i.warmStarting)) {
          (this.m_impulse.x *= i.dtRatio),
            (this.m_impulse.y *= i.dtRatio),
            (this.m_motorImpulse *= i.dtRatio);
          let t =
              this.m_impulse.x * this.m_perp.x +
              (this.m_motorImpulse + this.m_impulse.y) * this.m_axis.x,
            e =
              this.m_impulse.x * this.m_perp.y +
              (this.m_motorImpulse + this.m_impulse.y) * this.m_axis.y,
            n = this.m_impulse.x * this.m_s1 + (this.m_motorImpulse + this.m_impulse.y) * this.m_a1,
            l = this.m_impulse.x * this.m_s2 + (this.m_motorImpulse + this.m_impulse.y) * this.m_a2;
          (o.m_linearVelocity.x -= this.m_invMassA * t),
            (o.m_linearVelocity.y -= this.m_invMassA * e),
            (o.m_angularVelocity -= this.m_invIA * n),
            (s.m_linearVelocity.x += this.m_invMassB * t),
            (s.m_linearVelocity.y += this.m_invMassB * e),
            (s.m_angularVelocity += this.m_invIB * l);
        } else this.m_impulse.SetZero(), (this.m_motorImpulse = 0);
      }),
      (x.prototype.SolveVelocityConstraints = function (t) {
        let i = this.m_bodyA,
          o = this.m_bodyB,
          n = i.m_linearVelocity,
          l = i.m_angularVelocity,
          m = o.m_linearVelocity,
          r = o.m_angularVelocity,
          a = 0,
          _ = 0,
          h = 0,
          c = 0;
        if (this.m_enableMotor && this.m_limitState !== y.e_equalLimits) {
          let i =
              this.m_axis.x * (m.x - n.x) +
              this.m_axis.y * (m.y - n.y) +
              this.m_a2 * r -
              this.m_a1 * l,
            o = this.m_motorMass * (this.m_motorSpeed - i),
            s = this.m_motorImpulse,
            y = t.dt * this.m_maxMotorForce;
          (this.m_motorImpulse = e.Clamp(this.m_motorImpulse + o, -y, y)),
            (a = (o = this.m_motorImpulse - s) * this.m_axis.x),
            (_ = o * this.m_axis.y),
            (h = o * this.m_a1),
            (c = o * this.m_a2),
            (n.x -= this.m_invMassA * a),
            (n.y -= this.m_invMassA * _),
            (l -= this.m_invIA * h),
            (m.x += this.m_invMassB * a),
            (m.y += this.m_invMassB * _),
            (r += this.m_invIB * c);
        }
        let p =
          this.m_perp.x * (m.x - n.x) + this.m_perp.y * (m.y - n.y) + this.m_s2 * r - this.m_s1 * l;
        if (this.m_enableLimit && this.m_limitState !== y.e_inactiveLimit) {
          let t =
              this.m_axis.x * (m.x - n.x) +
              this.m_axis.y * (m.y - n.y) +
              this.m_a2 * r -
              this.m_a1 * l,
            i = this.m_impulse.Copy(),
            o = new s(),
            e = this.m_K.Solve(o, -p, -t);
          this.m_impulse.Add(e),
            this.m_limitState === y.e_atLowerLimit
              ? (this.m_impulse.y = Math.max(this.m_impulse.y, 0))
              : this.m_limitState === y.e_atUpperLimit &&
                (this.m_impulse.y = Math.min(this.m_impulse.y, 0));
          let u = -p - (this.m_impulse.y - i.y) * this.m_K.col2.x,
            x = 0;
          (x = 0 !== this.m_K.col1.x ? u / this.m_K.col1.x + i.x : i.x),
            (this.m_impulse.x = x),
            (e.x = this.m_impulse.x - i.x),
            (e.y = this.m_impulse.y - i.y),
            (a = e.x * this.m_perp.x + e.y * this.m_axis.x),
            (_ = e.x * this.m_perp.y + e.y * this.m_axis.y),
            (h = e.x * this.m_s1 + e.y * this.m_a1),
            (c = e.x * this.m_s2 + e.y * this.m_a2),
            (n.x -= this.m_invMassA * a),
            (n.y -= this.m_invMassA * _),
            (l -= this.m_invIA * h),
            (m.x += this.m_invMassB * a),
            (m.y += this.m_invMassB * _),
            (r += this.m_invIB * c);
        } else {
          let t = 0;
          (t = 0 !== this.m_K.col1.x ? -p / this.m_K.col1.x : 0),
            (this.m_impulse.x += t),
            (a = t * this.m_perp.x),
            (_ = t * this.m_perp.y),
            (h = t * this.m_s1),
            (c = t * this.m_s2),
            (n.x -= this.m_invMassA * a),
            (n.y -= this.m_invMassA * _),
            (l -= this.m_invIA * h),
            (m.x += this.m_invMassB * a),
            (m.y += this.m_invMassB * _),
            (r += this.m_invIB * c);
        }
        i.m_linearVelocity.SetV(n),
          (i.m_angularVelocity = l),
          o.m_linearVelocity.SetV(m),
          (o.m_angularVelocity = r);
      }),
      (x.prototype.SolvePositionConstraints = function () {
        let o = this.m_bodyA,
          n = this.m_bodyB,
          l = o.m_sweep.c,
          m = o.m_sweep.a,
          r = n.m_sweep.c,
          a = n.m_sweep.a,
          _ = 0,
          h = 0,
          c = 0,
          y = 0,
          p = 0,
          u = 0,
          x = !1,
          d = 0,
          f = i.FromAngle(m),
          b = i.FromAngle(a),
          B = f,
          A = this.m_localAnchor1.x - this.m_localCenterA.x,
          D = this.m_localAnchor1.y - this.m_localCenterA.y,
          C = B.col1.x * A + B.col2.x * D;
        (D = B.col1.y * A + B.col2.y * D), (A = C), (B = b);
        let w = this.m_localAnchor2.x - this.m_localCenterB.x,
          v = this.m_localAnchor2.y - this.m_localCenterB.y;
        (C = B.col1.x * w + B.col2.x * v), (v = B.col1.y * w + B.col2.y * v), (w = C);
        let g = r.x + w - l.x - A,
          S = r.y + v - l.y - D;
        if (this.m_enableLimit) {
          (this.m_axis = e.MulMV(f, this.m_localXAxis1)),
            (this.m_a1 = (g + A) * this.m_axis.y - (S + D) * this.m_axis.x),
            (this.m_a2 = w * this.m_axis.y - v * this.m_axis.x);
          let i = this.m_axis.x * g + this.m_axis.y * S;
          Math.abs(this.m_upperTranslation - this.m_lowerTranslation) < 2 * t.b2_linearSlop
            ? ((d = e.Clamp(i, -t.b2_maxLinearCorrection, t.b2_maxLinearCorrection)),
              (p = Math.abs(i)),
              (x = !0))
            : i <= this.m_lowerTranslation
            ? ((d = e.Clamp(
                i - this.m_lowerTranslation + t.b2_linearSlop,
                -t.b2_maxLinearCorrection,
                0
              )),
              (p = this.m_lowerTranslation - i),
              (x = !0))
            : i >= this.m_upperTranslation &&
              ((d = e.Clamp(
                i - this.m_upperTranslation + t.b2_linearSlop,
                0,
                t.b2_maxLinearCorrection
              )),
              (p = i - this.m_upperTranslation),
              (x = !0));
        }
        (this.m_perp = e.MulMV(f, this.m_localYAxis1)),
          (this.m_s1 = (g + A) * this.m_perp.y - (S + D) * this.m_perp.x),
          (this.m_s2 = w * this.m_perp.y - v * this.m_perp.x);
        let M = new s(),
          V = this.m_perp.x * g + this.m_perp.y * S;
        if (((p = Math.max(p, Math.abs(V))), (u = 0), x))
          (_ = this.m_invMassA),
            (h = this.m_invMassB),
            (c = this.m_invIA),
            (y = this.m_invIB),
            (this.m_K.col1.x = _ + h + c * this.m_s1 * this.m_s1 + y * this.m_s2 * this.m_s2),
            (this.m_K.col1.y = c * this.m_s1 * this.m_a1 + y * this.m_s2 * this.m_a2),
            (this.m_K.col2.x = this.m_K.col1.y),
            (this.m_K.col2.y = _ + h + c * this.m_a1 * this.m_a1 + y * this.m_a2 * this.m_a2),
            this.m_K.Solve(M, -V, -d);
        else {
          (_ = this.m_invMassA), (h = this.m_invMassB), (c = this.m_invIA), (y = this.m_invIB);
          let t = _ + h + c * this.m_s1 * this.m_s1 + y * this.m_s2 * this.m_s2,
            i = 0;
          (i = 0 !== t ? -V / t : 0), (M.x = i), (M.y = 0);
        }
        let I = M.x * this.m_perp.x + M.y * this.m_axis.x,
          R = M.x * this.m_perp.y + M.y * this.m_axis.y,
          L = M.x * this.m_s1 + M.y * this.m_a1,
          J = M.x * this.m_s2 + M.y * this.m_a2;
        return (
          (l.x -= this.m_invMassA * I),
          (l.y -= this.m_invMassA * R),
          (m -= this.m_invIA * L),
          (r.x += this.m_invMassB * I),
          (r.y += this.m_invMassB * R),
          (a += this.m_invIB * J),
          (o.m_sweep.a = m),
          (n.m_sweep.a = a),
          o.SynchronizeTransform(),
          n.SynchronizeTransform(),
          p <= t.b2_linearSlop && 0 <= t.b2_angularSlop
        );
      }),
      Box2D.inherit(d, Box2D.Dynamics.Joints.b2JointDef),
      (d.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype),
      (d.b2LineJointDef = function () {
        Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments),
          (this.localAnchorA = new s()),
          (this.localAnchorB = new s()),
          (this.localAxisA = new s());
      }),
      (d.prototype.b2LineJointDef = function () {
        this.__super.b2JointDef.call(this),
          (this.type = y.e_lineJoint),
          this.localAxisA.Set(1, 0),
          (this.enableLimit = !1),
          (this.lowerTranslation = 0),
          (this.upperTranslation = 0),
          (this.enableMotor = !1),
          (this.maxMotorForce = 0),
          (this.motorSpeed = 0);
      }),
      (d.prototype.Initialize = function (t, i, o, e) {
        (this.bodyA = t),
          (this.bodyB = i),
          (this.localAnchorA = this.bodyA.GetLocalPoint(o)),
          (this.localAnchorB = this.bodyB.GetLocalPoint(o)),
          (this.localAxisA = this.bodyA.GetLocalVector(e));
      }),
      Box2D.inherit(f, Box2D.Dynamics.Joints.b2Joint),
      (f.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype),
      (f.b2MouseJoint = function () {
        Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments),
          (this.K = new i()),
          (this.K1 = new i()),
          (this.K2 = new i()),
          (this.m_localAnchor = new s()),
          (this.m_target = new s()),
          (this.m_impulse = new s()),
          (this.m_mass = new i()),
          (this.m_C = new s());
      }),
      (f.prototype.GetAnchorA = function () {
        return this.m_target;
      }),
      (f.prototype.GetAnchorB = function () {
        return this.m_bodyB.GetWorldPoint(this.m_localAnchor);
      }),
      (f.prototype.GetReactionForce = function (t) {
        return new s(t * this.m_impulse.x, t * this.m_impulse.y);
      }),
      (f.prototype.GetReactionTorque = function (t) {
        return 0;
      }),
      (f.prototype.GetTarget = function () {
        return this.m_target;
      }),
      (f.prototype.SetTarget = function (t) {
        this.m_bodyB.m_isAwake || this.m_bodyB.SetAwake(!0), (this.m_target = t);
      }),
      (f.prototype.GetMaxForce = function () {
        return this.m_maxForce;
      }),
      (f.prototype.SetMaxForce = function (t) {
        void 0 === t && (t = 0), (this.m_maxForce = t);
      }),
      (f.prototype.GetFrequency = function () {
        return this.m_frequencyHz;
      }),
      (f.prototype.SetFrequency = function (t) {
        void 0 === t && (t = 0), (this.m_frequencyHz = t);
      }),
      (f.prototype.GetDampingRatio = function () {
        return this.m_dampingRatio;
      }),
      (f.prototype.SetDampingRatio = function (t) {
        void 0 === t && (t = 0), (this.m_dampingRatio = t);
      }),
      (f.prototype.b2MouseJoint = function (t) {
        this.__super.b2Joint.call(this, t), this.m_target.SetV(t.target);
        let i = this.m_target.x - this.m_bodyB.m_xf.position.x,
          o = this.m_target.y - this.m_bodyB.m_xf.position.y,
          e = this.m_bodyB.m_xf.R;
        (this.m_localAnchor.x = i * e.col1.x + o * e.col1.y),
          (this.m_localAnchor.y = i * e.col2.x + o * e.col2.y),
          (this.m_maxForce = t.maxForce),
          this.m_impulse.SetZero(),
          (this.m_frequencyHz = t.frequencyHz),
          (this.m_dampingRatio = t.dampingRatio),
          (this.m_beta = 0),
          (this.m_gamma = 0);
      }),
      (f.prototype.InitVelocityConstraints = function (t) {
        let i,
          o = this.m_bodyB,
          e = o.GetMass(),
          s = 2 * Math.PI * this.m_frequencyHz,
          n = 2 * e * this.m_dampingRatio * s,
          l = e * s * s;
        (this.m_gamma = t.dt * (n + t.dt * l)),
          (this.m_gamma = 0 !== this.m_gamma ? 1 / this.m_gamma : 0),
          (this.m_beta = t.dt * l * this.m_gamma),
          (i = o.m_xf.R);
        let m = this.m_localAnchor.x - o.m_sweep.localCenter.x,
          r = this.m_localAnchor.y - o.m_sweep.localCenter.y,
          a = i.col1.x * m + i.col2.x * r;
        (r = i.col1.y * m + i.col2.y * r), (m = a);
        let _ = o.m_invMass,
          h = o.m_invI;
        (this.K1.col1.x = _),
          (this.K1.col2.x = 0),
          (this.K1.col1.y = 0),
          (this.K1.col2.y = _),
          (this.K2.col1.x = h * r * r),
          (this.K2.col2.x = -h * m * r),
          (this.K2.col1.y = -h * m * r),
          (this.K2.col2.y = h * m * m),
          this.K.SetM(this.K1),
          this.K.AddM(this.K2),
          (this.K.col1.x += this.m_gamma),
          (this.K.col2.y += this.m_gamma),
          this.K.GetInverse(this.m_mass),
          (this.m_C.x = o.m_sweep.c.x + m - this.m_target.x),
          (this.m_C.y = o.m_sweep.c.y + r - this.m_target.y),
          (o.m_angularVelocity *= 0.98),
          (this.m_impulse.x *= t.dtRatio),
          (this.m_impulse.y *= t.dtRatio),
          (o.m_linearVelocity.x += _ * this.m_impulse.x),
          (o.m_linearVelocity.y += _ * this.m_impulse.y),
          (o.m_angularVelocity += h * (m * this.m_impulse.y - r * this.m_impulse.x));
      }),
      (f.prototype.SolveVelocityConstraints = function (t) {
        let i = this.m_bodyB,
          o = i.m_xf.R,
          e = this.m_localAnchor.x - i.m_sweep.localCenter.x,
          s = this.m_localAnchor.y - i.m_sweep.localCenter.y,
          n = o.col1.x * e + o.col2.x * s;
        (s = o.col1.y * e + o.col2.y * s), (e = n);
        let l = i.m_linearVelocity.x + -i.m_angularVelocity * s,
          m = i.m_linearVelocity.y + i.m_angularVelocity * e;
        (o = this.m_mass), (n = l + this.m_beta * this.m_C.x + this.m_gamma * this.m_impulse.x);
        let r = m + this.m_beta * this.m_C.y + this.m_gamma * this.m_impulse.y,
          a = -(o.col1.x * n + o.col2.x * r),
          _ = -(o.col1.y * n + o.col2.y * r),
          h = this.m_impulse.x,
          c = this.m_impulse.y;
        (this.m_impulse.x += a), (this.m_impulse.y += _);
        let y = t.dt * this.m_maxForce;
        this.m_impulse.LengthSquared() > y * y &&
          this.m_impulse.Multiply(y / this.m_impulse.Length()),
          (a = this.m_impulse.x - h),
          (_ = this.m_impulse.y - c),
          (i.m_linearVelocity.x += i.m_invMass * a),
          (i.m_linearVelocity.y += i.m_invMass * _),
          (i.m_angularVelocity += i.m_invI * (e * _ - s * a));
      }),
      (f.prototype.SolvePositionConstraints = function (t) {
        return !0;
      }),
      Box2D.inherit(b, Box2D.Dynamics.Joints.b2JointDef),
      (b.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype),
      (b.b2MouseJointDef = function () {
        Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments), (this.target = new s());
      }),
      (b.prototype.b2MouseJointDef = function () {
        this.__super.b2JointDef.call(this),
          (this.type = y.e_mouseJoint),
          (this.maxForce = 0),
          (this.frequencyHz = 5),
          (this.dampingRatio = 0.7);
      }),
      Box2D.inherit(B, Box2D.Dynamics.Joints.b2Joint),
      (B.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype),
      (B.b2PrismaticJoint = function () {
        Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments),
          (this.m_localAnchor1 = new s()),
          (this.m_localAnchor2 = new s()),
          (this.m_localXAxis1 = new s()),
          (this.m_localYAxis1 = new s()),
          (this.m_axis = new s()),
          (this.m_perp = new s()),
          (this.m_K = new o()),
          (this.m_impulse = new n(0, 0, 0));
      }),
      (B.prototype.GetAnchorA = function () {
        return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
      }),
      (B.prototype.GetAnchorB = function () {
        return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
      }),
      (B.prototype.GetReactionForce = function (t) {
        return new s(
          t *
            (this.m_impulse.x * this.m_perp.x +
              (this.m_motorImpulse + this.m_impulse.z) * this.m_axis.x),
          t *
            (this.m_impulse.x * this.m_perp.y +
              (this.m_motorImpulse + this.m_impulse.z) * this.m_axis.y)
        );
      }),
      (B.prototype.GetReactionTorque = function (t) {
        return t * this.m_impulse.y;
      }),
      (B.prototype.GetJointTranslation = function () {
        let t = this.m_bodyA,
          i = this.m_bodyB,
          o = t.GetWorldPoint(this.m_localAnchor1),
          e = i.GetWorldPoint(this.m_localAnchor2),
          s = e.x - o.x,
          n = e.y - o.y,
          l = t.GetWorldVector(this.m_localXAxis1);
        return l.x * s + l.y * n;
      }),
      (B.prototype.GetJointSpeed = function () {
        let t = this.m_bodyA,
          i = this.m_bodyB,
          o = t.m_xf.R,
          e = this.m_localAnchor1.x - t.m_sweep.localCenter.x,
          s = this.m_localAnchor1.y - t.m_sweep.localCenter.y,
          n = o.col1.x * e + o.col2.x * s;
        (s = o.col1.y * e + o.col2.y * s), (e = n), (o = i.m_xf.R);
        let l = this.m_localAnchor2.x - i.m_sweep.localCenter.x,
          m = this.m_localAnchor2.y - i.m_sweep.localCenter.y;
        (n = o.col1.x * l + o.col2.x * m), (m = o.col1.y * l + o.col2.y * m), (l = n);
        let r = t.m_sweep.c.x + e,
          a = t.m_sweep.c.y + s,
          _ = i.m_sweep.c.x + l - r,
          h = i.m_sweep.c.y + m - a,
          c = t.GetWorldVector(this.m_localXAxis1),
          y = t.m_linearVelocity,
          p = i.m_linearVelocity,
          u = t.m_angularVelocity,
          x = i.m_angularVelocity;
        return (
          _ * (-u * c.y) +
          h * (u * c.x) +
          (c.x * (p.x + -x * m - y.x - -u * s) + c.y * (p.y + x * l - y.y - u * e))
        );
      }),
      (B.prototype.IsLimitEnabled = function () {
        return this.m_enableLimit;
      }),
      (B.prototype.EnableLimit = function (t) {
        this.m_bodyA.SetAwake(!0), this.m_bodyB.SetAwake(!0), (this.m_enableLimit = t);
      }),
      (B.prototype.GetLowerLimit = function () {
        return this.m_lowerTranslation;
      }),
      (B.prototype.GetUpperLimit = function () {
        return this.m_upperTranslation;
      }),
      (B.prototype.SetLimits = function (t, i) {
        void 0 === t && (t = 0),
          void 0 === i && (i = 0),
          this.m_bodyA.SetAwake(!0),
          this.m_bodyB.SetAwake(!0),
          (this.m_lowerTranslation = t),
          (this.m_upperTranslation = i);
      }),
      (B.prototype.IsMotorEnabled = function () {
        return this.m_enableMotor;
      }),
      (B.prototype.EnableMotor = function (t) {
        this.m_bodyA.SetAwake(!0), this.m_bodyB.SetAwake(!0), (this.m_enableMotor = t);
      }),
      (B.prototype.SetMotorSpeed = function (t) {
        void 0 === t && (t = 0),
          this.m_bodyA.SetAwake(!0),
          this.m_bodyB.SetAwake(!0),
          (this.m_motorSpeed = t);
      }),
      (B.prototype.GetMotorSpeed = function () {
        return this.m_motorSpeed;
      }),
      (B.prototype.SetMaxMotorForce = function (t) {
        void 0 === t && (t = 0),
          this.m_bodyA.SetAwake(!0),
          this.m_bodyB.SetAwake(!0),
          (this.m_maxMotorForce = t);
      }),
      (B.prototype.GetMotorForce = function () {
        return this.m_motorImpulse;
      }),
      (B.prototype.b2PrismaticJoint = function (t) {
        this.__super.b2Joint.call(this, t),
          this.m_localAnchor1.SetV(t.localAnchorA),
          this.m_localAnchor2.SetV(t.localAnchorB),
          this.m_localXAxis1.SetV(t.localAxisA),
          (this.m_localYAxis1.x = -this.m_localXAxis1.y),
          (this.m_localYAxis1.y = this.m_localXAxis1.x),
          (this.m_refAngle = t.referenceAngle),
          this.m_impulse.SetZero(),
          (this.m_motorMass = 0),
          (this.m_motorImpulse = 0),
          (this.m_lowerTranslation = t.lowerTranslation),
          (this.m_upperTranslation = t.upperTranslation),
          (this.m_maxMotorForce = t.maxMotorForce),
          (this.m_motorSpeed = t.motorSpeed),
          (this.m_enableLimit = t.enableLimit),
          (this.m_enableMotor = t.enableMotor),
          (this.m_limitState = y.e_inactiveLimit),
          this.m_axis.SetZero(),
          this.m_perp.SetZero();
      }),
      (B.prototype.InitVelocityConstraints = function (i) {
        let o = this.m_bodyA,
          s = this.m_bodyB;
        this.m_localCenterA.SetV(o.GetLocalCenter()), this.m_localCenterB.SetV(s.GetLocalCenter());
        let n = o.m_xf,
          l = o.m_xf.R,
          m = this.m_localAnchor1.x - this.m_localCenterA.x,
          r = this.m_localAnchor1.y - this.m_localCenterA.y,
          a = l.col1.x * m + l.col2.x * r;
        (r = l.col1.y * m + l.col2.y * r), (m = a), (l = s.m_xf.R);
        let _ = this.m_localAnchor2.x - this.m_localCenterB.x,
          h = this.m_localAnchor2.y - this.m_localCenterB.y;
        (a = l.col1.x * _ + l.col2.x * h), (h = l.col1.y * _ + l.col2.y * h), (_ = a);
        let c = s.m_sweep.c.x + _ - o.m_sweep.c.x - m,
          p = s.m_sweep.c.y + h - o.m_sweep.c.y - r;
        (this.m_invMassA = o.m_invMass),
          (this.m_invMassB = s.m_invMass),
          (this.m_invIA = o.m_invI),
          (this.m_invIB = s.m_invI);
        {
          let t = e.MulMV(n.R, this.m_localXAxis1);
          this.m_axis.SetV(t),
            (this.m_a1 = (c + m) * this.m_axis.y - (p + r) * this.m_axis.x),
            (this.m_a2 = _ * this.m_axis.y - h * this.m_axis.x),
            (this.m_motorMass =
              this.m_invMassA +
              this.m_invMassB +
              this.m_invIA * this.m_a1 * this.m_a1 +
              this.m_invIB * this.m_a2 * this.m_a2),
            this.m_motorMass > Number.MIN_VALUE && (this.m_motorMass = 1 / this.m_motorMass);
        }
        {
          let t = e.MulMV(n.R, this.m_localYAxis1);
          this.m_perp.SetV(t),
            (this.m_s1 = (c + m) * this.m_perp.y - (p + r) * this.m_perp.x),
            (this.m_s2 = _ * this.m_perp.y - h * this.m_perp.x);
          let i = this.m_invMassA,
            o = this.m_invMassB,
            s = this.m_invIA,
            l = this.m_invIB;
          (this.m_K.col1.x = i + o + s * this.m_s1 * this.m_s1 + l * this.m_s2 * this.m_s2),
            (this.m_K.col1.y = s * this.m_s1 + l * this.m_s2),
            (this.m_K.col1.z = s * this.m_s1 * this.m_a1 + l * this.m_s2 * this.m_a2),
            (this.m_K.col2.x = this.m_K.col1.y),
            (this.m_K.col2.y = s + l),
            (this.m_K.col2.z = s * this.m_a1 + l * this.m_a2),
            (this.m_K.col3.x = this.m_K.col1.z),
            (this.m_K.col3.y = this.m_K.col2.z),
            (this.m_K.col3.z = i + o + s * this.m_a1 * this.m_a1 + l * this.m_a2 * this.m_a2);
        }
        if (this.m_enableLimit) {
          let i = this.m_axis.x * c + this.m_axis.y * p;
          Math.abs(this.m_upperTranslation - this.m_lowerTranslation) < 2 * t.b2_linearSlop
            ? (this.m_limitState = y.e_equalLimits)
            : i <= this.m_lowerTranslation
            ? this.m_limitState !== y.e_atLowerLimit &&
              ((this.m_limitState = y.e_atLowerLimit), (this.m_impulse.z = 0))
            : i >= this.m_upperTranslation
            ? this.m_limitState !== y.e_atUpperLimit &&
              ((this.m_limitState = y.e_atUpperLimit), (this.m_impulse.z = 0))
            : ((this.m_limitState = y.e_inactiveLimit), (this.m_impulse.z = 0));
        } else this.m_limitState = y.e_inactiveLimit;
        if ((this.m_enableMotor || (this.m_motorImpulse = 0), i.warmStarting)) {
          (this.m_impulse.x *= i.dtRatio),
            (this.m_impulse.y *= i.dtRatio),
            (this.m_motorImpulse *= i.dtRatio);
          let t =
              this.m_impulse.x * this.m_perp.x +
              (this.m_motorImpulse + this.m_impulse.z) * this.m_axis.x,
            e =
              this.m_impulse.x * this.m_perp.y +
              (this.m_motorImpulse + this.m_impulse.z) * this.m_axis.y,
            n =
              this.m_impulse.x * this.m_s1 +
              this.m_impulse.y +
              (this.m_motorImpulse + this.m_impulse.z) * this.m_a1,
            l =
              this.m_impulse.x * this.m_s2 +
              this.m_impulse.y +
              (this.m_motorImpulse + this.m_impulse.z) * this.m_a2;
          (o.m_linearVelocity.x -= this.m_invMassA * t),
            (o.m_linearVelocity.y -= this.m_invMassA * e),
            (o.m_angularVelocity -= this.m_invIA * n),
            (s.m_linearVelocity.x += this.m_invMassB * t),
            (s.m_linearVelocity.y += this.m_invMassB * e),
            (s.m_angularVelocity += this.m_invIB * l);
        } else this.m_impulse.SetZero(), (this.m_motorImpulse = 0);
      }),
      (B.prototype.SolveVelocityConstraints = function (t) {
        let i = this.m_bodyA,
          o = this.m_bodyB,
          l = i.m_linearVelocity,
          m = i.m_angularVelocity,
          r = o.m_linearVelocity,
          a = o.m_angularVelocity,
          _ = 0,
          h = 0,
          c = 0,
          p = 0;
        if (this.m_enableMotor && this.m_limitState !== y.e_equalLimits) {
          let i =
              this.m_axis.x * (r.x - l.x) +
              this.m_axis.y * (r.y - l.y) +
              this.m_a2 * a -
              this.m_a1 * m,
            o = this.m_motorMass * (this.m_motorSpeed - i),
            s = this.m_motorImpulse,
            n = t.dt * this.m_maxMotorForce;
          (this.m_motorImpulse = e.Clamp(this.m_motorImpulse + o, -n, n)),
            (_ = (o = this.m_motorImpulse - s) * this.m_axis.x),
            (h = o * this.m_axis.y),
            (c = o * this.m_a1),
            (p = o * this.m_a2),
            (l.x -= this.m_invMassA * _),
            (l.y -= this.m_invMassA * h),
            (m -= this.m_invIA * c),
            (r.x += this.m_invMassB * _),
            (r.y += this.m_invMassB * h),
            (a += this.m_invIB * p);
        }
        let u =
            this.m_perp.x * (r.x - l.x) +
            this.m_perp.y * (r.y - l.y) +
            this.m_s2 * a -
            this.m_s1 * m,
          x = a - m;
        if (this.m_enableLimit && this.m_limitState !== y.e_inactiveLimit) {
          let t =
              this.m_axis.x * (r.x - l.x) +
              this.m_axis.y * (r.y - l.y) +
              this.m_a2 * a -
              this.m_a1 * m,
            i = this.m_impulse.Copy(),
            o = this.m_K.Solve33(new n(0, 0, 0), -u, -x, -t);
          this.m_impulse.Add(o),
            this.m_limitState === y.e_atLowerLimit
              ? (this.m_impulse.z = Math.max(this.m_impulse.z, 0))
              : this.m_limitState === y.e_atUpperLimit &&
                (this.m_impulse.z = Math.min(this.m_impulse.z, 0));
          let e = -u - (this.m_impulse.z - i.z) * this.m_K.col3.x,
            d = -x - (this.m_impulse.z - i.z) * this.m_K.col3.y,
            f = new s(),
            b = this.m_K.Solve22(f, e, d);
          (b.x += i.x),
            (b.y += i.y),
            (this.m_impulse.x = b.x),
            (this.m_impulse.y = b.y),
            (o.x = this.m_impulse.x - i.x),
            (o.y = this.m_impulse.y - i.y),
            (o.z = this.m_impulse.z - i.z),
            (_ = o.x * this.m_perp.x + o.z * this.m_axis.x),
            (h = o.x * this.m_perp.y + o.z * this.m_axis.y),
            (c = o.x * this.m_s1 + o.y + o.z * this.m_a1),
            (p = o.x * this.m_s2 + o.y + o.z * this.m_a2),
            (l.x -= this.m_invMassA * _),
            (l.y -= this.m_invMassA * h),
            (m -= this.m_invIA * c),
            (r.x += this.m_invMassB * _),
            (r.y += this.m_invMassB * h),
            (a += this.m_invIB * p);
        } else {
          let t = new s(),
            i = this.m_K.Solve22(t, -u, -x);
          (this.m_impulse.x += i.x),
            (this.m_impulse.y += i.y),
            (_ = i.x * this.m_perp.x),
            (h = i.x * this.m_perp.y),
            (c = i.x * this.m_s1 + i.y),
            (p = i.x * this.m_s2 + i.y),
            (l.x -= this.m_invMassA * _),
            (l.y -= this.m_invMassA * h),
            (m -= this.m_invIA * c),
            (r.x += this.m_invMassB * _),
            (r.y += this.m_invMassB * h),
            (a += this.m_invIB * p);
        }
        i.m_linearVelocity.SetV(l),
          (i.m_angularVelocity = m),
          o.m_linearVelocity.SetV(r),
          (o.m_angularVelocity = a);
      }),
      (B.prototype.SolvePositionConstraints = function () {
        let o = this.m_bodyA,
          l = this.m_bodyB,
          m = o.m_sweep.c,
          r = o.m_sweep.a,
          a = l.m_sweep.c,
          _ = l.m_sweep.a,
          h = 0,
          c = 0,
          y = 0,
          p = 0,
          u = 0,
          x = 0,
          d = !1,
          f = 0,
          b = i.FromAngle(r),
          B = i.FromAngle(_),
          A = b,
          D = this.m_localAnchor1.x - this.m_localCenterA.x,
          C = this.m_localAnchor1.y - this.m_localCenterA.y,
          w = A.col1.x * D + A.col2.x * C;
        (C = A.col1.y * D + A.col2.y * C), (D = w), (A = B);
        let v = this.m_localAnchor2.x - this.m_localCenterB.x,
          g = this.m_localAnchor2.y - this.m_localCenterB.y;
        (w = A.col1.x * v + A.col2.x * g), (g = A.col1.y * v + A.col2.y * g), (v = w);
        let S = a.x + v - m.x - D,
          M = a.y + g - m.y - C;
        if (this.m_enableLimit) {
          (this.m_axis = e.MulMV(b, this.m_localXAxis1)),
            (this.m_a1 = (S + D) * this.m_axis.y - (M + C) * this.m_axis.x),
            (this.m_a2 = v * this.m_axis.y - g * this.m_axis.x);
          let i = this.m_axis.x * S + this.m_axis.y * M;
          Math.abs(this.m_upperTranslation - this.m_lowerTranslation) < 2 * t.b2_linearSlop
            ? ((f = e.Clamp(i, -t.b2_maxLinearCorrection, t.b2_maxLinearCorrection)),
              (u = Math.abs(i)),
              (d = !0))
            : i <= this.m_lowerTranslation
            ? ((f = e.Clamp(
                i - this.m_lowerTranslation + t.b2_linearSlop,
                -t.b2_maxLinearCorrection,
                0
              )),
              (u = this.m_lowerTranslation - i),
              (d = !0))
            : i >= this.m_upperTranslation &&
              ((f = e.Clamp(
                i - this.m_upperTranslation + t.b2_linearSlop,
                0,
                t.b2_maxLinearCorrection
              )),
              (u = i - this.m_upperTranslation),
              (d = !0));
        }
        (this.m_perp = e.MulMV(b, this.m_localYAxis1)),
          (this.m_s1 = (S + D) * this.m_perp.y - (M + C) * this.m_perp.x),
          (this.m_s2 = v * this.m_perp.y - g * this.m_perp.x);
        let V = new n(0, 0, 0),
          I = this.m_perp.x * S + this.m_perp.y * M,
          R = _ - r - this.m_refAngle;
        if (((u = Math.max(u, Math.abs(I))), (x = Math.abs(R)), d))
          (h = this.m_invMassA),
            (c = this.m_invMassB),
            (y = this.m_invIA),
            (p = this.m_invIB),
            (this.m_K.col1.x = h + c + y * this.m_s1 * this.m_s1 + p * this.m_s2 * this.m_s2),
            (this.m_K.col1.y = y * this.m_s1 + p * this.m_s2),
            (this.m_K.col1.z = y * this.m_s1 * this.m_a1 + p * this.m_s2 * this.m_a2),
            (this.m_K.col2.x = this.m_K.col1.y),
            (this.m_K.col2.y = y + p),
            (this.m_K.col2.z = y * this.m_a1 + p * this.m_a2),
            (this.m_K.col3.x = this.m_K.col1.z),
            (this.m_K.col3.y = this.m_K.col2.z),
            (this.m_K.col3.z = h + c + y * this.m_a1 * this.m_a1 + p * this.m_a2 * this.m_a2),
            this.m_K.Solve33(V, -I, -R, -f);
        else {
          (h = this.m_invMassA), (c = this.m_invMassB), (y = this.m_invIA), (p = this.m_invIB);
          let t = h + c + y * this.m_s1 * this.m_s1 + p * this.m_s2 * this.m_s2,
            i = y * this.m_s1 + p * this.m_s2,
            o = y + p;
          this.m_K.col1.Set(t, i, 0), this.m_K.col2.Set(i, o, 0);
          let e = new s(),
            n = this.m_K.Solve22(e, -I, -R);
          (V.x = n.x), (V.y = n.y), (V.z = 0);
        }
        let L = V.x * this.m_perp.x + V.z * this.m_axis.x,
          J = V.x * this.m_perp.y + V.z * this.m_axis.y,
          P = V.x * this.m_s1 + V.y + V.z * this.m_a1,
          G = V.x * this.m_s2 + V.y + V.z * this.m_a2;
        return (
          (m.x -= this.m_invMassA * L),
          (m.y -= this.m_invMassA * J),
          (r -= this.m_invIA * P),
          (a.x += this.m_invMassB * L),
          (a.y += this.m_invMassB * J),
          (_ += this.m_invIB * G),
          (o.m_sweep.a = r),
          (l.m_sweep.a = _),
          o.SynchronizeTransform(),
          l.SynchronizeTransform(),
          u <= t.b2_linearSlop && x <= t.b2_angularSlop
        );
      }),
      Box2D.inherit(A, Box2D.Dynamics.Joints.b2JointDef),
      (A.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype),
      (A.b2PrismaticJointDef = function () {
        Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments),
          (this.localAnchorA = new s()),
          (this.localAnchorB = new s()),
          (this.localAxisA = new s());
      }),
      (A.prototype.b2PrismaticJointDef = function () {
        this.__super.b2JointDef.call(this),
          (this.type = y.e_prismaticJoint),
          this.localAxisA.Set(1, 0),
          (this.referenceAngle = 0),
          (this.enableLimit = !1),
          (this.lowerTranslation = 0),
          (this.upperTranslation = 0),
          (this.enableMotor = !1),
          (this.maxMotorForce = 0),
          (this.motorSpeed = 0);
      }),
      (A.prototype.Initialize = function (t, i, o, e) {
        (this.bodyA = t),
          (this.bodyB = i),
          (this.localAnchorA = this.bodyA.GetLocalPoint(o)),
          (this.localAnchorB = this.bodyB.GetLocalPoint(o)),
          (this.localAxisA = this.bodyA.GetLocalVector(e)),
          (this.referenceAngle = this.bodyB.GetAngle() - this.bodyA.GetAngle());
      }),
      Box2D.inherit(D, Box2D.Dynamics.Joints.b2Joint),
      (D.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype),
      (D.b2PulleyJoint = function () {
        Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this, arguments),
          (this.m_groundAnchor1 = new s()),
          (this.m_groundAnchor2 = new s()),
          (this.m_localAnchor1 = new s()),
          (this.m_localAnchor2 = new s()),
          (this.m_u1 = new s()),
          (this.m_u2 = new s());
      }),
      (D.prototype.GetAnchorA = function () {
        return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
      }),
      (D.prototype.GetAnchorB = function () {
        return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
      }),
      (D.prototype.GetReactionForce = function (t) {
        return new s(t * this.m_impulse * this.m_u2.x, t * this.m_impulse * this.m_u2.y);
      }),
      (D.prototype.GetReactionTorque = function (t) {
        return 0;
      }),
      (D.prototype.GetGroundAnchorA = function () {
        let t = this.m_ground.m_xf.position.Copy();
        return t.Add(this.m_groundAnchor1), t;
      }),
      (D.prototype.GetGroundAnchorB = function () {
        let t = this.m_ground.m_xf.position.Copy();
        return t.Add(this.m_groundAnchor2), t;
      }),
      (D.prototype.GetLength1 = function () {
        let t = this.m_bodyA.GetWorldPoint(this.m_localAnchor1),
          i = this.m_ground.m_xf.position.x + this.m_groundAnchor1.x,
          o = this.m_ground.m_xf.position.y + this.m_groundAnchor1.y,
          e = t.x - i,
          s = t.y - o;
        return Math.sqrt(e * e + s * s);
      }),
      (D.prototype.GetLength2 = function () {
        let t = this.m_bodyB.GetWorldPoint(this.m_localAnchor2),
          i = this.m_ground.m_xf.position.x + this.m_groundAnchor2.x,
          o = this.m_ground.m_xf.position.y + this.m_groundAnchor2.y,
          e = t.x - i,
          s = t.y - o;
        return Math.sqrt(e * e + s * s);
      }),
      (D.prototype.GetRatio = function () {
        return this.m_ratio;
      }),
      (D.prototype.b2PulleyJoint = function (t) {
        this.__super.b2Joint.call(this, t),
          (this.m_ground = this.m_bodyA.m_world.m_groundBody),
          (this.m_groundAnchor1.x = t.groundAnchorA.x - this.m_ground.m_xf.position.x),
          (this.m_groundAnchor1.y = t.groundAnchorA.y - this.m_ground.m_xf.position.y),
          (this.m_groundAnchor2.x = t.groundAnchorB.x - this.m_ground.m_xf.position.x),
          (this.m_groundAnchor2.y = t.groundAnchorB.y - this.m_ground.m_xf.position.y),
          this.m_localAnchor1.SetV(t.localAnchorA),
          this.m_localAnchor2.SetV(t.localAnchorB),
          (this.m_ratio = t.ratio),
          (this.m_constant = t.lengthA + this.m_ratio * t.lengthB),
          (this.m_maxLength1 = Math.min(
            t.maxLengthA,
            this.m_constant - this.m_ratio * D.b2_minPulleyLength
          )),
          (this.m_maxLength2 = Math.min(
            t.maxLengthB,
            (this.m_constant - D.b2_minPulleyLength) / this.m_ratio
          )),
          (this.m_impulse = 0),
          (this.m_limitImpulse1 = 0),
          (this.m_limitImpulse2 = 0);
      }),
      (D.prototype.InitVelocityConstraints = function (i) {
        let o = this.m_bodyA,
          e = this.m_bodyB,
          s = o.m_xf.R,
          n = this.m_localAnchor1.x - o.m_sweep.localCenter.x,
          l = this.m_localAnchor1.y - o.m_sweep.localCenter.y,
          m = s.col1.x * n + s.col2.x * l;
        (l = s.col1.y * n + s.col2.y * l), (n = m), (s = e.m_xf.R);
        let r = this.m_localAnchor2.x - e.m_sweep.localCenter.x,
          a = this.m_localAnchor2.y - e.m_sweep.localCenter.y;
        (m = s.col1.x * r + s.col2.x * a), (a = s.col1.y * r + s.col2.y * a), (r = m);
        let _ = o.m_sweep.c.x + n,
          h = o.m_sweep.c.y + l,
          c = e.m_sweep.c.x + r,
          p = e.m_sweep.c.y + a,
          u = this.m_ground.m_xf.position.x + this.m_groundAnchor1.x,
          x = this.m_ground.m_xf.position.y + this.m_groundAnchor1.y,
          d = this.m_ground.m_xf.position.x + this.m_groundAnchor2.x,
          f = this.m_ground.m_xf.position.y + this.m_groundAnchor2.y;
        this.m_u1.Set(_ - u, h - x), this.m_u2.Set(c - d, p - f);
        let b = this.m_u1.Length(),
          B = this.m_u2.Length();
        b > t.b2_linearSlop ? this.m_u1.Multiply(1 / b) : this.m_u1.SetZero(),
          B > t.b2_linearSlop ? this.m_u2.Multiply(1 / B) : this.m_u2.SetZero(),
          this.m_constant - b - this.m_ratio * B > 0
            ? ((this.m_state = y.e_inactiveLimit), (this.m_impulse = 0))
            : (this.m_state = y.e_atUpperLimit),
          b < this.m_maxLength1
            ? ((this.m_limitState1 = y.e_inactiveLimit), (this.m_limitImpulse1 = 0))
            : (this.m_limitState1 = y.e_atUpperLimit),
          B < this.m_maxLength2
            ? ((this.m_limitState2 = y.e_inactiveLimit), (this.m_limitImpulse2 = 0))
            : (this.m_limitState2 = y.e_atUpperLimit);
        let A = n * this.m_u1.y - l * this.m_u1.x,
          D = r * this.m_u2.y - a * this.m_u2.x;
        if (
          ((this.m_limitMass1 = o.m_invMass + o.m_invI * A * A),
          (this.m_limitMass2 = e.m_invMass + e.m_invI * D * D),
          (this.m_pulleyMass = this.m_limitMass1 + this.m_ratio * this.m_ratio * this.m_limitMass2),
          (this.m_limitMass1 = 1 / this.m_limitMass1),
          (this.m_limitMass2 = 1 / this.m_limitMass2),
          (this.m_pulleyMass = 1 / this.m_pulleyMass),
          i.warmStarting)
        ) {
          (this.m_impulse *= i.dtRatio),
            (this.m_limitImpulse1 *= i.dtRatio),
            (this.m_limitImpulse2 *= i.dtRatio);
          let t = (-this.m_impulse - this.m_limitImpulse1) * this.m_u1.x,
            s = (-this.m_impulse - this.m_limitImpulse1) * this.m_u1.y,
            m = (-this.m_ratio * this.m_impulse - this.m_limitImpulse2) * this.m_u2.x,
            _ = (-this.m_ratio * this.m_impulse - this.m_limitImpulse2) * this.m_u2.y;
          (o.m_linearVelocity.x += o.m_invMass * t),
            (o.m_linearVelocity.y += o.m_invMass * s),
            (o.m_angularVelocity += o.m_invI * (n * s - l * t)),
            (e.m_linearVelocity.x += e.m_invMass * m),
            (e.m_linearVelocity.y += e.m_invMass * _),
            (e.m_angularVelocity += e.m_invI * (r * _ - a * m));
        } else (this.m_impulse = 0), (this.m_limitImpulse1 = 0), (this.m_limitImpulse2 = 0);
      }),
      (D.prototype.SolveVelocityConstraints = function (t) {
        let i = this.m_bodyA,
          o = this.m_bodyB,
          e = i.m_xf.R,
          s = this.m_localAnchor1.x - i.m_sweep.localCenter.x,
          n = this.m_localAnchor1.y - i.m_sweep.localCenter.y,
          l = e.col1.x * s + e.col2.x * n;
        (n = e.col1.y * s + e.col2.y * n), (s = l), (e = o.m_xf.R);
        let m = this.m_localAnchor2.x - o.m_sweep.localCenter.x,
          r = this.m_localAnchor2.y - o.m_sweep.localCenter.y;
        (l = e.col1.x * m + e.col2.x * r), (r = e.col1.y * m + e.col2.y * r), (m = l);
        let a = 0,
          _ = 0,
          h = 0,
          c = 0,
          p = 0,
          u = 0,
          x = 0,
          d = 0,
          f = 0,
          b = 0,
          B = 0;
        this.m_state === y.e_atUpperLimit &&
          ((a = i.m_linearVelocity.x + -i.m_angularVelocity * n),
          (_ = i.m_linearVelocity.y + i.m_angularVelocity * s),
          (h = o.m_linearVelocity.x + -o.m_angularVelocity * r),
          (c = o.m_linearVelocity.y + o.m_angularVelocity * m),
          (f =
            -(this.m_u1.x * a + this.m_u1.y * _) -
            this.m_ratio * (this.m_u2.x * h + this.m_u2.y * c)),
          (b = this.m_pulleyMass * -f),
          (B = this.m_impulse),
          (this.m_impulse = Math.max(0, this.m_impulse + b)),
          (p = -(b = this.m_impulse - B) * this.m_u1.x),
          (u = -b * this.m_u1.y),
          (x = -this.m_ratio * b * this.m_u2.x),
          (d = -this.m_ratio * b * this.m_u2.y),
          (i.m_linearVelocity.x += i.m_invMass * p),
          (i.m_linearVelocity.y += i.m_invMass * u),
          (i.m_angularVelocity += i.m_invI * (s * u - n * p)),
          (o.m_linearVelocity.x += o.m_invMass * x),
          (o.m_linearVelocity.y += o.m_invMass * d),
          (o.m_angularVelocity += o.m_invI * (m * d - r * x))),
          this.m_limitState1 === y.e_atUpperLimit &&
            ((a = i.m_linearVelocity.x + -i.m_angularVelocity * n),
            (_ = i.m_linearVelocity.y + i.m_angularVelocity * s),
            (f = -(this.m_u1.x * a + this.m_u1.y * _)),
            (b = -this.m_limitMass1 * f),
            (B = this.m_limitImpulse1),
            (this.m_limitImpulse1 = Math.max(0, this.m_limitImpulse1 + b)),
            (p = -(b = this.m_limitImpulse1 - B) * this.m_u1.x),
            (u = -b * this.m_u1.y),
            (i.m_linearVelocity.x += i.m_invMass * p),
            (i.m_linearVelocity.y += i.m_invMass * u),
            (i.m_angularVelocity += i.m_invI * (s * u - n * p))),
          this.m_limitState2 === y.e_atUpperLimit &&
            ((h = o.m_linearVelocity.x + -o.m_angularVelocity * r),
            (c = o.m_linearVelocity.y + o.m_angularVelocity * m),
            (f = -(this.m_u2.x * h + this.m_u2.y * c)),
            (b = -this.m_limitMass2 * f),
            (B = this.m_limitImpulse2),
            (this.m_limitImpulse2 = Math.max(0, this.m_limitImpulse2 + b)),
            (x = -(b = this.m_limitImpulse2 - B) * this.m_u2.x),
            (d = -b * this.m_u2.y),
            (o.m_linearVelocity.x += o.m_invMass * x),
            (o.m_linearVelocity.y += o.m_invMass * d),
            (o.m_angularVelocity += o.m_invI * (m * d - r * x)));
      }),
      (D.prototype.SolvePositionConstraints = function (i) {
        let o,
          s,
          n,
          l,
          m,
          r,
          a,
          _,
          h,
          c,
          p,
          u,
          x,
          d,
          f,
          b = this.m_bodyA,
          B = this.m_bodyB,
          A = this.m_ground.m_xf.position.x + this.m_groundAnchor1.x,
          D = this.m_ground.m_xf.position.y + this.m_groundAnchor1.y,
          C = this.m_ground.m_xf.position.x + this.m_groundAnchor2.x,
          w = this.m_ground.m_xf.position.y + this.m_groundAnchor2.y;
        return (
          this.m_state === y.e_atUpperLimit &&
            ((o = b.m_xf.R),
            (s = this.m_localAnchor1.x - b.m_sweep.localCenter.x),
            (n = this.m_localAnchor1.y - b.m_sweep.localCenter.y),
            (d = o.col1.x * s + o.col2.x * n),
            (n = o.col1.y * s + o.col2.y * n),
            (s = d),
            (o = B.m_xf.R),
            (l = this.m_localAnchor2.x - B.m_sweep.localCenter.x),
            (m = this.m_localAnchor2.y - B.m_sweep.localCenter.y),
            (d = o.col1.x * l + o.col2.x * m),
            (m = o.col1.y * l + o.col2.y * m),
            (l = d),
            (r = b.m_sweep.c.x + s),
            (a = b.m_sweep.c.y + n),
            (_ = B.m_sweep.c.x + l),
            (h = B.m_sweep.c.y + m),
            this.m_u1.Set(r - A, a - D),
            this.m_u2.Set(_ - C, h - w),
            (c = this.m_u1.Length()),
            (p = this.m_u2.Length()),
            c > t.b2_linearSlop ? this.m_u1.Multiply(1 / c) : this.m_u1.SetZero(),
            p > t.b2_linearSlop ? this.m_u2.Multiply(1 / p) : this.m_u2.SetZero(),
            (u = this.m_constant - c - this.m_ratio * p),
            (f = Math.max(f, -u)),
            (u = e.Clamp(u + t.b2_linearSlop, -t.b2_maxLinearCorrection, 0)),
            (r = -(x = -this.m_pulleyMass * u) * this.m_u1.x),
            (a = -x * this.m_u1.y),
            (_ = -this.m_ratio * x * this.m_u2.x),
            (h = -this.m_ratio * x * this.m_u2.y),
            (b.m_sweep.c.x += b.m_invMass * r),
            (b.m_sweep.c.y += b.m_invMass * a),
            (b.m_sweep.a += b.m_invI * (s * a - n * r)),
            (B.m_sweep.c.x += B.m_invMass * _),
            (B.m_sweep.c.y += B.m_invMass * h),
            (B.m_sweep.a += B.m_invI * (l * h - m * _)),
            b.SynchronizeTransform(),
            B.SynchronizeTransform()),
          this.m_limitState1 === y.e_atUpperLimit &&
            ((o = b.m_xf.R),
            (s = this.m_localAnchor1.x - b.m_sweep.localCenter.x),
            (n = this.m_localAnchor1.y - b.m_sweep.localCenter.y),
            (d = o.col1.x * s + o.col2.x * n),
            (n = o.col1.y * s + o.col2.y * n),
            (s = d),
            (r = b.m_sweep.c.x + s),
            (a = b.m_sweep.c.y + n),
            this.m_u1.Set(r - A, a - D),
            (c = this.m_u1.Length()) > t.b2_linearSlop
              ? ((this.m_u1.x *= 1 / c), (this.m_u1.y *= 1 / c))
              : this.m_u1.SetZero(),
            (u = this.m_maxLength1 - c),
            (f = Math.max(f, -u)),
            (u = e.Clamp(u + t.b2_linearSlop, -t.b2_maxLinearCorrection, 0)),
            (r = -(x = -this.m_limitMass1 * u) * this.m_u1.x),
            (a = -x * this.m_u1.y),
            (b.m_sweep.c.x += b.m_invMass * r),
            (b.m_sweep.c.y += b.m_invMass * a),
            (b.m_sweep.a += b.m_invI * (s * a - n * r)),
            b.SynchronizeTransform()),
          this.m_limitState2 === y.e_atUpperLimit &&
            ((o = B.m_xf.R),
            (l = this.m_localAnchor2.x - B.m_sweep.localCenter.x),
            (m = this.m_localAnchor2.y - B.m_sweep.localCenter.y),
            (d = o.col1.x * l + o.col2.x * m),
            (m = o.col1.y * l + o.col2.y * m),
            (l = d),
            (_ = B.m_sweep.c.x + l),
            (h = B.m_sweep.c.y + m),
            this.m_u2.Set(_ - C, h - w),
            (p = this.m_u2.Length()) > t.b2_linearSlop
              ? ((this.m_u2.x *= 1 / p), (this.m_u2.y *= 1 / p))
              : this.m_u2.SetZero(),
            (u = this.m_maxLength2 - p),
            (f = Math.max(f, -u)),
            (u = e.Clamp(u + t.b2_linearSlop, -t.b2_maxLinearCorrection, 0)),
            (_ = -(x = -this.m_limitMass2 * u) * this.m_u2.x),
            (h = -x * this.m_u2.y),
            (B.m_sweep.c.x += B.m_invMass * _),
            (B.m_sweep.c.y += B.m_invMass * h),
            (B.m_sweep.a += B.m_invI * (l * h - m * _)),
            B.SynchronizeTransform()),
          Math.abs(u) < m_tolerance
        );
      }),
      Box2D.postDefs.push(function () {
        Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength = 2;
      }),
      Box2D.inherit(C, Box2D.Dynamics.Joints.b2JointDef),
      (C.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype),
      (C.b2PulleyJointDef = function () {
        Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this, arguments),
          (this.groundAnchorA = new s()),
          (this.groundAnchorB = new s()),
          (this.localAnchorA = new s()),
          (this.localAnchorB = new s());
      }),
      (C.prototype.b2PulleyJointDef = function () {
        this.__super.b2JointDef.call(this),
          (this.type = y.e_pulleyJoint),
          this.groundAnchorA.Set(-1, 1),
          this.groundAnchorB.Set(1, 1),
          this.localAnchorA.Set(-1, 0),
          this.localAnchorB.Set(1, 0),
          (this.lengthA = 0),
          (this.maxLengthA = 0),
          (this.lengthB = 0),
          (this.maxLengthB = 0),
          (this.ratio = 1),
          (this.collideConnected = !0);
      }),
      (C.prototype.Initialize = function (t, i, o, e, s, n, l) {
        void 0 === l && (l = 0),
          (this.bodyA = t),
          (this.bodyB = i),
          this.groundAnchorA.SetV(o),
          this.groundAnchorB.SetV(e),
          (this.localAnchorA = this.bodyA.GetLocalPoint(s)),
          (this.localAnchorB = this.bodyB.GetLocalPoint(n));
        let m = s.x - o.x,
          r = s.y - o.y;
        this.lengthA = Math.sqrt(m * m + r * r);
        let a = n.x - e.x,
          _ = n.y - e.y;
        (this.lengthB = Math.sqrt(a * a + _ * _)), (this.ratio = l);
        let h = this.lengthA + this.ratio * this.lengthB;
        (this.maxLengthA = h - this.ratio * D.b2_minPulleyLength),
          (this.maxLengthB = (h - D.b2_minPulleyLength) / this.ratio);
      }),
      Box2D.inherit(w, Box2D.Dynamics.Joints.b2Joint),
      (w.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype),
      (w.prototype.GetAnchorA = function () {
        return this.m_bodyA.GetWorldPoint(this.m_localAnchor1);
      }),
      (w.prototype.GetAnchorB = function () {
        return this.m_bodyB.GetWorldPoint(this.m_localAnchor2);
      }),
      (w.prototype.GetReactionForce = function (t) {
        return new s(t * this.m_impulse.x, t * this.m_impulse.y);
      }),
      (w.prototype.GetReactionTorque = function (t) {
        return t * this.m_impulse.z;
      }),
      (w.prototype.GetJointAngle = function () {
        return this.m_bodyB.m_sweep.a - this.m_bodyA.m_sweep.a - this.m_referenceAngle;
      }),
      (w.prototype.GetJointSpeed = function () {
        return this.m_bodyB.m_angularVelocity - this.m_bodyA.m_angularVelocity;
      }),
      (w.prototype.IsLimitEnabled = function () {
        return this.m_enableLimit;
      }),
      (w.prototype.EnableLimit = function (t) {
        this.m_enableLimit = t;
      }),
      (w.prototype.GetLowerLimit = function () {
        return this.m_lowerAngle;
      }),
      (w.prototype.GetUpperLimit = function () {
        return this.m_upperAngle;
      }),
      (w.prototype.SetLimits = function (t, i) {
        void 0 === t && (t = 0),
          void 0 === i && (i = 0),
          (this.m_lowerAngle = t),
          (this.m_upperAngle = i);
      }),
      (w.prototype.IsMotorEnabled = function () {
        return this.m_enableMotor;
      }),
      (w.prototype.EnableMotor = function (t) {
        this.m_enableMotor = t;
      }),
      (w.prototype.SetMotorSpeed = function (t) {
        this.m_motorSpeed = t;
      }),
      (w.prototype.GetMotorSpeed = function () {
        return this.m_motorSpeed;
      }),
      (w.prototype.SetMaxMotorTorque = function (t) {
        this.m_maxMotorTorque = t;
      }),
      (w.prototype.GetMotorTorque = function () {
        return this.m_maxMotorTorque;
      }),
      (w.prototype.InitVelocityConstraints = function (i) {
        let o = this.m_bodyA,
          e = this.m_bodyB,
          s = o.m_xf.R,
          n = this.m_localAnchor1.x - o.m_sweep.localCenter.x,
          l = this.m_localAnchor1.y - o.m_sweep.localCenter.y,
          m = s.col1.x * n + s.col2.x * l;
        (l = s.col1.y * n + s.col2.y * l), (n = m), (s = e.m_xf.R);
        let r = this.m_localAnchor2.x - e.m_sweep.localCenter.x,
          a = this.m_localAnchor2.y - e.m_sweep.localCenter.y;
        (m = s.col1.x * r + s.col2.x * a), (a = s.col1.y * r + s.col2.y * a), (r = m);
        let _ = o.m_invMass,
          h = e.m_invMass,
          c = o.m_invI,
          p = e.m_invI;
        if (
          ((this.m_mass.col1.x = _ + h + l * l * c + a * a * p),
          (this.m_mass.col2.x = -l * n * c - a * r * p),
          (this.m_mass.col3.x = -l * c - a * p),
          (this.m_mass.col1.y = this.m_mass.col2.x),
          (this.m_mass.col2.y = _ + h + n * n * c + r * r * p),
          (this.m_mass.col3.y = n * c + r * p),
          (this.m_mass.col1.z = this.m_mass.col3.x),
          (this.m_mass.col2.z = this.m_mass.col3.y),
          (this.m_mass.col3.z = c + p),
          (this.m_motorMass = 1 / (c + p)),
          this.m_enableMotor || (this.m_motorImpulse = 0),
          this.m_enableLimit)
        ) {
          let i = e.m_sweep.a - o.m_sweep.a - this.m_referenceAngle;
          Math.abs(this.m_upperAngle - this.m_lowerAngle) < 2 * t.b2_angularSlop
            ? (this.m_limitState = y.e_equalLimits)
            : i <= this.m_lowerAngle
            ? (this.m_limitState !== y.e_atLowerLimit && (this.m_impulse.z = 0),
              (this.m_limitState = y.e_atLowerLimit))
            : i >= this.m_upperAngle
            ? (this.m_limitState !== y.e_atUpperLimit && (this.m_impulse.z = 0),
              (this.m_limitState = y.e_atUpperLimit))
            : ((this.m_limitState = y.e_inactiveLimit), (this.m_impulse.z = 0));
        } else this.m_limitState = y.e_inactiveLimit;
        if (i.warmStarting) {
          (this.m_impulse.x *= i.dtRatio),
            (this.m_impulse.y *= i.dtRatio),
            (this.m_motorImpulse *= i.dtRatio);
          let t = this.m_impulse.x,
            s = this.m_impulse.y;
          (o.m_linearVelocity.x -= _ * t),
            (o.m_linearVelocity.y -= _ * s),
            (o.m_angularVelocity -= c * (n * s - l * t + this.m_motorImpulse + this.m_impulse.z)),
            (e.m_linearVelocity.x += h * t),
            (e.m_linearVelocity.y += h * s),
            (e.m_angularVelocity += p * (r * s - a * t + this.m_motorImpulse + this.m_impulse.z));
        } else this.m_impulse.SetZero(), (this.m_motorImpulse = 0);
      }),
      (w.prototype.SolveVelocityConstraints = function (t) {
        let i = this.m_bodyA,
          o = this.m_bodyB,
          s = i.m_linearVelocity,
          n = i.m_angularVelocity,
          l = o.m_linearVelocity,
          m = o.m_angularVelocity,
          r = i.m_invMass,
          a = o.m_invMass,
          _ = i.m_invI,
          h = o.m_invI;
        if (this.m_enableMotor && this.m_limitState !== y.e_equalLimits) {
          let i = m - n - this.m_motorSpeed,
            o = this.m_motorMass * -i,
            s = this.m_motorImpulse,
            l = t.dt * this.m_maxMotorTorque;
          (this.m_motorImpulse = e.Clamp(this.m_motorImpulse + o, -l, l)),
            (n -= _ * (o = this.m_motorImpulse - s)),
            (m += h * o);
        }
        if (this.m_enableLimit && this.m_limitState !== y.e_inactiveLimit) {
          let t = i.m_xf.R,
            e = this.m_localAnchor1.x - i.m_sweep.localCenter.x,
            c = this.m_localAnchor1.y - i.m_sweep.localCenter.y,
            p = t.col1.x * e + t.col2.x * c;
          (c = t.col1.y * e + t.col2.y * c), (e = p), (t = o.m_xf.R);
          let u = this.m_localAnchor2.x - o.m_sweep.localCenter.x,
            x = this.m_localAnchor2.y - o.m_sweep.localCenter.y;
          (p = t.col1.x * u + t.col2.x * x), (x = t.col1.y * u + t.col2.y * x), (u = p);
          let d = l.x + -m * x - s.x - -n * c,
            f = l.y + m * u - s.y - n * e,
            b = m - n;
          if (
            (this.m_mass.Solve33(this.impulse3, -d, -f, -b), this.m_limitState === y.e_equalLimits)
          )
            this.m_impulse.Add(this.impulse3);
          else if (this.m_limitState === y.e_atLowerLimit) {
            this.m_impulse.z + this.impulse3.z < 0 &&
              (this.m_mass.Solve22(this.reduced, -d, -f),
              (this.impulse3.x = this.reduced.x),
              (this.impulse3.y = this.reduced.y),
              (this.impulse3.z = -this.m_impulse.z),
              (this.m_impulse.x += this.reduced.x),
              (this.m_impulse.y += this.reduced.y),
              (this.m_impulse.z = 0));
          } else if (this.m_limitState === y.e_atUpperLimit) {
            this.m_impulse.z + this.impulse3.z > 0 &&
              (this.m_mass.Solve22(this.reduced, -d, -f),
              (this.impulse3.x = this.reduced.x),
              (this.impulse3.y = this.reduced.y),
              (this.impulse3.z = -this.m_impulse.z),
              (this.m_impulse.x += this.reduced.x),
              (this.m_impulse.y += this.reduced.y),
              (this.m_impulse.z = 0));
          }
          (s.x -= r * this.impulse3.x),
            (s.y -= r * this.impulse3.y),
            (n -= _ * (e * this.impulse3.y - c * this.impulse3.x + this.impulse3.z)),
            (l.x += a * this.impulse3.x),
            (l.y += a * this.impulse3.y),
            (m += h * (u * this.impulse3.y - x * this.impulse3.x + this.impulse3.z));
        } else {
          let t = i.m_xf.R,
            e = this.m_localAnchor1.x - i.m_sweep.localCenter.x,
            c = this.m_localAnchor1.y - i.m_sweep.localCenter.y,
            y = t.col1.x * e + t.col2.x * c;
          (c = t.col1.y * e + t.col2.y * c), (e = y), (t = o.m_xf.R);
          let p = this.m_localAnchor2.x - o.m_sweep.localCenter.x,
            u = this.m_localAnchor2.y - o.m_sweep.localCenter.y;
          (y = t.col1.x * p + t.col2.x * u), (u = t.col1.y * p + t.col2.y * u), (p = y);
          let x = l.x + -m * u - s.x - -n * c,
            d = l.y + m * p - s.y - n * e;
          this.m_mass.Solve22(this.impulse2, -x, -d),
            (this.m_impulse.x += this.impulse2.x),
            (this.m_impulse.y += this.impulse2.y),
            (s.x -= r * this.impulse2.x),
            (s.y -= r * this.impulse2.y),
            (n -= _ * (e * this.impulse2.y - c * this.impulse2.x)),
            (l.x += a * this.impulse2.x),
            (l.y += a * this.impulse2.y),
            (m += h * (p * this.impulse2.y - u * this.impulse2.x));
        }
        (i.m_linearVelocity.x = s.x),
          (i.m_linearVelocity.y = s.y),
          (i.m_angularVelocity = n),
          (o.m_linearVelocity.x = l.x),
          (o.m_linearVelocity.y = l.y),
          (o.m_angularVelocity = m);
      }),
      (w.prototype.SolvePositionConstraints = function () {
        let i = 0,
          o = this.m_bodyA,
          s = this.m_bodyB,
          n = 0,
          l = 0;
        if (this.m_enableLimit && this.m_limitState !== y.e_inactiveLimit) {
          let l = s.m_sweep.a - o.m_sweep.a - this.m_referenceAngle,
            m = 0;
          this.m_limitState === y.e_equalLimits
            ? ((i = e.Clamp(
                l - this.m_lowerAngle,
                -t.b2_maxAngularCorrection,
                t.b2_maxAngularCorrection
              )),
              (m = -this.m_motorMass * i),
              (n = Math.abs(i)))
            : this.m_limitState === y.e_atLowerLimit
            ? ((n = -(i = l - this.m_lowerAngle)),
              (i = e.Clamp(i + t.b2_angularSlop, -t.b2_maxAngularCorrection, 0)),
              (m = -this.m_motorMass * i))
            : this.m_limitState === y.e_atUpperLimit &&
              ((n = i = l - this.m_upperAngle),
              (i = e.Clamp(i - t.b2_angularSlop, 0, t.b2_maxAngularCorrection)),
              (m = -this.m_motorMass * i)),
            (o.m_sweep.a -= o.m_invI * m),
            (s.m_sweep.a += s.m_invI * m);
        }
        {
          let i = o.m_xf.R,
            e = this.m_localAnchor1.x - o.m_sweep.localCenter.x,
            n = this.m_localAnchor1.y - o.m_sweep.localCenter.y,
            m = i.col1.x * e + i.col2.x * n;
          (n = i.col1.y * e + i.col2.y * n), (e = m), (i = s.m_xf.R);
          let r = this.m_localAnchor2.x - s.m_sweep.localCenter.x,
            a = this.m_localAnchor2.y - s.m_sweep.localCenter.y;
          (m = i.col1.x * r + i.col2.x * a), (a = i.col1.y * r + i.col2.y * a), (r = m);
          let _ = s.m_sweep.c.x + r - o.m_sweep.c.x - e,
            h = s.m_sweep.c.y + a - o.m_sweep.c.y - n;
          l = _ * _ + h * h;
          let c,
            y,
            p = o.m_invMass,
            u = s.m_invMass,
            x = o.m_invI,
            d = s.m_invI,
            f = 10 * t.b2_linearSlop;
          if (l > f * f) {
            let t = 1 / (p + u);
            (c = t * -_),
              (y = t * -h),
              (o.m_sweep.c.x -= 0.5 * p * c),
              (o.m_sweep.c.y -= 0.5 * p * y),
              (s.m_sweep.c.x += 0.5 * u * c),
              (s.m_sweep.c.y += 0.5 * u * y),
              (_ = s.m_sweep.c.x + r - o.m_sweep.c.x - e),
              (h = s.m_sweep.c.y + a - o.m_sweep.c.y - n);
          }
          let b = this.K;
          (b.col1.x = p + u + x * n * n + d * a * a),
            (b.col1.y = -x * e * n + -d * r * a),
            (b.col2.x = b.col1.y),
            (b.col2.y = p + u + x * e * e + d * r * r),
            b.Solve(w.tImpulse, -_, -h),
            (c = w.tImpulse.x),
            (y = w.tImpulse.y),
            (o.m_sweep.c.x -= o.m_invMass * c),
            (o.m_sweep.c.y -= o.m_invMass * y),
            (o.m_sweep.a -= o.m_invI * (e * y - n * c)),
            (s.m_sweep.c.x += s.m_invMass * c),
            (s.m_sweep.c.y += s.m_invMass * y),
            (s.m_sweep.a += s.m_invI * (r * y - a * c));
        }
        return (
          o.SynchronizeTransform(),
          s.SynchronizeTransform(),
          l <= t.b2_linearSlop * t.b2_linearSlop && n <= t.b2_angularSlop
        );
      }),
      Box2D.postDefs.push(function () {
        Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse = new s();
      }),
      Box2D.inherit(v, Box2D.Dynamics.Joints.b2JointDef),
      (v.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype),
      (v.prototype.Initialize = function (t, i, o) {
        (this.bodyA = t),
          (this.bodyB = i),
          (this.localAnchorA = this.bodyA.GetLocalPoint(o)),
          (this.localAnchorB = this.bodyB.GetLocalPoint(o)),
          (this.referenceAngle = this.bodyB.GetAngle() - this.bodyA.GetAngle());
      }),
      Box2D.inherit(g, Box2D.Dynamics.Joints.b2Joint),
      (v.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype),
      (g.prototype.__super = Box2D.Dynamics.Joints.b2Joint.prototype),
      (g.prototype.GetAnchorA = function () {
        return this.m_bodyA.GetWorldPoint(this.m_localAnchorA);
      }),
      (g.prototype.GetAnchorB = function () {
        return this.m_bodyB.GetWorldPoint(this.m_localAnchorB);
      }),
      (g.prototype.GetReactionForce = function (t) {
        return new s(t * this.m_impulse.x, t * this.m_impulse.y);
      }),
      (g.prototype.GetReactionTorque = function (t) {
        return t * this.m_impulse.z;
      }),
      (g.prototype.InitVelocityConstraints = function (t) {
        let i = this.m_bodyA,
          o = this.m_bodyB,
          e = i.m_xf.R,
          s = this.m_localAnchorA.x - i.m_sweep.localCenter.x,
          n = this.m_localAnchorA.y - i.m_sweep.localCenter.y,
          l = e.col1.x * s + e.col2.x * n;
        (n = e.col1.y * s + e.col2.y * n), (s = l), (e = o.m_xf.R);
        let m = this.m_localAnchorB.x - o.m_sweep.localCenter.x,
          r = this.m_localAnchorB.y - o.m_sweep.localCenter.y;
        (l = e.col1.x * m + e.col2.x * r), (r = e.col1.y * m + e.col2.y * r), (m = l);
        let a = i.m_invMass,
          _ = o.m_invMass,
          h = i.m_invI,
          c = o.m_invI;
        (this.m_mass.col1.x = a + _ + n * n * h + r * r * c),
          (this.m_mass.col2.x = -n * s * h - r * m * c),
          (this.m_mass.col3.x = -n * h - r * c),
          (this.m_mass.col1.y = this.m_mass.col2.x),
          (this.m_mass.col2.y = a + _ + s * s * h + m * m * c),
          (this.m_mass.col3.y = s * h + m * c),
          (this.m_mass.col1.z = this.m_mass.col3.x),
          (this.m_mass.col2.z = this.m_mass.col3.y),
          (this.m_mass.col3.z = h + c),
          t.warmStarting
            ? ((this.m_impulse.x *= t.dtRatio),
              (this.m_impulse.y *= t.dtRatio),
              (this.m_impulse.z *= t.dtRatio),
              (i.m_linearVelocity.x -= a * this.m_impulse.x),
              (i.m_linearVelocity.y -= a * this.m_impulse.y),
              (i.m_angularVelocity -=
                h * (s * this.m_impulse.y - n * this.m_impulse.x + this.m_impulse.z)),
              (o.m_linearVelocity.x += _ * this.m_impulse.x),
              (o.m_linearVelocity.y += _ * this.m_impulse.y),
              (o.m_angularVelocity +=
                c * (m * this.m_impulse.y - r * this.m_impulse.x + this.m_impulse.z)))
            : this.m_impulse.SetZero();
      }),
      (g.prototype.SolveVelocityConstraints = function () {
        let t = this.m_bodyA,
          i = this.m_bodyB,
          o = t.m_linearVelocity,
          e = t.m_angularVelocity,
          s = i.m_linearVelocity,
          l = i.m_angularVelocity,
          m = t.m_invMass,
          r = i.m_invMass,
          a = t.m_invI,
          _ = i.m_invI,
          h = t.m_xf.R,
          c = this.m_localAnchorA.x - t.m_sweep.localCenter.x,
          y = this.m_localAnchorA.y - t.m_sweep.localCenter.y,
          p = h.col1.x * c + h.col2.x * y;
        (y = h.col1.y * c + h.col2.y * y), (c = p), (h = i.m_xf.R);
        let u = this.m_localAnchorB.x - i.m_sweep.localCenter.x,
          x = this.m_localAnchorB.y - i.m_sweep.localCenter.y;
        (p = h.col1.x * u + h.col2.x * x), (x = h.col1.y * u + h.col2.y * x), (u = p);
        let d = s.x - l * x - o.x + e * y,
          f = s.y + l * u - o.y - e * c,
          b = l - e,
          B = new n(0, 0, 0);
        this.m_mass.Solve33(B, -d, -f, -b),
          this.m_impulse.Add(B),
          (o.x -= m * B.x),
          (o.y -= m * B.y),
          (e -= a * (c * B.y - y * B.x + B.z)),
          (s.x += r * B.x),
          (s.y += r * B.y),
          (l += _ * (u * B.y - x * B.x + B.z)),
          (t.m_angularVelocity = e),
          (i.m_angularVelocity = l);
      }),
      (g.prototype.SolvePositionConstraints = function () {
        let i = this.m_bodyA,
          o = this.m_bodyB,
          e = i.m_xf.R,
          s = this.m_localAnchorA.x - i.m_sweep.localCenter.x,
          l = this.m_localAnchorA.y - i.m_sweep.localCenter.y,
          m = e.col1.x * s + e.col2.x * l;
        (l = e.col1.y * s + e.col2.y * l), (s = m), (e = o.m_xf.R);
        let r = this.m_localAnchorB.x - o.m_sweep.localCenter.x,
          a = this.m_localAnchorB.y - o.m_sweep.localCenter.y;
        (m = e.col1.x * r + e.col2.x * a), (a = e.col1.y * r + e.col2.y * a), (r = m);
        let _ = i.m_invMass,
          h = o.m_invMass,
          c = i.m_invI,
          y = o.m_invI,
          p = o.m_sweep.c.x + r - i.m_sweep.c.x - s,
          u = o.m_sweep.c.y + a - i.m_sweep.c.y - l,
          x = o.m_sweep.a - i.m_sweep.a - this.m_referenceAngle,
          d = 10 * t.b2_linearSlop,
          f = p * p + u * u,
          b = Math.abs(x);
        f > d * d && ((c *= 1), (y *= 1)),
          (this.m_mass.col1.x = _ + h + l * l * c + a * a * y),
          (this.m_mass.col2.x = -l * s * c - a * r * y),
          (this.m_mass.col3.x = -l * c - a * y),
          (this.m_mass.col1.y = this.m_mass.col2.x),
          (this.m_mass.col2.y = _ + h + s * s * c + r * r * y),
          (this.m_mass.col3.y = s * c + r * y),
          (this.m_mass.col1.z = this.m_mass.col3.x),
          (this.m_mass.col2.z = this.m_mass.col3.y),
          (this.m_mass.col3.z = c + y);
        let B = new n(0, 0, 0);
        return (
          this.m_mass.Solve33(B, -p, -u, -x),
          (i.m_sweep.c.x -= _ * B.x),
          (i.m_sweep.c.y -= _ * B.y),
          (i.m_sweep.a -= c * (s * B.y - l * B.x + B.z)),
          (o.m_sweep.c.x += h * B.x),
          (o.m_sweep.c.y += h * B.y),
          (o.m_sweep.a += y * (r * B.y - a * B.x + B.z)),
          i.SynchronizeTransform(),
          o.SynchronizeTransform(),
          f <= t.b2_linearSlop * t.b2_linearSlop && b <= t.b2_angularSlop
        );
      }),
      Box2D.inherit(S, Box2D.Dynamics.Joints.b2JointDef),
      (S.prototype.__super = Box2D.Dynamics.Joints.b2JointDef.prototype),
      (S.prototype.Initialize = function (t, i, o) {
        (this.bodyA = t),
          (this.bodyB = i),
          this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),
          this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o)),
          (this.referenceAngle = this.bodyB.GetAngle() - this.bodyA.GetAngle());
      });
  })();
for (let t = 0; t < Box2D.postDefs.length; ++t) Box2D.postDefs[t]();
delete Box2D.postDefs,
  (Box2D.b2AABB = Box2D.Collision.b2AABB),
  (Box2D.b2BodyDef = Box2D.Dynamics.b2BodyDef),
  (Box2D.b2Body = Box2D.Dynamics.b2Body),
  (Box2D.b2FixtureDef = Box2D.Dynamics.b2FixtureDef),
  (Box2D.b2Fixture = Box2D.Dynamics.b2Fixture),
  (Box2D.b2World = Box2D.Dynamics.b2World),
  (Box2D.b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape),
  (Box2D.b2CircleShape = Box2D.Collision.Shapes.b2CircleShape),
  (Box2D.b2ContactListener = Box2D.Dynamics.b2ContactListener),
  (Box2D.b2DestructionListener = Box2D.Dynamics.b2DestructionListener),
  (Box2D.b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape),
  (Box2D.b2CircleShape = Box2D.Collision.Shapes.b2CircleShape),
  (Box2D.b2FilterData = Box2D.Dynamics.b2FixtureDef),
  (Box2D.b2Joint = Box2D.Dynamics.Joints.b2Joint),
  (Box2D.b2RevoluteJointDef = Box2D.Dynamics.Joints.b2RevoluteJointDef),
  (Box2D.b2WeldJointDef = Box2D.Dynamics.Joints.b2WeldJointDef),
  (Box2D.b2Vec2 = Box2D.Common.Math.b2Vec2),
  (Box2D.b2Transform = Box2D.Common.Math.b2Transform),
  (Box2D.b2BodyType = {
    b2_staticBody: Box2D.b2Body.b2_staticBody,
    b2_kinematicBody: Box2D.b2Body.b2_kinematicBody,
    b2_dynamicBody: Box2D.b2Body.b2_dynamicBody,
    b2_particleBody: Box2D.b2Body.b2_particleBody,
  });
var Cp = Object.defineProperty,
  Dp = Object.defineProperties;
var Pp = Object.getOwnPropertyDescriptors;
var br = Object.getOwnPropertySymbols;
var eh = Object.prototype.hasOwnProperty,
  ih = Object.prototype.propertyIsEnumerable;
var th = (m, ut, _t) =>
    ut in m
      ? Cp(m, ut, { enumerable: !0, configurable: !0, writable: !0, value: _t })
      : (m[ut] = _t),
  ne = (m, ut) => {
    for (var _t in ut || (ut = {})) eh.call(ut, _t) && th(m, _t, ut[_t]);
    if (br) for (var _t of br(ut)) ih.call(ut, _t) && th(m, _t, ut[_t]);
    return m;
  },
  gn = (m, ut) => Dp(m, Pp(ut));
var rh = (m, ut) => {
  var _t = {};
  for (var At in m) eh.call(m, At) && ut.indexOf(At) < 0 && (_t[At] = m[At]);
  if (m != null && br)
    for (var At of br(m)) ut.indexOf(At) < 0 && ih.call(m, At) && (_t[At] = m[At]);
  return _t;
};
/*!
 * pixi.js - v7.0.0-alpha
 * Compiled Fri, 09 Sep 2022 16:09:18 UTC
 *
 * pixi.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */ var PIXI = (function (m) {
  "use strict";
  /*!
   * @pixi/settings - v7.0.0-alpha
   * Compiled Fri, 09 Sep 2022 16:09:18 UTC
   *
   * @pixi/settings is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */ /*!
   * @pixi/constants - v7.0.0-alpha
   * Compiled Fri, 09 Sep 2022 16:09:18 UTC
   *
   * @pixi/constants is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */ var ut = ((i) => ((i[(i.NEAREST = 0)] = "NEAREST"), (i[(i.LINEAR = 1)] = "LINEAR"), i))(
      ut || {}
    ),
    _t = ((i) => (
      (i[(i.CLAMP = 33071)] = "CLAMP"),
      (i[(i.REPEAT = 10497)] = "REPEAT"),
      (i[(i.MIRRORED_REPEAT = 33648)] = "MIRRORED_REPEAT"),
      i
    ))(_t || {}),
    At = ((i) => (
      (i[(i.OFF = 0)] = "OFF"),
      (i[(i.POW2 = 1)] = "POW2"),
      (i[(i.ON = 2)] = "ON"),
      (i[(i.ON_MANUAL = 3)] = "ON_MANUAL"),
      i
    ))(At || {}),
    xn = ((i) => ((i[(i.AUTO = 0)] = "AUTO"), (i[(i.MANUAL = 1)] = "MANUAL"), i))(xn || {}),
    vi = ((i) => ((i.LOW = "lowp"), (i.MEDIUM = "mediump"), (i.HIGH = "highp"), i))(vi || {}),
    Tn = ((i) => (
      (i[(i.NONE = 0)] = "NONE"),
      (i[(i.LOW = 2)] = "LOW"),
      (i[(i.MEDIUM = 4)] = "MEDIUM"),
      (i[(i.HIGH = 8)] = "HIGH"),
      i
    ))(Tn || {});
  const yn = {
    createCanvas: (i, t) => {
      const e = document.createElement("canvas");
      return (e.width = i), (e.height = t), e;
    },
    getWebGLRenderingContext: () => WebGLRenderingContext,
    getNavigator: () => navigator,
    getBaseUrl: () => {
      var i;
      return (i = document.baseURI) != null ? i : window.location.href;
    },
    fetch: (i, t) => fetch(i, t),
  };
  var Er = /iPhone/i,
    vn = /iPod/i,
    bn = /iPad/i,
    En = /\biOS-universal(?:.+)Mac\b/i,
    Ar = /\bAndroid(?:.+)Mobile\b/i,
    An = /Android/i,
    we = /(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,
    bi = /Silk/i,
    Yt = /Windows Phone/i,
    Rn = /\bWindows(?:.+)ARM\b/i,
    Sn = /BlackBerry/i,
    In = /BB10/i,
    wn = /Opera Mini/i,
    Mn = /\b(CriOS|Chrome)(?:.+)Mobile/i,
    Cn = /Mobile(?:.+)Firefox\b/i,
    Dn = function (i) {
      return (
        typeof i < "u" &&
        i.platform === "MacIntel" &&
        typeof i.maxTouchPoints == "number" &&
        i.maxTouchPoints > 1 &&
        typeof MSStream > "u"
      );
    };
  function sh(i) {
    return function (t) {
      return t.test(i);
    };
  }
  function nh(i) {
    var t = { userAgent: "", platform: "", maxTouchPoints: 0 };
    !i && typeof navigator < "u"
      ? (t = {
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          maxTouchPoints: navigator.maxTouchPoints || 0,
        })
      : typeof i == "string"
      ? (t.userAgent = i)
      : i &&
        i.userAgent &&
        (t = {
          userAgent: i.userAgent,
          platform: i.platform,
          maxTouchPoints: i.maxTouchPoints || 0,
        });
    var e = t.userAgent,
      r = e.split("[FBAN");
    typeof r[1] < "u" && (e = r[0]), (r = e.split("Twitter")), typeof r[1] < "u" && (e = r[0]);
    var s = sh(e),
      n = {
        apple: {
          phone: s(Er) && !s(Yt),
          ipod: s(vn),
          tablet: !s(Er) && (s(bn) || Dn(t)) && !s(Yt),
          universal: s(En),
          device: (s(Er) || s(vn) || s(bn) || s(En) || Dn(t)) && !s(Yt),
        },
        amazon: { phone: s(we), tablet: !s(we) && s(bi), device: s(we) || s(bi) },
        android: {
          phone: (!s(Yt) && s(we)) || (!s(Yt) && s(Ar)),
          tablet: !s(Yt) && !s(we) && !s(Ar) && (s(bi) || s(An)),
          device: (!s(Yt) && (s(we) || s(bi) || s(Ar) || s(An))) || s(/\bokhttp\b/i),
        },
        windows: { phone: s(Yt), tablet: s(Rn), device: s(Yt) || s(Rn) },
        other: {
          blackberry: s(Sn),
          blackberry10: s(In),
          opera: s(wn),
          firefox: s(Cn),
          chrome: s(Mn),
          device: s(Sn) || s(In) || s(wn) || s(Cn) || s(Mn),
        },
        any: !1,
        phone: !1,
        tablet: !1,
      };
    return (
      (n.any = n.apple.device || n.android.device || n.windows.device || n.other.device),
      (n.phone = n.apple.phone || n.android.phone || n.windows.phone),
      (n.tablet = n.apple.tablet || n.android.tablet || n.windows.tablet),
      n
    );
  }
  const Ct = nh(globalThis.navigator);
  function ah() {
    return !Ct.apple.device;
  }
  function oh(i) {
    let t = !0;
    if (Ct.tablet || Ct.phone) {
      if (Ct.apple.device) {
        const e = navigator.userAgent.match(/OS (\d+)_(\d+)?/);
        e && parseInt(e[1], 10) < 11 && (t = !1);
      }
      if (Ct.android.device) {
        const e = navigator.userAgent.match(/Android\s([0-9.]*)/);
        e && parseInt(e[1], 10) < 7 && (t = !1);
      }
    }
    return t ? i : 4;
  }
  const A = {
    ADAPTER: yn,
    MIPMAP_TEXTURES: At.POW2,
    ANISOTROPIC_LEVEL: 0,
    RESOLUTION: 1,
    FILTER_RESOLUTION: 1,
    FILTER_MULTISAMPLE: Tn.NONE,
    SPRITE_MAX_TEXTURES: oh(32),
    SPRITE_BATCH_SIZE: 4096,
    RENDER_OPTIONS: {
      view: null,
      antialias: !1,
      autoDensity: !1,
      backgroundColor: 0,
      backgroundAlpha: 1,
      useContextAlpha: !0,
      clearBeforeRender: !0,
      preserveDrawingBuffer: !1,
      width: 800,
      height: 600,
      legacy: !1,
    },
    GC_MODE: xn.AUTO,
    GC_MAX_IDLE: 60 * 60,
    GC_MAX_CHECK_COUNT: 60 * 10,
    WRAP_MODE: _t.CLAMP,
    SCALE_MODE: ut.LINEAR,
    PRECISION_VERTEX: vi.HIGH,
    PRECISION_FRAGMENT: Ct.apple.device ? vi.HIGH : vi.MEDIUM,
    CAN_UPLOAD_SAME_BUFFER: ah(),
    CREATE_IMAGE_BITMAP: !1,
    ROUND_PIXELS: !1,
  };
  /*!
   * @pixi/constants - v7.0.0-alpha
   * Compiled Fri, 09 Sep 2022 16:09:18 UTC
   *
   * @pixi/constants is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */ var ae = ((i) => (
      (i[(i.WEBGL_LEGACY = 0)] = "WEBGL_LEGACY"),
      (i[(i.WEBGL = 1)] = "WEBGL"),
      (i[(i.WEBGL2 = 2)] = "WEBGL2"),
      i
    ))(ae || {}),
    Pn = ((i) => (
      (i[(i.UNKNOWN = 0)] = "UNKNOWN"),
      (i[(i.WEBGL = 1)] = "WEBGL"),
      (i[(i.CANVAS = 2)] = "CANVAS"),
      i
    ))(Pn || {}),
    Ei = ((i) => (
      (i[(i.COLOR = 16384)] = "COLOR"),
      (i[(i.DEPTH = 256)] = "DEPTH"),
      (i[(i.STENCIL = 1024)] = "STENCIL"),
      i
    ))(Ei || {}),
    G = ((i) => (
      (i[(i.NORMAL = 0)] = "NORMAL"),
      (i[(i.ADD = 1)] = "ADD"),
      (i[(i.MULTIPLY = 2)] = "MULTIPLY"),
      (i[(i.SCREEN = 3)] = "SCREEN"),
      (i[(i.OVERLAY = 4)] = "OVERLAY"),
      (i[(i.DARKEN = 5)] = "DARKEN"),
      (i[(i.LIGHTEN = 6)] = "LIGHTEN"),
      (i[(i.COLOR_DODGE = 7)] = "COLOR_DODGE"),
      (i[(i.COLOR_BURN = 8)] = "COLOR_BURN"),
      (i[(i.HARD_LIGHT = 9)] = "HARD_LIGHT"),
      (i[(i.SOFT_LIGHT = 10)] = "SOFT_LIGHT"),
      (i[(i.DIFFERENCE = 11)] = "DIFFERENCE"),
      (i[(i.EXCLUSION = 12)] = "EXCLUSION"),
      (i[(i.HUE = 13)] = "HUE"),
      (i[(i.SATURATION = 14)] = "SATURATION"),
      (i[(i.COLOR = 15)] = "COLOR"),
      (i[(i.LUMINOSITY = 16)] = "LUMINOSITY"),
      (i[(i.NORMAL_NPM = 17)] = "NORMAL_NPM"),
      (i[(i.ADD_NPM = 18)] = "ADD_NPM"),
      (i[(i.SCREEN_NPM = 19)] = "SCREEN_NPM"),
      (i[(i.NONE = 20)] = "NONE"),
      (i[(i.SRC_OVER = 0)] = "SRC_OVER"),
      (i[(i.SRC_IN = 21)] = "SRC_IN"),
      (i[(i.SRC_OUT = 22)] = "SRC_OUT"),
      (i[(i.SRC_ATOP = 23)] = "SRC_ATOP"),
      (i[(i.DST_OVER = 24)] = "DST_OVER"),
      (i[(i.DST_IN = 25)] = "DST_IN"),
      (i[(i.DST_OUT = 26)] = "DST_OUT"),
      (i[(i.DST_ATOP = 27)] = "DST_ATOP"),
      (i[(i.ERASE = 26)] = "ERASE"),
      (i[(i.SUBTRACT = 28)] = "SUBTRACT"),
      (i[(i.XOR = 29)] = "XOR"),
      i
    ))(G || {}),
    Dt = ((i) => (
      (i[(i.POINTS = 0)] = "POINTS"),
      (i[(i.LINES = 1)] = "LINES"),
      (i[(i.LINE_LOOP = 2)] = "LINE_LOOP"),
      (i[(i.LINE_STRIP = 3)] = "LINE_STRIP"),
      (i[(i.TRIANGLES = 4)] = "TRIANGLES"),
      (i[(i.TRIANGLE_STRIP = 5)] = "TRIANGLE_STRIP"),
      (i[(i.TRIANGLE_FAN = 6)] = "TRIANGLE_FAN"),
      i
    ))(Dt || {}),
    S = ((i) => (
      (i[(i.RGBA = 6408)] = "RGBA"),
      (i[(i.RGB = 6407)] = "RGB"),
      (i[(i.RG = 33319)] = "RG"),
      (i[(i.RED = 6403)] = "RED"),
      (i[(i.RGBA_INTEGER = 36249)] = "RGBA_INTEGER"),
      (i[(i.RGB_INTEGER = 36248)] = "RGB_INTEGER"),
      (i[(i.RG_INTEGER = 33320)] = "RG_INTEGER"),
      (i[(i.RED_INTEGER = 36244)] = "RED_INTEGER"),
      (i[(i.ALPHA = 6406)] = "ALPHA"),
      (i[(i.LUMINANCE = 6409)] = "LUMINANCE"),
      (i[(i.LUMINANCE_ALPHA = 6410)] = "LUMINANCE_ALPHA"),
      (i[(i.DEPTH_COMPONENT = 6402)] = "DEPTH_COMPONENT"),
      (i[(i.DEPTH_STENCIL = 34041)] = "DEPTH_STENCIL"),
      i
    ))(S || {}),
    fe = ((i) => (
      (i[(i.TEXTURE_2D = 3553)] = "TEXTURE_2D"),
      (i[(i.TEXTURE_CUBE_MAP = 34067)] = "TEXTURE_CUBE_MAP"),
      (i[(i.TEXTURE_2D_ARRAY = 35866)] = "TEXTURE_2D_ARRAY"),
      (i[(i.TEXTURE_CUBE_MAP_POSITIVE_X = 34069)] = "TEXTURE_CUBE_MAP_POSITIVE_X"),
      (i[(i.TEXTURE_CUBE_MAP_NEGATIVE_X = 34070)] = "TEXTURE_CUBE_MAP_NEGATIVE_X"),
      (i[(i.TEXTURE_CUBE_MAP_POSITIVE_Y = 34071)] = "TEXTURE_CUBE_MAP_POSITIVE_Y"),
      (i[(i.TEXTURE_CUBE_MAP_NEGATIVE_Y = 34072)] = "TEXTURE_CUBE_MAP_NEGATIVE_Y"),
      (i[(i.TEXTURE_CUBE_MAP_POSITIVE_Z = 34073)] = "TEXTURE_CUBE_MAP_POSITIVE_Z"),
      (i[(i.TEXTURE_CUBE_MAP_NEGATIVE_Z = 34074)] = "TEXTURE_CUBE_MAP_NEGATIVE_Z"),
      i
    ))(fe || {}),
    L = ((i) => (
      (i[(i.UNSIGNED_BYTE = 5121)] = "UNSIGNED_BYTE"),
      (i[(i.UNSIGNED_SHORT = 5123)] = "UNSIGNED_SHORT"),
      (i[(i.UNSIGNED_SHORT_5_6_5 = 33635)] = "UNSIGNED_SHORT_5_6_5"),
      (i[(i.UNSIGNED_SHORT_4_4_4_4 = 32819)] = "UNSIGNED_SHORT_4_4_4_4"),
      (i[(i.UNSIGNED_SHORT_5_5_5_1 = 32820)] = "UNSIGNED_SHORT_5_5_5_1"),
      (i[(i.UNSIGNED_INT = 5125)] = "UNSIGNED_INT"),
      (i[(i.UNSIGNED_INT_10F_11F_11F_REV = 35899)] = "UNSIGNED_INT_10F_11F_11F_REV"),
      (i[(i.UNSIGNED_INT_2_10_10_10_REV = 33640)] = "UNSIGNED_INT_2_10_10_10_REV"),
      (i[(i.UNSIGNED_INT_24_8 = 34042)] = "UNSIGNED_INT_24_8"),
      (i[(i.UNSIGNED_INT_5_9_9_9_REV = 35902)] = "UNSIGNED_INT_5_9_9_9_REV"),
      (i[(i.BYTE = 5120)] = "BYTE"),
      (i[(i.SHORT = 5122)] = "SHORT"),
      (i[(i.INT = 5124)] = "INT"),
      (i[(i.FLOAT = 5126)] = "FLOAT"),
      (i[(i.FLOAT_32_UNSIGNED_INT_24_8_REV = 36269)] = "FLOAT_32_UNSIGNED_INT_24_8_REV"),
      (i[(i.HALF_FLOAT = 36193)] = "HALF_FLOAT"),
      i
    ))(L || {}),
    Ai = ((i) => (
      (i[(i.FLOAT = 0)] = "FLOAT"), (i[(i.INT = 1)] = "INT"), (i[(i.UINT = 2)] = "UINT"), i
    ))(Ai || {}),
    jt = ((i) => ((i[(i.NEAREST = 0)] = "NEAREST"), (i[(i.LINEAR = 1)] = "LINEAR"), i))(jt || {}),
    qt = ((i) => (
      (i[(i.CLAMP = 33071)] = "CLAMP"),
      (i[(i.REPEAT = 10497)] = "REPEAT"),
      (i[(i.MIRRORED_REPEAT = 33648)] = "MIRRORED_REPEAT"),
      i
    ))(qt || {}),
    Kt = ((i) => (
      (i[(i.OFF = 0)] = "OFF"),
      (i[(i.POW2 = 1)] = "POW2"),
      (i[(i.ON = 2)] = "ON"),
      (i[(i.ON_MANUAL = 3)] = "ON_MANUAL"),
      i
    ))(Kt || {}),
    Pt = ((i) => (
      (i[(i.NPM = 0)] = "NPM"),
      (i[(i.UNPACK = 1)] = "UNPACK"),
      (i[(i.PMA = 2)] = "PMA"),
      (i[(i.NO_PREMULTIPLIED_ALPHA = 0)] = "NO_PREMULTIPLIED_ALPHA"),
      (i[(i.PREMULTIPLY_ON_UPLOAD = 1)] = "PREMULTIPLY_ON_UPLOAD"),
      (i[(i.PREMULTIPLIED_ALPHA = 2)] = "PREMULTIPLIED_ALPHA"),
      i
    ))(Pt || {}),
    Ot = ((i) => (
      (i[(i.NO = 0)] = "NO"),
      (i[(i.YES = 1)] = "YES"),
      (i[(i.AUTO = 2)] = "AUTO"),
      (i[(i.BLEND = 0)] = "BLEND"),
      (i[(i.CLEAR = 1)] = "CLEAR"),
      (i[(i.BLIT = 2)] = "BLIT"),
      i
    ))(Ot || {}),
    Rr = ((i) => ((i[(i.AUTO = 0)] = "AUTO"), (i[(i.MANUAL = 1)] = "MANUAL"), i))(Rr || {}),
    Xt = ((i) => ((i.LOW = "lowp"), (i.MEDIUM = "mediump"), (i.HIGH = "highp"), i))(Xt || {}),
    ht = ((i) => (
      (i[(i.NONE = 0)] = "NONE"),
      (i[(i.SCISSOR = 1)] = "SCISSOR"),
      (i[(i.STENCIL = 2)] = "STENCIL"),
      (i[(i.SPRITE = 3)] = "SPRITE"),
      (i[(i.COLOR = 4)] = "COLOR"),
      i
    ))(ht || {}),
    On = ((i) => (
      (i[(i.RED = 1)] = "RED"),
      (i[(i.GREEN = 2)] = "GREEN"),
      (i[(i.BLUE = 4)] = "BLUE"),
      (i[(i.ALPHA = 8)] = "ALPHA"),
      i
    ))(On || {}),
    ot = ((i) => (
      (i[(i.NONE = 0)] = "NONE"),
      (i[(i.LOW = 2)] = "LOW"),
      (i[(i.MEDIUM = 4)] = "MEDIUM"),
      (i[(i.HIGH = 8)] = "HIGH"),
      i
    ))(ot || {}),
    $t = ((i) => (
      (i[(i.ELEMENT_ARRAY_BUFFER = 34963)] = "ELEMENT_ARRAY_BUFFER"),
      (i[(i.ARRAY_BUFFER = 34962)] = "ARRAY_BUFFER"),
      (i[(i.UNIFORM_BUFFER = 35345)] = "UNIFORM_BUFFER"),
      i
    ))($t || {});
  /*!
   * @pixi/extensions - v7.0.0-alpha
   * Compiled Fri, 09 Sep 2022 16:09:18 UTC
   *
   * @pixi/extensions is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */ var P = ((i) => (
    (i.Renderer = "renderer"),
    (i.Application = "application"),
    (i.RendererSystem = "renderer-webgl-system"),
    (i.RendererPlugin = "renderer-webgl-plugin"),
    (i.CanvasRendererSystem = "renderer-canvas-system"),
    (i.CanvasRendererPlugin = "renderer-canvas-plugin"),
    (i.LoadParser = "load-parser"),
    (i.ResolveParser = "resolve-parser"),
    (i.CacheParser = "cache-parser"),
    (i.DetectionParser = "detection-parser"),
    i
  ))(P || {});
  const Fn = (i) => {
      if (
        ((typeof i == "function" || (typeof i == "object" && i.extension)) &&
          (i = gn(ne({}, typeof i.extension != "object" ? { type: i.extension } : i.extension), {
            ref: i,
          })),
        typeof i == "object")
      )
        i = ne({}, i);
      else throw new Error("Invalid extension type");
      return typeof i.type == "string" && (i.type = [i.type]), i;
    },
    B = {
      _addHandlers: {},
      _removeHandlers: {},
      _queue: {},
      remove(...i) {
        return (
          i.map(Fn).forEach((t) => {
            t.type.forEach((e) => {
              var r, s;
              return (s = (r = this._removeHandlers)[e]) == null ? void 0 : s.call(r, t);
            });
          }),
          this
        );
      },
      add(...i) {
        return (
          i.map(Fn).forEach((t) => {
            t.type.forEach((e) => {
              const r = this._addHandlers,
                s = this._queue;
              r[e] ? r[e](t) : ((s[e] = s[e] || []), s[e].push(t));
            });
          }),
          this
        );
      },
      handle(i, t, e) {
        const r = this._addHandlers,
          s = this._removeHandlers;
        (r[i] = t), (s[i] = e);
        const n = this._queue;
        return n[i] && (n[i].forEach((a) => t(a)), delete n[i]), this;
      },
      handleByMap(i, t) {
        return this.handle(
          i,
          (e) => {
            t[e.name] = e.ref;
          },
          (e) => {
            delete t[e.name];
          }
        );
      },
      handleByList(i, t) {
        return this.handle(
          i,
          (e) => {
            t.push(e.ref),
              t.sort((r, s) => {
                var n, a;
                return ((n = s.priority) != null ? n : -1) - ((a = r.priority) != null ? a : -1);
              });
          },
          (e) => {
            const r = t.indexOf(e.ref);
            r !== -1 && t.splice(r, 1);
          }
        );
      },
    };
  /*!
   * @pixi/math - v7.0.0-alpha
   * Compiled Fri, 09 Sep 2022 16:09:18 UTC
   *
   * @pixi/math is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */ const He = Math.PI * 2,
    Nn = 180 / Math.PI,
    Bn = Math.PI / 180;
  var ct = ((i) => (
    (i[(i.POLY = 0)] = "POLY"),
    (i[(i.RECT = 1)] = "RECT"),
    (i[(i.CIRC = 2)] = "CIRC"),
    (i[(i.ELIP = 3)] = "ELIP"),
    (i[(i.RREC = 4)] = "RREC"),
    i
  ))(ct || {});
  class V {
    constructor(t = 0, e = 0) {
      (this.x = 0), (this.y = 0), (this.x = t), (this.y = e);
    }
    clone() {
      return new V(this.x, this.y);
    }
    copyFrom(t) {
      return this.set(t.x, t.y), this;
    }
    copyTo(t) {
      return t.set(this.x, this.y), t;
    }
    equals(t) {
      return t.x === this.x && t.y === this.y;
    }
    set(t = 0, e = t) {
      return (this.x = t), (this.y = e), this;
    }
  }
  const Ri = [new V(), new V(), new V(), new V()];
  class z {
    constructor(t = 0, e = 0, r = 0, s = 0) {
      (this.x = Number(t)),
        (this.y = Number(e)),
        (this.width = Number(r)),
        (this.height = Number(s)),
        (this.type = ct.RECT);
    }
    get left() {
      return this.x;
    }
    get right() {
      return this.x + this.width;
    }
    get top() {
      return this.y;
    }
    get bottom() {
      return this.y + this.height;
    }
    static get EMPTY() {
      return new z(0, 0, 0, 0);
    }
    clone() {
      return new z(this.x, this.y, this.width, this.height);
    }
    copyFrom(t) {
      return (this.x = t.x), (this.y = t.y), (this.width = t.width), (this.height = t.height), this;
    }
    copyTo(t) {
      return (t.x = this.x), (t.y = this.y), (t.width = this.width), (t.height = this.height), t;
    }
    contains(t, e) {
      return this.width <= 0 || this.height <= 0
        ? !1
        : t >= this.x && t < this.x + this.width && e >= this.y && e < this.y + this.height;
    }
    intersects(t, e) {
      if (!e) {
        const R = this.x < t.x ? t.x : this.x;
        if ((this.right > t.right ? t.right : this.right) <= R) return !1;
        const U = this.y < t.y ? t.y : this.y;
        return (this.bottom > t.bottom ? t.bottom : this.bottom) > U;
      }
      const r = this.left,
        s = this.right,
        n = this.top,
        a = this.bottom;
      if (s <= r || a <= n) return !1;
      const o = Ri[0].set(t.left, t.top),
        h = Ri[1].set(t.left, t.bottom),
        l = Ri[2].set(t.right, t.top),
        u = Ri[3].set(t.right, t.bottom);
      if (l.x <= o.x || h.y <= o.y) return !1;
      const c = Math.sign(e.a * e.d - e.b * e.c);
      if (
        c === 0 ||
        (e.apply(o, o),
        e.apply(h, h),
        e.apply(l, l),
        e.apply(u, u),
        Math.max(o.x, h.x, l.x, u.x) <= r ||
          Math.min(o.x, h.x, l.x, u.x) >= s ||
          Math.max(o.y, h.y, l.y, u.y) <= n ||
          Math.min(o.y, h.y, l.y, u.y) >= a)
      )
        return !1;
      const d = c * (h.y - o.y),
        f = c * (o.x - h.x),
        p = d * r + f * n,
        g = d * s + f * n,
        _ = d * r + f * a,
        T = d * s + f * a;
      if (Math.max(p, g, _, T) <= d * o.x + f * o.y || Math.min(p, g, _, T) >= d * u.x + f * u.y)
        return !1;
      const v = c * (o.y - l.y),
        x = c * (l.x - o.x),
        y = v * r + x * n,
        E = v * s + x * n,
        D = v * r + x * a,
        I = v * s + x * a;
      return !(
        Math.max(y, E, D, I) <= v * o.x + x * o.y || Math.min(y, E, D, I) >= v * u.x + x * u.y
      );
    }
    pad(t = 0, e = t) {
      return (this.x -= t), (this.y -= e), (this.width += t * 2), (this.height += e * 2), this;
    }
    fit(t) {
      const e = Math.max(this.x, t.x),
        r = Math.min(this.x + this.width, t.x + t.width),
        s = Math.max(this.y, t.y),
        n = Math.min(this.y + this.height, t.y + t.height);
      return (
        (this.x = e),
        (this.width = Math.max(r - e, 0)),
        (this.y = s),
        (this.height = Math.max(n - s, 0)),
        this
      );
    }
    ceil(t = 1, e = 0.001) {
      const r = Math.ceil((this.x + this.width - e) * t) / t,
        s = Math.ceil((this.y + this.height - e) * t) / t;
      return (
        (this.x = Math.floor((this.x + e) * t) / t),
        (this.y = Math.floor((this.y + e) * t) / t),
        (this.width = r - this.x),
        (this.height = s - this.y),
        this
      );
    }
    enlarge(t) {
      const e = Math.min(this.x, t.x),
        r = Math.max(this.x + this.width, t.x + t.width),
        s = Math.min(this.y, t.y),
        n = Math.max(this.y + this.height, t.y + t.height);
      return (this.x = e), (this.width = r - e), (this.y = s), (this.height = n - s), this;
    }
  }
  class Si {
    constructor(t = 0, e = 0, r = 0) {
      (this.x = t), (this.y = e), (this.radius = r), (this.type = ct.CIRC);
    }
    clone() {
      return new Si(this.x, this.y, this.radius);
    }
    contains(t, e) {
      if (this.radius <= 0) return !1;
      const r = this.radius * this.radius;
      let s = this.x - t,
        n = this.y - e;
      return (s *= s), (n *= n), s + n <= r;
    }
    getBounds() {
      return new z(this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);
    }
  }
  class Ii {
    constructor(t = 0, e = 0, r = 0, s = 0) {
      (this.x = t), (this.y = e), (this.width = r), (this.height = s), (this.type = ct.ELIP);
    }
    clone() {
      return new Ii(this.x, this.y, this.width, this.height);
    }
    contains(t, e) {
      if (this.width <= 0 || this.height <= 0) return !1;
      let r = (t - this.x) / this.width,
        s = (e - this.y) / this.height;
      return (r *= r), (s *= s), r + s <= 1;
    }
    getBounds() {
      return new z(this.x - this.width, this.y - this.height, this.width, this.height);
    }
  }
  class pe {
    constructor(...t) {
      let e = Array.isArray(t[0]) ? t[0] : t;
      if (typeof e[0] != "number") {
        const r = [];
        for (let s = 0, n = e.length; s < n; s++) r.push(e[s].x, e[s].y);
        e = r;
      }
      (this.points = e), (this.type = ct.POLY), (this.closeStroke = !0);
    }
    clone() {
      const t = this.points.slice(),
        e = new pe(t);
      return (e.closeStroke = this.closeStroke), e;
    }
    contains(t, e) {
      let r = !1;
      const s = this.points.length / 2;
      for (let n = 0, a = s - 1; n < s; a = n++) {
        const o = this.points[n * 2],
          h = this.points[n * 2 + 1],
          l = this.points[a * 2],
          u = this.points[a * 2 + 1];
        h > e != u > e && t < (l - o) * ((e - h) / (u - h)) + o && (r = !r);
      }
      return r;
    }
  }
  class wi {
    constructor(t = 0, e = 0, r = 0, s = 0, n = 20) {
      (this.x = t),
        (this.y = e),
        (this.width = r),
        (this.height = s),
        (this.radius = n),
        (this.type = ct.RREC);
    }
    clone() {
      return new wi(this.x, this.y, this.width, this.height, this.radius);
    }
    contains(t, e) {
      if (this.width <= 0 || this.height <= 0) return !1;
      if (t >= this.x && t <= this.x + this.width && e >= this.y && e <= this.y + this.height) {
        const r = Math.max(0, Math.min(this.radius, Math.min(this.width, this.height) / 2));
        if (
          (e >= this.y + r && e <= this.y + this.height - r) ||
          (t >= this.x + r && t <= this.x + this.width - r)
        )
          return !0;
        let s = t - (this.x + r),
          n = e - (this.y + r);
        const a = r * r;
        if (
          s * s + n * n <= a ||
          ((s = t - (this.x + this.width - r)), s * s + n * n <= a) ||
          ((n = e - (this.y + this.height - r)), s * s + n * n <= a) ||
          ((s = t - (this.x + r)), s * s + n * n <= a)
        )
          return !0;
      }
      return !1;
    }
  }
  class Zt {
    constructor(t, e, r = 0, s = 0) {
      (this._x = r), (this._y = s), (this.cb = t), (this.scope = e);
    }
    clone(t = this.cb, e = this.scope) {
      return new Zt(t, e, this._x, this._y);
    }
    set(t = 0, e = t) {
      return (
        (this._x !== t || this._y !== e) &&
          ((this._x = t), (this._y = e), this.cb.call(this.scope)),
        this
      );
    }
    copyFrom(t) {
      return (
        (this._x !== t.x || this._y !== t.y) &&
          ((this._x = t.x), (this._y = t.y), this.cb.call(this.scope)),
        this
      );
    }
    copyTo(t) {
      return t.set(this._x, this._y), t;
    }
    equals(t) {
      return t.x === this._x && t.y === this._y;
    }
    get x() {
      return this._x;
    }
    set x(t) {
      this._x !== t && ((this._x = t), this.cb.call(this.scope));
    }
    get y() {
      return this._y;
    }
    set y(t) {
      this._y !== t && ((this._y = t), this.cb.call(this.scope));
    }
  }
  class Q {
    constructor(t = 1, e = 0, r = 0, s = 1, n = 0, a = 0) {
      (this.array = null),
        (this.a = t),
        (this.b = e),
        (this.c = r),
        (this.d = s),
        (this.tx = n),
        (this.ty = a);
    }
    fromArray(t) {
      (this.a = t[0]),
        (this.b = t[1]),
        (this.c = t[3]),
        (this.d = t[4]),
        (this.tx = t[2]),
        (this.ty = t[5]);
    }
    set(t, e, r, s, n, a) {
      return (
        (this.a = t), (this.b = e), (this.c = r), (this.d = s), (this.tx = n), (this.ty = a), this
      );
    }
    toArray(t, e) {
      this.array || (this.array = new Float32Array(9));
      const r = e || this.array;
      return (
        t
          ? ((r[0] = this.a),
            (r[1] = this.b),
            (r[2] = 0),
            (r[3] = this.c),
            (r[4] = this.d),
            (r[5] = 0),
            (r[6] = this.tx),
            (r[7] = this.ty),
            (r[8] = 1))
          : ((r[0] = this.a),
            (r[1] = this.c),
            (r[2] = this.tx),
            (r[3] = this.b),
            (r[4] = this.d),
            (r[5] = this.ty),
            (r[6] = 0),
            (r[7] = 0),
            (r[8] = 1)),
        r
      );
    }
    apply(t, e) {
      e = e || new V();
      const r = t.x,
        s = t.y;
      return (
        (e.x = this.a * r + this.c * s + this.tx), (e.y = this.b * r + this.d * s + this.ty), e
      );
    }
    applyInverse(t, e) {
      e = e || new V();
      const r = 1 / (this.a * this.d + this.c * -this.b),
        s = t.x,
        n = t.y;
      return (
        (e.x = this.d * r * s + -this.c * r * n + (this.ty * this.c - this.tx * this.d) * r),
        (e.y = this.a * r * n + -this.b * r * s + (-this.ty * this.a + this.tx * this.b) * r),
        e
      );
    }
    translate(t, e) {
      return (this.tx += t), (this.ty += e), this;
    }
    scale(t, e) {
      return (
        (this.a *= t),
        (this.d *= e),
        (this.c *= t),
        (this.b *= e),
        (this.tx *= t),
        (this.ty *= e),
        this
      );
    }
    rotate(t) {
      const e = Math.cos(t),
        r = Math.sin(t),
        s = this.a,
        n = this.c,
        a = this.tx;
      return (
        (this.a = s * e - this.b * r),
        (this.b = s * r + this.b * e),
        (this.c = n * e - this.d * r),
        (this.d = n * r + this.d * e),
        (this.tx = a * e - this.ty * r),
        (this.ty = a * r + this.ty * e),
        this
      );
    }
    append(t) {
      const e = this.a,
        r = this.b,
        s = this.c,
        n = this.d;
      return (
        (this.a = t.a * e + t.b * s),
        (this.b = t.a * r + t.b * n),
        (this.c = t.c * e + t.d * s),
        (this.d = t.c * r + t.d * n),
        (this.tx = t.tx * e + t.ty * s + this.tx),
        (this.ty = t.tx * r + t.ty * n + this.ty),
        this
      );
    }
    setTransform(t, e, r, s, n, a, o, h, l) {
      return (
        (this.a = Math.cos(o + l) * n),
        (this.b = Math.sin(o + l) * n),
        (this.c = -Math.sin(o - h) * a),
        (this.d = Math.cos(o - h) * a),
        (this.tx = t - (r * this.a + s * this.c)),
        (this.ty = e - (r * this.b + s * this.d)),
        this
      );
    }
    prepend(t) {
      const e = this.tx;
      if (t.a !== 1 || t.b !== 0 || t.c !== 0 || t.d !== 1) {
        const r = this.a,
          s = this.c;
        (this.a = r * t.a + this.b * t.c),
          (this.b = r * t.b + this.b * t.d),
          (this.c = s * t.a + this.d * t.c),
          (this.d = s * t.b + this.d * t.d);
      }
      return (
        (this.tx = e * t.a + this.ty * t.c + t.tx), (this.ty = e * t.b + this.ty * t.d + t.ty), this
      );
    }
    decompose(t) {
      const e = this.a,
        r = this.b,
        s = this.c,
        n = this.d,
        a = t.pivot,
        o = -Math.atan2(-s, n),
        h = Math.atan2(r, e),
        l = Math.abs(o + h);
      return (
        l < 1e-5 || Math.abs(He - l) < 1e-5
          ? ((t.rotation = h), (t.skew.x = t.skew.y = 0))
          : ((t.rotation = 0), (t.skew.x = o), (t.skew.y = h)),
        (t.scale.x = Math.sqrt(e * e + r * r)),
        (t.scale.y = Math.sqrt(s * s + n * n)),
        (t.position.x = this.tx + (a.x * e + a.y * s)),
        (t.position.y = this.ty + (a.x * r + a.y * n)),
        t
      );
    }
    invert() {
      const t = this.a,
        e = this.b,
        r = this.c,
        s = this.d,
        n = this.tx,
        a = t * s - e * r;
      return (
        (this.a = s / a),
        (this.b = -e / a),
        (this.c = -r / a),
        (this.d = t / a),
        (this.tx = (r * this.ty - s * n) / a),
        (this.ty = -(t * this.ty - e * n) / a),
        this
      );
    }
    identity() {
      return (
        (this.a = 1), (this.b = 0), (this.c = 0), (this.d = 1), (this.tx = 0), (this.ty = 0), this
      );
    }
    clone() {
      const t = new Q();
      return (
        (t.a = this.a),
        (t.b = this.b),
        (t.c = this.c),
        (t.d = this.d),
        (t.tx = this.tx),
        (t.ty = this.ty),
        t
      );
    }
    copyTo(t) {
      return (
        (t.a = this.a),
        (t.b = this.b),
        (t.c = this.c),
        (t.d = this.d),
        (t.tx = this.tx),
        (t.ty = this.ty),
        t
      );
    }
    copyFrom(t) {
      return (
        (this.a = t.a),
        (this.b = t.b),
        (this.c = t.c),
        (this.d = t.d),
        (this.tx = t.tx),
        (this.ty = t.ty),
        this
      );
    }
    static get IDENTITY() {
      return new Q();
    }
    static get TEMP_MATRIX() {
      return new Q();
    }
  }
  const me = [1, 1, 0, -1, -1, -1, 0, 1, 1, 1, 0, -1, -1, -1, 0, 1],
    _e = [0, 1, 1, 1, 0, -1, -1, -1, 0, 1, 1, 1, 0, -1, -1, -1],
    ge = [0, -1, -1, -1, 0, 1, 1, 1, 0, 1, 1, 1, 0, -1, -1, -1],
    xe = [1, 1, 0, -1, -1, -1, 0, 1, -1, -1, 0, 1, 1, 1, 0, -1],
    Sr = [],
    Ln = [],
    Mi = Math.sign;
  function hh() {
    for (let i = 0; i < 16; i++) {
      const t = [];
      Sr.push(t);
      for (let e = 0; e < 16; e++) {
        const r = Mi(me[i] * me[e] + ge[i] * _e[e]),
          s = Mi(_e[i] * me[e] + xe[i] * _e[e]),
          n = Mi(me[i] * ge[e] + ge[i] * xe[e]),
          a = Mi(_e[i] * ge[e] + xe[i] * xe[e]);
        for (let o = 0; o < 16; o++)
          if (me[o] === r && _e[o] === s && ge[o] === n && xe[o] === a) {
            t.push(o);
            break;
          }
      }
    }
    for (let i = 0; i < 16; i++) {
      const t = new Q();
      t.set(me[i], _e[i], ge[i], xe[i], 0, 0), Ln.push(t);
    }
  }
  hh();
  const J = {
      E: 0,
      SE: 1,
      S: 2,
      SW: 3,
      W: 4,
      NW: 5,
      N: 6,
      NE: 7,
      MIRROR_VERTICAL: 8,
      MAIN_DIAGONAL: 10,
      MIRROR_HORIZONTAL: 12,
      REVERSE_DIAGONAL: 14,
      uX: (i) => me[i],
      uY: (i) => _e[i],
      vX: (i) => ge[i],
      vY: (i) => xe[i],
      inv: (i) => (i & 8 ? i & 15 : -i & 7),
      add: (i, t) => Sr[i][t],
      sub: (i, t) => Sr[i][J.inv(t)],
      rotate180: (i) => i ^ 4,
      isVertical: (i) => (i & 3) === 2,
      byDirection: (i, t) =>
        Math.abs(i) * 2 <= Math.abs(t)
          ? t >= 0
            ? J.S
            : J.N
          : Math.abs(t) * 2 <= Math.abs(i)
          ? i > 0
            ? J.E
            : J.W
          : t > 0
          ? i > 0
            ? J.SE
            : J.SW
          : i > 0
          ? J.NE
          : J.NW,
      matrixAppendRotationInv: (i, t, e = 0, r = 0) => {
        const s = Ln[J.inv(t)];
        (s.tx = e), (s.ty = r), i.append(s);
      },
    },
    Gn = class {
      constructor() {
        (this.worldTransform = new Q()),
          (this.localTransform = new Q()),
          (this.position = new Zt(this.onChange, this, 0, 0)),
          (this.scale = new Zt(this.onChange, this, 1, 1)),
          (this.pivot = new Zt(this.onChange, this, 0, 0)),
          (this.skew = new Zt(this.updateSkew, this, 0, 0)),
          (this._rotation = 0),
          (this._cx = 1),
          (this._sx = 0),
          (this._cy = 0),
          (this._sy = 1),
          (this._localID = 0),
          (this._currentLocalID = 0),
          (this._worldID = 0),
          (this._parentID = 0);
      }
      onChange() {
        this._localID++;
      }
      updateSkew() {
        (this._cx = Math.cos(this._rotation + this.skew.y)),
          (this._sx = Math.sin(this._rotation + this.skew.y)),
          (this._cy = -Math.sin(this._rotation - this.skew.x)),
          (this._sy = Math.cos(this._rotation - this.skew.x)),
          this._localID++;
      }
      updateLocalTransform() {
        const i = this.localTransform;
        this._localID !== this._currentLocalID &&
          ((i.a = this._cx * this.scale.x),
          (i.b = this._sx * this.scale.x),
          (i.c = this._cy * this.scale.y),
          (i.d = this._sy * this.scale.y),
          (i.tx = this.position.x - (this.pivot.x * i.a + this.pivot.y * i.c)),
          (i.ty = this.position.y - (this.pivot.x * i.b + this.pivot.y * i.d)),
          (this._currentLocalID = this._localID),
          (this._parentID = -1));
      }
      updateTransform(i) {
        const t = this.localTransform;
        if (
          (this._localID !== this._currentLocalID &&
            ((t.a = this._cx * this.scale.x),
            (t.b = this._sx * this.scale.x),
            (t.c = this._cy * this.scale.y),
            (t.d = this._sy * this.scale.y),
            (t.tx = this.position.x - (this.pivot.x * t.a + this.pivot.y * t.c)),
            (t.ty = this.position.y - (this.pivot.x * t.b + this.pivot.y * t.d)),
            (this._currentLocalID = this._localID),
            (this._parentID = -1)),
          this._parentID !== i._worldID)
        ) {
          const e = i.worldTransform,
            r = this.worldTransform;
          (r.a = t.a * e.a + t.b * e.c),
            (r.b = t.a * e.b + t.b * e.d),
            (r.c = t.c * e.a + t.d * e.c),
            (r.d = t.c * e.b + t.d * e.d),
            (r.tx = t.tx * e.a + t.ty * e.c + e.tx),
            (r.ty = t.tx * e.b + t.ty * e.d + e.ty),
            (this._parentID = i._worldID),
            this._worldID++;
        }
      }
      setFromMatrix(i) {
        i.decompose(this), this._localID++;
      }
      get rotation() {
        return this._rotation;
      }
      set rotation(i) {
        this._rotation !== i && ((this._rotation = i), this.updateSkew());
      }
    };
  let ze = Gn;
  ze.IDENTITY = new Gn();
  /*!
   * @pixi/runner - v7.0.0-alpha
   * Compiled Fri, 09 Sep 2022 16:09:18 UTC
   *
   * @pixi/runner is licensed under the MIT License.
   * http://www.opensource.org/licenses/mit-license
   */ class Ft {
    constructor(t) {
      (this.items = []), (this._name = t), (this._aliasCount = 0);
    }
    emit(t, e, r, s, n, a, o, h) {
      if (arguments.length > 8) throw new Error("max arguments reached");
      const { name: l, items: u } = this;
      this._aliasCount++;
      for (let c = 0, d = u.length; c < d; c++) u[c][l](t, e, r, s, n, a, o, h);
      return u === this.items && this._aliasCount--, this;
    }
    ensureNonAliasedItems() {
      this._aliasCount > 0 &&
        this.items.length > 1 &&
        ((this._aliasCount = 0), (this.items = this.items.slice(0)));
    }
    add(t) {
      return (
        t[this._name] && (this.ensureNonAliasedItems(), this.remove(t), this.items.push(t)), this
      );
    }
    remove(t) {
      const e = this.items.indexOf(t);
      return e !== -1 && (this.ensureNonAliasedItems(), this.items.splice(e, 1)), this;
    }
    contains(t) {
      return this.items.includes(t);
    }
    removeAll() {
      return this.ensureNonAliasedItems(), (this.items.length = 0), this;
    }
    destroy() {
      this.removeAll(), (this.items = null), (this._name = null);
    }
    get empty() {
      return this.items.length === 0;
    }
    get name() {
      return this._name;
    }
  }
  Object.defineProperties(Ft.prototype, {
    dispatch: { value: Ft.prototype.emit },
    run: { value: Ft.prototype.emit },
  }),
    (A.TARGET_FPMS = 0.06);
  var oe = ((i) => (
    (i[(i.HIGH = 25)] = "HIGH"),
    (i[(i.NORMAL = 0)] = "NORMAL"),
    (i[(i.LOW = -25)] = "LOW"),
    (i[(i.UTILITY = -50)] = "UTILITY"),
    i
  ))(oe || {});
  class Ir {
    constructor(t, e = null, r = 0, s = !1) {
      (this.next = null),
        (this.previous = null),
        (this._destroyed = !1),
        (this.fn = t),
        (this.context = e),
        (this.priority = r),
        (this.once = s);
    }
    match(t, e = null) {
      return this.fn === t && this.context === e;
    }
    emit(t) {
      this.fn && (this.context ? this.fn.call(this.context, t) : this.fn(t));
      const e = this.next;
      return this.once && this.destroy(!0), this._destroyed && (this.next = null), e;
    }
    connect(t) {
      (this.previous = t),
        t.next && (t.next.previous = this),
        (this.next = t.next),
        (t.next = this);
    }
    destroy(t = !1) {
      (this._destroyed = !0),
        (this.fn = null),
        (this.context = null),
        this.previous && (this.previous.next = this.next),
        this.next && (this.next.previous = this.previous);
      const e = this.next;
      return (this.next = t ? null : e), (this.previous = null), e;
    }
  }
  class Z {
    constructor() {
      (this.autoStart = !1),
        (this.deltaTime = 1),
        (this.lastTime = -1),
        (this.speed = 1),
        (this.started = !1),
        (this._requestId = null),
        (this._maxElapsedMS = 100),
        (this._minElapsedMS = 0),
        (this._protected = !1),
        (this._lastFrame = -1),
        (this._head = new Ir(null, null, 1 / 0)),
        (this.deltaMS = 1 / A.TARGET_FPMS),
        (this.elapsedMS = 1 / A.TARGET_FPMS),
        (this._tick = (t) => {
          (this._requestId = null),
            this.started &&
              (this.update(t),
              this.started &&
                this._requestId === null &&
                this._head.next &&
                (this._requestId = requestAnimationFrame(this._tick)));
        });
    }
    _requestIfNeeded() {
      this._requestId === null &&
        this._head.next &&
        ((this.lastTime = performance.now()),
        (this._lastFrame = this.lastTime),
        (this._requestId = requestAnimationFrame(this._tick)));
    }
    _cancelIfNeeded() {
      this._requestId !== null && (cancelAnimationFrame(this._requestId), (this._requestId = null));
    }
    _startIfPossible() {
      this.started ? this._requestIfNeeded() : this.autoStart && this.start();
    }
    add(t, e, r = oe.NORMAL) {
      return this._addListener(new Ir(t, e, r));
    }
    addOnce(t, e, r = oe.NORMAL) {
      return this._addListener(new Ir(t, e, r, !0));
    }
    _addListener(t) {
      let e = this._head.next,
        r = this._head;
      if (!e) t.connect(r);
      else {
        for (; e; ) {
          if (t.priority > e.priority) {
            t.connect(r);
            break;
          }
          (r = e), (e = e.next);
        }
        t.previous || t.connect(r);
      }
      return this._startIfPossible(), this;
    }
    remove(t, e) {
      let r = this._head.next;
      for (; r; ) r.match(t, e) ? (r = r.destroy()) : (r = r.next);
      return this._head.next || this._cancelIfNeeded(), this;
    }
    get count() {
      if (!this._head) return 0;
      let t = 0,
        e = this._head;
      for (; (e = e.next); ) t++;
      return t;
    }
    start() {
      this.started || ((this.started = !0), this._requestIfNeeded());
    }
    stop() {
      this.started && ((this.started = !1), this._cancelIfNeeded());
    }
    destroy() {
      if (!this._protected) {
        this.stop();
        let t = this._head.next;
        for (; t; ) t = t.destroy(!0);
        this._head.destroy(), (this._head = null);
      }
    }
    update(t = performance.now()) {
      let e;
      if (t > this.lastTime) {
        if (
          ((e = this.elapsedMS = t - this.lastTime),
          e > this._maxElapsedMS && (e = this._maxElapsedMS),
          (e *= this.speed),
          this._minElapsedMS)
        ) {
          const n = (t - this._lastFrame) | 0;
          if (n < this._minElapsedMS) return;
          this._lastFrame = t - (n % this._minElapsedMS);
        }
        (this.deltaMS = e), (this.deltaTime = this.deltaMS * A.TARGET_FPMS);
        const r = this._head;
        let s = r.next;
        for (; s; ) s = s.emit(this.deltaTime);
        r.next || this._cancelIfNeeded();
      } else this.deltaTime = this.deltaMS = this.elapsedMS = 0;
      this.lastTime = t;
    }
    get FPS() {
      return 1e3 / this.elapsedMS;
    }
    get minFPS() {
      return 1e3 / this._maxElapsedMS;
    }
    set minFPS(t) {
      const e = Math.min(this.maxFPS, t),
        r = Math.min(Math.max(0, e) / 1e3, A.TARGET_FPMS);
      this._maxElapsedMS = 1 / r;
    }
    get maxFPS() {
      return this._minElapsedMS ? Math.round(1e3 / this._minElapsedMS) : 0;
    }
    set maxFPS(t) {
      if (t === 0) this._minElapsedMS = 0;
      else {
        const e = Math.max(this.minFPS, t);
        this._minElapsedMS = 1 / (e / 1e3);
      }
    }
    static get shared() {
      if (!Z._shared) {
        const t = (Z._shared = new Z());
        (t.autoStart = !0), (t._protected = !0);
      }
      return Z._shared;
    }
    static get system() {
      if (!Z._system) {
        const t = (Z._system = new Z());
        (t.autoStart = !0), (t._protected = !0);
      }
      return Z._system;
    }
  }
  class wr {
    static init(t) {
      (t = Object.assign({ autoStart: !0, sharedTicker: !1 }, t)),
        Object.defineProperty(this, "ticker", {
          set(e) {
            this._ticker && this._ticker.remove(this.render, this),
              (this._ticker = e),
              e && e.add(this.render, this, oe.LOW);
          },
          get() {
            return this._ticker;
          },
        }),
        (this.stop = () => {
          this._ticker.stop();
        }),
        (this.start = () => {
          this._ticker.start();
        }),
        (this._ticker = null),
        (this.ticker = t.sharedTicker ? Z.shared : new Z()),
        t.autoStart && this.start();
    }
    static destroy() {
      if (this._ticker) {
        const t = this._ticker;
        (this.ticker = null), t.destroy();
      }
    }
  }
  (wr.extension = P.Application), B.add(wr);
  var Mr =
    typeof globalThis != "undefined"
      ? globalThis
      : typeof window != "undefined"
      ? window
      : typeof global != "undefined"
      ? global
      : typeof self != "undefined"
      ? self
      : {};
  function Op(i) {
    return i && i.__esModule && Object.prototype.hasOwnProperty.call(i, "default") ? i.default : i;
  }
  function Cr(i, t, e) {
    return (
      (e = {
        path: t,
        exports: {},
        require: function (r, s) {
          return lh(r, s == null ? e.path : s);
        },
      }),
      i(e, e.exports),
      e.exports
    );
  }
  function Fp(i) {
    return i && Object.prototype.hasOwnProperty.call(i, "default") ? i.default : i;
  }
  function Np(i) {
    return i && Object.prototype.hasOwnProperty.call(i, "default") && Object.keys(i).length === 1
      ? i.default
      : i;
  }
  function Bp(i) {
    if (i.__esModule) return i;
    var t = Object.defineProperty({}, "__esModule", { value: !0 });
    return (
      Object.keys(i).forEach(function (e) {
        var r = Object.getOwnPropertyDescriptor(i, e);
        Object.defineProperty(
          t,
          e,
          r.get
            ? r
            : {
                enumerable: !0,
                get: function () {
                  return i[e];
                },
              }
        );
      }),
      t
    );
  }
  function lh() {
    throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs");
  }
  var Me = Cr(function (i) {
      "use strict";
      var t = Object.prototype.hasOwnProperty,
        e = "~";
      function r() {}
      Object.create && ((r.prototype = Object.create(null)), new r().__proto__ || (e = !1));
      function s(h, l, u) {
        (this.fn = h), (this.context = l), (this.once = u || !1);
      }
      function n(h, l, u, c, d) {
        if (typeof u != "function") throw new TypeError("The listener must be a function");
        var f = new s(u, c || h, d),
          p = e ? e + l : l;
        return (
          h._events[p]
            ? h._events[p].fn
              ? (h._events[p] = [h._events[p], f])
              : h._events[p].push(f)
            : ((h._events[p] = f), h._eventsCount++),
          h
        );
      }
      function a(h, l) {
        --h._eventsCount === 0 ? (h._events = new r()) : delete h._events[l];
      }
      function o() {
        (this._events = new r()), (this._eventsCount = 0);
      }
      (o.prototype.eventNames = function () {
        var l = [],
          u,
          c;
        if (this._eventsCount === 0) return l;
        for (c in (u = this._events)) t.call(u, c) && l.push(e ? c.slice(1) : c);
        return Object.getOwnPropertySymbols ? l.concat(Object.getOwnPropertySymbols(u)) : l;
      }),
        (o.prototype.listeners = function (l) {
          var u = e ? e + l : l,
            c = this._events[u];
          if (!c) return [];
          if (c.fn) return [c.fn];
          for (var d = 0, f = c.length, p = new Array(f); d < f; d++) p[d] = c[d].fn;
          return p;
        }),
        (o.prototype.listenerCount = function (l) {
          var u = e ? e + l : l,
            c = this._events[u];
          return c ? (c.fn ? 1 : c.length) : 0;
        }),
        (o.prototype.emit = function (l, u, c, d, f, p) {
          var g = e ? e + l : l;
          if (!this._events[g]) return !1;
          var _ = this._events[g],
            T = arguments.length,
            v,
            x;
          if (_.fn) {
            switch ((_.once && this.removeListener(l, _.fn, void 0, !0), T)) {
              case 1:
                return _.fn.call(_.context), !0;
              case 2:
                return _.fn.call(_.context, u), !0;
              case 3:
                return _.fn.call(_.context, u, c), !0;
              case 4:
                return _.fn.call(_.context, u, c, d), !0;
              case 5:
                return _.fn.call(_.context, u, c, d, f), !0;
              case 6:
                return _.fn.call(_.context, u, c, d, f, p), !0;
            }
            for (x = 1, v = new Array(T - 1); x < T; x++) v[x - 1] = arguments[x];
            _.fn.apply(_.context, v);
          } else {
            var y = _.length,
              E;
            for (x = 0; x < y; x++)
              switch ((_[x].once && this.removeListener(l, _[x].fn, void 0, !0), T)) {
                case 1:
                  _[x].fn.call(_[x].context);
                  break;
                case 2:
                  _[x].fn.call(_[x].context, u);
                  break;
                case 3:
                  _[x].fn.call(_[x].context, u, c);
                  break;
                case 4:
                  _[x].fn.call(_[x].context, u, c, d);
                  break;
                default:
                  if (!v) for (E = 1, v = new Array(T - 1); E < T; E++) v[E - 1] = arguments[E];
                  _[x].fn.apply(_[x].context, v);
              }
          }
          return !0;
        }),
        (o.prototype.on = function (l, u, c) {
          return n(this, l, u, c, !1);
        }),
        (o.prototype.once = function (l, u, c) {
          return n(this, l, u, c, !0);
        }),
        (o.prototype.removeListener = function (l, u, c, d) {
          var f = e ? e + l : l;
          if (!this._events[f]) return this;
          if (!u) return a(this, f), this;
          var p = this._events[f];
          if (p.fn) p.fn === u && (!d || p.once) && (!c || p.context === c) && a(this, f);
          else {
            for (var g = 0, _ = [], T = p.length; g < T; g++)
              (p[g].fn !== u || (d && !p[g].once) || (c && p[g].context !== c)) && _.push(p[g]);
            _.length ? (this._events[f] = _.length === 1 ? _[0] : _) : a(this, f);
          }
          return this;
        }),
        (o.prototype.removeAllListeners = function (l) {
          var u;
          return (
            l
              ? ((u = e ? e + l : l), this._events[u] && a(this, u))
              : ((this._events = new r()), (this._eventsCount = 0)),
            this
          );
        }),
        (o.prototype.off = o.prototype.removeListener),
        (o.prototype.addListener = o.prototype.on),
        (o.prefixed = e),
        (o.EventEmitter = o),
        (i.exports = o);
    }),
    Dr = Ci,
    uh = Ci;
  function Ci(i, t, e) {
    e = e || 2;
    var r = t && t.length,
      s = r ? t[0] * e : i.length,
      n = Un(i, 0, s, e, !0),
      a = [];
    if (!n || n.next === n.prev) return a;
    var o, h, l, u, c, d, f;
    if ((r && (n = mh(i, t, n, e)), i.length > 80 * e)) {
      (o = l = i[0]), (h = u = i[1]);
      for (var p = e; p < s; p += e)
        (c = i[p]),
          (d = i[p + 1]),
          c < o && (o = c),
          d < h && (h = d),
          c > l && (l = c),
          d > u && (u = d);
      (f = Math.max(l - o, u - h)), (f = f !== 0 ? 32767 / f : 0);
    }
    return We(n, a, e, o, h, f, 0), a;
  }
  function Un(i, t, e, r, s) {
    var n, a;
    if (s === Fr(i, t, e, r) > 0) for (n = t; n < e; n += r) a = $n(n, i[n], i[n + 1], a);
    else for (n = e - r; n >= t; n -= r) a = $n(n, i[n], i[n + 1], a);
    return a && Di(a, a.next) && (Ye(a), (a = a.next)), a;
  }
  function Te(i, t) {
    if (!i) return i;
    t || (t = i);
    var e = i,
      r;
    do
      if (((r = !1), !e.steiner && (Di(e, e.next) || st(e.prev, e, e.next) === 0))) {
        if ((Ye(e), (e = t = e.prev), e === e.next)) break;
        r = !0;
      } else e = e.next;
    while (r || e !== t);
    return t;
  }
  function We(i, t, e, r, s, n, a) {
    if (!!i) {
      !a && n && yh(i, r, s, n);
      for (var o = i, h, l; i.prev !== i.next; ) {
        if (((h = i.prev), (l = i.next), n ? dh(i, r, s, n) : ch(i))) {
          t.push((h.i / e) | 0),
            t.push((i.i / e) | 0),
            t.push((l.i / e) | 0),
            Ye(i),
            (i = l.next),
            (o = l.next);
          continue;
        }
        if (((i = l), i === o)) {
          a
            ? a === 1
              ? ((i = fh(Te(i), t, e)), We(i, t, e, r, s, n, 2))
              : a === 2 && ph(i, t, e, r, s, n)
            : We(Te(i), t, e, r, s, n, 1);
          break;
        }
      }
    }
  }
  function ch(i) {
    var t = i.prev,
      e = i,
      r = i.next;
    if (st(t, e, r) >= 0) return !1;
    for (
      var s = t.x,
        n = e.x,
        a = r.x,
        o = t.y,
        h = e.y,
        l = r.y,
        u = s < n ? (s < a ? s : a) : n < a ? n : a,
        c = o < h ? (o < l ? o : l) : h < l ? h : l,
        d = s > n ? (s > a ? s : a) : n > a ? n : a,
        f = o > h ? (o > l ? o : l) : h > l ? h : l,
        p = r.next;
      p !== t;

    ) {
      if (
        p.x >= u &&
        p.x <= d &&
        p.y >= c &&
        p.y <= f &&
        Ce(s, o, n, h, a, l, p.x, p.y) &&
        st(p.prev, p, p.next) >= 0
      )
        return !1;
      p = p.next;
    }
    return !0;
  }
  function dh(i, t, e, r) {
    var s = i.prev,
      n = i,
      a = i.next;
    if (st(s, n, a) >= 0) return !1;
    for (
      var o = s.x,
        h = n.x,
        l = a.x,
        u = s.y,
        c = n.y,
        d = a.y,
        f = o < h ? (o < l ? o : l) : h < l ? h : l,
        p = u < c ? (u < d ? u : d) : c < d ? c : d,
        g = o > h ? (o > l ? o : l) : h > l ? h : l,
        _ = u > c ? (u > d ? u : d) : c > d ? c : d,
        T = Pr(f, p, t, e, r),
        v = Pr(g, _, t, e, r),
        x = i.prevZ,
        y = i.nextZ;
      x && x.z >= T && y && y.z <= v;

    ) {
      if (
        (x.x >= f &&
          x.x <= g &&
          x.y >= p &&
          x.y <= _ &&
          x !== s &&
          x !== a &&
          Ce(o, u, h, c, l, d, x.x, x.y) &&
          st(x.prev, x, x.next) >= 0) ||
        ((x = x.prevZ),
        y.x >= f &&
          y.x <= g &&
          y.y >= p &&
          y.y <= _ &&
          y !== s &&
          y !== a &&
          Ce(o, u, h, c, l, d, y.x, y.y) &&
          st(y.prev, y, y.next) >= 0)
      )
        return !1;
      y = y.nextZ;
    }
    for (; x && x.z >= T; ) {
      if (
        x.x >= f &&
        x.x <= g &&
        x.y >= p &&
        x.y <= _ &&
        x !== s &&
        x !== a &&
        Ce(o, u, h, c, l, d, x.x, x.y) &&
        st(x.prev, x, x.next) >= 0
      )
        return !1;
      x = x.prevZ;
    }
    for (; y && y.z <= v; ) {
      if (
        y.x >= f &&
        y.x <= g &&
        y.y >= p &&
        y.y <= _ &&
        y !== s &&
        y !== a &&
        Ce(o, u, h, c, l, d, y.x, y.y) &&
        st(y.prev, y, y.next) >= 0
      )
        return !1;
      y = y.nextZ;
    }
    return !0;
  }
  function fh(i, t, e) {
    var r = i;
    do {
      var s = r.prev,
        n = r.next.next;
      !Di(s, n) &&
        kn(s, r, r.next, n) &&
        Ve(s, n) &&
        Ve(n, s) &&
        (t.push((s.i / e) | 0),
        t.push((r.i / e) | 0),
        t.push((n.i / e) | 0),
        Ye(r),
        Ye(r.next),
        (r = i = n)),
        (r = r.next);
    } while (r !== i);
    return Te(r);
  }
  function ph(i, t, e, r, s, n) {
    var a = i;
    do {
      for (var o = a.next.next; o !== a.prev; ) {
        if (a.i !== o.i && Eh(a, o)) {
          var h = Xn(a, o);
          (a = Te(a, a.next)),
            (h = Te(h, h.next)),
            We(a, t, e, r, s, n, 0),
            We(h, t, e, r, s, n, 0);
          return;
        }
        o = o.next;
      }
      a = a.next;
    } while (a !== i);
  }
  function mh(i, t, e, r) {
    var s = [],
      n,
      a,
      o,
      h,
      l;
    for (n = 0, a = t.length; n < a; n++)
      (o = t[n] * r),
        (h = n < a - 1 ? t[n + 1] * r : i.length),
        (l = Un(i, o, h, r, !1)),
        l === l.next && (l.steiner = !0),
        s.push(bh(l));
    for (s.sort(_h), n = 0; n < s.length; n++) e = gh(s[n], e);
    return e;
  }
  function _h(i, t) {
    return i.x - t.x;
  }
  function gh(i, t) {
    var e = xh(i, t);
    if (!e) return t;
    var r = Xn(e, i);
    return Te(r, r.next), Te(e, e.next);
  }
  function xh(i, t) {
    var e = t,
      r = i.x,
      s = i.y,
      n = -1 / 0,
      a;
    do {
      if (s <= e.y && s >= e.next.y && e.next.y !== e.y) {
        var o = e.x + ((s - e.y) * (e.next.x - e.x)) / (e.next.y - e.y);
        if (o <= r && o > n && ((n = o), (a = e.x < e.next.x ? e : e.next), o === r)) return a;
      }
      e = e.next;
    } while (e !== t);
    if (!a) return null;
    var h = a,
      l = a.x,
      u = a.y,
      c = 1 / 0,
      d;
    e = a;
    do
      r >= e.x &&
        e.x >= l &&
        r !== e.x &&
        Ce(s < u ? r : n, s, l, u, s < u ? n : r, s, e.x, e.y) &&
        ((d = Math.abs(s - e.y) / (r - e.x)),
        Ve(e, i) &&
          (d < c || (d === c && (e.x > a.x || (e.x === a.x && Th(a, e))))) &&
          ((a = e), (c = d))),
        (e = e.next);
    while (e !== h);
    return a;
  }
  function Th(i, t) {
    return st(i.prev, i, t.prev) < 0 && st(t.next, i, i.next) < 0;
  }
  function yh(i, t, e, r) {
    var s = i;
    do
      s.z === 0 && (s.z = Pr(s.x, s.y, t, e, r)),
        (s.prevZ = s.prev),
        (s.nextZ = s.next),
        (s = s.next);
    while (s !== i);
    (s.prevZ.nextZ = null), (s.prevZ = null), vh(s);
  }
  function vh(i) {
    var t,
      e,
      r,
      s,
      n,
      a,
      o,
      h,
      l = 1;
    do {
      for (e = i, i = null, n = null, a = 0; e; ) {
        for (a++, r = e, o = 0, t = 0; t < l && (o++, (r = r.nextZ), !!r); t++);
        for (h = l; o > 0 || (h > 0 && r); )
          o !== 0 && (h === 0 || !r || e.z <= r.z)
            ? ((s = e), (e = e.nextZ), o--)
            : ((s = r), (r = r.nextZ), h--),
            n ? (n.nextZ = s) : (i = s),
            (s.prevZ = n),
            (n = s);
        e = r;
      }
      (n.nextZ = null), (l *= 2);
    } while (a > 1);
    return i;
  }
  function Pr(i, t, e, r, s) {
    return (
      (i = ((i - e) * s) | 0),
      (t = ((t - r) * s) | 0),
      (i = (i | (i << 8)) & 16711935),
      (i = (i | (i << 4)) & 252645135),
      (i = (i | (i << 2)) & 858993459),
      (i = (i | (i << 1)) & 1431655765),
      (t = (t | (t << 8)) & 16711935),
      (t = (t | (t << 4)) & 252645135),
      (t = (t | (t << 2)) & 858993459),
      (t = (t | (t << 1)) & 1431655765),
      i | (t << 1)
    );
  }
  function bh(i) {
    var t = i,
      e = i;
    do (t.x < e.x || (t.x === e.x && t.y < e.y)) && (e = t), (t = t.next);
    while (t !== i);
    return e;
  }
  function Ce(i, t, e, r, s, n, a, o) {
    return (
      (s - a) * (t - o) >= (i - a) * (n - o) &&
      (i - a) * (r - o) >= (e - a) * (t - o) &&
      (e - a) * (n - o) >= (s - a) * (r - o)
    );
  }
  function Eh(i, t) {
    return (
      i.next.i !== t.i &&
      i.prev.i !== t.i &&
      !Ah(i, t) &&
      ((Ve(i, t) && Ve(t, i) && Rh(i, t) && (st(i.prev, i, t.prev) || st(i, t.prev, t))) ||
        (Di(i, t) && st(i.prev, i, i.next) > 0 && st(t.prev, t, t.next) > 0))
    );
  }
  function st(i, t, e) {
    return (t.y - i.y) * (e.x - t.x) - (t.x - i.x) * (e.y - t.y);
  }
  function Di(i, t) {
    return i.x === t.x && i.y === t.y;
  }
  function kn(i, t, e, r) {
    var s = Oi(st(i, t, e)),
      n = Oi(st(i, t, r)),
      a = Oi(st(e, r, i)),
      o = Oi(st(e, r, t));
    return !!(
      (s !== n && a !== o) ||
      (s === 0 && Pi(i, e, t)) ||
      (n === 0 && Pi(i, r, t)) ||
      (a === 0 && Pi(e, i, r)) ||
      (o === 0 && Pi(e, t, r))
    );
  }
  function Pi(i, t, e) {
    return (
      t.x <= Math.max(i.x, e.x) &&
      t.x >= Math.min(i.x, e.x) &&
      t.y <= Math.max(i.y, e.y) &&
      t.y >= Math.min(i.y, e.y)
    );
  }
  function Oi(i) {
    return i > 0 ? 1 : i < 0 ? -1 : 0;
  }
  function Ah(i, t) {
    var e = i;
    do {
      if (e.i !== i.i && e.next.i !== i.i && e.i !== t.i && e.next.i !== t.i && kn(e, e.next, i, t))
        return !0;
      e = e.next;
    } while (e !== i);
    return !1;
  }
  function Ve(i, t) {
    return st(i.prev, i, i.next) < 0
      ? st(i, t, i.next) >= 0 && st(i, i.prev, t) >= 0
      : st(i, t, i.prev) < 0 || st(i, i.next, t) < 0;
  }
  function Rh(i, t) {
    var e = i,
      r = !1,
      s = (i.x + t.x) / 2,
      n = (i.y + t.y) / 2;
    do
      e.y > n != e.next.y > n &&
        e.next.y !== e.y &&
        s < ((e.next.x - e.x) * (n - e.y)) / (e.next.y - e.y) + e.x &&
        (r = !r),
        (e = e.next);
    while (e !== i);
    return r;
  }
  function Xn(i, t) {
    var e = new Or(i.i, i.x, i.y),
      r = new Or(t.i, t.x, t.y),
      s = i.next,
      n = t.prev;
    return (
      (i.next = t),
      (t.prev = i),
      (e.next = s),
      (s.prev = e),
      (r.next = e),
      (e.prev = r),
      (n.next = r),
      (r.prev = n),
      r
    );
  }
  function $n(i, t, e, r) {
    var s = new Or(i, t, e);
    return (
      r
        ? ((s.next = r.next), (s.prev = r), (r.next.prev = s), (r.next = s))
        : ((s.prev = s), (s.next = s)),
      s
    );
  }
  function Ye(i) {
    (i.next.prev = i.prev),
      (i.prev.next = i.next),
      i.prevZ && (i.prevZ.nextZ = i.nextZ),
      i.nextZ && (i.nextZ.prevZ = i.prevZ);
  }
  function Or(i, t, e) {
    (this.i = i),
      (this.x = t),
      (this.y = e),
      (this.prev = null),
      (this.next = null),
      (this.z = 0),
      (this.prevZ = null),
      (this.nextZ = null),
      (this.steiner = !1);
  }
  Ci.deviation = function (i, t, e, r) {
    var s = t && t.length,
      n = s ? t[0] * e : i.length,
      a = Math.abs(Fr(i, 0, n, e));
    if (s)
      for (var o = 0, h = t.length; o < h; o++) {
        var l = t[o] * e,
          u = o < h - 1 ? t[o + 1] * e : i.length;
        a -= Math.abs(Fr(i, l, u, e));
      }
    var c = 0;
    for (o = 0; o < r.length; o += 3) {
      var d = r[o] * e,
        f = r[o + 1] * e,
        p = r[o + 2] * e;
      c += Math.abs((i[d] - i[p]) * (i[f + 1] - i[d + 1]) - (i[d] - i[f]) * (i[p + 1] - i[d + 1]));
    }
    return a === 0 && c === 0 ? 0 : Math.abs((c - a) / a);
  };
  function Fr(i, t, e, r) {
    for (var s = 0, n = t, a = e - r; n < e; n += r)
      (s += (i[a] - i[n]) * (i[n + 1] + i[a + 1])), (a = n);
    return s;
  }
  (Ci.flatten = function (i) {
    for (
      var t = i[0][0].length, e = { vertices: [], holes: [], dimensions: t }, r = 0, s = 0;
      s < i.length;
      s++
    ) {
      for (var n = 0; n < i[s].length; n++) for (var a = 0; a < t; a++) e.vertices.push(i[s][n][a]);
      s > 0 && ((r += i[s - 1].length), e.holes.push(r));
    }
    return e;
  }),
    (Dr.default = uh);
  var Sh = Cr(function (i, t) {
      /*! https://mths.be/punycode v1.3.2 by @mathias */ (function (e) {
        var r = t && !t.nodeType && t,
          s = i && !i.nodeType && i,
          n = typeof Mr == "object" && Mr;
        (n.global === n || n.window === n || n.self === n) && (e = n);
        var a,
          o = 2147483647,
          h = 36,
          l = 1,
          u = 26,
          c = 38,
          d = 700,
          f = 72,
          p = 128,
          g = "-",
          _ = /^xn--/,
          T = /[^\x20-\x7E]/,
          v = /[\x2E\u3002\uFF0E\uFF61]/g,
          x = {
            overflow: "Overflow: input needs wider integers to process",
            "not-basic": "Illegal input >= 0x80 (not a basic code point)",
            "invalid-input": "Invalid input",
          },
          y = h - l,
          E = Math.floor,
          D = String.fromCharCode,
          I;
        function R(N) {
          throw RangeError(x[N]);
        }
        function U(N, $) {
          for (var W = N.length, K = []; W--; ) K[W] = $(N[W]);
          return K;
        }
        function w(N, $) {
          var W = N.split("@"),
            K = "";
          W.length > 1 && ((K = W[0] + "@"), (N = W[1])), (N = N.replace(v, "."));
          var it = N.split("."),
            ft = U(it, $).join(".");
          return K + ft;
        }
        function C(N) {
          for (var $ = [], W = 0, K = N.length, it, ft; W < K; )
            (it = N.charCodeAt(W++)),
              it >= 55296 && it <= 56319 && W < K
                ? ((ft = N.charCodeAt(W++)),
                  (ft & 64512) == 56320
                    ? $.push(((it & 1023) << 10) + (ft & 1023) + 65536)
                    : ($.push(it), W--))
                : $.push(it);
          return $;
        }
        function H(N) {
          return U(N, function ($) {
            var W = "";
            return (
              $ > 65535 &&
                (($ -= 65536), (W += D((($ >>> 10) & 1023) | 55296)), ($ = 56320 | ($ & 1023))),
              (W += D($)),
              W
            );
          }).join("");
        }
        function b(N) {
          return N - 48 < 10 ? N - 22 : N - 65 < 26 ? N - 65 : N - 97 < 26 ? N - 97 : h;
        }
        function M(N, $) {
          return N + 22 + 75 * (N < 26) - (($ != 0) << 5);
        }
        function q(N, $, W) {
          var K = 0;
          for (N = W ? E(N / d) : N >> 1, N += E(N / $); N > (y * u) >> 1; K += h) N = E(N / y);
          return E(K + ((y + 1) * N) / (N + c));
        }
        function k(N) {
          var $ = [],
            W = N.length,
            K,
            it = 0,
            ft = p,
            at = f,
            pt,
            xt,
            mt,
            gt,
            rt,
            lt,
            Et,
            kt,
            se;
          for (pt = N.lastIndexOf(g), pt < 0 && (pt = 0), xt = 0; xt < pt; ++xt)
            N.charCodeAt(xt) >= 128 && R("not-basic"), $.push(N.charCodeAt(xt));
          for (mt = pt > 0 ? pt + 1 : 0; mt < W; ) {
            for (
              gt = it, rt = 1, lt = h;
              mt >= W && R("invalid-input"),
                (Et = b(N.charCodeAt(mt++))),
                (Et >= h || Et > E((o - it) / rt)) && R("overflow"),
                (it += Et * rt),
                (kt = lt <= at ? l : lt >= at + u ? u : lt - at),
                !(Et < kt);
              lt += h
            )
              (se = h - kt), rt > E(o / se) && R("overflow"), (rt *= se);
            (K = $.length + 1),
              (at = q(it - gt, K, gt == 0)),
              E(it / K) > o - ft && R("overflow"),
              (ft += E(it / K)),
              (it %= K),
              $.splice(it++, 0, ft);
          }
          return H($);
        }
        function X(N) {
          var $,
            W,
            K,
            it,
            ft,
            at,
            pt,
            xt,
            mt,
            gt,
            rt,
            lt = [],
            Et,
            kt,
            se,
            _n;
          for (N = C(N), Et = N.length, $ = p, W = 0, ft = f, at = 0; at < Et; ++at)
            (rt = N[at]), rt < 128 && lt.push(D(rt));
          for (K = it = lt.length, it && lt.push(g); K < Et; ) {
            for (pt = o, at = 0; at < Et; ++at) (rt = N[at]), rt >= $ && rt < pt && (pt = rt);
            for (
              kt = K + 1,
                pt - $ > E((o - W) / kt) && R("overflow"),
                W += (pt - $) * kt,
                $ = pt,
                at = 0;
              at < Et;
              ++at
            )
              if (((rt = N[at]), rt < $ && ++W > o && R("overflow"), rt == $)) {
                for (
                  xt = W, mt = h;
                  (gt = mt <= ft ? l : mt >= ft + u ? u : mt - ft), !(xt < gt);
                  mt += h
                )
                  (_n = xt - gt),
                    (se = h - gt),
                    lt.push(D(M(gt + (_n % se), 0))),
                    (xt = E(_n / se));
                lt.push(D(M(xt, 0))), (ft = q(W, kt, K == it)), (W = 0), ++K;
              }
            ++W, ++$;
          }
          return lt.join("");
        }
        function et(N) {
          return w(N, function ($) {
            return _.test($) ? k($.slice(4).toLowerCase()) : $;
          });
        }
        function j(N) {
          return w(N, function ($) {
            return T.test($) ? "xn--" + X($) : $;
          });
        }
        if (
          ((a = {
            version: "1.3.2",
            ucs2: { decode: C, encode: H },
            decode: k,
            encode: X,
            toASCII: j,
            toUnicode: et,
          }),
          r && s)
        )
          if (i.exports == r) s.exports = a;
          else for (I in a) a.hasOwnProperty(I) && (r[I] = a[I]);
        else e.punycode = a;
      })(Mr);
    }),
    Ht = {
      isString: function (i) {
        return typeof i == "string";
      },
      isObject: function (i) {
        return typeof i == "object" && i !== null;
      },
      isNull: function (i) {
        return i === null;
      },
      isNullOrUndefined: function (i) {
        return i == null;
      },
    };
  function Ih(i, t) {
    return Object.prototype.hasOwnProperty.call(i, t);
  }
  var wh = function (i, t, e, r) {
      (t = t || "&"), (e = e || "=");
      var s = {};
      if (typeof i != "string" || i.length === 0) return s;
      var n = /\+/g;
      i = i.split(t);
      var a = 1e3;
      r && typeof r.maxKeys == "number" && (a = r.maxKeys);
      var o = i.length;
      a > 0 && o > a && (o = a);
      for (var h = 0; h < o; ++h) {
        var l = i[h].replace(n, "%20"),
          u = l.indexOf(e),
          c,
          d,
          f,
          p;
        u >= 0 ? ((c = l.substr(0, u)), (d = l.substr(u + 1))) : ((c = l), (d = "")),
          (f = decodeURIComponent(c)),
          (p = decodeURIComponent(d)),
          Ih(s, f) ? (Array.isArray(s[f]) ? s[f].push(p) : (s[f] = [s[f], p])) : (s[f] = p);
      }
      return s;
    },
    je = function (i) {
      switch (typeof i) {
        case "string":
          return i;
        case "boolean":
          return i ? "true" : "false";
        case "number":
          return isFinite(i) ? i : "";
        default:
          return "";
      }
    },
    Mh = function (i, t, e, r) {
      return (
        (t = t || "&"),
        (e = e || "="),
        i === null && (i = void 0),
        typeof i == "object"
          ? Object.keys(i)
              .map(function (s) {
                var n = encodeURIComponent(je(s)) + e;
                return Array.isArray(i[s])
                  ? i[s]
                      .map(function (a) {
                        return n + encodeURIComponent(je(a));
                      })
                      .join(t)
                  : n + encodeURIComponent(je(i[s]));
              })
              .join(t)
          : r
          ? encodeURIComponent(je(r)) + e + encodeURIComponent(je(i))
          : ""
      );
    },
    Nr = Cr(function (i, t) {
      "use strict";
      (t.decode = t.parse = wh), (t.encode = t.stringify = Mh);
    }),
    Hn = qe,
    zn = Xh,
    Ch = $h,
    Wn = kh,
    Dh = Rt;
  function Rt() {
    (this.protocol = null),
      (this.slashes = null),
      (this.auth = null),
      (this.host = null),
      (this.port = null),
      (this.hostname = null),
      (this.hash = null),
      (this.search = null),
      (this.query = null),
      (this.pathname = null),
      (this.path = null),
      (this.href = null);
  }
  var Ph = /^([a-z0-9.+-]+:)/i,
    Oh = /:[0-9]*$/,
    Fh = /^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,
    Nh = [
      "<",
      ">",
      '"',
      "`",
      " ",
      "\r",
      `
`,
      "	",
    ],
    Bh = ["{", "}", "|", "\\", "^", "`"].concat(Nh),
    Br = ["'"].concat(Bh),
    Vn = ["%", "/", "?", ";", "#"].concat(Br),
    Yn = ["/", "?", "#"],
    Lh = 255,
    jn = /^[+a-z0-9A-Z_-]{0,63}$/,
    Gh = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,
    Uh = { javascript: !0, "javascript:": !0 },
    Lr = { javascript: !0, "javascript:": !0 },
    De = {
      http: !0,
      https: !0,
      ftp: !0,
      gopher: !0,
      file: !0,
      "http:": !0,
      "https:": !0,
      "ftp:": !0,
      "gopher:": !0,
      "file:": !0,
    };
  function qe(i, t, e) {
    if (i && Ht.isObject(i) && i instanceof Rt) return i;
    var r = new Rt();
    return r.parse(i, t, e), r;
  }
  Rt.prototype.parse = function (i, t, e) {
    if (!Ht.isString(i)) throw new TypeError("Parameter 'url' must be a string, not " + typeof i);
    var r = i.indexOf("?"),
      s = r !== -1 && r < i.indexOf("#") ? "?" : "#",
      n = i.split(s),
      a = /\\/g;
    (n[0] = n[0].replace(a, "/")), (i = n.join(s));
    var o = i;
    if (((o = o.trim()), !e && i.split("#").length === 1)) {
      var h = Fh.exec(o);
      if (h)
        return (
          (this.path = o),
          (this.href = o),
          (this.pathname = h[1]),
          h[2]
            ? ((this.search = h[2]),
              t
                ? (this.query = Nr.parse(this.search.substr(1)))
                : (this.query = this.search.substr(1)))
            : t && ((this.search = ""), (this.query = {})),
          this
        );
    }
    var l = Ph.exec(o);
    if (l) {
      l = l[0];
      var u = l.toLowerCase();
      (this.protocol = u), (o = o.substr(l.length));
    }
    if (e || l || o.match(/^\/\/[^@\/]+@[^@\/]+/)) {
      var c = o.substr(0, 2) === "//";
      c && !(l && Lr[l]) && ((o = o.substr(2)), (this.slashes = !0));
    }
    if (!Lr[l] && (c || (l && !De[l]))) {
      for (var d = -1, f = 0; f < Yn.length; f++) {
        var p = o.indexOf(Yn[f]);
        p !== -1 && (d === -1 || p < d) && (d = p);
      }
      var g, _;
      d === -1 ? (_ = o.lastIndexOf("@")) : (_ = o.lastIndexOf("@", d)),
        _ !== -1 &&
          ((g = o.slice(0, _)), (o = o.slice(_ + 1)), (this.auth = decodeURIComponent(g))),
        (d = -1);
      for (var f = 0; f < Vn.length; f++) {
        var p = o.indexOf(Vn[f]);
        p !== -1 && (d === -1 || p < d) && (d = p);
      }
      d === -1 && (d = o.length),
        (this.host = o.slice(0, d)),
        (o = o.slice(d)),
        this.parseHost(),
        (this.hostname = this.hostname || "");
      var T = this.hostname[0] === "[" && this.hostname[this.hostname.length - 1] === "]";
      if (!T)
        for (var v = this.hostname.split(/\./), f = 0, x = v.length; f < x; f++) {
          var y = v[f];
          if (!!y && !y.match(jn)) {
            for (var E = "", D = 0, I = y.length; D < I; D++)
              y.charCodeAt(D) > 127 ? (E += "x") : (E += y[D]);
            if (!E.match(jn)) {
              var R = v.slice(0, f),
                U = v.slice(f + 1),
                w = y.match(Gh);
              w && (R.push(w[1]), U.unshift(w[2])),
                U.length && (o = "/" + U.join(".") + o),
                (this.hostname = R.join("."));
              break;
            }
          }
        }
      this.hostname.length > Lh
        ? (this.hostname = "")
        : (this.hostname = this.hostname.toLowerCase()),
        T || (this.hostname = Sh.toASCII(this.hostname));
      var C = this.port ? ":" + this.port : "",
        H = this.hostname || "";
      (this.host = H + C),
        (this.href += this.host),
        T &&
          ((this.hostname = this.hostname.substr(1, this.hostname.length - 2)),
          o[0] !== "/" && (o = "/" + o));
    }
    if (!Uh[u])
      for (var f = 0, x = Br.length; f < x; f++) {
        var b = Br[f];
        if (o.indexOf(b) !== -1) {
          var M = encodeURIComponent(b);
          M === b && (M = escape(b)), (o = o.split(b).join(M));
        }
      }
    var q = o.indexOf("#");
    q !== -1 && ((this.hash = o.substr(q)), (o = o.slice(0, q)));
    var k = o.indexOf("?");
    if (
      (k !== -1
        ? ((this.search = o.substr(k)),
          (this.query = o.substr(k + 1)),
          t && (this.query = Nr.parse(this.query)),
          (o = o.slice(0, k)))
        : t && ((this.search = ""), (this.query = {})),
      o && (this.pathname = o),
      De[u] && this.hostname && !this.pathname && (this.pathname = "/"),
      this.pathname || this.search)
    ) {
      var C = this.pathname || "",
        X = this.search || "";
      this.path = C + X;
    }
    return (this.href = this.format()), this;
  };
  function kh(i) {
    return (
      Ht.isString(i) && (i = qe(i)), i instanceof Rt ? i.format() : Rt.prototype.format.call(i)
    );
  }
  Rt.prototype.format = function () {
    var i = this.auth || "";
    i && ((i = encodeURIComponent(i)), (i = i.replace(/%3A/i, ":")), (i += "@"));
    var t = this.protocol || "",
      e = this.pathname || "",
      r = this.hash || "",
      s = !1,
      n = "";
    this.host
      ? (s = i + this.host)
      : this.hostname &&
        ((s = i + (this.hostname.indexOf(":") === -1 ? this.hostname : "[" + this.hostname + "]")),
        this.port && (s += ":" + this.port)),
      this.query &&
        Ht.isObject(this.query) &&
        Object.keys(this.query).length &&
        (n = Nr.stringify(this.query));
    var a = this.search || (n && "?" + n) || "";
    return (
      t && t.substr(-1) !== ":" && (t += ":"),
      this.slashes || ((!t || De[t]) && s !== !1)
        ? ((s = "//" + (s || "")), e && e.charAt(0) !== "/" && (e = "/" + e))
        : s || (s = ""),
      r && r.charAt(0) !== "#" && (r = "#" + r),
      a && a.charAt(0) !== "?" && (a = "?" + a),
      (e = e.replace(/[?#]/g, function (o) {
        return encodeURIComponent(o);
      })),
      (a = a.replace("#", "%23")),
      t + s + e + a + r
    );
  };
  function Xh(i, t) {
    return qe(i, !1, !0).resolve(t);
  }
  Rt.prototype.resolve = function (i) {
    return this.resolveObject(qe(i, !1, !0)).format();
  };
  function $h(i, t) {
    return i ? qe(i, !1, !0).resolveObject(t) : t;
  }
  (Rt.prototype.resolveObject = function (i) {
    if (Ht.isString(i)) {
      var t = new Rt();
      t.parse(i, !1, !0), (i = t);
    }
    for (var e = new Rt(), r = Object.keys(this), s = 0; s < r.length; s++) {
      var n = r[s];
      e[n] = this[n];
    }
    if (((e.hash = i.hash), i.href === "")) return (e.href = e.format()), e;
    if (i.slashes && !i.protocol) {
      for (var a = Object.keys(i), o = 0; o < a.length; o++) {
        var h = a[o];
        h !== "protocol" && (e[h] = i[h]);
      }
      return (
        De[e.protocol] && e.hostname && !e.pathname && (e.path = e.pathname = "/"),
        (e.href = e.format()),
        e
      );
    }
    if (i.protocol && i.protocol !== e.protocol) {
      if (!De[i.protocol]) {
        for (var l = Object.keys(i), u = 0; u < l.length; u++) {
          var c = l[u];
          e[c] = i[c];
        }
        return (e.href = e.format()), e;
      }
      if (((e.protocol = i.protocol), !i.host && !Lr[i.protocol])) {
        for (var x = (i.pathname || "").split("/"); x.length && !(i.host = x.shift()); );
        i.host || (i.host = ""),
          i.hostname || (i.hostname = ""),
          x[0] !== "" && x.unshift(""),
          x.length < 2 && x.unshift(""),
          (e.pathname = x.join("/"));
      } else e.pathname = i.pathname;
      if (
        ((e.search = i.search),
        (e.query = i.query),
        (e.host = i.host || ""),
        (e.auth = i.auth),
        (e.hostname = i.hostname || i.host),
        (e.port = i.port),
        e.pathname || e.search)
      ) {
        var d = e.pathname || "",
          f = e.search || "";
        e.path = d + f;
      }
      return (e.slashes = e.slashes || i.slashes), (e.href = e.format()), e;
    }
    var p = e.pathname && e.pathname.charAt(0) === "/",
      g = i.host || (i.pathname && i.pathname.charAt(0) === "/"),
      _ = g || p || (e.host && i.pathname),
      T = _,
      v = (e.pathname && e.pathname.split("/")) || [],
      x = (i.pathname && i.pathname.split("/")) || [],
      y = e.protocol && !De[e.protocol];
    if (
      (y &&
        ((e.hostname = ""),
        (e.port = null),
        e.host && (v[0] === "" ? (v[0] = e.host) : v.unshift(e.host)),
        (e.host = ""),
        i.protocol &&
          ((i.hostname = null),
          (i.port = null),
          i.host && (x[0] === "" ? (x[0] = i.host) : x.unshift(i.host)),
          (i.host = null)),
        (_ = _ && (x[0] === "" || v[0] === ""))),
      g)
    )
      (e.host = i.host || i.host === "" ? i.host : e.host),
        (e.hostname = i.hostname || i.hostname === "" ? i.hostname : e.hostname),
        (e.search = i.search),
        (e.query = i.query),
        (v = x);
    else if (x.length)
      v || (v = []), v.pop(), (v = v.concat(x)), (e.search = i.search), (e.query = i.query);
    else if (!Ht.isNullOrUndefined(i.search)) {
      if (y) {
        e.hostname = e.host = v.shift();
        var E = e.host && e.host.indexOf("@") > 0 ? e.host.split("@") : !1;
        E && ((e.auth = E.shift()), (e.host = e.hostname = E.shift()));
      }
      return (
        (e.search = i.search),
        (e.query = i.query),
        (!Ht.isNull(e.pathname) || !Ht.isNull(e.search)) &&
          (e.path = (e.pathname ? e.pathname : "") + (e.search ? e.search : "")),
        (e.href = e.format()),
        e
      );
    }
    if (!v.length)
      return (
        (e.pathname = null),
        e.search ? (e.path = "/" + e.search) : (e.path = null),
        (e.href = e.format()),
        e
      );
    for (
      var D = v.slice(-1)[0],
        I = ((e.host || i.host || v.length > 1) && (D === "." || D === "..")) || D === "",
        R = 0,
        U = v.length;
      U >= 0;
      U--
    )
      (D = v[U]),
        D === "."
          ? v.splice(U, 1)
          : D === ".."
          ? (v.splice(U, 1), R++)
          : R && (v.splice(U, 1), R--);
    if (!_ && !T) for (; R--; R) v.unshift("..");
    _ && v[0] !== "" && (!v[0] || v[0].charAt(0) !== "/") && v.unshift(""),
      I && v.join("/").substr(-1) !== "/" && v.push("");
    var w = v[0] === "" || (v[0] && v[0].charAt(0) === "/");
    if (y) {
      e.hostname = e.host = w ? "" : v.length ? v.shift() : "";
      var E = e.host && e.host.indexOf("@") > 0 ? e.host.split("@") : !1;
      E && ((e.auth = E.shift()), (e.host = e.hostname = E.shift()));
    }
    return (
      (_ = _ || (e.host && v.length)),
      _ && !w && v.unshift(""),
      v.length ? (e.pathname = v.join("/")) : ((e.pathname = null), (e.path = null)),
      (!Ht.isNull(e.pathname) || !Ht.isNull(e.search)) &&
        (e.path = (e.pathname ? e.pathname : "") + (e.search ? e.search : "")),
      (e.auth = i.auth || e.auth),
      (e.slashes = e.slashes || i.slashes),
      (e.href = e.format()),
      e
    );
  }),
    (Rt.prototype.parseHost = function () {
      var i = this.host,
        t = Oh.exec(i);
      t &&
        ((t = t[0]),
        t !== ":" && (this.port = t.substr(1)),
        (i = i.substr(0, i.length - t.length))),
        i && (this.hostname = i);
    });
  var Lp = { parse: Hn, resolve: zn, resolveObject: Ch, format: Wn, Url: Dh };
  const qn = { parse: Hn, format: Wn, resolve: zn };
  function Nt(i) {
    if (typeof i != "string")
      throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`);
  }
  function Kn(i) {
    return i.split("?")[0].split("#")[0];
  }
  function Hh(i) {
    return i.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  }
  function zh(i, t, e) {
    return i.replace(new RegExp(Hh(t), "g"), e);
  }
  function Wh(i, t) {
    let e = "",
      r = 0,
      s = -1,
      n = 0,
      a;
    for (let o = 0; o <= i.length; ++o) {
      if (o < i.length) a = i.charCodeAt(o);
      else {
        if (a === 47) break;
        a = 47;
      }
      if (a === 47) {
        if (!(s === o - 1 || n === 1))
          if (s !== o - 1 && n === 2) {
            if (
              e.length < 2 ||
              r !== 2 ||
              e.charCodeAt(e.length - 1) !== 46 ||
              e.charCodeAt(e.length - 2) !== 46
            ) {
              if (e.length > 2) {
                const h = e.lastIndexOf("/");
                if (h !== e.length - 1) {
                  h === -1
                    ? ((e = ""), (r = 0))
                    : ((e = e.slice(0, h)), (r = e.length - 1 - e.lastIndexOf("/"))),
                    (s = o),
                    (n = 0);
                  continue;
                }
              } else if (e.length === 2 || e.length === 1) {
                (e = ""), (r = 0), (s = o), (n = 0);
                continue;
              }
            }
            t && (e.length > 0 ? (e += "/..") : (e = ".."), (r = 2));
          } else
            e.length > 0 ? (e += `/${i.slice(s + 1, o)}`) : (e = i.slice(s + 1, o)),
              (r = o - s - 1);
        (s = o), (n = 0);
      } else a === 46 && n !== -1 ? ++n : (n = -1);
    }
    return e;
  }
  const dt = {
    toPosix(i) {
      return zh(i, "\\", "/");
    },
    isUrl(i) {
      return /^https?:/.test(this.toPosix(i));
    },
    isDataUrl(i) {
      return /^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(
        i
      );
    },
    hasProtocol(i) {
      return /^[^/:]+:\//.test(this.toPosix(i));
    },
    getProtocol(i) {
      Nt(i), (i = this.toPosix(i));
      let t = "";
      const e = /^file:\/\/\//.exec(i),
        r = /^[^/:]+:\/\//.exec(i),
        s = /^[^/:]+:\//.exec(i);
      if (e || r || s) {
        const n =
          (e == null ? void 0 : e[0]) || (r == null ? void 0 : r[0]) || (s == null ? void 0 : s[0]);
        (t = n), (i = i.slice(n.length));
      }
      return t;
    },
    toAbsolute(i, t, e) {
      if (this.isDataUrl(i)) return i;
      const r = Kn(this.toPosix(t != null ? t : A.ADAPTER.getBaseUrl())),
        s = Kn(this.toPosix(e != null ? e : this.rootname(r)));
      return (
        Nt(i),
        (i = this.toPosix(i)),
        i.startsWith("/") ? dt.join(s, i.slice(1)) : this.isAbsolute(i) ? i : this.join(r, i)
      );
    },
    normalize(i) {
      if (((i = this.toPosix(i)), Nt(i), i.length === 0)) return ".";
      let t = "";
      const e = i.startsWith("/");
      this.hasProtocol(i) && ((t = this.rootname(i)), (i = i.slice(t.length)));
      const r = i.endsWith("/");
      return (i = Wh(i, !1)), i.length > 0 && r && (i += "/"), e ? `/${i}` : t + i;
    },
    isAbsolute(i) {
      return Nt(i), (i = this.toPosix(i)), this.hasProtocol(i) ? !0 : i.startsWith("/");
    },
    join(...i) {
      var e;
      if (i.length === 0) return ".";
      let t;
      for (let r = 0; r < i.length; ++r) {
        const s = i[r];
        if ((Nt(s), s.length > 0))
          if (t === void 0) t = s;
          else {
            const n = (e = i[r - 1]) != null ? e : "";
            this.extname(n) ? (t += `/../${s}`) : (t += `/${s}`);
          }
      }
      return t === void 0 ? "." : this.normalize(t);
    },
    dirname(i) {
      if ((Nt(i), i.length === 0)) return ".";
      i = this.toPosix(i);
      let t = i.charCodeAt(0);
      const e = t === 47;
      let r = -1,
        s = !0;
      const n = this.getProtocol(i),
        a = i;
      i = i.slice(n.length);
      for (let o = i.length - 1; o >= 1; --o)
        if (((t = i.charCodeAt(o)), t === 47)) {
          if (!s) {
            r = o;
            break;
          }
        } else s = !1;
      return r === -1
        ? e
          ? "/"
          : this.isUrl(a)
          ? n + i
          : n
        : e && r === 1
        ? "//"
        : n + i.slice(0, r);
    },
    rootname(i) {
      Nt(i), (i = this.toPosix(i));
      let t = "";
      if ((i.startsWith("/") ? (t = "/") : (t = this.getProtocol(i)), this.isUrl(i))) {
        const e = i.indexOf("/", t.length);
        e !== -1 ? (t = i.slice(0, e)) : (t = i), t.endsWith("/") || (t += "/");
      }
      return t;
    },
    basename(i, t) {
      Nt(i), t && Nt(t), (i = this.toPosix(i));
      let e = 0,
        r = -1,
        s = !0,
        n;
      if (t !== void 0 && t.length > 0 && t.length <= i.length) {
        if (t.length === i.length && t === i) return "";
        let a = t.length - 1,
          o = -1;
        for (n = i.length - 1; n >= 0; --n) {
          const h = i.charCodeAt(n);
          if (h === 47) {
            if (!s) {
              e = n + 1;
              break;
            }
          } else
            o === -1 && ((s = !1), (o = n + 1)),
              a >= 0 && (h === t.charCodeAt(a) ? --a === -1 && (r = n) : ((a = -1), (r = o)));
        }
        return e === r ? (r = o) : r === -1 && (r = i.length), i.slice(e, r);
      }
      for (n = i.length - 1; n >= 0; --n)
        if (i.charCodeAt(n) === 47) {
          if (!s) {
            e = n + 1;
            break;
          }
        } else r === -1 && ((s = !1), (r = n + 1));
      return r === -1 ? "" : i.slice(e, r);
    },
    extname(i) {
      Nt(i), (i = this.toPosix(i));
      let t = -1,
        e = 0,
        r = -1,
        s = !0,
        n = 0;
      for (let a = i.length - 1; a >= 0; --a) {
        const o = i.charCodeAt(a);
        if (o === 47) {
          if (!s) {
            e = a + 1;
            break;
          }
          continue;
        }
        r === -1 && ((s = !1), (r = a + 1)),
          o === 46 ? (t === -1 ? (t = a) : n !== 1 && (n = 1)) : t !== -1 && (n = -1);
      }
      return t === -1 || r === -1 || n === 0 || (n === 1 && t === r - 1 && t === e + 1)
        ? ""
        : i.slice(t, r);
    },
    parse(i) {
      Nt(i);
      const t = { root: "", dir: "", base: "", ext: "", name: "" };
      if (i.length === 0) return t;
      i = this.toPosix(i);
      let e = i.charCodeAt(0);
      const r = this.isAbsolute(i);
      let s;
      (t.root = this.rootname(i)), r || this.hasProtocol(i) ? (s = 1) : (s = 0);
      let n = -1,
        a = 0,
        o = -1,
        h = !0,
        l = i.length - 1,
        u = 0;
      for (; l >= s; --l) {
        if (((e = i.charCodeAt(l)), e === 47)) {
          if (!h) {
            a = l + 1;
            break;
          }
          continue;
        }
        o === -1 && ((h = !1), (o = l + 1)),
          e === 46 ? (n === -1 ? (n = l) : u !== 1 && (u = 1)) : n !== -1 && (u = -1);
      }
      return (
        n === -1 || o === -1 || u === 0 || (u === 1 && n === o - 1 && n === a + 1)
          ? o !== -1 &&
            (a === 0 && r ? (t.base = t.name = i.slice(1, o)) : (t.base = t.name = i.slice(a, o)))
          : (a === 0 && r
              ? ((t.name = i.slice(1, n)), (t.base = i.slice(1, o)))
              : ((t.name = i.slice(a, n)), (t.base = i.slice(a, o))),
            (t.ext = i.slice(n, o))),
        (t.dir = this.dirname(i)),
        t
      );
    },
    sep: "/",
    delimiter: ":",
  };
  (A.RETINA_PREFIX = /@([0-9\.]+)x/), (A.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT = !1);
  let Gr = !1;
  const Zn = "7.0.0-alpha";
  function Vh() {
    Gr = !0;
  }
  function Qn(i) {
    if (!Gr) {
      if (A.ADAPTER.getNavigator().userAgent.toLowerCase().indexOf("chrome") > -1) {
        const t = [
          `
 %c %c %c PixiJS ${Zn} - \u2730 ${i} \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 

`,
          "background: #ff66a5; padding:5px 0;",
          "background: #ff66a5; padding:5px 0;",
          "color: #ff66a5; background: #030307; padding:5px 0;",
          "background: #ff66a5; padding:5px 0;",
          "background: #ffc3dc; padding:5px 0;",
          "background: #ff66a5; padding:5px 0;",
          "color: #ff2424; background: #fff; padding:5px 0;",
          "color: #ff2424; background: #fff; padding:5px 0;",
          "color: #ff2424; background: #fff; padding:5px 0;",
        ];
        globalThis.console.log(...t);
      } else
        globalThis.console &&
          globalThis.console.log(`PixiJS ${Zn} - ${i} - http://www.pixijs.com/`);
      Gr = !0;
    }
  }
  let Ur;
  function Jn() {
    return (
      typeof Ur > "u" &&
        (Ur = (function () {
          const i = {
            stencil: !0,
            failIfMajorPerformanceCaveat: A.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT,
          };
          try {
            if (!A.ADAPTER.getWebGLRenderingContext()) return !1;
            const t = A.ADAPTER.createCanvas();
            let e = t.getContext("webgl", i) || t.getContext("experimental-webgl", i);
            const r = !!(e && e.getContextAttributes().stencil);
            if (e) {
              const s = e.getExtension("WEBGL_lose_context");
              s && s.loseContext();
            }
            return (e = null), r;
          } catch (t) {
            return !1;
          }
        })()),
      Ur
    );
  }
  var Yh = "#f0f8ff",
    jh = "#faebd7",
    qh = "#00ffff",
    Kh = "#7fffd4",
    Zh = "#f0ffff",
    Qh = "#f5f5dc",
    Jh = "#ffe4c4",
    tl = "#000000",
    el = "#ffebcd",
    il = "#0000ff",
    rl = "#8a2be2",
    sl = "#a52a2a",
    nl = "#deb887",
    al = "#5f9ea0",
    ol = "#7fff00",
    hl = "#d2691e",
    ll = "#ff7f50",
    ul = "#6495ed",
    cl = "#fff8dc",
    dl = "#dc143c",
    fl = "#00ffff",
    pl = "#00008b",
    ml = "#008b8b",
    _l = "#b8860b",
    gl = "#a9a9a9",
    xl = "#006400",
    Tl = "#a9a9a9",
    yl = "#bdb76b",
    vl = "#8b008b",
    bl = "#556b2f",
    El = "#ff8c00",
    Al = "#9932cc",
    Rl = "#8b0000",
    Sl = "#e9967a",
    Il = "#8fbc8f",
    wl = "#483d8b",
    Ml = "#2f4f4f",
    Cl = "#2f4f4f",
    Dl = "#00ced1",
    Pl = "#9400d3",
    Ol = "#ff1493",
    Fl = "#00bfff",
    Nl = "#696969",
    Bl = "#696969",
    Ll = "#1e90ff",
    Gl = "#b22222",
    Ul = "#fffaf0",
    kl = "#228b22",
    Xl = "#ff00ff",
    $l = "#dcdcdc",
    Hl = "#f8f8ff",
    zl = "#daa520",
    Wl = "#ffd700",
    Vl = "#808080",
    Yl = "#008000",
    jl = "#adff2f",
    ql = "#808080",
    Kl = "#f0fff0",
    Zl = "#ff69b4",
    Ql = "#cd5c5c",
    Jl = "#4b0082",
    tu = "#fffff0",
    eu = "#f0e68c",
    iu = "#fff0f5",
    ru = "#e6e6fa",
    su = "#7cfc00",
    nu = "#fffacd",
    au = "#add8e6",
    ou = "#f08080",
    hu = "#e0ffff",
    lu = "#fafad2",
    uu = "#d3d3d3",
    cu = "#90ee90",
    du = "#d3d3d3",
    fu = "#ffb6c1",
    pu = "#ffa07a",
    mu = "#20b2aa",
    _u = "#87cefa",
    gu = "#778899",
    xu = "#778899",
    Tu = "#b0c4de",
    yu = "#ffffe0",
    vu = "#00ff00",
    bu = "#32cd32",
    Eu = "#faf0e6",
    Au = "#ff00ff",
    Ru = "#800000",
    Su = "#66cdaa",
    Iu = "#0000cd",
    wu = "#ba55d3",
    Mu = "#9370db",
    Cu = "#3cb371",
    Du = "#7b68ee",
    Pu = "#00fa9a",
    Ou = "#48d1cc",
    Fu = "#c71585",
    Nu = "#191970",
    Bu = "#f5fffa",
    Lu = "#ffe4e1",
    Gu = "#ffe4b5",
    Uu = "#ffdead",
    ku = "#000080",
    Xu = "#fdf5e6",
    $u = "#808000",
    Hu = "#6b8e23",
    zu = "#ffa500",
    Wu = "#ff4500",
    Vu = "#da70d6",
    Yu = "#eee8aa",
    ju = "#98fb98",
    qu = "#afeeee",
    Ku = "#db7093",
    Zu = "#ffefd5",
    Qu = "#ffdab9",
    Ju = "#cd853f",
    tc = "#ffc0cb",
    ec = "#dda0dd",
    ic = "#b0e0e6",
    rc = "#800080",
    sc = "#663399",
    nc = "#ff0000",
    ac = "#bc8f8f",
    oc = "#4169e1",
    hc = "#8b4513",
    lc = "#fa8072",
    uc = "#f4a460",
    cc = "#2e8b57",
    dc = "#fff5ee",
    fc = "#a0522d",
    pc = "#c0c0c0",
    mc = "#87ceeb",
    _c = "#6a5acd",
    gc = "#708090",
    xc = "#708090",
    Tc = "#fffafa",
    yc = "#00ff7f",
    vc = "#4682b4",
    bc = "#d2b48c",
    Ec = "#008080",
    Ac = "#d8bfd8",
    Rc = "#ff6347",
    Sc = "#40e0d0",
    Ic = "#ee82ee",
    wc = "#f5deb3",
    Mc = "#ffffff",
    Cc = "#f5f5f5",
    Dc = "#ffff00",
    Pc = "#9acd32",
    Oc = {
      aliceblue: Yh,
      antiquewhite: jh,
      aqua: qh,
      aquamarine: Kh,
      azure: Zh,
      beige: Qh,
      bisque: Jh,
      black: tl,
      blanchedalmond: el,
      blue: il,
      blueviolet: rl,
      brown: sl,
      burlywood: nl,
      cadetblue: al,
      chartreuse: ol,
      chocolate: hl,
      coral: ll,
      cornflowerblue: ul,
      cornsilk: cl,
      crimson: dl,
      cyan: fl,
      darkblue: pl,
      darkcyan: ml,
      darkgoldenrod: _l,
      darkgray: gl,
      darkgreen: xl,
      darkgrey: Tl,
      darkkhaki: yl,
      darkmagenta: vl,
      darkolivegreen: bl,
      darkorange: El,
      darkorchid: Al,
      darkred: Rl,
      darksalmon: Sl,
      darkseagreen: Il,
      darkslateblue: wl,
      darkslategray: Ml,
      darkslategrey: Cl,
      darkturquoise: Dl,
      darkviolet: Pl,
      deeppink: Ol,
      deepskyblue: Fl,
      dimgray: Nl,
      dimgrey: Bl,
      dodgerblue: Ll,
      firebrick: Gl,
      floralwhite: Ul,
      forestgreen: kl,
      fuchsia: Xl,
      gainsboro: $l,
      ghostwhite: Hl,
      goldenrod: zl,
      gold: Wl,
      gray: Vl,
      green: Yl,
      greenyellow: jl,
      grey: ql,
      honeydew: Kl,
      hotpink: Zl,
      indianred: Ql,
      indigo: Jl,
      ivory: tu,
      khaki: eu,
      lavenderblush: iu,
      lavender: ru,
      lawngreen: su,
      lemonchiffon: nu,
      lightblue: au,
      lightcoral: ou,
      lightcyan: hu,
      lightgoldenrodyellow: lu,
      lightgray: uu,
      lightgreen: cu,
      lightgrey: du,
      lightpink: fu,
      lightsalmon: pu,
      lightseagreen: mu,
      lightskyblue: _u,
      lightslategray: gu,
      lightslategrey: xu,
      lightsteelblue: Tu,
      lightyellow: yu,
      lime: vu,
      limegreen: bu,
      linen: Eu,
      magenta: Au,
      maroon: Ru,
      mediumaquamarine: Su,
      mediumblue: Iu,
      mediumorchid: wu,
      mediumpurple: Mu,
      mediumseagreen: Cu,
      mediumslateblue: Du,
      mediumspringgreen: Pu,
      mediumturquoise: Ou,
      mediumvioletred: Fu,
      midnightblue: Nu,
      mintcream: Bu,
      mistyrose: Lu,
      moccasin: Gu,
      navajowhite: Uu,
      navy: ku,
      oldlace: Xu,
      olive: $u,
      olivedrab: Hu,
      orange: zu,
      orangered: Wu,
      orchid: Vu,
      palegoldenrod: Yu,
      palegreen: ju,
      paleturquoise: qu,
      palevioletred: Ku,
      papayawhip: Zu,
      peachpuff: Qu,
      peru: Ju,
      pink: tc,
      plum: ec,
      powderblue: ic,
      purple: rc,
      rebeccapurple: sc,
      red: nc,
      rosybrown: ac,
      royalblue: oc,
      saddlebrown: hc,
      salmon: lc,
      sandybrown: uc,
      seagreen: cc,
      seashell: dc,
      sienna: fc,
      silver: pc,
      skyblue: mc,
      slateblue: _c,
      slategray: gc,
      slategrey: xc,
      snow: Tc,
      springgreen: yc,
      steelblue: vc,
      tan: bc,
      teal: Ec,
      thistle: Ac,
      tomato: Rc,
      turquoise: Sc,
      violet: Ic,
      wheat: wc,
      white: Mc,
      whitesmoke: Cc,
      yellow: Dc,
      yellowgreen: Pc,
    };
  function ye(i, t = []) {
    return (
      (t[0] = ((i >> 16) & 255) / 255), (t[1] = ((i >> 8) & 255) / 255), (t[2] = (i & 255) / 255), t
    );
  }
  function kr(i) {
    let t = i.toString(16);
    return (t = "000000".substring(0, 6 - t.length) + t), `#${t}`;
  }
  function Xr(i) {
    return (
      typeof i == "string" && ((i = Oc[i.toLowerCase()] || i), i[0] === "#" && (i = i.slice(1))),
      parseInt(i, 16)
    );
  }
  function Fc(i) {
    return ((i[0] * 255) << 16) + ((i[1] * 255) << 8) + ((i[2] * 255) | 0);
  }
  function Nc() {
    const i = [],
      t = [];
    for (let r = 0; r < 32; r++) (i[r] = r), (t[r] = r);
    (i[G.NORMAL_NPM] = G.NORMAL),
      (i[G.ADD_NPM] = G.ADD),
      (i[G.SCREEN_NPM] = G.SCREEN),
      (t[G.NORMAL] = G.NORMAL_NPM),
      (t[G.ADD] = G.ADD_NPM),
      (t[G.SCREEN] = G.SCREEN_NPM);
    const e = [];
    return e.push(t), e.push(i), e;
  }
  const $r = Nc();
  function Hr(i, t) {
    return $r[t ? 1 : 0][i];
  }
  function ta(i, t, e, r) {
    return (
      (e = e || new Float32Array(4)),
      r || r === void 0
        ? ((e[0] = i[0] * t), (e[1] = i[1] * t), (e[2] = i[2] * t))
        : ((e[0] = i[0]), (e[1] = i[1]), (e[2] = i[2])),
      (e[3] = t),
      e
    );
  }
  function Fi(i, t) {
    if (t === 1) return ((t * 255) << 24) + i;
    if (t === 0) return 0;
    let e = (i >> 16) & 255,
      r = (i >> 8) & 255,
      s = i & 255;
    return (
      (e = (e * t + 0.5) | 0),
      (r = (r * t + 0.5) | 0),
      (s = (s * t + 0.5) | 0),
      ((t * 255) << 24) + (e << 16) + (r << 8) + s
    );
  }
  function zr(i, t, e, r) {
    return (
      (e = e || new Float32Array(4)),
      (e[0] = ((i >> 16) & 255) / 255),
      (e[1] = ((i >> 8) & 255) / 255),
      (e[2] = (i & 255) / 255),
      (r || r === void 0) && ((e[0] *= t), (e[1] *= t), (e[2] *= t)),
      (e[3] = t),
      e
    );
  }
  function ea(i, t = null) {
    const e = i * 6;
    if (((t = t || new Uint16Array(e)), t.length !== e))
      throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);
    for (let r = 0, s = 0; r < e; r += 6, s += 4)
      (t[r + 0] = s + 0),
        (t[r + 1] = s + 1),
        (t[r + 2] = s + 2),
        (t[r + 3] = s + 0),
        (t[r + 4] = s + 2),
        (t[r + 5] = s + 3);
    return t;
  }
  function Ni(i) {
    if (i.BYTES_PER_ELEMENT === 4)
      return i instanceof Float32Array
        ? "Float32Array"
        : i instanceof Uint32Array
        ? "Uint32Array"
        : "Int32Array";
    if (i.BYTES_PER_ELEMENT === 2) {
      if (i instanceof Uint16Array) return "Uint16Array";
    } else if (i.BYTES_PER_ELEMENT === 1 && i instanceof Uint8Array) return "Uint8Array";
    return null;
  }
  const Bc = { Float32Array, Uint32Array, Int32Array, Uint8Array };
  function Lc(i, t) {
    let e = 0,
      r = 0;
    const s = {};
    for (let h = 0; h < i.length; h++) (r += t[h]), (e += i[h].length);
    const n = new ArrayBuffer(e * 4);
    let a = null,
      o = 0;
    for (let h = 0; h < i.length; h++) {
      const l = t[h],
        u = i[h],
        c = Ni(u);
      s[c] || (s[c] = new Bc[c](n)), (a = s[c]);
      for (let d = 0; d < u.length; d++) {
        const f = ((d / l) | 0) * r + o,
          p = d % l;
        a[f + p] = u[d];
      }
      o += l;
    }
    return new Float32Array(n);
  }
  function Ke(i) {
    return (
      (i += i === 0 ? 1 : 0),
      --i,
      (i |= i >>> 1),
      (i |= i >>> 2),
      (i |= i >>> 4),
      (i |= i >>> 8),
      (i |= i >>> 16),
      i + 1
    );
  }
  function Wr(i) {
    return !(i & (i - 1)) && !!i;
  }
  function Vr(i) {
    let t = (i > 65535 ? 1 : 0) << 4;
    i >>>= t;
    let e = (i > 255 ? 1 : 0) << 3;
    return (
      (i >>>= e),
      (t |= e),
      (e = (i > 15 ? 1 : 0) << 2),
      (i >>>= e),
      (t |= e),
      (e = (i > 3 ? 1 : 0) << 1),
      (i >>>= e),
      (t |= e),
      t | (i >> 1)
    );
  }
  function ve(i, t, e) {
    const r = i.length;
    let s;
    if (t >= r || e === 0) return;
    e = t + e > r ? r - t : e;
    const n = r - e;
    for (s = t; s < n; ++s) i[s] = i[s + e];
    i.length = n;
  }
  function be(i) {
    return i === 0 ? 0 : i < 0 ? -1 : 1;
  }
  let Gc = 0;
  function he() {
    return ++Gc;
  }
  const ia = {};
  function Uc(i, t, e = 3) {
    if (ia[t]) return;
    let r = new Error().stack;
    typeof r > "u"
      ? console.warn(
          "PixiJS Deprecation Warning: ",
          `${t}
Deprecated since v${i}`
        )
      : ((r = r
          .split(
            `
`
          )
          .splice(e).join(`
`)),
        console.groupCollapsed
          ? (console.groupCollapsed(
              "%cPixiJS Deprecation Warning: %c%s",
              "color:#614108;background:#fffbe6",
              "font-weight:normal;color:#614108;background:#fffbe6",
              `${t}
Deprecated since v${i}`
            ),
            console.warn(r),
            console.groupEnd())
          : (console.warn(
              "PixiJS Deprecation Warning: ",
              `${t}
Deprecated since v${i}`
            ),
            console.warn(r))),
      (ia[t] = !0);
  }
  const Yr = {},
    Tt = Object.create(null),
    St = Object.create(null);
  function kc() {
    let i;
    for (i in Tt) Tt[i].destroy();
    for (i in St) St[i].destroy();
  }
  function Xc() {
    let i;
    for (i in Tt) delete Tt[i];
    for (i in St) delete St[i];
  }
  class jr {
    constructor(t, e, r) {
      (this.canvas = A.ADAPTER.createCanvas()),
        (this.context = this.canvas.getContext("2d")),
        (this.resolution = r || A.RESOLUTION),
        this.resize(t, e);
    }
    clear() {
      this.context.setTransform(1, 0, 0, 1, 0, 0),
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
    resize(t, e) {
      (this.canvas.width = Math.round(t * this.resolution)),
        (this.canvas.height = Math.round(e * this.resolution));
    }
    destroy() {
      (this.context = null), (this.canvas = null);
    }
    get width() {
      return this.canvas.width;
    }
    set width(t) {
      this.canvas.width = Math.round(t);
    }
    get height() {
      return this.canvas.height;
    }
    set height(t) {
      this.canvas.height = Math.round(t);
    }
  }
  function ra(i) {
    let t = i.width,
      e = i.height;
    const r = i.getContext("2d"),
      s = r.getImageData(0, 0, t, e).data,
      n = s.length,
      a = { top: null, left: null, right: null, bottom: null };
    let o = null,
      h,
      l,
      u;
    for (h = 0; h < n; h += 4)
      s[h + 3] !== 0 &&
        ((l = (h / 4) % t),
        (u = ~~(h / 4 / t)),
        a.top === null && (a.top = u),
        (a.left === null || l < a.left) && (a.left = l),
        (a.right === null || a.right < l) && (a.right = l + 1),
        (a.bottom === null || a.bottom < u) && (a.bottom = u));
    return (
      a.top !== null &&
        ((t = a.right - a.left),
        (e = a.bottom - a.top + 1),
        (o = r.getImageData(a.left, a.top, t, e))),
      { height: e, width: t, data: o }
    );
  }
  const sa = /^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;
  function $c(i) {
    const t = sa.exec(i);
    if (t)
      return {
        mediaType: t[1] ? t[1].toLowerCase() : void 0,
        subType: t[2] ? t[2].toLowerCase() : void 0,
        charset: t[3] ? t[3].toLowerCase() : void 0,
        encoding: t[4] ? t[4].toLowerCase() : void 0,
        data: t[5],
      };
  }
  let Bi;
  function na(i, t = globalThis.location) {
    if (i.startsWith("data:")) return "";
    (t = t || globalThis.location), Bi || (Bi = document.createElement("a")), (Bi.href = i);
    const e = qn.parse(Bi.href),
      r = (!e.port && t.port === "") || e.port === t.port;
    return e.hostname !== t.hostname || !r || e.protocol !== t.protocol ? "anonymous" : "";
  }
  function Qt(i, t = 1) {
    const e = A.RETINA_PREFIX.exec(i);
    return e ? parseFloat(e[1]) : t;
  }
  var Hc = {
    __proto__: null,
    BaseTextureCache: St,
    CanvasRenderTarget: jr,
    DATA_URI: sa,
    EventEmitter: Me,
    ProgramCache: Yr,
    TextureCache: Tt,
    clearTextureCache: Xc,
    correctBlendMode: Hr,
    createIndicesForQuads: ea,
    decomposeDataUri: $c,
    deprecation: Uc,
    destroyTextureCache: kc,
    determineCrossOrigin: na,
    earcut: Dr,
    getBufferType: Ni,
    getResolutionOfUrl: Qt,
    hex2rgb: ye,
    hex2string: kr,
    interleaveTypedArrays: Lc,
    isMobile: Ct,
    isPow2: Wr,
    isWebGLSupported: Jn,
    log2: Vr,
    nextPow2: Ke,
    path: dt,
    premultiplyBlendMode: $r,
    premultiplyRgba: ta,
    premultiplyTint: Fi,
    premultiplyTintToRgba: zr,
    removeItems: ve,
    rgb2hex: Fc,
    sayHello: Qn,
    sign: be,
    skipHello: Vh,
    string2hex: Xr,
    trimCanvas: ra,
    uid: he,
    url: qn,
  };
  (A.PREFER_ENV = ae.WEBGL2), (A.STRICT_TEXTURE_CACHE = !1);
  const Li = [];
  function qr(i, t) {
    if (!i) return null;
    let e = "";
    if (typeof i == "string") {
      const r = /\.(\w{3,4})(?:$|\?|#)/i.exec(i);
      r && (e = r[1].toLowerCase());
    }
    for (let r = Li.length - 1; r >= 0; --r) {
      const s = Li[r];
      if (s.test && s.test(i, e)) return new s(i, t);
    }
    throw new Error("Unrecognized source type to auto-detect Resource");
  }
  class Pe {
    constructor(t = 0, e = 0) {
      (this._width = t),
        (this._height = e),
        (this.destroyed = !1),
        (this.internal = !1),
        (this.onResize = new Ft("setRealSize")),
        (this.onUpdate = new Ft("update")),
        (this.onError = new Ft("onError"));
    }
    bind(t) {
      this.onResize.add(t),
        this.onUpdate.add(t),
        this.onError.add(t),
        (this._width || this._height) && this.onResize.emit(this._width, this._height);
    }
    unbind(t) {
      this.onResize.remove(t), this.onUpdate.remove(t), this.onError.remove(t);
    }
    resize(t, e) {
      (t !== this._width || e !== this._height) &&
        ((this._width = t), (this._height = e), this.onResize.emit(t, e));
    }
    get valid() {
      return !!this._width && !!this._height;
    }
    update() {
      this.destroyed || this.onUpdate.emit();
    }
    load() {
      return Promise.resolve(this);
    }
    get width() {
      return this._width;
    }
    get height() {
      return this._height;
    }
    style(t, e, r) {
      return !1;
    }
    dispose() {}
    destroy() {
      this.destroyed ||
        ((this.destroyed = !0),
        this.dispose(),
        this.onError.removeAll(),
        (this.onError = null),
        this.onResize.removeAll(),
        (this.onResize = null),
        this.onUpdate.removeAll(),
        (this.onUpdate = null));
    }
    static test(t, e) {
      return !1;
    }
  }
  class Oe extends Pe {
    constructor(t, e) {
      const { width: r, height: s } = e || {};
      if (!r || !s) throw new Error("BufferResource width or height invalid");
      super(r, s), (this.data = t);
    }
    upload(t, e, r) {
      const s = t.gl;
      s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL, e.alphaMode === Pt.UNPACK);
      const n = e.realWidth,
        a = e.realHeight;
      return (
        r.width === n && r.height === a
          ? s.texSubImage2D(e.target, 0, 0, 0, n, a, e.format, r.type, this.data)
          : ((r.width = n),
            (r.height = a),
            s.texImage2D(e.target, 0, r.internalFormat, n, a, 0, e.format, r.type, this.data)),
        !0
      );
    }
    dispose() {
      this.data = null;
    }
    static test(t) {
      return t instanceof Float32Array || t instanceof Uint8Array || t instanceof Uint32Array;
    }
  }
  const zc = { scaleMode: jt.NEAREST, format: S.RGBA, alphaMode: Pt.NPM },
    Ze = class extends Me {
      constructor(i = null, t = null) {
        super(), (t = t || {});
        const {
          alphaMode: e,
          mipmap: r,
          anisotropicLevel: s,
          scaleMode: n,
          width: a,
          height: o,
          wrapMode: h,
          format: l,
          type: u,
          target: c,
          resolution: d,
          resourceOptions: f,
        } = t;
        i && !(i instanceof Pe) && ((i = qr(i, f)), (i.internal = !0)),
          (this.resolution = d || A.RESOLUTION),
          (this.width = Math.round((a || 0) * this.resolution) / this.resolution),
          (this.height = Math.round((o || 0) * this.resolution) / this.resolution),
          (this._mipmap = r != null ? r : A.MIPMAP_TEXTURES),
          (this.anisotropicLevel = s != null ? s : A.ANISOTROPIC_LEVEL),
          (this._wrapMode = h || A.WRAP_MODE),
          (this._scaleMode = n != null ? n : A.SCALE_MODE),
          (this.format = l || S.RGBA),
          (this.type = u || L.UNSIGNED_BYTE),
          (this.target = c || fe.TEXTURE_2D),
          (this.alphaMode = e != null ? e : Pt.UNPACK),
          (this.uid = he()),
          (this.touched = 0),
          (this.isPowerOfTwo = !1),
          this._refreshPOT(),
          (this._glTextures = {}),
          (this.dirtyId = 0),
          (this.dirtyStyleId = 0),
          (this.cacheId = null),
          (this.valid = a > 0 && o > 0),
          (this.textureCacheIds = []),
          (this.destroyed = !1),
          (this.resource = null),
          (this._batchEnabled = 0),
          (this._batchLocation = 0),
          (this.parentTextureArray = null),
          this.setResource(i);
      }
      get realWidth() {
        return Math.round(this.width * this.resolution);
      }
      get realHeight() {
        return Math.round(this.height * this.resolution);
      }
      get mipmap() {
        return this._mipmap;
      }
      set mipmap(i) {
        this._mipmap !== i && ((this._mipmap = i), this.dirtyStyleId++);
      }
      get scaleMode() {
        return this._scaleMode;
      }
      set scaleMode(i) {
        this._scaleMode !== i && ((this._scaleMode = i), this.dirtyStyleId++);
      }
      get wrapMode() {
        return this._wrapMode;
      }
      set wrapMode(i) {
        this._wrapMode !== i && ((this._wrapMode = i), this.dirtyStyleId++);
      }
      setStyle(i, t) {
        let e;
        return (
          i !== void 0 && i !== this.scaleMode && ((this.scaleMode = i), (e = !0)),
          t !== void 0 && t !== this.mipmap && ((this.mipmap = t), (e = !0)),
          e && this.dirtyStyleId++,
          this
        );
      }
      setSize(i, t, e) {
        return (e = e || this.resolution), this.setRealSize(i * e, t * e, e);
      }
      setRealSize(i, t, e) {
        return (
          (this.resolution = e || this.resolution),
          (this.width = Math.round(i) / this.resolution),
          (this.height = Math.round(t) / this.resolution),
          this._refreshPOT(),
          this.update(),
          this
        );
      }
      _refreshPOT() {
        this.isPowerOfTwo = Wr(this.realWidth) && Wr(this.realHeight);
      }
      setResolution(i) {
        const t = this.resolution;
        return t === i
          ? this
          : ((this.resolution = i),
            this.valid &&
              ((this.width = Math.round(this.width * t) / i),
              (this.height = Math.round(this.height * t) / i),
              this.emit("update", this)),
            this._refreshPOT(),
            this);
      }
      setResource(i) {
        if (this.resource === i) return this;
        if (this.resource) throw new Error("Resource can be set only once");
        return i.bind(this), (this.resource = i), this;
      }
      update() {
        this.valid
          ? (this.dirtyId++, this.dirtyStyleId++, this.emit("update", this))
          : this.width > 0 &&
            this.height > 0 &&
            ((this.valid = !0), this.emit("loaded", this), this.emit("update", this));
      }
      onError(i) {
        this.emit("error", this, i);
      }
      destroy() {
        this.resource &&
          (this.resource.unbind(this),
          this.resource.internal && this.resource.destroy(),
          (this.resource = null)),
          this.cacheId && (delete St[this.cacheId], delete Tt[this.cacheId], (this.cacheId = null)),
          this.dispose(),
          Ze.removeFromCache(this),
          (this.textureCacheIds = null),
          (this.destroyed = !0);
      }
      dispose() {
        this.emit("dispose", this);
      }
      castToBaseTexture() {
        return this;
      }
      static from(i, t, e = A.STRICT_TEXTURE_CACHE) {
        const r = typeof i == "string";
        let s = null;
        if (r) s = i;
        else {
          if (!i._pixiId) {
            const a = (t == null ? void 0 : t.pixiIdPrefix) || "pixiid";
            i._pixiId = `${a}_${he()}`;
          }
          s = i._pixiId;
        }
        let n = St[s];
        if (r && e && !n) throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);
        return n || ((n = new Ze(i, t)), (n.cacheId = s), Ze.addToCache(n, s)), n;
      }
      static fromBuffer(i, t, e, r) {
        i = i || new Float32Array(t * e * 4);
        const s = new Oe(i, { width: t, height: e }),
          n = i instanceof Float32Array ? L.FLOAT : L.UNSIGNED_BYTE;
        return new Ze(s, Object.assign(zc, r || { width: t, height: e, type: n }));
      }
      static addToCache(i, t) {
        t &&
          (i.textureCacheIds.includes(t) || i.textureCacheIds.push(t),
          St[t] &&
            console.warn(
              `BaseTexture added to the cache with an id [${t}] that already had an entry`
            ),
          (St[t] = i));
      }
      static removeFromCache(i) {
        if (typeof i == "string") {
          const t = St[i];
          if (t) {
            const e = t.textureCacheIds.indexOf(i);
            return e > -1 && t.textureCacheIds.splice(e, 1), delete St[i], t;
          }
        } else if (i != null && i.textureCacheIds) {
          for (let t = 0; t < i.textureCacheIds.length; ++t) delete St[i.textureCacheIds[t]];
          return (i.textureCacheIds.length = 0), i;
        }
        return null;
      }
    };
  let Y = Ze;
  Y._globalBatch = 0;
  class Kr extends Pe {
    constructor(t, e) {
      const { width: r, height: s } = e || {};
      super(r, s), (this.items = []), (this.itemDirtyIds = []);
      for (let n = 0; n < t; n++) {
        const a = new Y();
        this.items.push(a), this.itemDirtyIds.push(-2);
      }
      (this.length = t), (this._load = null), (this.baseTexture = null);
    }
    initFromArray(t, e) {
      for (let r = 0; r < this.length; r++)
        !t[r] ||
          (t[r].castToBaseTexture
            ? this.addBaseTextureAt(t[r].castToBaseTexture(), r)
            : t[r] instanceof Pe
            ? this.addResourceAt(t[r], r)
            : this.addResourceAt(qr(t[r], e), r));
    }
    dispose() {
      for (let t = 0, e = this.length; t < e; t++) this.items[t].destroy();
      (this.items = null), (this.itemDirtyIds = null), (this._load = null);
    }
    addResourceAt(t, e) {
      if (!this.items[e]) throw new Error(`Index ${e} is out of bounds`);
      return (
        t.valid && !this.valid && this.resize(t.width, t.height), this.items[e].setResource(t), this
      );
    }
    bind(t) {
      if (this.baseTexture !== null)
        throw new Error("Only one base texture per TextureArray is allowed");
      super.bind(t);
      for (let e = 0; e < this.length; e++)
        (this.items[e].parentTextureArray = t), this.items[e].on("update", t.update, t);
    }
    unbind(t) {
      super.unbind(t);
      for (let e = 0; e < this.length; e++)
        (this.items[e].parentTextureArray = null), this.items[e].off("update", t.update, t);
    }
    load() {
      if (this._load) return this._load;
      const t = this.items
        .map((e) => e.resource)
        .filter((e) => e)
        .map((e) => e.load());
      return (
        (this._load = Promise.all(t).then(() => {
          const { realWidth: e, realHeight: r } = this.items[0];
          return this.resize(e, r), Promise.resolve(this);
        })),
        this._load
      );
    }
  }
  class aa extends Kr {
    constructor(t, e) {
      const { width: r, height: s } = e || {};
      let n, a;
      Array.isArray(t) ? ((n = t), (a = t.length)) : (a = t),
        super(a, { width: r, height: s }),
        n && this.initFromArray(n, e);
    }
    addBaseTextureAt(t, e) {
      if (t.resource) this.addResourceAt(t.resource, e);
      else throw new Error("ArrayResource does not support RenderTexture");
      return this;
    }
    bind(t) {
      super.bind(t), (t.target = fe.TEXTURE_2D_ARRAY);
    }
    upload(t, e, r) {
      const { length: s, itemDirtyIds: n, items: a } = this,
        { gl: o } = t;
      r.dirtyId < 0 &&
        o.texImage3D(
          o.TEXTURE_2D_ARRAY,
          0,
          r.internalFormat,
          this._width,
          this._height,
          s,
          0,
          e.format,
          r.type,
          null
        );
      for (let h = 0; h < s; h++) {
        const l = a[h];
        n[h] < l.dirtyId &&
          ((n[h] = l.dirtyId),
          l.valid &&
            o.texSubImage3D(
              o.TEXTURE_2D_ARRAY,
              0,
              0,
              0,
              h,
              l.resource.width,
              l.resource.height,
              1,
              e.format,
              r.type,
              l.resource.source
            ));
      }
      return !0;
    }
  }
  class Jt extends Pe {
    constructor(t) {
      const e = t,
        r = e.naturalWidth || e.videoWidth || e.width,
        s = e.naturalHeight || e.videoHeight || e.height;
      super(r, s), (this.source = t), (this.noSubImage = !1);
    }
    static crossOrigin(t, e, r) {
      r === void 0 && !e.startsWith("data:")
        ? (t.crossOrigin = na(e))
        : r !== !1 && (t.crossOrigin = typeof r == "string" ? r : "anonymous");
    }
    upload(t, e, r, s) {
      const n = t.gl,
        a = e.realWidth,
        o = e.realHeight;
      if (((s = s || this.source), s instanceof HTMLImageElement)) {
        if (!s.complete || s.naturalWidth === 0) return !1;
      } else if (s instanceof HTMLVideoElement && s.readyState <= 1) return !1;
      return (
        n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL, e.alphaMode === Pt.UNPACK),
        !this.noSubImage && e.target === n.TEXTURE_2D && r.width === a && r.height === o
          ? n.texSubImage2D(n.TEXTURE_2D, 0, 0, 0, e.format, r.type, s)
          : ((r.width = a),
            (r.height = o),
            n.texImage2D(e.target, 0, r.internalFormat, e.format, r.type, s)),
        !0
      );
    }
    update() {
      if (this.destroyed) return;
      const t = this.source,
        e = t.naturalWidth || t.videoWidth || t.width,
        r = t.naturalHeight || t.videoHeight || t.height;
      this.resize(e, r), super.update();
    }
    dispose() {
      this.source = null;
    }
  }
  class oa extends Jt {
    constructor(t) {
      super(t);
    }
    static test(t) {
      const { OffscreenCanvas: e } = globalThis;
      return e && t instanceof e
        ? !0
        : globalThis.HTMLCanvasElement && t instanceof HTMLCanvasElement;
    }
  }
  const Qe = class extends Kr {
    constructor(i, t) {
      const { width: e, height: r, autoLoad: s, linkBaseTexture: n } = t || {};
      if (i && i.length !== Qe.SIDES)
        throw new Error(`Invalid length. Got ${i.length}, expected 6`);
      super(6, { width: e, height: r });
      for (let a = 0; a < Qe.SIDES; a++) this.items[a].target = fe.TEXTURE_CUBE_MAP_POSITIVE_X + a;
      (this.linkBaseTexture = n !== !1), i && this.initFromArray(i, t), s !== !1 && this.load();
    }
    bind(i) {
      super.bind(i), (i.target = fe.TEXTURE_CUBE_MAP);
    }
    addBaseTextureAt(i, t, e) {
      if ((e === void 0 && (e = this.linkBaseTexture), !this.items[t]))
        throw new Error(`Index ${t} is out of bounds`);
      if (!this.linkBaseTexture || i.parentTextureArray || Object.keys(i._glTextures).length > 0)
        if (i.resource) this.addResourceAt(i.resource, t);
        else throw new Error("CubeResource does not support copying of renderTexture.");
      else
        (i.target = fe.TEXTURE_CUBE_MAP_POSITIVE_X + t),
          (i.parentTextureArray = this.baseTexture),
          (this.items[t] = i);
      return (
        i.valid && !this.valid && this.resize(i.realWidth, i.realHeight), (this.items[t] = i), this
      );
    }
    upload(i, t, e) {
      const r = this.itemDirtyIds;
      for (let s = 0; s < Qe.SIDES; s++) {
        const n = this.items[s];
        (r[s] < n.dirtyId || e.dirtyId < t.dirtyId) &&
          (n.valid && n.resource
            ? (n.resource.upload(i, n, e), (r[s] = n.dirtyId))
            : r[s] < -1 &&
              (i.gl.texImage2D(
                n.target,
                0,
                e.internalFormat,
                t.realWidth,
                t.realHeight,
                0,
                t.format,
                e.type,
                null
              ),
              (r[s] = -1)));
      }
      return !0;
    }
    static test(i) {
      return Array.isArray(i) && i.length === Qe.SIDES;
    }
  };
  let Zr = Qe;
  Zr.SIDES = 6;
  class Qr extends Jt {
    constructor(t, e) {
      var r;
      if (((e = e || {}), !(t instanceof HTMLImageElement))) {
        const s = new Image();
        Jt.crossOrigin(s, t, e.crossorigin), (s.src = t), (t = s);
      }
      super(t),
        !t.complete && !!this._width && !!this._height && ((this._width = 0), (this._height = 0)),
        (this.url = t.src),
        (this._process = null),
        (this.preserveBitmap = !1),
        (this.createBitmap =
          ((r = e.createBitmap) != null ? r : A.CREATE_IMAGE_BITMAP) &&
          !!globalThis.createImageBitmap),
        (this.alphaMode = typeof e.alphaMode == "number" ? e.alphaMode : null),
        (this.bitmap = null),
        (this._load = null),
        e.autoLoad !== !1 && this.load();
    }
    load(t) {
      return this._load
        ? this._load
        : (t !== void 0 && (this.createBitmap = t),
          (this._load = new Promise((e, r) => {
            const s = this.source;
            this.url = s.src;
            const n = () => {
              this.destroyed ||
                ((s.onload = null),
                (s.onerror = null),
                this.resize(s.width, s.height),
                (this._load = null),
                this.createBitmap ? e(this.process()) : e(this));
            };
            s.complete && s.src
              ? n()
              : ((s.onload = n),
                (s.onerror = (a) => {
                  r(a), this.onError.emit(a);
                }));
          })),
          this._load);
    }
    process() {
      const t = this.source;
      if (this._process !== null) return this._process;
      if (this.bitmap !== null || !globalThis.createImageBitmap) return Promise.resolve(this);
      const e = globalThis.createImageBitmap,
        r = !t.crossOrigin || t.crossOrigin === "anonymous";
      return (
        (this._process = fetch(t.src, { mode: r ? "cors" : "no-cors" })
          .then((s) => s.blob())
          .then((s) =>
            e(s, 0, 0, t.width, t.height, {
              premultiplyAlpha: this.alphaMode === Pt.UNPACK ? "premultiply" : "none",
            })
          )
          .then((s) =>
            this.destroyed
              ? Promise.reject()
              : ((this.bitmap = s), this.update(), (this._process = null), Promise.resolve(this))
          )),
        this._process
      );
    }
    upload(t, e, r) {
      if ((typeof this.alphaMode == "number" && (e.alphaMode = this.alphaMode), !this.createBitmap))
        return super.upload(t, e, r);
      if (!this.bitmap && (this.process(), !this.bitmap)) return !1;
      if ((super.upload(t, e, r, this.bitmap), !this.preserveBitmap)) {
        let s = !0;
        const n = e._glTextures;
        for (const a in n) {
          const o = n[a];
          if (o !== r && o.dirtyId !== e.dirtyId) {
            s = !1;
            break;
          }
        }
        s && (this.bitmap.close && this.bitmap.close(), (this.bitmap = null));
      }
      return !0;
    }
    dispose() {
      (this.source.onload = null),
        (this.source.onerror = null),
        super.dispose(),
        this.bitmap && (this.bitmap.close(), (this.bitmap = null)),
        (this._process = null),
        (this._load = null);
    }
    static test(t) {
      return typeof t == "string" || t instanceof HTMLImageElement;
    }
  }
  const Gi = class extends Jt {
    constructor(i, t) {
      (t = t || {}),
        super(A.ADAPTER.createCanvas()),
        (this._width = 0),
        (this._height = 0),
        (this.svg = i),
        (this.scale = t.scale || 1),
        (this._overrideWidth = t.width),
        (this._overrideHeight = t.height),
        (this._resolve = null),
        (this._crossorigin = t.crossorigin),
        (this._load = null),
        t.autoLoad !== !1 && this.load();
    }
    load() {
      return this._load
        ? this._load
        : ((this._load = new Promise((i) => {
            if (
              ((this._resolve = () => {
                this.resize(this.source.width, this.source.height), i(this);
              }),
              Gi.SVG_XML.test(this.svg.trim()))
            ) {
              if (!btoa) throw new Error("Your browser doesn't support base64 conversions.");
              this.svg = `data:image/svg+xml;base64,${btoa(
                unescape(encodeURIComponent(this.svg))
              )}`;
            }
            this._loadSvg();
          })),
          this._load);
    }
    _loadSvg() {
      const i = new Image();
      Jt.crossOrigin(i, this.svg, this._crossorigin),
        (i.src = this.svg),
        (i.onerror = (t) => {
          !this._resolve || ((i.onerror = null), this.onError.emit(t));
        }),
        (i.onload = () => {
          if (!this._resolve) return;
          const t = i.width,
            e = i.height;
          if (!t || !e)
            throw new Error(
              "The SVG image must have width and height defined (in pixels), canvas API needs them."
            );
          let r = t * this.scale,
            s = e * this.scale;
          (this._overrideWidth || this._overrideHeight) &&
            ((r = this._overrideWidth || (this._overrideHeight / e) * t),
            (s = this._overrideHeight || (this._overrideWidth / t) * e)),
            (r = Math.round(r)),
            (s = Math.round(s));
          const n = this.source;
          (n.width = r),
            (n.height = s),
            (n._pixiId = `canvas_${he()}`),
            n.getContext("2d").drawImage(i, 0, 0, t, e, 0, 0, r, s),
            this._resolve(),
            (this._resolve = null);
        });
    }
    static getSize(i) {
      const t = Gi.SVG_SIZE.exec(i),
        e = {};
      return (
        t && ((e[t[1]] = Math.round(parseFloat(t[3]))), (e[t[5]] = Math.round(parseFloat(t[7])))), e
      );
    }
    dispose() {
      super.dispose(), (this._resolve = null), (this._crossorigin = null);
    }
    static test(i, t) {
      return (
        t === "svg" ||
        (typeof i == "string" && /^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(i)) ||
        (typeof i == "string" && Gi.SVG_XML.test(i))
      );
    }
  };
  let Fe = Gi;
  (Fe.SVG_XML = /^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m),
    (Fe.SVG_SIZE =
      /<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i);
  const Jr = class extends Jt {
    constructor(i, t) {
      if (((t = t || {}), !(i instanceof HTMLVideoElement))) {
        const e = document.createElement("video");
        e.setAttribute("preload", "auto"),
          e.setAttribute("webkit-playsinline", ""),
          e.setAttribute("playsinline", ""),
          typeof i == "string" && (i = [i]);
        const r = i[0].src || i[0];
        Jt.crossOrigin(e, r, t.crossorigin);
        for (let s = 0; s < i.length; ++s) {
          const n = document.createElement("source");
          let { src: a, mime: o } = i[s];
          a = a || i[s];
          const h = a.split("?").shift().toLowerCase(),
            l = h.slice(h.lastIndexOf(".") + 1);
          (o = o || Jr.MIME_TYPES[l] || `video/${l}`), (n.src = a), (n.type = o), e.appendChild(n);
        }
        i = e;
      }
      super(i),
        (this.noSubImage = !0),
        (this._autoUpdate = !0),
        (this._isConnectedToTicker = !1),
        (this._updateFPS = t.updateFPS || 0),
        (this._msToNextUpdate = 0),
        (this.autoPlay = t.autoPlay !== !1),
        (this._load = null),
        (this._resolve = null),
        (this._onCanPlay = this._onCanPlay.bind(this)),
        (this._onError = this._onError.bind(this)),
        t.autoLoad !== !1 && this.load();
    }
    update(i = 0) {
      if (!this.destroyed) {
        const t = Z.shared.elapsedMS * this.source.playbackRate;
        (this._msToNextUpdate = Math.floor(this._msToNextUpdate - t)),
          (!this._updateFPS || this._msToNextUpdate <= 0) &&
            (super.update(),
            (this._msToNextUpdate = this._updateFPS ? Math.floor(1e3 / this._updateFPS) : 0));
      }
    }
    load() {
      if (this._load) return this._load;
      const i = this.source;
      return (
        (i.readyState === i.HAVE_ENOUGH_DATA || i.readyState === i.HAVE_FUTURE_DATA) &&
          i.width &&
          i.height &&
          (i.complete = !0),
        i.addEventListener("play", this._onPlayStart.bind(this)),
        i.addEventListener("pause", this._onPlayStop.bind(this)),
        this._isSourceReady()
          ? this._onCanPlay()
          : (i.addEventListener("canplay", this._onCanPlay),
            i.addEventListener("canplaythrough", this._onCanPlay),
            i.addEventListener("error", this._onError, !0)),
        (this._load = new Promise((t) => {
          this.valid ? t(this) : ((this._resolve = t), i.load());
        })),
        this._load
      );
    }
    _onError(i) {
      this.source.removeEventListener("error", this._onError, !0), this.onError.emit(i);
    }
    _isSourcePlaying() {
      const i = this.source;
      return i.currentTime > 0 && i.paused === !1 && i.ended === !1 && i.readyState > 2;
    }
    _isSourceReady() {
      const i = this.source;
      return i.readyState === 3 || i.readyState === 4;
    }
    _onPlayStart() {
      this.valid || this._onCanPlay(),
        this.autoUpdate &&
          !this._isConnectedToTicker &&
          (Z.shared.add(this.update, this), (this._isConnectedToTicker = !0));
    }
    _onPlayStop() {
      this._isConnectedToTicker &&
        (Z.shared.remove(this.update, this), (this._isConnectedToTicker = !1));
    }
    _onCanPlay() {
      const i = this.source;
      i.removeEventListener("canplay", this._onCanPlay),
        i.removeEventListener("canplaythrough", this._onCanPlay);
      const t = this.valid;
      this.resize(i.videoWidth, i.videoHeight),
        !t && this._resolve && (this._resolve(this), (this._resolve = null)),
        this._isSourcePlaying() ? this._onPlayStart() : this.autoPlay && i.play();
    }
    dispose() {
      this._isConnectedToTicker &&
        (Z.shared.remove(this.update, this), (this._isConnectedToTicker = !1));
      const i = this.source;
      i && (i.removeEventListener("error", this._onError, !0), i.pause(), (i.src = ""), i.load()),
        super.dispose();
    }
    get autoUpdate() {
      return this._autoUpdate;
    }
    set autoUpdate(i) {
      i !== this._autoUpdate &&
        ((this._autoUpdate = i),
        !this._autoUpdate && this._isConnectedToTicker
          ? (Z.shared.remove(this.update, this), (this._isConnectedToTicker = !1))
          : this._autoUpdate &&
            !this._isConnectedToTicker &&
            this._isSourcePlaying() &&
            (Z.shared.add(this.update, this), (this._isConnectedToTicker = !0)));
    }
    get updateFPS() {
      return this._updateFPS;
    }
    set updateFPS(i) {
      i !== this._updateFPS && (this._updateFPS = i);
    }
    static test(i, t) {
      return (globalThis.HTMLVideoElement && i instanceof HTMLVideoElement) || Jr.TYPES.includes(t);
    }
  };
  let Ui = Jr;
  (Ui.TYPES = ["mp4", "m4v", "webm", "ogg", "ogv", "h264", "avi", "mov"]),
    (Ui.MIME_TYPES = { ogv: "video/ogg", mov: "video/quicktime", m4v: "video/mp4" });
  class ha extends Jt {
    constructor(t) {
      super(t);
    }
    static test(t) {
      return !!globalThis.createImageBitmap && typeof ImageBitmap < "u" && t instanceof ImageBitmap;
    }
  }
  Li.push(Qr, ha, oa, Ui, Fe, Oe, Zr, aa);
  class Wc extends Oe {
    upload(t, e, r) {
      const s = t.gl;
      s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL, e.alphaMode === Pt.UNPACK);
      const n = e.realWidth,
        a = e.realHeight;
      return (
        r.width === n && r.height === a
          ? s.texSubImage2D(e.target, 0, 0, 0, n, a, e.format, r.type, this.data)
          : ((r.width = n),
            (r.height = a),
            s.texImage2D(e.target, 0, r.internalFormat, n, a, 0, e.format, r.type, this.data)),
        !0
      );
    }
  }
  class ki {
    constructor(t, e) {
      (this.width = Math.round(t || 100)),
        (this.height = Math.round(e || 100)),
        (this.stencil = !1),
        (this.depth = !1),
        (this.dirtyId = 0),
        (this.dirtyFormat = 0),
        (this.dirtySize = 0),
        (this.depthTexture = null),
        (this.colorTextures = []),
        (this.glFramebuffers = {}),
        (this.disposeRunner = new Ft("disposeFramebuffer")),
        (this.multisample = ot.NONE);
    }
    get colorTexture() {
      return this.colorTextures[0];
    }
    addColorTexture(t = 0, e) {
      return (
        (this.colorTextures[t] =
          e ||
          new Y(null, {
            scaleMode: jt.NEAREST,
            resolution: 1,
            mipmap: Kt.OFF,
            width: this.width,
            height: this.height,
          })),
        this.dirtyId++,
        this.dirtyFormat++,
        this
      );
    }
    addDepthTexture(t) {
      return (
        (this.depthTexture =
          t ||
          new Y(new Wc(null, { width: this.width, height: this.height }), {
            scaleMode: jt.NEAREST,
            resolution: 1,
            width: this.width,
            height: this.height,
            mipmap: Kt.OFF,
            format: S.DEPTH_COMPONENT,
            type: L.UNSIGNED_SHORT,
          })),
        this.dirtyId++,
        this.dirtyFormat++,
        this
      );
    }
    enableDepth() {
      return (this.depth = !0), this.dirtyId++, this.dirtyFormat++, this;
    }
    enableStencil() {
      return (this.stencil = !0), this.dirtyId++, this.dirtyFormat++, this;
    }
    resize(t, e) {
      if (((t = Math.round(t)), (e = Math.round(e)), !(t === this.width && e === this.height))) {
        (this.width = t), (this.height = e), this.dirtyId++, this.dirtySize++;
        for (let r = 0; r < this.colorTextures.length; r++) {
          const s = this.colorTextures[r],
            n = s.resolution;
          s.setSize(t / n, e / n);
        }
        if (this.depthTexture) {
          const r = this.depthTexture.resolution;
          this.depthTexture.setSize(t / r, e / r);
        }
      }
    }
    dispose() {
      this.disposeRunner.emit(this, !1);
    }
    destroyDepthTexture() {
      this.depthTexture &&
        (this.depthTexture.destroy(),
        (this.depthTexture = null),
        ++this.dirtyId,
        ++this.dirtyFormat);
    }
  }
  class ts extends Y {
    constructor(t = {}) {
      var e;
      if (typeof t == "number") {
        const r = arguments[0],
          s = arguments[1],
          n = arguments[2],
          a = arguments[3];
        t = { width: r, height: s, scaleMode: n, resolution: a };
      }
      (t.width = t.width || 100),
        (t.height = t.height || 100),
        (e = t.multisample) != null || (t.multisample = ot.NONE),
        super(null, t),
        (this.mipmap = Kt.OFF),
        (this.valid = !0),
        (this.clearColor = [0, 0, 0, 0]),
        (this.framebuffer = new ki(this.realWidth, this.realHeight).addColorTexture(0, this)),
        (this.framebuffer.multisample = t.multisample),
        (this.maskStack = []),
        (this.filterStack = [{}]);
    }
    resize(t, e) {
      this.framebuffer.resize(t * this.resolution, e * this.resolution),
        this.setRealSize(this.framebuffer.width, this.framebuffer.height);
    }
    dispose() {
      this.framebuffer.dispose(), super.dispose();
    }
    destroy() {
      super.destroy(), this.framebuffer.destroyDepthTexture(), (this.framebuffer = null);
    }
  }
  class es {
    constructor() {
      (this.x0 = 0),
        (this.y0 = 0),
        (this.x1 = 1),
        (this.y1 = 0),
        (this.x2 = 1),
        (this.y2 = 1),
        (this.x3 = 0),
        (this.y3 = 1),
        (this.uvsFloat32 = new Float32Array(8));
    }
    set(t, e, r) {
      const s = e.width,
        n = e.height;
      if (r) {
        const a = t.width / 2 / s,
          o = t.height / 2 / n,
          h = t.x / s + a,
          l = t.y / n + o;
        (r = J.add(r, J.NW)),
          (this.x0 = h + a * J.uX(r)),
          (this.y0 = l + o * J.uY(r)),
          (r = J.add(r, 2)),
          (this.x1 = h + a * J.uX(r)),
          (this.y1 = l + o * J.uY(r)),
          (r = J.add(r, 2)),
          (this.x2 = h + a * J.uX(r)),
          (this.y2 = l + o * J.uY(r)),
          (r = J.add(r, 2)),
          (this.x3 = h + a * J.uX(r)),
          (this.y3 = l + o * J.uY(r));
      } else
        (this.x0 = t.x / s),
          (this.y0 = t.y / n),
          (this.x1 = (t.x + t.width) / s),
          (this.y1 = t.y / n),
          (this.x2 = (t.x + t.width) / s),
          (this.y2 = (t.y + t.height) / n),
          (this.x3 = t.x / s),
          (this.y3 = (t.y + t.height) / n);
      (this.uvsFloat32[0] = this.x0),
        (this.uvsFloat32[1] = this.y0),
        (this.uvsFloat32[2] = this.x1),
        (this.uvsFloat32[3] = this.y1),
        (this.uvsFloat32[4] = this.x2),
        (this.uvsFloat32[5] = this.y2),
        (this.uvsFloat32[6] = this.x3),
        (this.uvsFloat32[7] = this.y3);
    }
  }
  const la = new es();
  function Xi(i) {
    (i.destroy = function () {}),
      (i.on = function () {}),
      (i.once = function () {}),
      (i.emit = function () {});
  }
  class O extends Me {
    constructor(t, e, r, s, n, a) {
      if (
        (super(),
        (this.noFrame = !1),
        e || ((this.noFrame = !0), (e = new z(0, 0, 1, 1))),
        t instanceof O && (t = t.baseTexture),
        (this.baseTexture = t),
        (this._frame = e),
        (this.trim = s),
        (this.valid = !1),
        (this._uvs = la),
        (this.uvMatrix = null),
        (this.orig = r || e),
        (this._rotate = Number(n || 0)),
        n === !0)
      )
        this._rotate = 2;
      else if (this._rotate % 2 !== 0)
        throw new Error(
          "attempt to use diamond-shaped UVs. If you are sure, set rotation manually"
        );
      (this.defaultAnchor = a ? new V(a.x, a.y) : new V(0, 0)),
        (this._updateID = 0),
        (this.textureCacheIds = []),
        t.valid
          ? this.noFrame
            ? t.valid && this.onBaseTextureUpdated(t)
            : (this.frame = e)
          : t.once("loaded", this.onBaseTextureUpdated, this),
        this.noFrame && t.on("update", this.onBaseTextureUpdated, this);
    }
    update() {
      this.baseTexture.resource && this.baseTexture.resource.update();
    }
    onBaseTextureUpdated(t) {
      if (this.noFrame) {
        if (!this.baseTexture.valid) return;
        (this._frame.width = t.width),
          (this._frame.height = t.height),
          (this.valid = !0),
          this.updateUvs();
      } else this.frame = this._frame;
      this.emit("update", this);
    }
    destroy(t) {
      if (this.baseTexture) {
        if (t) {
          const { resource: e } = this.baseTexture;
          (e == null ? void 0 : e.url) && Tt[e.url] && O.removeFromCache(e.url),
            this.baseTexture.destroy();
        }
        this.baseTexture.off("loaded", this.onBaseTextureUpdated, this),
          this.baseTexture.off("update", this.onBaseTextureUpdated, this),
          (this.baseTexture = null);
      }
      (this._frame = null),
        (this._uvs = null),
        (this.trim = null),
        (this.orig = null),
        (this.valid = !1),
        O.removeFromCache(this),
        (this.textureCacheIds = null);
    }
    clone() {
      var s;
      const t = this._frame.clone(),
        e = this._frame === this.orig ? t : this.orig.clone(),
        r = new O(
          this.baseTexture,
          !this.noFrame && t,
          e,
          (s = this.trim) == null ? void 0 : s.clone(),
          this.rotate,
          this.defaultAnchor
        );
      return this.noFrame && (r._frame = t), r;
    }
    updateUvs() {
      this._uvs === la && (this._uvs = new es()),
        this._uvs.set(this._frame, this.baseTexture, this.rotate),
        this._updateID++;
    }
    static from(t, e = {}, r = A.STRICT_TEXTURE_CACHE) {
      const s = typeof t == "string";
      let n = null;
      if (s) n = t;
      else if (t instanceof Y) {
        if (!t.cacheId) {
          const o = (e == null ? void 0 : e.pixiIdPrefix) || "pixiid";
          (t.cacheId = `${o}-${he()}`), Y.addToCache(t, t.cacheId);
        }
        n = t.cacheId;
      } else {
        if (!t._pixiId) {
          const o = (e == null ? void 0 : e.pixiIdPrefix) || "pixiid";
          t._pixiId = `${o}_${he()}`;
        }
        n = t._pixiId;
      }
      let a = Tt[n];
      if (s && r && !a) throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);
      return (
        !a && !(t instanceof Y)
          ? (e.resolution || (e.resolution = Qt(t)),
            (a = new O(new Y(t, e))),
            (a.baseTexture.cacheId = n),
            Y.addToCache(a.baseTexture, n),
            O.addToCache(a, n))
          : !a && t instanceof Y && ((a = new O(t)), O.addToCache(a, n)),
        a
      );
    }
    static fromURL(t, e) {
      const r = Object.assign({ autoLoad: !1 }, e == null ? void 0 : e.resourceOptions),
        s = O.from(t, Object.assign({ resourceOptions: r }, e), !1),
        n = s.baseTexture.resource;
      return s.baseTexture.valid ? Promise.resolve(s) : n.load().then(() => Promise.resolve(s));
    }
    static fromBuffer(t, e, r, s) {
      return new O(Y.fromBuffer(t, e, r, s));
    }
    static fromLoader(t, e, r, s) {
      const n = new Y(t, Object.assign({ scaleMode: A.SCALE_MODE, resolution: Qt(e) }, s)),
        { resource: a } = n;
      a instanceof Qr && (a.url = e);
      const o = new O(n);
      return (
        r || (r = e),
        Y.addToCache(o.baseTexture, r),
        O.addToCache(o, r),
        r !== e && (Y.addToCache(o.baseTexture, e), O.addToCache(o, e)),
        o.baseTexture.valid
          ? Promise.resolve(o)
          : new Promise((h) => {
              o.baseTexture.once("loaded", () => h(o));
            })
      );
    }
    static addToCache(t, e) {
      e &&
        (t.textureCacheIds.includes(e) || t.textureCacheIds.push(e),
        Tt[e] &&
          console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),
        (Tt[e] = t));
    }
    static removeFromCache(t) {
      if (typeof t == "string") {
        const e = Tt[t];
        if (e) {
          const r = e.textureCacheIds.indexOf(t);
          return r > -1 && e.textureCacheIds.splice(r, 1), delete Tt[t], e;
        }
      } else if (t != null && t.textureCacheIds) {
        for (let e = 0; e < t.textureCacheIds.length; ++e)
          Tt[t.textureCacheIds[e]] === t && delete Tt[t.textureCacheIds[e]];
        return (t.textureCacheIds.length = 0), t;
      }
      return null;
    }
    get resolution() {
      return this.baseTexture.resolution;
    }
    get frame() {
      return this._frame;
    }
    set frame(t) {
      (this._frame = t), (this.noFrame = !1);
      const { x: e, y: r, width: s, height: n } = t,
        a = e + s > this.baseTexture.width,
        o = r + n > this.baseTexture.height;
      if (a || o) {
        const h = a && o ? "and" : "or",
          l = `X: ${e} + ${s} = ${e + s} > ${this.baseTexture.width}`,
          u = `Y: ${r} + ${n} = ${r + n} > ${this.baseTexture.height}`;
        throw new Error(
          `Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${u}`
        );
      }
      (this.valid = s && n && this.baseTexture.valid),
        !this.trim && !this.rotate && (this.orig = t),
        this.valid && this.updateUvs();
    }
    get rotate() {
      return this._rotate;
    }
    set rotate(t) {
      (this._rotate = t), this.valid && this.updateUvs();
    }
    get width() {
      return this.orig.width;
    }
    get height() {
      return this.orig.height;
    }
    castToBaseTexture() {
      return this.baseTexture;
    }
    static get EMPTY() {
      return (
        O._EMPTY || ((O._EMPTY = new O(new Y())), Xi(O._EMPTY), Xi(O._EMPTY.baseTexture)), O._EMPTY
      );
    }
    static get WHITE() {
      if (!O._WHITE) {
        const t = A.ADAPTER.createCanvas(16, 16),
          e = t.getContext("2d");
        (t.width = 16),
          (t.height = 16),
          (e.fillStyle = "white"),
          e.fillRect(0, 0, 16, 16),
          (O._WHITE = new O(Y.from(t))),
          Xi(O._WHITE),
          Xi(O._WHITE.baseTexture);
      }
      return O._WHITE;
    }
  }
  class te extends O {
    constructor(t, e) {
      super(t, e),
        (this.valid = !0),
        (this.filterFrame = null),
        (this.filterPoolKey = null),
        this.updateUvs();
    }
    get framebuffer() {
      return this.baseTexture.framebuffer;
    }
    get multisample() {
      return this.framebuffer.multisample;
    }
    set multisample(t) {
      this.framebuffer.multisample = t;
    }
    resize(t, e, r = !0) {
      const s = this.baseTexture.resolution,
        n = Math.round(t * s) / s,
        a = Math.round(e * s) / s;
      (this.valid = n > 0 && a > 0),
        (this._frame.width = this.orig.width = n),
        (this._frame.height = this.orig.height = a),
        r && this.baseTexture.resize(n, a),
        this.updateUvs();
    }
    setResolution(t) {
      const { baseTexture: e } = this;
      e.resolution !== t && (e.setResolution(t), this.resize(e.width, e.height, !1));
    }
    static create(t) {
      return new te(new ts(t));
    }
  }
  class is {
    constructor(t) {
      (this.texturePool = {}),
        (this.textureOptions = t || {}),
        (this.enableFullScreen = !1),
        (this._pixelsWidth = 0),
        (this._pixelsHeight = 0);
    }
    createTexture(t, e, r = ot.NONE) {
      const s = new ts(
        Object.assign({ width: t, height: e, resolution: 1, multisample: r }, this.textureOptions)
      );
      return new te(s);
    }
    getOptimalTexture(t, e, r = 1, s = ot.NONE) {
      let n;
      (t = Math.ceil(t * r - 1e-6)),
        (e = Math.ceil(e * r - 1e-6)),
        !this.enableFullScreen || t !== this._pixelsWidth || e !== this._pixelsHeight
          ? ((t = Ke(t)),
            (e = Ke(e)),
            (n = (((t & 65535) << 16) | (e & 65535)) >>> 0),
            s > 1 && (n += s * 4294967296))
          : (n = s > 1 ? -s : -1),
        this.texturePool[n] || (this.texturePool[n] = []);
      let a = this.texturePool[n].pop();
      return a || (a = this.createTexture(t, e, s)), (a.filterPoolKey = n), a.setResolution(r), a;
    }
    getFilterTexture(t, e, r) {
      const s = this.getOptimalTexture(t.width, t.height, e || t.resolution, r || ot.NONE);
      return (s.filterFrame = t.filterFrame), s;
    }
    returnTexture(t) {
      const e = t.filterPoolKey;
      (t.filterFrame = null), this.texturePool[e].push(t);
    }
    returnFilterTexture(t) {
      this.returnTexture(t);
    }
    clear(t) {
      if (((t = t !== !1), t))
        for (const e in this.texturePool) {
          const r = this.texturePool[e];
          if (r) for (let s = 0; s < r.length; s++) r[s].destroy(!0);
        }
      this.texturePool = {};
    }
    setScreenSize(t) {
      if (!(t.width === this._pixelsWidth && t.height === this._pixelsHeight)) {
        this.enableFullScreen = t.width > 0 && t.height > 0;
        for (const e in this.texturePool) {
          if (!(Number(e) < 0)) continue;
          const r = this.texturePool[e];
          if (r) for (let s = 0; s < r.length; s++) r[s].destroy(!0);
          this.texturePool[e] = [];
        }
        (this._pixelsWidth = t.width), (this._pixelsHeight = t.height);
      }
    }
  }
  is.SCREEN_KEY = -1;
  class Je {
    constructor(t, e = 0, r = !1, s = L.FLOAT, n, a, o) {
      (this.buffer = t),
        (this.size = e),
        (this.normalized = r),
        (this.type = s),
        (this.stride = n),
        (this.start = a),
        (this.instance = o);
    }
    destroy() {
      this.buffer = null;
    }
    static from(t, e, r, s, n) {
      return new Je(t, e, r, s, n);
    }
  }
  let Vc = 0;
  class nt {
    constructor(t, e = !0, r = !1) {
      (this.data = t || new Float32Array(1)),
        (this._glBuffers = {}),
        (this._updateID = 0),
        (this.index = r),
        (this.static = e),
        (this.id = Vc++),
        (this.disposeRunner = new Ft("disposeBuffer"));
    }
    update(t) {
      t instanceof Array && (t = new Float32Array(t)),
        (this.data = t || this.data),
        this._updateID++;
    }
    dispose() {
      this.disposeRunner.emit(this, !1);
    }
    destroy() {
      this.dispose(), (this.data = null);
    }
    set index(t) {
      this.type = t ? $t.ELEMENT_ARRAY_BUFFER : $t.ARRAY_BUFFER;
    }
    get index() {
      return this.type === $t.ELEMENT_ARRAY_BUFFER;
    }
    static from(t) {
      return t instanceof Array && (t = new Float32Array(t)), new nt(t);
    }
  }
  const Yc = { Float32Array, Uint32Array, Int32Array, Uint8Array };
  function jc(i, t) {
    let e = 0,
      r = 0;
    const s = {};
    for (let h = 0; h < i.length; h++) (r += t[h]), (e += i[h].length);
    const n = new ArrayBuffer(e * 4);
    let a = null,
      o = 0;
    for (let h = 0; h < i.length; h++) {
      const l = t[h],
        u = i[h],
        c = Ni(u);
      s[c] || (s[c] = new Yc[c](n)), (a = s[c]);
      for (let d = 0; d < u.length; d++) {
        const f = ((d / l) | 0) * r + o,
          p = d % l;
        a[f + p] = u[d];
      }
      o += l;
    }
    return new Float32Array(n);
  }
  const ua = { 5126: 4, 5123: 2, 5121: 1 };
  let qc = 0;
  const Kc = { Float32Array, Uint32Array, Int32Array, Uint8Array, Uint16Array };
  class ee {
    constructor(t = [], e = {}) {
      (this.buffers = t),
        (this.indexBuffer = null),
        (this.attributes = e),
        (this.glVertexArrayObjects = {}),
        (this.id = qc++),
        (this.instanced = !1),
        (this.instanceCount = 1),
        (this.disposeRunner = new Ft("disposeGeometry")),
        (this.refCount = 0);
    }
    addAttribute(t, e, r = 0, s = !1, n, a, o, h = !1) {
      if (!e) throw new Error("You must pass a buffer when creating an attribute");
      e instanceof nt || (e instanceof Array && (e = new Float32Array(e)), (e = new nt(e)));
      const l = t.split("|");
      if (l.length > 1) {
        for (let c = 0; c < l.length; c++) this.addAttribute(l[c], e, r, s, n);
        return this;
      }
      let u = this.buffers.indexOf(e);
      return (
        u === -1 && (this.buffers.push(e), (u = this.buffers.length - 1)),
        (this.attributes[t] = new Je(u, r, s, n, a, o, h)),
        (this.instanced = this.instanced || h),
        this
      );
    }
    getAttribute(t) {
      return this.attributes[t];
    }
    getBuffer(t) {
      return this.buffers[this.getAttribute(t).buffer];
    }
    addIndex(t) {
      return (
        t instanceof nt || (t instanceof Array && (t = new Uint16Array(t)), (t = new nt(t))),
        (t.type = $t.ELEMENT_ARRAY_BUFFER),
        (this.indexBuffer = t),
        this.buffers.includes(t) || this.buffers.push(t),
        this
      );
    }
    getIndex() {
      return this.indexBuffer;
    }
    interleave() {
      if (this.buffers.length === 1 || (this.buffers.length === 2 && this.indexBuffer)) return this;
      const t = [],
        e = [],
        r = new nt();
      let s;
      for (s in this.attributes) {
        const n = this.attributes[s],
          a = this.buffers[n.buffer];
        t.push(a.data), e.push((n.size * ua[n.type]) / 4), (n.buffer = 0);
      }
      for (r.data = jc(t, e), s = 0; s < this.buffers.length; s++)
        this.buffers[s] !== this.indexBuffer && this.buffers[s].destroy();
      return (this.buffers = [r]), this.indexBuffer && this.buffers.push(this.indexBuffer), this;
    }
    getSize() {
      for (const t in this.attributes) {
        const e = this.attributes[t];
        return this.buffers[e.buffer].data.length / (e.stride / 4 || e.size);
      }
      return 0;
    }
    dispose() {
      this.disposeRunner.emit(this, !1);
    }
    destroy() {
      this.dispose(), (this.buffers = null), (this.indexBuffer = null), (this.attributes = null);
    }
    clone() {
      const t = new ee();
      for (let e = 0; e < this.buffers.length; e++)
        t.buffers[e] = new nt(this.buffers[e].data.slice(0));
      for (const e in this.attributes) {
        const r = this.attributes[e];
        t.attributes[e] = new Je(
          r.buffer,
          r.size,
          r.normalized,
          r.type,
          r.stride,
          r.start,
          r.instance
        );
      }
      return (
        this.indexBuffer &&
          ((t.indexBuffer = t.buffers[this.buffers.indexOf(this.indexBuffer)]),
          (t.indexBuffer.type = $t.ELEMENT_ARRAY_BUFFER)),
        t
      );
    }
    static merge(t) {
      const e = new ee(),
        r = [],
        s = [],
        n = [];
      let a;
      for (let o = 0; o < t.length; o++) {
        a = t[o];
        for (let h = 0; h < a.buffers.length; h++)
          (s[h] = s[h] || 0), (s[h] += a.buffers[h].data.length), (n[h] = 0);
      }
      for (let o = 0; o < a.buffers.length; o++)
        (r[o] = new Kc[Ni(a.buffers[o].data)](s[o])), (e.buffers[o] = new nt(r[o]));
      for (let o = 0; o < t.length; o++) {
        a = t[o];
        for (let h = 0; h < a.buffers.length; h++)
          r[h].set(a.buffers[h].data, n[h]), (n[h] += a.buffers[h].data.length);
      }
      if (((e.attributes = a.attributes), a.indexBuffer)) {
        (e.indexBuffer = e.buffers[a.buffers.indexOf(a.indexBuffer)]),
          (e.indexBuffer.type = $t.ELEMENT_ARRAY_BUFFER);
        let o = 0,
          h = 0,
          l = 0,
          u = 0;
        for (let c = 0; c < a.buffers.length; c++)
          if (a.buffers[c] !== a.indexBuffer) {
            u = c;
            break;
          }
        for (const c in a.attributes) {
          const d = a.attributes[c];
          (d.buffer | 0) === u && (h += (d.size * ua[d.type]) / 4);
        }
        for (let c = 0; c < t.length; c++) {
          const d = t[c].indexBuffer.data;
          for (let f = 0; f < d.length; f++) e.indexBuffer.data[f + l] += o;
          (o += t[c].buffers[u].data.length / h), (l += d.length);
        }
      }
      return e;
    }
  }
  class ca extends ee {
    constructor() {
      super(),
        this.addAttribute("aVertexPosition", new Float32Array([0, 0, 1, 0, 1, 1, 0, 1])).addIndex([
          0, 1, 3, 2,
        ]);
    }
  }
  class rs extends ee {
    constructor() {
      super(),
        (this.vertices = new Float32Array([-1, -1, 1, -1, 1, 1, -1, 1])),
        (this.uvs = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1])),
        (this.vertexBuffer = new nt(this.vertices)),
        (this.uvBuffer = new nt(this.uvs)),
        this.addAttribute("aVertexPosition", this.vertexBuffer)
          .addAttribute("aTextureCoord", this.uvBuffer)
          .addIndex([0, 1, 2, 0, 2, 3]);
    }
    map(t, e) {
      let r = 0,
        s = 0;
      return (
        (this.uvs[0] = r),
        (this.uvs[1] = s),
        (this.uvs[2] = r + e.width / t.width),
        (this.uvs[3] = s),
        (this.uvs[4] = r + e.width / t.width),
        (this.uvs[5] = s + e.height / t.height),
        (this.uvs[6] = r),
        (this.uvs[7] = s + e.height / t.height),
        (r = e.x),
        (s = e.y),
        (this.vertices[0] = r),
        (this.vertices[1] = s),
        (this.vertices[2] = r + e.width),
        (this.vertices[3] = s),
        (this.vertices[4] = r + e.width),
        (this.vertices[5] = s + e.height),
        (this.vertices[6] = r),
        (this.vertices[7] = s + e.height),
        this.invalidate(),
        this
      );
    }
    invalidate() {
      return this.vertexBuffer._updateID++, this.uvBuffer._updateID++, this;
    }
  }
  let Zc = 0;
  class It {
    constructor(t, e, r) {
      (this.group = !0),
        (this.syncUniforms = {}),
        (this.dirtyId = 0),
        (this.id = Zc++),
        (this.static = !!e),
        (this.ubo = !!r),
        t instanceof nt
          ? ((this.buffer = t),
            (this.buffer.type = $t.UNIFORM_BUFFER),
            (this.autoManage = !1),
            (this.ubo = !0))
          : ((this.uniforms = t),
            this.ubo &&
              ((this.buffer = new nt(new Float32Array(1))),
              (this.buffer.type = $t.UNIFORM_BUFFER),
              (this.autoManage = !0)));
    }
    update() {
      this.dirtyId++, !this.autoManage && this.buffer && this.buffer.update();
    }
    add(t, e, r) {
      if (!this.ubo) this.uniforms[t] = new It(e, r);
      else
        throw new Error(
          "[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them"
        );
    }
    static from(t, e, r) {
      return new It(t, e, r);
    }
    static uboFrom(t, e) {
      return new It(t, e != null ? e : !0, !0);
    }
  }
  class da {
    constructor() {
      (this.renderTexture = null),
        (this.target = null),
        (this.legacy = !1),
        (this.resolution = 1),
        (this.multisample = ot.NONE),
        (this.sourceFrame = new z()),
        (this.destinationFrame = new z()),
        (this.bindingSourceFrame = new z()),
        (this.bindingDestinationFrame = new z()),
        (this.filters = []),
        (this.transform = null);
    }
    clear() {
      (this.target = null), (this.filters = null), (this.renderTexture = null);
    }
  }
  const $i = [new V(), new V(), new V(), new V()],
    ss = new Q();
  class ns {
    constructor(t) {
      (this.renderer = t),
        (this.defaultFilterStack = [{}]),
        (this.texturePool = new is()),
        (this.statePool = []),
        (this.quad = new ca()),
        (this.quadUv = new rs()),
        (this.tempRect = new z()),
        (this.activeState = {}),
        (this.globalUniforms = new It(
          {
            outputFrame: new z(),
            inputSize: new Float32Array(4),
            inputPixel: new Float32Array(4),
            inputClamp: new Float32Array(4),
            resolution: 1,
            filterArea: new Float32Array(4),
            filterClamp: new Float32Array(4),
          },
          !0
        )),
        (this.forceClear = !1),
        (this.useMaxPadding = !1);
    }
    init() {
      this.texturePool.setScreenSize(this.renderer.view);
    }
    push(t, e) {
      var p, g;
      const r = this.renderer,
        s = this.defaultFilterStack,
        n = this.statePool.pop() || new da(),
        a = this.renderer.renderTexture;
      let o = e[0].resolution,
        h = e[0].multisample,
        l = e[0].padding,
        u = e[0].autoFit,
        c = (p = e[0].legacy) != null ? p : !0;
      for (let _ = 1; _ < e.length; _++) {
        const T = e[_];
        (o = Math.min(o, T.resolution)),
          (h = Math.min(h, T.multisample)),
          (l = this.useMaxPadding ? Math.max(l, T.padding) : l + T.padding),
          (u = u && T.autoFit),
          (c = c || ((g = T.legacy) != null ? g : !0));
      }
      s.length === 1 && (this.defaultFilterStack[0].renderTexture = a.current),
        s.push(n),
        (n.resolution = o),
        (n.multisample = h),
        (n.legacy = c),
        (n.target = t),
        n.sourceFrame.copyFrom(t.filterArea || t.getBounds(!0)),
        n.sourceFrame.pad(l);
      const d = this.tempRect.copyFrom(a.sourceFrame);
      r.projection.transform && this.transformAABB(ss.copyFrom(r.projection.transform).invert(), d),
        u
          ? (n.sourceFrame.fit(d),
            (n.sourceFrame.width <= 0 || n.sourceFrame.height <= 0) &&
              ((n.sourceFrame.width = 0), (n.sourceFrame.height = 0)))
          : n.sourceFrame.intersects(d) || ((n.sourceFrame.width = 0), (n.sourceFrame.height = 0)),
        this.roundFrame(
          n.sourceFrame,
          a.current ? a.current.resolution : r.resolution,
          a.sourceFrame,
          a.destinationFrame,
          r.projection.transform
        ),
        (n.renderTexture = this.getOptimalFilterTexture(
          n.sourceFrame.width,
          n.sourceFrame.height,
          o,
          h
        )),
        (n.filters = e),
        (n.destinationFrame.width = n.renderTexture.width),
        (n.destinationFrame.height = n.renderTexture.height);
      const f = this.tempRect;
      (f.x = 0),
        (f.y = 0),
        (f.width = n.sourceFrame.width),
        (f.height = n.sourceFrame.height),
        (n.renderTexture.filterFrame = n.sourceFrame),
        n.bindingSourceFrame.copyFrom(a.sourceFrame),
        n.bindingDestinationFrame.copyFrom(a.destinationFrame),
        (n.transform = r.projection.transform),
        (r.projection.transform = null),
        a.bind(n.renderTexture, n.sourceFrame, f),
        r.framebuffer.clear(0, 0, 0, 0);
    }
    pop() {
      const t = this.defaultFilterStack,
        e = t.pop(),
        r = e.filters;
      this.activeState = e;
      const s = this.globalUniforms.uniforms;
      (s.outputFrame = e.sourceFrame), (s.resolution = e.resolution);
      const n = s.inputSize,
        a = s.inputPixel,
        o = s.inputClamp;
      if (
        ((n[0] = e.destinationFrame.width),
        (n[1] = e.destinationFrame.height),
        (n[2] = 1 / n[0]),
        (n[3] = 1 / n[1]),
        (a[0] = Math.round(n[0] * e.resolution)),
        (a[1] = Math.round(n[1] * e.resolution)),
        (a[2] = 1 / a[0]),
        (a[3] = 1 / a[1]),
        (o[0] = 0.5 * a[2]),
        (o[1] = 0.5 * a[3]),
        (o[2] = e.sourceFrame.width * n[2] - 0.5 * a[2]),
        (o[3] = e.sourceFrame.height * n[3] - 0.5 * a[3]),
        e.legacy)
      ) {
        const l = s.filterArea;
        (l[0] = e.destinationFrame.width),
          (l[1] = e.destinationFrame.height),
          (l[2] = e.sourceFrame.x),
          (l[3] = e.sourceFrame.y),
          (s.filterClamp = s.inputClamp);
      }
      this.globalUniforms.update();
      const h = t[t.length - 1];
      if ((this.renderer.framebuffer.blit(), r.length === 1))
        r[0].apply(this, e.renderTexture, h.renderTexture, Ot.BLEND, e),
          this.returnFilterTexture(e.renderTexture);
      else {
        let l = e.renderTexture,
          u = this.getOptimalFilterTexture(l.width, l.height, e.resolution);
        u.filterFrame = l.filterFrame;
        let c = 0;
        for (c = 0; c < r.length - 1; ++c) {
          c === 1 &&
            e.multisample > 1 &&
            ((u = this.getOptimalFilterTexture(l.width, l.height, e.resolution)),
            (u.filterFrame = l.filterFrame)),
            r[c].apply(this, l, u, Ot.CLEAR, e);
          const d = l;
          (l = u), (u = d);
        }
        r[c].apply(this, l, h.renderTexture, Ot.BLEND, e),
          c > 1 && e.multisample > 1 && this.returnFilterTexture(e.renderTexture),
          this.returnFilterTexture(l),
          this.returnFilterTexture(u);
      }
      e.clear(), this.statePool.push(e);
    }
    bindAndClear(t, e = Ot.CLEAR) {
      const { renderTexture: r, state: s } = this.renderer;
      if (
        (t === this.defaultFilterStack[this.defaultFilterStack.length - 1].renderTexture
          ? (this.renderer.projection.transform = this.activeState.transform)
          : (this.renderer.projection.transform = null),
        t == null ? void 0 : t.filterFrame)
      ) {
        const a = this.tempRect;
        (a.x = 0),
          (a.y = 0),
          (a.width = t.filterFrame.width),
          (a.height = t.filterFrame.height),
          r.bind(t, t.filterFrame, a);
      } else
        t !== this.defaultFilterStack[this.defaultFilterStack.length - 1].renderTexture
          ? r.bind(t)
          : this.renderer.renderTexture.bind(
              t,
              this.activeState.bindingSourceFrame,
              this.activeState.bindingDestinationFrame
            );
      const n = s.stateId & 1 || this.forceClear;
      (e === Ot.CLEAR || (e === Ot.BLIT && n)) && this.renderer.framebuffer.clear(0, 0, 0, 0);
    }
    applyFilter(t, e, r, s) {
      const n = this.renderer;
      n.state.set(t.state),
        this.bindAndClear(r, s),
        (t.uniforms.uSampler = e),
        (t.uniforms.filterGlobals = this.globalUniforms),
        n.shader.bind(t),
        (t.legacy = !!t.program.attributeData.aTextureCoord),
        t.legacy
          ? (this.quadUv.map(e._frame, e.filterFrame),
            n.geometry.bind(this.quadUv),
            n.geometry.draw(Dt.TRIANGLES))
          : (n.geometry.bind(this.quad), n.geometry.draw(Dt.TRIANGLE_STRIP));
    }
    calculateSpriteMatrix(t, e) {
      const { sourceFrame: r, destinationFrame: s } = this.activeState,
        { orig: n } = e._texture,
        a = t.set(s.width, 0, 0, s.height, r.x, r.y),
        o = e.worldTransform.copyTo(Q.TEMP_MATRIX);
      return (
        o.invert(),
        a.prepend(o),
        a.scale(1 / n.width, 1 / n.height),
        a.translate(e.anchor.x, e.anchor.y),
        a
      );
    }
    destroy() {
      (this.renderer = null), this.texturePool.clear(!1);
    }
    getOptimalFilterTexture(t, e, r = 1, s = ot.NONE) {
      return this.texturePool.getOptimalTexture(t, e, r, s);
    }
    getFilterTexture(t, e, r) {
      if (typeof t == "number") {
        const n = t;
        (t = e), (e = n);
      }
      t = t || this.activeState.renderTexture;
      const s = this.texturePool.getOptimalTexture(
        t.width,
        t.height,
        e || t.resolution,
        r || ot.NONE
      );
      return (s.filterFrame = t.filterFrame), s;
    }
    returnFilterTexture(t) {
      this.texturePool.returnTexture(t);
    }
    emptyPool() {
      this.texturePool.clear(!0);
    }
    resize() {
      this.texturePool.setScreenSize(this.renderer.view);
    }
    transformAABB(t, e) {
      const r = $i[0],
        s = $i[1],
        n = $i[2],
        a = $i[3];
      r.set(e.left, e.top),
        s.set(e.left, e.bottom),
        n.set(e.right, e.top),
        a.set(e.right, e.bottom),
        t.apply(r, r),
        t.apply(s, s),
        t.apply(n, n),
        t.apply(a, a);
      const o = Math.min(r.x, s.x, n.x, a.x),
        h = Math.min(r.y, s.y, n.y, a.y),
        l = Math.max(r.x, s.x, n.x, a.x),
        u = Math.max(r.y, s.y, n.y, a.y);
      (e.x = o), (e.y = h), (e.width = l - o), (e.height = u - h);
    }
    roundFrame(t, e, r, s, n) {
      if (!(t.width <= 0 || t.height <= 0 || r.width <= 0 || r.height <= 0)) {
        if (n) {
          const { a, b: o, c: h, d: l } = n;
          if (
            (Math.abs(o) > 1e-4 || Math.abs(h) > 1e-4) &&
            (Math.abs(a) > 1e-4 || Math.abs(l) > 1e-4)
          )
            return;
        }
        (n = n ? ss.copyFrom(n) : ss.identity()),
          n
            .translate(-r.x, -r.y)
            .scale(s.width / r.width, s.height / r.height)
            .translate(s.x, s.y),
          this.transformAABB(n, t),
          t.ceil(e),
          this.transformAABB(n.invert(), t);
      }
    }
  }
  (ns.extension = { type: P.RendererSystem, name: "filter" }), B.add(ns);
  class ti {
    constructor(t) {
      this.renderer = t;
    }
    flush() {}
    destroy() {
      this.renderer = null;
    }
    start() {}
    stop() {
      this.flush();
    }
    render(t) {}
  }
  class as {
    constructor(t) {
      (this.renderer = t),
        (this.emptyRenderer = new ti(t)),
        (this.currentRenderer = this.emptyRenderer);
    }
    setObjectRenderer(t) {
      this.currentRenderer !== t &&
        (this.currentRenderer.stop(), (this.currentRenderer = t), this.currentRenderer.start());
    }
    flush() {
      this.setObjectRenderer(this.emptyRenderer);
    }
    reset() {
      this.setObjectRenderer(this.emptyRenderer);
    }
    copyBoundTextures(t, e) {
      const { boundTextures: r } = this.renderer.texture;
      for (let s = e - 1; s >= 0; --s) (t[s] = r[s] || null), t[s] && (t[s]._batchLocation = s);
    }
    boundArray(t, e, r, s) {
      const { elements: n, ids: a, count: o } = t;
      let h = 0;
      for (let l = 0; l < o; l++) {
        const u = n[l],
          c = u._batchLocation;
        if (c >= 0 && c < s && e[c] === u) {
          a[l] = c;
          continue;
        }
        for (; h < s; ) {
          const d = e[h];
          if (d && d._batchEnabled === r && d._batchLocation === h) {
            h++;
            continue;
          }
          (a[l] = h), (u._batchLocation = h), (e[h] = u);
          break;
        }
      }
    }
    destroy() {
      this.renderer = null;
    }
  }
  (as.extension = { type: P.RendererSystem, name: "batch" }), B.add(as);
  let fa = 0;
  class os {
    constructor(t) {
      (this.renderer = t),
        (this.webGLVersion = 1),
        (this.extensions = {}),
        (this.supports = { uint32Indices: !1 }),
        (this.handleContextLost = this.handleContextLost.bind(this)),
        (this.handleContextRestored = this.handleContextRestored.bind(this));
    }
    get isLost() {
      return !this.gl || this.gl.isContextLost();
    }
    contextChange(t) {
      (this.gl = t),
        (this.renderer.gl = t),
        (this.renderer.CONTEXT_UID = fa++),
        t.isContextLost() &&
          t.getExtension("WEBGL_lose_context") &&
          t.getExtension("WEBGL_lose_context").restoreContext();
    }
    init(t) {
      var e;
      if (t.context) this.initFromContext(t.context);
      else {
        const r = this.renderer.background.alpha < 1,
          s = (e = t.premultipliedAlpha) != null ? e : !0;
        (this.preserveDrawingBuffer = t.preserveDrawingBuffer),
          (this.useContextAlpha = t.useContextAlpha),
          (this.powerPreference = t.powerPreference),
          this.initFromOptions({
            alpha: r,
            premultipliedAlpha: s,
            antialias: t.antialias,
            stencil: !0,
            preserveDrawingBuffer: t.preserveDrawingBuffer,
            powerPreference: t.powerPreference,
          });
      }
    }
    initFromContext(t) {
      (this.gl = t),
        this.validateContext(t),
        (this.renderer.gl = t),
        (this.renderer.CONTEXT_UID = fa++),
        this.renderer.runners.contextChange.emit(t),
        this.renderer.view.addEventListener("webglcontextlost", this.handleContextLost, !1),
        this.renderer.view.addEventListener("webglcontextrestored", this.handleContextRestored, !1);
    }
    initFromOptions(t) {
      const e = this.createContext(this.renderer.view, t);
      this.initFromContext(e);
    }
    createContext(t, e) {
      let r;
      if ((A.PREFER_ENV >= ae.WEBGL2 && (r = t.getContext("webgl2", e)), r)) this.webGLVersion = 2;
      else if (
        ((this.webGLVersion = 1),
        (r = t.getContext("webgl", e) || t.getContext("experimental-webgl", e)),
        !r)
      )
        throw new Error("This browser does not support WebGL. Try using the canvas renderer");
      return (this.gl = r), this.getExtensions(), this.gl;
    }
    getExtensions() {
      const { gl: t } = this,
        e = {
          anisotropicFiltering: t.getExtension("EXT_texture_filter_anisotropic"),
          floatTextureLinear: t.getExtension("OES_texture_float_linear"),
          s3tc: t.getExtension("WEBGL_compressed_texture_s3tc"),
          s3tc_sRGB: t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),
          etc: t.getExtension("WEBGL_compressed_texture_etc"),
          etc1: t.getExtension("WEBGL_compressed_texture_etc1"),
          pvrtc:
            t.getExtension("WEBGL_compressed_texture_pvrtc") ||
            t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),
          atc: t.getExtension("WEBGL_compressed_texture_atc"),
          astc: t.getExtension("WEBGL_compressed_texture_astc"),
        };
      this.webGLVersion === 1
        ? Object.assign(this.extensions, e, {
            drawBuffers: t.getExtension("WEBGL_draw_buffers"),
            depthTexture: t.getExtension("WEBGL_depth_texture"),
            loseContext: t.getExtension("WEBGL_lose_context"),
            vertexArrayObject:
              t.getExtension("OES_vertex_array_object") ||
              t.getExtension("MOZ_OES_vertex_array_object") ||
              t.getExtension("WEBKIT_OES_vertex_array_object"),
            uint32ElementIndex: t.getExtension("OES_element_index_uint"),
            floatTexture: t.getExtension("OES_texture_float"),
            floatTextureLinear: t.getExtension("OES_texture_float_linear"),
            textureHalfFloat: t.getExtension("OES_texture_half_float"),
            textureHalfFloatLinear: t.getExtension("OES_texture_half_float_linear"),
          })
        : this.webGLVersion === 2 &&
          Object.assign(this.extensions, e, {
            colorBufferFloat: t.getExtension("EXT_color_buffer_float"),
          });
    }
    handleContextLost(t) {
      t.preventDefault();
    }
    handleContextRestored() {
      this.renderer.runners.contextChange.emit(this.gl);
    }
    destroy() {
      const t = this.renderer.view;
      (this.renderer = null),
        t.removeEventListener("webglcontextlost", this.handleContextLost),
        t.removeEventListener("webglcontextrestored", this.handleContextRestored),
        this.gl.useProgram(null),
        this.extensions.loseContext && this.extensions.loseContext.loseContext();
    }
    postrender() {
      this.renderer.objectRenderer.renderingToScreen && this.gl.flush();
    }
    validateContext(t) {
      const e = t.getContextAttributes(),
        r =
          "WebGL2RenderingContext" in globalThis && t instanceof globalThis.WebGL2RenderingContext;
      r && (this.webGLVersion = 2),
        e &&
          !e.stencil &&
          console.warn(
            "Provided WebGL context does not have a stencil buffer, masks may not render correctly"
          );
      const s = r || !!t.getExtension("OES_element_index_uint");
      (this.supports.uint32Indices = s),
        s ||
          console.warn(
            "Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly"
          );
    }
  }
  (os.extension = { type: P.RendererSystem, name: "context" }), B.add(os);
  class pa {
    constructor(t) {
      (this.framebuffer = t),
        (this.stencil = null),
        (this.dirtyId = -1),
        (this.dirtyFormat = -1),
        (this.dirtySize = -1),
        (this.multisample = ot.NONE),
        (this.msaaBuffer = null),
        (this.blitFramebuffer = null),
        (this.mipLevel = 0);
    }
  }
  const Qc = new z();
  class hs {
    constructor(t) {
      (this.renderer = t),
        (this.managedFramebuffers = []),
        (this.unknownFramebuffer = new ki(10, 10)),
        (this.msaaSamples = null);
    }
    contextChange() {
      const t = (this.gl = this.renderer.gl);
      if (
        ((this.CONTEXT_UID = this.renderer.CONTEXT_UID),
        (this.current = this.unknownFramebuffer),
        (this.viewport = new z()),
        (this.hasMRT = !0),
        (this.writeDepthTexture = !0),
        this.disposeAll(!0),
        this.renderer.context.webGLVersion === 1)
      ) {
        let e = this.renderer.context.extensions.drawBuffers,
          r = this.renderer.context.extensions.depthTexture;
        A.PREFER_ENV === ae.WEBGL_LEGACY && ((e = null), (r = null)),
          e
            ? (t.drawBuffers = (s) => e.drawBuffersWEBGL(s))
            : ((this.hasMRT = !1), (t.drawBuffers = () => {})),
          r || (this.writeDepthTexture = !1);
      } else this.msaaSamples = t.getInternalformatParameter(t.RENDERBUFFER, t.RGBA8, t.SAMPLES);
    }
    bind(t, e, r = 0) {
      const { gl: s } = this;
      if (t) {
        const n = t.glFramebuffers[this.CONTEXT_UID] || this.initFramebuffer(t);
        this.current !== t && ((this.current = t), s.bindFramebuffer(s.FRAMEBUFFER, n.framebuffer)),
          n.mipLevel !== r && (t.dirtyId++, t.dirtyFormat++, (n.mipLevel = r)),
          n.dirtyId !== t.dirtyId &&
            ((n.dirtyId = t.dirtyId),
            n.dirtyFormat !== t.dirtyFormat
              ? ((n.dirtyFormat = t.dirtyFormat),
                (n.dirtySize = t.dirtySize),
                this.updateFramebuffer(t, r))
              : n.dirtySize !== t.dirtySize &&
                ((n.dirtySize = t.dirtySize), this.resizeFramebuffer(t)));
        for (let a = 0; a < t.colorTextures.length; a++) {
          const o = t.colorTextures[a];
          this.renderer.texture.unbind(o.parentTextureArray || o);
        }
        if ((t.depthTexture && this.renderer.texture.unbind(t.depthTexture), e)) {
          const a = e.width >> r,
            o = e.height >> r,
            h = a / e.width;
          this.setViewport(e.x * h, e.y * h, a, o);
        } else {
          const a = t.width >> r,
            o = t.height >> r;
          this.setViewport(0, 0, a, o);
        }
      } else
        this.current && ((this.current = null), s.bindFramebuffer(s.FRAMEBUFFER, null)),
          e
            ? this.setViewport(e.x, e.y, e.width, e.height)
            : this.setViewport(0, 0, this.renderer.width, this.renderer.height);
    }
    setViewport(t, e, r, s) {
      const n = this.viewport;
      (t = Math.round(t)),
        (e = Math.round(e)),
        (r = Math.round(r)),
        (s = Math.round(s)),
        (n.width !== r || n.height !== s || n.x !== t || n.y !== e) &&
          ((n.x = t), (n.y = e), (n.width = r), (n.height = s), this.gl.viewport(t, e, r, s));
    }
    get size() {
      return this.current
        ? { x: 0, y: 0, width: this.current.width, height: this.current.height }
        : { x: 0, y: 0, width: this.renderer.width, height: this.renderer.height };
    }
    clear(t, e, r, s, n = Ei.COLOR | Ei.DEPTH) {
      const { gl: a } = this;
      a.clearColor(t, e, r, s), a.clear(n);
    }
    initFramebuffer(t) {
      const { gl: e } = this,
        r = new pa(e.createFramebuffer());
      return (
        (r.multisample = this.detectSamples(t.multisample)),
        (t.glFramebuffers[this.CONTEXT_UID] = r),
        this.managedFramebuffers.push(t),
        t.disposeRunner.add(this),
        r
      );
    }
    resizeFramebuffer(t) {
      const { gl: e } = this,
        r = t.glFramebuffers[this.CONTEXT_UID];
      r.msaaBuffer &&
        (e.bindRenderbuffer(e.RENDERBUFFER, r.msaaBuffer),
        e.renderbufferStorageMultisample(
          e.RENDERBUFFER,
          r.multisample,
          e.RGBA8,
          t.width,
          t.height
        )),
        r.stencil &&
          (e.bindRenderbuffer(e.RENDERBUFFER, r.stencil),
          r.msaaBuffer
            ? e.renderbufferStorageMultisample(
                e.RENDERBUFFER,
                r.multisample,
                e.DEPTH24_STENCIL8,
                t.width,
                t.height
              )
            : e.renderbufferStorage(e.RENDERBUFFER, e.DEPTH_STENCIL, t.width, t.height));
      const s = t.colorTextures;
      let n = s.length;
      e.drawBuffers || (n = Math.min(n, 1));
      for (let a = 0; a < n; a++) {
        const o = s[a],
          h = o.parentTextureArray || o;
        this.renderer.texture.bind(h, 0);
      }
      t.depthTexture && this.writeDepthTexture && this.renderer.texture.bind(t.depthTexture, 0);
    }
    updateFramebuffer(t, e) {
      const { gl: r } = this,
        s = t.glFramebuffers[this.CONTEXT_UID],
        n = t.colorTextures;
      let a = n.length;
      r.drawBuffers || (a = Math.min(a, 1)),
        s.multisample > 1 && this.canMultisampleFramebuffer(t)
          ? ((s.msaaBuffer = s.msaaBuffer || r.createRenderbuffer()),
            r.bindRenderbuffer(r.RENDERBUFFER, s.msaaBuffer),
            r.renderbufferStorageMultisample(
              r.RENDERBUFFER,
              s.multisample,
              r.RGBA8,
              t.width,
              t.height
            ),
            r.framebufferRenderbuffer(
              r.FRAMEBUFFER,
              r.COLOR_ATTACHMENT0,
              r.RENDERBUFFER,
              s.msaaBuffer
            ))
          : s.msaaBuffer &&
            (r.deleteRenderbuffer(s.msaaBuffer),
            (s.msaaBuffer = null),
            s.blitFramebuffer && (s.blitFramebuffer.dispose(), (s.blitFramebuffer = null)));
      const o = [];
      for (let h = 0; h < a; h++) {
        const l = n[h],
          u = l.parentTextureArray || l;
        this.renderer.texture.bind(u, 0),
          !(h === 0 && s.msaaBuffer) &&
            (r.framebufferTexture2D(
              r.FRAMEBUFFER,
              r.COLOR_ATTACHMENT0 + h,
              l.target,
              u._glTextures[this.CONTEXT_UID].texture,
              e
            ),
            o.push(r.COLOR_ATTACHMENT0 + h));
      }
      if ((o.length > 1 && r.drawBuffers(o), t.depthTexture && this.writeDepthTexture)) {
        const h = t.depthTexture;
        this.renderer.texture.bind(h, 0),
          r.framebufferTexture2D(
            r.FRAMEBUFFER,
            r.DEPTH_ATTACHMENT,
            r.TEXTURE_2D,
            h._glTextures[this.CONTEXT_UID].texture,
            e
          );
      }
      (t.stencil || t.depth) && !(t.depthTexture && this.writeDepthTexture)
        ? ((s.stencil = s.stencil || r.createRenderbuffer()),
          r.bindRenderbuffer(r.RENDERBUFFER, s.stencil),
          s.msaaBuffer
            ? r.renderbufferStorageMultisample(
                r.RENDERBUFFER,
                s.multisample,
                r.DEPTH24_STENCIL8,
                t.width,
                t.height
              )
            : r.renderbufferStorage(r.RENDERBUFFER, r.DEPTH_STENCIL, t.width, t.height),
          r.framebufferRenderbuffer(
            r.FRAMEBUFFER,
            r.DEPTH_STENCIL_ATTACHMENT,
            r.RENDERBUFFER,
            s.stencil
          ))
        : s.stencil && (r.deleteRenderbuffer(s.stencil), (s.stencil = null));
    }
    canMultisampleFramebuffer(t) {
      return (
        this.renderer.context.webGLVersion !== 1 && t.colorTextures.length <= 1 && !t.depthTexture
      );
    }
    detectSamples(t) {
      const { msaaSamples: e } = this;
      let r = ot.NONE;
      if (t <= 1 || e === null) return r;
      for (let s = 0; s < e.length; s++)
        if (e[s] <= t) {
          r = e[s];
          break;
        }
      return r === 1 && (r = ot.NONE), r;
    }
    blit(t, e, r) {
      const { current: s, renderer: n, gl: a, CONTEXT_UID: o } = this;
      if (n.context.webGLVersion !== 2 || !s) return;
      const h = s.glFramebuffers[o];
      if (!h) return;
      if (!t) {
        if (!h.msaaBuffer) return;
        const u = s.colorTextures[0];
        if (!u) return;
        h.blitFramebuffer ||
          ((h.blitFramebuffer = new ki(s.width, s.height)),
          h.blitFramebuffer.addColorTexture(0, u)),
          (t = h.blitFramebuffer),
          t.colorTextures[0] !== u && ((t.colorTextures[0] = u), t.dirtyId++, t.dirtyFormat++),
          (t.width !== s.width || t.height !== s.height) &&
            ((t.width = s.width), (t.height = s.height), t.dirtyId++, t.dirtySize++);
      }
      e || ((e = Qc), (e.width = s.width), (e.height = s.height)), r || (r = e);
      const l = e.width === r.width && e.height === r.height;
      this.bind(t),
        a.bindFramebuffer(a.READ_FRAMEBUFFER, h.framebuffer),
        a.blitFramebuffer(
          e.left,
          e.top,
          e.right,
          e.bottom,
          r.left,
          r.top,
          r.right,
          r.bottom,
          a.COLOR_BUFFER_BIT,
          l ? a.NEAREST : a.LINEAR
        );
    }
    disposeFramebuffer(t, e) {
      const r = t.glFramebuffers[this.CONTEXT_UID],
        s = this.gl;
      if (!r) return;
      delete t.glFramebuffers[this.CONTEXT_UID];
      const n = this.managedFramebuffers.indexOf(t);
      n >= 0 && this.managedFramebuffers.splice(n, 1),
        t.disposeRunner.remove(this),
        e ||
          (s.deleteFramebuffer(r.framebuffer),
          r.msaaBuffer && s.deleteRenderbuffer(r.msaaBuffer),
          r.stencil && s.deleteRenderbuffer(r.stencil)),
        r.blitFramebuffer && r.blitFramebuffer.dispose();
    }
    disposeAll(t) {
      const e = this.managedFramebuffers;
      this.managedFramebuffers = [];
      for (let r = 0; r < e.length; r++) this.disposeFramebuffer(e[r], t);
    }
    forceStencil() {
      const t = this.current;
      if (!t) return;
      const e = t.glFramebuffers[this.CONTEXT_UID];
      if (!e || e.stencil) return;
      t.stencil = !0;
      const r = t.width,
        s = t.height,
        n = this.gl,
        a = n.createRenderbuffer();
      n.bindRenderbuffer(n.RENDERBUFFER, a),
        e.msaaBuffer
          ? n.renderbufferStorageMultisample(
              n.RENDERBUFFER,
              e.multisample,
              n.DEPTH24_STENCIL8,
              r,
              s
            )
          : n.renderbufferStorage(n.RENDERBUFFER, n.DEPTH_STENCIL, r, s),
        (e.stencil = a),
        n.framebufferRenderbuffer(n.FRAMEBUFFER, n.DEPTH_STENCIL_ATTACHMENT, n.RENDERBUFFER, a);
    }
    reset() {
      (this.current = this.unknownFramebuffer), (this.viewport = new z());
    }
    destroy() {
      this.renderer = null;
    }
  }
  (hs.extension = { type: P.RendererSystem, name: "framebuffer" }), B.add(hs);
  const ls = { 5126: 4, 5123: 2, 5121: 1 };
  class us {
    constructor(t) {
      (this.renderer = t),
        (this._activeGeometry = null),
        (this._activeVao = null),
        (this.hasVao = !0),
        (this.hasInstance = !0),
        (this.canUseUInt32ElementIndex = !1),
        (this.managedGeometries = {});
    }
    contextChange() {
      this.disposeAll(!0);
      const t = (this.gl = this.renderer.gl),
        e = this.renderer.context;
      if (((this.CONTEXT_UID = this.renderer.CONTEXT_UID), e.webGLVersion !== 2)) {
        let r = this.renderer.context.extensions.vertexArrayObject;
        A.PREFER_ENV === ae.WEBGL_LEGACY && (r = null),
          r
            ? ((t.createVertexArray = () => r.createVertexArrayOES()),
              (t.bindVertexArray = (s) => r.bindVertexArrayOES(s)),
              (t.deleteVertexArray = (s) => r.deleteVertexArrayOES(s)))
            : ((this.hasVao = !1),
              (t.createVertexArray = () => null),
              (t.bindVertexArray = () => null),
              (t.deleteVertexArray = () => null));
      }
      if (e.webGLVersion !== 2) {
        const r = t.getExtension("ANGLE_instanced_arrays");
        r
          ? ((t.vertexAttribDivisor = (s, n) => r.vertexAttribDivisorANGLE(s, n)),
            (t.drawElementsInstanced = (s, n, a, o, h) =>
              r.drawElementsInstancedANGLE(s, n, a, o, h)),
            (t.drawArraysInstanced = (s, n, a, o) => r.drawArraysInstancedANGLE(s, n, a, o)))
          : (this.hasInstance = !1);
      }
      this.canUseUInt32ElementIndex = e.webGLVersion === 2 || !!e.extensions.uint32ElementIndex;
    }
    bind(t, e) {
      e = e || this.renderer.shader.shader;
      const { gl: r } = this;
      let s = t.glVertexArrayObjects[this.CONTEXT_UID],
        n = !1;
      s ||
        ((this.managedGeometries[t.id] = t),
        t.disposeRunner.add(this),
        (t.glVertexArrayObjects[this.CONTEXT_UID] = s = {}),
        (n = !0));
      const a = s[e.program.id] || this.initGeometryVao(t, e, n);
      (this._activeGeometry = t),
        this._activeVao !== a &&
          ((this._activeVao = a),
          this.hasVao ? r.bindVertexArray(a) : this.activateVao(t, e.program)),
        this.updateBuffers();
    }
    reset() {
      this.unbind();
    }
    updateBuffers() {
      const t = this._activeGeometry,
        e = this.renderer.buffer;
      for (let r = 0; r < t.buffers.length; r++) {
        const s = t.buffers[r];
        e.update(s);
      }
    }
    checkCompatibility(t, e) {
      const r = t.attributes,
        s = e.attributeData;
      for (const n in s)
        if (!r[n])
          throw new Error(
            `shader and geometry incompatible, geometry missing the "${n}" attribute`
          );
    }
    getSignature(t, e) {
      const r = t.attributes,
        s = e.attributeData,
        n = ["g", t.id];
      for (const a in r) s[a] && n.push(a, s[a].location);
      return n.join("-");
    }
    initGeometryVao(t, e, r = !0) {
      const s = this.gl,
        n = this.CONTEXT_UID,
        a = this.renderer.buffer,
        o = e.program;
      o.glPrograms[n] || this.renderer.shader.generateProgram(e), this.checkCompatibility(t, o);
      const h = this.getSignature(t, o),
        l = t.glVertexArrayObjects[this.CONTEXT_UID];
      let u = l[h];
      if (u) return (l[o.id] = u), u;
      const c = t.buffers,
        d = t.attributes,
        f = {},
        p = {};
      for (const g in c) (f[g] = 0), (p[g] = 0);
      for (const g in d)
        !d[g].size && o.attributeData[g]
          ? (d[g].size = o.attributeData[g].size)
          : d[g].size ||
            console.warn(
              `PIXI Geometry attribute '${g}' size cannot be determined (likely the bound shader does not have the attribute)`
            ),
          (f[d[g].buffer] += d[g].size * ls[d[g].type]);
      for (const g in d) {
        const _ = d[g],
          T = _.size;
        _.stride === void 0 &&
          (f[_.buffer] === T * ls[_.type] ? (_.stride = 0) : (_.stride = f[_.buffer])),
          _.start === void 0 && ((_.start = p[_.buffer]), (p[_.buffer] += T * ls[_.type]));
      }
      (u = s.createVertexArray()), s.bindVertexArray(u);
      for (let g = 0; g < c.length; g++) {
        const _ = c[g];
        a.bind(_), r && _._glBuffers[n].refCount++;
      }
      return this.activateVao(t, o), (this._activeVao = u), (l[o.id] = u), (l[h] = u), u;
    }
    disposeGeometry(t, e) {
      var o;
      if (!this.managedGeometries[t.id]) return;
      delete this.managedGeometries[t.id];
      const r = t.glVertexArrayObjects[this.CONTEXT_UID],
        s = this.gl,
        n = t.buffers,
        a = (o = this.renderer) == null ? void 0 : o.buffer;
      if ((t.disposeRunner.remove(this), !!r)) {
        if (a)
          for (let h = 0; h < n.length; h++) {
            const l = n[h]._glBuffers[this.CONTEXT_UID];
            l && (l.refCount--, l.refCount === 0 && !e && a.dispose(n[h], e));
          }
        if (!e) {
          for (const h in r)
            if (h[0] === "g") {
              const l = r[h];
              this._activeVao === l && this.unbind(), s.deleteVertexArray(l);
            }
        }
        delete t.glVertexArrayObjects[this.CONTEXT_UID];
      }
    }
    disposeAll(t) {
      const e = Object.keys(this.managedGeometries);
      for (let r = 0; r < e.length; r++) this.disposeGeometry(this.managedGeometries[e[r]], t);
    }
    activateVao(t, e) {
      const r = this.gl,
        s = this.CONTEXT_UID,
        n = this.renderer.buffer,
        a = t.buffers,
        o = t.attributes;
      t.indexBuffer && n.bind(t.indexBuffer);
      let h = null;
      for (const l in o) {
        const u = o[l],
          c = a[u.buffer],
          d = c._glBuffers[s];
        if (e.attributeData[l]) {
          h !== d && (n.bind(c), (h = d));
          const f = e.attributeData[l].location;
          if (
            (r.enableVertexAttribArray(f),
            r.vertexAttribPointer(f, u.size, u.type || r.FLOAT, u.normalized, u.stride, u.start),
            u.instance)
          )
            if (this.hasInstance) r.vertexAttribDivisor(f, 1);
            else throw new Error("geometry error, GPU Instancing is not supported on this device");
        }
      }
    }
    draw(t, e, r, s) {
      const { gl: n } = this,
        a = this._activeGeometry;
      if (a.indexBuffer) {
        const o = a.indexBuffer.data.BYTES_PER_ELEMENT,
          h = o === 2 ? n.UNSIGNED_SHORT : n.UNSIGNED_INT;
        o === 2 || (o === 4 && this.canUseUInt32ElementIndex)
          ? a.instanced
            ? n.drawElementsInstanced(t, e || a.indexBuffer.data.length, h, (r || 0) * o, s || 1)
            : n.drawElements(t, e || a.indexBuffer.data.length, h, (r || 0) * o)
          : console.warn("unsupported index buffer type: uint32");
      } else
        a.instanced
          ? n.drawArraysInstanced(t, r, e || a.getSize(), s || 1)
          : n.drawArrays(t, r, e || a.getSize());
      return this;
    }
    unbind() {
      this.gl.bindVertexArray(null), (this._activeVao = null), (this._activeGeometry = null);
    }
    destroy() {
      this.renderer = null;
    }
  }
  (us.extension = { type: P.RendererSystem, name: "geometry" }), B.add(us);
  class ma {
    constructor(t = null) {
      (this.type = ht.NONE),
        (this.autoDetect = !0),
        (this.maskObject = t || null),
        (this.pooled = !1),
        (this.isMaskData = !0),
        (this.resolution = null),
        (this.multisample = A.FILTER_MULTISAMPLE),
        (this.enabled = !0),
        (this.colorMask = 15),
        (this._filters = null),
        (this._stencilCounter = 0),
        (this._scissorCounter = 0),
        (this._scissorRect = null),
        (this._scissorRectLocal = null),
        (this._colorMask = 15),
        (this._target = null);
    }
    get filter() {
      return this._filters ? this._filters[0] : null;
    }
    set filter(t) {
      t ? (this._filters ? (this._filters[0] = t) : (this._filters = [t])) : (this._filters = null);
    }
    reset() {
      this.pooled && ((this.maskObject = null), (this.type = ht.NONE), (this.autoDetect = !0)),
        (this._target = null),
        (this._scissorRectLocal = null);
    }
    copyCountersOrReset(t) {
      t
        ? ((this._stencilCounter = t._stencilCounter),
          (this._scissorCounter = t._scissorCounter),
          (this._scissorRect = t._scissorRect))
        : ((this._stencilCounter = 0), (this._scissorCounter = 0), (this._scissorRect = null));
    }
  }
  function _a(i, t, e) {
    const r = i.createShader(t);
    return i.shaderSource(r, e), i.compileShader(r), r;
  }
  function ga(i, t) {
    const e = i
        .getShaderSource(t)
        .split(
          `
`
        )
        .map((l, u) => `${u}: ${l}`),
      r = i.getShaderInfoLog(t),
      s = r.split(`
`),
      n = {},
      a = s
        .map((l) => parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/, "$1")))
        .filter((l) => (l && !n[l] ? ((n[l] = !0), !0) : !1)),
      o = [""];
    a.forEach((l) => {
      (e[l - 1] = `%c${e[l - 1]}%c`),
        o.push("background: #FF0000; color:#FFFFFF; font-size: 10px", "font-size: 10px");
    });
    const h = e.join(`
`);
    (o[0] = h),
      console.error(r),
      console.groupCollapsed("click to view full shader code"),
      console.warn(...o),
      console.groupEnd();
  }
  function Jc(i, t, e, r) {
    i.getProgramParameter(t, i.LINK_STATUS) ||
      (i.getShaderParameter(e, i.COMPILE_STATUS) || ga(i, e),
      i.getShaderParameter(r, i.COMPILE_STATUS) || ga(i, r),
      console.error("PixiJS Error: Could not initialize shader."),
      i.getProgramInfoLog(t) !== "" &&
        console.warn("PixiJS Warning: gl.getProgramInfoLog()", i.getProgramInfoLog(t)));
  }
  function cs(i) {
    const t = new Array(i);
    for (let e = 0; e < t.length; e++) t[e] = !1;
    return t;
  }
  function xa(i, t) {
    switch (i) {
      case "float":
        return 0;
      case "vec2":
        return new Float32Array(2 * t);
      case "vec3":
        return new Float32Array(3 * t);
      case "vec4":
        return new Float32Array(4 * t);
      case "int":
      case "uint":
      case "sampler2D":
      case "sampler2DArray":
        return 0;
      case "ivec2":
        return new Int32Array(2 * t);
      case "ivec3":
        return new Int32Array(3 * t);
      case "ivec4":
        return new Int32Array(4 * t);
      case "uvec2":
        return new Uint32Array(2 * t);
      case "uvec3":
        return new Uint32Array(3 * t);
      case "uvec4":
        return new Uint32Array(4 * t);
      case "bool":
        return !1;
      case "bvec2":
        return cs(2 * t);
      case "bvec3":
        return cs(3 * t);
      case "bvec4":
        return cs(4 * t);
      case "mat2":
        return new Float32Array([1, 0, 0, 1]);
      case "mat3":
        return new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);
      case "mat4":
        return new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
    }
    return null;
  }
  const Ta = {};
  let Ne = Ta;
  function ya() {
    if (Ne === Ta || (Ne == null ? void 0 : Ne.isContextLost())) {
      const i = A.ADAPTER.createCanvas();
      let t;
      A.PREFER_ENV >= ae.WEBGL2 && (t = i.getContext("webgl2", {})),
        t ||
          ((t = i.getContext("webgl", {}) || i.getContext("experimental-webgl", {})),
          t ? t.getExtension("WEBGL_draw_buffers") : (t = null)),
        (Ne = t);
    }
    return Ne;
  }
  let Hi;
  function td() {
    if (!Hi) {
      Hi = Xt.MEDIUM;
      const i = ya();
      i &&
        i.getShaderPrecisionFormat &&
        (Hi = i.getShaderPrecisionFormat(i.FRAGMENT_SHADER, i.HIGH_FLOAT).precision
          ? Xt.HIGH
          : Xt.MEDIUM);
    }
    return Hi;
  }
  function va(i, t, e) {
    if (i.substring(0, 9) !== "precision") {
      let r = t;
      return (
        t === Xt.HIGH && e !== Xt.HIGH && (r = Xt.MEDIUM),
        `precision ${r} float;
${i}`
      );
    } else if (e !== Xt.HIGH && i.substring(0, 15) === "precision highp")
      return i.replace("precision highp", "precision mediump");
    return i;
  }
  const ed = {
    float: 1,
    vec2: 2,
    vec3: 3,
    vec4: 4,
    int: 1,
    ivec2: 2,
    ivec3: 3,
    ivec4: 4,
    uint: 1,
    uvec2: 2,
    uvec3: 3,
    uvec4: 4,
    bool: 1,
    bvec2: 2,
    bvec3: 3,
    bvec4: 4,
    mat2: 4,
    mat3: 9,
    mat4: 16,
    sampler2D: 1,
  };
  function ba(i) {
    return ed[i];
  }
  let zi = null;
  const Ea = {
    FLOAT: "float",
    FLOAT_VEC2: "vec2",
    FLOAT_VEC3: "vec3",
    FLOAT_VEC4: "vec4",
    INT: "int",
    INT_VEC2: "ivec2",
    INT_VEC3: "ivec3",
    INT_VEC4: "ivec4",
    UNSIGNED_INT: "uint",
    UNSIGNED_INT_VEC2: "uvec2",
    UNSIGNED_INT_VEC3: "uvec3",
    UNSIGNED_INT_VEC4: "uvec4",
    BOOL: "bool",
    BOOL_VEC2: "bvec2",
    BOOL_VEC3: "bvec3",
    BOOL_VEC4: "bvec4",
    FLOAT_MAT2: "mat2",
    FLOAT_MAT3: "mat3",
    FLOAT_MAT4: "mat4",
    SAMPLER_2D: "sampler2D",
    INT_SAMPLER_2D: "sampler2D",
    UNSIGNED_INT_SAMPLER_2D: "sampler2D",
    SAMPLER_CUBE: "samplerCube",
    INT_SAMPLER_CUBE: "samplerCube",
    UNSIGNED_INT_SAMPLER_CUBE: "samplerCube",
    SAMPLER_2D_ARRAY: "sampler2DArray",
    INT_SAMPLER_2D_ARRAY: "sampler2DArray",
    UNSIGNED_INT_SAMPLER_2D_ARRAY: "sampler2DArray",
  };
  function Aa(i, t) {
    if (!zi) {
      const e = Object.keys(Ea);
      zi = {};
      for (let r = 0; r < e.length; ++r) {
        const s = e[r];
        zi[i[s]] = Ea[s];
      }
    }
    return zi[t];
  }
  const Ee = [
      {
        test: (i) => i.type === "float" && i.size === 1,
        code: (i) => `
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `,
      },
      {
        test: (i, t) =>
          (i.type === "sampler2D" || i.type === "samplerCube" || i.type === "sampler2DArray") &&
          i.size === 1 &&
          !i.isArray &&
          (t == null || t.castToBaseTexture !== void 0),
        code: (i) => `t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`,
      },
      {
        test: (i, t) => i.type === "mat3" && i.size === 1 && t.a !== void 0,
        code: (i) => `
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,
        codeUbo: (i) => `
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `,
      },
      {
        test: (i, t) => i.type === "vec2" && i.size === 1 && t.x !== void 0,
        code: (i) => `
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,
        codeUbo: (i) => `
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `,
      },
      {
        test: (i) => i.type === "vec2" && i.size === 1,
        code: (i) => `
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `,
      },
      {
        test: (i, t) => i.type === "vec4" && i.size === 1 && t.width !== void 0,
        code: (i) => `
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,
        codeUbo: (i) => `
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `,
      },
      {
        test: (i) => i.type === "vec4" && i.size === 1,
        code: (i) => `
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`,
      },
    ],
    id = {
      float: `
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,
      vec2: `
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,
      vec3: `
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,
      vec4: `
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,
      int: `
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,
      ivec2: `
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,
      ivec3: `
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,
      ivec4: `
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,
      uint: `
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,
      uvec2: `
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,
      uvec3: `
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,
      uvec4: `
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,
      bool: `
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,
      bvec2: `
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,
      bvec3: `
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,
      bvec4: `
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,
      mat2: "gl.uniformMatrix2fv(location, false, v)",
      mat3: "gl.uniformMatrix3fv(location, false, v)",
      mat4: "gl.uniformMatrix4fv(location, false, v)",
      sampler2D: `
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,
      samplerCube: `
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,
      sampler2DArray: `
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,
    },
    rd = {
      float: "gl.uniform1fv(location, v)",
      vec2: "gl.uniform2fv(location, v)",
      vec3: "gl.uniform3fv(location, v)",
      vec4: "gl.uniform4fv(location, v)",
      mat4: "gl.uniformMatrix4fv(location, false, v)",
      mat3: "gl.uniformMatrix3fv(location, false, v)",
      mat2: "gl.uniformMatrix2fv(location, false, v)",
      int: "gl.uniform1iv(location, v)",
      ivec2: "gl.uniform2iv(location, v)",
      ivec3: "gl.uniform3iv(location, v)",
      ivec4: "gl.uniform4iv(location, v)",
      uint: "gl.uniform1uiv(location, v)",
      uvec2: "gl.uniform2uiv(location, v)",
      uvec3: "gl.uniform3uiv(location, v)",
      uvec4: "gl.uniform4uiv(location, v)",
      bool: "gl.uniform1iv(location, v)",
      bvec2: "gl.uniform2iv(location, v)",
      bvec3: "gl.uniform3iv(location, v)",
      bvec4: "gl.uniform4iv(location, v)",
      sampler2D: "gl.uniform1iv(location, v)",
      samplerCube: "gl.uniform1iv(location, v)",
      sampler2DArray: "gl.uniform1iv(location, v)",
    };
  function sd(i, t) {
    var r;
    const e = [
      `
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `,
    ];
    for (const s in i.uniforms) {
      const n = t[s];
      if (!n) {
        (r = i.uniforms[s]) != null &&
          r.group &&
          (i.uniforms[s].ubo
            ? e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');
                    `)
            : e.push(`
                        renderer.shader.syncUniformGroup(uv.${s}, syncData);
                    `));
        continue;
      }
      const a = i.uniforms[s];
      let o = !1;
      for (let h = 0; h < Ee.length; h++)
        if (Ee[h].test(n, a)) {
          e.push(Ee[h].code(s, a)), (o = !0);
          break;
        }
      if (!o) {
        const h = (n.size === 1 ? id : rd)[n.type].replace("location", `ud["${s}"].location`);
        e.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${h};`);
      }
    }
    return new Function(
      "ud",
      "uv",
      "renderer",
      "syncData",
      e.join(`
`)
    );
  }
  const nd = [
    "precision mediump float;",
    "void main(void){",
    "float test = 0.1;",
    "%forloop%",
    "gl_FragColor = vec4(0.0);",
    "}",
  ].join(`
`);
  function ad(i) {
    let t = "";
    for (let e = 0; e < i; ++e)
      e > 0 &&
        (t += `
else `),
        e < i - 1 && (t += `if(test == ${e}.0){}`);
    return t;
  }
  function Ra(i, t) {
    if (i === 0) throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");
    const e = t.createShader(t.FRAGMENT_SHADER);
    for (;;) {
      const r = nd.replace(/%forloop%/gi, ad(i));
      if ((t.shaderSource(e, r), t.compileShader(e), !t.getShaderParameter(e, t.COMPILE_STATUS)))
        i = (i / 2) | 0;
      else break;
    }
    return i;
  }
  let ei;
  function od() {
    if (typeof ei == "boolean") return ei;
    try {
      ei =
        new Function("param1", "param2", "param3", "return param1[param2] === param3;")(
          { a: "b" },
          "a",
          "b"
        ) === !0;
    } catch (i) {
      ei = !1;
    }
    return ei;
  }
  var hd = `varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,
    ld = `attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;
  let ud = 0;
  const Wi = {};
  class zt {
    constructor(t, e, r = "pixi-shader") {
      (this.id = ud++),
        (this.vertexSrc = t || zt.defaultVertexSrc),
        (this.fragmentSrc = e || zt.defaultFragmentSrc),
        (this.vertexSrc = this.vertexSrc.trim()),
        (this.fragmentSrc = this.fragmentSrc.trim()),
        this.vertexSrc.substring(0, 8) !== "#version" &&
          ((r = r.replace(/\s+/g, "-")),
          Wi[r] ? (Wi[r]++, (r += `-${Wi[r]}`)) : (Wi[r] = 1),
          (this.vertexSrc = `#define SHADER_NAME ${r}
${this.vertexSrc}`),
          (this.fragmentSrc = `#define SHADER_NAME ${r}
${this.fragmentSrc}`),
          (this.vertexSrc = va(this.vertexSrc, A.PRECISION_VERTEX, Xt.HIGH)),
          (this.fragmentSrc = va(this.fragmentSrc, A.PRECISION_FRAGMENT, td()))),
        (this.glPrograms = {}),
        (this.syncUniforms = null);
    }
    static get defaultVertexSrc() {
      return ld;
    }
    static get defaultFragmentSrc() {
      return hd;
    }
    static from(t, e, r) {
      const s = t + e;
      let n = Yr[s];
      return n || (Yr[s] = n = new zt(t, e, r)), n;
    }
  }
  class Bt {
    constructor(t, e) {
      (this.uniformBindCount = 0),
        (this.program = t),
        e
          ? e instanceof It
            ? (this.uniformGroup = e)
            : (this.uniformGroup = new It(e))
          : (this.uniformGroup = new It({}));
    }
    checkUniformExists(t, e) {
      if (e.uniforms[t]) return !0;
      for (const r in e.uniforms) {
        const s = e.uniforms[r];
        if (s.group && this.checkUniformExists(t, s)) return !0;
      }
      return !1;
    }
    destroy() {
      this.uniformGroup = null;
    }
    get uniforms() {
      return this.uniformGroup.uniforms;
    }
    static from(t, e, r) {
      const s = zt.from(t, e);
      return new Bt(s, r);
    }
  }
  const ds = 0,
    fs = 1,
    ps = 2,
    ms = 3,
    _s = 4,
    gs = 5;
  class Wt {
    constructor() {
      (this.data = 0),
        (this.blendMode = G.NORMAL),
        (this.polygonOffset = 0),
        (this.blend = !0),
        (this.depthMask = !0);
    }
    get blend() {
      return !!(this.data & (1 << ds));
    }
    set blend(t) {
      !!(this.data & (1 << ds)) !== t && (this.data ^= 1 << ds);
    }
    get offsets() {
      return !!(this.data & (1 << fs));
    }
    set offsets(t) {
      !!(this.data & (1 << fs)) !== t && (this.data ^= 1 << fs);
    }
    get culling() {
      return !!(this.data & (1 << ps));
    }
    set culling(t) {
      !!(this.data & (1 << ps)) !== t && (this.data ^= 1 << ps);
    }
    get depthTest() {
      return !!(this.data & (1 << ms));
    }
    set depthTest(t) {
      !!(this.data & (1 << ms)) !== t && (this.data ^= 1 << ms);
    }
    get depthMask() {
      return !!(this.data & (1 << gs));
    }
    set depthMask(t) {
      !!(this.data & (1 << gs)) !== t && (this.data ^= 1 << gs);
    }
    get clockwiseFrontFace() {
      return !!(this.data & (1 << _s));
    }
    set clockwiseFrontFace(t) {
      !!(this.data & (1 << _s)) !== t && (this.data ^= 1 << _s);
    }
    get blendMode() {
      return this._blendMode;
    }
    set blendMode(t) {
      (this.blend = t !== G.NONE), (this._blendMode = t);
    }
    get polygonOffset() {
      return this._polygonOffset;
    }
    set polygonOffset(t) {
      (this.offsets = !!t), (this._polygonOffset = t);
    }
    static for2d() {
      const t = new Wt();
      return (t.depthTest = !1), (t.blend = !0), t;
    }
  }
  var cd = `varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,
    dd = `attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;
  class wt extends Bt {
    constructor(t, e, r) {
      const s = zt.from(t || wt.defaultVertexSrc, e || wt.defaultFragmentSrc);
      super(s, r),
        (this.padding = 0),
        (this.resolution = A.FILTER_RESOLUTION),
        (this.multisample = A.FILTER_MULTISAMPLE),
        (this.enabled = !0),
        (this.autoFit = !0),
        (this.state = new Wt());
    }
    apply(t, e, r, s, n) {
      t.applyFilter(this, e, r, s);
    }
    get blendMode() {
      return this.state.blendMode;
    }
    set blendMode(t) {
      this.state.blendMode = t;
    }
    get resolution() {
      return this._resolution;
    }
    set resolution(t) {
      this._resolution = t;
    }
    static get defaultVertexSrc() {
      return dd;
    }
    static get defaultFragmentSrc() {
      return cd;
    }
  }
  var fd = `attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,
    pd = `varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;
  const Sa = new Q();
  class Vi {
    constructor(t, e) {
      (this._texture = t),
        (this.mapCoord = new Q()),
        (this.uClampFrame = new Float32Array(4)),
        (this.uClampOffset = new Float32Array(2)),
        (this._textureID = -1),
        (this._updateID = 0),
        (this.clampOffset = 0),
        (this.clampMargin = typeof e > "u" ? 0.5 : e),
        (this.isSimple = !1);
    }
    get texture() {
      return this._texture;
    }
    set texture(t) {
      (this._texture = t), (this._textureID = -1);
    }
    multiplyUvs(t, e) {
      e === void 0 && (e = t);
      const r = this.mapCoord;
      for (let s = 0; s < t.length; s += 2) {
        const n = t[s],
          a = t[s + 1];
        (e[s] = n * r.a + a * r.c + r.tx), (e[s + 1] = n * r.b + a * r.d + r.ty);
      }
      return e;
    }
    update(t) {
      const e = this._texture;
      if (!e || !e.valid || (!t && this._textureID === e._updateID)) return !1;
      (this._textureID = e._updateID), this._updateID++;
      const r = e._uvs;
      this.mapCoord.set(r.x1 - r.x0, r.y1 - r.y0, r.x3 - r.x0, r.y3 - r.y0, r.x0, r.y0);
      const s = e.orig,
        n = e.trim;
      n &&
        (Sa.set(s.width / n.width, 0, 0, s.height / n.height, -n.x / n.width, -n.y / n.height),
        this.mapCoord.append(Sa));
      const a = e.baseTexture,
        o = this.uClampFrame,
        h = this.clampMargin / a.resolution,
        l = this.clampOffset;
      return (
        (o[0] = (e._frame.x + h + l) / a.width),
        (o[1] = (e._frame.y + h + l) / a.height),
        (o[2] = (e._frame.x + e._frame.width - h + l) / a.width),
        (o[3] = (e._frame.y + e._frame.height - h + l) / a.height),
        (this.uClampOffset[0] = l / a.realWidth),
        (this.uClampOffset[1] = l / a.realHeight),
        (this.isSimple =
          e._frame.width === a.width && e._frame.height === a.height && e.rotate === 0),
        !0
      );
    }
  }
  class Ia extends wt {
    constructor(t, e, r) {
      let s = null;
      typeof t != "string" &&
        e === void 0 &&
        r === void 0 &&
        ((s = t), (t = void 0), (e = void 0), (r = void 0)),
        super(t || fd, e || pd, r),
        (this.maskSprite = s),
        (this.maskMatrix = new Q());
    }
    get maskSprite() {
      return this._maskSprite;
    }
    set maskSprite(t) {
      (this._maskSprite = t), this._maskSprite && (this._maskSprite.renderable = !1);
    }
    apply(t, e, r, s) {
      const n = this._maskSprite,
        a = n._texture;
      !a.valid ||
        (a.uvMatrix || (a.uvMatrix = new Vi(a, 0)),
        a.uvMatrix.update(),
        (this.uniforms.npmAlpha = a.baseTexture.alphaMode ? 0 : 1),
        (this.uniforms.mask = a),
        (this.uniforms.otherMatrix = t
          .calculateSpriteMatrix(this.maskMatrix, n)
          .prepend(a.uvMatrix.mapCoord)),
        (this.uniforms.alpha = n.worldAlpha),
        (this.uniforms.maskClamp = a.uvMatrix.uClampFrame),
        t.applyFilter(this, e, r, s));
    }
  }
  class xs {
    constructor(t) {
      (this.renderer = t),
        (this.enableScissor = !0),
        (this.alphaMaskPool = []),
        (this.maskDataPool = []),
        (this.maskStack = []),
        (this.alphaMaskIndex = 0);
    }
    setMaskStack(t) {
      (this.maskStack = t),
        this.renderer.scissor.setMaskStack(t),
        this.renderer.stencil.setMaskStack(t);
    }
    push(t, e) {
      let r = e;
      if (!r.isMaskData) {
        const n = this.maskDataPool.pop() || new ma();
        (n.pooled = !0), (n.maskObject = e), (r = n);
      }
      const s = this.maskStack.length !== 0 ? this.maskStack[this.maskStack.length - 1] : null;
      if (
        (r.copyCountersOrReset(s),
        (r._colorMask = s ? s._colorMask : 15),
        r.autoDetect && this.detect(r),
        (r._target = t),
        r.type !== ht.SPRITE && this.maskStack.push(r),
        r.enabled)
      )
        switch (r.type) {
          case ht.SCISSOR:
            this.renderer.scissor.push(r);
            break;
          case ht.STENCIL:
            this.renderer.stencil.push(r);
            break;
          case ht.SPRITE:
            r.copyCountersOrReset(null), this.pushSpriteMask(r);
            break;
          case ht.COLOR:
            this.pushColorMask(r);
            break;
        }
      r.type === ht.SPRITE && this.maskStack.push(r);
    }
    pop(t) {
      const e = this.maskStack.pop();
      if (!(!e || e._target !== t)) {
        if (e.enabled)
          switch (e.type) {
            case ht.SCISSOR:
              this.renderer.scissor.pop(e);
              break;
            case ht.STENCIL:
              this.renderer.stencil.pop(e.maskObject);
              break;
            case ht.SPRITE:
              this.popSpriteMask(e);
              break;
            case ht.COLOR:
              this.popColorMask(e);
              break;
          }
        if ((e.reset(), e.pooled && this.maskDataPool.push(e), this.maskStack.length !== 0)) {
          const r = this.maskStack[this.maskStack.length - 1];
          r.type === ht.SPRITE && r._filters && (r._filters[0].maskSprite = r.maskObject);
        }
      }
    }
    detect(t) {
      const e = t.maskObject;
      e
        ? e.isSprite
          ? (t.type = ht.SPRITE)
          : this.enableScissor && this.renderer.scissor.testScissor(t)
          ? (t.type = ht.SCISSOR)
          : (t.type = ht.STENCIL)
        : (t.type = ht.COLOR);
    }
    pushSpriteMask(t) {
      var u, c;
      const { maskObject: e } = t,
        r = t._target;
      let s = t._filters;
      s ||
        ((s = this.alphaMaskPool[this.alphaMaskIndex]),
        s || (s = this.alphaMaskPool[this.alphaMaskIndex] = [new Ia()]));
      const n = this.renderer,
        a = n.renderTexture;
      let o, h;
      if (a.current) {
        const d = a.current;
        (o = t.resolution || d.resolution), (h = (u = t.multisample) != null ? u : d.multisample);
      } else
        (o = t.resolution || n.resolution), (h = (c = t.multisample) != null ? c : n.multisample);
      (s[0].resolution = o), (s[0].multisample = h), (s[0].maskSprite = e);
      const l = r.filterArea;
      (r.filterArea = e.getBounds(!0)),
        n.filter.push(r, s),
        (r.filterArea = l),
        t._filters || this.alphaMaskIndex++;
    }
    popSpriteMask(t) {
      this.renderer.filter.pop(),
        t._filters
          ? (t._filters[0].maskSprite = null)
          : (this.alphaMaskIndex--, (this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite = null));
    }
    pushColorMask(t) {
      const e = t._colorMask,
        r = (t._colorMask = e & t.colorMask);
      r !== e &&
        this.renderer.gl.colorMask((r & 1) !== 0, (r & 2) !== 0, (r & 4) !== 0, (r & 8) !== 0);
    }
    popColorMask(t) {
      const e = t._colorMask,
        r = this.maskStack.length > 0 ? this.maskStack[this.maskStack.length - 1]._colorMask : 15;
      r !== e &&
        this.renderer.gl.colorMask((r & 1) !== 0, (r & 2) !== 0, (r & 4) !== 0, (r & 8) !== 0);
    }
    destroy() {
      this.renderer = null;
    }
  }
  (xs.extension = { type: P.RendererSystem, name: "mask" }), B.add(xs);
  class wa {
    constructor(t) {
      (this.renderer = t), (this.maskStack = []), (this.glConst = 0);
    }
    getStackLength() {
      return this.maskStack.length;
    }
    setMaskStack(t) {
      const { gl: e } = this.renderer,
        r = this.getStackLength();
      this.maskStack = t;
      const s = this.getStackLength();
      s !== r && (s === 0 ? e.disable(this.glConst) : (e.enable(this.glConst), this._useCurrent()));
    }
    _useCurrent() {}
    destroy() {
      (this.renderer = null), (this.maskStack = null);
    }
  }
  const Ma = new Q(),
    Ca = [],
    Yi = class extends wa {
      constructor(i) {
        super(i), (this.glConst = A.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST);
      }
      getStackLength() {
        const i = this.maskStack[this.maskStack.length - 1];
        return i ? i._scissorCounter : 0;
      }
      calcScissorRect(i) {
        var a;
        if (i._scissorRectLocal) return;
        const t = i._scissorRect,
          { maskObject: e } = i,
          { renderer: r } = this,
          s = r.renderTexture,
          n = e.getBounds(!0, (a = Ca.pop()) != null ? a : new z());
        this.roundFrameToPixels(
          n,
          s.current ? s.current.resolution : r.resolution,
          s.sourceFrame,
          s.destinationFrame,
          r.projection.transform
        ),
          t && n.fit(t),
          (i._scissorRectLocal = n);
      }
      static isMatrixRotated(i) {
        if (!i) return !1;
        const { a: t, b: e, c: r, d: s } = i;
        return (
          (Math.abs(e) > 1e-4 || Math.abs(r) > 1e-4) && (Math.abs(t) > 1e-4 || Math.abs(s) > 1e-4)
        );
      }
      testScissor(i) {
        const { maskObject: t } = i;
        if (
          !t.isFastRect ||
          !t.isFastRect() ||
          Yi.isMatrixRotated(t.worldTransform) ||
          Yi.isMatrixRotated(this.renderer.projection.transform)
        )
          return !1;
        this.calcScissorRect(i);
        const e = i._scissorRectLocal;
        return e.width > 0 && e.height > 0;
      }
      roundFrameToPixels(i, t, e, r, s) {
        Yi.isMatrixRotated(s) ||
          ((s = s ? Ma.copyFrom(s) : Ma.identity()),
          s
            .translate(-e.x, -e.y)
            .scale(r.width / e.width, r.height / e.height)
            .translate(r.x, r.y),
          this.renderer.filter.transformAABB(s, i),
          i.fit(r),
          (i.x = Math.round(i.x * t)),
          (i.y = Math.round(i.y * t)),
          (i.width = Math.round(i.width * t)),
          (i.height = Math.round(i.height * t)));
      }
      push(i) {
        i._scissorRectLocal || this.calcScissorRect(i);
        const { gl: t } = this.renderer;
        i._scissorRect || t.enable(t.SCISSOR_TEST),
          i._scissorCounter++,
          (i._scissorRect = i._scissorRectLocal),
          this._useCurrent();
      }
      pop(i) {
        const { gl: t } = this.renderer;
        i && Ca.push(i._scissorRectLocal),
          this.getStackLength() > 0 ? this._useCurrent() : t.disable(t.SCISSOR_TEST);
      }
      _useCurrent() {
        const i = this.maskStack[this.maskStack.length - 1]._scissorRect;
        let t;
        this.renderer.renderTexture.current
          ? (t = i.y)
          : (t = this.renderer.height - i.height - i.y),
          this.renderer.gl.scissor(i.x, t, i.width, i.height);
      }
    };
  let Ts = Yi;
  (Ts.extension = { type: P.RendererSystem, name: "scissor" }), B.add(Ts);
  class ys extends wa {
    constructor(t) {
      super(t), (this.glConst = A.ADAPTER.getWebGLRenderingContext().STENCIL_TEST);
    }
    getStackLength() {
      const t = this.maskStack[this.maskStack.length - 1];
      return t ? t._stencilCounter : 0;
    }
    push(t) {
      const e = t.maskObject,
        { gl: r } = this.renderer,
        s = t._stencilCounter;
      s === 0 &&
        (this.renderer.framebuffer.forceStencil(),
        r.clearStencil(0),
        r.clear(r.STENCIL_BUFFER_BIT),
        r.enable(r.STENCIL_TEST)),
        t._stencilCounter++;
      const n = t._colorMask;
      n !== 0 && ((t._colorMask = 0), r.colorMask(!1, !1, !1, !1)),
        r.stencilFunc(r.EQUAL, s, 4294967295),
        r.stencilOp(r.KEEP, r.KEEP, r.INCR),
        (e.renderable = !0),
        e.render(this.renderer),
        this.renderer.batch.flush(),
        (e.renderable = !1),
        n !== 0 &&
          ((t._colorMask = n),
          r.colorMask((n & 1) !== 0, (n & 2) !== 0, (n & 4) !== 0, (n & 8) !== 0)),
        this._useCurrent();
    }
    pop(t) {
      const e = this.renderer.gl;
      if (this.getStackLength() === 0) e.disable(e.STENCIL_TEST);
      else {
        const r = this.maskStack.length !== 0 ? this.maskStack[this.maskStack.length - 1] : null,
          s = r ? r._colorMask : 15;
        s !== 0 && ((r._colorMask = 0), e.colorMask(!1, !1, !1, !1)),
          e.stencilOp(e.KEEP, e.KEEP, e.DECR),
          (t.renderable = !0),
          t.render(this.renderer),
          this.renderer.batch.flush(),
          (t.renderable = !1),
          s !== 0 &&
            ((r._colorMask = s),
            e.colorMask((s & 1) !== 0, (s & 2) !== 0, (s & 4) !== 0, (s & 8) !== 0)),
          this._useCurrent();
      }
    }
    _useCurrent() {
      const t = this.renderer.gl;
      t.stencilFunc(t.EQUAL, this.getStackLength(), 4294967295),
        t.stencilOp(t.KEEP, t.KEEP, t.KEEP);
    }
  }
  (ys.extension = { type: P.RendererSystem, name: "stencil" }), B.add(ys);
  class vs {
    constructor(t) {
      (this.renderer = t),
        (this.destinationFrame = null),
        (this.sourceFrame = null),
        (this.defaultFrame = null),
        (this.projectionMatrix = new Q()),
        (this.transform = null);
    }
    update(t, e, r, s) {
      (this.destinationFrame = t || this.destinationFrame || this.defaultFrame),
        (this.sourceFrame = e || this.sourceFrame || t),
        this.calculateProjection(this.destinationFrame, this.sourceFrame, r, s),
        this.transform && this.projectionMatrix.append(this.transform);
      const n = this.renderer;
      (n.globalUniforms.uniforms.projectionMatrix = this.projectionMatrix),
        n.globalUniforms.update(),
        n.shader.shader && n.shader.syncUniformGroup(n.shader.shader.uniforms.globals);
    }
    calculateProjection(t, e, r, s) {
      const n = this.projectionMatrix,
        a = s ? -1 : 1;
      n.identity(),
        (n.a = (1 / e.width) * 2),
        (n.d = a * ((1 / e.height) * 2)),
        (n.tx = -1 - e.x * n.a),
        (n.ty = -a - e.y * n.d);
    }
    setTransform(t) {}
    destroy() {
      this.renderer = null;
    }
  }
  (vs.extension = { type: P.RendererSystem, name: "projection" }), B.add(vs);
  const Ae = new z(),
    ii = new z();
  class bs {
    constructor(t) {
      (this.renderer = t),
        (this.defaultMaskStack = []),
        (this.current = null),
        (this.sourceFrame = new z()),
        (this.destinationFrame = new z()),
        (this.viewportFrame = new z());
    }
    bind(t = null, e, r) {
      const s = this.renderer;
      this.current = t;
      let n, a, o;
      t
        ? ((n = t.baseTexture),
          (o = n.resolution),
          e || ((Ae.width = t.frame.width), (Ae.height = t.frame.height), (e = Ae)),
          r ||
            ((ii.x = t.frame.x),
            (ii.y = t.frame.y),
            (ii.width = e.width),
            (ii.height = e.height),
            (r = ii)),
          (a = n.framebuffer))
        : ((o = s.resolution),
          e || ((Ae.width = s._view.screen.width), (Ae.height = s._view.screen.height), (e = Ae)),
          r || ((r = Ae), (r.width = e.width), (r.height = e.height)));
      const h = this.viewportFrame;
      (h.x = r.x * o),
        (h.y = r.y * o),
        (h.width = r.width * o),
        (h.height = r.height * o),
        t || (h.y = s.view.height - (h.y + h.height)),
        h.ceil(),
        this.renderer.framebuffer.bind(a, h),
        this.renderer.projection.update(r, e, o, !a),
        t
          ? this.renderer.mask.setMaskStack(n.maskStack)
          : this.renderer.mask.setMaskStack(this.defaultMaskStack),
        this.sourceFrame.copyFrom(e),
        this.destinationFrame.copyFrom(r);
    }
    clear(t, e) {
      this.current
        ? (t = t || this.current.baseTexture.clearColor)
        : (t = t || this.renderer.background.colorRgba);
      const r = this.destinationFrame,
        s = this.current ? this.current.baseTexture : this.renderer._view.screen,
        n = r.width !== s.width || r.height !== s.height;
      if (n) {
        let { x: a, y: o, width: h, height: l } = this.viewportFrame;
        (a = Math.round(a)),
          (o = Math.round(o)),
          (h = Math.round(h)),
          (l = Math.round(l)),
          this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),
          this.renderer.gl.scissor(a, o, h, l);
      }
      this.renderer.framebuffer.clear(t[0], t[1], t[2], t[3], e), n && this.renderer.scissor.pop();
    }
    resize() {
      this.bind(null);
    }
    reset() {
      this.bind(null);
    }
    destroy() {
      this.renderer = null;
    }
  }
  (bs.extension = { type: P.RendererSystem, name: "renderTexture" }), B.add(bs);
  function md(i, t, e, r, s) {
    e.buffer.update(s);
  }
  const _d = {
      float: `
        data[offset] = v;
    `,
      vec2: `
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,
      vec3: `
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,
      vec4: `
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,
      mat2: `
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,
      mat3: `
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,
      mat4: `
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `,
    },
    Da = {
      float: 4,
      vec2: 8,
      vec3: 12,
      vec4: 16,
      int: 4,
      ivec2: 8,
      ivec3: 12,
      ivec4: 16,
      uint: 4,
      uvec2: 8,
      uvec3: 12,
      uvec4: 16,
      bool: 4,
      bvec2: 8,
      bvec3: 12,
      bvec4: 16,
      mat2: 16 * 2,
      mat3: 16 * 3,
      mat4: 16 * 4,
    };
  function Pa(i) {
    const t = i.map((n) => ({ data: n, offset: 0, dataLen: 0, dirty: 0 }));
    let e = 0,
      r = 0,
      s = 0;
    for (let n = 0; n < t.length; n++) {
      const a = t[n];
      if (
        ((e = Da[a.data.type]),
        a.data.size > 1 && (e = Math.max(e, 16) * a.data.size),
        (a.dataLen = e),
        r % e !== 0 && r < 16)
      ) {
        const o = (r % e) % 16;
        (r += o), (s += o);
      }
      r + e > 16
        ? ((s = Math.ceil(s / 16) * 16), (a.offset = s), (s += e), (r = e))
        : ((a.offset = s), (r += e), (s += e));
    }
    return (s = Math.ceil(s / 16) * 16), { uboElements: t, size: s };
  }
  function Oa(i, t) {
    const e = [];
    for (const r in i) t[r] && e.push(t[r]);
    return e.sort((r, s) => r.index - s.index), e;
  }
  function Fa(i, t) {
    if (!i.autoManage) return { size: 0, syncFunc: md };
    const e = Oa(i.uniforms, t),
      { uboElements: r, size: s } = Pa(e),
      n = [
        `
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `,
      ];
    for (let a = 0; a < r.length; a++) {
      const o = r[a],
        h = i.uniforms[o.data.name],
        l = o.data.name;
      let u = !1;
      for (let c = 0; c < Ee.length; c++) {
        const d = Ee[c];
        if (d.codeUbo && d.test(o.data, h)) {
          n.push(`offset = ${o.offset / 4};`, Ee[c].codeUbo(o.data.name, h)), (u = !0);
          break;
        }
      }
      if (!u)
        if (o.data.size > 1) {
          const c = ba(o.data.type),
            d = Math.max(Da[o.data.type] / 16, 1),
            f = c / d,
            p = (4 - (f % 4)) % 4;
          n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset / 4};

                t = 0;

                for(var i=0; i < ${o.data.size * d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `);
        } else {
          const c = _d[o.data.type];
          n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset / 4};
                ${c};
                `);
        }
    }
    return (
      n.push(`
       renderer.buffer.update(buffer);
    `),
      {
        size: s,
        syncFunc: new Function(
          "ud",
          "uv",
          "renderer",
          "syncData",
          "buffer",
          n.join(`
`)
        ),
      }
    );
  }
  class gd {}
  class Na {
    constructor(t, e) {
      (this.program = t),
        (this.uniformData = e),
        (this.uniformGroups = {}),
        (this.uniformDirtyGroups = {}),
        (this.uniformBufferBindings = {});
    }
    destroy() {
      (this.uniformData = null),
        (this.uniformGroups = null),
        (this.uniformDirtyGroups = null),
        (this.uniformBufferBindings = null),
        (this.program = null);
    }
  }
  function xd(i, t) {
    const e = {},
      r = t.getProgramParameter(i, t.ACTIVE_ATTRIBUTES);
    for (let s = 0; s < r; s++) {
      const n = t.getActiveAttrib(i, s);
      if (n.name.startsWith("gl_")) continue;
      const a = Aa(t, n.type),
        o = { type: a, name: n.name, size: ba(a), location: t.getAttribLocation(i, n.name) };
      e[n.name] = o;
    }
    return e;
  }
  function Td(i, t) {
    const e = {},
      r = t.getProgramParameter(i, t.ACTIVE_UNIFORMS);
    for (let s = 0; s < r; s++) {
      const n = t.getActiveUniform(i, s),
        a = n.name.replace(/\[.*?\]$/, ""),
        o = !!n.name.match(/\[.*?\]$/),
        h = Aa(t, n.type);
      e[a] = { name: a, index: s, type: h, size: n.size, isArray: o, value: xa(h, n.size) };
    }
    return e;
  }
  function Ba(i, t) {
    const e = _a(i, i.VERTEX_SHADER, t.vertexSrc),
      r = _a(i, i.FRAGMENT_SHADER, t.fragmentSrc),
      s = i.createProgram();
    if (
      (i.attachShader(s, e),
      i.attachShader(s, r),
      i.linkProgram(s),
      i.getProgramParameter(s, i.LINK_STATUS) || Jc(i, s, e, r),
      (t.attributeData = xd(s, i)),
      (t.uniformData = Td(s, i)),
      !/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc))
    ) {
      const a = Object.keys(t.attributeData);
      a.sort((o, h) => (o > h ? 1 : -1));
      for (let o = 0; o < a.length; o++)
        (t.attributeData[a[o]].location = o), i.bindAttribLocation(s, o, a[o]);
      i.linkProgram(s);
    }
    i.deleteShader(e), i.deleteShader(r);
    const n = {};
    for (const a in t.uniformData) {
      const o = t.uniformData[a];
      n[a] = { location: i.getUniformLocation(s, a), value: xa(o.type, o.size) };
    }
    return new Na(s, n);
  }
  let yd = 0;
  const ji = { textureCount: 0, uboCount: 0 };
  class Es {
    constructor(t) {
      (this.destroyed = !1),
        (this.renderer = t),
        this.systemCheck(),
        (this.gl = null),
        (this.shader = null),
        (this.program = null),
        (this.cache = {}),
        (this._uboCache = {}),
        (this.id = yd++);
    }
    systemCheck() {
      if (!od())
        throw new Error(
          "Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support."
        );
    }
    contextChange(t) {
      (this.gl = t), this.reset();
    }
    bind(t, e) {
      t.uniforms.globals = this.renderer.globalUniforms;
      const r = t.program,
        s = r.glPrograms[this.renderer.CONTEXT_UID] || this.generateProgram(t);
      return (
        (this.shader = t),
        this.program !== r && ((this.program = r), this.gl.useProgram(s.program)),
        e || ((ji.textureCount = 0), (ji.uboCount = 0), this.syncUniformGroup(t.uniformGroup, ji)),
        s
      );
    }
    setUniforms(t) {
      const e = this.shader.program,
        r = e.glPrograms[this.renderer.CONTEXT_UID];
      e.syncUniforms(r.uniformData, t, this.renderer);
    }
    syncUniformGroup(t, e) {
      const r = this.getGlProgram();
      (!t.static || t.dirtyId !== r.uniformDirtyGroups[t.id]) &&
        ((r.uniformDirtyGroups[t.id] = t.dirtyId), this.syncUniforms(t, r, e));
    }
    syncUniforms(t, e, r) {
      (t.syncUniforms[this.shader.program.id] || this.createSyncGroups(t))(
        e.uniformData,
        t.uniforms,
        this.renderer,
        r
      );
    }
    createSyncGroups(t) {
      const e = this.getSignature(t, this.shader.program.uniformData, "u");
      return (
        this.cache[e] || (this.cache[e] = sd(t, this.shader.program.uniformData)),
        (t.syncUniforms[this.shader.program.id] = this.cache[e]),
        t.syncUniforms[this.shader.program.id]
      );
    }
    syncUniformBufferGroup(t, e) {
      const r = this.getGlProgram();
      if (!t.static || t.dirtyId !== 0 || !r.uniformGroups[t.id]) {
        t.dirtyId = 0;
        const s = r.uniformGroups[t.id] || this.createSyncBufferGroup(t, r, e);
        t.buffer.update(), s(r.uniformData, t.uniforms, this.renderer, ji, t.buffer);
      }
      this.renderer.buffer.bindBufferBase(t.buffer, r.uniformBufferBindings[e]);
    }
    createSyncBufferGroup(t, e, r) {
      const { gl: s } = this.renderer;
      this.renderer.buffer.bind(t.buffer);
      const n = this.gl.getUniformBlockIndex(e.program, r);
      (e.uniformBufferBindings[r] = this.shader.uniformBindCount),
        s.uniformBlockBinding(e.program, n, this.shader.uniformBindCount),
        this.shader.uniformBindCount++;
      const a = this.getSignature(t, this.shader.program.uniformData, "ubo");
      let o = this._uboCache[a];
      if ((o || (o = this._uboCache[a] = Fa(t, this.shader.program.uniformData)), t.autoManage)) {
        const h = new Float32Array(o.size / 4);
        t.buffer.update(h);
      }
      return (e.uniformGroups[t.id] = o.syncFunc), e.uniformGroups[t.id];
    }
    getSignature(t, e, r) {
      const s = t.uniforms,
        n = [`${r}-`];
      for (const a in s) n.push(a), e[a] && n.push(e[a].type);
      return n.join("-");
    }
    getGlProgram() {
      return this.shader ? this.shader.program.glPrograms[this.renderer.CONTEXT_UID] : null;
    }
    generateProgram(t) {
      const e = this.gl,
        r = t.program,
        s = Ba(e, r);
      return (r.glPrograms[this.renderer.CONTEXT_UID] = s), s;
    }
    reset() {
      (this.program = null), (this.shader = null);
    }
    destroy() {
      (this.renderer = null), (this.destroyed = !0);
    }
  }
  (Es.extension = { type: P.RendererSystem, name: "shader" }), B.add(Es);
  function vd(i, t = []) {
    return (
      (t[G.NORMAL] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.ADD] = [i.ONE, i.ONE]),
      (t[G.MULTIPLY] = [i.DST_COLOR, i.ONE_MINUS_SRC_ALPHA, i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.SCREEN] = [i.ONE, i.ONE_MINUS_SRC_COLOR, i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.OVERLAY] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.DARKEN] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.LIGHTEN] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.COLOR_DODGE] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.COLOR_BURN] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.HARD_LIGHT] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.SOFT_LIGHT] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.DIFFERENCE] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.EXCLUSION] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.HUE] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.SATURATION] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.COLOR] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.LUMINOSITY] = [i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.NONE] = [0, 0]),
      (t[G.NORMAL_NPM] = [i.SRC_ALPHA, i.ONE_MINUS_SRC_ALPHA, i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.ADD_NPM] = [i.SRC_ALPHA, i.ONE, i.ONE, i.ONE]),
      (t[G.SCREEN_NPM] = [i.SRC_ALPHA, i.ONE_MINUS_SRC_COLOR, i.ONE, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.SRC_IN] = [i.DST_ALPHA, i.ZERO]),
      (t[G.SRC_OUT] = [i.ONE_MINUS_DST_ALPHA, i.ZERO]),
      (t[G.SRC_ATOP] = [i.DST_ALPHA, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.DST_OVER] = [i.ONE_MINUS_DST_ALPHA, i.ONE]),
      (t[G.DST_IN] = [i.ZERO, i.SRC_ALPHA]),
      (t[G.DST_OUT] = [i.ZERO, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.DST_ATOP] = [i.ONE_MINUS_DST_ALPHA, i.SRC_ALPHA]),
      (t[G.XOR] = [i.ONE_MINUS_DST_ALPHA, i.ONE_MINUS_SRC_ALPHA]),
      (t[G.SUBTRACT] = [i.ONE, i.ONE, i.ONE, i.ONE, i.FUNC_REVERSE_SUBTRACT, i.FUNC_ADD]),
      t
    );
  }
  const bd = 0,
    Ed = 1,
    Ad = 2,
    Rd = 3,
    Sd = 4,
    Id = 5,
    As = class {
      constructor() {
        (this.gl = null),
          (this.stateId = 0),
          (this.polygonOffset = 0),
          (this.blendMode = G.NONE),
          (this._blendEq = !1),
          (this.map = []),
          (this.map[bd] = this.setBlend),
          (this.map[Ed] = this.setOffset),
          (this.map[Ad] = this.setCullFace),
          (this.map[Rd] = this.setDepthTest),
          (this.map[Sd] = this.setFrontFace),
          (this.map[Id] = this.setDepthMask),
          (this.checks = []),
          (this.defaultState = new Wt()),
          (this.defaultState.blend = !0);
      }
      contextChange(i) {
        (this.gl = i), (this.blendModes = vd(i)), this.set(this.defaultState), this.reset();
      }
      set(i) {
        if (((i = i || this.defaultState), this.stateId !== i.data)) {
          let t = this.stateId ^ i.data,
            e = 0;
          for (; t; ) t & 1 && this.map[e].call(this, !!(i.data & (1 << e))), (t = t >> 1), e++;
          this.stateId = i.data;
        }
        for (let t = 0; t < this.checks.length; t++) this.checks[t](this, i);
      }
      forceState(i) {
        i = i || this.defaultState;
        for (let t = 0; t < this.map.length; t++) this.map[t].call(this, !!(i.data & (1 << t)));
        for (let t = 0; t < this.checks.length; t++) this.checks[t](this, i);
        this.stateId = i.data;
      }
      setBlend(i) {
        this.updateCheck(As.checkBlendMode, i), this.gl[i ? "enable" : "disable"](this.gl.BLEND);
      }
      setOffset(i) {
        this.updateCheck(As.checkPolygonOffset, i),
          this.gl[i ? "enable" : "disable"](this.gl.POLYGON_OFFSET_FILL);
      }
      setDepthTest(i) {
        this.gl[i ? "enable" : "disable"](this.gl.DEPTH_TEST);
      }
      setDepthMask(i) {
        this.gl.depthMask(i);
      }
      setCullFace(i) {
        this.gl[i ? "enable" : "disable"](this.gl.CULL_FACE);
      }
      setFrontFace(i) {
        this.gl.frontFace(this.gl[i ? "CW" : "CCW"]);
      }
      setBlendMode(i) {
        if (i === this.blendMode) return;
        this.blendMode = i;
        const t = this.blendModes[i],
          e = this.gl;
        t.length === 2 ? e.blendFunc(t[0], t[1]) : e.blendFuncSeparate(t[0], t[1], t[2], t[3]),
          t.length === 6
            ? ((this._blendEq = !0), e.blendEquationSeparate(t[4], t[5]))
            : this._blendEq &&
              ((this._blendEq = !1), e.blendEquationSeparate(e.FUNC_ADD, e.FUNC_ADD));
      }
      setPolygonOffset(i, t) {
        this.gl.polygonOffset(i, t);
      }
      reset() {
        this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, !1),
          this.forceState(this.defaultState),
          (this._blendEq = !0),
          (this.blendMode = -1),
          this.setBlendMode(0);
      }
      updateCheck(i, t) {
        const e = this.checks.indexOf(i);
        t && e === -1 ? this.checks.push(i) : !t && e !== -1 && this.checks.splice(e, 1);
      }
      static checkBlendMode(i, t) {
        i.setBlendMode(t.blendMode);
      }
      static checkPolygonOffset(i, t) {
        i.setPolygonOffset(1, t.polygonOffset);
      }
      destroy() {
        this.gl = null;
      }
    };
  let Rs = As;
  (Rs.extension = { type: P.RendererSystem, name: "state" }), B.add(Rs);
  class Ss {
    constructor(t) {
      (this.renderer = t),
        (this.count = 0),
        (this.checkCount = 0),
        (this.maxIdle = A.GC_MAX_IDLE),
        (this.checkCountMax = A.GC_MAX_CHECK_COUNT),
        (this.mode = A.GC_MODE);
    }
    postrender() {
      !this.renderer.objectRenderer.renderingToScreen ||
        (this.count++,
        this.mode !== Rr.MANUAL &&
          (this.checkCount++,
          this.checkCount > this.checkCountMax && ((this.checkCount = 0), this.run())));
    }
    run() {
      const t = this.renderer.texture,
        e = t.managedTextures;
      let r = !1;
      for (let s = 0; s < e.length; s++) {
        const n = e[s];
        !n.framebuffer &&
          this.count - n.touched > this.maxIdle &&
          (t.destroyTexture(n, !0), (e[s] = null), (r = !0));
      }
      if (r) {
        let s = 0;
        for (let n = 0; n < e.length; n++) e[n] !== null && (e[s++] = e[n]);
        e.length = s;
      }
    }
    unload(t) {
      const e = this.renderer.texture,
        r = t._texture;
      r && !r.framebuffer && e.destroyTexture(r);
      for (let s = t.children.length - 1; s >= 0; s--) this.unload(t.children[s]);
    }
    destroy() {
      this.renderer = null;
    }
  }
  (Ss.extension = { type: P.RendererSystem, name: "textureGC" }), B.add(Ss);
  function wd(i) {
    let t;
    return (
      "WebGL2RenderingContext" in globalThis && i instanceof globalThis.WebGL2RenderingContext
        ? (t = {
            [L.UNSIGNED_BYTE]: {
              [S.RGBA]: i.RGBA8,
              [S.RGB]: i.RGB8,
              [S.RG]: i.RG8,
              [S.RED]: i.R8,
              [S.RGBA_INTEGER]: i.RGBA8UI,
              [S.RGB_INTEGER]: i.RGB8UI,
              [S.RG_INTEGER]: i.RG8UI,
              [S.RED_INTEGER]: i.R8UI,
              [S.ALPHA]: i.ALPHA,
              [S.LUMINANCE]: i.LUMINANCE,
              [S.LUMINANCE_ALPHA]: i.LUMINANCE_ALPHA,
            },
            [L.BYTE]: {
              [S.RGBA]: i.RGBA8_SNORM,
              [S.RGB]: i.RGB8_SNORM,
              [S.RG]: i.RG8_SNORM,
              [S.RED]: i.R8_SNORM,
              [S.RGBA_INTEGER]: i.RGBA8I,
              [S.RGB_INTEGER]: i.RGB8I,
              [S.RG_INTEGER]: i.RG8I,
              [S.RED_INTEGER]: i.R8I,
            },
            [L.UNSIGNED_SHORT]: {
              [S.RGBA_INTEGER]: i.RGBA16UI,
              [S.RGB_INTEGER]: i.RGB16UI,
              [S.RG_INTEGER]: i.RG16UI,
              [S.RED_INTEGER]: i.R16UI,
              [S.DEPTH_COMPONENT]: i.DEPTH_COMPONENT16,
            },
            [L.SHORT]: {
              [S.RGBA_INTEGER]: i.RGBA16I,
              [S.RGB_INTEGER]: i.RGB16I,
              [S.RG_INTEGER]: i.RG16I,
              [S.RED_INTEGER]: i.R16I,
            },
            [L.UNSIGNED_INT]: {
              [S.RGBA_INTEGER]: i.RGBA32UI,
              [S.RGB_INTEGER]: i.RGB32UI,
              [S.RG_INTEGER]: i.RG32UI,
              [S.RED_INTEGER]: i.R32UI,
              [S.DEPTH_COMPONENT]: i.DEPTH_COMPONENT24,
            },
            [L.INT]: {
              [S.RGBA_INTEGER]: i.RGBA32I,
              [S.RGB_INTEGER]: i.RGB32I,
              [S.RG_INTEGER]: i.RG32I,
              [S.RED_INTEGER]: i.R32I,
            },
            [L.FLOAT]: {
              [S.RGBA]: i.RGBA32F,
              [S.RGB]: i.RGB32F,
              [S.RG]: i.RG32F,
              [S.RED]: i.R32F,
              [S.DEPTH_COMPONENT]: i.DEPTH_COMPONENT32F,
            },
            [L.HALF_FLOAT]: {
              [S.RGBA]: i.RGBA16F,
              [S.RGB]: i.RGB16F,
              [S.RG]: i.RG16F,
              [S.RED]: i.R16F,
            },
            [L.UNSIGNED_SHORT_5_6_5]: { [S.RGB]: i.RGB565 },
            [L.UNSIGNED_SHORT_4_4_4_4]: { [S.RGBA]: i.RGBA4 },
            [L.UNSIGNED_SHORT_5_5_5_1]: { [S.RGBA]: i.RGB5_A1 },
            [L.UNSIGNED_INT_2_10_10_10_REV]: {
              [S.RGBA]: i.RGB10_A2,
              [S.RGBA_INTEGER]: i.RGB10_A2UI,
            },
            [L.UNSIGNED_INT_10F_11F_11F_REV]: { [S.RGB]: i.R11F_G11F_B10F },
            [L.UNSIGNED_INT_5_9_9_9_REV]: { [S.RGB]: i.RGB9_E5 },
            [L.UNSIGNED_INT_24_8]: { [S.DEPTH_STENCIL]: i.DEPTH24_STENCIL8 },
            [L.FLOAT_32_UNSIGNED_INT_24_8_REV]: { [S.DEPTH_STENCIL]: i.DEPTH32F_STENCIL8 },
          })
        : (t = {
            [L.UNSIGNED_BYTE]: {
              [S.RGBA]: i.RGBA,
              [S.RGB]: i.RGB,
              [S.ALPHA]: i.ALPHA,
              [S.LUMINANCE]: i.LUMINANCE,
              [S.LUMINANCE_ALPHA]: i.LUMINANCE_ALPHA,
            },
            [L.UNSIGNED_SHORT_5_6_5]: { [S.RGB]: i.RGB },
            [L.UNSIGNED_SHORT_4_4_4_4]: { [S.RGBA]: i.RGBA },
            [L.UNSIGNED_SHORT_5_5_5_1]: { [S.RGBA]: i.RGBA },
          }),
      t
    );
  }
  class qi {
    constructor(t) {
      (this.texture = t),
        (this.width = -1),
        (this.height = -1),
        (this.dirtyId = -1),
        (this.dirtyStyleId = -1),
        (this.mipmap = !1),
        (this.wrapMode = 33071),
        (this.type = L.UNSIGNED_BYTE),
        (this.internalFormat = S.RGBA),
        (this.samplerType = 0);
    }
  }
  class Is {
    constructor(t) {
      (this.renderer = t),
        (this.boundTextures = []),
        (this.currentLocation = -1),
        (this.managedTextures = []),
        (this._unknownBoundTextures = !1),
        (this.unknownTexture = new Y()),
        (this.hasIntegerTextures = !1);
    }
    contextChange() {
      const t = (this.gl = this.renderer.gl);
      (this.CONTEXT_UID = this.renderer.CONTEXT_UID),
        (this.webGLVersion = this.renderer.context.webGLVersion),
        (this.internalFormats = wd(t));
      const e = t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);
      this.boundTextures.length = e;
      for (let s = 0; s < e; s++) this.boundTextures[s] = null;
      this.emptyTextures = {};
      const r = new qi(t.createTexture());
      t.bindTexture(t.TEXTURE_2D, r.texture),
        t.texImage2D(t.TEXTURE_2D, 0, t.RGBA, 1, 1, 0, t.RGBA, t.UNSIGNED_BYTE, new Uint8Array(4)),
        (this.emptyTextures[t.TEXTURE_2D] = r),
        (this.emptyTextures[t.TEXTURE_CUBE_MAP] = new qi(t.createTexture())),
        t.bindTexture(t.TEXTURE_CUBE_MAP, this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);
      for (let s = 0; s < 6; s++)
        t.texImage2D(
          t.TEXTURE_CUBE_MAP_POSITIVE_X + s,
          0,
          t.RGBA,
          1,
          1,
          0,
          t.RGBA,
          t.UNSIGNED_BYTE,
          null
        );
      t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_MAG_FILTER, t.LINEAR),
        t.texParameteri(t.TEXTURE_CUBE_MAP, t.TEXTURE_MIN_FILTER, t.LINEAR);
      for (let s = 0; s < this.boundTextures.length; s++) this.bind(null, s);
    }
    bind(t, e = 0) {
      const { gl: r } = this;
      if (
        ((t = t == null ? void 0 : t.castToBaseTexture()),
        (t == null ? void 0 : t.valid) && !t.parentTextureArray)
      ) {
        t.touched = this.renderer.textureGC.count;
        const s = t._glTextures[this.CONTEXT_UID] || this.initTexture(t);
        this.boundTextures[e] !== t &&
          (this.currentLocation !== e &&
            ((this.currentLocation = e), r.activeTexture(r.TEXTURE0 + e)),
          r.bindTexture(t.target, s.texture)),
          s.dirtyId !== t.dirtyId &&
            (this.currentLocation !== e &&
              ((this.currentLocation = e), r.activeTexture(r.TEXTURE0 + e)),
            this.updateTexture(t)),
          (this.boundTextures[e] = t);
      } else
        this.currentLocation !== e && ((this.currentLocation = e), r.activeTexture(r.TEXTURE0 + e)),
          r.bindTexture(r.TEXTURE_2D, this.emptyTextures[r.TEXTURE_2D].texture),
          (this.boundTextures[e] = null);
    }
    reset() {
      (this._unknownBoundTextures = !0),
        (this.hasIntegerTextures = !1),
        (this.currentLocation = -1);
      for (let t = 0; t < this.boundTextures.length; t++)
        this.boundTextures[t] = this.unknownTexture;
    }
    unbind(t) {
      const { gl: e, boundTextures: r } = this;
      if (this._unknownBoundTextures) {
        this._unknownBoundTextures = !1;
        for (let s = 0; s < r.length; s++) r[s] === this.unknownTexture && this.bind(null, s);
      }
      for (let s = 0; s < r.length; s++)
        r[s] === t &&
          (this.currentLocation !== s &&
            (e.activeTexture(e.TEXTURE0 + s), (this.currentLocation = s)),
          e.bindTexture(t.target, this.emptyTextures[t.target].texture),
          (r[s] = null));
    }
    ensureSamplerType(t) {
      const { boundTextures: e, hasIntegerTextures: r, CONTEXT_UID: s } = this;
      if (r)
        for (let n = t - 1; n >= 0; --n) {
          const a = e[n];
          a && a._glTextures[s].samplerType !== Ai.FLOAT && this.renderer.texture.unbind(a);
        }
    }
    initTexture(t) {
      const e = new qi(this.gl.createTexture());
      return (
        (e.dirtyId = -1),
        (t._glTextures[this.CONTEXT_UID] = e),
        this.managedTextures.push(t),
        t.on("dispose", this.destroyTexture, this),
        e
      );
    }
    initTextureType(t, e) {
      var r, s;
      (e.internalFormat =
        (s = (r = this.internalFormats[t.type]) == null ? void 0 : r[t.format]) != null
          ? s
          : t.format),
        this.webGLVersion === 2 && t.type === L.HALF_FLOAT
          ? (e.type = this.gl.HALF_FLOAT)
          : (e.type = t.type);
    }
    updateTexture(t) {
      var s;
      const e = t._glTextures[this.CONTEXT_UID];
      if (!e) return;
      const r = this.renderer;
      if ((this.initTextureType(t, e), (s = t.resource) == null ? void 0 : s.upload(r, t, e)))
        e.samplerType !== Ai.FLOAT && (this.hasIntegerTextures = !0);
      else {
        const n = t.realWidth,
          a = t.realHeight,
          o = r.gl;
        (e.width !== n || e.height !== a || e.dirtyId < 0) &&
          ((e.width = n),
          (e.height = a),
          o.texImage2D(t.target, 0, e.internalFormat, n, a, 0, t.format, e.type, null));
      }
      t.dirtyStyleId !== e.dirtyStyleId && this.updateTextureStyle(t), (e.dirtyId = t.dirtyId);
    }
    destroyTexture(t, e) {
      const { gl: r } = this;
      if (
        ((t = t.castToBaseTexture()),
        t._glTextures[this.CONTEXT_UID] &&
          (this.unbind(t),
          r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),
          t.off("dispose", this.destroyTexture, this),
          delete t._glTextures[this.CONTEXT_UID],
          !e))
      ) {
        const s = this.managedTextures.indexOf(t);
        s !== -1 && ve(this.managedTextures, s, 1);
      }
    }
    updateTextureStyle(t) {
      var r;
      const e = t._glTextures[this.CONTEXT_UID];
      !e ||
        ((t.mipmap === Kt.POW2 || this.webGLVersion !== 2) && !t.isPowerOfTwo
          ? (e.mipmap = !1)
          : (e.mipmap = t.mipmap >= 1),
        this.webGLVersion !== 2 && !t.isPowerOfTwo
          ? (e.wrapMode = qt.CLAMP)
          : (e.wrapMode = t.wrapMode),
        ((r = t.resource) != null && r.style(this.renderer, t, e)) || this.setStyle(t, e),
        (e.dirtyStyleId = t.dirtyStyleId));
    }
    setStyle(t, e) {
      const r = this.gl;
      if (
        (e.mipmap && t.mipmap !== Kt.ON_MANUAL && r.generateMipmap(t.target),
        r.texParameteri(t.target, r.TEXTURE_WRAP_S, e.wrapMode),
        r.texParameteri(t.target, r.TEXTURE_WRAP_T, e.wrapMode),
        e.mipmap)
      ) {
        r.texParameteri(
          t.target,
          r.TEXTURE_MIN_FILTER,
          t.scaleMode === jt.LINEAR ? r.LINEAR_MIPMAP_LINEAR : r.NEAREST_MIPMAP_NEAREST
        );
        const s = this.renderer.context.extensions.anisotropicFiltering;
        if (s && t.anisotropicLevel > 0 && t.scaleMode === jt.LINEAR) {
          const n = Math.min(t.anisotropicLevel, r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));
          r.texParameterf(t.target, s.TEXTURE_MAX_ANISOTROPY_EXT, n);
        }
      } else
        r.texParameteri(
          t.target,
          r.TEXTURE_MIN_FILTER,
          t.scaleMode === jt.LINEAR ? r.LINEAR : r.NEAREST
        );
      r.texParameteri(
        t.target,
        r.TEXTURE_MAG_FILTER,
        t.scaleMode === jt.LINEAR ? r.LINEAR : r.NEAREST
      );
    }
    destroy() {
      this.renderer = null;
    }
  }
  (Is.extension = { type: P.RendererSystem, name: "texture" }), B.add(Is);
  const Md = new ze();
  class ws {
    constructor(t) {
      (this.renderer = t), (this._tempMatrix = new Q());
    }
    generateTexture(t, e) {
      const h = e || {},
        { region: r } = h,
        s = rh(h, ["region"]),
        n = r || t.getLocalBounds(null, !0);
      n.width === 0 && (n.width = 1), n.height === 0 && (n.height = 1);
      const a = te.create(ne({ width: n.width, height: n.height }, s));
      (this._tempMatrix.tx = -n.x), (this._tempMatrix.ty = -n.y);
      const o = t.transform;
      return (
        (t.transform = Md),
        this.renderer.render(t, {
          renderTexture: a,
          transform: this._tempMatrix,
          skipUpdateTransform: !!t.parent,
          blit: !0,
        }),
        (t.transform = o),
        a
      );
    }
    destroy() {}
  }
  (ws.extension = { type: [P.RendererSystem, P.CanvasRendererSystem], name: "textureGenerator" }),
    B.add(ws);
  class Ms {
    constructor() {
      (this.clearBeforeRender = !0),
        (this._backgroundColor = 0),
        (this._backgroundColorRgba = [0, 0, 0, 1]),
        (this._backgroundColorString = "#000000"),
        (this.color = this._backgroundColor),
        (this.alpha = 1);
    }
    init(t) {
      (this.clearBeforeRender = t.clearBeforeRender),
        (this.color = t.color || this._backgroundColor),
        (this.alpha = t.alpha);
    }
    get color() {
      return this._backgroundColor;
    }
    set color(t) {
      (this._backgroundColor = t),
        (this._backgroundColorString = kr(t)),
        ye(t, this._backgroundColorRgba);
    }
    get alpha() {
      return this._backgroundColorRgba[3];
    }
    set alpha(t) {
      this._backgroundColorRgba[3] = t;
    }
    get colorRgba() {
      return this._backgroundColorRgba;
    }
    get colorString() {
      return this._backgroundColorString;
    }
    destroy() {}
  }
  (Ms.extension = { type: [P.RendererSystem, P.CanvasRendererSystem], name: "background" }),
    B.add(Ms);
  class Cs {
    constructor(t) {
      this.renderer = t;
    }
    init(t) {
      (this.screen = new z(0, 0, t.width, t.height)),
        (this.element = t.view || A.ADAPTER.createCanvas()),
        (this.resolution = t.resolution || A.RESOLUTION),
        (this.autoDensity = !!t.autoDensity);
    }
    resizeView(t, e) {
      (this.element.width = Math.round(t * this.resolution)),
        (this.element.height = Math.round(e * this.resolution));
      const r = this.element.width / this.resolution,
        s = this.element.height / this.resolution;
      (this.screen.width = r),
        (this.screen.height = s),
        this.autoDensity &&
          ((this.element.style.width = `${r}px`), (this.element.style.height = `${s}px`)),
        this.renderer.emit("resize", r, s),
        this.renderer.runners.resize.emit(this.screen.width, this.screen.height);
    }
    destroy(t) {
      t && this.element.parentNode && this.element.parentNode.removeChild(this.element),
        (this.renderer = null),
        (this.element = null),
        (this.screen = null);
    }
  }
  (Cs.extension = { type: [P.RendererSystem, P.CanvasRendererSystem], name: "_view" }), B.add(Cs);
  class Ds {
    constructor(t) {
      (this.renderer = t), (this.plugins = {});
    }
    init(t) {
      for (const e in t) this.plugins[e] = new t[e](this.renderer);
    }
    destroy() {
      for (const t in this.plugins) this.plugins[t].destroy(), (this.plugins[t] = null);
    }
  }
  (Ds.extension = { type: [P.RendererSystem, P.CanvasRendererSystem], name: "_plugin" }), B.add(Ds);
  class La extends Me {
    constructor() {
      super(...arguments), (this.runners = {}), (this._systemsHash = {});
    }
    setup(t) {
      var s;
      this.addRunners(...t.runners);
      const e = ((s = t.priority) != null ? s : []).filter((n) => t.systems[n]),
        r = [...e, ...Object.keys(t.systems).filter((n) => !e.includes(n))];
      for (const n of r) this.addSystem(t.systems[n], n);
    }
    addRunners(...t) {
      t.forEach((e) => {
        this.runners[e] = new Ft(e);
      });
    }
    addSystem(t, e) {
      const r = new t(this);
      if (this[e]) throw new Error(`Whoops! The name "${e}" is already in use`);
      (this[e] = r), (this._systemsHash[e] = r);
      for (const s in this.runners) this.runners[s].add(r);
      return this;
    }
    emitWithCustomOptions(t, e) {
      const r = Object.keys(this._systemsHash);
      t.items.forEach((s) => {
        const n = r.find((a) => this._systemsHash[a] === s);
        s[t.name](e[n]);
      });
    }
    destroy() {
      Object.values(this.runners).forEach((t) => {
        t.destroy();
      }),
        (this._systemsHash = {});
    }
  }
  class Ps {
    constructor(t) {
      this.renderer = t;
    }
    run(t) {
      const e = this.renderer;
      e.emitWithCustomOptions(e.runners.init, t),
        Qn(e.rendererLogId),
        e.resize(this.renderer.screen.width, this.renderer.screen.height);
    }
    destroy() {}
  }
  (Ps.extension = { type: [P.RendererSystem, P.CanvasRendererSystem], name: "startup" }), B.add(Ps);
  const Ga = [];
  B.handleByList(P.Renderer, Ga);
  function Ua(i) {
    for (const t of Ga) if (t.test(i)) return new t(i);
    throw new Error("Unable to auto-detect a suitable renderer.");
  }
  var Cd = `attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,
    Dd = `attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;
  const ka = Cd,
    Os = Dd,
    Fs = class extends La {
      constructor(i) {
        var r;
        super(),
          (i = Object.assign({}, A.RENDER_OPTIONS, i)),
          (this.gl = null),
          (this.CONTEXT_UID = 0),
          (this.globalUniforms = new It({ projectionMatrix: new Q() }, !0));
        const t = {
          runners: [
            "init",
            "destroy",
            "contextChange",
            "reset",
            "update",
            "postrender",
            "prerender",
            "resize",
          ],
          systems: Fs.__systems,
          priority: [
            "_view",
            "textureGenerator",
            "background",
            "_plugin",
            "startup",
            "context",
            "state",
            "texture",
            "buffer",
            "geometry",
            "framebuffer",
            "mask",
            "scissor",
            "stencil",
            "projection",
            "textureGC",
            "filter",
            "renderTexture",
            "batch",
            "objectRenderer",
            "_multisample",
          ],
        };
        this.setup(t);
        const e = {
          _plugin: Fs.__plugins,
          background: {
            alpha: i.backgroundAlpha,
            color: i.backgroundColor,
            clearBeforeRender: i.clearBeforeRender,
          },
          _view: {
            height: i.height,
            width: i.width,
            autoDensity: i.autoDensity,
            resolution: i.resolution,
            view: i.view,
          },
          context: {
            antialias: i.antialias,
            context: i.context,
            powerPreference: i.powerPreference,
            premultipliedAlpha:
              (r = i.premultipliedAlpha) != null
                ? r
                : i.useContextAlpha && i.useContextAlpha !== "notMultiplied",
            preserveDrawingBuffer: i.preserveDrawingBuffer,
          },
        };
        this.startup.run(e);
      }
      static test(i) {
        return i != null && i.forceCanvas ? !1 : Jn();
      }
      render(i, t) {
        this.objectRenderer.render(i, t);
      }
      resize(i, t) {
        this._view.resizeView(i, t);
      }
      reset() {
        return this.runners.reset.emit(), this;
      }
      clear() {
        this.renderTexture.bind(), this.renderTexture.clear();
      }
      destroy(i = !1) {
        this.runners.destroy.items.reverse(),
          this.emitWithCustomOptions(this.runners.destroy, { _view: i }),
          super.destroy();
      }
      get plugins() {
        return this._plugin.plugins;
      }
      get multisample() {
        return this._multisample.multisample;
      }
      get width() {
        return this._view.element.width;
      }
      get height() {
        return this._view.element.height;
      }
      get resolution() {
        return this._view.resolution;
      }
      get autoDensity() {
        return this._view.autoDensity;
      }
      get view() {
        return this._view.element;
      }
      get screen() {
        return this._view.screen;
      }
      get lastObjectRendered() {
        return this.objectRenderer.lastObjectRendered;
      }
      get renderingToScreen() {
        return this.objectRenderer.renderingToScreen;
      }
      get rendererLogId() {
        return `WebGL ${this.context.webGLVersion}`;
      }
      get clearBeforeRender() {
        return this.background.clearBeforeRender;
      }
      get useContextAlpha() {
        return this.context.useContextAlpha;
      }
      get preserveDrawingBuffer() {
        return this.context.preserveDrawingBuffer;
      }
      get backgroundColor() {
        return this.background.color;
      }
      set backgroundColor(i) {
        this.background.color = i;
      }
      get backgroundAlpha() {
        return this.background.color;
      }
      set backgroundAlpha(i) {
        this.background.alpha = i;
      }
      get powerPreference() {
        return this.context.powerPreference;
      }
      generateTexture(i, t) {
        return this.textureGenerator.generateTexture(i, t);
      }
    };
  let Re = Fs;
  (Re.extension = { type: P.Renderer, priority: 1 }),
    (Re.__plugins = {}),
    (Re.__systems = {}),
    B.handleByMap(P.RendererPlugin, Re.__plugins),
    B.handleByMap(P.RendererSystem, Re.__systems),
    B.add(Re);
  class Ki {
    constructor() {
      (this.texArray = null),
        (this.blend = 0),
        (this.type = Dt.TRIANGLES),
        (this.start = 0),
        (this.size = 0),
        (this.data = null);
    }
  }
  class Zi {
    constructor() {
      (this.elements = []), (this.ids = []), (this.count = 0);
    }
    clear() {
      for (let t = 0; t < this.count; t++) this.elements[t] = null;
      this.count = 0;
    }
  }
  class Qi {
    constructor(t) {
      typeof t == "number"
        ? (this.rawBinaryData = new ArrayBuffer(t))
        : t instanceof Uint8Array
        ? (this.rawBinaryData = t.buffer)
        : (this.rawBinaryData = t),
        (this.uint32View = new Uint32Array(this.rawBinaryData)),
        (this.float32View = new Float32Array(this.rawBinaryData));
    }
    get int8View() {
      return this._int8View || (this._int8View = new Int8Array(this.rawBinaryData)), this._int8View;
    }
    get uint8View() {
      return (
        this._uint8View || (this._uint8View = new Uint8Array(this.rawBinaryData)), this._uint8View
      );
    }
    get int16View() {
      return (
        this._int16View || (this._int16View = new Int16Array(this.rawBinaryData)), this._int16View
      );
    }
    get uint16View() {
      return (
        this._uint16View || (this._uint16View = new Uint16Array(this.rawBinaryData)),
        this._uint16View
      );
    }
    get int32View() {
      return (
        this._int32View || (this._int32View = new Int32Array(this.rawBinaryData)), this._int32View
      );
    }
    view(t) {
      return this[`${t}View`];
    }
    destroy() {
      (this.rawBinaryData = null),
        (this._int8View = null),
        (this._uint8View = null),
        (this._int16View = null),
        (this._uint16View = null),
        (this._int32View = null),
        (this.uint32View = null),
        (this.float32View = null);
    }
    static sizeOf(t) {
      switch (t) {
        case "int8":
        case "uint8":
          return 1;
        case "int16":
        case "uint16":
          return 2;
        case "int32":
        case "uint32":
        case "float32":
          return 4;
        default:
          throw new Error(`${t} isn't a valid view type`);
      }
    }
  }
  class Xa {
    constructor(t, e) {
      if (
        ((this.vertexSrc = t),
        (this.fragTemplate = e),
        (this.programCache = {}),
        (this.defaultGroupCache = {}),
        !e.includes("%count%"))
      )
        throw new Error('Fragment template must contain "%count%".');
      if (!e.includes("%forloop%")) throw new Error('Fragment template must contain "%forloop%".');
    }
    generateShader(t) {
      if (!this.programCache[t]) {
        const r = new Int32Array(t);
        for (let n = 0; n < t; n++) r[n] = n;
        this.defaultGroupCache[t] = It.from({ uSamplers: r }, !0);
        let s = this.fragTemplate;
        (s = s.replace(/%count%/gi, `${t}`)),
          (s = s.replace(/%forloop%/gi, this.generateSampleSrc(t))),
          (this.programCache[t] = new zt(this.vertexSrc, s));
      }
      const e = {
        tint: new Float32Array([1, 1, 1, 1]),
        translationMatrix: new Q(),
        default: this.defaultGroupCache[t],
      };
      return new Bt(this.programCache[t], e);
    }
    generateSampleSrc(t) {
      let e = "";
      (e += `
`),
        (e += `
`);
      for (let r = 0; r < t; r++)
        r > 0 &&
          (e += `
else `),
          r < t - 1 && (e += `if(vTextureId < ${r}.5)`),
          (e += `
{`),
          (e += `
	color = texture2D(uSamplers[${r}], vTextureCoord);`),
          (e += `
}`);
      return (
        (e += `
`),
        (e += `
`),
        e
      );
    }
  }
  class Ns extends ee {
    constructor(t = !1) {
      super(),
        (this._buffer = new nt(null, t, !1)),
        (this._indexBuffer = new nt(null, t, !0)),
        this.addAttribute("aVertexPosition", this._buffer, 2, !1, L.FLOAT)
          .addAttribute("aTextureCoord", this._buffer, 2, !1, L.FLOAT)
          .addAttribute("aColor", this._buffer, 4, !0, L.UNSIGNED_BYTE)
          .addAttribute("aTextureId", this._buffer, 1, !0, L.FLOAT)
          .addIndex(this._indexBuffer);
    }
  }
  var Pd = `precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,
    Od = `varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;
  const Se = class extends ti {
    constructor(i) {
      super(i),
        this.setShaderGenerator(),
        (this.geometryClass = Ns),
        (this.vertexSize = 6),
        (this.state = Wt.for2d()),
        (this.size = A.SPRITE_BATCH_SIZE * 4),
        (this._vertexCount = 0),
        (this._indexCount = 0),
        (this._bufferedElements = []),
        (this._bufferedTextures = []),
        (this._bufferSize = 0),
        (this._shader = null),
        (this._packedGeometries = []),
        (this._packedGeometryPoolSize = 2),
        (this._flushId = 0),
        (this._aBuffers = {}),
        (this._iBuffers = {}),
        (this.MAX_TEXTURES = 1),
        this.renderer.on("prerender", this.onPrerender, this),
        i.runners.contextChange.add(this),
        (this._dcIndex = 0),
        (this._aIndex = 0),
        (this._iIndex = 0),
        (this._attributeBuffer = null),
        (this._indexBuffer = null),
        (this._tempBoundTextures = []);
    }
    static get defaultVertexSrc() {
      return Pd;
    }
    static get defaultFragmentTemplate() {
      return Od;
    }
    setShaderGenerator({
      vertex: i = Se.defaultVertexSrc,
      fragment: t = Se.defaultFragmentTemplate,
    } = {}) {
      this.shaderGenerator = new Xa(i, t);
    }
    contextChange() {
      const i = this.renderer.gl;
      A.PREFER_ENV === ae.WEBGL_LEGACY
        ? (this.MAX_TEXTURES = 1)
        : ((this.MAX_TEXTURES = Math.min(
            i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),
            A.SPRITE_MAX_TEXTURES
          )),
          (this.MAX_TEXTURES = Ra(this.MAX_TEXTURES, i))),
        (this._shader = this.shaderGenerator.generateShader(this.MAX_TEXTURES));
      for (let t = 0; t < this._packedGeometryPoolSize; t++)
        this._packedGeometries[t] = new this.geometryClass();
      this.initFlushBuffers();
    }
    initFlushBuffers() {
      const { _drawCallPool: i, _textureArrayPool: t } = Se,
        e = this.size / 4,
        r = Math.floor(e / this.MAX_TEXTURES) + 1;
      for (; i.length < e; ) i.push(new Ki());
      for (; t.length < r; ) t.push(new Zi());
      for (let s = 0; s < this.MAX_TEXTURES; s++) this._tempBoundTextures[s] = null;
    }
    onPrerender() {
      this._flushId = 0;
    }
    render(i) {
      !i._texture.valid ||
        (this._vertexCount + i.vertexData.length / 2 > this.size && this.flush(),
        (this._vertexCount += i.vertexData.length / 2),
        (this._indexCount += i.indices.length),
        (this._bufferedTextures[this._bufferSize] = i._texture.baseTexture),
        (this._bufferedElements[this._bufferSize++] = i));
    }
    buildTexturesAndDrawCalls() {
      const { _bufferedTextures: i, MAX_TEXTURES: t } = this,
        e = Se._textureArrayPool,
        r = this.renderer.batch,
        s = this._tempBoundTextures,
        n = this.renderer.textureGC.count;
      let a = ++Y._globalBatch,
        o = 0,
        h = e[0],
        l = 0;
      r.copyBoundTextures(s, t);
      for (let u = 0; u < this._bufferSize; ++u) {
        const c = i[u];
        (i[u] = null),
          c._batchEnabled !== a &&
            (h.count >= t &&
              (r.boundArray(h, s, a, t), this.buildDrawCalls(h, l, u), (l = u), (h = e[++o]), ++a),
            (c._batchEnabled = a),
            (c.touched = n),
            (h.elements[h.count++] = c));
      }
      h.count > 0 &&
        (r.boundArray(h, s, a, t), this.buildDrawCalls(h, l, this._bufferSize), ++o, ++a);
      for (let u = 0; u < s.length; u++) s[u] = null;
      Y._globalBatch = a;
    }
    buildDrawCalls(i, t, e) {
      const { _bufferedElements: r, _attributeBuffer: s, _indexBuffer: n, vertexSize: a } = this,
        o = Se._drawCallPool;
      let h = this._dcIndex,
        l = this._aIndex,
        u = this._iIndex,
        c = o[h];
      (c.start = this._iIndex), (c.texArray = i);
      for (let d = t; d < e; ++d) {
        const f = r[d],
          p = f._texture.baseTexture,
          g = $r[p.alphaMode ? 1 : 0][f.blendMode];
        (r[d] = null),
          t < d &&
            c.blend !== g &&
            ((c.size = u - c.start), (t = d), (c = o[++h]), (c.texArray = i), (c.start = u)),
          this.packInterleavedGeometry(f, s, n, l, u),
          (l += (f.vertexData.length / 2) * a),
          (u += f.indices.length),
          (c.blend = g);
      }
      t < e && ((c.size = u - c.start), ++h),
        (this._dcIndex = h),
        (this._aIndex = l),
        (this._iIndex = u);
    }
    bindAndClearTexArray(i) {
      const t = this.renderer.texture;
      for (let e = 0; e < i.count; e++) t.bind(i.elements[e], i.ids[e]), (i.elements[e] = null);
      i.count = 0;
    }
    updateGeometry() {
      const { _packedGeometries: i, _attributeBuffer: t, _indexBuffer: e } = this;
      A.CAN_UPLOAD_SAME_BUFFER
        ? (i[this._flushId]._buffer.update(t.rawBinaryData),
          i[this._flushId]._indexBuffer.update(e),
          this.renderer.geometry.updateBuffers())
        : (this._packedGeometryPoolSize <= this._flushId &&
            (this._packedGeometryPoolSize++, (i[this._flushId] = new this.geometryClass())),
          i[this._flushId]._buffer.update(t.rawBinaryData),
          i[this._flushId]._indexBuffer.update(e),
          this.renderer.geometry.bind(i[this._flushId]),
          this.renderer.geometry.updateBuffers(),
          this._flushId++);
    }
    drawBatches() {
      const i = this._dcIndex,
        { gl: t, state: e } = this.renderer,
        r = Se._drawCallPool;
      let s = null;
      for (let n = 0; n < i; n++) {
        const { texArray: a, type: o, size: h, start: l, blend: u } = r[n];
        s !== a && ((s = a), this.bindAndClearTexArray(a)),
          (this.state.blendMode = u),
          e.set(this.state),
          t.drawElements(o, h, t.UNSIGNED_SHORT, l * 2);
      }
    }
    flush() {
      this._vertexCount !== 0 &&
        ((this._attributeBuffer = this.getAttributeBuffer(this._vertexCount)),
        (this._indexBuffer = this.getIndexBuffer(this._indexCount)),
        (this._aIndex = 0),
        (this._iIndex = 0),
        (this._dcIndex = 0),
        this.buildTexturesAndDrawCalls(),
        this.updateGeometry(),
        this.drawBatches(),
        (this._bufferSize = 0),
        (this._vertexCount = 0),
        (this._indexCount = 0));
    }
    start() {
      this.renderer.state.set(this.state),
        this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),
        this.renderer.shader.bind(this._shader),
        A.CAN_UPLOAD_SAME_BUFFER &&
          this.renderer.geometry.bind(this._packedGeometries[this._flushId]);
    }
    stop() {
      this.flush();
    }
    destroy() {
      for (let i = 0; i < this._packedGeometryPoolSize; i++)
        this._packedGeometries[i] && this._packedGeometries[i].destroy();
      this.renderer.off("prerender", this.onPrerender, this),
        (this._aBuffers = null),
        (this._iBuffers = null),
        (this._packedGeometries = null),
        (this._attributeBuffer = null),
        (this._indexBuffer = null),
        this._shader && (this._shader.destroy(), (this._shader = null)),
        super.destroy();
    }
    getAttributeBuffer(i) {
      const t = Ke(Math.ceil(i / 8)),
        e = Vr(t),
        r = t * 8;
      this._aBuffers.length <= e && (this._iBuffers.length = e + 1);
      let s = this._aBuffers[r];
      return s || (this._aBuffers[r] = s = new Qi(r * this.vertexSize * 4)), s;
    }
    getIndexBuffer(i) {
      const t = Ke(Math.ceil(i / 12)),
        e = Vr(t),
        r = t * 12;
      this._iBuffers.length <= e && (this._iBuffers.length = e + 1);
      let s = this._iBuffers[e];
      return s || (this._iBuffers[e] = s = new Uint16Array(r)), s;
    }
    packInterleavedGeometry(i, t, e, r, s) {
      const { uint32View: n, float32View: a } = t,
        o = r / this.vertexSize,
        h = i.uvs,
        l = i.indices,
        u = i.vertexData,
        c = i._texture.baseTexture._batchLocation,
        d = Math.min(i.worldAlpha, 1),
        f =
          d < 1 && i._texture.baseTexture.alphaMode
            ? Fi(i._tintRGB, d)
            : i._tintRGB + ((d * 255) << 24);
      for (let p = 0; p < u.length; p += 2)
        (a[r++] = u[p]),
          (a[r++] = u[p + 1]),
          (a[r++] = h[p]),
          (a[r++] = h[p + 1]),
          (n[r++] = f),
          (a[r++] = c);
      for (let p = 0; p < l.length; p++) e[s++] = o + l[p];
    }
  };
  let ri = Se;
  (ri.extension = { name: "batch", type: P.RendererPlugin }),
    (ri._drawCallPool = []),
    (ri._textureArrayPool = []),
    B.add(ri);
  class Fd {
    constructor(t) {
      (this.buffer = t || null), (this.updateID = -1), (this.byteLength = -1), (this.refCount = 0);
    }
  }
  class Bs {
    constructor(t) {
      (this.renderer = t), (this.managedBuffers = {}), (this.boundBufferBases = {});
    }
    destroy() {
      this.renderer = null;
    }
    contextChange() {
      this.disposeAll(!0),
        (this.gl = this.renderer.gl),
        (this.CONTEXT_UID = this.renderer.CONTEXT_UID);
    }
    bind(t) {
      const { gl: e, CONTEXT_UID: r } = this,
        s = t._glBuffers[r] || this.createGLBuffer(t);
      e.bindBuffer(t.type, s.buffer);
    }
    bindBufferBase(t, e) {
      const { gl: r, CONTEXT_UID: s } = this;
      if (this.boundBufferBases[e] !== t) {
        const n = t._glBuffers[s] || this.createGLBuffer(t);
        (this.boundBufferBases[e] = t), r.bindBufferBase(r.UNIFORM_BUFFER, e, n.buffer);
      }
    }
    bindBufferRange(t, e, r) {
      const { gl: s, CONTEXT_UID: n } = this;
      r = r || 0;
      const a = t._glBuffers[n] || this.createGLBuffer(t);
      s.bindBufferRange(s.UNIFORM_BUFFER, e || 0, a.buffer, r * 256, 256);
    }
    update(t) {
      const { gl: e, CONTEXT_UID: r } = this,
        s = t._glBuffers[r];
      if (t._updateID !== s.updateID)
        if (
          ((s.updateID = t._updateID),
          e.bindBuffer(t.type, s.buffer),
          s.byteLength >= t.data.byteLength)
        )
          e.bufferSubData(t.type, 0, t.data);
        else {
          const n = t.static ? e.STATIC_DRAW : e.DYNAMIC_DRAW;
          (s.byteLength = t.data.byteLength), e.bufferData(t.type, t.data, n);
        }
    }
    dispose(t, e) {
      if (!this.managedBuffers[t.id]) return;
      delete this.managedBuffers[t.id];
      const r = t._glBuffers[this.CONTEXT_UID],
        s = this.gl;
      t.disposeRunner.remove(this),
        r && (e || s.deleteBuffer(r.buffer), delete t._glBuffers[this.CONTEXT_UID]);
    }
    disposeAll(t) {
      const e = Object.keys(this.managedBuffers);
      for (let r = 0; r < e.length; r++) this.dispose(this.managedBuffers[e[r]], t);
    }
    createGLBuffer(t) {
      const { CONTEXT_UID: e, gl: r } = this;
      return (
        (t._glBuffers[e] = new Fd(r.createBuffer())),
        (this.managedBuffers[t.id] = t),
        t.disposeRunner.add(this),
        t._glBuffers[e]
      );
    }
  }
  (Bs.extension = { type: P.RendererSystem, name: "buffer" }), B.add(Bs);
  class Ls {
    constructor(t) {
      this.renderer = t;
    }
    contextChange(t) {
      let e;
      if (this.renderer.context.webGLVersion === 1) {
        const r = t.getParameter(t.FRAMEBUFFER_BINDING);
        t.bindFramebuffer(t.FRAMEBUFFER, null),
          (e = t.getParameter(t.SAMPLES)),
          t.bindFramebuffer(t.FRAMEBUFFER, r);
      } else {
        const r = t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);
        t.bindFramebuffer(t.DRAW_FRAMEBUFFER, null),
          (e = t.getParameter(t.SAMPLES)),
          t.bindFramebuffer(t.DRAW_FRAMEBUFFER, r);
      }
      e >= ot.HIGH
        ? (this.multisample = ot.HIGH)
        : e >= ot.MEDIUM
        ? (this.multisample = ot.MEDIUM)
        : e >= ot.LOW
        ? (this.multisample = ot.LOW)
        : (this.multisample = ot.NONE);
    }
    destroy() {}
  }
  (Ls.extension = { type: P.RendererSystem, name: "_multisample" }), B.add(Ls);
  class Gs {
    constructor(t) {
      this.renderer = t;
    }
    render(t, e) {
      const r = this.renderer;
      let s, n, a, o;
      if (
        (e &&
          ((s = e.renderTexture), (n = e.clear), (a = e.transform), (o = e.skipUpdateTransform)),
        (this.renderingToScreen = !s),
        r.runners.prerender.emit(),
        r.emit("prerender"),
        (r.projection.transform = a),
        !r.context.isLost)
      ) {
        if ((s || (this.lastObjectRendered = t), !o)) {
          const h = t.enableTempParent();
          t.updateTransform(), t.disableTempParent(h);
        }
        r.renderTexture.bind(s),
          r.batch.currentRenderer.start(),
          (n != null ? n : r.background.clearBeforeRender) && r.renderTexture.clear(),
          t.render(r),
          r.batch.currentRenderer.flush(),
          s && (e.blit && r.framebuffer.blit(), s.baseTexture.update()),
          r.runners.postrender.emit(),
          (r.projection.transform = null),
          r.emit("postrender");
      }
    }
    destroy() {
      (this.renderer = null), (this.lastObjectRendered = null);
    }
  }
  (Gs.extension = { type: P.RendererSystem, name: "objectRenderer" }), B.add(Gs);
  const Nd = "7.0.0-alpha";
  var Bd = `varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;
  class Ld extends wt {
    constructor(t = 1) {
      super(ka, Bd, { uAlpha: 1 }), (this.alpha = t);
    }
    get alpha() {
      return this.uniforms.uAlpha;
    }
    set alpha(t) {
      this.uniforms.uAlpha = t;
    }
  }
  const Gd = `
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;
  function Ud(i, t) {
    const e = Math.ceil(i / 2);
    let r = Gd,
      s = "",
      n;
    t
      ? (n = "vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);")
      : (n = "vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);");
    for (let a = 0; a < i; a++) {
      let o = n.replace("%index%", a.toString());
      (o = o.replace("%sampleIndex%", `${a - (e - 1)}.0`)),
        (s += o),
        (s += `
`);
    }
    return (r = r.replace("%blur%", s)), (r = r.replace("%size%", i.toString())), r;
  }
  const kd = {
      5: [0.153388, 0.221461, 0.250301],
      7: [0.071303, 0.131514, 0.189879, 0.214607],
      9: [0.028532, 0.067234, 0.124009, 0.179044, 0.20236],
      11: [0.0093, 0.028002, 0.065984, 0.121703, 0.175713, 0.198596],
      13: [0.002406, 0.009255, 0.027867, 0.065666, 0.121117, 0.174868, 0.197641],
      15: [489e-6, 0.002403, 0.009246, 0.02784, 0.065602, 0.120999, 0.174697, 0.197448],
    },
    Xd = [
      "varying vec2 vBlurTexCoords[%size%];",
      "uniform sampler2D uSampler;",
      "void main(void)",
      "{",
      "    gl_FragColor = vec4(0.0);",
      "    %blur%",
      "}",
    ].join(`
`);
  function $d(i) {
    const t = kd[i],
      e = t.length;
    let r = Xd,
      s = "";
    const n = "gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";
    let a;
    for (let o = 0; o < i; o++) {
      let h = n.replace("%index%", o.toString());
      (a = o),
        o >= e && (a = i - o - 1),
        (h = h.replace("%value%", t[a].toString())),
        (s += h),
        (s += `
`);
    }
    return (r = r.replace("%blur%", s)), (r = r.replace("%size%", i.toString())), r;
  }
  class Us extends wt {
    constructor(t, e = 8, r = 4, s = A.FILTER_RESOLUTION, n = 5) {
      const a = Ud(n, t),
        o = $d(n);
      super(a, o),
        (this.horizontal = t),
        (this.resolution = s),
        (this._quality = 0),
        (this.quality = r),
        (this.blur = e);
    }
    apply(t, e, r, s) {
      if (
        (r
          ? this.horizontal
            ? (this.uniforms.strength = (1 / r.width) * (r.width / e.width))
            : (this.uniforms.strength = (1 / r.height) * (r.height / e.height))
          : this.horizontal
          ? (this.uniforms.strength = (1 / t.renderer.width) * (t.renderer.width / e.width))
          : (this.uniforms.strength = (1 / t.renderer.height) * (t.renderer.height / e.height)),
        (this.uniforms.strength *= this.strength),
        (this.uniforms.strength /= this.passes),
        this.passes === 1)
      )
        t.applyFilter(this, e, r, s);
      else {
        const n = t.getFilterTexture(),
          a = t.renderer;
        let o = e,
          h = n;
        (this.state.blend = !1), t.applyFilter(this, o, h, Ot.CLEAR);
        for (let l = 1; l < this.passes - 1; l++) {
          t.bindAndClear(o, Ot.BLIT), (this.uniforms.uSampler = h);
          const u = h;
          (h = o), (o = u), a.shader.bind(this), a.geometry.draw(5);
        }
        (this.state.blend = !0), t.applyFilter(this, h, r, s), t.returnFilterTexture(n);
      }
    }
    get blur() {
      return this.strength;
    }
    set blur(t) {
      (this.padding = 1 + Math.abs(t) * 2), (this.strength = t);
    }
    get quality() {
      return this._quality;
    }
    set quality(t) {
      (this._quality = t), (this.passes = t);
    }
  }
  class Hd extends wt {
    constructor(t = 8, e = 4, r = A.FILTER_RESOLUTION, s = 5) {
      super(),
        (this.blurXFilter = new Us(!0, t, e, r, s)),
        (this.blurYFilter = new Us(!1, t, e, r, s)),
        (this.resolution = r),
        (this.quality = e),
        (this.blur = t),
        (this.repeatEdgePixels = !1);
    }
    apply(t, e, r, s) {
      const n = Math.abs(this.blurXFilter.strength),
        a = Math.abs(this.blurYFilter.strength);
      if (n && a) {
        const o = t.getFilterTexture();
        this.blurXFilter.apply(t, e, o, Ot.CLEAR),
          this.blurYFilter.apply(t, o, r, s),
          t.returnFilterTexture(o);
      } else a ? this.blurYFilter.apply(t, e, r, s) : this.blurXFilter.apply(t, e, r, s);
    }
    updatePadding() {
      this._repeatEdgePixels
        ? (this.padding = 0)
        : (this.padding =
            Math.max(Math.abs(this.blurXFilter.strength), Math.abs(this.blurYFilter.strength)) * 2);
    }
    get blur() {
      return this.blurXFilter.blur;
    }
    set blur(t) {
      (this.blurXFilter.blur = this.blurYFilter.blur = t), this.updatePadding();
    }
    get quality() {
      return this.blurXFilter.quality;
    }
    set quality(t) {
      this.blurXFilter.quality = this.blurYFilter.quality = t;
    }
    get blurX() {
      return this.blurXFilter.blur;
    }
    set blurX(t) {
      (this.blurXFilter.blur = t), this.updatePadding();
    }
    get blurY() {
      return this.blurYFilter.blur;
    }
    set blurY(t) {
      (this.blurYFilter.blur = t), this.updatePadding();
    }
    get blendMode() {
      return this.blurYFilter.blendMode;
    }
    set blendMode(t) {
      this.blurYFilter.blendMode = t;
    }
    get repeatEdgePixels() {
      return this._repeatEdgePixels;
    }
    set repeatEdgePixels(t) {
      (this._repeatEdgePixels = t), this.updatePadding();
    }
  }
  var zd = `varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;
  class ks extends wt {
    constructor() {
      const t = {
        m: new Float32Array([1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0]),
        uAlpha: 1,
      };
      super(Os, zd, t), (this.alpha = 1);
    }
    _loadMatrix(t, e = !1) {
      let r = t;
      e && (this._multiply(r, this.uniforms.m, t), (r = this._colorMatrix(r))),
        (this.uniforms.m = r);
    }
    _multiply(t, e, r) {
      return (
        (t[0] = e[0] * r[0] + e[1] * r[5] + e[2] * r[10] + e[3] * r[15]),
        (t[1] = e[0] * r[1] + e[1] * r[6] + e[2] * r[11] + e[3] * r[16]),
        (t[2] = e[0] * r[2] + e[1] * r[7] + e[2] * r[12] + e[3] * r[17]),
        (t[3] = e[0] * r[3] + e[1] * r[8] + e[2] * r[13] + e[3] * r[18]),
        (t[4] = e[0] * r[4] + e[1] * r[9] + e[2] * r[14] + e[3] * r[19] + e[4]),
        (t[5] = e[5] * r[0] + e[6] * r[5] + e[7] * r[10] + e[8] * r[15]),
        (t[6] = e[5] * r[1] + e[6] * r[6] + e[7] * r[11] + e[8] * r[16]),
        (t[7] = e[5] * r[2] + e[6] * r[7] + e[7] * r[12] + e[8] * r[17]),
        (t[8] = e[5] * r[3] + e[6] * r[8] + e[7] * r[13] + e[8] * r[18]),
        (t[9] = e[5] * r[4] + e[6] * r[9] + e[7] * r[14] + e[8] * r[19] + e[9]),
        (t[10] = e[10] * r[0] + e[11] * r[5] + e[12] * r[10] + e[13] * r[15]),
        (t[11] = e[10] * r[1] + e[11] * r[6] + e[12] * r[11] + e[13] * r[16]),
        (t[12] = e[10] * r[2] + e[11] * r[7] + e[12] * r[12] + e[13] * r[17]),
        (t[13] = e[10] * r[3] + e[11] * r[8] + e[12] * r[13] + e[13] * r[18]),
        (t[14] = e[10] * r[4] + e[11] * r[9] + e[12] * r[14] + e[13] * r[19] + e[14]),
        (t[15] = e[15] * r[0] + e[16] * r[5] + e[17] * r[10] + e[18] * r[15]),
        (t[16] = e[15] * r[1] + e[16] * r[6] + e[17] * r[11] + e[18] * r[16]),
        (t[17] = e[15] * r[2] + e[16] * r[7] + e[17] * r[12] + e[18] * r[17]),
        (t[18] = e[15] * r[3] + e[16] * r[8] + e[17] * r[13] + e[18] * r[18]),
        (t[19] = e[15] * r[4] + e[16] * r[9] + e[17] * r[14] + e[18] * r[19] + e[19]),
        t
      );
    }
    _colorMatrix(t) {
      const e = new Float32Array(t);
      return (e[4] /= 255), (e[9] /= 255), (e[14] /= 255), (e[19] /= 255), e;
    }
    brightness(t, e) {
      const r = [t, 0, 0, 0, 0, 0, t, 0, 0, 0, 0, 0, t, 0, 0, 0, 0, 0, 1, 0];
      this._loadMatrix(r, e);
    }
    tint(t, e) {
      const r = (t >> 16) & 255,
        s = (t >> 8) & 255,
        n = t & 255,
        a = [r / 255, 0, 0, 0, 0, 0, s / 255, 0, 0, 0, 0, 0, n / 255, 0, 0, 0, 0, 0, 1, 0];
      this._loadMatrix(a, e);
    }
    greyscale(t, e) {
      const r = [t, t, t, 0, 0, t, t, t, 0, 0, t, t, t, 0, 0, 0, 0, 0, 1, 0];
      this._loadMatrix(r, e);
    }
    blackAndWhite(t) {
      const e = [0.3, 0.6, 0.1, 0, 0, 0.3, 0.6, 0.1, 0, 0, 0.3, 0.6, 0.1, 0, 0, 0, 0, 0, 1, 0];
      this._loadMatrix(e, t);
    }
    hue(t, e) {
      t = ((t || 0) / 180) * Math.PI;
      const r = Math.cos(t),
        s = Math.sin(t),
        n = Math.sqrt,
        a = 1 / 3,
        o = n(a),
        h = r + (1 - r) * a,
        l = a * (1 - r) - o * s,
        u = a * (1 - r) + o * s,
        c = a * (1 - r) + o * s,
        d = r + a * (1 - r),
        f = a * (1 - r) - o * s,
        p = a * (1 - r) - o * s,
        g = a * (1 - r) + o * s,
        _ = r + a * (1 - r),
        T = [h, l, u, 0, 0, c, d, f, 0, 0, p, g, _, 0, 0, 0, 0, 0, 1, 0];
      this._loadMatrix(T, e);
    }
    contrast(t, e) {
      const r = (t || 0) + 1,
        s = -0.5 * (r - 1),
        n = [r, 0, 0, 0, s, 0, r, 0, 0, s, 0, 0, r, 0, s, 0, 0, 0, 1, 0];
      this._loadMatrix(n, e);
    }
    saturate(t = 0, e) {
      const r = (t * 2) / 3 + 1,
        s = (r - 1) * -0.5,
        n = [r, s, s, 0, 0, s, r, s, 0, 0, s, s, r, 0, 0, 0, 0, 0, 1, 0];
      this._loadMatrix(n, e);
    }
    desaturate() {
      this.saturate(-1);
    }
    negative(t) {
      const e = [-1, 0, 0, 1, 0, 0, -1, 0, 1, 0, 0, 0, -1, 1, 0, 0, 0, 0, 1, 0];
      this._loadMatrix(e, t);
    }
    sepia(t) {
      const e = [
        0.393, 0.7689999, 0.18899999, 0, 0, 0.349, 0.6859999, 0.16799999, 0, 0, 0.272, 0.5339999,
        0.13099999, 0, 0, 0, 0, 0, 1, 0,
      ];
      this._loadMatrix(e, t);
    }
    technicolor(t) {
      const e = [
        1.9125277891456083, -0.8545344976951645, -0.09155508482755585, 0, 11.793603434377337,
        -0.3087833385928097, 1.7658908555458428, -0.10601743074722245, 0, -70.35205161461398,
        -0.231103377548616, -0.7501899197440212, 1.847597816108189, 0, 30.950940869491138, 0, 0, 0,
        1, 0,
      ];
      this._loadMatrix(e, t);
    }
    polaroid(t) {
      const e = [
        1.438, -0.062, -0.062, 0, 0, -0.122, 1.378, -0.122, 0, 0, -0.016, -0.016, 1.483, 0, 0, 0, 0,
        0, 1, 0,
      ];
      this._loadMatrix(e, t);
    }
    toBGR(t) {
      const e = [0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0];
      this._loadMatrix(e, t);
    }
    kodachrome(t) {
      const e = [
        1.1285582396593525, -0.3967382283601348, -0.03992559172921793, 0, 63.72958762196502,
        -0.16404339962244616, 1.0835251566291304, -0.05498805115633132, 0, 24.732407896706203,
        -0.16786010706155763, -0.5603416277695248, 1.6014850761964943, 0, 35.62982807460946, 0, 0,
        0, 1, 0,
      ];
      this._loadMatrix(e, t);
    }
    browni(t) {
      const e = [
        0.5997023498159715, 0.34553243048391263, -0.2708298674538042, 0, 47.43192855600873,
        -0.037703249837783157, 0.8609577587992641, 0.15059552388459913, 0, -36.96841498319127,
        0.24113635128153335, -0.07441037908422492, 0.44972182064877153, 0, -7.562075277591283, 0, 0,
        0, 1, 0,
      ];
      this._loadMatrix(e, t);
    }
    vintage(t) {
      const e = [
        0.6279345635605994, 0.3202183420819367, -0.03965408211312453, 0, 9.651285835294123,
        0.02578397704808868, 0.6441188644374771, 0.03259127616149294, 0, 7.462829176470591,
        0.0466055556782719, -0.0851232987247891, 0.5241648018700465, 0, 5.159190588235296, 0, 0, 0,
        1, 0,
      ];
      this._loadMatrix(e, t);
    }
    colorTone(t, e, r, s, n) {
      (t = t || 0.2), (e = e || 0.15), (r = r || 16770432), (s = s || 3375104);
      const a = ((r >> 16) & 255) / 255,
        o = ((r >> 8) & 255) / 255,
        h = (r & 255) / 255,
        l = ((s >> 16) & 255) / 255,
        u = ((s >> 8) & 255) / 255,
        c = (s & 255) / 255,
        d = [0.3, 0.59, 0.11, 0, 0, a, o, h, t, 0, l, u, c, e, 0, a - l, o - u, h - c, 0, 0];
      this._loadMatrix(d, n);
    }
    night(t, e) {
      t = t || 0.1;
      const r = [t * -2, -t, 0, 0, 0, -t, 0, t, 0, 0, 0, t, t * 2, 0, 0, 0, 0, 0, 1, 0];
      this._loadMatrix(r, e);
    }
    predator(t, e) {
      const r = [
        11.224130630493164 * t,
        -4.794486999511719 * t,
        -2.8746118545532227 * t,
        0 * t,
        0.40342438220977783 * t,
        -3.6330697536468506 * t,
        9.193157196044922 * t,
        -2.951810836791992 * t,
        0 * t,
        -1.316135048866272 * t,
        -3.2184197902679443 * t,
        -4.2375030517578125 * t,
        7.476448059082031 * t,
        0 * t,
        0.8044459223747253 * t,
        0,
        0,
        0,
        1,
        0,
      ];
      this._loadMatrix(r, e);
    }
    lsd(t) {
      const e = [2, -0.4, 0.5, 0, 0, -0.5, 2, -0.4, 0, 0, -0.4, -0.5, 3, 0, 0, 0, 0, 0, 1, 0];
      this._loadMatrix(e, t);
    }
    reset() {
      const t = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0];
      this._loadMatrix(t, !1);
    }
    get matrix() {
      return this.uniforms.m;
    }
    set matrix(t) {
      this.uniforms.m = t;
    }
    get alpha() {
      return this.uniforms.uAlpha;
    }
    set alpha(t) {
      this.uniforms.uAlpha = t;
    }
  }
  ks.prototype.grayscale = ks.prototype.greyscale;
  var Wd = `varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,
    Vd = `attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;
  class Yd extends wt {
    constructor(t, e) {
      const r = new Q();
      (t.renderable = !1),
        super(Vd, Wd, {
          mapSampler: t._texture,
          filterMatrix: r,
          scale: { x: 1, y: 1 },
          rotation: new Float32Array([1, 0, 0, 1]),
        }),
        (this.maskSprite = t),
        (this.maskMatrix = r),
        e == null && (e = 20),
        (this.scale = new V(e, e));
    }
    apply(t, e, r, s) {
      (this.uniforms.filterMatrix = t.calculateSpriteMatrix(this.maskMatrix, this.maskSprite)),
        (this.uniforms.scale.x = this.scale.x),
        (this.uniforms.scale.y = this.scale.y);
      const n = this.maskSprite.worldTransform,
        a = Math.sqrt(n.a * n.a + n.b * n.b),
        o = Math.sqrt(n.c * n.c + n.d * n.d);
      a !== 0 &&
        o !== 0 &&
        ((this.uniforms.rotation[0] = n.a / a),
        (this.uniforms.rotation[1] = n.b / a),
        (this.uniforms.rotation[2] = n.c / o),
        (this.uniforms.rotation[3] = n.d / o)),
        t.applyFilter(this, e, r, s);
    }
    get map() {
      return this.uniforms.mapSampler;
    }
    set map(t) {
      this.uniforms.mapSampler = t;
    }
  }
  var jd = `
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`,
    qd = `varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`;
  class Kd extends wt {
    constructor() {
      super(jd, qd);
    }
  }
  var Zd = `precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;
  class Qd extends wt {
    constructor(t = 0.5, e = Math.random()) {
      super(Os, Zd, { uNoise: 0, uSeed: 0 }), (this.noise = t), (this.seed = e);
    }
    get noise() {
      return this.uniforms.uNoise;
    }
    set noise(t) {
      this.uniforms.uNoise = t;
    }
    get seed() {
      return this.uniforms.uSeed;
    }
    set seed(t) {
      this.uniforms.uSeed = t;
    }
  }
  A.SORTABLE_CHILDREN = !1;
  class si {
    constructor() {
      (this.minX = 1 / 0),
        (this.minY = 1 / 0),
        (this.maxX = -1 / 0),
        (this.maxY = -1 / 0),
        (this.rect = null),
        (this.updateID = -1);
    }
    isEmpty() {
      return this.minX > this.maxX || this.minY > this.maxY;
    }
    clear() {
      (this.minX = 1 / 0), (this.minY = 1 / 0), (this.maxX = -1 / 0), (this.maxY = -1 / 0);
    }
    getRectangle(t) {
      return this.minX > this.maxX || this.minY > this.maxY
        ? z.EMPTY
        : ((t = t || new z(0, 0, 1, 1)),
          (t.x = this.minX),
          (t.y = this.minY),
          (t.width = this.maxX - this.minX),
          (t.height = this.maxY - this.minY),
          t);
    }
    addPoint(t) {
      (this.minX = Math.min(this.minX, t.x)),
        (this.maxX = Math.max(this.maxX, t.x)),
        (this.minY = Math.min(this.minY, t.y)),
        (this.maxY = Math.max(this.maxY, t.y));
    }
    addPointMatrix(t, e) {
      const { a: r, b: s, c: n, d: a, tx: o, ty: h } = t,
        l = r * e.x + n * e.y + o,
        u = s * e.x + a * e.y + h;
      (this.minX = Math.min(this.minX, l)),
        (this.maxX = Math.max(this.maxX, l)),
        (this.minY = Math.min(this.minY, u)),
        (this.maxY = Math.max(this.maxY, u));
    }
    addQuad(t) {
      let e = this.minX,
        r = this.minY,
        s = this.maxX,
        n = this.maxY,
        a = t[0],
        o = t[1];
      (e = a < e ? a : e),
        (r = o < r ? o : r),
        (s = a > s ? a : s),
        (n = o > n ? o : n),
        (a = t[2]),
        (o = t[3]),
        (e = a < e ? a : e),
        (r = o < r ? o : r),
        (s = a > s ? a : s),
        (n = o > n ? o : n),
        (a = t[4]),
        (o = t[5]),
        (e = a < e ? a : e),
        (r = o < r ? o : r),
        (s = a > s ? a : s),
        (n = o > n ? o : n),
        (a = t[6]),
        (o = t[7]),
        (e = a < e ? a : e),
        (r = o < r ? o : r),
        (s = a > s ? a : s),
        (n = o > n ? o : n),
        (this.minX = e),
        (this.minY = r),
        (this.maxX = s),
        (this.maxY = n);
    }
    addFrame(t, e, r, s, n) {
      this.addFrameMatrix(t.worldTransform, e, r, s, n);
    }
    addFrameMatrix(t, e, r, s, n) {
      const a = t.a,
        o = t.b,
        h = t.c,
        l = t.d,
        u = t.tx,
        c = t.ty;
      let d = this.minX,
        f = this.minY,
        p = this.maxX,
        g = this.maxY,
        _ = a * e + h * r + u,
        T = o * e + l * r + c;
      (d = _ < d ? _ : d),
        (f = T < f ? T : f),
        (p = _ > p ? _ : p),
        (g = T > g ? T : g),
        (_ = a * s + h * r + u),
        (T = o * s + l * r + c),
        (d = _ < d ? _ : d),
        (f = T < f ? T : f),
        (p = _ > p ? _ : p),
        (g = T > g ? T : g),
        (_ = a * e + h * n + u),
        (T = o * e + l * n + c),
        (d = _ < d ? _ : d),
        (f = T < f ? T : f),
        (p = _ > p ? _ : p),
        (g = T > g ? T : g),
        (_ = a * s + h * n + u),
        (T = o * s + l * n + c),
        (d = _ < d ? _ : d),
        (f = T < f ? T : f),
        (p = _ > p ? _ : p),
        (g = T > g ? T : g),
        (this.minX = d),
        (this.minY = f),
        (this.maxX = p),
        (this.maxY = g);
    }
    addVertexData(t, e, r) {
      let s = this.minX,
        n = this.minY,
        a = this.maxX,
        o = this.maxY;
      for (let h = e; h < r; h += 2) {
        const l = t[h],
          u = t[h + 1];
        (s = l < s ? l : s), (n = u < n ? u : n), (a = l > a ? l : a), (o = u > o ? u : o);
      }
      (this.minX = s), (this.minY = n), (this.maxX = a), (this.maxY = o);
    }
    addVertices(t, e, r, s) {
      this.addVerticesMatrix(t.worldTransform, e, r, s);
    }
    addVerticesMatrix(t, e, r, s, n = 0, a = n) {
      const o = t.a,
        h = t.b,
        l = t.c,
        u = t.d,
        c = t.tx,
        d = t.ty;
      let f = this.minX,
        p = this.minY,
        g = this.maxX,
        _ = this.maxY;
      for (let T = r; T < s; T += 2) {
        const v = e[T],
          x = e[T + 1],
          y = o * v + l * x + c,
          E = u * x + h * v + d;
        (f = Math.min(f, y - n)),
          (g = Math.max(g, y + n)),
          (p = Math.min(p, E - a)),
          (_ = Math.max(_, E + a));
      }
      (this.minX = f), (this.minY = p), (this.maxX = g), (this.maxY = _);
    }
    addBounds(t) {
      const e = this.minX,
        r = this.minY,
        s = this.maxX,
        n = this.maxY;
      (this.minX = t.minX < e ? t.minX : e),
        (this.minY = t.minY < r ? t.minY : r),
        (this.maxX = t.maxX > s ? t.maxX : s),
        (this.maxY = t.maxY > n ? t.maxY : n);
    }
    addBoundsMask(t, e) {
      const r = t.minX > e.minX ? t.minX : e.minX,
        s = t.minY > e.minY ? t.minY : e.minY,
        n = t.maxX < e.maxX ? t.maxX : e.maxX,
        a = t.maxY < e.maxY ? t.maxY : e.maxY;
      if (r <= n && s <= a) {
        const o = this.minX,
          h = this.minY,
          l = this.maxX,
          u = this.maxY;
        (this.minX = r < o ? r : o),
          (this.minY = s < h ? s : h),
          (this.maxX = n > l ? n : l),
          (this.maxY = a > u ? a : u);
      }
    }
    addBoundsMatrix(t, e) {
      this.addFrameMatrix(e, t.minX, t.minY, t.maxX, t.maxY);
    }
    addBoundsArea(t, e) {
      const r = t.minX > e.x ? t.minX : e.x,
        s = t.minY > e.y ? t.minY : e.y,
        n = t.maxX < e.x + e.width ? t.maxX : e.x + e.width,
        a = t.maxY < e.y + e.height ? t.maxY : e.y + e.height;
      if (r <= n && s <= a) {
        const o = this.minX,
          h = this.minY,
          l = this.maxX,
          u = this.maxY;
        (this.minX = r < o ? r : o),
          (this.minY = s < h ? s : h),
          (this.maxX = n > l ? n : l),
          (this.maxY = a > u ? a : u);
      }
    }
    pad(t = 0, e = t) {
      this.isEmpty() || ((this.minX -= t), (this.maxX += t), (this.minY -= e), (this.maxY += e));
    }
    addFramePad(t, e, r, s, n, a) {
      (t -= n),
        (e -= a),
        (r += n),
        (s += a),
        (this.minX = this.minX < t ? this.minX : t),
        (this.maxX = this.maxX > r ? this.maxX : r),
        (this.minY = this.minY < e ? this.minY : e),
        (this.maxY = this.maxY > s ? this.maxY : s);
    }
  }
  class tt extends Me {
    constructor() {
      super(),
        (this.tempDisplayObjectParent = null),
        (this.transform = new ze()),
        (this.alpha = 1),
        (this.visible = !0),
        (this.renderable = !0),
        (this.cullable = !1),
        (this.cullArea = null),
        (this.parent = null),
        (this.worldAlpha = 1),
        (this._lastSortedIndex = 0),
        (this._zIndex = 0),
        (this.filterArea = null),
        (this.filters = null),
        (this._enabledFilters = null),
        (this._bounds = new si()),
        (this._localBounds = null),
        (this._boundsID = 0),
        (this._boundsRect = null),
        (this._localBoundsRect = null),
        (this._mask = null),
        (this._maskRefCount = 0),
        (this._destroyed = !1),
        (this.isSprite = !1),
        (this.isMask = !1);
    }
    static mixin(t) {
      const e = Object.keys(t);
      for (let r = 0; r < e.length; ++r) {
        const s = e[r];
        Object.defineProperty(tt.prototype, s, Object.getOwnPropertyDescriptor(t, s));
      }
    }
    get destroyed() {
      return this._destroyed;
    }
    _recursivePostUpdateTransform() {
      this.parent
        ? (this.parent._recursivePostUpdateTransform(),
          this.transform.updateTransform(this.parent.transform))
        : this.transform.updateTransform(this._tempDisplayObjectParent.transform);
    }
    updateTransform() {
      this._boundsID++,
        this.transform.updateTransform(this.parent.transform),
        (this.worldAlpha = this.alpha * this.parent.worldAlpha);
    }
    getBounds(t, e) {
      return (
        t ||
          (this.parent
            ? (this._recursivePostUpdateTransform(), this.updateTransform())
            : ((this.parent = this._tempDisplayObjectParent),
              this.updateTransform(),
              (this.parent = null))),
        this._bounds.updateID !== this._boundsID &&
          (this.calculateBounds(), (this._bounds.updateID = this._boundsID)),
        e || (this._boundsRect || (this._boundsRect = new z()), (e = this._boundsRect)),
        this._bounds.getRectangle(e)
      );
    }
    getLocalBounds(t) {
      t ||
        (this._localBoundsRect || (this._localBoundsRect = new z()), (t = this._localBoundsRect)),
        this._localBounds || (this._localBounds = new si());
      const e = this.transform,
        r = this.parent;
      (this.parent = null), (this.transform = this._tempDisplayObjectParent.transform);
      const s = this._bounds,
        n = this._boundsID;
      this._bounds = this._localBounds;
      const a = this.getBounds(!1, t);
      return (
        (this.parent = r),
        (this.transform = e),
        (this._bounds = s),
        (this._bounds.updateID += this._boundsID - n),
        a
      );
    }
    toGlobal(t, e, r = !1) {
      return (
        r ||
          (this._recursivePostUpdateTransform(),
          this.parent
            ? this.displayObjectUpdateTransform()
            : ((this.parent = this._tempDisplayObjectParent),
              this.displayObjectUpdateTransform(),
              (this.parent = null))),
        this.worldTransform.apply(t, e)
      );
    }
    toLocal(t, e, r, s) {
      return (
        e && (t = e.toGlobal(t, r, s)),
        s ||
          (this._recursivePostUpdateTransform(),
          this.parent
            ? this.displayObjectUpdateTransform()
            : ((this.parent = this._tempDisplayObjectParent),
              this.displayObjectUpdateTransform(),
              (this.parent = null))),
        this.worldTransform.applyInverse(t, r)
      );
    }
    setParent(t) {
      if (!t || !t.addChild) throw new Error("setParent: Argument must be a Container");
      return t.addChild(this), t;
    }
    setTransform(t = 0, e = 0, r = 1, s = 1, n = 0, a = 0, o = 0, h = 0, l = 0) {
      return (
        (this.position.x = t),
        (this.position.y = e),
        (this.scale.x = r || 1),
        (this.scale.y = s || 1),
        (this.rotation = n),
        (this.skew.x = a),
        (this.skew.y = o),
        (this.pivot.x = h),
        (this.pivot.y = l),
        this
      );
    }
    destroy(t) {
      this.parent && this.parent.removeChild(this),
        (this._destroyed = !0),
        (this.transform = null),
        (this.parent = null),
        (this._bounds = null),
        (this.mask = null),
        (this.cullArea = null),
        (this.filters = null),
        (this.filterArea = null),
        (this.hitArea = null),
        (this.interactive = !1),
        (this.interactiveChildren = !1),
        this.emit("destroyed"),
        this.removeAllListeners();
    }
    get _tempDisplayObjectParent() {
      return (
        this.tempDisplayObjectParent === null && (this.tempDisplayObjectParent = new $a()),
        this.tempDisplayObjectParent
      );
    }
    enableTempParent() {
      const t = this.parent;
      return (this.parent = this._tempDisplayObjectParent), t;
    }
    disableTempParent(t) {
      this.parent = t;
    }
    get x() {
      return this.position.x;
    }
    set x(t) {
      this.transform.position.x = t;
    }
    get y() {
      return this.position.y;
    }
    set y(t) {
      this.transform.position.y = t;
    }
    get worldTransform() {
      return this.transform.worldTransform;
    }
    get localTransform() {
      return this.transform.localTransform;
    }
    get position() {
      return this.transform.position;
    }
    set position(t) {
      this.transform.position.copyFrom(t);
    }
    get scale() {
      return this.transform.scale;
    }
    set scale(t) {
      this.transform.scale.copyFrom(t);
    }
    get pivot() {
      return this.transform.pivot;
    }
    set pivot(t) {
      this.transform.pivot.copyFrom(t);
    }
    get skew() {
      return this.transform.skew;
    }
    set skew(t) {
      this.transform.skew.copyFrom(t);
    }
    get rotation() {
      return this.transform.rotation;
    }
    set rotation(t) {
      this.transform.rotation = t;
    }
    get angle() {
      return this.transform.rotation * Nn;
    }
    set angle(t) {
      this.transform.rotation = t * Bn;
    }
    get zIndex() {
      return this._zIndex;
    }
    set zIndex(t) {
      (this._zIndex = t), this.parent && (this.parent.sortDirty = !0);
    }
    get worldVisible() {
      let t = this;
      do {
        if (!t.visible) return !1;
        t = t.parent;
      } while (t);
      return !0;
    }
    get mask() {
      return this._mask;
    }
    set mask(t) {
      if (this._mask !== t) {
        if (this._mask) {
          const e = this._mask.isMaskData ? this._mask.maskObject : this._mask;
          e && (e._maskRefCount--, e._maskRefCount === 0 && ((e.renderable = !0), (e.isMask = !1)));
        }
        if (((this._mask = t), this._mask)) {
          const e = this._mask.isMaskData ? this._mask.maskObject : this._mask;
          e && (e._maskRefCount === 0 && ((e.renderable = !1), (e.isMask = !0)), e._maskRefCount++);
        }
      }
    }
  }
  class $a extends tt {
    constructor() {
      super(...arguments), (this.sortDirty = null);
    }
  }
  tt.prototype.displayObjectUpdateTransform = tt.prototype.updateTransform;
  function Jd(i, t) {
    return i.zIndex === t.zIndex ? i._lastSortedIndex - t._lastSortedIndex : i.zIndex - t.zIndex;
  }
  class vt extends tt {
    constructor() {
      super(),
        (this.children = []),
        (this.sortableChildren = A.SORTABLE_CHILDREN),
        (this.sortDirty = !1);
    }
    onChildrenChange(t) {}
    addChild(...t) {
      if (t.length > 1) for (let e = 0; e < t.length; e++) this.addChild(t[e]);
      else {
        const e = t[0];
        e.parent && e.parent.removeChild(e),
          (e.parent = this),
          (this.sortDirty = !0),
          (e.transform._parentID = -1),
          this.children.push(e),
          this._boundsID++,
          this.onChildrenChange(this.children.length - 1),
          this.emit("childAdded", e, this, this.children.length - 1),
          e.emit("added", this);
      }
      return t[0];
    }
    addChildAt(t, e) {
      if (e < 0 || e > this.children.length)
        throw new Error(
          `${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`
        );
      return (
        t.parent && t.parent.removeChild(t),
        (t.parent = this),
        (this.sortDirty = !0),
        (t.transform._parentID = -1),
        this.children.splice(e, 0, t),
        this._boundsID++,
        this.onChildrenChange(e),
        t.emit("added", this),
        this.emit("childAdded", t, this, e),
        t
      );
    }
    swapChildren(t, e) {
      if (t === e) return;
      const r = this.getChildIndex(t),
        s = this.getChildIndex(e);
      (this.children[r] = e), (this.children[s] = t), this.onChildrenChange(r < s ? r : s);
    }
    getChildIndex(t) {
      const e = this.children.indexOf(t);
      if (e === -1) throw new Error("The supplied DisplayObject must be a child of the caller");
      return e;
    }
    setChildIndex(t, e) {
      if (e < 0 || e >= this.children.length)
        throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);
      const r = this.getChildIndex(t);
      ve(this.children, r, 1), this.children.splice(e, 0, t), this.onChildrenChange(e);
    }
    getChildAt(t) {
      if (t < 0 || t >= this.children.length)
        throw new Error(`getChildAt: Index (${t}) does not exist.`);
      return this.children[t];
    }
    removeChild(...t) {
      if (t.length > 1) for (let e = 0; e < t.length; e++) this.removeChild(t[e]);
      else {
        const e = t[0],
          r = this.children.indexOf(e);
        if (r === -1) return null;
        (e.parent = null),
          (e.transform._parentID = -1),
          ve(this.children, r, 1),
          this._boundsID++,
          this.onChildrenChange(r),
          e.emit("removed", this),
          this.emit("childRemoved", e, this, r);
      }
      return t[0];
    }
    removeChildAt(t) {
      const e = this.getChildAt(t);
      return (
        (e.parent = null),
        (e.transform._parentID = -1),
        ve(this.children, t, 1),
        this._boundsID++,
        this.onChildrenChange(t),
        e.emit("removed", this),
        this.emit("childRemoved", e, this, t),
        e
      );
    }
    removeChildren(t = 0, e = this.children.length) {
      const r = t,
        s = e,
        n = s - r;
      let a;
      if (n > 0 && n <= s) {
        a = this.children.splice(r, n);
        for (let o = 0; o < a.length; ++o)
          (a[o].parent = null), a[o].transform && (a[o].transform._parentID = -1);
        this._boundsID++, this.onChildrenChange(t);
        for (let o = 0; o < a.length; ++o)
          a[o].emit("removed", this), this.emit("childRemoved", a[o], this, o);
        return a;
      } else if (n === 0 && this.children.length === 0) return [];
      throw new RangeError("removeChildren: numeric values are outside the acceptable range.");
    }
    sortChildren() {
      let t = !1;
      for (let e = 0, r = this.children.length; e < r; ++e) {
        const s = this.children[e];
        (s._lastSortedIndex = e), !t && s.zIndex !== 0 && (t = !0);
      }
      t && this.children.length > 1 && this.children.sort(Jd), (this.sortDirty = !1);
    }
    updateTransform() {
      this.sortableChildren && this.sortDirty && this.sortChildren(),
        this._boundsID++,
        this.transform.updateTransform(this.parent.transform),
        (this.worldAlpha = this.alpha * this.parent.worldAlpha);
      for (let t = 0, e = this.children.length; t < e; ++t) {
        const r = this.children[t];
        r.visible && r.updateTransform();
      }
    }
    calculateBounds() {
      this._bounds.clear(), this._calculateBounds();
      for (let t = 0; t < this.children.length; t++) {
        const e = this.children[t];
        if (!(!e.visible || !e.renderable))
          if ((e.calculateBounds(), e._mask)) {
            const r = e._mask.isMaskData ? e._mask.maskObject : e._mask;
            r
              ? (r.calculateBounds(), this._bounds.addBoundsMask(e._bounds, r._bounds))
              : this._bounds.addBounds(e._bounds);
          } else
            e.filterArea
              ? this._bounds.addBoundsArea(e._bounds, e.filterArea)
              : this._bounds.addBounds(e._bounds);
      }
      this._bounds.updateID = this._boundsID;
    }
    getLocalBounds(t, e = !1) {
      const r = super.getLocalBounds(t);
      if (!e)
        for (let s = 0, n = this.children.length; s < n; ++s) {
          const a = this.children[s];
          a.visible && a.updateTransform();
        }
      return r;
    }
    _calculateBounds() {}
    _renderWithCulling(t) {
      const e = t.renderTexture.sourceFrame;
      if (!(e.width > 0 && e.height > 0)) return;
      let r, s;
      if (
        (this.cullArea
          ? ((r = this.cullArea), (s = this.worldTransform))
          : this._render !== vt.prototype._render && (r = this.getBounds(!0)),
        r && e.intersects(r, s))
      )
        this._render(t);
      else if (this.cullArea) return;
      for (let n = 0, a = this.children.length; n < a; ++n) {
        const o = this.children[n],
          h = o.cullable;
        (o.cullable = h || !this.cullArea), o.render(t), (o.cullable = h);
      }
    }
    render(t) {
      var e;
      if (!(!this.visible || this.worldAlpha <= 0 || !this.renderable))
        if (this._mask || ((e = this.filters) == null ? void 0 : e.length)) this.renderAdvanced(t);
        else if (this.cullable) this._renderWithCulling(t);
        else {
          this._render(t);
          for (let r = 0, s = this.children.length; r < s; ++r) this.children[r].render(t);
        }
    }
    renderAdvanced(t) {
      var n, a, o;
      const e = this.filters,
        r = this._mask;
      if (e) {
        this._enabledFilters || (this._enabledFilters = []), (this._enabledFilters.length = 0);
        for (let h = 0; h < e.length; h++) e[h].enabled && this._enabledFilters.push(e[h]);
      }
      const s =
        (e && ((n = this._enabledFilters) == null ? void 0 : n.length)) ||
        (r && (!r.isMaskData || (r.enabled && (r.autoDetect || r.type !== ht.NONE))));
      if (
        (s && t.batch.flush(),
        e &&
          ((a = this._enabledFilters) == null ? void 0 : a.length) &&
          t.filter.push(this, this._enabledFilters),
        r && t.mask.push(this, this._mask),
        this.cullable)
      )
        this._renderWithCulling(t);
      else {
        this._render(t);
        for (let h = 0, l = this.children.length; h < l; ++h) this.children[h].render(t);
      }
      s && t.batch.flush(),
        r && t.mask.pop(this),
        e && ((o = this._enabledFilters) == null ? void 0 : o.length) && t.filter.pop();
    }
    _render(t) {}
    destroy(t) {
      super.destroy(), (this.sortDirty = !1);
      const e = typeof t == "boolean" ? t : t == null ? void 0 : t.children,
        r = this.removeChildren(0, this.children.length);
      if (e) for (let s = 0; s < r.length; ++s) r[s].destroy(t);
    }
    get width() {
      return this.scale.x * this.getLocalBounds().width;
    }
    set width(t) {
      const e = this.getLocalBounds().width;
      e !== 0 ? (this.scale.x = t / e) : (this.scale.x = 1), (this._width = t);
    }
    get height() {
      return this.scale.y * this.getLocalBounds().height;
    }
    set height(t) {
      const e = this.getLocalBounds().height;
      e !== 0 ? (this.scale.y = t / e) : (this.scale.y = 1), (this._height = t);
    }
  }
  vt.prototype.containerUpdateTransform = vt.prototype.updateTransform;
  const ni = new V(),
    tf = new Uint16Array([0, 1, 2, 0, 2, 3]);
  class le extends vt {
    constructor(t) {
      super(),
        (this._anchor = new Zt(
          this._onAnchorUpdate,
          this,
          t ? t.defaultAnchor.x : 0,
          t ? t.defaultAnchor.y : 0
        )),
        (this._texture = null),
        (this._width = 0),
        (this._height = 0),
        (this._tint = null),
        (this._tintRGB = null),
        (this.tint = 16777215),
        (this.blendMode = G.NORMAL),
        (this._cachedTint = 16777215),
        (this.uvs = null),
        (this.texture = t || O.EMPTY),
        (this.vertexData = new Float32Array(8)),
        (this.vertexTrimmedData = null),
        (this._transformID = -1),
        (this._textureID = -1),
        (this._transformTrimmedID = -1),
        (this._textureTrimmedID = -1),
        (this.indices = tf),
        (this.pluginName = "batch"),
        (this.isSprite = !0),
        (this._roundPixels = A.ROUND_PIXELS);
    }
    _onTextureUpdate() {
      (this._textureID = -1),
        (this._textureTrimmedID = -1),
        (this._cachedTint = 16777215),
        this._width && (this.scale.x = (be(this.scale.x) * this._width) / this._texture.orig.width),
        this._height &&
          (this.scale.y = (be(this.scale.y) * this._height) / this._texture.orig.height);
    }
    _onAnchorUpdate() {
      (this._transformID = -1), (this._transformTrimmedID = -1);
    }
    calculateVertices() {
      const t = this._texture;
      if (this._transformID === this.transform._worldID && this._textureID === t._updateID) return;
      this._textureID !== t._updateID && (this.uvs = this._texture._uvs.uvsFloat32),
        (this._transformID = this.transform._worldID),
        (this._textureID = t._updateID);
      const e = this.transform.worldTransform,
        r = e.a,
        s = e.b,
        n = e.c,
        a = e.d,
        o = e.tx,
        h = e.ty,
        l = this.vertexData,
        u = t.trim,
        c = t.orig,
        d = this._anchor;
      let f = 0,
        p = 0,
        g = 0,
        _ = 0;
      if (
        (u
          ? ((p = u.x - d._x * c.width),
            (f = p + u.width),
            (_ = u.y - d._y * c.height),
            (g = _ + u.height))
          : ((p = -d._x * c.width), (f = p + c.width), (_ = -d._y * c.height), (g = _ + c.height)),
        (l[0] = r * p + n * _ + o),
        (l[1] = a * _ + s * p + h),
        (l[2] = r * f + n * _ + o),
        (l[3] = a * _ + s * f + h),
        (l[4] = r * f + n * g + o),
        (l[5] = a * g + s * f + h),
        (l[6] = r * p + n * g + o),
        (l[7] = a * g + s * p + h),
        this._roundPixels)
      ) {
        const T = A.RESOLUTION;
        for (let v = 0; v < l.length; ++v) l[v] = Math.round(((l[v] * T) | 0) / T);
      }
    }
    calculateTrimmedVertices() {
      if (!this.vertexTrimmedData) this.vertexTrimmedData = new Float32Array(8);
      else if (
        this._transformTrimmedID === this.transform._worldID &&
        this._textureTrimmedID === this._texture._updateID
      )
        return;
      (this._transformTrimmedID = this.transform._worldID),
        (this._textureTrimmedID = this._texture._updateID);
      const t = this._texture,
        e = this.vertexTrimmedData,
        r = t.orig,
        s = this._anchor,
        n = this.transform.worldTransform,
        a = n.a,
        o = n.b,
        h = n.c,
        l = n.d,
        u = n.tx,
        c = n.ty,
        d = -s._x * r.width,
        f = d + r.width,
        p = -s._y * r.height,
        g = p + r.height;
      (e[0] = a * d + h * p + u),
        (e[1] = l * p + o * d + c),
        (e[2] = a * f + h * p + u),
        (e[3] = l * p + o * f + c),
        (e[4] = a * f + h * g + u),
        (e[5] = l * g + o * f + c),
        (e[6] = a * d + h * g + u),
        (e[7] = l * g + o * d + c);
    }
    _render(t) {
      this.calculateVertices(),
        t.batch.setObjectRenderer(t.plugins[this.pluginName]),
        t.plugins[this.pluginName].render(this);
    }
    _calculateBounds() {
      const t = this._texture.trim,
        e = this._texture.orig;
      !t || (t.width === e.width && t.height === e.height)
        ? (this.calculateVertices(), this._bounds.addQuad(this.vertexData))
        : (this.calculateTrimmedVertices(), this._bounds.addQuad(this.vertexTrimmedData));
    }
    getLocalBounds(t) {
      return this.children.length === 0
        ? (this._localBounds || (this._localBounds = new si()),
          (this._localBounds.minX = this._texture.orig.width * -this._anchor._x),
          (this._localBounds.minY = this._texture.orig.height * -this._anchor._y),
          (this._localBounds.maxX = this._texture.orig.width * (1 - this._anchor._x)),
          (this._localBounds.maxY = this._texture.orig.height * (1 - this._anchor._y)),
          t ||
            (this._localBoundsRect || (this._localBoundsRect = new z()),
            (t = this._localBoundsRect)),
          this._localBounds.getRectangle(t))
        : super.getLocalBounds.call(this, t);
    }
    containsPoint(t) {
      this.worldTransform.applyInverse(t, ni);
      const e = this._texture.orig.width,
        r = this._texture.orig.height,
        s = -e * this.anchor.x;
      let n = 0;
      return ni.x >= s && ni.x < s + e && ((n = -r * this.anchor.y), ni.y >= n && ni.y < n + r);
    }
    destroy(t) {
      if (
        (super.destroy(t),
        this._texture.off("update", this._onTextureUpdate, this),
        (this._anchor = null),
        typeof t == "boolean" ? t : t == null ? void 0 : t.texture)
      ) {
        const e = typeof t == "boolean" ? t : t == null ? void 0 : t.baseTexture;
        this._texture.destroy(!!e);
      }
      this._texture = null;
    }
    static from(t, e) {
      const r = t instanceof O ? t : O.from(t, e);
      return new le(r);
    }
    set roundPixels(t) {
      this._roundPixels !== t && (this._transformID = -1), (this._roundPixels = t);
    }
    get roundPixels() {
      return this._roundPixels;
    }
    get width() {
      return Math.abs(this.scale.x) * this._texture.orig.width;
    }
    set width(t) {
      const e = be(this.scale.x) || 1;
      (this.scale.x = (e * t) / this._texture.orig.width), (this._width = t);
    }
    get height() {
      return Math.abs(this.scale.y) * this._texture.orig.height;
    }
    set height(t) {
      const e = be(this.scale.y) || 1;
      (this.scale.y = (e * t) / this._texture.orig.height), (this._height = t);
    }
    get anchor() {
      return this._anchor;
    }
    set anchor(t) {
      this._anchor.copyFrom(t);
    }
    get tint() {
      return this._tint;
    }
    set tint(t) {
      (this._tint = t), (this._tintRGB = (t >> 16) + (t & 65280) + ((t & 255) << 16));
    }
    get texture() {
      return this._texture;
    }
    set texture(t) {
      this._texture !== t &&
        (this._texture && this._texture.off("update", this._onTextureUpdate, this),
        (this._texture = t || O.EMPTY),
        (this._cachedTint = 16777215),
        (this._textureID = -1),
        (this._textureTrimmedID = -1),
        t &&
          (t.baseTexture.valid
            ? this._onTextureUpdate()
            : t.once("update", this._onTextureUpdate, this)));
    }
  }
  const Ha = new Q();
  (tt.prototype._cacheAsBitmap = !1),
    (tt.prototype._cacheData = null),
    (tt.prototype._cacheAsBitmapResolution = null),
    (tt.prototype._cacheAsBitmapMultisample = ot.NONE);
  class ef {
    constructor() {
      (this.textureCacheId = null),
        (this.originalRender = null),
        (this.originalRenderCanvas = null),
        (this.originalCalculateBounds = null),
        (this.originalGetLocalBounds = null),
        (this.originalUpdateTransform = null),
        (this.originalDestroy = null),
        (this.originalMask = null),
        (this.originalFilterArea = null),
        (this.originalContainsPoint = null),
        (this.sprite = null);
    }
  }
  Object.defineProperties(tt.prototype, {
    cacheAsBitmapResolution: {
      get() {
        return this._cacheAsBitmapResolution;
      },
      set(i) {
        i !== this._cacheAsBitmapResolution &&
          ((this._cacheAsBitmapResolution = i),
          this.cacheAsBitmap && ((this.cacheAsBitmap = !1), (this.cacheAsBitmap = !0)));
      },
    },
    cacheAsBitmapMultisample: {
      get() {
        return this._cacheAsBitmapMultisample;
      },
      set(i) {
        i !== this._cacheAsBitmapMultisample &&
          ((this._cacheAsBitmapMultisample = i),
          this.cacheAsBitmap && ((this.cacheAsBitmap = !1), (this.cacheAsBitmap = !0)));
      },
    },
    cacheAsBitmap: {
      get() {
        return this._cacheAsBitmap;
      },
      set(i) {
        if (this._cacheAsBitmap === i) return;
        this._cacheAsBitmap = i;
        let t;
        i
          ? (this._cacheData || (this._cacheData = new ef()),
            (t = this._cacheData),
            (t.originalRender = this.render),
            (t.originalRenderCanvas = this.renderCanvas),
            (t.originalUpdateTransform = this.updateTransform),
            (t.originalCalculateBounds = this.calculateBounds),
            (t.originalGetLocalBounds = this.getLocalBounds),
            (t.originalDestroy = this.destroy),
            (t.originalContainsPoint = this.containsPoint),
            (t.originalMask = this._mask),
            (t.originalFilterArea = this.filterArea),
            (this.render = this._renderCached),
            (this.renderCanvas = this._renderCachedCanvas),
            (this.destroy = this._cacheAsBitmapDestroy))
          : ((t = this._cacheData),
            t.sprite && this._destroyCachedDisplayObject(),
            (this.render = t.originalRender),
            (this.renderCanvas = t.originalRenderCanvas),
            (this.calculateBounds = t.originalCalculateBounds),
            (this.getLocalBounds = t.originalGetLocalBounds),
            (this.destroy = t.originalDestroy),
            (this.updateTransform = t.originalUpdateTransform),
            (this.containsPoint = t.originalContainsPoint),
            (this._mask = t.originalMask),
            (this.filterArea = t.originalFilterArea));
      },
    },
  }),
    (tt.prototype._renderCached = function (i) {
      !this.visible ||
        this.worldAlpha <= 0 ||
        !this.renderable ||
        (this._initCachedDisplayObject(i),
        (this._cacheData.sprite.transform._worldID = this.transform._worldID),
        (this._cacheData.sprite.worldAlpha = this.worldAlpha),
        this._cacheData.sprite._render(i));
    }),
    (tt.prototype._initCachedDisplayObject = function (i) {
      var c, d, f;
      if ((c = this._cacheData) != null && c.sprite) return;
      const t = this.alpha;
      (this.alpha = 1), i.batch.flush();
      const e = this.getLocalBounds(null, !0).clone();
      if ((d = this.filters) != null && d.length) {
        const p = this.filters[0].padding;
        e.pad(p);
      }
      e.ceil(A.RESOLUTION);
      const r = i.renderTexture.current,
        s = i.renderTexture.sourceFrame.clone(),
        n = i.renderTexture.destinationFrame.clone(),
        a = i.projection.transform,
        o = te.create({
          width: e.width,
          height: e.height,
          resolution: this.cacheAsBitmapResolution || i.resolution,
          multisample: (f = this.cacheAsBitmapMultisample) != null ? f : i.multisample,
        }),
        h = `cacheAsBitmap_${he()}`;
      (this._cacheData.textureCacheId = h), Y.addToCache(o.baseTexture, h), O.addToCache(o, h);
      const l = this.transform.localTransform.copyTo(Ha).invert().translate(-e.x, -e.y);
      (this.render = this._cacheData.originalRender),
        i.render(this, { renderTexture: o, clear: !0, transform: l, skipUpdateTransform: !1 }),
        i.framebuffer.blit(),
        (i.projection.transform = a),
        i.renderTexture.bind(r, s, n),
        (this.render = this._renderCached),
        (this.updateTransform = this.displayObjectUpdateTransform),
        (this.calculateBounds = this._calculateCachedBounds),
        (this.getLocalBounds = this._getCachedLocalBounds),
        (this._mask = null),
        (this.filterArea = null),
        (this.alpha = t);
      const u = new le(o);
      (u.transform.worldTransform = this.transform.worldTransform),
        (u.anchor.x = -(e.x / e.width)),
        (u.anchor.y = -(e.y / e.height)),
        (u.alpha = t),
        (u._bounds = this._bounds),
        (this._cacheData.sprite = u),
        (this.transform._parentID = -1),
        this.parent
          ? this.updateTransform()
          : (this.enableTempParent(), this.updateTransform(), this.disableTempParent(null)),
        (this.containsPoint = u.containsPoint.bind(u));
    }),
    (tt.prototype._renderCachedCanvas = function (i) {
      !this.visible ||
        this.worldAlpha <= 0 ||
        !this.renderable ||
        (this._initCachedDisplayObjectCanvas(i),
        (this._cacheData.sprite.worldAlpha = this.worldAlpha),
        this._cacheData.sprite._renderCanvas(i));
    }),
    (tt.prototype._initCachedDisplayObjectCanvas = function (i) {
      var l;
      if ((l = this._cacheData) != null && l.sprite) return;
      const t = this.getLocalBounds(null, !0),
        e = this.alpha;
      this.alpha = 1;
      const r = i.canvasContext.activeContext,
        s = i._projTransform;
      t.ceil(A.RESOLUTION);
      const n = te.create({ width: t.width, height: t.height }),
        a = `cacheAsBitmap_${he()}`;
      (this._cacheData.textureCacheId = a), Y.addToCache(n.baseTexture, a), O.addToCache(n, a);
      const o = Ha;
      this.transform.localTransform.copyTo(o),
        o.invert(),
        (o.tx -= t.x),
        (o.ty -= t.y),
        (this.renderCanvas = this._cacheData.originalRenderCanvas),
        i.render(this, { renderTexture: n, clear: !0, transform: o, skipUpdateTransform: !1 }),
        (i.canvasContext.activeContext = r),
        (i._projTransform = s),
        (this.renderCanvas = this._renderCachedCanvas),
        (this.updateTransform = this.displayObjectUpdateTransform),
        (this.calculateBounds = this._calculateCachedBounds),
        (this.getLocalBounds = this._getCachedLocalBounds),
        (this._mask = null),
        (this.filterArea = null),
        (this.alpha = e);
      const h = new le(n);
      (h.transform.worldTransform = this.transform.worldTransform),
        (h.anchor.x = -(t.x / t.width)),
        (h.anchor.y = -(t.y / t.height)),
        (h.alpha = e),
        (h._bounds = this._bounds),
        (this._cacheData.sprite = h),
        (this.transform._parentID = -1),
        this.parent
          ? this.updateTransform()
          : ((this.parent = i._tempDisplayObjectParent),
            this.updateTransform(),
            (this.parent = null)),
        (this.containsPoint = h.containsPoint.bind(h));
    }),
    (tt.prototype._calculateCachedBounds = function () {
      this._bounds.clear(),
        (this._cacheData.sprite.transform._worldID = this.transform._worldID),
        this._cacheData.sprite._calculateBounds(),
        (this._bounds.updateID = this._boundsID);
    }),
    (tt.prototype._getCachedLocalBounds = function () {
      return this._cacheData.sprite.getLocalBounds(null);
    }),
    (tt.prototype._destroyCachedDisplayObject = function () {
      this._cacheData.sprite._texture.destroy(!0),
        (this._cacheData.sprite = null),
        Y.removeFromCache(this._cacheData.textureCacheId),
        O.removeFromCache(this._cacheData.textureCacheId),
        (this._cacheData.textureCacheId = null);
    }),
    (tt.prototype._cacheAsBitmapDestroy = function (i) {
      (this.cacheAsBitmap = !1), this.destroy(i);
    }),
    (tt.prototype.name = null),
    (vt.prototype.getChildByName = function (i, t) {
      for (let e = 0, r = this.children.length; e < r; e++)
        if (this.children[e].name === i) return this.children[e];
      if (t)
        for (let e = 0, r = this.children.length; e < r; e++) {
          const s = this.children[e];
          if (!s.getChildByName) continue;
          const n = s.getChildByName(i, !0);
          if (n) return n;
        }
      return null;
    }),
    (tt.prototype.getGlobalPosition = function (i = new V(), t = !1) {
      return (
        this.parent
          ? this.parent.toGlobal(this.position, i, t)
          : ((i.x = this.position.x), (i.y = this.position.y)),
        i
      );
    });
  class Be {
    constructor(t) {
      (this.bubbles = !0),
        (this.cancelBubble = !0),
        (this.cancelable = !1),
        (this.composed = !1),
        (this.defaultPrevented = !1),
        (this.eventPhase = Be.prototype.NONE),
        (this.propagationStopped = !1),
        (this.propagationImmediatelyStopped = !1),
        (this.layer = new V()),
        (this.page = new V()),
        (this.AT_TARGET = 1),
        (this.BUBBLING_PHASE = 2),
        (this.CAPTURING_PHASE = 3),
        (this.NONE = 0),
        (this.manager = t);
    }
    get layerX() {
      return this.layer.x;
    }
    get layerY() {
      return this.layer.y;
    }
    get pageX() {
      return this.page.x;
    }
    get pageY() {
      return this.page.y;
    }
    get data() {
      return this;
    }
    composedPath() {
      return (
        this.manager &&
          (!this.path || this.path[this.path.length - 1] !== this.target) &&
          (this.path = this.target ? this.manager.propagationPath(this.target) : []),
        this.path
      );
    }
    initEvent(t, e, r) {
      throw new Error(
        "initEvent() is a legacy DOM API. It is not implemented in the Federated Events API."
      );
    }
    preventDefault() {
      this.nativeEvent instanceof Event &&
        this.nativeEvent.cancelable &&
        this.nativeEvent.preventDefault(),
        (this.defaultPrevented = !0);
    }
    stopImmediatePropagation() {
      this.propagationImmediatelyStopped = !0;
    }
    stopPropagation() {
      this.propagationStopped = !0;
    }
  }
  class ai extends Be {
    constructor() {
      super(...arguments),
        (this.client = new V()),
        (this.movement = new V()),
        (this.offset = new V()),
        (this.global = new V()),
        (this.screen = new V());
    }
    get clientX() {
      return this.client.x;
    }
    get clientY() {
      return this.client.y;
    }
    get x() {
      return this.clientX;
    }
    get y() {
      return this.clientY;
    }
    get movementX() {
      return this.movement.x;
    }
    get movementY() {
      return this.movement.y;
    }
    get offsetX() {
      return this.offset.x;
    }
    get offsetY() {
      return this.offset.y;
    }
    get globalX() {
      return this.global.x;
    }
    get globalY() {
      return this.global.y;
    }
    get screenX() {
      return this.screen.x;
    }
    get screenY() {
      return this.screen.y;
    }
    getModifierState(t) {
      return "getModifierState" in this.nativeEvent && this.nativeEvent.getModifierState(t);
    }
    initMouseEvent(t, e, r, s, n, a, o, h, l, u, c, d, f, p, g) {
      throw new Error("Method not implemented.");
    }
  }
  class Mt extends ai {
    constructor() {
      super(...arguments), (this.width = 0), (this.height = 0), (this.isPrimary = !1);
    }
    getCoalescedEvents() {
      return this.type === "pointermove" || this.type === "mousemove" || this.type === "touchmove"
        ? [this]
        : [];
    }
    getPredictedEvents() {
      throw new Error("getPredictedEvents is not supported!");
    }
  }
  class Ji extends ai {
    constructor() {
      super(...arguments),
        (this.DOM_DELTA_LINE = 0),
        (this.DOM_DELTA_PAGE = 1),
        (this.DOM_DELTA_PIXEL = 2);
    }
  }
  const rf = 2048,
    sf = new V(),
    Xs = new V();
  class za {
    constructor(t) {
      (this.dispatch = new Me()),
        (this.moveOnAll = !1),
        (this.mappingState = { trackingData: {} }),
        (this.eventPool = new Map()),
        (this.rootTarget = t),
        (this.hitPruneFn = this.hitPruneFn.bind(this)),
        (this.hitTestFn = this.hitTestFn.bind(this)),
        (this.mapPointerDown = this.mapPointerDown.bind(this)),
        (this.mapPointerMove = this.mapPointerMove.bind(this)),
        (this.mapPointerOut = this.mapPointerOut.bind(this)),
        (this.mapPointerOver = this.mapPointerOver.bind(this)),
        (this.mapPointerUp = this.mapPointerUp.bind(this)),
        (this.mapPointerUpOutside = this.mapPointerUpOutside.bind(this)),
        (this.mapWheel = this.mapWheel.bind(this)),
        (this.mappingTable = {}),
        this.addEventMapping("pointerdown", this.mapPointerDown),
        this.addEventMapping("pointermove", this.mapPointerMove),
        this.addEventMapping("pointerout", this.mapPointerOut),
        this.addEventMapping("pointerleave", this.mapPointerOut),
        this.addEventMapping("pointerover", this.mapPointerOver),
        this.addEventMapping("pointerup", this.mapPointerUp),
        this.addEventMapping("pointerupoutside", this.mapPointerUpOutside),
        this.addEventMapping("wheel", this.mapWheel);
    }
    addEventMapping(t, e) {
      this.mappingTable[t] || (this.mappingTable[t] = []),
        this.mappingTable[t].push({ fn: e, priority: 0 }),
        this.mappingTable[t].sort((r, s) => r.priority - s.priority);
    }
    dispatchEvent(t, e) {
      (t.propagationStopped = !1),
        (t.propagationImmediatelyStopped = !1),
        this.propagate(t, e),
        this.dispatch.emit(e || t.type, t);
    }
    mapEvent(t) {
      if (!this.rootTarget) return;
      const e = this.mappingTable[t.type];
      if (e) for (let r = 0, s = e.length; r < s; r++) e[r].fn(t);
      else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`);
    }
    hitTest(t, e) {
      const r = this.hitTestRecursive(
        this.rootTarget,
        this.rootTarget.interactive,
        sf.set(t, e),
        this.hitTestFn,
        this.hitPruneFn
      );
      return r && r[0];
    }
    propagate(t, e) {
      if (!t.target) return;
      const r = t.composedPath();
      t.eventPhase = t.CAPTURING_PHASE;
      for (let s = 0, n = r.length - 1; s < n; s++)
        if (
          ((t.currentTarget = r[s]),
          this.notifyTarget(t, e),
          t.propagationStopped || t.propagationImmediatelyStopped)
        )
          return;
      if (
        ((t.eventPhase = t.AT_TARGET),
        (t.currentTarget = t.target),
        this.notifyTarget(t, e),
        !(t.propagationStopped || t.propagationImmediatelyStopped))
      ) {
        t.eventPhase = t.BUBBLING_PHASE;
        for (let s = r.length - 2; s >= 0; s--)
          if (
            ((t.currentTarget = r[s]),
            this.notifyTarget(t, e),
            t.propagationStopped || t.propagationImmediatelyStopped)
          )
            return;
      }
    }
    all(t, e, r = this.rootTarget) {
      t.eventPhase = t.BUBBLING_PHASE;
      const s = r.children;
      if (s) for (let n = 0; n < s.length; n++) this.all(t, e, s[n]);
      (t.currentTarget = r), this.notifyTarget(t, e);
    }
    propagationPath(t) {
      const e = [t];
      for (let r = 0; r < rf && t !== this.rootTarget; r++) {
        if (!t.parent) throw new Error("Cannot find propagation path to disconnected target");
        e.push(t.parent), (t = t.parent);
      }
      return e.reverse(), e;
    }
    hitTestRecursive(t, e, r, s, n) {
      if (!t || !t.visible || n(t, r)) return null;
      if (t.interactiveChildren && t.children) {
        const a = t.children;
        for (let o = a.length - 1; o >= 0; o--) {
          const h = a[o],
            l = this.hitTestRecursive(h, e || h.interactive, r, s, n);
          if (l) {
            if (l.length > 0 && !l[l.length - 1].parent) continue;
            return (l.length > 0 || t.interactive) && l.push(t), l;
          }
        }
      }
      return e && s(t, r) ? (t.interactive ? [t] : []) : null;
    }
    hitPruneFn(t, e) {
      var r;
      if (t.hitArea && (t.worldTransform.applyInverse(e, Xs), !t.hitArea.contains(Xs.x, Xs.y)))
        return !0;
      if (t._mask) {
        const s = t._mask.isMaskData ? t._mask.maskObject : t._mask;
        if (s && !((r = s.containsPoint) != null && r.call(s, e))) return !0;
      }
      return !1;
    }
    hitTestFn(t, e) {
      return t.hitArea ? !0 : t.containsPoint ? t.containsPoint(e) : !1;
    }
    notifyTarget(t, e) {
      e = e != null ? e : t.type;
      const r =
        t.eventPhase === t.CAPTURING_PHASE || t.eventPhase === t.AT_TARGET ? `${e}capture` : e;
      this.notifyListeners(t, r), t.eventPhase === t.AT_TARGET && this.notifyListeners(t, e);
    }
    mapPointerDown(t) {
      if (!(t instanceof Mt)) {
        console.warn("EventBoundary cannot map a non-pointer event as a pointer event");
        return;
      }
      const e = this.createPointerEvent(t);
      if ((this.dispatchEvent(e, "pointerdown"), e.pointerType === "touch"))
        this.dispatchEvent(e, "touchstart");
      else if (e.pointerType === "mouse" || e.pointerType === "pen") {
        const s = e.button === 2;
        this.dispatchEvent(e, s ? "rightdown" : "mousedown");
      }
      const r = this.trackingData(t.pointerId);
      (r.pressTargetsByButton[t.button] = e.composedPath()), this.freeEvent(e);
    }
    mapPointerMove(t) {
      var o;
      if (!(t instanceof Mt)) {
        console.warn("EventBoundary cannot map a non-pointer event as a pointer event");
        return;
      }
      const e = this.createPointerEvent(t),
        r = e.pointerType === "mouse" || e.pointerType === "pen",
        s = this.trackingData(t.pointerId),
        n = this.findMountedTarget(s.overTargets);
      if (s.overTargets && n !== e.target) {
        const h = t.type === "mousemove" ? "mouseout" : "pointerout",
          l = this.createPointerEvent(t, h, n);
        if (
          (this.dispatchEvent(l, "pointerout"),
          r && this.dispatchEvent(l, "mouseout"),
          !e.composedPath().includes(n))
        ) {
          const u = this.createPointerEvent(t, "pointerleave", n);
          for (u.eventPhase = u.AT_TARGET; u.target && !e.composedPath().includes(u.target); )
            (u.currentTarget = u.target),
              this.notifyTarget(u),
              r && this.notifyTarget(u, "mouseleave"),
              (u.target = u.target.parent);
          this.freeEvent(u);
        }
        this.freeEvent(l);
      }
      if (n !== e.target) {
        const h = t.type === "mousemove" ? "mouseover" : "pointerover",
          l = this.clonePointerEvent(e, h);
        this.dispatchEvent(l, "pointerover"), r && this.dispatchEvent(l, "mouseover");
        let u = n == null ? void 0 : n.parent;
        for (; u && u !== this.rootTarget.parent && u !== e.target; ) u = u.parent;
        if (!u || u === this.rootTarget.parent) {
          const c = this.clonePointerEvent(e, "pointerenter");
          for (
            c.eventPhase = c.AT_TARGET;
            c.target && c.target !== n && c.target !== this.rootTarget.parent;

          )
            (c.currentTarget = c.target),
              this.notifyTarget(c),
              r && this.notifyTarget(c, "mouseenter"),
              (c.target = c.target.parent);
          this.freeEvent(c);
        }
        this.freeEvent(l);
      }
      const a = this.moveOnAll ? "all" : "dispatchEvent";
      this[a](e, "pointermove"),
        e.pointerType === "touch" && this[a](e, "touchmove"),
        r && (this[a](e, "mousemove"), (this.cursor = (o = e.target) == null ? void 0 : o.cursor)),
        (s.overTargets = e.composedPath()),
        this.freeEvent(e);
    }
    mapPointerOver(t) {
      var a;
      if (!(t instanceof Mt)) {
        console.warn("EventBoundary cannot map a non-pointer event as a pointer event");
        return;
      }
      const e = this.trackingData(t.pointerId),
        r = this.createPointerEvent(t),
        s = r.pointerType === "mouse" || r.pointerType === "pen";
      this.dispatchEvent(r, "pointerover"),
        s && this.dispatchEvent(r, "mouseover"),
        r.pointerType === "mouse" && (this.cursor = (a = r.target) == null ? void 0 : a.cursor);
      const n = this.clonePointerEvent(r, "pointerenter");
      for (n.eventPhase = n.AT_TARGET; n.target && n.target !== this.rootTarget.parent; )
        (n.currentTarget = n.target),
          this.notifyTarget(n),
          s && this.notifyTarget(n, "mouseenter"),
          (n.target = n.target.parent);
      (e.overTargets = r.composedPath()), this.freeEvent(r), this.freeEvent(n);
    }
    mapPointerOut(t) {
      if (!(t instanceof Mt)) {
        console.warn("EventBoundary cannot map a non-pointer event as a pointer event");
        return;
      }
      const e = this.trackingData(t.pointerId);
      if (e.overTargets) {
        const r = t.pointerType === "mouse" || t.pointerType === "pen",
          s = this.findMountedTarget(e.overTargets),
          n = this.createPointerEvent(t, "pointerout", s);
        this.dispatchEvent(n), r && this.dispatchEvent(n, "mouseout");
        const a = this.createPointerEvent(t, "pointerleave", s);
        for (a.eventPhase = a.AT_TARGET; a.target && a.target !== this.rootTarget.parent; )
          (a.currentTarget = a.target),
            this.notifyTarget(a),
            r && this.notifyTarget(a, "mouseleave"),
            (a.target = a.target.parent);
        (e.overTargets = null), this.freeEvent(n), this.freeEvent(a);
      }
      this.cursor = null;
    }
    mapPointerUp(t) {
      if (!(t instanceof Mt)) {
        console.warn("EventBoundary cannot map a non-pointer event as a pointer event");
        return;
      }
      const e = performance.now(),
        r = this.createPointerEvent(t);
      if ((this.dispatchEvent(r, "pointerup"), r.pointerType === "touch"))
        this.dispatchEvent(r, "touchend");
      else if (r.pointerType === "mouse" || r.pointerType === "pen") {
        const o = r.button === 2;
        this.dispatchEvent(r, o ? "rightup" : "mouseup");
      }
      const s = this.trackingData(t.pointerId),
        n = this.findMountedTarget(s.pressTargetsByButton[t.button]);
      let a = n;
      if (n && !r.composedPath().includes(n)) {
        let o = n;
        for (; o && !r.composedPath().includes(o); ) {
          if (
            ((r.currentTarget = o),
            this.notifyTarget(r, "pointerupoutside"),
            r.pointerType === "touch")
          )
            this.notifyTarget(r, "touchendoutside");
          else if (r.pointerType === "mouse" || r.pointerType === "pen") {
            const h = r.button === 2;
            this.notifyTarget(r, h ? "rightupoutside" : "mouseupoutside");
          }
          o = o.parent;
        }
        delete s.pressTargetsByButton[t.button], (a = o);
      }
      if (a) {
        const o = this.clonePointerEvent(r, "click");
        (o.target = a),
          (o.path = null),
          s.clicksByButton[t.button] ||
            (s.clicksByButton[t.button] = { clickCount: 0, target: o.target, timeStamp: e });
        const h = s.clicksByButton[t.button];
        h.target === o.target && e - h.timeStamp < 200 ? ++h.clickCount : (h.clickCount = 1),
          (h.target = o.target),
          (h.timeStamp = e),
          (o.detail = h.clickCount),
          o.pointerType === "mouse"
            ? this.dispatchEvent(o, "click")
            : o.pointerType === "touch" && this.dispatchEvent(o, "tap"),
          this.dispatchEvent(o, "pointertap"),
          this.freeEvent(o);
      }
      this.freeEvent(r);
    }
    mapPointerUpOutside(t) {
      if (!(t instanceof Mt)) {
        console.warn("EventBoundary cannot map a non-pointer event as a pointer event");
        return;
      }
      const e = this.trackingData(t.pointerId),
        r = this.findMountedTarget(e.pressTargetsByButton[t.button]),
        s = this.createPointerEvent(t);
      if (r) {
        let n = r;
        for (; n; )
          (s.currentTarget = n),
            this.notifyTarget(s, "pointerupoutside"),
            s.pointerType === "touch"
              ? this.notifyTarget(s, "touchendoutside")
              : (s.pointerType === "mouse" || s.pointerType === "pen") &&
                this.notifyTarget(s, s.button === 2 ? "rightupoutside" : "mouseupoutside"),
            (n = n.parent);
        delete e.pressTargetsByButton[t.button];
      }
      this.freeEvent(s);
    }
    mapWheel(t) {
      if (!(t instanceof Ji)) {
        console.warn("EventBoundary cannot map a non-wheel event as a wheel event");
        return;
      }
      const e = this.createWheelEvent(t);
      this.dispatchEvent(e), this.freeEvent(e);
    }
    findMountedTarget(t) {
      if (!t) return null;
      let e = t[0];
      for (let r = 1; r < t.length && t[r].parent === e; r++) e = t[r];
      return e;
    }
    createPointerEvent(t, e, r) {
      const s = this.allocateEvent(Mt);
      return (
        this.copyPointerData(t, s),
        this.copyMouseData(t, s),
        this.copyData(t, s),
        (s.nativeEvent = t.nativeEvent),
        (s.originalEvent = t),
        (s.target = r != null ? r : this.hitTest(s.global.x, s.global.y)),
        typeof e == "string" && (s.type = e),
        s
      );
    }
    createWheelEvent(t) {
      const e = this.allocateEvent(Ji);
      return (
        this.copyWheelData(t, e),
        this.copyMouseData(t, e),
        this.copyData(t, e),
        (e.nativeEvent = t.nativeEvent),
        (e.originalEvent = t),
        (e.target = this.hitTest(e.global.x, e.global.y)),
        e
      );
    }
    clonePointerEvent(t, e) {
      const r = this.allocateEvent(Mt);
      return (
        (r.nativeEvent = t.nativeEvent),
        (r.originalEvent = t.originalEvent),
        this.copyPointerData(t, r),
        this.copyMouseData(t, r),
        this.copyData(t, r),
        (r.target = t.target),
        (r.path = t.composedPath().slice()),
        (r.type = e != null ? e : r.type),
        r
      );
    }
    copyWheelData(t, e) {
      (e.deltaMode = t.deltaMode),
        (e.deltaX = t.deltaX),
        (e.deltaY = t.deltaY),
        (e.deltaZ = t.deltaZ);
    }
    copyPointerData(t, e) {
      t instanceof Mt &&
        e instanceof Mt &&
        ((e.pointerId = t.pointerId),
        (e.width = t.width),
        (e.height = t.height),
        (e.isPrimary = t.isPrimary),
        (e.pointerType = t.pointerType),
        (e.pressure = t.pressure),
        (e.tangentialPressure = t.tangentialPressure),
        (e.tiltX = t.tiltX),
        (e.tiltY = t.tiltY),
        (e.twist = t.twist));
    }
    copyMouseData(t, e) {
      t instanceof ai &&
        e instanceof ai &&
        ((e.altKey = t.altKey),
        (e.button = t.button),
        (e.buttons = t.buttons),
        e.client.copyFrom(t.client),
        (e.ctrlKey = t.ctrlKey),
        (e.metaKey = t.metaKey),
        e.movement.copyFrom(t.movement),
        e.screen.copyFrom(t.screen),
        e.global.copyFrom(t.global));
    }
    copyData(t, e) {
      (e.isTrusted = t.isTrusted),
        (e.srcElement = t.srcElement),
        (e.timeStamp = performance.now()),
        (e.type = t.type),
        (e.detail = t.detail),
        (e.view = t.view),
        (e.which = t.which),
        e.layer.copyFrom(t.layer),
        e.page.copyFrom(t.page);
    }
    trackingData(t) {
      return (
        this.mappingState.trackingData[t] ||
          (this.mappingState.trackingData[t] = {
            pressTargetsByButton: {},
            clicksByButton: {},
            overTarget: null,
          }),
        this.mappingState.trackingData[t]
      );
    }
    allocateEvent(t) {
      this.eventPool.has(t) || this.eventPool.set(t, []);
      const e = this.eventPool.get(t).pop() || new t(this);
      return (
        (e.eventPhase = e.NONE), (e.currentTarget = null), (e.path = null), (e.target = null), e
      );
    }
    freeEvent(t) {
      if (t.manager !== this)
        throw new Error("It is illegal to free an event not managed by this EventBoundary!");
      const e = t.constructor;
      this.eventPool.has(e) || this.eventPool.set(e, []), this.eventPool.get(e).push(t);
    }
    notifyListeners(t, e) {
      const r = t.currentTarget._events[e];
      if (r)
        if ("fn" in r) r.fn.call(r.context, t);
        else
          for (let s = 0, n = r.length; s < n && !t.propagationImmediatelyStopped; s++)
            r[s].fn.call(r[s].context, t);
    }
  }
  const nf = 1,
    af = {
      touchstart: "pointerdown",
      touchend: "pointerup",
      touchendoutside: "pointerupoutside",
      touchmove: "pointermove",
      touchcancel: "pointercancel",
    };
  class $s {
    constructor(t) {
      (this.supportsTouchEvents = "ontouchstart" in globalThis),
        (this.supportsPointerEvents = !!globalThis.PointerEvent),
        (this.domElement = null),
        (this.resolution = 1),
        (this.renderer = t),
        (this.rootBoundary = new za(null)),
        (this.autoPreventDefault = !0),
        (this.eventsAdded = !1),
        (this.rootPointerEvent = new Mt(null)),
        (this.rootWheelEvent = new Ji(null)),
        (this.cursorStyles = { default: "inherit", pointer: "pointer" }),
        (this.onPointerDown = this.onPointerDown.bind(this)),
        (this.onPointerMove = this.onPointerMove.bind(this)),
        (this.onPointerUp = this.onPointerUp.bind(this)),
        (this.onPointerOverOut = this.onPointerOverOut.bind(this)),
        (this.onWheel = this.onWheel.bind(this));
    }
    init() {
      const { view: t, resolution: e } = this.renderer;
      this.setTargetElement(t), (this.resolution = e);
    }
    destroy() {
      this.setTargetElement(null), (this.renderer = null);
    }
    setCursor(t) {
      t = t || "default";
      let e = !0;
      if (
        (globalThis.OffscreenCanvas && this.domElement instanceof OffscreenCanvas && (e = !1),
        this.currentCursor === t)
      )
        return;
      this.currentCursor = t;
      const r = this.cursorStyles[t];
      if (r)
        switch (typeof r) {
          case "string":
            e && (this.domElement.style.cursor = r);
            break;
          case "function":
            r(t);
            break;
          case "object":
            e && Object.assign(this.domElement.style, r);
            break;
        }
      else
        e &&
          typeof t == "string" &&
          !Object.prototype.hasOwnProperty.call(this.cursorStyles, t) &&
          (this.domElement.style.cursor = t);
    }
    onPointerDown(t) {
      if (
        ((this.rootBoundary.rootTarget = this.renderer.lastObjectRendered),
        this.supportsTouchEvents && t.pointerType === "touch")
      )
        return;
      const e = this.normalizeToPointerData(t);
      this.autoPreventDefault &&
        e[0].isNormalized &&
        (t.cancelable || !("cancelable" in t)) &&
        t.preventDefault();
      for (let r = 0, s = e.length; r < s; r++) {
        const n = e[r],
          a = this.bootstrapEvent(this.rootPointerEvent, n);
        this.rootBoundary.mapEvent(a);
      }
      this.setCursor(this.rootBoundary.cursor);
    }
    onPointerMove(t) {
      if (
        ((this.rootBoundary.rootTarget = this.renderer.lastObjectRendered),
        this.supportsTouchEvents && t.pointerType === "touch")
      )
        return;
      const e = this.normalizeToPointerData(t);
      for (let r = 0, s = e.length; r < s; r++) {
        const n = this.bootstrapEvent(this.rootPointerEvent, e[r]);
        this.rootBoundary.mapEvent(n);
      }
      this.setCursor(this.rootBoundary.cursor);
    }
    onPointerUp(t) {
      if (
        ((this.rootBoundary.rootTarget = this.renderer.lastObjectRendered),
        this.supportsTouchEvents && t.pointerType === "touch")
      )
        return;
      let e = t.target;
      t.composedPath && t.composedPath().length > 0 && (e = t.composedPath()[0]);
      const r = e !== this.domElement ? "outside" : "",
        s = this.normalizeToPointerData(t);
      for (let n = 0, a = s.length; n < a; n++) {
        const o = this.bootstrapEvent(this.rootPointerEvent, s[n]);
        (o.type += r), this.rootBoundary.mapEvent(o);
      }
      this.setCursor(this.rootBoundary.cursor);
    }
    onPointerOverOut(t) {
      if (
        ((this.rootBoundary.rootTarget = this.renderer.lastObjectRendered),
        this.supportsTouchEvents && t.pointerType === "touch")
      )
        return;
      const e = this.normalizeToPointerData(t);
      for (let r = 0, s = e.length; r < s; r++) {
        const n = this.bootstrapEvent(this.rootPointerEvent, e[r]);
        this.rootBoundary.mapEvent(n);
      }
      this.setCursor(this.rootBoundary.cursor);
    }
    onWheel(t) {
      const e = this.normalizeWheelEvent(t);
      (this.rootBoundary.rootTarget = this.renderer.lastObjectRendered),
        this.rootBoundary.mapEvent(e);
    }
    setTargetElement(t) {
      this.removeEvents(), (this.domElement = t), this.addEvents();
    }
    addEvents() {
      if (this.eventsAdded || !this.domElement) return;
      const t = this.domElement.style;
      globalThis.navigator.msPointerEnabled
        ? ((t.msContentZooming = "none"), (t.msTouchAction = "none"))
        : this.supportsPointerEvents && (t.touchAction = "none"),
        this.supportsPointerEvents
          ? (globalThis.document.addEventListener("pointermove", this.onPointerMove, !0),
            this.domElement.addEventListener("pointerdown", this.onPointerDown, !0),
            this.domElement.addEventListener("pointerleave", this.onPointerOverOut, !0),
            this.domElement.addEventListener("pointerover", this.onPointerOverOut, !0),
            globalThis.addEventListener("pointerup", this.onPointerUp, !0))
          : (globalThis.document.addEventListener("mousemove", this.onPointerMove, !0),
            this.domElement.addEventListener("mousedown", this.onPointerDown, !0),
            this.domElement.addEventListener("mouseout", this.onPointerOverOut, !0),
            this.domElement.addEventListener("mouseover", this.onPointerOverOut, !0),
            globalThis.addEventListener("mouseup", this.onPointerUp, !0)),
        this.supportsTouchEvents &&
          (this.domElement.addEventListener("touchstart", this.onPointerDown, !0),
          this.domElement.addEventListener("touchend", this.onPointerUp, !0),
          this.domElement.addEventListener("touchmove", this.onPointerMove, !0)),
        this.domElement.addEventListener("wheel", this.onWheel, { passive: !0, capture: !0 }),
        (this.eventsAdded = !0);
    }
    removeEvents() {
      if (!this.eventsAdded || !this.domElement) return;
      const t = this.domElement.style;
      globalThis.navigator.msPointerEnabled
        ? ((t.msContentZooming = ""), (t.msTouchAction = ""))
        : this.supportsPointerEvents && (t.touchAction = ""),
        this.supportsPointerEvents
          ? (globalThis.document.removeEventListener("pointermove", this.onPointerMove, !0),
            this.domElement.removeEventListener("pointerdown", this.onPointerDown, !0),
            this.domElement.removeEventListener("pointerleave", this.onPointerOverOut, !0),
            this.domElement.removeEventListener("pointerover", this.onPointerOverOut, !0),
            globalThis.removeEventListener("pointerup", this.onPointerUp, !0))
          : (globalThis.document.removeEventListener("mousemove", this.onPointerMove, !0),
            this.domElement.removeEventListener("mousedown", this.onPointerDown, !0),
            this.domElement.removeEventListener("mouseout", this.onPointerOverOut, !0),
            this.domElement.removeEventListener("mouseover", this.onPointerOverOut, !0),
            globalThis.removeEventListener("mouseup", this.onPointerUp, !0)),
        this.supportsTouchEvents &&
          (this.domElement.removeEventListener("touchstart", this.onPointerDown, !0),
          this.domElement.removeEventListener("touchend", this.onPointerUp, !0),
          this.domElement.removeEventListener("touchmove", this.onPointerMove, !0)),
        this.domElement.removeEventListener("wheel", this.onWheel, !0),
        (this.domElement = null),
        (this.eventsAdded = !1);
    }
    mapPositionToPoint(t, e, r) {
      let s;
      this.domElement.parentElement
        ? (s = this.domElement.getBoundingClientRect())
        : (s = {
            x: 0,
            y: 0,
            width: this.domElement.width,
            height: this.domElement.height,
            left: 0,
            top: 0,
          });
      const n = 1 / this.resolution;
      (t.x = (e - s.left) * (this.domElement.width / s.width) * n),
        (t.y = (r - s.top) * (this.domElement.height / s.height) * n);
    }
    normalizeToPointerData(t) {
      const e = [];
      if (this.supportsTouchEvents && t instanceof TouchEvent)
        for (let r = 0, s = t.changedTouches.length; r < s; r++) {
          const n = t.changedTouches[r];
          typeof n.button > "u" && (n.button = 0),
            typeof n.buttons > "u" && (n.buttons = 1),
            typeof n.isPrimary > "u" &&
              (n.isPrimary = t.touches.length === 1 && t.type === "touchstart"),
            typeof n.width > "u" && (n.width = n.radiusX || 1),
            typeof n.height > "u" && (n.height = n.radiusY || 1),
            typeof n.tiltX > "u" && (n.tiltX = 0),
            typeof n.tiltY > "u" && (n.tiltY = 0),
            typeof n.pointerType > "u" && (n.pointerType = "touch"),
            typeof n.pointerId > "u" && (n.pointerId = n.identifier || 0),
            typeof n.pressure > "u" && (n.pressure = n.force || 0.5),
            typeof n.twist > "u" && (n.twist = 0),
            typeof n.tangentialPressure > "u" && (n.tangentialPressure = 0),
            typeof n.layerX > "u" && (n.layerX = n.offsetX = n.clientX),
            typeof n.layerY > "u" && (n.layerY = n.offsetY = n.clientY),
            (n.isNormalized = !0),
            (n.type = t.type),
            e.push(n);
        }
      else if (
        !globalThis.MouseEvent ||
        (t instanceof MouseEvent &&
          (!this.supportsPointerEvents || !(t instanceof globalThis.PointerEvent)))
      ) {
        const r = t;
        typeof r.isPrimary > "u" && (r.isPrimary = !0),
          typeof r.width > "u" && (r.width = 1),
          typeof r.height > "u" && (r.height = 1),
          typeof r.tiltX > "u" && (r.tiltX = 0),
          typeof r.tiltY > "u" && (r.tiltY = 0),
          typeof r.pointerType > "u" && (r.pointerType = "mouse"),
          typeof r.pointerId > "u" && (r.pointerId = nf),
          typeof r.pressure > "u" && (r.pressure = 0.5),
          typeof r.twist > "u" && (r.twist = 0),
          typeof r.tangentialPressure > "u" && (r.tangentialPressure = 0),
          (r.isNormalized = !0),
          e.push(r);
      } else e.push(t);
      return e;
    }
    normalizeWheelEvent(t) {
      const e = this.rootWheelEvent;
      return (
        this.transferMouseData(e, t),
        (e.deltaMode = t.deltaMode),
        (e.deltaX = t.deltaX),
        (e.deltaY = t.deltaY),
        (e.deltaZ = t.deltaZ),
        this.mapPositionToPoint(e.screen, t.clientX, t.clientY),
        e.global.copyFrom(e.screen),
        e.offset.copyFrom(e.screen),
        (e.nativeEvent = t),
        (e.type = t.type),
        e
      );
    }
    bootstrapEvent(t, e) {
      return (
        (t.originalEvent = null),
        (t.nativeEvent = e),
        (t.pointerId = e.pointerId),
        (t.width = e.width),
        (t.height = e.height),
        (t.isPrimary = e.isPrimary),
        (t.pointerType = e.pointerType),
        (t.pressure = e.pressure),
        (t.tangentialPressure = e.tangentialPressure),
        (t.tiltX = e.tiltX),
        (t.tiltY = e.tiltY),
        (t.twist = e.twist),
        this.transferMouseData(t, e),
        this.mapPositionToPoint(t.screen, e.clientX, e.clientY),
        t.global.copyFrom(t.screen),
        t.offset.copyFrom(t.screen),
        (t.isTrusted = e.isTrusted),
        t.type === "pointerleave" && (t.type = "pointerout"),
        t.type.startsWith("mouse") && (t.type = t.type.replace("mouse", "pointer")),
        t.type.startsWith("touch") && (t.type = af[t.type] || t.type),
        t
      );
    }
    transferMouseData(t, e) {
      (t.isTrusted = e.isTrusted),
        (t.srcElement = e.srcElement),
        (t.timeStamp = performance.now()),
        (t.type = e.type),
        (t.altKey = e.altKey),
        (t.button = e.button),
        (t.buttons = e.buttons),
        (t.client.x = e.clientX),
        (t.client.y = e.clientY),
        (t.ctrlKey = e.ctrlKey),
        (t.metaKey = e.metaKey),
        (t.movement.x = e.movementX),
        (t.movement.y = e.movementY),
        (t.page.x = e.pageX),
        (t.page.y = e.pageY),
        (t.relatedTarget = null);
    }
  }
  ($s.extension = { name: "events", type: [P.RendererSystem, P.CanvasRendererSystem] }), B.add($s);
  const Wa = {
    interactive: !1,
    interactiveChildren: !0,
    hitArea: null,
    addEventListener(i, t, e) {
      const r = (typeof e == "boolean" && e) || (typeof e == "object" && e.capture),
        s = typeof t == "function" ? void 0 : t;
      (i = r ? `${i}capture` : i),
        (t = typeof t == "function" ? t : t.handleEvent),
        this.on(i, t, s);
    },
    removeEventListener(i, t, e) {
      const r = (typeof e == "boolean" && e) || (typeof e == "object" && e.capture),
        s = typeof t == "function" ? void 0 : t;
      (i = r ? `${i}capture` : i),
        (t = typeof t == "function" ? t : t.handleEvent),
        this.off(i, t, s);
    },
    dispatchEvent(i) {
      if (!(i instanceof Be))
        throw new Error(
          "DisplayObject cannot propagate events outside of the Federated Events API"
        );
      return (
        (i.defaultPrevented = !1),
        (i.path = null),
        (i.target = this),
        i.manager.dispatchEvent(i),
        !i.defaultPrevented
      );
    },
  };
  tt.mixin(Wa);
  const Va = {
    accessible: !1,
    accessibleTitle: null,
    accessibleHint: null,
    tabIndex: 0,
    _accessibleActive: !1,
    _accessibleDiv: null,
    accessibleType: "button",
    accessiblePointerEvents: "auto",
    accessibleChildren: !0,
    renderId: -1,
  };
  tt.mixin(Va);
  const of = 9,
    tr = 100,
    hf = 0,
    lf = 0,
    Ya = 2,
    ja = 1,
    uf = -1e3,
    cf = -1e3,
    df = 2;
  class Hs {
    constructor(t) {
      (this.debug = !1),
        (this._isActive = !1),
        (this._isMobileAccessibility = !1),
        (this.pool = []),
        (this.renderId = 0),
        (this.children = []),
        (this.androidUpdateCount = 0),
        (this.androidUpdateFrequency = 500),
        (this._hookDiv = null),
        (Ct.tablet || Ct.phone) && this.createTouchHook();
      const e = document.createElement("div");
      (e.style.width = `${tr}px`),
        (e.style.height = `${tr}px`),
        (e.style.position = "absolute"),
        (e.style.top = `${hf}px`),
        (e.style.left = `${lf}px`),
        (e.style.zIndex = Ya.toString()),
        (this.div = e),
        (this.renderer = t),
        (this._onKeyDown = this._onKeyDown.bind(this)),
        (this._onMouseMove = this._onMouseMove.bind(this)),
        globalThis.addEventListener("keydown", this._onKeyDown, !1);
    }
    get isActive() {
      return this._isActive;
    }
    get isMobileAccessibility() {
      return this._isMobileAccessibility;
    }
    createTouchHook() {
      const t = document.createElement("button");
      (t.style.width = `${ja}px`),
        (t.style.height = `${ja}px`),
        (t.style.position = "absolute"),
        (t.style.top = `${uf}px`),
        (t.style.left = `${cf}px`),
        (t.style.zIndex = df.toString()),
        (t.style.backgroundColor = "#FF0000"),
        (t.title = "select to enable accessibility for this content"),
        t.addEventListener("focus", () => {
          (this._isMobileAccessibility = !0), this.activate(), this.destroyTouchHook();
        }),
        document.body.appendChild(t),
        (this._hookDiv = t);
    }
    destroyTouchHook() {
      !this._hookDiv || (document.body.removeChild(this._hookDiv), (this._hookDiv = null));
    }
    activate() {
      var t;
      this._isActive ||
        ((this._isActive = !0),
        globalThis.document.addEventListener("mousemove", this._onMouseMove, !0),
        globalThis.removeEventListener("keydown", this._onKeyDown, !1),
        this.renderer.on("postrender", this.update, this),
        (t = this.renderer.view.parentNode) == null || t.appendChild(this.div));
    }
    deactivate() {
      var t;
      !this._isActive ||
        this._isMobileAccessibility ||
        ((this._isActive = !1),
        globalThis.document.removeEventListener("mousemove", this._onMouseMove, !0),
        globalThis.addEventListener("keydown", this._onKeyDown, !1),
        this.renderer.off("postrender", this.update),
        (t = this.div.parentNode) == null || t.removeChild(this.div));
    }
    updateAccessibleObjects(t) {
      if (!t.visible || !t.accessibleChildren) return;
      t.accessible &&
        t.interactive &&
        (t._accessibleActive || this.addChild(t), (t.renderId = this.renderId));
      const e = t.children;
      if (e) for (let r = 0; r < e.length; r++) this.updateAccessibleObjects(e[r]);
    }
    update() {
      const t = performance.now();
      if (
        (Ct.android.device && t < this.androidUpdateCount) ||
        ((this.androidUpdateCount = t + this.androidUpdateFrequency),
        !this.renderer.renderingToScreen)
      )
        return;
      this.renderer.lastObjectRendered &&
        this.updateAccessibleObjects(this.renderer.lastObjectRendered);
      const { left: e, top: r, width: s, height: n } = this.renderer.view.getBoundingClientRect(),
        { width: a, height: o, resolution: h } = this.renderer,
        l = (s / a) * h,
        u = (n / o) * h;
      let c = this.div;
      (c.style.left = `${e}px`),
        (c.style.top = `${r}px`),
        (c.style.width = `${a}px`),
        (c.style.height = `${o}px`);
      for (let d = 0; d < this.children.length; d++) {
        const f = this.children[d];
        if (f.renderId !== this.renderId)
          (f._accessibleActive = !1),
            ve(this.children, d, 1),
            this.div.removeChild(f._accessibleDiv),
            this.pool.push(f._accessibleDiv),
            (f._accessibleDiv = null),
            d--;
        else {
          c = f._accessibleDiv;
          let p = f.hitArea;
          const g = f.worldTransform;
          f.hitArea
            ? ((c.style.left = `${(g.tx + p.x * g.a) * l}px`),
              (c.style.top = `${(g.ty + p.y * g.d) * u}px`),
              (c.style.width = `${p.width * g.a * l}px`),
              (c.style.height = `${p.height * g.d * u}px`))
            : ((p = f.getBounds()),
              this.capHitArea(p),
              (c.style.left = `${p.x * l}px`),
              (c.style.top = `${p.y * u}px`),
              (c.style.width = `${p.width * l}px`),
              (c.style.height = `${p.height * u}px`),
              c.title !== f.accessibleTitle &&
                f.accessibleTitle !== null &&
                (c.title = f.accessibleTitle),
              c.getAttribute("aria-label") !== f.accessibleHint &&
                f.accessibleHint !== null &&
                c.setAttribute("aria-label", f.accessibleHint)),
            (f.accessibleTitle !== c.title || f.tabIndex !== c.tabIndex) &&
              ((c.title = f.accessibleTitle),
              (c.tabIndex = f.tabIndex),
              this.debug && this.updateDebugHTML(c));
        }
      }
      this.renderId++;
    }
    updateDebugHTML(t) {
      t.innerHTML = `type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`;
    }
    capHitArea(t) {
      t.x < 0 && ((t.width += t.x), (t.x = 0)), t.y < 0 && ((t.height += t.y), (t.y = 0));
      const { width: e, height: r } = this.renderer;
      t.x + t.width > e && (t.width = e - t.x), t.y + t.height > r && (t.height = r - t.y);
    }
    addChild(t) {
      let e = this.pool.pop();
      e ||
        ((e = document.createElement("button")),
        (e.style.width = `${tr}px`),
        (e.style.height = `${tr}px`),
        (e.style.backgroundColor = this.debug ? "rgba(255,255,255,0.5)" : "transparent"),
        (e.style.position = "absolute"),
        (e.style.zIndex = Ya.toString()),
        (e.style.borderStyle = "none"),
        navigator.userAgent.toLowerCase().includes("chrome")
          ? e.setAttribute("aria-live", "off")
          : e.setAttribute("aria-live", "polite"),
        navigator.userAgent.match(/rv:.*Gecko\//)
          ? e.setAttribute("aria-relevant", "additions")
          : e.setAttribute("aria-relevant", "text"),
        e.addEventListener("click", this._onClick.bind(this)),
        e.addEventListener("focus", this._onFocus.bind(this)),
        e.addEventListener("focusout", this._onFocusOut.bind(this))),
        (e.style.pointerEvents = t.accessiblePointerEvents),
        (e.type = t.accessibleType),
        t.accessibleTitle && t.accessibleTitle !== null
          ? (e.title = t.accessibleTitle)
          : (!t.accessibleHint || t.accessibleHint === null) &&
            (e.title = `displayObject ${t.tabIndex}`),
        t.accessibleHint &&
          t.accessibleHint !== null &&
          e.setAttribute("aria-label", t.accessibleHint),
        this.debug && this.updateDebugHTML(e),
        (t._accessibleActive = !0),
        (t._accessibleDiv = e),
        (e.displayObject = t),
        this.children.push(t),
        this.div.appendChild(t._accessibleDiv),
        (t._accessibleDiv.tabIndex = t.tabIndex);
    }
    _dispatchEvent(t, e) {
      const { displayObject: r } = t.target,
        s = this.renderer.events.rootBoundary,
        n = Object.assign(new Be(s), { target: r });
      (s.rootTarget = this.renderer.lastObjectRendered), e.forEach((a) => s.dispatchEvent(n, a));
    }
    _onClick(t) {
      this._dispatchEvent(t, ["click", "pointertap", "tap"]);
    }
    _onFocus(t) {
      t.target.getAttribute("aria-live") || t.target.setAttribute("aria-live", "assertive"),
        this._dispatchEvent(t, ["mouseover"]);
    }
    _onFocusOut(t) {
      t.target.getAttribute("aria-live") || t.target.setAttribute("aria-live", "polite"),
        this._dispatchEvent(t, ["mouseout"]);
    }
    _onKeyDown(t) {
      t.keyCode === of && this.activate();
    }
    _onMouseMove(t) {
      (t.movementX === 0 && t.movementY === 0) || this.deactivate();
    }
    destroy() {
      this.destroyTouchHook(),
        (this.div = null),
        globalThis.document.removeEventListener("mousemove", this._onMouseMove, !0),
        globalThis.removeEventListener("keydown", this._onKeyDown),
        (this.pool = null),
        (this.children = null),
        (this.renderer = null);
    }
  }
  (Hs.extension = { name: "accessibility", type: [P.RendererPlugin, P.CanvasRendererPlugin] }),
    B.add(Hs);
  const zs = class {
    constructor(i) {
      (this.stage = new vt()),
        (i = Object.assign({ forceCanvas: !1 }, i)),
        (this.renderer = Ua(i)),
        zs._plugins.forEach((t) => {
          t.init.call(this, i);
        });
    }
    render() {
      this.renderer.render(this.stage);
    }
    get view() {
      return this.renderer.view;
    }
    get screen() {
      return this.renderer.screen;
    }
    destroy(i, t) {
      const e = zs._plugins.slice(0);
      e.reverse(),
        e.forEach((r) => {
          r.destroy.call(this);
        }),
        this.stage.destroy(t),
        (this.stage = null),
        this.renderer.destroy(i),
        (this.renderer = null);
    }
  };
  let Ws = zs;
  (Ws._plugins = []), B.handleByList(P.Application, Ws._plugins);
  class Vs {
    static init(t) {
      Object.defineProperty(this, "resizeTo", {
        set(e) {
          globalThis.removeEventListener("resize", this.queueResize),
            (this._resizeTo = e),
            e && (globalThis.addEventListener("resize", this.queueResize), this.resize());
        },
        get() {
          return this._resizeTo;
        },
      }),
        (this.queueResize = () => {
          !this._resizeTo ||
            (this.cancelResize(), (this._resizeId = requestAnimationFrame(() => this.resize())));
        }),
        (this.cancelResize = () => {
          this._resizeId && (cancelAnimationFrame(this._resizeId), (this._resizeId = null));
        }),
        (this.resize = () => {
          if (!this._resizeTo) return;
          this.cancelResize();
          let e, r;
          if (this._resizeTo === globalThis.window)
            (e = globalThis.innerWidth), (r = globalThis.innerHeight);
          else {
            const { clientWidth: s, clientHeight: n } = this._resizeTo;
            (e = s), (r = n);
          }
          this.renderer.resize(e, r);
        }),
        (this._resizeId = null),
        (this._resizeTo = null),
        (this.resizeTo = t.resizeTo || null);
    }
    static destroy() {
      globalThis.removeEventListener("resize", this.queueResize),
        this.cancelResize(),
        (this.cancelResize = null),
        (this.queueResize = null),
        (this.resizeTo = null),
        (this.resize = null);
    }
  }
  (Vs.extension = P.Application), B.add(Vs);
  class ff {
    constructor(t, e = !1) {
      (this._loader = t),
        (this._assetList = []),
        (this._isLoading = !1),
        (this._maxConcurrent = 1),
        (this.verbose = e);
    }
    add(t) {
      t.forEach((e) => {
        this._assetList.push(e);
      }),
        this.verbose && console.log("[BackgroundLoader] assets: ", this._assetList),
        this._isActive && !this._isLoading && this._next();
    }
    async _next() {
      if (this._assetList.length && this._isActive) {
        this._isLoading = !0;
        const t = [],
          e = Math.min(this._assetList.length, this._maxConcurrent);
        for (let r = 0; r < e; r++) t.push(this._assetList.pop());
        await this._loader.load(t), (this._isLoading = !1), this._next();
      }
    }
    get active() {
      return this._isActive;
    }
    set active(t) {
      this._isActive !== t && ((this._isActive = t), t && !this._isLoading && this._next());
    }
  }
  const Vt = (i, t) => (
    Array.isArray(i) || (i = [i]), t ? i.map((e) => (typeof e == "string" ? t(e) : e)) : i
  );
  function qa(i, t, e, r, s) {
    const n = t[e];
    for (let a = 0; a < n.length; a++) {
      const o = n[a];
      e < t.length - 1 ? qa(i.replace(r[e], o), t, e + 1, r, s) : s.push(i.replace(r[e], o));
    }
  }
  function Ka(i) {
    const t = /\{(.*?)\}/g,
      e = i.match(t),
      r = [];
    if (e) {
      const s = [];
      e.forEach((n) => {
        const a = n.substring(1, n.length - 1).split(",");
        s.push(a);
      }),
        qa(i, s, 0, e, r);
    } else r.push(i);
    return r;
  }
  const oi = (i) => !Array.isArray(i);
  class pf {
    constructor() {
      (this._parsers = []), (this._cache = new Map()), (this._cacheMap = new Map());
    }
    reset() {
      this._cacheMap.clear(), this._cache.clear();
    }
    has(t) {
      return this._cache.has(t);
    }
    get(t) {
      return this._cache.get(t);
    }
    set(t, e) {
      const r = Vt(t);
      let s;
      for (let o = 0; o < this.parsers.length; o++) {
        const h = this.parsers[o];
        if (h.test(e)) {
          s = h.getCacheableAssets(r, e);
          break;
        }
      }
      s ||
        ((s = {}),
        r.forEach((o) => {
          s[o] = e;
        }));
      const n = Object.keys(s),
        a = { cacheKeys: n, keys: r };
      if (
        (r.forEach((o) => {
          this._cacheMap.set(o, a);
        }),
        n.forEach((o) => {
          this._cache.has(o) && this._cache.get(o), this._cache.set(o, s[o]);
        }),
        e instanceof O)
      ) {
        const o = e;
        r.forEach((h) => {
          o.baseTexture !== O.EMPTY.baseTexture && Y.addToCache(o.baseTexture, h),
            O.addToCache(o, h);
        });
      }
    }
    remove(t) {
      if ((this._cacheMap.get(t), !this._cacheMap.has(t))) return;
      const e = this._cacheMap.get(t);
      e.cacheKeys.forEach((r) => {
        this._cache.delete(r);
      }),
        e.keys.forEach((r) => {
          this._cacheMap.delete(r);
        });
    }
    get parsers() {
      return this._parsers;
    }
  }
  const Le = new pf();
  class mf {
    constructor() {
      (this._parsers = []), (this.promiseCache = {});
    }
    reset() {
      this.promiseCache = {};
    }
    _getLoadPromiseAndParser(t, e) {
      const r = { promise: null, parser: null };
      return (
        (r.promise = (async () => {
          var n, a;
          let s = null;
          for (let o = 0; o < this.parsers.length; o++) {
            const h = this.parsers[o];
            if (h.load && ((n = h.test) == null ? void 0 : n.call(h, t, e, this))) {
              (s = await h.load(t, e, this)), (r.parser = h);
              break;
            }
          }
          if (!r.parser) return null;
          for (let o = 0; o < this.parsers.length; o++) {
            const h = this.parsers[o];
            h.parse &&
              h.parse &&
              (await ((a = h.testParse) == null ? void 0 : a.call(h, s, e, this))) &&
              ((s = (await h.parse(s, e, this)) || s), (r.parser = h));
          }
          return s;
        })()),
        r
      );
    }
    async load(t, e) {
      let r = 0;
      const s = {},
        n = oi(t),
        a = Vt(t, (l) => ({ src: l })),
        o = a.length,
        h = a.map(async (l) => {
          const u = dt.toAbsolute(l.src);
          if (!s[l.src])
            try {
              this.promiseCache[u] || (this.promiseCache[u] = this._getLoadPromiseAndParser(u, l)),
                (s[l.src] = await this.promiseCache[u].promise),
                e && e(++r / o);
            } catch (c) {
              throw (
                (delete this.promiseCache[u],
                delete s[l.src],
                new Error(`[Loader.load] Failed to load ${u}.
${c}`))
              );
            }
        });
      return await Promise.all(h), n ? s[a[0].src] : s;
    }
    async unload(t) {
      const e = Vt(t, (r) => ({ src: r })).map(async (r) => {
        var a, o;
        const s = dt.toAbsolute(r.src),
          n = this.promiseCache[s];
        if (n) {
          const h = await n.promise;
          (o = (a = n.parser) == null ? void 0 : a.unload) == null || o.call(a, h, r, this),
            delete this.promiseCache[s];
        }
      });
      await Promise.all(e);
    }
    get parsers() {
      return this._parsers;
    }
  }
  class _f {
    constructor() {
      (this._assetMap = {}),
        (this._preferredOrder = []),
        (this._parsers = []),
        (this._resolverHash = {}),
        (this._bundles = {});
    }
    prefer(...t) {
      t.forEach((e) => {
        this._preferredOrder.push(e), e.priority || (e.priority = Object.keys(e.params));
      }),
        (this._resolverHash = {});
    }
    set basePath(t) {
      this._basePath = t;
    }
    get basePath() {
      return this._basePath;
    }
    set rootPath(t) {
      this._rootPath = t;
    }
    get rootPath() {
      return this._rootPath;
    }
    get parsers() {
      return this._parsers;
    }
    reset() {
      (this._preferredOrder = []),
        (this._resolverHash = {}),
        (this._assetMap = {}),
        (this._rootPath = null),
        (this._basePath = null),
        (this._manifest = null);
    }
    addManifest(t) {
      this._manifest,
        (this._manifest = t),
        t.bundles.forEach((e) => {
          this.addBundle(e.name, e.assets);
        });
    }
    addBundle(t, e) {
      const r = [];
      Array.isArray(e)
        ? e.forEach((s) => {
            typeof s.name == "string" ? r.push(s.name) : r.push(...s.name),
              this.add(s.name, s.srcs);
          })
        : Object.keys(e).forEach((s) => {
            r.push(s), this.add(s, e[s]);
          }),
        (this._bundles[t] = r);
    }
    add(t, e, r) {
      const s = Vt(t);
      s.forEach((a) => {
        this._assetMap[a];
      }),
        Array.isArray(e) || (typeof e == "string" ? (e = Ka(e)) : (e = [e]));
      const n = e.map((a) => {
        var h;
        let o = a;
        if (typeof a == "string") {
          let l = !1;
          for (let u = 0; u < this._parsers.length; u++) {
            const c = this._parsers[u];
            if (c.test(a)) {
              (o = c.parse(a)), (l = !0);
              break;
            }
          }
          l || (o = { src: a });
        }
        return (
          o.format || (o.format = o.src.split(".").pop()),
          o.alias || (o.alias = s),
          (this._basePath || this._rootPath) &&
            (o.src = dt.toAbsolute(o.src, this._basePath, this._rootPath)),
          (o.data = (h = o.data) != null ? h : r),
          o
        );
      });
      s.forEach((a) => {
        this._assetMap[a] = n;
      });
    }
    resolveBundle(t) {
      const e = oi(t);
      t = Vt(t);
      const r = {};
      return (
        t.forEach((s) => {
          const n = this._bundles[s];
          n && (r[s] = this.resolve(n));
        }),
        e ? r[t[0]] : r
      );
    }
    resolveUrl(t) {
      const e = this.resolve(t);
      if (typeof t != "string") {
        const r = {};
        for (const s in e) r[s] = e[s].src;
        return r;
      }
      return e.src;
    }
    resolve(t) {
      const e = oi(t);
      t = Vt(t);
      const r = {};
      return (
        t.forEach((s) => {
          var n;
          if (!this._resolverHash[s])
            if (this._assetMap[s]) {
              let a = this._assetMap[s];
              const o = this._getPreferredOrder(a),
                h = a[0];
              o == null ||
                o.priority.forEach((l) => {
                  o.params[l].forEach((u) => {
                    const c = a.filter((d) => (d[l] ? d[l] === u : !1));
                    c.length && (a = c);
                  });
                }),
                (this._resolverHash[s] = (n = a[0]) != null ? n : h);
            } else {
              let a = s;
              (this._basePath || this._rootPath) &&
                (a = dt.toAbsolute(a, this._basePath, this._rootPath)),
                (this._resolverHash[s] = { src: a });
            }
          r[s] = this._resolverHash[s];
        }),
        e ? r[t[0]] : r
      );
    }
    _getPreferredOrder(t) {
      for (let e = 0; e < t.length; e++) {
        const r = t[0],
          s = this._preferredOrder.find((n) => n.params.format.includes(r.format));
        if (s) return s;
      }
      return this._preferredOrder[0];
    }
  }
  class Za {
    constructor() {
      (this._detections = []),
        (this._initialized = !1),
        (this.resolver = new _f()),
        (this.loader = new mf()),
        (this.cache = Le),
        (this._backgroundLoader = new ff(this.loader)),
        (this._backgroundLoader.active = !0),
        this.reset();
    }
    async init(t = {}) {
      var n, a, o, h;
      if (this._initialized) return;
      if (
        ((this._initialized = !0), t.basePath && (this.resolver.basePath = t.basePath), t.manifest)
      ) {
        let l = t.manifest;
        typeof l == "string" && (l = await this.load(l)), this.resolver.addManifest(l);
      }
      const e = (a = (n = t.texturePreference) == null ? void 0 : n.resolution) != null ? a : 1,
        r = typeof e == "number" ? [e] : e;
      let s = [];
      if ((o = t.texturePreference) != null && o.format) {
        const l = (h = t.texturePreference) == null ? void 0 : h.format;
        s = typeof l == "string" ? [l] : l;
        for (const u of this._detections) (await u.test()) || (s = await u.remove(s));
      } else for (const l of this._detections) (await l.test()) && (s = await l.add(s));
      this.resolver.prefer({ params: { format: s, resolution: r } });
    }
    add(t, e, r) {
      this.resolver.add(t, e, r);
    }
    async load(t, e) {
      this._initialized || (await this.init());
      const r = oi(t),
        s = Vt(t).map((o) => (typeof o != "string" ? (this.resolver.add(o.src, o), o.src) : o)),
        n = this.resolver.resolve(s),
        a = await this._mapLoadToResolve(n, e);
      return r ? a[s[0]] : a;
    }
    addBundle(t, e) {
      this.resolver.addBundle(t, e);
    }
    async loadBundle(t, e) {
      this._initialized || (await this.init());
      let r = !1;
      typeof t == "string" && ((r = !0), (t = [t]));
      const s = this.resolver.resolveBundle(t),
        n = {},
        a = Object.keys(s);
      let o = 0,
        h = 0;
      const l = () => {
          e == null || e(++o / h);
        },
        u = a.map((c) => {
          const d = s[c];
          return (
            (h += Object.keys(d).length),
            this._mapLoadToResolve(d, l).then((f) => {
              n[c] = f;
            })
          );
        });
      return await Promise.all(u), r ? n[t[0]] : n;
    }
    async backgroundLoad(t) {
      this._initialized || (await this.init()), typeof t == "string" && (t = [t]);
      const e = this.resolver.resolve(t);
      this._backgroundLoader.add(Object.values(e));
    }
    async backgroundLoadBundle(t) {
      this._initialized || (await this.init()), typeof t == "string" && (t = [t]);
      const e = this.resolver.resolveBundle(t);
      Object.values(e).forEach((r) => {
        this._backgroundLoader.add(Object.values(r));
      });
    }
    reset() {
      this.resolver.reset(), this.loader.reset(), this.cache.reset(), (this._initialized = !1);
    }
    get(t) {
      if (typeof t == "string") return Le.get(t);
      const e = {};
      for (let r = 0; r < t.length; r++) e[r] = Le.get(t[r]);
      return e;
    }
    async _mapLoadToResolve(t, e) {
      const r = Object.values(t),
        s = Object.keys(t);
      this._backgroundLoader.active = !1;
      const n = await this.loader.load(r, e);
      this._backgroundLoader.active = !0;
      const a = {};
      return (
        r.forEach((o, h) => {
          const l = n[o.src],
            u = [o.src];
          o.alias && u.push(...o.alias), (a[s[h]] = l), Le.set(u, l);
        }),
        a
      );
    }
    async unload(t) {
      this._initialized || (await this.init());
      const e = Vt(t).map((s) => (typeof s != "string" ? s.src : s)),
        r = this.resolver.resolve(e);
      await this._unloadFromResolved(r);
    }
    async unloadBundle(t) {
      this._initialized || (await this.init()), (t = Vt(t));
      const e = this.resolver.resolveBundle(t),
        r = Object.keys(e).map((s) => this._unloadFromResolved(e[s]));
      await Promise.all(r);
    }
    async _unloadFromResolved(t) {
      const e = Object.values(t);
      e.forEach((r) => {
        Le.remove(r.src);
      }),
        await this.loader.unload(e);
    }
    get detections() {
      return this._detections;
    }
  }
  const hi = new Za();
  B.handleByList(P.LoadParser, hi.loader.parsers)
    .handleByList(P.ResolveParser, hi.resolver.parsers)
    .handleByList(P.CacheParser, hi.cache.parsers)
    .handleByList(P.DetectionParser, hi.detections);
  const Qa = {
    extension: P.CacheParser,
    test: (i) => Array.isArray(i) && i.every((t) => t instanceof O),
    getCacheableAssets: (i, t) => {
      const e = {};
      return (
        i.forEach((r) => {
          t.forEach((s, n) => {
            e[r + (n === 0 ? "" : n + 1)] = s;
          });
        }),
        e
      );
    },
  };
  B.add(Qa);
  var Lt = ((i) => (
    (i[(i.Low = 0)] = "Low"), (i[(i.Normal = 1)] = "Normal"), (i[(i.High = 2)] = "High"), i
  ))(Lt || {});
  const Ja = {
    extension: { type: P.LoadParser, priority: Lt.Low },
    test(i) {
      return dt.extname(i).includes(".json");
    },
    async load(i) {
      return await (await A.ADAPTER.fetch(i)).json();
    },
  };
  B.add(Ja);
  const to = {
    extension: { type: P.LoadParser, priority: Lt.Low },
    test(i) {
      return dt.extname(i).includes(".txt");
    },
    async load(i) {
      return await (await A.ADAPTER.fetch(i)).text();
    },
  };
  B.add(to);
  const gf = ["normal", "bold", "100", "200", "300", "400", "500", "600", "700", "800", "900"],
    xf = ["woff", "woff2", "ttf", "otf"];
  function eo(i) {
    const t = dt.extname(i);
    return dt
      .basename(i, t)
      .replace(/(-|_)/g, " ")
      .toLowerCase()
      .split(" ")
      .map((e) => e.charAt(0).toUpperCase() + e.slice(1))
      .join(" ");
  }
  const io = {
    extension: { type: P.LoadParser, priority: Lt.Low },
    test(i) {
      const t = i.split("?")[0].split(".").pop();
      return xf.includes(t);
    },
    async load(i, t) {
      var e, r, s, n, a, o;
      if (!window.navigator.onLine)
        throw new Error("[loadWebFont] Cannot load font - navigator is offline");
      if ("FontFace" in window) {
        const h = [],
          l = (r = (e = t.data) == null ? void 0 : e.family) != null ? r : eo(i),
          u =
            (a =
              (n = (s = t.data) == null ? void 0 : s.weights) == null
                ? void 0
                : n.filter((d) => gf.includes(d))) != null
              ? a
              : ["normal"],
          c = (o = t.data) != null ? o : {};
        for (let d = 0; d < u.length; d++) {
          const f = u[d],
            p = new FontFace(l, `url(${i})`, gn(ne({}, c), { weight: f }));
          await p.load(), document.fonts.add(p), h.push(p);
        }
        return h.length === 1 ? h[0] : h;
      }
      return null;
    },
    unload(i) {
      (Array.isArray(i) ? i : [i]).forEach((t) => document.fonts.delete(t));
    },
  };
  B.add(io);
  let ro = 0,
    Ys;
  const Tf = {
    id: "loadImageBitmap",
    code: `
    self.onmessage = function(event) {

        async function loadImageBitmap(url)
        {
            const response = await fetch(url);
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);
            return imageBitmap;
        }

        loadImageBitmap(event.data.data[0]).then(imageBitmap => {
            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }).catch(error => {
            self.postMessage({
                data: null,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        });
    }`,
  };
  let js;
  class yf {
    constructor() {
      (this._initialized = !1),
        (this._createdWorkers = 0),
        (this.workerPool = []),
        (this.queue = []),
        (this.resolveHash = {});
    }
    loadImageBitmap(t) {
      return this._run("loadImageBitmap", [t]);
    }
    async _initWorkers() {
      this._initialized || (this._initialized = !0);
    }
    getWorker() {
      Ys === void 0 && (Ys = navigator.hardwareConcurrency || 4);
      let t = this.workerPool.pop();
      return (
        !t &&
          this._createdWorkers < Ys &&
          (js ||
            (js = URL.createObjectURL(new Blob([Tf.code], { type: "application/javascript" }))),
          this._createdWorkers++,
          (t = new Worker(js)),
          t.addEventListener("message", (e) => {
            this.complete(e.data), this.returnWorker(e.target), this.next();
          })),
        t
      );
    }
    returnWorker(t) {
      this.workerPool.push(t);
    }
    complete(t) {
      const e = t.data;
      this.resolveHash[t.uuid](e), (this.resolveHash[t.uuid] = null);
    }
    _run(t, e) {
      this._initWorkers();
      const r = new Promise((s) => {
        this.queue.push({ id: t, arguments: e, resolve: s });
      });
      return this.next(), r;
    }
    next() {
      if (!this.queue.length) return;
      const t = this.getWorker();
      if (!t) return;
      const e = this.queue.pop(),
        r = e.id;
      (this.resolveHash[ro] = e.resolve), t.postMessage({ data: e.arguments, uuid: ro++, id: r });
    }
  }
  const vf = new yf();
  function er(i, t) {
    const e = i.split("?")[0],
      r = dt.extname(e).toLowerCase();
    return Array.isArray(t) ? t.includes(r.toLowerCase()) : r.toLowerCase() === t;
  }
  function li(i, t, e) {
    const r = new O(i);
    return (
      r.baseTexture.on("dispose", () => {
        delete t.promiseCache[e];
      }),
      r
    );
  }
  const qs = [".jpg", ".png", ".jpeg", ".avif", ".webp"];
  async function so(i) {
    const t = await (await A.ADAPTER.fetch(i)).blob();
    return await createImageBitmap(t);
  }
  const ir = {
    extension: { type: P.LoadParser, priority: Lt.High },
    config: { preferWorkers: !0 },
    test(i) {
      let t = !1;
      for (let e = 0; e < qs.length; e++)
        if (i.indexOf(`data:image/${qs[e].slice(1)}`) === 0) {
          t = !0;
          break;
        }
      return t || er(i, qs);
    },
    async load(i, t, e) {
      let r = null;
      window.createImageBitmap
        ? (r = this.config.preferWorkers ? await vf.loadImageBitmap(i) : await so(i))
        : (r = await new Promise((n) => {
            (r = new Image()),
              (r.crossOrigin = "anonymous"),
              (r.src = i),
              r.complete
                ? n(r)
                : (r.onload = () => {
                    n(r);
                  });
          }));
      const s = new Y(r, ne({ resolution: Qt(i) }, t.data));
      return (s.resource.src = i), li(s, e, i);
    },
    unload(i) {
      i.destroy(!0);
    },
  };
  B.add(ir);
  const bf = {
      extension: { type: P.LoadParser, priority: Lt.High },
      test(i) {
        return dt.extname(i).includes(".svg");
      },
      async testParse(i) {
        return Fe.test(i);
      },
      async parse(i, t, e) {
        var a, o, h;
        const r = new Fe(i, (a = t == null ? void 0 : t.data) == null ? void 0 : a.resourceOptions),
          s = new Y(r, ne({ resolution: Qt(i) }, t == null ? void 0 : t.data));
        s.resource.src = i;
        const n = li(s, e, i);
        return (
          ((h = (o = t == null ? void 0 : t.data) == null ? void 0 : o.resourceOptions) != null &&
            h.autoLoad) ||
            (await r.load()),
          n
        );
      },
      async load(i, t) {
        return (await A.ADAPTER.fetch(i)).text();
      },
      unload: ir.unload,
    },
    no = {
      extension: P.ResolveParser,
      test: ir.test,
      parse: (i) => {
        var t, e;
        return {
          resolution: parseFloat(
            (e = (t = A.RETINA_PREFIX.exec(i)) == null ? void 0 : t[1]) != null ? e : "1"
          ),
          format: i.split(".").pop(),
          src: i,
        };
      },
    };
  B.add(no);
  function rr(...i) {
    return async (t) => (t.push(...i), t);
  }
  function sr(...i) {
    return async (t) => {
      for (const e of i) {
        const r = t.indexOf(e);
        r !== -1 && t.splice(r, 1);
      }
      return t;
    };
  }
  const ao = {
    extension: { type: P.DetectionParser, priority: 1 },
    test: async () => {
      if (!globalThis.createImageBitmap) return !1;
      const i =
          "data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",
        t = await A.ADAPTER.fetch(i).then((e) => e.blob());
      return createImageBitmap(t).then(
        () => !0,
        () => !1
      );
    },
    add: rr("avif"),
    remove: sr("avif"),
  };
  B.add(ao);
  const oo = {
    extension: { type: P.DetectionParser, priority: 0 },
    test: async () => {
      if (!globalThis.createImageBitmap) return !1;
      const i = "data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",
        t = await A.ADAPTER.fetch(i).then((e) => e.blob());
      return createImageBitmap(t).then(
        () => !0,
        () => !1
      );
    },
    add: rr("webp"),
    remove: sr("webp"),
  };
  B.add(oo);
  const ho = {
    extension: { type: P.DetectionParser, priority: -1 },
    test: () => Promise.resolve(!0),
    add: rr("png", "jpg", "jpeg"),
    remove: sr("png", "jpg", "jpeg"),
  };
  B.add(ho);
  var yt = ((i) => (
    (i[(i.COMPRESSED_RGB_S3TC_DXT1_EXT = 33776)] = "COMPRESSED_RGB_S3TC_DXT1_EXT"),
    (i[(i.COMPRESSED_RGBA_S3TC_DXT1_EXT = 33777)] = "COMPRESSED_RGBA_S3TC_DXT1_EXT"),
    (i[(i.COMPRESSED_RGBA_S3TC_DXT3_EXT = 33778)] = "COMPRESSED_RGBA_S3TC_DXT3_EXT"),
    (i[(i.COMPRESSED_RGBA_S3TC_DXT5_EXT = 33779)] = "COMPRESSED_RGBA_S3TC_DXT5_EXT"),
    (i[(i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT = 35917)] = "COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT"),
    (i[(i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT = 35918)] = "COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT"),
    (i[(i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT = 35919)] = "COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT"),
    (i[(i.COMPRESSED_SRGB_S3TC_DXT1_EXT = 35916)] = "COMPRESSED_SRGB_S3TC_DXT1_EXT"),
    (i[(i.COMPRESSED_R11_EAC = 37488)] = "COMPRESSED_R11_EAC"),
    (i[(i.COMPRESSED_SIGNED_R11_EAC = 37489)] = "COMPRESSED_SIGNED_R11_EAC"),
    (i[(i.COMPRESSED_RG11_EAC = 37490)] = "COMPRESSED_RG11_EAC"),
    (i[(i.COMPRESSED_SIGNED_RG11_EAC = 37491)] = "COMPRESSED_SIGNED_RG11_EAC"),
    (i[(i.COMPRESSED_RGB8_ETC2 = 37492)] = "COMPRESSED_RGB8_ETC2"),
    (i[(i.COMPRESSED_RGBA8_ETC2_EAC = 37496)] = "COMPRESSED_RGBA8_ETC2_EAC"),
    (i[(i.COMPRESSED_SRGB8_ETC2 = 37493)] = "COMPRESSED_SRGB8_ETC2"),
    (i[(i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC = 37497)] = "COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"),
    (i[(i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2 = 37494)] =
      "COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2"),
    (i[(i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2 = 37495)] =
      "COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2"),
    (i[(i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG = 35840)] = "COMPRESSED_RGB_PVRTC_4BPPV1_IMG"),
    (i[(i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG = 35842)] = "COMPRESSED_RGBA_PVRTC_4BPPV1_IMG"),
    (i[(i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG = 35841)] = "COMPRESSED_RGB_PVRTC_2BPPV1_IMG"),
    (i[(i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG = 35843)] = "COMPRESSED_RGBA_PVRTC_2BPPV1_IMG"),
    (i[(i.COMPRESSED_RGB_ETC1_WEBGL = 36196)] = "COMPRESSED_RGB_ETC1_WEBGL"),
    (i[(i.COMPRESSED_RGB_ATC_WEBGL = 35986)] = "COMPRESSED_RGB_ATC_WEBGL"),
    (i[(i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL = 35986)] =
      "COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL"),
    (i[(i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL = 34798)] =
      "COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL"),
    i
  ))(yt || {});
  const ui = {
    [33776]: 0.5,
    [33777]: 0.5,
    [33778]: 1,
    [33779]: 1,
    [35916]: 0.5,
    [35917]: 0.5,
    [35918]: 1,
    [35919]: 1,
    [37488]: 0.5,
    [37489]: 0.5,
    [37490]: 1,
    [37491]: 1,
    [37492]: 0.5,
    [37496]: 1,
    [37493]: 0.5,
    [37497]: 1,
    [37494]: 0.5,
    [37495]: 0.5,
    [35840]: 0.5,
    [35842]: 0.5,
    [35841]: 0.25,
    [35843]: 0.25,
    [36196]: 0.5,
    [35986]: 0.5,
    [35986]: 1,
    [34798]: 1,
  };
  class lo extends Oe {
    constructor(t, e = { width: 1, height: 1, autoLoad: !0 }) {
      let r, s;
      typeof t == "string" ? ((r = t), (s = new Uint8Array())) : ((r = null), (s = t)),
        super(s, e),
        (this.origin = r),
        (this.buffer = s ? new Qi(s) : null),
        this.origin && e.autoLoad !== !1 && this.load(),
        s != null && s.length && ((this.loaded = !0), this.onBlobLoaded(this.buffer.rawBinaryData));
    }
    onBlobLoaded(t) {}
    async load() {
      const t = await (await (await fetch(this.origin)).blob()).arrayBuffer();
      return (
        (this.data = new Uint32Array(t)),
        (this.buffer = new Qi(t)),
        (this.loaded = !0),
        this.onBlobLoaded(t),
        this.update(),
        this
      );
    }
  }
  class ue extends lo {
    constructor(t, e) {
      super(t, e),
        (this.format = e.format),
        (this.levels = e.levels || 1),
        (this._width = e.width),
        (this._height = e.height),
        (this._extension = ue._formatToExtension(this.format)),
        (e.levelBuffers || this.buffer) &&
          (this._levelBuffers =
            e.levelBuffers ||
            ue._createLevelBuffers(
              t instanceof Uint8Array ? t : this.buffer.uint8View,
              this.format,
              this.levels,
              4,
              4,
              this.width,
              this.height
            ));
    }
    upload(t, e, r) {
      const s = t.gl;
      if (!t.context.extensions[this._extension])
        throw new Error(`${this._extension} textures are not supported on the current machine`);
      if (!this._levelBuffers) return !1;
      for (let n = 0, a = this.levels; n < a; n++) {
        const { levelID: o, levelWidth: h, levelHeight: l, levelBuffer: u } = this._levelBuffers[n];
        s.compressedTexImage2D(s.TEXTURE_2D, o, this.format, h, l, 0, u);
      }
      return !0;
    }
    onBlobLoaded() {
      this._levelBuffers = ue._createLevelBuffers(
        this.buffer.uint8View,
        this.format,
        this.levels,
        4,
        4,
        this.width,
        this.height
      );
    }
    static _formatToExtension(t) {
      if (t >= 33776 && t <= 33779) return "s3tc";
      if (t >= 37488 && t <= 37497) return "etc";
      if (t >= 35840 && t <= 35843) return "pvrtc";
      if (t >= 36196) return "etc1";
      if (t >= 35986 && t <= 34798) return "atc";
      throw new Error("Invalid (compressed) texture format given!");
    }
    static _createLevelBuffers(t, e, r, s, n, a, o) {
      const h = new Array(r);
      let l = t.byteOffset,
        u = a,
        c = o,
        d = (u + s - 1) & ~(s - 1),
        f = (c + n - 1) & ~(n - 1),
        p = d * f * ui[e];
      for (let g = 0; g < r; g++)
        (h[g] = {
          levelID: g,
          levelWidth: r > 1 ? u : d,
          levelHeight: r > 1 ? c : f,
          levelBuffer: new Uint8Array(t.buffer, l, p),
        }),
          (l += p),
          (u = u >> 1 || 1),
          (c = c >> 1 || 1),
          (d = (u + s - 1) & ~(s - 1)),
          (f = (c + n - 1) & ~(n - 1)),
          (p = d * f * ui[e]);
      return h;
    }
  }
  let ie, Ge;
  function uo() {
    Ge = {
      s3tc: ie.getExtension("WEBGL_compressed_texture_s3tc"),
      s3tc_sRGB: ie.getExtension("WEBGL_compressed_texture_s3tc_srgb"),
      etc: ie.getExtension("WEBGL_compressed_texture_etc"),
      etc1: ie.getExtension("WEBGL_compressed_texture_etc1"),
      pvrtc:
        ie.getExtension("WEBGL_compressed_texture_pvrtc") ||
        ie.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),
      atc: ie.getExtension("WEBGL_compressed_texture_atc"),
      astc: ie.getExtension("WEBGL_compressed_texture_astc"),
    };
  }
  const co = {
    extension: { type: P.DetectionParser, priority: 2 },
    test: async () => {
      const i = A.ADAPTER.createCanvas().getContext("webgl");
      return i ? ((ie = i), !0) : !1;
    },
    add: async (i) => {
      Ge || uo();
      const t = [];
      for (const e in Ge) !Ge[e] || t.push(e);
      return i.unshift(...t), i;
    },
    remove: async (i) => (Ge || uo(), i.filter((t) => !(t in Ge))),
  };
  B.add(co);
  const Ks = 4,
    nr = 124,
    Ef = 32,
    fo = 20,
    Af = 542327876,
    ar = { SIZE: 1, FLAGS: 2, HEIGHT: 3, WIDTH: 4, MIPMAP_COUNT: 7, PIXEL_FORMAT: 19 },
    Rf = {
      SIZE: 0,
      FLAGS: 1,
      FOURCC: 2,
      RGB_BITCOUNT: 3,
      R_BIT_MASK: 4,
      G_BIT_MASK: 5,
      B_BIT_MASK: 6,
      A_BIT_MASK: 7,
    },
    or = { DXGI_FORMAT: 0, RESOURCE_DIMENSION: 1, MISC_FLAG: 2, ARRAY_SIZE: 3, MISC_FLAGS2: 4 };
  var Sf = ((i) => (
      (i[(i.DXGI_FORMAT_UNKNOWN = 0)] = "DXGI_FORMAT_UNKNOWN"),
      (i[(i.DXGI_FORMAT_R32G32B32A32_TYPELESS = 1)] = "DXGI_FORMAT_R32G32B32A32_TYPELESS"),
      (i[(i.DXGI_FORMAT_R32G32B32A32_FLOAT = 2)] = "DXGI_FORMAT_R32G32B32A32_FLOAT"),
      (i[(i.DXGI_FORMAT_R32G32B32A32_UINT = 3)] = "DXGI_FORMAT_R32G32B32A32_UINT"),
      (i[(i.DXGI_FORMAT_R32G32B32A32_SINT = 4)] = "DXGI_FORMAT_R32G32B32A32_SINT"),
      (i[(i.DXGI_FORMAT_R32G32B32_TYPELESS = 5)] = "DXGI_FORMAT_R32G32B32_TYPELESS"),
      (i[(i.DXGI_FORMAT_R32G32B32_FLOAT = 6)] = "DXGI_FORMAT_R32G32B32_FLOAT"),
      (i[(i.DXGI_FORMAT_R32G32B32_UINT = 7)] = "DXGI_FORMAT_R32G32B32_UINT"),
      (i[(i.DXGI_FORMAT_R32G32B32_SINT = 8)] = "DXGI_FORMAT_R32G32B32_SINT"),
      (i[(i.DXGI_FORMAT_R16G16B16A16_TYPELESS = 9)] = "DXGI_FORMAT_R16G16B16A16_TYPELESS"),
      (i[(i.DXGI_FORMAT_R16G16B16A16_FLOAT = 10)] = "DXGI_FORMAT_R16G16B16A16_FLOAT"),
      (i[(i.DXGI_FORMAT_R16G16B16A16_UNORM = 11)] = "DXGI_FORMAT_R16G16B16A16_UNORM"),
      (i[(i.DXGI_FORMAT_R16G16B16A16_UINT = 12)] = "DXGI_FORMAT_R16G16B16A16_UINT"),
      (i[(i.DXGI_FORMAT_R16G16B16A16_SNORM = 13)] = "DXGI_FORMAT_R16G16B16A16_SNORM"),
      (i[(i.DXGI_FORMAT_R16G16B16A16_SINT = 14)] = "DXGI_FORMAT_R16G16B16A16_SINT"),
      (i[(i.DXGI_FORMAT_R32G32_TYPELESS = 15)] = "DXGI_FORMAT_R32G32_TYPELESS"),
      (i[(i.DXGI_FORMAT_R32G32_FLOAT = 16)] = "DXGI_FORMAT_R32G32_FLOAT"),
      (i[(i.DXGI_FORMAT_R32G32_UINT = 17)] = "DXGI_FORMAT_R32G32_UINT"),
      (i[(i.DXGI_FORMAT_R32G32_SINT = 18)] = "DXGI_FORMAT_R32G32_SINT"),
      (i[(i.DXGI_FORMAT_R32G8X24_TYPELESS = 19)] = "DXGI_FORMAT_R32G8X24_TYPELESS"),
      (i[(i.DXGI_FORMAT_D32_FLOAT_S8X24_UINT = 20)] = "DXGI_FORMAT_D32_FLOAT_S8X24_UINT"),
      (i[(i.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS = 21)] = "DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS"),
      (i[(i.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT = 22)] = "DXGI_FORMAT_X32_TYPELESS_G8X24_UINT"),
      (i[(i.DXGI_FORMAT_R10G10B10A2_TYPELESS = 23)] = "DXGI_FORMAT_R10G10B10A2_TYPELESS"),
      (i[(i.DXGI_FORMAT_R10G10B10A2_UNORM = 24)] = "DXGI_FORMAT_R10G10B10A2_UNORM"),
      (i[(i.DXGI_FORMAT_R10G10B10A2_UINT = 25)] = "DXGI_FORMAT_R10G10B10A2_UINT"),
      (i[(i.DXGI_FORMAT_R11G11B10_FLOAT = 26)] = "DXGI_FORMAT_R11G11B10_FLOAT"),
      (i[(i.DXGI_FORMAT_R8G8B8A8_TYPELESS = 27)] = "DXGI_FORMAT_R8G8B8A8_TYPELESS"),
      (i[(i.DXGI_FORMAT_R8G8B8A8_UNORM = 28)] = "DXGI_FORMAT_R8G8B8A8_UNORM"),
      (i[(i.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB = 29)] = "DXGI_FORMAT_R8G8B8A8_UNORM_SRGB"),
      (i[(i.DXGI_FORMAT_R8G8B8A8_UINT = 30)] = "DXGI_FORMAT_R8G8B8A8_UINT"),
      (i[(i.DXGI_FORMAT_R8G8B8A8_SNORM = 31)] = "DXGI_FORMAT_R8G8B8A8_SNORM"),
      (i[(i.DXGI_FORMAT_R8G8B8A8_SINT = 32)] = "DXGI_FORMAT_R8G8B8A8_SINT"),
      (i[(i.DXGI_FORMAT_R16G16_TYPELESS = 33)] = "DXGI_FORMAT_R16G16_TYPELESS"),
      (i[(i.DXGI_FORMAT_R16G16_FLOAT = 34)] = "DXGI_FORMAT_R16G16_FLOAT"),
      (i[(i.DXGI_FORMAT_R16G16_UNORM = 35)] = "DXGI_FORMAT_R16G16_UNORM"),
      (i[(i.DXGI_FORMAT_R16G16_UINT = 36)] = "DXGI_FORMAT_R16G16_UINT"),
      (i[(i.DXGI_FORMAT_R16G16_SNORM = 37)] = "DXGI_FORMAT_R16G16_SNORM"),
      (i[(i.DXGI_FORMAT_R16G16_SINT = 38)] = "DXGI_FORMAT_R16G16_SINT"),
      (i[(i.DXGI_FORMAT_R32_TYPELESS = 39)] = "DXGI_FORMAT_R32_TYPELESS"),
      (i[(i.DXGI_FORMAT_D32_FLOAT = 40)] = "DXGI_FORMAT_D32_FLOAT"),
      (i[(i.DXGI_FORMAT_R32_FLOAT = 41)] = "DXGI_FORMAT_R32_FLOAT"),
      (i[(i.DXGI_FORMAT_R32_UINT = 42)] = "DXGI_FORMAT_R32_UINT"),
      (i[(i.DXGI_FORMAT_R32_SINT = 43)] = "DXGI_FORMAT_R32_SINT"),
      (i[(i.DXGI_FORMAT_R24G8_TYPELESS = 44)] = "DXGI_FORMAT_R24G8_TYPELESS"),
      (i[(i.DXGI_FORMAT_D24_UNORM_S8_UINT = 45)] = "DXGI_FORMAT_D24_UNORM_S8_UINT"),
      (i[(i.DXGI_FORMAT_R24_UNORM_X8_TYPELESS = 46)] = "DXGI_FORMAT_R24_UNORM_X8_TYPELESS"),
      (i[(i.DXGI_FORMAT_X24_TYPELESS_G8_UINT = 47)] = "DXGI_FORMAT_X24_TYPELESS_G8_UINT"),
      (i[(i.DXGI_FORMAT_R8G8_TYPELESS = 48)] = "DXGI_FORMAT_R8G8_TYPELESS"),
      (i[(i.DXGI_FORMAT_R8G8_UNORM = 49)] = "DXGI_FORMAT_R8G8_UNORM"),
      (i[(i.DXGI_FORMAT_R8G8_UINT = 50)] = "DXGI_FORMAT_R8G8_UINT"),
      (i[(i.DXGI_FORMAT_R8G8_SNORM = 51)] = "DXGI_FORMAT_R8G8_SNORM"),
      (i[(i.DXGI_FORMAT_R8G8_SINT = 52)] = "DXGI_FORMAT_R8G8_SINT"),
      (i[(i.DXGI_FORMAT_R16_TYPELESS = 53)] = "DXGI_FORMAT_R16_TYPELESS"),
      (i[(i.DXGI_FORMAT_R16_FLOAT = 54)] = "DXGI_FORMAT_R16_FLOAT"),
      (i[(i.DXGI_FORMAT_D16_UNORM = 55)] = "DXGI_FORMAT_D16_UNORM"),
      (i[(i.DXGI_FORMAT_R16_UNORM = 56)] = "DXGI_FORMAT_R16_UNORM"),
      (i[(i.DXGI_FORMAT_R16_UINT = 57)] = "DXGI_FORMAT_R16_UINT"),
      (i[(i.DXGI_FORMAT_R16_SNORM = 58)] = "DXGI_FORMAT_R16_SNORM"),
      (i[(i.DXGI_FORMAT_R16_SINT = 59)] = "DXGI_FORMAT_R16_SINT"),
      (i[(i.DXGI_FORMAT_R8_TYPELESS = 60)] = "DXGI_FORMAT_R8_TYPELESS"),
      (i[(i.DXGI_FORMAT_R8_UNORM = 61)] = "DXGI_FORMAT_R8_UNORM"),
      (i[(i.DXGI_FORMAT_R8_UINT = 62)] = "DXGI_FORMAT_R8_UINT"),
      (i[(i.DXGI_FORMAT_R8_SNORM = 63)] = "DXGI_FORMAT_R8_SNORM"),
      (i[(i.DXGI_FORMAT_R8_SINT = 64)] = "DXGI_FORMAT_R8_SINT"),
      (i[(i.DXGI_FORMAT_A8_UNORM = 65)] = "DXGI_FORMAT_A8_UNORM"),
      (i[(i.DXGI_FORMAT_R1_UNORM = 66)] = "DXGI_FORMAT_R1_UNORM"),
      (i[(i.DXGI_FORMAT_R9G9B9E5_SHAREDEXP = 67)] = "DXGI_FORMAT_R9G9B9E5_SHAREDEXP"),
      (i[(i.DXGI_FORMAT_R8G8_B8G8_UNORM = 68)] = "DXGI_FORMAT_R8G8_B8G8_UNORM"),
      (i[(i.DXGI_FORMAT_G8R8_G8B8_UNORM = 69)] = "DXGI_FORMAT_G8R8_G8B8_UNORM"),
      (i[(i.DXGI_FORMAT_BC1_TYPELESS = 70)] = "DXGI_FORMAT_BC1_TYPELESS"),
      (i[(i.DXGI_FORMAT_BC1_UNORM = 71)] = "DXGI_FORMAT_BC1_UNORM"),
      (i[(i.DXGI_FORMAT_BC1_UNORM_SRGB = 72)] = "DXGI_FORMAT_BC1_UNORM_SRGB"),
      (i[(i.DXGI_FORMAT_BC2_TYPELESS = 73)] = "DXGI_FORMAT_BC2_TYPELESS"),
      (i[(i.DXGI_FORMAT_BC2_UNORM = 74)] = "DXGI_FORMAT_BC2_UNORM"),
      (i[(i.DXGI_FORMAT_BC2_UNORM_SRGB = 75)] = "DXGI_FORMAT_BC2_UNORM_SRGB"),
      (i[(i.DXGI_FORMAT_BC3_TYPELESS = 76)] = "DXGI_FORMAT_BC3_TYPELESS"),
      (i[(i.DXGI_FORMAT_BC3_UNORM = 77)] = "DXGI_FORMAT_BC3_UNORM"),
      (i[(i.DXGI_FORMAT_BC3_UNORM_SRGB = 78)] = "DXGI_FORMAT_BC3_UNORM_SRGB"),
      (i[(i.DXGI_FORMAT_BC4_TYPELESS = 79)] = "DXGI_FORMAT_BC4_TYPELESS"),
      (i[(i.DXGI_FORMAT_BC4_UNORM = 80)] = "DXGI_FORMAT_BC4_UNORM"),
      (i[(i.DXGI_FORMAT_BC4_SNORM = 81)] = "DXGI_FORMAT_BC4_SNORM"),
      (i[(i.DXGI_FORMAT_BC5_TYPELESS = 82)] = "DXGI_FORMAT_BC5_TYPELESS"),
      (i[(i.DXGI_FORMAT_BC5_UNORM = 83)] = "DXGI_FORMAT_BC5_UNORM"),
      (i[(i.DXGI_FORMAT_BC5_SNORM = 84)] = "DXGI_FORMAT_BC5_SNORM"),
      (i[(i.DXGI_FORMAT_B5G6R5_UNORM = 85)] = "DXGI_FORMAT_B5G6R5_UNORM"),
      (i[(i.DXGI_FORMAT_B5G5R5A1_UNORM = 86)] = "DXGI_FORMAT_B5G5R5A1_UNORM"),
      (i[(i.DXGI_FORMAT_B8G8R8A8_UNORM = 87)] = "DXGI_FORMAT_B8G8R8A8_UNORM"),
      (i[(i.DXGI_FORMAT_B8G8R8X8_UNORM = 88)] = "DXGI_FORMAT_B8G8R8X8_UNORM"),
      (i[(i.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM = 89)] =
        "DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM"),
      (i[(i.DXGI_FORMAT_B8G8R8A8_TYPELESS = 90)] = "DXGI_FORMAT_B8G8R8A8_TYPELESS"),
      (i[(i.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB = 91)] = "DXGI_FORMAT_B8G8R8A8_UNORM_SRGB"),
      (i[(i.DXGI_FORMAT_B8G8R8X8_TYPELESS = 92)] = "DXGI_FORMAT_B8G8R8X8_TYPELESS"),
      (i[(i.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB = 93)] = "DXGI_FORMAT_B8G8R8X8_UNORM_SRGB"),
      (i[(i.DXGI_FORMAT_BC6H_TYPELESS = 94)] = "DXGI_FORMAT_BC6H_TYPELESS"),
      (i[(i.DXGI_FORMAT_BC6H_UF16 = 95)] = "DXGI_FORMAT_BC6H_UF16"),
      (i[(i.DXGI_FORMAT_BC6H_SF16 = 96)] = "DXGI_FORMAT_BC6H_SF16"),
      (i[(i.DXGI_FORMAT_BC7_TYPELESS = 97)] = "DXGI_FORMAT_BC7_TYPELESS"),
      (i[(i.DXGI_FORMAT_BC7_UNORM = 98)] = "DXGI_FORMAT_BC7_UNORM"),
      (i[(i.DXGI_FORMAT_BC7_UNORM_SRGB = 99)] = "DXGI_FORMAT_BC7_UNORM_SRGB"),
      (i[(i.DXGI_FORMAT_AYUV = 100)] = "DXGI_FORMAT_AYUV"),
      (i[(i.DXGI_FORMAT_Y410 = 101)] = "DXGI_FORMAT_Y410"),
      (i[(i.DXGI_FORMAT_Y416 = 102)] = "DXGI_FORMAT_Y416"),
      (i[(i.DXGI_FORMAT_NV12 = 103)] = "DXGI_FORMAT_NV12"),
      (i[(i.DXGI_FORMAT_P010 = 104)] = "DXGI_FORMAT_P010"),
      (i[(i.DXGI_FORMAT_P016 = 105)] = "DXGI_FORMAT_P016"),
      (i[(i.DXGI_FORMAT_420_OPAQUE = 106)] = "DXGI_FORMAT_420_OPAQUE"),
      (i[(i.DXGI_FORMAT_YUY2 = 107)] = "DXGI_FORMAT_YUY2"),
      (i[(i.DXGI_FORMAT_Y210 = 108)] = "DXGI_FORMAT_Y210"),
      (i[(i.DXGI_FORMAT_Y216 = 109)] = "DXGI_FORMAT_Y216"),
      (i[(i.DXGI_FORMAT_NV11 = 110)] = "DXGI_FORMAT_NV11"),
      (i[(i.DXGI_FORMAT_AI44 = 111)] = "DXGI_FORMAT_AI44"),
      (i[(i.DXGI_FORMAT_IA44 = 112)] = "DXGI_FORMAT_IA44"),
      (i[(i.DXGI_FORMAT_P8 = 113)] = "DXGI_FORMAT_P8"),
      (i[(i.DXGI_FORMAT_A8P8 = 114)] = "DXGI_FORMAT_A8P8"),
      (i[(i.DXGI_FORMAT_B4G4R4A4_UNORM = 115)] = "DXGI_FORMAT_B4G4R4A4_UNORM"),
      (i[(i.DXGI_FORMAT_P208 = 116)] = "DXGI_FORMAT_P208"),
      (i[(i.DXGI_FORMAT_V208 = 117)] = "DXGI_FORMAT_V208"),
      (i[(i.DXGI_FORMAT_V408 = 118)] = "DXGI_FORMAT_V408"),
      (i[(i.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE = 119)] =
        "DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE"),
      (i[(i.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE = 120)] =
        "DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE"),
      (i[(i.DXGI_FORMAT_FORCE_UINT = 121)] = "DXGI_FORMAT_FORCE_UINT"),
      i
    ))(Sf || {}),
    If = ((i) => (
      (i[(i.DDS_DIMENSION_TEXTURE1D = 2)] = "DDS_DIMENSION_TEXTURE1D"),
      (i[(i.DDS_DIMENSION_TEXTURE2D = 3)] = "DDS_DIMENSION_TEXTURE2D"),
      (i[(i.DDS_DIMENSION_TEXTURE3D = 6)] = "DDS_DIMENSION_TEXTURE3D"),
      i
    ))(If || {});
  const wf = 1,
    Mf = 2,
    Cf = 4,
    Df = 64,
    Pf = 512,
    Of = 131072,
    Ff = 827611204,
    Nf = 861165636,
    Bf = 894720068,
    Lf = 808540228,
    Gf = 4,
    Uf = {
      [Ff]: yt.COMPRESSED_RGBA_S3TC_DXT1_EXT,
      [Nf]: yt.COMPRESSED_RGBA_S3TC_DXT3_EXT,
      [Bf]: yt.COMPRESSED_RGBA_S3TC_DXT5_EXT,
    },
    kf = {
      [70]: yt.COMPRESSED_RGBA_S3TC_DXT1_EXT,
      [71]: yt.COMPRESSED_RGBA_S3TC_DXT1_EXT,
      [73]: yt.COMPRESSED_RGBA_S3TC_DXT3_EXT,
      [74]: yt.COMPRESSED_RGBA_S3TC_DXT3_EXT,
      [76]: yt.COMPRESSED_RGBA_S3TC_DXT5_EXT,
      [77]: yt.COMPRESSED_RGBA_S3TC_DXT5_EXT,
      [72]: yt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,
      [75]: yt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,
      [78]: yt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,
    };
  function po(i) {
    const t = new Uint32Array(i);
    if (t[0] !== Af) throw new Error("Invalid DDS file magic word");
    const e = new Uint32Array(i, 0, nr / Uint32Array.BYTES_PER_ELEMENT),
      r = e[ar.HEIGHT],
      s = e[ar.WIDTH],
      n = e[ar.MIPMAP_COUNT],
      a = new Uint32Array(
        i,
        ar.PIXEL_FORMAT * Uint32Array.BYTES_PER_ELEMENT,
        Ef / Uint32Array.BYTES_PER_ELEMENT
      ),
      o = a[wf];
    if (o & Cf) {
      const h = a[Rf.FOURCC];
      if (h !== Lf) {
        const v = Uf[h],
          x = Ks + nr,
          y = new Uint8Array(i, x);
        return [new ue(y, { format: v, width: s, height: r, levels: n })];
      }
      const l = Ks + nr,
        u = new Uint32Array(t.buffer, l, fo / Uint32Array.BYTES_PER_ELEMENT),
        c = u[or.DXGI_FORMAT],
        d = u[or.RESOURCE_DIMENSION],
        f = u[or.MISC_FLAG],
        p = u[or.ARRAY_SIZE],
        g = kf[c];
      if (g === void 0)
        throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);
      if (f === Gf) throw new Error("DDSParser does not support cubemap textures");
      if (d === 6) throw new Error("DDSParser does not supported 3D texture data");
      const _ = new Array(),
        T = Ks + nr + fo;
      if (p === 1) _.push(new Uint8Array(i, T));
      else {
        const v = ui[g];
        let x = 0,
          y = s,
          E = r;
        for (let I = 0; I < n; I++) {
          const R = Math.max(1, (y + 3) & -4),
            U = Math.max(1, (E + 3) & -4);
          (x += R * U * v), (y = y >>> 1), (E = E >>> 1);
        }
        let D = T;
        for (let I = 0; I < p; I++) _.push(new Uint8Array(i, D, x)), (D += x);
      }
      return _.map((v) => new ue(v, { format: g, width: s, height: r, levels: n }));
    }
    throw o & Df
      ? new Error("DDSParser does not support uncompressed texture data.")
      : o & Pf
      ? new Error("DDSParser does not supported YUV uncompressed texture data.")
      : o & Of
      ? new Error("DDSParser does not support single-channel (lumninance) texture data!")
      : o & Mf
      ? new Error("DDSParser does not support single-channel (alpha) texture data!")
      : new Error("DDSParser failed to load a texture file due to an unknown reason!");
  }
  const mo = [171, 75, 84, 88, 32, 49, 49, 187, 13, 10, 26, 10],
    Xf = 67305985,
    Gt = {
      FILE_IDENTIFIER: 0,
      ENDIANNESS: 12,
      GL_TYPE: 16,
      GL_TYPE_SIZE: 20,
      GL_FORMAT: 24,
      GL_INTERNAL_FORMAT: 28,
      GL_BASE_INTERNAL_FORMAT: 32,
      PIXEL_WIDTH: 36,
      PIXEL_HEIGHT: 40,
      PIXEL_DEPTH: 44,
      NUMBER_OF_ARRAY_ELEMENTS: 48,
      NUMBER_OF_FACES: 52,
      NUMBER_OF_MIPMAP_LEVELS: 56,
      BYTES_OF_KEY_VALUE_DATA: 60,
    },
    Zs = 64,
    Qs = {
      [L.UNSIGNED_BYTE]: 1,
      [L.UNSIGNED_SHORT]: 2,
      [L.INT]: 4,
      [L.UNSIGNED_INT]: 4,
      [L.FLOAT]: 4,
      [L.HALF_FLOAT]: 8,
    },
    _o = {
      [S.RGBA]: 4,
      [S.RGB]: 3,
      [S.RG]: 2,
      [S.RED]: 1,
      [S.LUMINANCE]: 1,
      [S.LUMINANCE_ALPHA]: 2,
      [S.ALPHA]: 1,
    },
    go = {
      [L.UNSIGNED_SHORT_4_4_4_4]: 2,
      [L.UNSIGNED_SHORT_5_5_5_1]: 2,
      [L.UNSIGNED_SHORT_5_6_5]: 2,
    };
  function xo(i, t, e = !1) {
    const r = new DataView(t);
    if (!$f(i, r)) return null;
    const s = r.getUint32(Gt.ENDIANNESS, !0) === Xf,
      n = r.getUint32(Gt.GL_TYPE, s),
      a = r.getUint32(Gt.GL_FORMAT, s),
      o = r.getUint32(Gt.GL_INTERNAL_FORMAT, s),
      h = r.getUint32(Gt.PIXEL_WIDTH, s),
      l = r.getUint32(Gt.PIXEL_HEIGHT, s) || 1,
      u = r.getUint32(Gt.PIXEL_DEPTH, s) || 1,
      c = r.getUint32(Gt.NUMBER_OF_ARRAY_ELEMENTS, s) || 1,
      d = r.getUint32(Gt.NUMBER_OF_FACES, s),
      f = r.getUint32(Gt.NUMBER_OF_MIPMAP_LEVELS, s),
      p = r.getUint32(Gt.BYTES_OF_KEY_VALUE_DATA, s);
    if (l === 0 || u !== 1) throw new Error("Only 2D textures are supported");
    if (d !== 1) throw new Error("CubeTextures are not supported by KTXLoader yet!");
    if (c !== 1) throw new Error("WebGL does not support array textures");
    const g = 4,
      _ = 4,
      T = (h + 3) & -4,
      v = (l + 3) & -4,
      x = new Array(c);
    let y = h * l;
    n === 0 && (y = T * v);
    let E;
    if ((n !== 0 ? (Qs[n] ? (E = Qs[n] * _o[a]) : (E = go[n])) : (E = ui[o]), E === void 0))
      throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");
    const D = e ? zf(r, p, s) : null;
    let I = y * E,
      R = h,
      U = l,
      w = T,
      C = v,
      H = Zs + p;
    for (let b = 0; b < f; b++) {
      const M = r.getUint32(H, s);
      let q = H + 4;
      for (let k = 0; k < c; k++) {
        let X = x[k];
        X || (X = x[k] = new Array(f)),
          (X[b] = {
            levelID: b,
            levelWidth: f > 1 || n !== 0 ? R : w,
            levelHeight: f > 1 || n !== 0 ? U : C,
            levelBuffer: new Uint8Array(t, q, I),
          }),
          (q += I);
      }
      (H += M + 4),
        (H = H % 4 !== 0 ? H + 4 - (H % 4) : H),
        (R = R >> 1 || 1),
        (U = U >> 1 || 1),
        (w = (R + g - 1) & ~(g - 1)),
        (C = (U + _ - 1) & ~(_ - 1)),
        (I = w * C * E);
    }
    return n !== 0
      ? {
          uncompressed: x.map((b) => {
            let M = b[0].levelBuffer,
              q = !1;
            return (
              n === L.FLOAT
                ? (M = new Float32Array(
                    b[0].levelBuffer.buffer,
                    b[0].levelBuffer.byteOffset,
                    b[0].levelBuffer.byteLength / 4
                  ))
                : n === L.UNSIGNED_INT
                ? ((q = !0),
                  (M = new Uint32Array(
                    b[0].levelBuffer.buffer,
                    b[0].levelBuffer.byteOffset,
                    b[0].levelBuffer.byteLength / 4
                  )))
                : n === L.INT &&
                  ((q = !0),
                  (M = new Int32Array(
                    b[0].levelBuffer.buffer,
                    b[0].levelBuffer.byteOffset,
                    b[0].levelBuffer.byteLength / 4
                  ))),
              {
                resource: new Oe(M, { width: b[0].levelWidth, height: b[0].levelHeight }),
                type: n,
                format: q ? Hf(a) : a,
              }
            );
          }),
          kvData: D,
        }
      : {
          compressed: x.map(
            (b) => new ue(null, { format: o, width: h, height: l, levels: f, levelBuffers: b })
          ),
          kvData: D,
        };
  }
  function $f(i, t) {
    for (let e = 0; e < mo.length; e++) if (t.getUint8(e) !== mo[e]) return !1;
    return !0;
  }
  function Hf(i) {
    switch (i) {
      case S.RGBA:
        return S.RGBA_INTEGER;
      case S.RGB:
        return S.RGB_INTEGER;
      case S.RG:
        return S.RG_INTEGER;
      case S.RED:
        return S.RED_INTEGER;
      default:
        return i;
    }
  }
  function zf(i, t, e) {
    const r = new Map();
    let s = 0;
    for (; s < t; ) {
      const n = i.getUint32(Zs + s, e),
        a = Zs + s + 4,
        o = 3 - ((n + 3) % 4);
      if (n === 0 || n > t - s) {
        console.error("KTXLoader: keyAndValueByteSize out of bounds");
        break;
      }
      let h = 0;
      for (; h < n && i.getUint8(a + h) !== 0; h++);
      if (h === -1) {
        console.error("KTXLoader: Failed to find null byte terminating kvData key");
        break;
      }
      const l = new TextDecoder().decode(new Uint8Array(i.buffer, a, h)),
        u = new DataView(i.buffer, a + h + 1, n - h - 1);
      r.set(l, u), (s += 4 + n + o);
    }
    return r;
  }
  const To = {
    extension: { type: P.LoadParser, priority: Lt.High },
    test(i) {
      return er(i, ".dds");
    },
    async load(i, t, e) {
      const r = await (await A.ADAPTER.fetch(i)).arrayBuffer(),
        s = po(r).map((n) => {
          const a = new Y(
            n,
            ne({ mipmap: Kt.OFF, alphaMode: Pt.NO_PREMULTIPLIED_ALPHA, resolution: Qt(i) }, t.data)
          );
          return li(a, e, i);
        });
      return s.length === 1 ? s[0] : s;
    },
    unload(i) {
      Array.isArray(i) ? i.forEach((t) => t.destroy(!0)) : i.destroy(!0);
    },
  };
  B.add(To);
  const yo = {
    extension: { type: P.LoadParser, priority: Lt.High },
    test(i) {
      return er(i, ".ktx");
    },
    async load(i, t, e) {
      const r = await (await A.ADAPTER.fetch(i)).arrayBuffer(),
        { compressed: s, uncompressed: n, kvData: a } = xo(i, r),
        o = s != null ? s : n,
        h = ne({ mipmap: Kt.OFF, alphaMode: Pt.NO_PREMULTIPLIED_ALPHA, resolution: Qt(i) }, t.data),
        l = o.map((u) => {
          o === n && Object.assign(h, { type: u.type, format: u.format });
          const c = new Y(u, h);
          return (c.ktxKeyValueData = a), li(c, e, i);
        });
      return l.length === 1 ? l[0] : l;
    },
    unload(i) {
      Array.isArray(i) ? i.forEach((t) => t.destroy(!0)) : i.destroy(!0);
    },
  };
  B.add(yo);
  const vo = {
    extension: P.ResolveParser,
    test: (i) => {
      const t = i.split("?")[0].split(".").pop();
      return ["basis", "ktx", "dds"].includes(t);
    },
    parse: (i) => {
      var t, e, r, s;
      if (i.split("?")[0].split(".").pop() === "ktx") {
        const n = [
          ".s3tc.ktx",
          ".s3tc_sRGB.ktx",
          ".etc.ktx",
          ".etc1.ktx",
          ".pvrt.ktx",
          ".atc.ktx",
          ".astc.ktx",
        ];
        if (n.some((a) => i.endsWith(a)))
          return {
            resolution: parseFloat(
              (e = (t = A.RETINA_PREFIX.exec(i)) == null ? void 0 : t[1]) != null ? e : "1"
            ),
            format: n.find((a) => i.endsWith(a)),
            src: i,
          };
      }
      return {
        resolution: parseFloat(
          (s = (r = A.RETINA_PREFIX.exec(i)) == null ? void 0 : r[1]) != null ? s : "1"
        ),
        format: i.split(".").pop(),
        src: i,
      };
    },
  };
  B.add(vo);
  const bo = new z(),
    Eo = 4,
    Js = class {
      constructor(i) {
        this.renderer = i;
      }
      image(i, t, e) {
        const r = new Image();
        return (r.src = this.base64(i, t, e)), r;
      }
      base64(i, t, e) {
        return this.canvas(i).toDataURL(t, e);
      }
      canvas(i, t) {
        const e = this.renderer;
        let r,
          s = !1,
          n,
          a = !1;
        i && (i instanceof te ? (n = i) : ((n = this.renderer.generateTexture(i)), (a = !0))),
          n
            ? ((r = n.baseTexture.resolution),
              (t = t != null ? t : n.frame),
              (s = !1),
              e.renderTexture.bind(n))
            : ((r = e.resolution),
              t || ((t = bo), (t.width = e.width), (t.height = e.height)),
              (s = !0),
              e.renderTexture.bind(null));
        const o = Math.round(t.width * r),
          h = Math.round(t.height * r);
        let l = new jr(o, h, 1);
        const u = new Uint8Array(Eo * o * h),
          c = e.gl;
        c.readPixels(Math.round(t.x * r), Math.round(t.y * r), o, h, c.RGBA, c.UNSIGNED_BYTE, u);
        const d = l.context.getImageData(0, 0, o, h);
        if ((Js.arrayPostDivide(u, d.data), l.context.putImageData(d, 0, 0), s)) {
          const f = new jr(l.width, l.height, 1);
          f.context.scale(1, -1), f.context.drawImage(l.canvas, 0, -h), l.destroy(), (l = f);
        }
        return a && n.destroy(!0), l.canvas;
      }
      pixels(i, t) {
        const e = this.renderer;
        let r,
          s,
          n = !1;
        i && (i instanceof te ? (s = i) : ((s = this.renderer.generateTexture(i)), (n = !0))),
          s
            ? ((r = s.baseTexture.resolution),
              (t = t != null ? t : s.frame),
              e.renderTexture.bind(s))
            : ((r = e.resolution),
              t || ((t = bo), (t.width = e.width), (t.height = e.height)),
              e.renderTexture.bind(null));
        const a = Math.round(t.width * r),
          o = Math.round(t.height * r),
          h = new Uint8Array(Eo * a * o),
          l = e.gl;
        return (
          l.readPixels(Math.round(t.x * r), Math.round(t.y * r), a, o, l.RGBA, l.UNSIGNED_BYTE, h),
          n && s.destroy(!0),
          Js.arrayPostDivide(h, h),
          h
        );
      }
      destroy() {
        this.renderer = null;
      }
      static arrayPostDivide(i, t) {
        for (let e = 0; e < i.length; e += 4) {
          const r = (t[e + 3] = i[e + 3]);
          r !== 0
            ? ((t[e] = Math.round(Math.min((i[e] * 255) / r, 255))),
              (t[e + 1] = Math.round(Math.min((i[e + 1] * 255) / r, 255))),
              (t[e + 2] = Math.round(Math.min((i[e + 2] * 255) / r, 255))))
            : ((t[e] = i[e]), (t[e + 1] = i[e + 1]), (t[e + 2] = i[e + 2]));
        }
      }
    };
  let tn = Js;
  (tn.extension = { name: "extract", type: P.RendererSystem }), B.add(tn);
  var ce = ((i) => ((i.MITER = "miter"), (i.BEVEL = "bevel"), (i.ROUND = "round"), i))(ce || {}),
    de = ((i) => ((i.BUTT = "butt"), (i.ROUND = "round"), (i.SQUARE = "square"), i))(de || {});
  const Ue = {
    adaptive: !0,
    maxLength: 10,
    minSegments: 8,
    maxSegments: 2048,
    epsilon: 1e-4,
    _segmentsCount(i, t = 20) {
      if (!this.adaptive || !i || isNaN(i)) return t;
      let e = Math.ceil(i / this.maxLength);
      return (
        e < this.minSegments
          ? (e = this.minSegments)
          : e > this.maxSegments && (e = this.maxSegments),
        e
      );
    },
  };
  class ci {
    constructor() {
      (this.color = 16777215),
        (this.alpha = 1),
        (this.texture = O.WHITE),
        (this.matrix = null),
        (this.visible = !1),
        this.reset();
    }
    clone() {
      const t = new ci();
      return (
        (t.color = this.color),
        (t.alpha = this.alpha),
        (t.texture = this.texture),
        (t.matrix = this.matrix),
        (t.visible = this.visible),
        t
      );
    }
    reset() {
      (this.color = 16777215),
        (this.alpha = 1),
        (this.texture = O.WHITE),
        (this.matrix = null),
        (this.visible = !1);
    }
    destroy() {
      (this.texture = null), (this.matrix = null);
    }
  }
  function Ao(i, t = !1) {
    const e = i.length;
    if (e < 6) return;
    let r = 0;
    for (let s = 0, n = i[e - 2], a = i[e - 1]; s < e; s += 2) {
      const o = i[s],
        h = i[s + 1];
      (r += (o - n) * (h + a)), (n = o), (a = h);
    }
    if ((!t && r > 0) || (t && r <= 0)) {
      const s = e / 2;
      for (let n = s + (s % 2); n < e; n += 2) {
        const a = e - n - 2,
          o = e - n - 1,
          h = n,
          l = n + 1;
        ([i[a], i[h]] = [i[h], i[a]]), ([i[o], i[l]] = [i[l], i[o]]);
      }
    }
  }
  const en = {
      build(i) {
        i.points = i.shape.points.slice();
      },
      triangulate(i, t) {
        let e = i.points;
        const r = i.holes,
          s = t.points,
          n = t.indices;
        if (e.length >= 6) {
          Ao(e, !1);
          const a = [];
          for (let l = 0; l < r.length; l++) {
            const u = r[l];
            Ao(u.points, !0), a.push(e.length / 2), (e = e.concat(u.points));
          }
          const o = Dr(e, a, 2);
          if (!o) return;
          const h = s.length / 2;
          for (let l = 0; l < o.length; l += 3)
            n.push(o[l] + h), n.push(o[l + 1] + h), n.push(o[l + 2] + h);
          for (let l = 0; l < e.length; l++) s.push(e[l]);
        }
      },
    },
    di = {
      build(i) {
        const t = i.points;
        let e, r, s, n, a, o;
        if (i.type === ct.CIRC) {
          const p = i.shape;
          (e = p.x), (r = p.y), (a = o = p.radius), (s = n = 0);
        } else if (i.type === ct.ELIP) {
          const p = i.shape;
          (e = p.x), (r = p.y), (a = p.width), (o = p.height), (s = n = 0);
        } else {
          const p = i.shape,
            g = p.width / 2,
            _ = p.height / 2;
          (e = p.x + g),
            (r = p.y + _),
            (a = o = Math.max(0, Math.min(p.radius, Math.min(g, _)))),
            (s = g - a),
            (n = _ - o);
        }
        if (!(a >= 0 && o >= 0 && s >= 0 && n >= 0)) {
          t.length = 0;
          return;
        }
        const h = Math.ceil(2.3 * Math.sqrt(a + o)),
          l = h * 8 + (s ? 4 : 0) + (n ? 4 : 0);
        if (((t.length = l), l === 0)) return;
        if (h === 0) {
          (t.length = 8),
            (t[0] = t[6] = e + s),
            (t[1] = t[3] = r + n),
            (t[2] = t[4] = e - s),
            (t[5] = t[7] = r - n);
          return;
        }
        let u = 0,
          c = h * 4 + (s ? 2 : 0) + 2,
          d = c,
          f = l;
        {
          const p = s + a,
            g = n,
            _ = e + p,
            T = e - p,
            v = r + g;
          if (((t[u++] = _), (t[u++] = v), (t[--c] = v), (t[--c] = T), n)) {
            const x = r - g;
            (t[d++] = T), (t[d++] = x), (t[--f] = x), (t[--f] = _);
          }
        }
        for (let p = 1; p < h; p++) {
          const g = (Math.PI / 2) * (p / h),
            _ = s + Math.cos(g) * a,
            T = n + Math.sin(g) * o,
            v = e + _,
            x = e - _,
            y = r + T,
            E = r - T;
          (t[u++] = v),
            (t[u++] = y),
            (t[--c] = y),
            (t[--c] = x),
            (t[d++] = x),
            (t[d++] = E),
            (t[--f] = E),
            (t[--f] = v);
        }
        {
          const p = s,
            g = n + o,
            _ = e + p,
            T = e - p,
            v = r + g,
            x = r - g;
          (t[u++] = _),
            (t[u++] = v),
            (t[--f] = x),
            (t[--f] = _),
            s && ((t[u++] = T), (t[u++] = v), (t[--f] = x), (t[--f] = T));
        }
      },
      triangulate(i, t) {
        const e = i.points,
          r = t.points,
          s = t.indices;
        if (e.length === 0) return;
        let n = r.length / 2;
        const a = n;
        let o, h;
        if (i.type !== ct.RREC) {
          const u = i.shape;
          (o = u.x), (h = u.y);
        } else {
          const u = i.shape;
          (o = u.x + u.width / 2), (h = u.y + u.height / 2);
        }
        const l = i.matrix;
        r.push(i.matrix ? l.a * o + l.c * h + l.tx : o, i.matrix ? l.b * o + l.d * h + l.ty : h),
          n++,
          r.push(e[0], e[1]);
        for (let u = 2; u < e.length; u += 2) r.push(e[u], e[u + 1]), s.push(n++, a, n);
        s.push(a + 1, a, n);
      },
    },
    Ro = {
      build(i) {
        const t = i.shape,
          e = t.x,
          r = t.y,
          s = t.width,
          n = t.height,
          a = i.points;
        (a.length = 0), a.push(e, r, e + s, r, e + s, r + n, e, r + n);
      },
      triangulate(i, t) {
        const e = i.points,
          r = t.points,
          s = r.length / 2;
        r.push(e[0], e[1], e[2], e[3], e[6], e[7], e[4], e[5]),
          t.indices.push(s, s + 1, s + 2, s + 1, s + 2, s + 3);
      },
    },
    So = {
      build(i) {
        di.build(i);
      },
      triangulate(i, t) {
        di.triangulate(i, t);
      },
    };
  function Io(i, t, e, r, s, n, a, o) {
    const h = i - e * s,
      l = t - r * s,
      u = i + e * n,
      c = t + r * n;
    let d, f;
    a ? ((d = r), (f = -e)) : ((d = -r), (f = e));
    const p = h + d,
      g = l + f,
      _ = u + d,
      T = c + f;
    return o.push(p, g), o.push(_, T), 2;
  }
  function ke(i, t, e, r, s, n, a, o) {
    const h = e - i,
      l = r - t;
    let u = Math.atan2(h, l),
      c = Math.atan2(s - i, n - t);
    o && u < c ? (u += Math.PI * 2) : !o && u > c && (c += Math.PI * 2);
    let d = u;
    const f = c - u,
      p = Math.abs(f),
      g = Math.sqrt(h * h + l * l),
      _ = (((15 * p * Math.sqrt(g)) / Math.PI) >> 0) + 1,
      T = f / _;
    if (((d += T), o)) {
      a.push(i, t), a.push(e, r);
      for (let v = 1, x = d; v < _; v++, x += T)
        a.push(i, t), a.push(i + Math.sin(x) * g, t + Math.cos(x) * g);
      a.push(i, t), a.push(s, n);
    } else {
      a.push(e, r), a.push(i, t);
      for (let v = 1, x = d; v < _; v++, x += T)
        a.push(i + Math.sin(x) * g, t + Math.cos(x) * g), a.push(i, t);
      a.push(s, n), a.push(i, t);
    }
    return _ * 2;
  }
  function Wf(i, t) {
    const e = i.shape;
    let r = i.points || e.points.slice();
    const s = t.closePointEps;
    if (r.length === 0) return;
    const n = i.lineStyle,
      a = new V(r[0], r[1]),
      o = new V(r[r.length - 2], r[r.length - 1]),
      h = e.type !== ct.POLY || e.closeStroke,
      l = Math.abs(a.x - o.x) < s && Math.abs(a.y - o.y) < s;
    if (h) {
      (r = r.slice()), l && (r.pop(), r.pop(), o.set(r[r.length - 2], r[r.length - 1]));
      const X = (a.x + o.x) * 0.5,
        et = (o.y + a.y) * 0.5;
      r.unshift(X, et), r.push(X, et);
    }
    const u = t.points,
      c = r.length / 2;
    let d = r.length;
    const f = u.length / 2,
      p = n.width / 2,
      g = p * p,
      _ = n.miterLimit * n.miterLimit;
    let T = r[0],
      v = r[1],
      x = r[2],
      y = r[3],
      E = 0,
      D = 0,
      I = -(v - y),
      R = T - x,
      U = 0,
      w = 0,
      C = Math.sqrt(I * I + R * R);
    (I /= C), (R /= C), (I *= p), (R *= p);
    const H = n.alignment,
      b = (1 - H) * 2,
      M = H * 2;
    h ||
      (n.cap === de.ROUND
        ? (d +=
            ke(
              T - I * (b - M) * 0.5,
              v - R * (b - M) * 0.5,
              T - I * b,
              v - R * b,
              T + I * M,
              v + R * M,
              u,
              !0
            ) + 2)
        : n.cap === de.SQUARE && (d += Io(T, v, I, R, b, M, !0, u))),
      u.push(T - I * b, v - R * b),
      u.push(T + I * M, v + R * M);
    for (let X = 1; X < c - 1; ++X) {
      (T = r[(X - 1) * 2]),
        (v = r[(X - 1) * 2 + 1]),
        (x = r[X * 2]),
        (y = r[X * 2 + 1]),
        (E = r[(X + 1) * 2]),
        (D = r[(X + 1) * 2 + 1]),
        (I = -(v - y)),
        (R = T - x),
        (C = Math.sqrt(I * I + R * R)),
        (I /= C),
        (R /= C),
        (I *= p),
        (R *= p),
        (U = -(y - D)),
        (w = x - E),
        (C = Math.sqrt(U * U + w * w)),
        (U /= C),
        (w /= C),
        (U *= p),
        (w *= p);
      const et = x - T,
        j = v - y,
        N = x - E,
        $ = D - y,
        W = j * N - $ * et,
        K = W < 0;
      if (Math.abs(W) < 0.1) {
        u.push(x - I * b, y - R * b), u.push(x + I * M, y + R * M);
        continue;
      }
      const it = (-I + T) * (-R + y) - (-I + x) * (-R + v),
        ft = (-U + E) * (-w + y) - (-U + x) * (-w + D),
        at = (et * ft - N * it) / W,
        pt = ($ * it - j * ft) / W,
        xt = (at - x) * (at - x) + (pt - y) * (pt - y),
        mt = x + (at - x) * b,
        gt = y + (pt - y) * b,
        rt = x - (at - x) * M,
        lt = y - (pt - y) * M,
        Et = Math.min(et * et + j * j, N * N + $ * $),
        kt = K ? b : M,
        se = Et + kt * kt * g;
      xt <= se
        ? n.join === ce.BEVEL || xt / g > _
          ? (K
              ? (u.push(mt, gt),
                u.push(x + I * M, y + R * M),
                u.push(mt, gt),
                u.push(x + U * M, y + w * M))
              : (u.push(x - I * b, y - R * b),
                u.push(rt, lt),
                u.push(x - U * b, y - w * b),
                u.push(rt, lt)),
            (d += 2))
          : n.join === ce.ROUND
          ? K
            ? (u.push(mt, gt),
              u.push(x + I * M, y + R * M),
              (d += ke(x, y, x + I * M, y + R * M, x + U * M, y + w * M, u, !0) + 4),
              u.push(mt, gt),
              u.push(x + U * M, y + w * M))
            : (u.push(x - I * b, y - R * b),
              u.push(rt, lt),
              (d += ke(x, y, x - I * b, y - R * b, x - U * b, y - w * b, u, !1) + 4),
              u.push(x - U * b, y - w * b),
              u.push(rt, lt))
          : (u.push(mt, gt), u.push(rt, lt))
        : (u.push(x - I * b, y - R * b),
          u.push(x + I * M, y + R * M),
          n.join === ce.ROUND
            ? K
              ? (d += ke(x, y, x + I * M, y + R * M, x + U * M, y + w * M, u, !0) + 2)
              : (d += ke(x, y, x - I * b, y - R * b, x - U * b, y - w * b, u, !1) + 2)
            : n.join === ce.MITER &&
              xt / g <= _ &&
              (K ? (u.push(rt, lt), u.push(rt, lt)) : (u.push(mt, gt), u.push(mt, gt)), (d += 2)),
          u.push(x - U * b, y - w * b),
          u.push(x + U * M, y + w * M),
          (d += 2));
    }
    (T = r[(c - 2) * 2]),
      (v = r[(c - 2) * 2 + 1]),
      (x = r[(c - 1) * 2]),
      (y = r[(c - 1) * 2 + 1]),
      (I = -(v - y)),
      (R = T - x),
      (C = Math.sqrt(I * I + R * R)),
      (I /= C),
      (R /= C),
      (I *= p),
      (R *= p),
      u.push(x - I * b, y - R * b),
      u.push(x + I * M, y + R * M),
      h ||
        (n.cap === de.ROUND
          ? (d +=
              ke(
                x - I * (b - M) * 0.5,
                y - R * (b - M) * 0.5,
                x - I * b,
                y - R * b,
                x + I * M,
                y + R * M,
                u,
                !1
              ) + 2)
          : n.cap === de.SQUARE && (d += Io(x, y, I, R, b, M, !1, u)));
    const q = t.indices,
      k = Ue.epsilon * Ue.epsilon;
    for (let X = f; X < d + f - 2; ++X)
      (T = u[X * 2]),
        (v = u[X * 2 + 1]),
        (x = u[(X + 1) * 2]),
        (y = u[(X + 1) * 2 + 1]),
        (E = u[(X + 2) * 2]),
        (D = u[(X + 2) * 2 + 1]),
        !(Math.abs(T * (y - D) + x * (D - v) + E * (v - y)) < k) && q.push(X, X + 1, X + 2);
  }
  function Vf(i, t) {
    let e = 0;
    const r = i.shape,
      s = i.points || r.points,
      n = r.type !== ct.POLY || r.closeStroke;
    if (s.length === 0) return;
    const a = t.points,
      o = t.indices,
      h = s.length / 2,
      l = a.length / 2;
    let u = l;
    for (a.push(s[0], s[1]), e = 1; e < h; e++)
      a.push(s[e * 2], s[e * 2 + 1]), o.push(u, u + 1), u++;
    n && o.push(u, l);
  }
  function rn(i, t) {
    i.lineStyle.native ? Vf(i, t) : Wf(i, t);
  }
  class sn {
    static curveTo(t, e, r, s, n, a) {
      const o = a[a.length - 2],
        h = a[a.length - 1] - e,
        l = o - t,
        u = s - e,
        c = r - t,
        d = Math.abs(h * c - l * u);
      if (d < 1e-8 || n === 0)
        return (a[a.length - 2] !== t || a[a.length - 1] !== e) && a.push(t, e), null;
      const f = h * h + l * l,
        p = u * u + c * c,
        g = h * u + l * c,
        _ = (n * Math.sqrt(f)) / d,
        T = (n * Math.sqrt(p)) / d,
        v = (_ * g) / f,
        x = (T * g) / p,
        y = _ * c + T * l,
        E = _ * u + T * h,
        D = l * (T + v),
        I = h * (T + v),
        R = c * (_ + x),
        U = u * (_ + x),
        w = Math.atan2(I - E, D - y),
        C = Math.atan2(U - E, R - y);
      return {
        cx: y + t,
        cy: E + e,
        radius: n,
        startAngle: w,
        endAngle: C,
        anticlockwise: l * u > c * h,
      };
    }
    static arc(t, e, r, s, n, a, o, h, l) {
      const u = o - a,
        c = Ue._segmentsCount(Math.abs(u) * n, Math.ceil(Math.abs(u) / He) * 40),
        d = u / (c * 2),
        f = d * 2,
        p = Math.cos(d),
        g = Math.sin(d),
        _ = c - 1,
        T = (_ % 1) / _;
      for (let v = 0; v <= _; ++v) {
        const x = v + T * v,
          y = d + a + f * x,
          E = Math.cos(y),
          D = -Math.sin(y);
        l.push((p * E + g * D) * n + r, (p * -D + g * E) * n + s);
      }
    }
  }
  class hr {
    static curveLength(t, e, r, s, n, a, o, h) {
      let l = 0,
        u = 0,
        c = 0,
        d = 0,
        f = 0,
        p = 0,
        g = 0,
        _ = 0,
        T = 0,
        v = 0,
        x = 0,
        y = t,
        E = e;
      for (let D = 1; D <= 10; ++D)
        (u = D / 10),
          (c = u * u),
          (d = c * u),
          (f = 1 - u),
          (p = f * f),
          (g = p * f),
          (_ = g * t + 3 * p * u * r + 3 * f * c * n + d * o),
          (T = g * e + 3 * p * u * s + 3 * f * c * a + d * h),
          (v = y - _),
          (x = E - T),
          (y = _),
          (E = T),
          (l += Math.sqrt(v * v + x * x));
      return l;
    }
    static curveTo(t, e, r, s, n, a, o) {
      const h = o[o.length - 2],
        l = o[o.length - 1];
      o.length -= 2;
      const u = Ue._segmentsCount(hr.curveLength(h, l, t, e, r, s, n, a));
      let c = 0,
        d = 0,
        f = 0,
        p = 0,
        g = 0;
      o.push(h, l);
      for (let _ = 1, T = 0; _ <= u; ++_)
        (T = _ / u),
          (c = 1 - T),
          (d = c * c),
          (f = d * c),
          (p = T * T),
          (g = p * T),
          o.push(
            f * h + 3 * d * T * t + 3 * c * p * r + g * n,
            f * l + 3 * d * T * e + 3 * c * p * s + g * a
          );
    }
  }
  class lr {
    static curveLength(t, e, r, s, n, a) {
      const o = t - 2 * r + n,
        h = e - 2 * s + a,
        l = 2 * r - 2 * t,
        u = 2 * s - 2 * e,
        c = 4 * (o * o + h * h),
        d = 4 * (o * l + h * u),
        f = l * l + u * u,
        p = 2 * Math.sqrt(c + d + f),
        g = Math.sqrt(c),
        _ = 2 * c * g,
        T = 2 * Math.sqrt(f),
        v = d / g;
      return (
        (_ * p + g * d * (p - T) + (4 * f * c - d * d) * Math.log((2 * g + v + p) / (v + T))) /
        (4 * _)
      );
    }
    static curveTo(t, e, r, s, n) {
      const a = n[n.length - 2],
        o = n[n.length - 1],
        h = Ue._segmentsCount(lr.curveLength(a, o, t, e, r, s));
      let l = 0,
        u = 0;
      for (let c = 1; c <= h; ++c) {
        const d = c / h;
        (l = a + (t - a) * d),
          (u = o + (e - o) * d),
          n.push(l + (t + (r - t) * d - l) * d, u + (e + (s - e) * d - u) * d);
      }
    }
  }
  class wo {
    constructor() {
      this.reset();
    }
    begin(t, e, r) {
      this.reset(), (this.style = t), (this.start = e), (this.attribStart = r);
    }
    end(t, e) {
      (this.attribSize = e - this.attribStart), (this.size = t - this.start);
    }
    reset() {
      (this.style = null),
        (this.size = 0),
        (this.start = 0),
        (this.attribStart = 0),
        (this.attribSize = 0);
    }
  }
  const ur = { [ct.POLY]: en, [ct.CIRC]: di, [ct.ELIP]: di, [ct.RECT]: Ro, [ct.RREC]: So },
    nn = [],
    fi = [];
  class pi {
    constructor(t, e = null, r = null, s = null) {
      (this.points = []),
        (this.holes = []),
        (this.shape = t),
        (this.lineStyle = r),
        (this.fillStyle = e),
        (this.matrix = s),
        (this.type = t.type);
    }
    clone() {
      return new pi(this.shape, this.fillStyle, this.lineStyle, this.matrix);
    }
    destroy() {
      (this.shape = null),
        (this.holes.length = 0),
        (this.holes = null),
        (this.points.length = 0),
        (this.points = null),
        (this.lineStyle = null),
        (this.fillStyle = null);
    }
  }
  const Xe = new V(),
    Mo = class extends Ns {
      constructor() {
        super(),
          (this.closePointEps = 1e-4),
          (this.boundsPadding = 0),
          (this.uvsFloat32 = null),
          (this.indicesUint16 = null),
          (this.batchable = !1),
          (this.points = []),
          (this.colors = []),
          (this.uvs = []),
          (this.indices = []),
          (this.textureIds = []),
          (this.graphicsData = []),
          (this.drawCalls = []),
          (this.batchDirty = -1),
          (this.batches = []),
          (this.dirty = 0),
          (this.cacheDirty = -1),
          (this.clearDirty = 0),
          (this.shapeIndex = 0),
          (this._bounds = new si()),
          (this.boundsDirty = -1);
      }
      get bounds() {
        return (
          this.updateBatches(),
          this.boundsDirty !== this.dirty &&
            ((this.boundsDirty = this.dirty), this.calculateBounds()),
          this._bounds
        );
      }
      invalidate() {
        (this.boundsDirty = -1),
          this.dirty++,
          this.batchDirty++,
          (this.shapeIndex = 0),
          (this.points.length = 0),
          (this.colors.length = 0),
          (this.uvs.length = 0),
          (this.indices.length = 0),
          (this.textureIds.length = 0);
        for (let i = 0; i < this.drawCalls.length; i++)
          this.drawCalls[i].texArray.clear(), fi.push(this.drawCalls[i]);
        this.drawCalls.length = 0;
        for (let i = 0; i < this.batches.length; i++) {
          const t = this.batches[i];
          t.reset(), nn.push(t);
        }
        this.batches.length = 0;
      }
      clear() {
        return (
          this.graphicsData.length > 0 &&
            (this.invalidate(), this.clearDirty++, (this.graphicsData.length = 0)),
          this
        );
      }
      drawShape(i, t = null, e = null, r = null) {
        const s = new pi(i, t, e, r);
        return this.graphicsData.push(s), this.dirty++, this;
      }
      drawHole(i, t = null) {
        if (!this.graphicsData.length) return null;
        const e = new pi(i, null, null, t),
          r = this.graphicsData[this.graphicsData.length - 1];
        return (e.lineStyle = r.lineStyle), r.holes.push(e), this.dirty++, this;
      }
      destroy() {
        super.destroy();
        for (let i = 0; i < this.graphicsData.length; ++i) this.graphicsData[i].destroy();
        (this.points.length = 0),
          (this.points = null),
          (this.colors.length = 0),
          (this.colors = null),
          (this.uvs.length = 0),
          (this.uvs = null),
          (this.indices.length = 0),
          (this.indices = null),
          this.indexBuffer.destroy(),
          (this.indexBuffer = null),
          (this.graphicsData.length = 0),
          (this.graphicsData = null),
          (this.drawCalls.length = 0),
          (this.drawCalls = null),
          (this.batches.length = 0),
          (this.batches = null),
          (this._bounds = null);
      }
      containsPoint(i) {
        const t = this.graphicsData;
        for (let e = 0; e < t.length; ++e) {
          const r = t[e];
          if (
            !!r.fillStyle.visible &&
            r.shape &&
            (r.matrix ? r.matrix.applyInverse(i, Xe) : Xe.copyFrom(i), r.shape.contains(Xe.x, Xe.y))
          ) {
            let s = !1;
            if (r.holes) {
              for (let n = 0; n < r.holes.length; n++)
                if (r.holes[n].shape.contains(Xe.x, Xe.y)) {
                  s = !0;
                  break;
                }
            }
            if (!s) return !0;
          }
        }
        return !1;
      }
      updateBatches() {
        if (!this.graphicsData.length) {
          this.batchable = !0;
          return;
        }
        if (!this.validateBatching()) return;
        this.cacheDirty = this.dirty;
        const i = this.uvs,
          t = this.graphicsData;
        let e = null,
          r = null;
        this.batches.length > 0 && ((e = this.batches[this.batches.length - 1]), (r = e.style));
        for (let o = this.shapeIndex; o < t.length; o++) {
          this.shapeIndex++;
          const h = t[o],
            l = h.fillStyle,
            u = h.lineStyle;
          ur[h.type].build(h),
            h.matrix && this.transformPoints(h.points, h.matrix),
            (l.visible || u.visible) && this.processHoles(h.holes);
          for (let c = 0; c < 2; c++) {
            const d = c === 0 ? l : u;
            if (!d.visible) continue;
            const f = d.texture.baseTexture,
              p = this.indices.length,
              g = this.points.length / 2;
            (f.wrapMode = qt.REPEAT), c === 0 ? this.processFill(h) : this.processLine(h);
            const _ = this.points.length / 2 - g;
            _ !== 0 &&
              (e && !this._compareStyles(r, d) && (e.end(p, g), (e = null)),
              e || ((e = nn.pop() || new wo()), e.begin(d, p, g), this.batches.push(e), (r = d)),
              this.addUvs(this.points, i, d.texture, g, _, d.matrix));
          }
        }
        const s = this.indices.length,
          n = this.points.length / 2;
        if ((e && e.end(s, n), this.batches.length === 0)) {
          this.batchable = !0;
          return;
        }
        const a = n > 65535;
        this.indicesUint16 &&
        this.indices.length === this.indicesUint16.length &&
        a === this.indicesUint16.BYTES_PER_ELEMENT > 2
          ? this.indicesUint16.set(this.indices)
          : (this.indicesUint16 = a
              ? new Uint32Array(this.indices)
              : new Uint16Array(this.indices)),
          (this.batchable = this.isBatchable()),
          this.batchable ? this.packBatches() : this.buildDrawCalls();
      }
      _compareStyles(i, t) {
        return !(
          !i ||
          !t ||
          i.texture.baseTexture !== t.texture.baseTexture ||
          i.color + i.alpha !== t.color + t.alpha ||
          !!i.native != !!t.native
        );
      }
      validateBatching() {
        if (this.dirty === this.cacheDirty || !this.graphicsData.length) return !1;
        for (let i = 0, t = this.graphicsData.length; i < t; i++) {
          const e = this.graphicsData[i],
            r = e.fillStyle,
            s = e.lineStyle;
          if ((r && !r.texture.baseTexture.valid) || (s && !s.texture.baseTexture.valid)) return !1;
        }
        return !0;
      }
      packBatches() {
        this.batchDirty++, (this.uvsFloat32 = new Float32Array(this.uvs));
        const i = this.batches;
        for (let t = 0, e = i.length; t < e; t++) {
          const r = i[t];
          for (let s = 0; s < r.size; s++) {
            const n = r.start + s;
            this.indicesUint16[n] = this.indicesUint16[n] - r.attribStart;
          }
        }
      }
      isBatchable() {
        if (this.points.length > 65535 * 2) return !1;
        const i = this.batches;
        for (let t = 0; t < i.length; t++) if (i[t].style.native) return !1;
        return this.points.length < Mo.BATCHABLE_SIZE * 2;
      }
      buildDrawCalls() {
        let i = ++Y._globalBatch;
        for (let u = 0; u < this.drawCalls.length; u++)
          this.drawCalls[u].texArray.clear(), fi.push(this.drawCalls[u]);
        this.drawCalls.length = 0;
        const t = this.colors,
          e = this.textureIds;
        let r = fi.pop();
        r || ((r = new Ki()), (r.texArray = new Zi())),
          (r.texArray.count = 0),
          (r.start = 0),
          (r.size = 0),
          (r.type = Dt.TRIANGLES);
        let s = 0,
          n = null,
          a = 0,
          o = !1,
          h = Dt.TRIANGLES,
          l = 0;
        this.drawCalls.push(r);
        for (let u = 0; u < this.batches.length; u++) {
          const c = this.batches[u],
            d = 8,
            f = c.style,
            p = f.texture.baseTexture;
          o !== !!f.native &&
            ((o = !!f.native), (h = o ? Dt.LINES : Dt.TRIANGLES), (n = null), (s = d), i++),
            n !== p &&
              ((n = p),
              p._batchEnabled !== i &&
                (s === d &&
                  (i++,
                  (s = 0),
                  r.size > 0 &&
                    ((r = fi.pop()),
                    r || ((r = new Ki()), (r.texArray = new Zi())),
                    this.drawCalls.push(r)),
                  (r.start = l),
                  (r.size = 0),
                  (r.texArray.count = 0),
                  (r.type = h)),
                (p.touched = 1),
                (p._batchEnabled = i),
                (p._batchLocation = s),
                (p.wrapMode = qt.REPEAT),
                (r.texArray.elements[r.texArray.count++] = p),
                s++)),
            (r.size += c.size),
            (l += c.size),
            (a = p._batchLocation),
            this.addColors(t, f.color, f.alpha, c.attribSize, c.attribStart),
            this.addTextureIds(e, a, c.attribSize, c.attribStart);
        }
        (Y._globalBatch = i), this.packAttributes();
      }
      packAttributes() {
        const i = this.points,
          t = this.uvs,
          e = this.colors,
          r = this.textureIds,
          s = new ArrayBuffer(i.length * 3 * 4),
          n = new Float32Array(s),
          a = new Uint32Array(s);
        let o = 0;
        for (let h = 0; h < i.length / 2; h++)
          (n[o++] = i[h * 2]),
            (n[o++] = i[h * 2 + 1]),
            (n[o++] = t[h * 2]),
            (n[o++] = t[h * 2 + 1]),
            (a[o++] = e[h]),
            (n[o++] = r[h]);
        this._buffer.update(s), this._indexBuffer.update(this.indicesUint16);
      }
      processFill(i) {
        i.holes.length ? en.triangulate(i, this) : ur[i.type].triangulate(i, this);
      }
      processLine(i) {
        rn(i, this);
        for (let t = 0; t < i.holes.length; t++) rn(i.holes[t], this);
      }
      processHoles(i) {
        for (let t = 0; t < i.length; t++) {
          const e = i[t];
          ur[e.type].build(e), e.matrix && this.transformPoints(e.points, e.matrix);
        }
      }
      calculateBounds() {
        const i = this._bounds;
        i.clear(),
          i.addVertexData(this.points, 0, this.points.length),
          i.pad(this.boundsPadding, this.boundsPadding);
      }
      transformPoints(i, t) {
        for (let e = 0; e < i.length / 2; e++) {
          const r = i[e * 2],
            s = i[e * 2 + 1];
          (i[e * 2] = t.a * r + t.c * s + t.tx), (i[e * 2 + 1] = t.b * r + t.d * s + t.ty);
        }
      }
      addColors(i, t, e, r, s = 0) {
        const n = (t >> 16) + (t & 65280) + ((t & 255) << 16),
          a = Fi(n, e);
        i.length = Math.max(i.length, s + r);
        for (let o = 0; o < r; o++) i[s + o] = a;
      }
      addTextureIds(i, t, e, r = 0) {
        i.length = Math.max(i.length, r + e);
        for (let s = 0; s < e; s++) i[r + s] = t;
      }
      addUvs(i, t, e, r, s, n = null) {
        let a = 0;
        const o = t.length,
          h = e.frame;
        for (; a < s; ) {
          let u = i[(r + a) * 2],
            c = i[(r + a) * 2 + 1];
          if (n) {
            const d = n.a * u + n.c * c + n.tx;
            (c = n.b * u + n.d * c + n.ty), (u = d);
          }
          a++, t.push(u / h.width, c / h.height);
        }
        const l = e.baseTexture;
        (h.width < l.width || h.height < l.height) && this.adjustUvs(t, e, o, s);
      }
      adjustUvs(i, t, e, r) {
        const s = t.baseTexture,
          n = 1e-6,
          a = e + r * 2,
          o = t.frame,
          h = o.width / s.width,
          l = o.height / s.height;
        let u = o.x / o.width,
          c = o.y / o.height,
          d = Math.floor(i[e] + n),
          f = Math.floor(i[e + 1] + n);
        for (let p = e + 2; p < a; p += 2)
          (d = Math.min(d, Math.floor(i[p] + n))), (f = Math.min(f, Math.floor(i[p + 1] + n)));
        (u -= d), (c -= f);
        for (let p = e; p < a; p += 2) (i[p] = (i[p] + u) * h), (i[p + 1] = (i[p + 1] + c) * l);
      }
    };
  let an = Mo;
  an.BATCHABLE_SIZE = 100;
  class cr extends ci {
    constructor() {
      super(...arguments),
        (this.width = 0),
        (this.alignment = 0.5),
        (this.native = !1),
        (this.cap = de.BUTT),
        (this.join = ce.MITER),
        (this.miterLimit = 10);
    }
    clone() {
      const t = new cr();
      return (
        (t.color = this.color),
        (t.alpha = this.alpha),
        (t.texture = this.texture),
        (t.matrix = this.matrix),
        (t.visible = this.visible),
        (t.width = this.width),
        (t.alignment = this.alignment),
        (t.native = this.native),
        (t.cap = this.cap),
        (t.join = this.join),
        (t.miterLimit = this.miterLimit),
        t
      );
    }
    reset() {
      super.reset(), (this.color = 0), (this.alignment = 0.5), (this.width = 0), (this.native = !1);
    }
  }
  const Yf = new Float32Array(3),
    on = {},
    dr = class extends vt {
      constructor(i = null) {
        super(),
          (this.shader = null),
          (this.pluginName = "batch"),
          (this.currentPath = null),
          (this.batches = []),
          (this.batchTint = -1),
          (this.batchDirty = -1),
          (this.vertexData = null),
          (this._fillStyle = new ci()),
          (this._lineStyle = new cr()),
          (this._matrix = null),
          (this._holeMode = !1),
          (this.state = Wt.for2d()),
          (this._geometry = i || new an()),
          this._geometry.refCount++,
          (this._transformID = -1),
          (this.tint = 16777215),
          (this.blendMode = G.NORMAL);
      }
      get geometry() {
        return this._geometry;
      }
      clone() {
        return this.finishPoly(), new dr(this._geometry);
      }
      set blendMode(i) {
        this.state.blendMode = i;
      }
      get blendMode() {
        return this.state.blendMode;
      }
      get tint() {
        return this._tint;
      }
      set tint(i) {
        this._tint = i;
      }
      get fill() {
        return this._fillStyle;
      }
      get line() {
        return this._lineStyle;
      }
      lineStyle(i = null, t = 0, e = 1, r = 0.5, s = !1) {
        return (
          typeof i == "number" && (i = { width: i, color: t, alpha: e, alignment: r, native: s }),
          this.lineTextureStyle(i)
        );
      }
      lineTextureStyle(i) {
        (i = Object.assign(
          {
            width: 0,
            texture: O.WHITE,
            color: i != null && i.texture ? 16777215 : 0,
            alpha: 1,
            matrix: null,
            alignment: 0.5,
            native: !1,
            cap: de.BUTT,
            join: ce.MITER,
            miterLimit: 10,
          },
          i
        )),
          this.currentPath && this.startPoly();
        const t = i.width > 0 && i.alpha > 0;
        return (
          t
            ? (i.matrix && ((i.matrix = i.matrix.clone()), i.matrix.invert()),
              Object.assign(this._lineStyle, { visible: t }, i))
            : this._lineStyle.reset(),
          this
        );
      }
      startPoly() {
        if (this.currentPath) {
          const i = this.currentPath.points,
            t = this.currentPath.points.length;
          t > 2 &&
            (this.drawShape(this.currentPath),
            (this.currentPath = new pe()),
            (this.currentPath.closeStroke = !1),
            this.currentPath.points.push(i[t - 2], i[t - 1]));
        } else (this.currentPath = new pe()), (this.currentPath.closeStroke = !1);
      }
      finishPoly() {
        this.currentPath &&
          (this.currentPath.points.length > 2
            ? (this.drawShape(this.currentPath), (this.currentPath = null))
            : (this.currentPath.points.length = 0));
      }
      moveTo(i, t) {
        return (
          this.startPoly(), (this.currentPath.points[0] = i), (this.currentPath.points[1] = t), this
        );
      }
      lineTo(i, t) {
        this.currentPath || this.moveTo(0, 0);
        const e = this.currentPath.points,
          r = e[e.length - 2],
          s = e[e.length - 1];
        return (r !== i || s !== t) && e.push(i, t), this;
      }
      _initCurve(i = 0, t = 0) {
        this.currentPath
          ? this.currentPath.points.length === 0 && (this.currentPath.points = [i, t])
          : this.moveTo(i, t);
      }
      quadraticCurveTo(i, t, e, r) {
        this._initCurve();
        const s = this.currentPath.points;
        return s.length === 0 && this.moveTo(0, 0), lr.curveTo(i, t, e, r, s), this;
      }
      bezierCurveTo(i, t, e, r, s, n) {
        return this._initCurve(), hr.curveTo(i, t, e, r, s, n, this.currentPath.points), this;
      }
      arcTo(i, t, e, r, s) {
        this._initCurve(i, t);
        const n = this.currentPath.points,
          a = sn.curveTo(i, t, e, r, s, n);
        if (a) {
          const { cx: o, cy: h, radius: l, startAngle: u, endAngle: c, anticlockwise: d } = a;
          this.arc(o, h, l, u, c, d);
        }
        return this;
      }
      arc(i, t, e, r, s, n = !1) {
        if (r === s) return this;
        if ((!n && s <= r ? (s += He) : n && r <= s && (r += He), s - r === 0)) return this;
        const a = i + Math.cos(r) * e,
          o = t + Math.sin(r) * e,
          h = this._geometry.closePointEps;
        let l = this.currentPath ? this.currentPath.points : null;
        if (l) {
          const u = Math.abs(l[l.length - 2] - a),
            c = Math.abs(l[l.length - 1] - o);
          (u < h && c < h) || l.push(a, o);
        } else this.moveTo(a, o), (l = this.currentPath.points);
        return sn.arc(a, o, i, t, e, r, s, n, l), this;
      }
      beginFill(i = 0, t = 1) {
        return this.beginTextureFill({ texture: O.WHITE, color: i, alpha: t });
      }
      beginTextureFill(i) {
        (i = Object.assign({ texture: O.WHITE, color: 16777215, alpha: 1, matrix: null }, i)),
          this.currentPath && this.startPoly();
        const t = i.alpha > 0;
        return (
          t
            ? (i.matrix && ((i.matrix = i.matrix.clone()), i.matrix.invert()),
              Object.assign(this._fillStyle, { visible: t }, i))
            : this._fillStyle.reset(),
          this
        );
      }
      endFill() {
        return this.finishPoly(), this._fillStyle.reset(), this;
      }
      drawRect(i, t, e, r) {
        return this.drawShape(new z(i, t, e, r));
      }
      drawRoundedRect(i, t, e, r, s) {
        return this.drawShape(new wi(i, t, e, r, s));
      }
      drawCircle(i, t, e) {
        return this.drawShape(new Si(i, t, e));
      }
      drawEllipse(i, t, e, r) {
        return this.drawShape(new Ii(i, t, e, r));
      }
      drawPolygon(...i) {
        let t,
          e = !0;
        const r = i[0];
        r.points
          ? ((e = r.closeStroke), (t = r.points))
          : Array.isArray(i[0])
          ? (t = i[0])
          : (t = i);
        const s = new pe(t);
        return (s.closeStroke = e), this.drawShape(s), this;
      }
      drawShape(i) {
        return (
          this._holeMode
            ? this._geometry.drawHole(i, this._matrix)
            : this._geometry.drawShape(
                i,
                this._fillStyle.clone(),
                this._lineStyle.clone(),
                this._matrix
              ),
          this
        );
      }
      clear() {
        return (
          this._geometry.clear(),
          this._lineStyle.reset(),
          this._fillStyle.reset(),
          this._boundsID++,
          (this._matrix = null),
          (this._holeMode = !1),
          (this.currentPath = null),
          this
        );
      }
      isFastRect() {
        const i = this._geometry.graphicsData;
        return (
          i.length === 1 &&
          i[0].shape.type === ct.RECT &&
          !i[0].matrix &&
          !i[0].holes.length &&
          !(i[0].lineStyle.visible && i[0].lineStyle.width)
        );
      }
      _render(i) {
        this.finishPoly();
        const t = this._geometry;
        t.updateBatches(),
          t.batchable
            ? (this.batchDirty !== t.batchDirty && this._populateBatches(), this._renderBatched(i))
            : (i.batch.flush(), this._renderDirect(i));
      }
      _populateBatches() {
        const i = this._geometry,
          t = this.blendMode,
          e = i.batches.length;
        (this.batchTint = -1),
          (this._transformID = -1),
          (this.batchDirty = i.batchDirty),
          (this.batches.length = e),
          (this.vertexData = new Float32Array(i.points));
        for (let r = 0; r < e; r++) {
          const s = i.batches[r],
            n = s.style.color,
            a = new Float32Array(this.vertexData.buffer, s.attribStart * 4 * 2, s.attribSize * 2),
            o = new Float32Array(i.uvsFloat32.buffer, s.attribStart * 4 * 2, s.attribSize * 2),
            h = new Uint16Array(i.indicesUint16.buffer, s.start * 2, s.size),
            l = {
              vertexData: a,
              blendMode: t,
              indices: h,
              uvs: o,
              _batchRGB: ye(n),
              _tintRGB: n,
              _texture: s.style.texture,
              alpha: s.style.alpha,
              worldAlpha: 1,
            };
          this.batches[r] = l;
        }
      }
      _renderBatched(i) {
        if (this.batches.length) {
          i.batch.setObjectRenderer(i.plugins[this.pluginName]),
            this.calculateVertices(),
            this.calculateTints();
          for (let t = 0, e = this.batches.length; t < e; t++) {
            const r = this.batches[t];
            (r.worldAlpha = this.worldAlpha * r.alpha), i.plugins[this.pluginName].render(r);
          }
        }
      }
      _renderDirect(i) {
        const t = this._resolveDirectShader(i),
          e = this._geometry,
          r = this.tint,
          s = this.worldAlpha,
          n = t.uniforms,
          a = e.drawCalls;
        (n.translationMatrix = this.transform.worldTransform),
          (n.tint[0] = (((r >> 16) & 255) / 255) * s),
          (n.tint[1] = (((r >> 8) & 255) / 255) * s),
          (n.tint[2] = ((r & 255) / 255) * s),
          (n.tint[3] = s),
          i.shader.bind(t),
          i.geometry.bind(e, t),
          i.state.set(this.state);
        for (let o = 0, h = a.length; o < h; o++) this._renderDrawCallDirect(i, e.drawCalls[o]);
      }
      _renderDrawCallDirect(i, t) {
        const { texArray: e, type: r, size: s, start: n } = t,
          a = e.count;
        for (let o = 0; o < a; o++) i.texture.bind(e.elements[o], o);
        i.geometry.draw(r, s, n);
      }
      _resolveDirectShader(i) {
        let t = this.shader;
        const e = this.pluginName;
        if (!t) {
          if (!on[e]) {
            const { MAX_TEXTURES: r } = i.plugins[e],
              s = new Int32Array(r);
            for (let o = 0; o < r; o++) s[o] = o;
            const n = {
                tint: new Float32Array([1, 1, 1, 1]),
                translationMatrix: new Q(),
                default: It.from({ uSamplers: s }, !0),
              },
              a = i.plugins[e]._shader.program;
            on[e] = new Bt(a, n);
          }
          t = on[e];
        }
        return t;
      }
      _calculateBounds() {
        this.finishPoly();
        const i = this._geometry;
        if (!i.graphicsData.length) return;
        const { minX: t, minY: e, maxX: r, maxY: s } = i.bounds;
        this._bounds.addFrame(this.transform, t, e, r, s);
      }
      containsPoint(i) {
        return (
          this.worldTransform.applyInverse(i, dr._TEMP_POINT),
          this._geometry.containsPoint(dr._TEMP_POINT)
        );
      }
      calculateTints() {
        if (this.batchTint !== this.tint) {
          this.batchTint = this.tint;
          const i = ye(this.tint, Yf);
          for (let t = 0; t < this.batches.length; t++) {
            const e = this.batches[t],
              r = e._batchRGB,
              s = i[0] * r[0] * 255,
              n = i[1] * r[1] * 255,
              a = i[2] * r[2] * 255,
              o = (s << 16) + (n << 8) + (a | 0);
            e._tintRGB = (o >> 16) + (o & 65280) + ((o & 255) << 16);
          }
        }
      }
      calculateVertices() {
        const i = this.transform._worldID;
        if (this._transformID === i) return;
        this._transformID = i;
        const t = this.transform.worldTransform,
          e = t.a,
          r = t.b,
          s = t.c,
          n = t.d,
          a = t.tx,
          o = t.ty,
          h = this._geometry.points,
          l = this.vertexData;
        let u = 0;
        for (let c = 0; c < h.length; c += 2) {
          const d = h[c],
            f = h[c + 1];
          (l[u++] = e * d + s * f + a), (l[u++] = n * f + r * d + o);
        }
      }
      closePath() {
        const i = this.currentPath;
        return i && ((i.closeStroke = !0), this.finishPoly()), this;
      }
      setMatrix(i) {
        return (this._matrix = i), this;
      }
      beginHole() {
        return this.finishPoly(), (this._holeMode = !0), this;
      }
      endHole() {
        return this.finishPoly(), (this._holeMode = !1), this;
      }
      destroy(i) {
        this._geometry.refCount--,
          this._geometry.refCount === 0 && this._geometry.dispose(),
          (this._matrix = null),
          (this.currentPath = null),
          this._lineStyle.destroy(),
          (this._lineStyle = null),
          this._fillStyle.destroy(),
          (this._fillStyle = null),
          (this._geometry = null),
          (this.shader = null),
          (this.vertexData = null),
          (this.batches.length = 0),
          (this.batches = null),
          super.destroy(i);
      }
    };
  let fr = dr;
  fr._TEMP_POINT = new V();
  const jf = {
    buildPoly: en,
    buildCircle: di,
    buildRectangle: Ro,
    buildRoundedRectangle: So,
    buildLine: rn,
    ArcUtils: sn,
    BezierUtils: hr,
    QuadraticUtils: lr,
    BatchPart: wo,
    FILL_COMMANDS: ur,
    BATCH_POOL: nn,
    DRAW_CALL_POOL: fi,
  };
  class Co {
    constructor(t, e) {
      (this.uvBuffer = t),
        (this.uvMatrix = e),
        (this.data = null),
        (this._bufferUpdateId = -1),
        (this._textureUpdateId = -1),
        (this._updateID = 0);
    }
    update(t) {
      if (
        !t &&
        this._bufferUpdateId === this.uvBuffer._updateID &&
        this._textureUpdateId === this.uvMatrix._updateID
      )
        return;
      (this._bufferUpdateId = this.uvBuffer._updateID),
        (this._textureUpdateId = this.uvMatrix._updateID);
      const e = this.uvBuffer.data;
      (!this.data || this.data.length !== e.length) && (this.data = new Float32Array(e.length)),
        this.uvMatrix.multiplyUvs(e, this.data),
        this._updateID++;
    }
  }
  const hn = new V(),
    Do = new pe(),
    Po = class extends vt {
      constructor(i, t, e, r = Dt.TRIANGLES) {
        super(),
          (this.geometry = i),
          (this.shader = t),
          (this.state = e || Wt.for2d()),
          (this.drawMode = r),
          (this.start = 0),
          (this.size = 0),
          (this.uvs = null),
          (this.indices = null),
          (this.vertexData = new Float32Array(1)),
          (this.vertexDirty = -1),
          (this._transformID = -1),
          (this._roundPixels = A.ROUND_PIXELS),
          (this.batchUvs = null);
      }
      get geometry() {
        return this._geometry;
      }
      set geometry(i) {
        this._geometry !== i &&
          (this._geometry &&
            (this._geometry.refCount--, this._geometry.refCount === 0 && this._geometry.dispose()),
          (this._geometry = i),
          this._geometry && this._geometry.refCount++,
          (this.vertexDirty = -1));
      }
      get uvBuffer() {
        return this.geometry.buffers[1];
      }
      get verticesBuffer() {
        return this.geometry.buffers[0];
      }
      set material(i) {
        this.shader = i;
      }
      get material() {
        return this.shader;
      }
      set blendMode(i) {
        this.state.blendMode = i;
      }
      get blendMode() {
        return this.state.blendMode;
      }
      set roundPixels(i) {
        this._roundPixels !== i && (this._transformID = -1), (this._roundPixels = i);
      }
      get roundPixels() {
        return this._roundPixels;
      }
      get tint() {
        return "tint" in this.shader ? this.shader.tint : null;
      }
      set tint(i) {
        this.shader.tint = i;
      }
      get texture() {
        return "texture" in this.shader ? this.shader.texture : null;
      }
      set texture(i) {
        this.shader.texture = i;
      }
      _render(i) {
        const t = this.geometry.buffers[0].data;
        this.shader.batchable && this.drawMode === Dt.TRIANGLES && t.length < Po.BATCHABLE_SIZE * 2
          ? this._renderToBatch(i)
          : this._renderDefault(i);
      }
      _renderDefault(i) {
        const t = this.shader;
        (t.alpha = this.worldAlpha),
          t.update && t.update(),
          i.batch.flush(),
          (t.uniforms.translationMatrix = this.transform.worldTransform.toArray(!0)),
          i.shader.bind(t),
          i.state.set(this.state),
          i.geometry.bind(this.geometry, t),
          i.geometry.draw(this.drawMode, this.size, this.start, this.geometry.instanceCount);
      }
      _renderToBatch(i) {
        const t = this.geometry,
          e = this.shader;
        e.uvMatrix && (e.uvMatrix.update(), this.calculateUvs()),
          this.calculateVertices(),
          (this.indices = t.indexBuffer.data),
          (this._tintRGB = e._tintRGB),
          (this._texture = e.texture);
        const r = this.material.pluginName;
        i.batch.setObjectRenderer(i.plugins[r]), i.plugins[r].render(this);
      }
      calculateVertices() {
        const i = this.geometry.buffers[0],
          t = i.data,
          e = i._updateID;
        if (e === this.vertexDirty && this._transformID === this.transform._worldID) return;
        (this._transformID = this.transform._worldID),
          this.vertexData.length !== t.length && (this.vertexData = new Float32Array(t.length));
        const r = this.transform.worldTransform,
          s = r.a,
          n = r.b,
          a = r.c,
          o = r.d,
          h = r.tx,
          l = r.ty,
          u = this.vertexData;
        for (let c = 0; c < u.length / 2; c++) {
          const d = t[c * 2],
            f = t[c * 2 + 1];
          (u[c * 2] = s * d + a * f + h), (u[c * 2 + 1] = n * d + o * f + l);
        }
        if (this._roundPixels) {
          const c = A.RESOLUTION;
          for (let d = 0; d < u.length; ++d) u[d] = Math.round(((u[d] * c) | 0) / c);
        }
        this.vertexDirty = e;
      }
      calculateUvs() {
        const i = this.geometry.buffers[1],
          t = this.shader;
        t.uvMatrix.isSimple
          ? (this.uvs = i.data)
          : (this.batchUvs || (this.batchUvs = new Co(i, t.uvMatrix)),
            this.batchUvs.update(),
            (this.uvs = this.batchUvs.data));
      }
      _calculateBounds() {
        this.calculateVertices(),
          this._bounds.addVertexData(this.vertexData, 0, this.vertexData.length);
      }
      containsPoint(i) {
        if (!this.getBounds().contains(i.x, i.y)) return !1;
        this.worldTransform.applyInverse(i, hn);
        const t = this.geometry.getBuffer("aVertexPosition").data,
          e = Do.points,
          r = this.geometry.getIndex().data,
          s = r.length,
          n = this.drawMode === 4 ? 3 : 1;
        for (let a = 0; a + 2 < s; a += n) {
          const o = r[a] * 2,
            h = r[a + 1] * 2,
            l = r[a + 2] * 2;
          if (
            ((e[0] = t[o]),
            (e[1] = t[o + 1]),
            (e[2] = t[h]),
            (e[3] = t[h + 1]),
            (e[4] = t[l]),
            (e[5] = t[l + 1]),
            Do.contains(hn.x, hn.y))
          )
            return !0;
        }
        return !1;
      }
      destroy(i) {
        super.destroy(i),
          this._cachedTexture && (this._cachedTexture.destroy(), (this._cachedTexture = null)),
          (this.geometry = null),
          (this.shader = null),
          (this.state = null),
          (this.uvs = null),
          (this.indices = null),
          (this.vertexData = null);
      }
    };
  let Ie = Po;
  Ie.BATCHABLE_SIZE = 100;
  var qf = `varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,
    Kf = `attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;
  class $e extends Bt {
    constructor(t, e) {
      const r = {
        uSampler: t,
        alpha: 1,
        uTextureMatrix: Q.IDENTITY,
        uColor: new Float32Array([1, 1, 1, 1]),
      };
      (e = Object.assign({ tint: 16777215, alpha: 1, pluginName: "batch" }, e)),
        e.uniforms && Object.assign(r, e.uniforms),
        super(e.program || zt.from(Kf, qf), r),
        (this._colorDirty = !1),
        (this.uvMatrix = new Vi(t)),
        (this.batchable = e.program === void 0),
        (this.pluginName = e.pluginName),
        (this.tint = e.tint),
        (this.alpha = e.alpha);
    }
    get texture() {
      return this.uniforms.uSampler;
    }
    set texture(t) {
      this.uniforms.uSampler !== t &&
        (!this.uniforms.uSampler.baseTexture.alphaMode != !t.baseTexture.alphaMode &&
          (this._colorDirty = !0),
        (this.uniforms.uSampler = t),
        (this.uvMatrix.texture = t));
    }
    set alpha(t) {
      t !== this._alpha && ((this._alpha = t), (this._colorDirty = !0));
    }
    get alpha() {
      return this._alpha;
    }
    set tint(t) {
      t !== this._tint &&
        ((this._tint = t),
        (this._tintRGB = (t >> 16) + (t & 65280) + ((t & 255) << 16)),
        (this._colorDirty = !0));
    }
    get tint() {
      return this._tint;
    }
    update() {
      if (this._colorDirty) {
        this._colorDirty = !1;
        const t = this.texture.baseTexture;
        zr(this._tint, this._alpha, this.uniforms.uColor, t.alphaMode);
      }
      this.uvMatrix.update() && (this.uniforms.uTextureMatrix = this.uvMatrix.mapCoord);
    }
  }
  class mi extends ee {
    constructor(t, e, r) {
      super();
      const s = new nt(t),
        n = new nt(e, !0),
        a = new nt(r, !0, !0);
      this.addAttribute("aVertexPosition", s, 2, !1, L.FLOAT)
        .addAttribute("aTextureCoord", n, 2, !1, L.FLOAT)
        .addIndex(a),
        (this._updateId = -1);
    }
    get vertexDirtyId() {
      return this.buffers[0]._updateID;
    }
  }
  class Oo extends mi {
    constructor(t = 100, e = 100, r = 10, s = 10) {
      super(),
        (this.segWidth = r),
        (this.segHeight = s),
        (this.width = t),
        (this.height = e),
        this.build();
    }
    build() {
      const t = this.segWidth * this.segHeight,
        e = [],
        r = [],
        s = [],
        n = this.segWidth - 1,
        a = this.segHeight - 1,
        o = this.width / n,
        h = this.height / a;
      for (let u = 0; u < t; u++) {
        const c = u % this.segWidth,
          d = (u / this.segWidth) | 0;
        e.push(c * o, d * h), r.push(c / n, d / a);
      }
      const l = n * a;
      for (let u = 0; u < l; u++) {
        const c = u % n,
          d = (u / n) | 0,
          f = d * this.segWidth + c,
          p = d * this.segWidth + c + 1,
          g = (d + 1) * this.segWidth + c,
          _ = (d + 1) * this.segWidth + c + 1;
        s.push(f, p, g, p, _, g);
      }
      (this.buffers[0].data = new Float32Array(e)),
        (this.buffers[1].data = new Float32Array(r)),
        (this.indexBuffer.data = new Uint16Array(s)),
        this.buffers[0].update(),
        this.buffers[1].update(),
        this.indexBuffer.update();
    }
  }
  class Fo extends mi {
    constructor(t = 200, e, r = 0) {
      super(
        new Float32Array(e.length * 4),
        new Float32Array(e.length * 4),
        new Uint16Array((e.length - 1) * 6)
      ),
        (this.points = e),
        (this._width = t),
        (this.textureScale = r),
        this.build();
    }
    get width() {
      return this._width;
    }
    build() {
      const t = this.points;
      if (!t) return;
      const e = this.getBuffer("aVertexPosition"),
        r = this.getBuffer("aTextureCoord"),
        s = this.getIndex();
      if (t.length < 1) return;
      e.data.length / 4 !== t.length &&
        ((e.data = new Float32Array(t.length * 4)),
        (r.data = new Float32Array(t.length * 4)),
        (s.data = new Uint16Array((t.length - 1) * 6)));
      const n = r.data,
        a = s.data;
      (n[0] = 0), (n[1] = 0), (n[2] = 0), (n[3] = 1);
      let o = 0,
        h = t[0];
      const l = this._width * this.textureScale,
        u = t.length;
      for (let d = 0; d < u; d++) {
        const f = d * 4;
        if (this.textureScale > 0) {
          const p = h.x - t[d].x,
            g = h.y - t[d].y,
            _ = Math.sqrt(p * p + g * g);
          (h = t[d]), (o += _ / l);
        } else o = d / (u - 1);
        (n[f] = o), (n[f + 1] = 0), (n[f + 2] = o), (n[f + 3] = 1);
      }
      let c = 0;
      for (let d = 0; d < u - 1; d++) {
        const f = d * 2;
        (a[c++] = f),
          (a[c++] = f + 1),
          (a[c++] = f + 2),
          (a[c++] = f + 2),
          (a[c++] = f + 1),
          (a[c++] = f + 3);
      }
      r.update(), s.update(), this.updateVertices();
    }
    updateVertices() {
      const t = this.points;
      if (t.length < 1) return;
      let e = t[0],
        r,
        s = 0,
        n = 0;
      const a = this.buffers[0].data,
        o = t.length;
      for (let h = 0; h < o; h++) {
        const l = t[h],
          u = h * 4;
        h < t.length - 1 ? (r = t[h + 1]) : (r = l), (n = -(r.x - e.x)), (s = r.y - e.y);
        const c = Math.sqrt(s * s + n * n),
          d = this.textureScale > 0 ? (this.textureScale * this._width) / 2 : this._width / 2;
        (s /= c),
          (n /= c),
          (s *= d),
          (n *= d),
          (a[u] = l.x + s),
          (a[u + 1] = l.y + n),
          (a[u + 2] = l.x - s),
          (a[u + 3] = l.y - n),
          (e = l);
      }
      this.buffers[0].update();
    }
    update() {
      this.textureScale > 0 ? this.build() : this.updateVertices();
    }
  }
  class Zf extends Ie {
    constructor(t, e, r = 0) {
      const s = new Fo(t.height, e, r),
        n = new $e(t);
      r > 0 && (t.baseTexture.wrapMode = qt.REPEAT), super(s, n), (this.autoUpdate = !0);
    }
    _render(t) {
      const e = this.geometry;
      (this.autoUpdate || e._width !== this.shader.texture.height) &&
        ((e._width = this.shader.texture.height), e.update()),
        super._render(t);
    }
  }
  class No extends Ie {
    constructor(t, e, r) {
      const s = new Oo(t.width, t.height, e, r),
        n = new $e(O.WHITE);
      super(s, n), (this.texture = t), (this.autoResize = !0);
    }
    textureUpdated() {
      this._textureID = this.shader.texture._updateID;
      const t = this.geometry,
        { width: e, height: r } = this.shader.texture;
      this.autoResize &&
        (t.width !== e || t.height !== r) &&
        ((t.width = this.shader.texture.width), (t.height = this.shader.texture.height), t.build());
    }
    set texture(t) {
      this.shader.texture !== t &&
        ((this.shader.texture = t),
        (this._textureID = -1),
        t.baseTexture.valid ? this.textureUpdated() : t.once("update", this.textureUpdated, this));
    }
    get texture() {
      return this.shader.texture;
    }
    _render(t) {
      this._textureID !== this.shader.texture._updateID && this.textureUpdated(), super._render(t);
    }
    destroy(t) {
      this.shader.texture.off("update", this.textureUpdated, this), super.destroy(t);
    }
  }
  class Qf extends Ie {
    constructor(t = O.EMPTY, e, r, s, n) {
      const a = new mi(e, r, s);
      a.getBuffer("aVertexPosition").static = !1;
      const o = new $e(t);
      super(a, o, null, n), (this.autoUpdate = !0);
    }
    get vertices() {
      return this.geometry.getBuffer("aVertexPosition").data;
    }
    set vertices(t) {
      this.geometry.getBuffer("aVertexPosition").data = t;
    }
    _render(t) {
      this.autoUpdate && this.geometry.getBuffer("aVertexPosition").update(), super._render(t);
    }
  }
  const pr = 10;
  class Jf extends No {
    constructor(t, e = pr, r = pr, s = pr, n = pr) {
      super(O.WHITE, 4, 4),
        (this._origWidth = t.orig.width),
        (this._origHeight = t.orig.height),
        (this._width = this._origWidth),
        (this._height = this._origHeight),
        (this._leftWidth = e),
        (this._rightWidth = s),
        (this._topHeight = r),
        (this._bottomHeight = n),
        (this.texture = t);
    }
    textureUpdated() {
      (this._textureID = this.shader.texture._updateID), this._refresh();
    }
    get vertices() {
      return this.geometry.getBuffer("aVertexPosition").data;
    }
    set vertices(t) {
      this.geometry.getBuffer("aVertexPosition").data = t;
    }
    updateHorizontalVertices() {
      const t = this.vertices,
        e = this._getMinScale();
      (t[9] = t[11] = t[13] = t[15] = this._topHeight * e),
        (t[17] = t[19] = t[21] = t[23] = this._height - this._bottomHeight * e),
        (t[25] = t[27] = t[29] = t[31] = this._height);
    }
    updateVerticalVertices() {
      const t = this.vertices,
        e = this._getMinScale();
      (t[2] = t[10] = t[18] = t[26] = this._leftWidth * e),
        (t[4] = t[12] = t[20] = t[28] = this._width - this._rightWidth * e),
        (t[6] = t[14] = t[22] = t[30] = this._width);
    }
    _getMinScale() {
      const t = this._leftWidth + this._rightWidth,
        e = this._width > t ? 1 : this._width / t,
        r = this._topHeight + this._bottomHeight,
        s = this._height > r ? 1 : this._height / r;
      return Math.min(e, s);
    }
    get width() {
      return this._width;
    }
    set width(t) {
      (this._width = t), this._refresh();
    }
    get height() {
      return this._height;
    }
    set height(t) {
      (this._height = t), this._refresh();
    }
    get leftWidth() {
      return this._leftWidth;
    }
    set leftWidth(t) {
      (this._leftWidth = t), this._refresh();
    }
    get rightWidth() {
      return this._rightWidth;
    }
    set rightWidth(t) {
      (this._rightWidth = t), this._refresh();
    }
    get topHeight() {
      return this._topHeight;
    }
    set topHeight(t) {
      (this._topHeight = t), this._refresh();
    }
    get bottomHeight() {
      return this._bottomHeight;
    }
    set bottomHeight(t) {
      (this._bottomHeight = t), this._refresh();
    }
    _refresh() {
      const t = this.texture,
        e = this.geometry.buffers[1].data;
      (this._origWidth = t.orig.width), (this._origHeight = t.orig.height);
      const r = 1 / this._origWidth,
        s = 1 / this._origHeight;
      (e[0] = e[8] = e[16] = e[24] = 0),
        (e[1] = e[3] = e[5] = e[7] = 0),
        (e[6] = e[14] = e[22] = e[30] = 1),
        (e[25] = e[27] = e[29] = e[31] = 1),
        (e[2] = e[10] = e[18] = e[26] = r * this._leftWidth),
        (e[4] = e[12] = e[20] = e[28] = 1 - r * this._rightWidth),
        (e[9] = e[11] = e[13] = e[15] = s * this._topHeight),
        (e[17] = e[19] = e[21] = e[23] = 1 - s * this._bottomHeight),
        this.updateHorizontalVertices(),
        this.updateVerticalVertices(),
        this.geometry.buffers[0].update(),
        this.geometry.buffers[1].update();
    }
  }
  class tp extends vt {
    constructor(t = 1500, e, r = 16384, s = !1) {
      super();
      const n = 16384;
      r > n && (r = n),
        (this._properties = [!1, !0, !1, !1, !1]),
        (this._maxSize = t),
        (this._batchSize = r),
        (this._buffers = null),
        (this._bufferUpdateIDs = []),
        (this._updateID = 0),
        (this.interactiveChildren = !1),
        (this.blendMode = G.NORMAL),
        (this.autoResize = s),
        (this.roundPixels = !0),
        (this.baseTexture = null),
        this.setProperties(e),
        (this._tint = 0),
        (this.tintRgb = new Float32Array(4)),
        (this.tint = 16777215);
    }
    setProperties(t) {
      t &&
        ((this._properties[0] =
          "vertices" in t || "scale" in t ? !!t.vertices || !!t.scale : this._properties[0]),
        (this._properties[1] = "position" in t ? !!t.position : this._properties[1]),
        (this._properties[2] = "rotation" in t ? !!t.rotation : this._properties[2]),
        (this._properties[3] = "uvs" in t ? !!t.uvs : this._properties[3]),
        (this._properties[4] =
          "tint" in t || "alpha" in t ? !!t.tint || !!t.alpha : this._properties[4]));
    }
    updateTransform() {
      this.displayObjectUpdateTransform();
    }
    get tint() {
      return this._tint;
    }
    set tint(t) {
      (this._tint = t), ye(t, this.tintRgb);
    }
    render(t) {
      !this.visible ||
        this.worldAlpha <= 0 ||
        !this.children.length ||
        !this.renderable ||
        (this.baseTexture ||
          ((this.baseTexture = this.children[0]._texture.baseTexture),
          this.baseTexture.valid ||
            this.baseTexture.once("update", () => this.onChildrenChange(0))),
        t.batch.setObjectRenderer(t.plugins.particle),
        t.plugins.particle.render(this));
    }
    onChildrenChange(t) {
      const e = Math.floor(t / this._batchSize);
      for (; this._bufferUpdateIDs.length < e; ) this._bufferUpdateIDs.push(0);
      this._bufferUpdateIDs[e] = ++this._updateID;
    }
    dispose() {
      if (this._buffers) {
        for (let t = 0; t < this._buffers.length; ++t) this._buffers[t].destroy();
        this._buffers = null;
      }
    }
    destroy(t) {
      super.destroy(t),
        this.dispose(),
        (this._properties = null),
        (this._buffers = null),
        (this._bufferUpdateIDs = null);
    }
  }
  class Bo {
    constructor(t, e, r) {
      (this.geometry = new ee()),
        (this.indexBuffer = null),
        (this.size = r),
        (this.dynamicProperties = []),
        (this.staticProperties = []);
      for (let s = 0; s < t.length; ++s) {
        let n = t[s];
        (n = {
          attributeName: n.attributeName,
          size: n.size,
          uploadFunction: n.uploadFunction,
          type: n.type || L.FLOAT,
          offset: n.offset,
        }),
          e[s] ? this.dynamicProperties.push(n) : this.staticProperties.push(n);
      }
      (this.staticStride = 0),
        (this.staticBuffer = null),
        (this.staticData = null),
        (this.staticDataUint32 = null),
        (this.dynamicStride = 0),
        (this.dynamicBuffer = null),
        (this.dynamicData = null),
        (this.dynamicDataUint32 = null),
        (this._updateID = 0),
        this.initBuffers();
    }
    initBuffers() {
      const t = this.geometry;
      let e = 0;
      (this.indexBuffer = new nt(ea(this.size), !0, !0)),
        t.addIndex(this.indexBuffer),
        (this.dynamicStride = 0);
      for (let a = 0; a < this.dynamicProperties.length; ++a) {
        const o = this.dynamicProperties[a];
        (o.offset = e), (e += o.size), (this.dynamicStride += o.size);
      }
      const r = new ArrayBuffer(this.size * this.dynamicStride * 4 * 4);
      (this.dynamicData = new Float32Array(r)),
        (this.dynamicDataUint32 = new Uint32Array(r)),
        (this.dynamicBuffer = new nt(this.dynamicData, !1, !1));
      let s = 0;
      this.staticStride = 0;
      for (let a = 0; a < this.staticProperties.length; ++a) {
        const o = this.staticProperties[a];
        (o.offset = s), (s += o.size), (this.staticStride += o.size);
      }
      const n = new ArrayBuffer(this.size * this.staticStride * 4 * 4);
      (this.staticData = new Float32Array(n)),
        (this.staticDataUint32 = new Uint32Array(n)),
        (this.staticBuffer = new nt(this.staticData, !0, !1));
      for (let a = 0; a < this.dynamicProperties.length; ++a) {
        const o = this.dynamicProperties[a];
        t.addAttribute(
          o.attributeName,
          this.dynamicBuffer,
          0,
          o.type === L.UNSIGNED_BYTE,
          o.type,
          this.dynamicStride * 4,
          o.offset * 4
        );
      }
      for (let a = 0; a < this.staticProperties.length; ++a) {
        const o = this.staticProperties[a];
        t.addAttribute(
          o.attributeName,
          this.staticBuffer,
          0,
          o.type === L.UNSIGNED_BYTE,
          o.type,
          this.staticStride * 4,
          o.offset * 4
        );
      }
    }
    uploadDynamic(t, e, r) {
      for (let s = 0; s < this.dynamicProperties.length; s++) {
        const n = this.dynamicProperties[s];
        n.uploadFunction(
          t,
          e,
          r,
          n.type === L.UNSIGNED_BYTE ? this.dynamicDataUint32 : this.dynamicData,
          this.dynamicStride,
          n.offset
        );
      }
      this.dynamicBuffer._updateID++;
    }
    uploadStatic(t, e, r) {
      for (let s = 0; s < this.staticProperties.length; s++) {
        const n = this.staticProperties[s];
        n.uploadFunction(
          t,
          e,
          r,
          n.type === L.UNSIGNED_BYTE ? this.staticDataUint32 : this.staticData,
          this.staticStride,
          n.offset
        );
      }
      this.staticBuffer._updateID++;
    }
    destroy() {
      (this.indexBuffer = null),
        (this.dynamicProperties = null),
        (this.dynamicBuffer = null),
        (this.dynamicData = null),
        (this.dynamicDataUint32 = null),
        (this.staticProperties = null),
        (this.staticBuffer = null),
        (this.staticData = null),
        (this.staticDataUint32 = null),
        this.geometry.destroy();
    }
  }
  var ep = `varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,
    ip = `attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;
  class ln extends ti {
    constructor(t) {
      super(t),
        (this.shader = null),
        (this.properties = null),
        (this.tempMatrix = new Q()),
        (this.properties = [
          {
            attributeName: "aVertexPosition",
            size: 2,
            uploadFunction: this.uploadVertices,
            offset: 0,
          },
          {
            attributeName: "aPositionCoord",
            size: 2,
            uploadFunction: this.uploadPosition,
            offset: 0,
          },
          { attributeName: "aRotation", size: 1, uploadFunction: this.uploadRotation, offset: 0 },
          { attributeName: "aTextureCoord", size: 2, uploadFunction: this.uploadUvs, offset: 0 },
          {
            attributeName: "aColor",
            size: 1,
            type: L.UNSIGNED_BYTE,
            uploadFunction: this.uploadTint,
            offset: 0,
          },
        ]),
        (this.shader = Bt.from(ip, ep, {})),
        (this.state = Wt.for2d());
    }
    render(t) {
      const e = t.children,
        r = t._maxSize,
        s = t._batchSize,
        n = this.renderer;
      let a = e.length;
      if (a === 0) return;
      a > r && !t.autoResize && (a = r);
      let o = t._buffers;
      o || (o = t._buffers = this.generateBuffers(t));
      const h = e[0]._texture.baseTexture,
        l = h.alphaMode > 0;
      (this.state.blendMode = Hr(t.blendMode, l)), n.state.set(this.state);
      const u = n.gl,
        c = t.worldTransform.copyTo(this.tempMatrix);
      c.prepend(n.globalUniforms.uniforms.projectionMatrix),
        (this.shader.uniforms.translationMatrix = c.toArray(!0)),
        (this.shader.uniforms.uColor = ta(t.tintRgb, t.worldAlpha, this.shader.uniforms.uColor, l)),
        (this.shader.uniforms.uSampler = h),
        this.renderer.shader.bind(this.shader);
      let d = !1;
      for (let f = 0, p = 0; f < a; f += s, p += 1) {
        let g = a - f;
        g > s && (g = s), p >= o.length && o.push(this._generateOneMoreBuffer(t));
        const _ = o[p];
        _.uploadDynamic(e, f, g);
        const T = t._bufferUpdateIDs[p] || 0;
        (d = d || _._updateID < T),
          d && ((_._updateID = t._updateID), _.uploadStatic(e, f, g)),
          n.geometry.bind(_.geometry),
          u.drawElements(u.TRIANGLES, g * 6, u.UNSIGNED_SHORT, 0);
      }
    }
    generateBuffers(t) {
      const e = [],
        r = t._maxSize,
        s = t._batchSize,
        n = t._properties;
      for (let a = 0; a < r; a += s) e.push(new Bo(this.properties, n, s));
      return e;
    }
    _generateOneMoreBuffer(t) {
      const e = t._batchSize,
        r = t._properties;
      return new Bo(this.properties, r, e);
    }
    uploadVertices(t, e, r, s, n, a) {
      let o = 0,
        h = 0,
        l = 0,
        u = 0;
      for (let c = 0; c < r; ++c) {
        const d = t[e + c],
          f = d._texture,
          p = d.scale.x,
          g = d.scale.y,
          _ = f.trim,
          T = f.orig;
        _
          ? ((h = _.x - d.anchor.x * T.width),
            (o = h + _.width),
            (u = _.y - d.anchor.y * T.height),
            (l = u + _.height))
          : ((o = T.width * (1 - d.anchor.x)),
            (h = T.width * -d.anchor.x),
            (l = T.height * (1 - d.anchor.y)),
            (u = T.height * -d.anchor.y)),
          (s[a] = h * p),
          (s[a + 1] = u * g),
          (s[a + n] = o * p),
          (s[a + n + 1] = u * g),
          (s[a + n * 2] = o * p),
          (s[a + n * 2 + 1] = l * g),
          (s[a + n * 3] = h * p),
          (s[a + n * 3 + 1] = l * g),
          (a += n * 4);
      }
    }
    uploadPosition(t, e, r, s, n, a) {
      for (let o = 0; o < r; o++) {
        const h = t[e + o].position;
        (s[a] = h.x),
          (s[a + 1] = h.y),
          (s[a + n] = h.x),
          (s[a + n + 1] = h.y),
          (s[a + n * 2] = h.x),
          (s[a + n * 2 + 1] = h.y),
          (s[a + n * 3] = h.x),
          (s[a + n * 3 + 1] = h.y),
          (a += n * 4);
      }
    }
    uploadRotation(t, e, r, s, n, a) {
      for (let o = 0; o < r; o++) {
        const h = t[e + o].rotation;
        (s[a] = h), (s[a + n] = h), (s[a + n * 2] = h), (s[a + n * 3] = h), (a += n * 4);
      }
    }
    uploadUvs(t, e, r, s, n, a) {
      for (let o = 0; o < r; ++o) {
        const h = t[e + o]._texture._uvs;
        h
          ? ((s[a] = h.x0),
            (s[a + 1] = h.y0),
            (s[a + n] = h.x1),
            (s[a + n + 1] = h.y1),
            (s[a + n * 2] = h.x2),
            (s[a + n * 2 + 1] = h.y2),
            (s[a + n * 3] = h.x3),
            (s[a + n * 3 + 1] = h.y3),
            (a += n * 4))
          : ((s[a] = 0),
            (s[a + 1] = 0),
            (s[a + n] = 0),
            (s[a + n + 1] = 0),
            (s[a + n * 2] = 0),
            (s[a + n * 2 + 1] = 0),
            (s[a + n * 3] = 0),
            (s[a + n * 3 + 1] = 0),
            (a += n * 4));
      }
    }
    uploadTint(t, e, r, s, n, a) {
      for (let o = 0; o < r; ++o) {
        const h = t[e + o],
          l = h._texture.baseTexture.alphaMode > 0,
          u = h.alpha,
          c = u < 1 && l ? Fi(h._tintRGB, u) : h._tintRGB + ((u * 255) << 24);
        (s[a] = c), (s[a + n] = c), (s[a + n * 2] = c), (s[a + n * 3] = c), (a += n * 4);
      }
    }
    destroy() {
      super.destroy(),
        this.shader && (this.shader.destroy(), (this.shader = null)),
        (this.tempMatrix = null);
    }
  }
  (ln.extension = { name: "particle", type: P.RendererPlugin }), B.add(ln);
  var _i = ((i) => (
    (i[(i.LINEAR_VERTICAL = 0)] = "LINEAR_VERTICAL"),
    (i[(i.LINEAR_HORIZONTAL = 1)] = "LINEAR_HORIZONTAL"),
    i
  ))(_i || {});
  const un = {
      align: "left",
      breakWords: !1,
      dropShadow: !1,
      dropShadowAlpha: 1,
      dropShadowAngle: Math.PI / 6,
      dropShadowBlur: 0,
      dropShadowColor: "black",
      dropShadowDistance: 5,
      fill: "black",
      fillGradientType: _i.LINEAR_VERTICAL,
      fillGradientStops: [],
      fontFamily: "Arial",
      fontSize: 26,
      fontStyle: "normal",
      fontVariant: "normal",
      fontWeight: "normal",
      letterSpacing: 0,
      lineHeight: 0,
      lineJoin: "miter",
      miterLimit: 10,
      padding: 0,
      stroke: "black",
      strokeThickness: 0,
      textBaseline: "alphabetic",
      trim: !1,
      whiteSpace: "pre",
      wordWrap: !1,
      wordWrapWidth: 100,
      leading: 0,
    },
    rp = ["serif", "sans-serif", "monospace", "cursive", "fantasy", "system-ui"];
  class re {
    constructor(t) {
      (this.styleID = 0), this.reset(), dn(this, t, t);
    }
    clone() {
      const t = {};
      return dn(t, this, un), new re(t);
    }
    reset() {
      dn(this, un, un);
    }
    get align() {
      return this._align;
    }
    set align(t) {
      this._align !== t && ((this._align = t), this.styleID++);
    }
    get breakWords() {
      return this._breakWords;
    }
    set breakWords(t) {
      this._breakWords !== t && ((this._breakWords = t), this.styleID++);
    }
    get dropShadow() {
      return this._dropShadow;
    }
    set dropShadow(t) {
      this._dropShadow !== t && ((this._dropShadow = t), this.styleID++);
    }
    get dropShadowAlpha() {
      return this._dropShadowAlpha;
    }
    set dropShadowAlpha(t) {
      this._dropShadowAlpha !== t && ((this._dropShadowAlpha = t), this.styleID++);
    }
    get dropShadowAngle() {
      return this._dropShadowAngle;
    }
    set dropShadowAngle(t) {
      this._dropShadowAngle !== t && ((this._dropShadowAngle = t), this.styleID++);
    }
    get dropShadowBlur() {
      return this._dropShadowBlur;
    }
    set dropShadowBlur(t) {
      this._dropShadowBlur !== t && ((this._dropShadowBlur = t), this.styleID++);
    }
    get dropShadowColor() {
      return this._dropShadowColor;
    }
    set dropShadowColor(t) {
      const e = cn(t);
      this._dropShadowColor !== e && ((this._dropShadowColor = e), this.styleID++);
    }
    get dropShadowDistance() {
      return this._dropShadowDistance;
    }
    set dropShadowDistance(t) {
      this._dropShadowDistance !== t && ((this._dropShadowDistance = t), this.styleID++);
    }
    get fill() {
      return this._fill;
    }
    set fill(t) {
      const e = cn(t);
      this._fill !== e && ((this._fill = e), this.styleID++);
    }
    get fillGradientType() {
      return this._fillGradientType;
    }
    set fillGradientType(t) {
      this._fillGradientType !== t && ((this._fillGradientType = t), this.styleID++);
    }
    get fillGradientStops() {
      return this._fillGradientStops;
    }
    set fillGradientStops(t) {
      sp(this._fillGradientStops, t) || ((this._fillGradientStops = t), this.styleID++);
    }
    get fontFamily() {
      return this._fontFamily;
    }
    set fontFamily(t) {
      this.fontFamily !== t && ((this._fontFamily = t), this.styleID++);
    }
    get fontSize() {
      return this._fontSize;
    }
    set fontSize(t) {
      this._fontSize !== t && ((this._fontSize = t), this.styleID++);
    }
    get fontStyle() {
      return this._fontStyle;
    }
    set fontStyle(t) {
      this._fontStyle !== t && ((this._fontStyle = t), this.styleID++);
    }
    get fontVariant() {
      return this._fontVariant;
    }
    set fontVariant(t) {
      this._fontVariant !== t && ((this._fontVariant = t), this.styleID++);
    }
    get fontWeight() {
      return this._fontWeight;
    }
    set fontWeight(t) {
      this._fontWeight !== t && ((this._fontWeight = t), this.styleID++);
    }
    get letterSpacing() {
      return this._letterSpacing;
    }
    set letterSpacing(t) {
      this._letterSpacing !== t && ((this._letterSpacing = t), this.styleID++);
    }
    get lineHeight() {
      return this._lineHeight;
    }
    set lineHeight(t) {
      this._lineHeight !== t && ((this._lineHeight = t), this.styleID++);
    }
    get leading() {
      return this._leading;
    }
    set leading(t) {
      this._leading !== t && ((this._leading = t), this.styleID++);
    }
    get lineJoin() {
      return this._lineJoin;
    }
    set lineJoin(t) {
      this._lineJoin !== t && ((this._lineJoin = t), this.styleID++);
    }
    get miterLimit() {
      return this._miterLimit;
    }
    set miterLimit(t) {
      this._miterLimit !== t && ((this._miterLimit = t), this.styleID++);
    }
    get padding() {
      return this._padding;
    }
    set padding(t) {
      this._padding !== t && ((this._padding = t), this.styleID++);
    }
    get stroke() {
      return this._stroke;
    }
    set stroke(t) {
      const e = cn(t);
      this._stroke !== e && ((this._stroke = e), this.styleID++);
    }
    get strokeThickness() {
      return this._strokeThickness;
    }
    set strokeThickness(t) {
      this._strokeThickness !== t && ((this._strokeThickness = t), this.styleID++);
    }
    get textBaseline() {
      return this._textBaseline;
    }
    set textBaseline(t) {
      this._textBaseline !== t && ((this._textBaseline = t), this.styleID++);
    }
    get trim() {
      return this._trim;
    }
    set trim(t) {
      this._trim !== t && ((this._trim = t), this.styleID++);
    }
    get whiteSpace() {
      return this._whiteSpace;
    }
    set whiteSpace(t) {
      this._whiteSpace !== t && ((this._whiteSpace = t), this.styleID++);
    }
    get wordWrap() {
      return this._wordWrap;
    }
    set wordWrap(t) {
      this._wordWrap !== t && ((this._wordWrap = t), this.styleID++);
    }
    get wordWrapWidth() {
      return this._wordWrapWidth;
    }
    set wordWrapWidth(t) {
      this._wordWrapWidth !== t && ((this._wordWrapWidth = t), this.styleID++);
    }
    toFontString() {
      const t = typeof this.fontSize == "number" ? `${this.fontSize}px` : this.fontSize;
      let e = this.fontFamily;
      Array.isArray(this.fontFamily) || (e = this.fontFamily.split(","));
      for (let r = e.length - 1; r >= 0; r--) {
        let s = e[r].trim();
        !/([\"\'])[^\'\"]+\1/.test(s) && !rp.includes(s) && (s = `"${s}"`), (e[r] = s);
      }
      return `${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`;
    }
  }
  function Lo(i) {
    return typeof i == "number"
      ? kr(i)
      : (typeof i == "string" && i.startsWith("0x") && (i = i.replace("0x", "#")), i);
  }
  function cn(i) {
    if (Array.isArray(i)) {
      for (let t = 0; t < i.length; ++t) i[t] = Lo(i[t]);
      return i;
    } else return Lo(i);
  }
  function sp(i, t) {
    if (!Array.isArray(i) || !Array.isArray(t) || i.length !== t.length) return !1;
    for (let e = 0; e < i.length; ++e) if (i[e] !== t[e]) return !1;
    return !0;
  }
  function dn(i, t, e) {
    for (const r in e) Array.isArray(t[r]) ? (i[r] = t[r].slice()) : (i[r] = t[r]);
  }
  class F {
    constructor(t, e, r, s, n, a, o, h, l) {
      (this.text = t),
        (this.style = e),
        (this.width = r),
        (this.height = s),
        (this.lines = n),
        (this.lineWidths = a),
        (this.lineHeight = o),
        (this.maxLineWidth = h),
        (this.fontProperties = l);
    }
    static measureText(t, e, r, s = F._canvas) {
      r = r != null ? r : e.wordWrap;
      const n = e.toFontString(),
        a = F.measureFont(n);
      a.fontSize === 0 && ((a.fontSize = e.fontSize), (a.ascent = e.fontSize));
      const o = s.getContext("2d");
      o.font = n;
      const h = (r ? F.wordWrap(t, e, s) : t).split(/(?:\r\n|\r|\n)/),
        l = new Array(h.length);
      let u = 0;
      for (let p = 0; p < h.length; p++) {
        const g = o.measureText(h[p]).width + (h[p].length - 1) * e.letterSpacing;
        (l[p] = g), (u = Math.max(u, g));
      }
      let c = u + e.strokeThickness;
      e.dropShadow && (c += e.dropShadowDistance);
      const d = e.lineHeight || a.fontSize + e.strokeThickness;
      let f = Math.max(d, a.fontSize + e.strokeThickness) + (h.length - 1) * (d + e.leading);
      return (
        e.dropShadow && (f += e.dropShadowDistance), new F(t, e, c, f, h, l, d + e.leading, u, a)
      );
    }
    static wordWrap(t, e, r = F._canvas) {
      const s = r.getContext("2d");
      let n = 0,
        a = "",
        o = "";
      const h = Object.create(null),
        { letterSpacing: l, whiteSpace: u } = e,
        c = F.collapseSpaces(u),
        d = F.collapseNewlines(u);
      let f = !c;
      const p = e.wordWrapWidth + l,
        g = F.tokenize(t);
      for (let _ = 0; _ < g.length; _++) {
        let T = g[_];
        if (F.isNewline(T)) {
          if (!d) {
            (o += F.addLine(a)), (f = !c), (a = ""), (n = 0);
            continue;
          }
          T = " ";
        }
        if (c) {
          const x = F.isBreakingSpace(T),
            y = F.isBreakingSpace(a[a.length - 1]);
          if (x && y) continue;
        }
        const v = F.getFromCache(T, l, h, s);
        if (v > p)
          if (
            (a !== "" && ((o += F.addLine(a)), (a = ""), (n = 0)), F.canBreakWords(T, e.breakWords))
          ) {
            const x = F.wordWrapSplit(T);
            for (let y = 0; y < x.length; y++) {
              let E = x[y],
                D = 1;
              for (; x[y + D]; ) {
                const R = x[y + D],
                  U = E[E.length - 1];
                if (!F.canBreakChars(U, R, T, y, e.breakWords)) E += R;
                else break;
                D++;
              }
              y += E.length - 1;
              const I = F.getFromCache(E, l, h, s);
              I + n > p && ((o += F.addLine(a)), (f = !1), (a = ""), (n = 0)), (a += E), (n += I);
            }
          } else {
            a.length > 0 && ((o += F.addLine(a)), (a = ""), (n = 0));
            const x = _ === g.length - 1;
            (o += F.addLine(T, !x)), (f = !1), (a = ""), (n = 0);
          }
        else
          v + n > p && ((f = !1), (o += F.addLine(a)), (a = ""), (n = 0)),
            (a.length > 0 || !F.isBreakingSpace(T) || f) && ((a += T), (n += v));
      }
      return (o += F.addLine(a, !1)), o;
    }
    static addLine(t, e = !0) {
      return (
        (t = F.trimRight(t)),
        (t = e
          ? `${t}
`
          : t),
        t
      );
    }
    static getFromCache(t, e, r, s) {
      let n = r[t];
      if (typeof n != "number") {
        const a = t.length * e;
        (n = s.measureText(t).width + a), (r[t] = n);
      }
      return n;
    }
    static collapseSpaces(t) {
      return t === "normal" || t === "pre-line";
    }
    static collapseNewlines(t) {
      return t === "normal";
    }
    static trimRight(t) {
      if (typeof t != "string") return "";
      for (let e = t.length - 1; e >= 0; e--) {
        const r = t[e];
        if (!F.isBreakingSpace(r)) break;
        t = t.slice(0, -1);
      }
      return t;
    }
    static isNewline(t) {
      return typeof t != "string" ? !1 : F._newlines.includes(t.charCodeAt(0));
    }
    static isBreakingSpace(t, e) {
      return typeof t != "string" ? !1 : F._breakingSpaces.includes(t.charCodeAt(0));
    }
    static tokenize(t) {
      const e = [];
      let r = "";
      if (typeof t != "string") return e;
      for (let s = 0; s < t.length; s++) {
        const n = t[s],
          a = t[s + 1];
        if (F.isBreakingSpace(n, a) || F.isNewline(n)) {
          r !== "" && (e.push(r), (r = "")), e.push(n);
          continue;
        }
        r += n;
      }
      return r !== "" && e.push(r), e;
    }
    static canBreakWords(t, e) {
      return e;
    }
    static canBreakChars(t, e, r, s, n) {
      return !0;
    }
    static wordWrapSplit(t) {
      return t.split("");
    }
    static measureFont(t) {
      if (F._fonts[t]) return F._fonts[t];
      const e = { ascent: 0, descent: 0, fontSize: 0 },
        r = F._canvas,
        s = F._context;
      s.font = t;
      const n = F.METRICS_STRING + F.BASELINE_SYMBOL,
        a = Math.ceil(s.measureText(n).width);
      let o = Math.ceil(s.measureText(F.BASELINE_SYMBOL).width);
      const h = Math.ceil(F.HEIGHT_MULTIPLIER * o);
      (o = (o * F.BASELINE_MULTIPLIER) | 0),
        (r.width = a),
        (r.height = h),
        (s.fillStyle = "#f00"),
        s.fillRect(0, 0, a, h),
        (s.font = t),
        (s.textBaseline = "alphabetic"),
        (s.fillStyle = "#000"),
        s.fillText(n, 0, o);
      const l = s.getImageData(0, 0, a, h).data,
        u = l.length,
        c = a * 4;
      let d = 0,
        f = 0,
        p = !1;
      for (d = 0; d < o; ++d) {
        for (let g = 0; g < c; g += 4)
          if (l[f + g] !== 255) {
            p = !0;
            break;
          }
        if (!p) f += c;
        else break;
      }
      for (e.ascent = o - d, f = u - c, p = !1, d = h; d > o; --d) {
        for (let g = 0; g < c; g += 4)
          if (l[f + g] !== 255) {
            p = !0;
            break;
          }
        if (!p) f -= c;
        else break;
      }
      return (e.descent = d - o), (e.fontSize = e.ascent + e.descent), (F._fonts[t] = e), e;
    }
    static clearMetrics(t = "") {
      t ? delete F._fonts[t] : (F._fonts = {});
    }
    static get _canvas() {
      var t;
      if (!F.__canvas) {
        let e;
        try {
          const r = new OffscreenCanvas(0, 0);
          if ((t = r.getContext("2d")) != null && t.measureText) return (F.__canvas = r), r;
          e = A.ADAPTER.createCanvas();
        } catch (r) {
          e = A.ADAPTER.createCanvas();
        }
        (e.width = e.height = 10), (F.__canvas = e);
      }
      return F.__canvas;
    }
    static get _context() {
      return F.__context || (F.__context = F._canvas.getContext("2d")), F.__context;
    }
  }
  (F._fonts = {}),
    (F.METRICS_STRING = "|\xC9q\xC5"),
    (F.BASELINE_SYMBOL = "M"),
    (F.BASELINE_MULTIPLIER = 1.4),
    (F.HEIGHT_MULTIPLIER = 2),
    (F._newlines = [10, 13]),
    (F._breakingSpaces = [
      9, 32, 8192, 8193, 8194, 8195, 8196, 8197, 8198, 8200, 8201, 8202, 8287, 12288,
    ]);
  const np = { texture: !0, children: !1, baseTexture: !0 },
    Go = class extends le {
      constructor(i, t, e) {
        let r = !1;
        e || ((e = A.ADAPTER.createCanvas()), (r = !0)), (e.width = 3), (e.height = 3);
        const s = O.from(e);
        (s.orig = new z()),
          (s.trim = new z()),
          super(s),
          (this._ownCanvas = r),
          (this.canvas = e),
          (this.context = e.getContext("2d")),
          (this._resolution = A.RESOLUTION),
          (this._autoResolution = !0),
          (this._text = null),
          (this._style = null),
          (this._styleListener = null),
          (this._font = ""),
          (this.text = i),
          (this.style = t),
          (this.localStyleID = -1);
      }
      updateText(i) {
        const t = this._style;
        if (
          (this.localStyleID !== t.styleID && ((this.dirty = !0), (this.localStyleID = t.styleID)),
          !this.dirty && i)
        )
          return;
        this._font = this._style.toFontString();
        const e = this.context,
          r = F.measureText(this._text || " ", this._style, this._style.wordWrap, this.canvas),
          s = r.width,
          n = r.height,
          a = r.lines,
          o = r.lineHeight,
          h = r.lineWidths,
          l = r.maxLineWidth,
          u = r.fontProperties;
        (this.canvas.width = Math.ceil(
          Math.ceil(Math.max(1, s) + t.padding * 2) * this._resolution
        )),
          (this.canvas.height = Math.ceil(
            Math.ceil(Math.max(1, n) + t.padding * 2) * this._resolution
          )),
          e.scale(this._resolution, this._resolution),
          e.clearRect(0, 0, this.canvas.width, this.canvas.height),
          (e.font = this._font),
          (e.lineWidth = t.strokeThickness),
          (e.textBaseline = t.textBaseline),
          (e.lineJoin = t.lineJoin),
          (e.miterLimit = t.miterLimit);
        let c, d;
        const f = t.dropShadow ? 2 : 1;
        for (let p = 0; p < f; ++p) {
          const g = t.dropShadow && p === 0,
            _ = g ? Math.ceil(Math.max(1, n) + t.padding * 2) : 0,
            T = _ * this._resolution;
          if (g) {
            (e.fillStyle = "black"), (e.strokeStyle = "black");
            const x = t.dropShadowColor,
              y = ye(typeof x == "number" ? x : Xr(x)),
              E = t.dropShadowBlur * this._resolution,
              D = t.dropShadowDistance * this._resolution;
            (e.shadowColor = `rgba(${y[0] * 255},${y[1] * 255},${y[2] * 255},${
              t.dropShadowAlpha
            })`),
              (e.shadowBlur = E),
              (e.shadowOffsetX = Math.cos(t.dropShadowAngle) * D),
              (e.shadowOffsetY = Math.sin(t.dropShadowAngle) * D + T);
          } else
            (e.fillStyle = this._generateFillStyle(t, a, r)),
              (e.strokeStyle = t.stroke),
              (e.shadowColor = "black"),
              (e.shadowBlur = 0),
              (e.shadowOffsetX = 0),
              (e.shadowOffsetY = 0);
          let v = (o - u.fontSize) / 2;
          o - u.fontSize < 0 && (v = 0);
          for (let x = 0; x < a.length; x++)
            (c = t.strokeThickness / 2),
              (d = t.strokeThickness / 2 + x * o + u.ascent + v),
              t.align === "right" ? (c += l - h[x]) : t.align === "center" && (c += (l - h[x]) / 2),
              t.stroke &&
                t.strokeThickness &&
                this.drawLetterSpacing(a[x], c + t.padding, d + t.padding - _, !0),
              t.fill && this.drawLetterSpacing(a[x], c + t.padding, d + t.padding - _);
        }
        this.updateTexture();
      }
      drawLetterSpacing(i, t, e, r = !1) {
        const s = this._style.letterSpacing,
          n =
            Go.experimentalLetterSpacing &&
            ("letterSpacing" in CanvasRenderingContext2D.prototype ||
              "textLetterSpacing" in CanvasRenderingContext2D.prototype);
        if (s === 0 || n) {
          n && ((this.context.letterSpacing = s), (this.context.textLetterSpacing = s)),
            r ? this.context.strokeText(i, t, e) : this.context.fillText(i, t, e);
          return;
        }
        let a = t;
        const o = Array.from ? Array.from(i) : i.split("");
        let h = this.context.measureText(i).width,
          l = 0;
        for (let u = 0; u < o.length; ++u) {
          const c = o[u];
          r ? this.context.strokeText(c, a, e) : this.context.fillText(c, a, e);
          let d = "";
          for (let f = u + 1; f < o.length; ++f) d += o[f];
          (l = this.context.measureText(d).width), (a += h - l + s), (h = l);
        }
      }
      updateTexture() {
        const i = this.canvas;
        if (this._style.trim) {
          const n = ra(i);
          n.data &&
            ((i.width = n.width), (i.height = n.height), this.context.putImageData(n.data, 0, 0));
        }
        const t = this._texture,
          e = this._style,
          r = e.trim ? 0 : e.padding,
          s = t.baseTexture;
        (t.trim.width = t._frame.width = i.width / this._resolution),
          (t.trim.height = t._frame.height = i.height / this._resolution),
          (t.trim.x = -r),
          (t.trim.y = -r),
          (t.orig.width = t._frame.width - r * 2),
          (t.orig.height = t._frame.height - r * 2),
          this._onTextureUpdate(),
          s.setRealSize(i.width, i.height, this._resolution),
          t.updateUvs(),
          (this.dirty = !1);
      }
      _render(i) {
        this._autoResolution &&
          this._resolution !== i.resolution &&
          ((this._resolution = i.resolution), (this.dirty = !0)),
          this.updateText(!0),
          super._render(i);
      }
      updateTransform() {
        this.updateText(!0), super.updateTransform();
      }
      getBounds(i, t) {
        return this.updateText(!0), this._textureID === -1 && (i = !1), super.getBounds(i, t);
      }
      getLocalBounds(i) {
        return this.updateText(!0), super.getLocalBounds.call(this, i);
      }
      _calculateBounds() {
        this.calculateVertices(), this._bounds.addQuad(this.vertexData);
      }
      _generateFillStyle(i, t, e) {
        const r = i.fill;
        if (Array.isArray(r)) {
          if (r.length === 1) return r[0];
        } else return r;
        let s;
        const n = i.dropShadow ? i.dropShadowDistance : 0,
          a = i.padding || 0,
          o = this.canvas.width / this._resolution - n - a * 2,
          h = this.canvas.height / this._resolution - n - a * 2,
          l = r.slice(),
          u = i.fillGradientStops.slice();
        if (!u.length) {
          const c = l.length + 1;
          for (let d = 1; d < c; ++d) u.push(d / c);
        }
        if (
          (l.unshift(r[0]),
          u.unshift(0),
          l.push(r[r.length - 1]),
          u.push(1),
          i.fillGradientType === _i.LINEAR_VERTICAL)
        ) {
          s = this.context.createLinearGradient(o / 2, a, o / 2, h + a);
          const c = e.fontProperties.fontSize + i.strokeThickness;
          for (let d = 0; d < t.length; d++) {
            const f = e.lineHeight * (d - 1) + c,
              p = e.lineHeight * d;
            let g = p;
            d > 0 && f > p && (g = (p + f) / 2);
            const _ = p + c,
              T = e.lineHeight * (d + 1);
            let v = _;
            d + 1 < t.length && T < _ && (v = (_ + T) / 2);
            const x = (v - g) / h;
            for (let y = 0; y < l.length; y++) {
              let E = 0;
              typeof u[y] == "number" ? (E = u[y]) : (E = y / l.length);
              let D = Math.min(1, Math.max(0, g / h + E * x));
              (D = Number(D.toFixed(5))), s.addColorStop(D, l[y]);
            }
          }
        } else {
          s = this.context.createLinearGradient(a, h / 2, o + a, h / 2);
          const c = l.length + 1;
          let d = 1;
          for (let f = 0; f < l.length; f++) {
            let p;
            typeof u[f] == "number" ? (p = u[f]) : (p = d / c), s.addColorStop(p, l[f]), d++;
          }
        }
        return s;
      }
      destroy(i) {
        typeof i == "boolean" && (i = { children: i }),
          (i = Object.assign({}, np, i)),
          super.destroy(i),
          this._ownCanvas && (this.canvas.height = this.canvas.width = 0),
          (this.context = null),
          (this.canvas = null),
          (this._style = null);
      }
      get width() {
        return this.updateText(!0), Math.abs(this.scale.x) * this._texture.orig.width;
      }
      set width(i) {
        this.updateText(!0);
        const t = be(this.scale.x) || 1;
        (this.scale.x = (t * i) / this._texture.orig.width), (this._width = i);
      }
      get height() {
        return this.updateText(!0), Math.abs(this.scale.y) * this._texture.orig.height;
      }
      set height(i) {
        this.updateText(!0);
        const t = be(this.scale.y) || 1;
        (this.scale.y = (t * i) / this._texture.orig.height), (this._height = i);
      }
      get style() {
        return this._style;
      }
      set style(i) {
        (i = i || {}),
          i instanceof re ? (this._style = i) : (this._style = new re(i)),
          (this.localStyleID = -1),
          (this.dirty = !0);
      }
      get text() {
        return this._text;
      }
      set text(i) {
        (i = String(i != null ? i : "")), this._text !== i && ((this._text = i), (this.dirty = !0));
      }
      get resolution() {
        return this._resolution;
      }
      set resolution(i) {
        (this._autoResolution = !1),
          this._resolution !== i && ((this._resolution = i), (this.dirty = !0));
      }
    };
  let mr = Go;
  (mr.experimentalLetterSpacing = !1), (A.UPLOADS_PER_FRAME = 4);
  class Uo {
    constructor(t) {
      (this.maxItemsPerFrame = t), (this.itemsLeft = 0);
    }
    beginFrame() {
      this.itemsLeft = this.maxItemsPerFrame;
    }
    allowedToUpload() {
      return this.itemsLeft-- > 0;
    }
  }
  function ap(i, t) {
    var r;
    let e = !1;
    if ((r = i == null ? void 0 : i._textures) != null && r.length) {
      for (let s = 0; s < i._textures.length; s++)
        if (i._textures[s] instanceof O) {
          const n = i._textures[s].baseTexture;
          t.includes(n) || (t.push(n), (e = !0));
        }
    }
    return e;
  }
  function op(i, t) {
    if (i.baseTexture instanceof Y) {
      const e = i.baseTexture;
      return t.includes(e) || t.push(e), !0;
    }
    return !1;
  }
  function hp(i, t) {
    if (i._texture && i._texture instanceof O) {
      const e = i._texture.baseTexture;
      return t.includes(e) || t.push(e), !0;
    }
    return !1;
  }
  function lp(i, t) {
    return t instanceof mr ? (t.updateText(!0), !0) : !1;
  }
  function up(i, t) {
    if (t instanceof re) {
      const e = t.toFontString();
      return F.measureFont(e), !0;
    }
    return !1;
  }
  function cp(i, t) {
    if (i instanceof mr) {
      t.includes(i.style) || t.push(i.style), t.includes(i) || t.push(i);
      const e = i._texture.baseTexture;
      return t.includes(e) || t.push(e), !0;
    }
    return !1;
  }
  function dp(i, t) {
    return i instanceof re ? (t.includes(i) || t.push(i), !0) : !1;
  }
  class ko {
    constructor(t) {
      (this.limiter = new Uo(A.UPLOADS_PER_FRAME)),
        (this.renderer = t),
        (this.uploadHookHelper = null),
        (this.queue = []),
        (this.addHooks = []),
        (this.uploadHooks = []),
        (this.completes = []),
        (this.ticking = !1),
        (this.delayedTick = () => {
          !this.queue || this.prepareItems();
        }),
        this.registerFindHook(cp),
        this.registerFindHook(dp),
        this.registerFindHook(ap),
        this.registerFindHook(op),
        this.registerFindHook(hp),
        this.registerUploadHook(lp),
        this.registerUploadHook(up);
    }
    upload(t) {
      return new Promise((e) => {
        t && this.add(t),
          this.queue.length
            ? (this.completes.push(e),
              this.ticking || ((this.ticking = !0), Z.system.addOnce(this.tick, this, oe.UTILITY)))
            : e();
      });
    }
    tick() {
      setTimeout(this.delayedTick, 0);
    }
    prepareItems() {
      for (this.limiter.beginFrame(); this.queue.length && this.limiter.allowedToUpload(); ) {
        const t = this.queue[0];
        let e = !1;
        if (t && !t._destroyed) {
          for (let r = 0, s = this.uploadHooks.length; r < s; r++)
            if (this.uploadHooks[r](this.uploadHookHelper, t)) {
              this.queue.shift(), (e = !0);
              break;
            }
        }
        e || this.queue.shift();
      }
      if (this.queue.length) Z.system.addOnce(this.tick, this, oe.UTILITY);
      else {
        this.ticking = !1;
        const t = this.completes.slice(0);
        this.completes.length = 0;
        for (let e = 0, r = t.length; e < r; e++) t[e]();
      }
    }
    registerFindHook(t) {
      return t && this.addHooks.push(t), this;
    }
    registerUploadHook(t) {
      return t && this.uploadHooks.push(t), this;
    }
    add(t) {
      for (let e = 0, r = this.addHooks.length; e < r && !this.addHooks[e](t, this.queue); e++);
      if (t instanceof vt) for (let e = t.children.length - 1; e >= 0; e--) this.add(t.children[e]);
      return this;
    }
    destroy() {
      this.ticking && Z.system.remove(this.tick, this),
        (this.ticking = !1),
        (this.addHooks = null),
        (this.uploadHooks = null),
        (this.renderer = null),
        (this.completes = null),
        (this.queue = null),
        (this.limiter = null),
        (this.uploadHookHelper = null);
    }
  }
  function Xo(i, t) {
    return t instanceof Y ? (t._glTextures[i.CONTEXT_UID] || i.texture.bind(t), !0) : !1;
  }
  function fp(i, t) {
    if (!(t instanceof fr)) return !1;
    const { geometry: e } = t;
    t.finishPoly(), e.updateBatches();
    const { batches: r } = e;
    for (let s = 0; s < r.length; s++) {
      const { texture: n } = r[s].style;
      n && Xo(i, n.baseTexture);
    }
    return e.batchable || i.geometry.bind(e, t._resolveDirectShader(i)), !0;
  }
  function pp(i, t) {
    return i instanceof fr ? (t.push(i), !0) : !1;
  }
  class fn extends ko {
    constructor(t) {
      super(t),
        (this.uploadHookHelper = this.renderer),
        this.registerFindHook(pp),
        this.registerUploadHook(Xo),
        this.registerUploadHook(fp);
    }
  }
  (fn.extension = { name: "prepare", type: P.RendererSystem }), B.add(fn);
  class mp {
    constructor(t) {
      (this.maxMilliseconds = t), (this.frameStart = 0);
    }
    beginFrame() {
      this.frameStart = Date.now();
    }
    allowedToUpload() {
      return Date.now() - this.frameStart < this.maxMilliseconds;
    }
  }
  const gi = class {
    constructor(i, t, e = null) {
      (this.linkedSheets = []),
        (this._texture = i instanceof O ? i : null),
        (this.baseTexture = i instanceof Y ? i : this._texture.baseTexture),
        (this.textures = {}),
        (this.animations = {}),
        (this.data = t);
      const r = this.baseTexture.resource;
      (this.resolution = this._updateResolution(e || (r ? r.url : null))),
        (this._frames = this.data.frames),
        (this._frameKeys = Object.keys(this._frames)),
        (this._batchIndex = 0),
        (this._callback = null);
    }
    _updateResolution(i = null) {
      const { scale: t } = this.data.meta;
      let e = Qt(i, null);
      return (
        e === null && (e = parseFloat(t != null ? t : "1")),
        e !== 1 && this.baseTexture.setResolution(e),
        e
      );
    }
    parse() {
      return new Promise((i) => {
        (this._callback = i),
          (this._batchIndex = 0),
          this._frameKeys.length <= gi.BATCH_SIZE
            ? (this._processFrames(0), this._processAnimations(), this._parseComplete())
            : this._nextBatch();
      });
    }
    _processFrames(i) {
      let t = i;
      const e = gi.BATCH_SIZE;
      for (; t - i < e && t < this._frameKeys.length; ) {
        const r = this._frameKeys[t],
          s = this._frames[r],
          n = s.frame;
        if (n) {
          let a = null,
            o = null;
          const h = s.trimmed !== !1 && s.sourceSize ? s.sourceSize : s.frame,
            l = new z(0, 0, Math.floor(h.w) / this.resolution, Math.floor(h.h) / this.resolution);
          s.rotated
            ? (a = new z(
                Math.floor(n.x) / this.resolution,
                Math.floor(n.y) / this.resolution,
                Math.floor(n.h) / this.resolution,
                Math.floor(n.w) / this.resolution
              ))
            : (a = new z(
                Math.floor(n.x) / this.resolution,
                Math.floor(n.y) / this.resolution,
                Math.floor(n.w) / this.resolution,
                Math.floor(n.h) / this.resolution
              )),
            s.trimmed !== !1 &&
              s.spriteSourceSize &&
              (o = new z(
                Math.floor(s.spriteSourceSize.x) / this.resolution,
                Math.floor(s.spriteSourceSize.y) / this.resolution,
                Math.floor(n.w) / this.resolution,
                Math.floor(n.h) / this.resolution
              )),
            (this.textures[r] = new O(this.baseTexture, a, l, o, s.rotated ? 2 : 0, s.anchor)),
            O.addToCache(this.textures[r], r);
        }
        t++;
      }
    }
    _processAnimations() {
      const i = this.data.animations || {};
      for (const t in i) {
        this.animations[t] = [];
        for (let e = 0; e < i[t].length; e++) {
          const r = i[t][e];
          this.animations[t].push(this.textures[r]);
        }
      }
    }
    _parseComplete() {
      const i = this._callback;
      (this._callback = null), (this._batchIndex = 0), i.call(this, this.textures);
    }
    _nextBatch() {
      this._processFrames(this._batchIndex * gi.BATCH_SIZE),
        this._batchIndex++,
        setTimeout(() => {
          this._batchIndex * gi.BATCH_SIZE < this._frameKeys.length
            ? this._nextBatch()
            : (this._processAnimations(), this._parseComplete());
        }, 0);
    }
    destroy(i = !1) {
      var t;
      for (const e in this.textures) this.textures[e].destroy();
      (this._frames = null),
        (this._frameKeys = null),
        (this.data = null),
        (this.textures = null),
        i && ((t = this._texture) == null || t.destroy(), this.baseTexture.destroy()),
        (this._texture = null),
        (this.baseTexture = null),
        (this.linkedSheets = []);
    }
  };
  let _r = gi;
  _r.BATCH_SIZE = 1e3;
  const $o = {
    extension: { type: P.LoadParser, priority: Lt.Normal },
    async testParse(i, t) {
      return dt.extname(t.src).includes(".json") && !!i.frames;
    },
    async parse(i, t, e) {
      var h, l;
      let r = dt.dirname(t.src);
      r && r.lastIndexOf("/") !== r.length - 1 && (r += "/");
      const s = r + i.meta.image,
        n = (await e.load([s]))[s],
        a = new _r(n.baseTexture, i, t.src);
      await a.parse();
      const o = (h = i == null ? void 0 : i.meta) == null ? void 0 : h.related_multi_packs;
      if (Array.isArray(o)) {
        const u = [];
        for (const d of o) {
          if (typeof d != "string") continue;
          const f = r + d;
          ((l = t.data) != null && l.ignoreMultiPack) ||
            u.push(e.load({ src: f, data: { ignoreMultiPack: !0 } }));
        }
        const c = await Promise.all(u);
        (a.linkedSheets = c),
          c.forEach((d) => {
            d.linkedSheets = [a].concat(a.linkedSheets.filter((f) => f !== d));
          });
      }
      return a;
    },
    unload(i) {
      i.destroy(!0);
    },
  };
  B.add($o);
  function Ho(i, t, e) {
    const r = {};
    if (
      (i.forEach((s) => {
        r[s] = t;
      }),
      Object.keys(t.textures).forEach((s) => {
        r[s] = t.textures[s];
      }),
      !e)
    ) {
      const s = dt.dirname(i[0]);
      t.linkedSheets.forEach((n, a) => {
        const o = Ho([`${s}/${t.data.meta.related_multi_packs[a]}`], n, !0);
        Object.assign(r, o);
      });
    }
    return r;
  }
  const zo = {
    extension: P.CacheParser,
    test: (i) => i instanceof _r,
    getCacheableAssets: (i, t) => Ho(i, t, !1),
  };
  B.add(zo);
  const _p = ["jpg", "png", "jpeg", "avif", "webp"],
    Wo = {
      extension: P.ResolveParser,
      test: (i) => {
        const t = i.split("?")[0].split("."),
          e = t.pop(),
          r = t.pop();
        return e === "json" && _p.includes(r);
      },
      parse: (i) => {
        var e, r;
        const t = i.split(".");
        return {
          resolution: parseFloat(
            (r = (e = A.RETINA_PREFIX.exec(i)) == null ? void 0 : e[1]) != null ? r : "1"
          ),
          format: t[t.length - 2],
          src: i,
        };
      },
    };
  B.add(Wo);
  class gr extends le {
    constructor(t, e = !0) {
      super(t[0] instanceof O ? t[0] : t[0].texture),
        (this._textures = null),
        (this._durations = null),
        (this._autoUpdate = e),
        (this._isConnectedToTicker = !1),
        (this.animationSpeed = 1),
        (this.loop = !0),
        (this.updateAnchor = !1),
        (this.onComplete = null),
        (this.onFrameChange = null),
        (this.onLoop = null),
        (this._currentTime = 0),
        (this._playing = !1),
        (this._previousFrame = null),
        (this.textures = t);
    }
    stop() {
      !this._playing ||
        ((this._playing = !1),
        this._autoUpdate &&
          this._isConnectedToTicker &&
          (Z.shared.remove(this.update, this), (this._isConnectedToTicker = !1)));
    }
    play() {
      this._playing ||
        ((this._playing = !0),
        this._autoUpdate &&
          !this._isConnectedToTicker &&
          (Z.shared.add(this.update, this, oe.HIGH), (this._isConnectedToTicker = !0)));
    }
    gotoAndStop(t) {
      this.stop();
      const e = this.currentFrame;
      (this._currentTime = t), e !== this.currentFrame && this.updateTexture();
    }
    gotoAndPlay(t) {
      const e = this.currentFrame;
      (this._currentTime = t), e !== this.currentFrame && this.updateTexture(), this.play();
    }
    update(t) {
      if (!this._playing) return;
      const e = this.animationSpeed * t,
        r = this.currentFrame;
      if (this._durations !== null) {
        let s = (this._currentTime % 1) * this._durations[this.currentFrame];
        for (s += (e / 60) * 1e3; s < 0; )
          this._currentTime--, (s += this._durations[this.currentFrame]);
        const n = Math.sign(this.animationSpeed * t);
        for (
          this._currentTime = Math.floor(this._currentTime);
          s >= this._durations[this.currentFrame];

        )
          (s -= this._durations[this.currentFrame] * n), (this._currentTime += n);
        this._currentTime += s / this._durations[this.currentFrame];
      } else this._currentTime += e;
      this._currentTime < 0 && !this.loop
        ? (this.gotoAndStop(0), this.onComplete && this.onComplete())
        : this._currentTime >= this._textures.length && !this.loop
        ? (this.gotoAndStop(this._textures.length - 1), this.onComplete && this.onComplete())
        : r !== this.currentFrame &&
          (this.loop &&
            this.onLoop &&
            (this.animationSpeed > 0 && this.currentFrame < r
              ? this.onLoop()
              : this.animationSpeed < 0 && this.currentFrame > r && this.onLoop()),
          this.updateTexture());
    }
    updateTexture() {
      const t = this.currentFrame;
      this._previousFrame !== t &&
        ((this._previousFrame = t),
        (this._texture = this._textures[t]),
        (this._textureID = -1),
        (this._textureTrimmedID = -1),
        (this._cachedTint = 16777215),
        (this.uvs = this._texture._uvs.uvsFloat32),
        this.updateAnchor && this._anchor.copyFrom(this._texture.defaultAnchor),
        this.onFrameChange && this.onFrameChange(this.currentFrame));
    }
    destroy(t) {
      this.stop(),
        super.destroy(t),
        (this.onComplete = null),
        (this.onFrameChange = null),
        (this.onLoop = null);
    }
    static fromFrames(t) {
      const e = [];
      for (let r = 0; r < t.length; ++r) e.push(O.from(t[r]));
      return new gr(e);
    }
    static fromImages(t) {
      const e = [];
      for (let r = 0; r < t.length; ++r) e.push(O.from(t[r]));
      return new gr(e);
    }
    get totalFrames() {
      return this._textures.length;
    }
    get textures() {
      return this._textures;
    }
    set textures(t) {
      if (t[0] instanceof O) (this._textures = t), (this._durations = null);
      else {
        (this._textures = []), (this._durations = []);
        for (let e = 0; e < t.length; e++)
          this._textures.push(t[e].texture), this._durations.push(t[e].time);
      }
      (this._previousFrame = null), this.gotoAndStop(0), this.updateTexture();
    }
    get currentFrame() {
      let t = Math.floor(this._currentTime) % this._textures.length;
      return t < 0 && (t += this._textures.length), t;
    }
    get playing() {
      return this._playing;
    }
    get autoUpdate() {
      return this._autoUpdate;
    }
    set autoUpdate(t) {
      t !== this._autoUpdate &&
        ((this._autoUpdate = t),
        !this._autoUpdate && this._isConnectedToTicker
          ? (Z.shared.remove(this.update, this), (this._isConnectedToTicker = !1))
          : this._autoUpdate &&
            !this._isConnectedToTicker &&
            this._playing &&
            (Z.shared.add(this.update, this), (this._isConnectedToTicker = !0)));
    }
  }
  const xi = new V();
  class pn extends le {
    constructor(t, e = 100, r = 100) {
      super(t),
        (this.tileTransform = new ze()),
        (this._width = e),
        (this._height = r),
        (this.uvMatrix = this.texture.uvMatrix || new Vi(t)),
        (this.pluginName = "tilingSprite"),
        (this.uvRespectAnchor = !1);
    }
    get clampMargin() {
      return this.uvMatrix.clampMargin;
    }
    set clampMargin(t) {
      (this.uvMatrix.clampMargin = t), this.uvMatrix.update(!0);
    }
    get tileScale() {
      return this.tileTransform.scale;
    }
    set tileScale(t) {
      this.tileTransform.scale.copyFrom(t);
    }
    get tilePosition() {
      return this.tileTransform.position;
    }
    set tilePosition(t) {
      this.tileTransform.position.copyFrom(t);
    }
    _onTextureUpdate() {
      this.uvMatrix && (this.uvMatrix.texture = this._texture), (this._cachedTint = 16777215);
    }
    _render(t) {
      const e = this._texture;
      !e ||
        !e.valid ||
        (this.tileTransform.updateLocalTransform(),
        this.uvMatrix.update(),
        t.batch.setObjectRenderer(t.plugins[this.pluginName]),
        t.plugins[this.pluginName].render(this));
    }
    _calculateBounds() {
      const t = this._width * -this._anchor._x,
        e = this._height * -this._anchor._y,
        r = this._width * (1 - this._anchor._x),
        s = this._height * (1 - this._anchor._y);
      this._bounds.addFrame(this.transform, t, e, r, s);
    }
    getLocalBounds(t) {
      return this.children.length === 0
        ? ((this._bounds.minX = this._width * -this._anchor._x),
          (this._bounds.minY = this._height * -this._anchor._y),
          (this._bounds.maxX = this._width * (1 - this._anchor._x)),
          (this._bounds.maxY = this._height * (1 - this._anchor._y)),
          t ||
            (this._localBoundsRect || (this._localBoundsRect = new z()),
            (t = this._localBoundsRect)),
          this._bounds.getRectangle(t))
        : super.getLocalBounds.call(this, t);
    }
    containsPoint(t) {
      this.worldTransform.applyInverse(t, xi);
      const e = this._width,
        r = this._height,
        s = -e * this.anchor._x;
      if (xi.x >= s && xi.x < s + e) {
        const n = -r * this.anchor._y;
        if (xi.y >= n && xi.y < n + r) return !0;
      }
      return !1;
    }
    destroy(t) {
      super.destroy(t), (this.tileTransform = null), (this.uvMatrix = null);
    }
    static from(t, e) {
      const r = t instanceof O ? t : O.from(t, e);
      return new pn(r, e.width, e.height);
    }
    get width() {
      return this._width;
    }
    set width(t) {
      this._width = t;
    }
    get height() {
      return this._height;
    }
    set height(t) {
      this._height = t;
    }
  }
  var gp = `#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,
    Vo = `#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,
    xp = `#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,
    Tp = `#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,
    yp = `#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;
  const xr = new Q();
  class Yo extends ti {
    constructor(t) {
      super(t),
        t.runners.contextChange.add(this),
        (this.quad = new rs()),
        (this.state = Wt.for2d());
    }
    contextChange() {
      const t = this.renderer,
        e = { globals: t.globalUniforms };
      (this.simpleShader = Bt.from(Vo, gp, e)),
        (this.shader = t.context.webGLVersion > 1 ? Bt.from(Tp, yp, e) : Bt.from(Vo, xp, e));
    }
    render(t) {
      const e = this.renderer,
        r = this.quad;
      let s = r.vertices;
      (s[0] = s[6] = t._width * -t.anchor.x),
        (s[1] = s[3] = t._height * -t.anchor.y),
        (s[2] = s[4] = t._width * (1 - t.anchor.x)),
        (s[5] = s[7] = t._height * (1 - t.anchor.y));
      const n = t.uvRespectAnchor ? t.anchor.x : 0,
        a = t.uvRespectAnchor ? t.anchor.y : 0;
      (s = r.uvs),
        (s[0] = s[6] = -n),
        (s[1] = s[3] = -a),
        (s[2] = s[4] = 1 - n),
        (s[5] = s[7] = 1 - a),
        r.invalidate();
      const o = t._texture,
        h = o.baseTexture,
        l = h.alphaMode > 0,
        u = t.tileTransform.localTransform,
        c = t.uvMatrix;
      let d = h.isPowerOfTwo && o.frame.width === h.width && o.frame.height === h.height;
      d &&
        (h._glTextures[e.CONTEXT_UID]
          ? (d = h.wrapMode !== qt.CLAMP)
          : h.wrapMode === qt.CLAMP && (h.wrapMode = qt.REPEAT));
      const f = d ? this.simpleShader : this.shader,
        p = o.width,
        g = o.height,
        _ = t._width,
        T = t._height;
      xr.set((u.a * p) / _, (u.b * p) / T, (u.c * g) / _, (u.d * g) / T, u.tx / _, u.ty / T),
        xr.invert(),
        d
          ? xr.prepend(c.mapCoord)
          : ((f.uniforms.uMapCoord = c.mapCoord.toArray(!0)),
            (f.uniforms.uClampFrame = c.uClampFrame),
            (f.uniforms.uClampOffset = c.uClampOffset)),
        (f.uniforms.uTransform = xr.toArray(!0)),
        (f.uniforms.uColor = zr(t.tint, t.worldAlpha, f.uniforms.uColor, l)),
        (f.uniforms.translationMatrix = t.transform.worldTransform.toArray(!0)),
        (f.uniforms.uSampler = o),
        e.shader.bind(f),
        e.geometry.bind(r),
        (this.state.blendMode = Hr(t.blendMode, l)),
        e.state.set(this.state),
        e.geometry.draw(this.renderer.gl.TRIANGLES, 6, 0);
    }
  }
  Yo.extension = { name: "tilingSprite", type: P.RendererPlugin };
  class Ti {
    constructor() {
      (this.info = []),
        (this.common = []),
        (this.page = []),
        (this.char = []),
        (this.kerning = []),
        (this.distanceField = []);
    }
  }
  class yi {
    static test(t) {
      return typeof t == "string" && t.startsWith("info face=");
    }
    static parse(t) {
      const e = t.match(/^[a-z]+\s+.+$/gm),
        r = {
          info: [],
          common: [],
          page: [],
          char: [],
          chars: [],
          kerning: [],
          kernings: [],
          distanceField: [],
        };
      for (const n in e) {
        const a = e[n].match(/^[a-z]+/gm)[0],
          o = e[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),
          h = {};
        for (const l in o) {
          const u = o[l].split("="),
            c = u[0],
            d = u[1].replace(/"/gm, ""),
            f = parseFloat(d),
            p = isNaN(f) ? d : f;
          h[c] = p;
        }
        r[a].push(h);
      }
      const s = new Ti();
      return (
        r.info.forEach((n) => s.info.push({ face: n.face, size: parseInt(n.size, 10) })),
        r.common.forEach((n) => s.common.push({ lineHeight: parseInt(n.lineHeight, 10) })),
        r.page.forEach((n) => s.page.push({ id: parseInt(n.id, 10), file: n.file })),
        r.char.forEach((n) =>
          s.char.push({
            id: parseInt(n.id, 10),
            page: parseInt(n.page, 10),
            x: parseInt(n.x, 10),
            y: parseInt(n.y, 10),
            width: parseInt(n.width, 10),
            height: parseInt(n.height, 10),
            xoffset: parseInt(n.xoffset, 10),
            yoffset: parseInt(n.yoffset, 10),
            xadvance: parseInt(n.xadvance, 10),
          })
        ),
        r.kerning.forEach((n) =>
          s.kerning.push({
            first: parseInt(n.first, 10),
            second: parseInt(n.second, 10),
            amount: parseInt(n.amount, 10),
          })
        ),
        r.distanceField.forEach((n) =>
          s.distanceField.push({
            distanceRange: parseInt(n.distanceRange, 10),
            fieldType: n.fieldType,
          })
        ),
        s
      );
    }
  }
  class Tr {
    static test(t) {
      return (
        t instanceof XMLDocument &&
        t.getElementsByTagName("page").length &&
        t.getElementsByTagName("info")[0].getAttribute("face") !== null
      );
    }
    static parse(t) {
      const e = new Ti(),
        r = t.getElementsByTagName("info"),
        s = t.getElementsByTagName("common"),
        n = t.getElementsByTagName("page"),
        a = t.getElementsByTagName("char"),
        o = t.getElementsByTagName("kerning"),
        h = t.getElementsByTagName("distanceField");
      for (let l = 0; l < r.length; l++)
        e.info.push({
          face: r[l].getAttribute("face"),
          size: parseInt(r[l].getAttribute("size"), 10),
        });
      for (let l = 0; l < s.length; l++)
        e.common.push({ lineHeight: parseInt(s[l].getAttribute("lineHeight"), 10) });
      for (let l = 0; l < n.length; l++)
        e.page.push({
          id: parseInt(n[l].getAttribute("id"), 10) || 0,
          file: n[l].getAttribute("file"),
        });
      for (let l = 0; l < a.length; l++) {
        const u = a[l];
        e.char.push({
          id: parseInt(u.getAttribute("id"), 10),
          page: parseInt(u.getAttribute("page"), 10) || 0,
          x: parseInt(u.getAttribute("x"), 10),
          y: parseInt(u.getAttribute("y"), 10),
          width: parseInt(u.getAttribute("width"), 10),
          height: parseInt(u.getAttribute("height"), 10),
          xoffset: parseInt(u.getAttribute("xoffset"), 10),
          yoffset: parseInt(u.getAttribute("yoffset"), 10),
          xadvance: parseInt(u.getAttribute("xadvance"), 10),
        });
      }
      for (let l = 0; l < o.length; l++)
        e.kerning.push({
          first: parseInt(o[l].getAttribute("first"), 10),
          second: parseInt(o[l].getAttribute("second"), 10),
          amount: parseInt(o[l].getAttribute("amount"), 10),
        });
      for (let l = 0; l < h.length; l++)
        e.distanceField.push({
          fieldType: h[l].getAttribute("fieldType"),
          distanceRange: parseInt(h[l].getAttribute("distanceRange"), 10),
        });
      return e;
    }
  }
  class yr {
    static test(t) {
      if (typeof t == "string" && t.includes("<font>")) {
        const e = new globalThis.DOMParser().parseFromString(t, "text/xml");
        return Tr.test(e);
      }
      return !1;
    }
    static parse(t) {
      const e = new globalThis.DOMParser().parseFromString(t, "text/xml");
      return Tr.parse(e);
    }
  }
  const mn = [yi, Tr, yr];
  function jo(i) {
    for (let t = 0; t < mn.length; t++) if (mn[t].test(i)) return mn[t];
    return null;
  }
  function vp(i, t, e, r, s, n) {
    const a = e.fill;
    if (Array.isArray(a)) {
      if (a.length === 1) return a[0];
    } else return a;
    let o;
    const h = e.dropShadow ? e.dropShadowDistance : 0,
      l = e.padding || 0,
      u = i.width / r - h - l * 2,
      c = i.height / r - h - l * 2,
      d = a.slice(),
      f = e.fillGradientStops.slice();
    if (!f.length) {
      const p = d.length + 1;
      for (let g = 1; g < p; ++g) f.push(g / p);
    }
    if (
      (d.unshift(a[0]),
      f.unshift(0),
      d.push(a[a.length - 1]),
      f.push(1),
      e.fillGradientType === _i.LINEAR_VERTICAL)
    ) {
      o = t.createLinearGradient(u / 2, l, u / 2, c + l);
      let p = 0;
      const g = (n.fontProperties.fontSize + e.strokeThickness) / c;
      for (let _ = 0; _ < s.length; _++) {
        const T = n.lineHeight * _;
        for (let v = 0; v < d.length; v++) {
          let x = 0;
          typeof f[v] == "number" ? (x = f[v]) : (x = v / d.length);
          const y = T / c + x * g;
          let E = Math.max(p, y);
          (E = Math.min(E, 1)), o.addColorStop(E, d[v]), (p = E);
        }
      }
    } else {
      o = t.createLinearGradient(l, c / 2, u + l, c / 2);
      const p = d.length + 1;
      let g = 1;
      for (let _ = 0; _ < d.length; _++) {
        let T;
        typeof f[_] == "number" ? (T = f[_]) : (T = g / p), o.addColorStop(T, d[_]), g++;
      }
    }
    return o;
  }
  function bp(i, t, e, r, s, n, a) {
    const o = e.text,
      h = e.fontProperties;
    t.translate(r, s), t.scale(n, n);
    const l = a.strokeThickness / 2,
      u = -(a.strokeThickness / 2);
    if (
      ((t.font = a.toFontString()),
      (t.lineWidth = a.strokeThickness),
      (t.textBaseline = a.textBaseline),
      (t.lineJoin = a.lineJoin),
      (t.miterLimit = a.miterLimit),
      (t.fillStyle = vp(i, t, a, n, [o], e)),
      (t.strokeStyle = a.stroke),
      a.dropShadow)
    ) {
      const c = a.dropShadowColor,
        d = ye(typeof c == "number" ? c : Xr(c)),
        f = a.dropShadowBlur * n,
        p = a.dropShadowDistance * n;
      (t.shadowColor = `rgba(${d[0] * 255},${d[1] * 255},${d[2] * 255},${a.dropShadowAlpha})`),
        (t.shadowBlur = f),
        (t.shadowOffsetX = Math.cos(a.dropShadowAngle) * p),
        (t.shadowOffsetY = Math.sin(a.dropShadowAngle) * p);
    } else
      (t.shadowColor = "black"), (t.shadowBlur = 0), (t.shadowOffsetX = 0), (t.shadowOffsetY = 0);
    a.stroke && a.strokeThickness && t.strokeText(o, l, u + e.lineHeight - h.descent),
      a.fill && t.fillText(o, l, u + e.lineHeight - h.descent),
      t.setTransform(1, 0, 0, 1, 0, 0),
      (t.fillStyle = "rgba(0, 0, 0, 0)");
  }
  function qo(i) {
    return Array.from ? Array.from(i) : i.split("");
  }
  function Ep(i) {
    typeof i == "string" && (i = [i]);
    const t = [];
    for (let e = 0, r = i.length; e < r; e++) {
      const s = i[e];
      if (Array.isArray(s)) {
        if (s.length !== 2)
          throw new Error(
            `[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`
          );
        const n = s[0].charCodeAt(0),
          a = s[1].charCodeAt(0);
        if (a < n) throw new Error("[BitmapFont]: Invalid character range.");
        for (let o = n, h = a; o <= h; o++) t.push(String.fromCharCode(o));
      } else t.push(...qo(s));
    }
    if (t.length === 0) throw new Error("[BitmapFont]: Empty set when resolving characters.");
    return t;
  }
  function vr(i) {
    return i.codePointAt ? i.codePointAt(0) : i.charCodeAt(0);
  }
  const Ut = class {
    constructor(i, t, e) {
      var l, u;
      const [r] = i.info,
        [s] = i.common,
        [n] = i.page,
        [a] = i.distanceField,
        o = Qt(n.file),
        h = {};
      (this._ownsTextures = e),
        (this.font = r.face),
        (this.size = r.size),
        (this.lineHeight = s.lineHeight / o),
        (this.chars = {}),
        (this.pageTextures = h);
      for (let c = 0; c < i.page.length; c++) {
        const { id: d, file: f } = i.page[c];
        (h[d] = t instanceof Array ? t[c] : t[f]),
          (a == null ? void 0 : a.fieldType) &&
            a.fieldType !== "none" &&
            (h[d].baseTexture.alphaMode = Pt.NO_PREMULTIPLIED_ALPHA);
      }
      for (let c = 0; c < i.char.length; c++) {
        const { id: d, page: f } = i.char[c];
        let { x: p, y: g, width: _, height: T, xoffset: v, yoffset: x, xadvance: y } = i.char[c];
        (p /= o), (g /= o), (_ /= o), (T /= o), (v /= o), (x /= o), (y /= o);
        const E = new z(p + h[f].frame.x / o, g + h[f].frame.y / o, _, T);
        this.chars[d] = {
          xOffset: v,
          yOffset: x,
          xAdvance: y,
          kerning: {},
          texture: new O(h[f].baseTexture, E),
          page: f,
        };
      }
      for (let c = 0; c < i.kerning.length; c++) {
        let { first: d, second: f, amount: p } = i.kerning[c];
        (d /= o), (f /= o), (p /= o), this.chars[f] && (this.chars[f].kerning[d] = p);
      }
      (this.distanceFieldRange = a == null ? void 0 : a.distanceRange),
        (this.distanceFieldType =
          (u = (l = a == null ? void 0 : a.fieldType) == null ? void 0 : l.toLowerCase()) != null
            ? u
            : "none");
    }
    destroy() {
      for (const i in this.chars) this.chars[i].texture.destroy(), (this.chars[i].texture = null);
      for (const i in this.pageTextures)
        this._ownsTextures && this.pageTextures[i].destroy(!0), (this.pageTextures[i] = null);
      (this.chars = null), (this.pageTextures = null);
    }
    static install(i, t, e) {
      let r;
      if (i instanceof Ti) r = i;
      else {
        const n = jo(i);
        if (!n) throw new Error("Unrecognized data format for font.");
        r = n.parse(i);
      }
      t instanceof O && (t = [t]);
      const s = new Ut(r, t, e);
      return (Ut.available[s.font] = s), s;
    }
    static uninstall(i) {
      const t = Ut.available[i];
      if (!t) throw new Error(`No font found named '${i}'`);
      t.destroy(), delete Ut.available[i];
    }
    static from(i, t, e) {
      if (!i) throw new Error("[BitmapFont] Property `name` is required.");
      const {
          chars: r,
          padding: s,
          resolution: n,
          textureWidth: a,
          textureHeight: o,
        } = Object.assign({}, Ut.defaultOptions, e),
        h = Ep(r),
        l = t instanceof re ? t : new re(t),
        u = a,
        c = new Ti();
      (c.info[0] = { face: l.fontFamily, size: l.fontSize }),
        (c.common[0] = { lineHeight: l.fontSize });
      let d = 0,
        f = 0,
        p,
        g,
        _,
        T = 0;
      const v = [];
      for (let y = 0; y < h.length; y++) {
        p ||
          ((p = A.ADAPTER.createCanvas()),
          (p.width = a),
          (p.height = o),
          (g = p.getContext("2d")),
          (_ = new Y(p, { resolution: n })),
          v.push(new O(_)),
          c.page.push({ id: v.length - 1, file: "" }));
        const E = F.measureText(h[y], l, !1, p),
          D = E.width,
          I = Math.ceil(E.height),
          R = Math.ceil((l.fontStyle === "italic" ? 2 : 1) * D);
        if (f >= o - I * n) {
          if (f === 0)
            throw new Error(
              `[BitmapFont] textureHeight ${o}px is too small for ${l.fontSize}px fonts`
            );
          --y, (p = null), (g = null), (_ = null), (f = 0), (d = 0), (T = 0);
          continue;
        }
        if (((T = Math.max(I + E.fontProperties.descent, T)), R * n + d >= u)) {
          --y, (f += T * n), (f = Math.ceil(f)), (d = 0), (T = 0);
          continue;
        }
        bp(p, g, E, d, f, n, l);
        const U = vr(E.text);
        c.char.push({
          id: U,
          page: v.length - 1,
          x: d / n,
          y: f / n,
          width: R,
          height: I,
          xoffset: 0,
          yoffset: 0,
          xadvance: Math.ceil(
            D - (l.dropShadow ? l.dropShadowDistance : 0) - (l.stroke ? l.strokeThickness : 0)
          ),
        }),
          (d += (R + 2 * s) * n),
          (d = Math.ceil(d));
      }
      for (let y = 0, E = h.length; y < E; y++) {
        const D = h[y];
        for (let I = 0; I < E; I++) {
          const R = h[I],
            U = g.measureText(D).width,
            w = g.measureText(R).width,
            C = g.measureText(D + R).width - (U + w);
          C && c.kerning.push({ first: vr(D), second: vr(R), amount: C });
        }
      }
      const x = new Ut(c, v, !0);
      return Ut.available[i] !== void 0 && Ut.uninstall(i), (Ut.available[i] = x), x;
    }
  };
  let bt = Ut;
  (bt.ALPHA = [["a", "z"], ["A", "Z"], " "]),
    (bt.NUMERIC = [["0", "9"]]),
    (bt.ALPHANUMERIC = [["a", "z"], ["A", "Z"], ["0", "9"], " "]),
    (bt.ASCII = [[" ", "~"]]),
    (bt.defaultOptions = {
      resolution: 1,
      textureWidth: 512,
      textureHeight: 512,
      padding: 4,
      chars: Ut.ALPHANUMERIC,
    }),
    (bt.available = {});
  var Ap = `// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,
    Rp = `// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;
  const Sp = [],
    Ip = [],
    Ko = [],
    Zo = class extends vt {
      constructor(i, t = {}) {
        super(), (this._tint = 16777215);
        const {
          align: e,
          tint: r,
          maxWidth: s,
          letterSpacing: n,
          fontName: a,
          fontSize: o,
        } = Object.assign({}, Zo.styleDefaults, t);
        if (!bt.available[a]) throw new Error(`Missing BitmapFont "${a}"`);
        (this._activePagesMeshData = []),
          (this._textWidth = 0),
          (this._textHeight = 0),
          (this._align = e),
          (this._tint = r),
          (this._fontName = a),
          (this._fontSize = o || bt.available[a].size),
          (this.text = i),
          (this._maxWidth = s),
          (this._maxLineHeight = 0),
          (this._letterSpacing = n),
          (this._anchor = new Zt(
            () => {
              this.dirty = !0;
            },
            this,
            0,
            0
          )),
          (this._roundPixels = A.ROUND_PIXELS),
          (this.dirty = !0),
          (this._resolution = A.RESOLUTION),
          (this._autoResolution = !0),
          (this._textureCache = {});
      }
      updateText() {
        var U;
        const i = bt.available[this._fontName],
          t = this._fontSize / i.size,
          e = new V(),
          r = [],
          s = [],
          n = [],
          a =
            this._text.replace(
              /(?:\r\n|\r)/g,
              `
`
            ) || " ",
          o = qo(a),
          h = (this._maxWidth * i.size) / this._fontSize,
          l = i.distanceFieldType === "none" ? Sp : Ip;
        let u = null,
          c = 0,
          d = 0,
          f = 0,
          p = -1,
          g = 0,
          _ = 0,
          T = 0,
          v = 0;
        for (let w = 0; w < o.length; w++) {
          const C = o[w],
            H = vr(C);
          if (
            (/(?:\s)/.test(C) && ((p = w), (g = c), v++),
            C === "\r" ||
              C ===
                `
`)
          ) {
            s.push(c),
              n.push(-1),
              (d = Math.max(d, c)),
              ++f,
              ++_,
              (e.x = 0),
              (e.y += i.lineHeight),
              (u = null),
              (v = 0);
            continue;
          }
          const b = i.chars[H];
          if (!b) continue;
          u && b.kerning[u] && (e.x += b.kerning[u]);
          const M = Ko.pop() || {
            texture: O.EMPTY,
            line: 0,
            charCode: 0,
            prevSpaces: 0,
            position: new V(),
          };
          (M.texture = b.texture),
            (M.line = f),
            (M.charCode = H),
            (M.position.x = e.x + b.xOffset + this._letterSpacing / 2),
            (M.position.y = e.y + b.yOffset),
            (M.prevSpaces = v),
            r.push(M),
            (c = M.position.x + Math.max(b.xAdvance - b.xOffset, b.texture.orig.width)),
            (e.x += b.xAdvance + this._letterSpacing),
            (T = Math.max(T, b.yOffset + b.texture.height)),
            (u = H),
            p !== -1 &&
              h > 0 &&
              e.x > h &&
              (++_,
              ve(r, 1 + p - _, 1 + w - p),
              (w = p),
              (p = -1),
              s.push(g),
              n.push(r.length > 0 ? r[r.length - 1].prevSpaces : 0),
              (d = Math.max(d, g)),
              f++,
              (e.x = 0),
              (e.y += i.lineHeight),
              (u = null),
              (v = 0));
        }
        const x = o[o.length - 1];
        x !== "\r" &&
          x !==
            `
` &&
          (/(?:\s)/.test(x) && (c = g), s.push(c), (d = Math.max(d, c)), n.push(-1));
        const y = [];
        for (let w = 0; w <= f; w++) {
          let C = 0;
          this._align === "right"
            ? (C = d - s[w])
            : this._align === "center"
            ? (C = (d - s[w]) / 2)
            : this._align === "justify" && (C = n[w] < 0 ? 0 : (d - s[w]) / n[w]),
            y.push(C);
        }
        const E = r.length,
          D = {},
          I = [],
          R = this._activePagesMeshData;
        for (let w = 0; w < R.length; w++) l.push(R[w]);
        for (let w = 0; w < E; w++) {
          const C = r[w].texture,
            H = C.baseTexture.uid;
          if (!D[H]) {
            let b = l.pop();
            if (!b) {
              const q = new mi();
              let k, X;
              i.distanceFieldType === "none"
                ? ((k = new $e(O.EMPTY)), (X = G.NORMAL))
                : ((k = new $e(O.EMPTY, { program: zt.from(Rp, Ap), uniforms: { uFWidth: 0 } })),
                  (X = G.NORMAL_NPM));
              const et = new Ie(q, k);
              (et.blendMode = X),
                (b = {
                  index: 0,
                  indexCount: 0,
                  vertexCount: 0,
                  uvsCount: 0,
                  total: 0,
                  mesh: et,
                  vertices: null,
                  uvs: null,
                  indices: null,
                });
            }
            (b.index = 0), (b.indexCount = 0), (b.vertexCount = 0), (b.uvsCount = 0), (b.total = 0);
            const { _textureCache: M } = this;
            (M[H] = M[H] || new O(C.baseTexture)),
              (b.mesh.texture = M[H]),
              (b.mesh.tint = this._tint),
              I.push(b),
              (D[H] = b);
          }
          D[H].total++;
        }
        for (let w = 0; w < R.length; w++) I.includes(R[w]) || this.removeChild(R[w].mesh);
        for (let w = 0; w < I.length; w++) I[w].mesh.parent !== this && this.addChild(I[w].mesh);
        this._activePagesMeshData = I;
        for (const w in D) {
          const C = D[w],
            H = C.total;
          if (
            !(((U = C.indices) == null ? void 0 : U.length) > 6 * H) ||
            C.vertices.length < Ie.BATCHABLE_SIZE * 2
          )
            (C.vertices = new Float32Array(4 * 2 * H)),
              (C.uvs = new Float32Array(4 * 2 * H)),
              (C.indices = new Uint16Array(6 * H));
          else {
            const b = C.total,
              M = C.vertices;
            for (let q = b * 4 * 2; q < M.length; q++) M[q] = 0;
          }
          C.mesh.size = 6 * H;
        }
        for (let w = 0; w < E; w++) {
          const C = r[w];
          let H = C.position.x + y[C.line] * (this._align === "justify" ? C.prevSpaces : 1);
          this._roundPixels && (H = Math.round(H));
          const b = H * t,
            M = C.position.y * t,
            q = C.texture,
            k = D[q.baseTexture.uid],
            X = q.frame,
            et = q._uvs,
            j = k.index++;
          (k.indices[j * 6 + 0] = 0 + j * 4),
            (k.indices[j * 6 + 1] = 1 + j * 4),
            (k.indices[j * 6 + 2] = 2 + j * 4),
            (k.indices[j * 6 + 3] = 0 + j * 4),
            (k.indices[j * 6 + 4] = 2 + j * 4),
            (k.indices[j * 6 + 5] = 3 + j * 4),
            (k.vertices[j * 8 + 0] = b),
            (k.vertices[j * 8 + 1] = M),
            (k.vertices[j * 8 + 2] = b + X.width * t),
            (k.vertices[j * 8 + 3] = M),
            (k.vertices[j * 8 + 4] = b + X.width * t),
            (k.vertices[j * 8 + 5] = M + X.height * t),
            (k.vertices[j * 8 + 6] = b),
            (k.vertices[j * 8 + 7] = M + X.height * t),
            (k.uvs[j * 8 + 0] = et.x0),
            (k.uvs[j * 8 + 1] = et.y0),
            (k.uvs[j * 8 + 2] = et.x1),
            (k.uvs[j * 8 + 3] = et.y1),
            (k.uvs[j * 8 + 4] = et.x2),
            (k.uvs[j * 8 + 5] = et.y2),
            (k.uvs[j * 8 + 6] = et.x3),
            (k.uvs[j * 8 + 7] = et.y3);
        }
        (this._textWidth = d * t), (this._textHeight = (e.y + i.lineHeight) * t);
        for (const w in D) {
          const C = D[w];
          if (this.anchor.x !== 0 || this.anchor.y !== 0) {
            let q = 0;
            const k = this._textWidth * this.anchor.x,
              X = this._textHeight * this.anchor.y;
            for (let et = 0; et < C.total; et++)
              (C.vertices[q++] -= k),
                (C.vertices[q++] -= X),
                (C.vertices[q++] -= k),
                (C.vertices[q++] -= X),
                (C.vertices[q++] -= k),
                (C.vertices[q++] -= X),
                (C.vertices[q++] -= k),
                (C.vertices[q++] -= X);
          }
          this._maxLineHeight = T * t;
          const H = C.mesh.geometry.getBuffer("aVertexPosition"),
            b = C.mesh.geometry.getBuffer("aTextureCoord"),
            M = C.mesh.geometry.getIndex();
          (H.data = C.vertices),
            (b.data = C.uvs),
            (M.data = C.indices),
            H.update(),
            b.update(),
            M.update();
        }
        for (let w = 0; w < r.length; w++) Ko.push(r[w]);
      }
      updateTransform() {
        this.validate(), this.containerUpdateTransform();
      }
      _render(i) {
        this._autoResolution &&
          this._resolution !== i.resolution &&
          ((this._resolution = i.resolution), (this.dirty = !0));
        const {
          distanceFieldRange: t,
          distanceFieldType: e,
          size: r,
        } = bt.available[this._fontName];
        if (e !== "none") {
          const { a: s, b: n, c: a, d: o } = this.worldTransform,
            h = Math.sqrt(s * s + n * n),
            l = Math.sqrt(a * a + o * o),
            u = (Math.abs(h) + Math.abs(l)) / 2,
            c = this._fontSize / r,
            d = i._view.resolution;
          for (const f of this._activePagesMeshData) f.mesh.shader.uniforms.uFWidth = u * t * c * d;
        }
        super._render(i);
      }
      getLocalBounds() {
        return this.validate(), super.getLocalBounds();
      }
      validate() {
        this.dirty && (this.updateText(), (this.dirty = !1));
      }
      get tint() {
        return this._tint;
      }
      set tint(i) {
        if (this._tint !== i) {
          this._tint = i;
          for (let t = 0; t < this._activePagesMeshData.length; t++)
            this._activePagesMeshData[t].mesh.tint = i;
        }
      }
      get align() {
        return this._align;
      }
      set align(i) {
        this._align !== i && ((this._align = i), (this.dirty = !0));
      }
      get fontName() {
        return this._fontName;
      }
      set fontName(i) {
        if (!bt.available[i]) throw new Error(`Missing BitmapFont "${i}"`);
        this._fontName !== i && ((this._fontName = i), (this.dirty = !0));
      }
      get fontSize() {
        return this._fontSize;
      }
      set fontSize(i) {
        this._fontSize !== i && ((this._fontSize = i), (this.dirty = !0));
      }
      get anchor() {
        return this._anchor;
      }
      set anchor(i) {
        typeof i == "number" ? this._anchor.set(i) : this._anchor.copyFrom(i);
      }
      get text() {
        return this._text;
      }
      set text(i) {
        (i = String(i != null ? i : "")), this._text !== i && ((this._text = i), (this.dirty = !0));
      }
      get maxWidth() {
        return this._maxWidth;
      }
      set maxWidth(i) {
        this._maxWidth !== i && ((this._maxWidth = i), (this.dirty = !0));
      }
      get maxLineHeight() {
        return this.validate(), this._maxLineHeight;
      }
      get textWidth() {
        return this.validate(), this._textWidth;
      }
      get letterSpacing() {
        return this._letterSpacing;
      }
      set letterSpacing(i) {
        this._letterSpacing !== i && ((this._letterSpacing = i), (this.dirty = !0));
      }
      get roundPixels() {
        return this._roundPixels;
      }
      set roundPixels(i) {
        i !== this._roundPixels && ((this._roundPixels = i), (this.dirty = !0));
      }
      get textHeight() {
        return this.validate(), this._textHeight;
      }
      get resolution() {
        return this._resolution;
      }
      set resolution(i) {
        (this._autoResolution = !1),
          this._resolution !== i && ((this._resolution = i), (this.dirty = !0));
      }
      destroy(i) {
        const { _textureCache: t } = this;
        for (const e in t) t[e].destroy(), delete t[e];
        (this._textureCache = null), super.destroy(i);
      }
    };
  let Qo = Zo;
  Qo.styleDefaults = { align: "left", tint: 16777215, maxWidth: 0, letterSpacing: 0 };
  const wp = [".xml", ".fnt"],
    Jo = {
      extension: { type: P.LoadParser, priority: Lt.Normal },
      test(i) {
        return wp.includes(dt.extname(i));
      },
      async testParse(i) {
        return yi.test(i) || yr.test(i);
      },
      async parse(i, t, e) {
        const r = yi.test(i) ? yi.parse(i) : yr.parse(i),
          { src: s } = t,
          { page: n } = r,
          a = [];
        for (let l = 0; l < n.length; ++l) {
          const u = n[l].file,
            c = dt.join(dt.dirname(s), u);
          a.push(c);
        }
        const o = await e.load(a),
          h = a.map((l) => o[l]);
        return bt.install(r, h, !0);
      },
      async load(i, t) {
        return (await A.ADAPTER.fetch(i)).text();
      },
      unload(i) {
        i.destroy();
      },
    };
  B.add(Jo);
  const Mp = {
    AlphaFilter: Ld,
    BlurFilter: Hd,
    BlurFilterPass: Us,
    ColorMatrixFilter: ks,
    DisplacementFilter: Yd,
    FXAAFilter: Kd,
    NoiseFilter: Qd,
  };
  return (
    (m.ALPHA_MODES = Pt),
    (m.AbstractMultiResource = Kr),
    (m.AccessibilityManager = Hs),
    (m.AnimatedSprite = gr),
    (m.Application = Ws),
    (m.ArrayResource = aa),
    (m.Assets = hi),
    (m.AssetsClass = Za),
    (m.Attribute = Je),
    (m.BLEND_MODES = G),
    (m.BUFFER_BITS = Ei),
    (m.BUFFER_TYPE = $t),
    (m.BackgroundSystem = Ms),
    (m.BaseImageResource = Jt),
    (m.BasePrepare = ko),
    (m.BaseRenderTexture = ts),
    (m.BaseTexture = Y),
    (m.BatchDrawCall = Ki),
    (m.BatchGeometry = Ns),
    (m.BatchRenderer = ri),
    (m.BatchShaderGenerator = Xa),
    (m.BatchSystem = as),
    (m.BatchTextureArray = Zi),
    (m.BitmapFont = bt),
    (m.BitmapFontData = Ti),
    (m.BitmapText = Qo),
    (m.BlobResource = lo),
    (m.Bounds = si),
    (m.BrowserAdapter = yn),
    (m.Buffer = nt),
    (m.BufferResource = Oe),
    (m.BufferSystem = Bs),
    (m.CLEAR_MODES = Ot),
    (m.COLOR_MASK_BITS = On),
    (m.Cache = Le),
    (m.CanvasResource = oa),
    (m.Circle = Si),
    (m.CompressedTextureResource = ue),
    (m.Container = vt),
    (m.ContextSystem = os),
    (m.CountLimiter = Uo),
    (m.CubeResource = Zr),
    (m.DEG_TO_RAD = Bn),
    (m.DRAW_MODES = Dt),
    (m.DisplayObject = tt),
    (m.ENV = ae),
    (m.Ellipse = Ii),
    (m.EventBoundary = za),
    (m.EventSystem = $s),
    (m.ExtensionType = P),
    (m.Extract = tn),
    (m.FORMATS = S),
    (m.FORMATS_TO_COMPONENTS = _o),
    (m.FederatedDisplayObject = Wa),
    (m.FederatedEvent = Be),
    (m.FederatedMouseEvent = ai),
    (m.FederatedPointerEvent = Mt),
    (m.FederatedWheelEvent = Ji),
    (m.FillStyle = ci),
    (m.Filter = wt),
    (m.FilterState = da),
    (m.FilterSystem = ns),
    (m.Framebuffer = ki),
    (m.FramebufferSystem = hs),
    (m.GC_MODES = Rr),
    (m.GLFramebuffer = pa),
    (m.GLProgram = Na),
    (m.GLTexture = qi),
    (m.GRAPHICS_CURVES = Ue),
    (m.GenerateTextureSystem = ws),
    (m.Geometry = ee),
    (m.GeometrySystem = us),
    (m.Graphics = fr),
    (m.GraphicsData = pi),
    (m.GraphicsGeometry = an),
    (m.IGLUniformData = gd),
    (m.INSTALLED = Li),
    (m.INTERNAL_FORMATS = yt),
    (m.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL = ui),
    (m.ImageBitmapResource = ha),
    (m.ImageResource = Qr),
    (m.LINE_CAP = de),
    (m.LINE_JOIN = ce),
    (m.LineStyle = cr),
    (m.LoaderParserPriority = Lt),
    (m.MASK_TYPES = ht),
    (m.MIPMAP_MODES = Kt),
    (m.MSAA_QUALITY = ot),
    (m.MaskData = ma),
    (m.MaskSystem = xs),
    (m.Matrix = Q),
    (m.Mesh = Ie),
    (m.MeshBatchUvs = Co),
    (m.MeshGeometry = mi),
    (m.MeshMaterial = $e),
    (m.MultisampleSystem = Ls),
    (m.NineSlicePlane = Jf),
    (m.ObjectRenderer = ti),
    (m.ObjectRendererSystem = Gs),
    (m.ObservablePoint = Zt),
    (m.PI_2 = He),
    (m.PRECISION = Xt),
    (m.ParticleContainer = tp),
    (m.ParticleRenderer = ln),
    (m.PlaneGeometry = Oo),
    (m.PluginSystem = Ds),
    (m.Point = V),
    (m.Polygon = pe),
    (m.Prepare = fn),
    (m.Program = zt),
    (m.ProjectionSystem = vs),
    (m.Quad = ca),
    (m.QuadUv = rs),
    (m.RAD_TO_DEG = Nn),
    (m.RENDERER_TYPE = Pn),
    (m.Rectangle = z),
    (m.RenderTexture = te),
    (m.RenderTexturePool = is),
    (m.RenderTextureSystem = bs),
    (m.Renderer = Re),
    (m.ResizePlugin = Vs),
    (m.Resource = Pe),
    (m.RopeGeometry = Fo),
    (m.RoundedRectangle = wi),
    (m.Runner = Ft),
    (m.SAMPLER_TYPES = Ai),
    (m.SCALE_MODES = jt),
    (m.SHAPES = ct),
    (m.SVGResource = Fe),
    (m.ScissorSystem = Ts),
    (m.Shader = Bt),
    (m.ShaderSystem = Es),
    (m.SimpleMesh = Qf),
    (m.SimplePlane = No),
    (m.SimpleRope = Zf),
    (m.Sprite = le),
    (m.SpriteMaskFilter = Ia),
    (m.Spritesheet = _r),
    (m.StartupSystem = Ps),
    (m.State = Wt),
    (m.StateSystem = Rs),
    (m.StencilSystem = ys),
    (m.SystemManager = La),
    (m.TARGETS = fe),
    (m.TEXT_GRADIENT = _i),
    (m.TYPES = L),
    (m.TYPES_TO_BYTES_PER_COMPONENT = Qs),
    (m.TYPES_TO_BYTES_PER_PIXEL = go),
    (m.TemporaryDisplayObject = $a),
    (m.Text = mr),
    (m.TextFormat = yi),
    (m.TextMetrics = F),
    (m.TextStyle = re),
    (m.Texture = O),
    (m.TextureGCSystem = Ss),
    (m.TextureMatrix = Vi),
    (m.TextureSystem = Is),
    (m.TextureUvs = es),
    (m.Ticker = Z),
    (m.TickerPlugin = wr),
    (m.TilingSprite = pn),
    (m.TilingSpriteRenderer = Yo),
    (m.TimeLimiter = mp),
    (m.Transform = ze),
    (m.UPDATE_PRIORITY = oe),
    (m.UniformGroup = It),
    (m.VERSION = Nd),
    (m.VideoResource = Ui),
    (m.ViewSystem = Cs),
    (m.ViewableBuffer = Qi),
    (m.WRAP_MODES = qt),
    (m.XMLFormat = Tr),
    (m.XMLStringFormat = yr),
    (m.accessibleTarget = Va),
    (m.addFormats = rr),
    (m.autoDetectFormat = jo),
    (m.autoDetectRenderer = Ua),
    (m.autoDetectResource = qr),
    (m.cacheSpritesheet = zo),
    (m.cacheTextureArray = Qa),
    (m.checkExtension = er),
    (m.checkMaxIfStatementsInShader = Ra),
    (m.convertToList = Vt),
    (m.createStringVariations = Ka),
    (m.createTexture = li),
    (m.createUBOElements = Pa),
    (m.defaultFilterVertex = Os),
    (m.defaultVertex = ka),
    (m.detectAvif = ao),
    (m.detectCompressedTextures = co),
    (m.detectDefaults = ho),
    (m.detectWebp = oo),
    (m.extensions = B),
    (m.filters = Mp),
    (m.generateProgram = Ba),
    (m.generateUniformBufferSync = Fa),
    (m.getFontFamilyName = eo),
    (m.getTestContext = ya),
    (m.getUBOData = Oa),
    (m.graphicsUtils = jf),
    (m.groupD8 = J),
    (m.isMobile = Ct),
    (m.isSingleItem = oi),
    (m.loadBitmapFont = Jo),
    (m.loadDDS = To),
    (m.loadImageBitmap = so),
    (m.loadJson = Ja),
    (m.loadKTX = yo),
    (m.loadSVG = bf),
    (m.loadSpritesheet = $o),
    (m.loadTextures = ir),
    (m.loadTxt = to),
    (m.loadWebFont = io),
    (m.parseDDS = po),
    (m.parseKTX = xo),
    (m.removeFormats = sr),
    (m.resolveCompressedTextureUrl = vo),
    (m.resolveSpriteSheetUrl = Wo),
    (m.resolveTextureUrl = no),
    (m.settings = A),
    (m.uniformParsers = Ee),
    (m.utils = Hc),
    Object.defineProperty(m, "__esModule", { value: !0 }),
    m
  );
})({});
//# sourceMappingURL=pixi.min.js.mapvar servicebase={};
class ServiceBase {
  xhrGet(a) {
    const b = new XMLHttpRequest();
    return new Promise((c, d) => {
      b.addEventListener("load", () => {
        200 === b.status ? c(b.responseText) : d(this.xhrError(b.status, a));
      });
      b.open("GET", ServiceBase.API_URL + a);
      b.setRequestHeader("Client-Version", App.ClientVersion);
      b.send();
    });
  }
  xhrPost(a, b) {
    const c = new XMLHttpRequest();
    return new Promise((d, e) => {
      c.addEventListener("load", () => {
        if (200 === c.status) return d(c.responseText);
        e(this.xhrError(c.status, a));
      });
      c.open("POST", ServiceBase.API_URL + a);
      c.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
      c.setRequestHeader("Client-Version", App.ClientVersion);
      c.send(JSON.stringify(b));
    });
  }
  xhrError(a, b) {
    return "xhr request " + ServiceBase.API_URL + b + " failed with status " + a;
  }
}
const urlParams = new URLSearchParams(window.location.search),
  myParam = urlParams.get("dev"),
  loc = window.location
    .toString()
    .replace(/(^\w+:|^)\/\//, "")
    .trim()
    .replace(/\/$/, "");
ServiceBase.API_URL =
  "site.ninja.local" === loc ? "http://api.ninja.local/" : "https://api.ninja.io/";
var userservice = {};
class UserService extends ServiceBase {
  constructor() {
    super();
  }
  async getRanking() {
    const a = await this.xhrGet("user/ranking");
    return JSON.parse(a);
  }
  async getRankingType(a, b) {
    a = await this.xhrGet("user/ranking/" + a + "/limit/" + b);
    return JSON.parse(a);
  }
  async getWeaponRanking() {
    const a = await this.xhrGet("user/weapon-ranking");
    return JSON.parse(a);
  }
  async getWeaponRankingType(a) {
    a = await this.xhrGet("user/weapon-ranking/" + a);
    return JSON.parse(a);
  }
  async getGuestCredentials(a) {
    a = await this.xhrGet("user/guest/" + a);
    return JSON.parse(a);
  }
  async getCredentials(a) {
    a = await this.xhrGet("user/credential/" + a);
    return JSON.parse(a);
  }
  async getProfile(a) {
    return await this.xhrGet("user/profile/" + a);
  }
  async getUserProfile(a) {
    a = await this.xhrGet("user/profile/" + a + "/view");
    return JSON.parse(a);
  }
  async getUserProfileByName(a) {
    a = await this.xhrGet("user/profile/" + a + "/view-name");
    return JSON.parse(a);
  }
  async getUserSearch(a) {
    a = await this.xhrGet("user/search/" + a);
    return JSON.parse(a);
  }
  async getUserWeaponStats(a) {
    return await this.xhrGet("user/" + a + "/weapon-stats");
  }
  async getChallenge() {
    return await this.xhrGet("user/challenge");
  }
  async getCustomization(a) {
    return await this.xhrGet("user/customization/" + a);
  }
  async getFriends(a) {
    return await this.xhrGet("user/friends/" + a);
  }
  async getMessages(a) {
    return await this.xhrGet("user/messages/" + a);
  }
  async getCurrency(a) {
    a = await this.xhrGet("user/currency/" + a);
    return JSON.parse(a);
  }
  async getSettings(a) {
    a = await this.xhrGet("user/settings/" + a);
    return JSON.parse(a);
  }
  async getInvitations(a) {
    return await this.xhrGet("user/invitations/" + a);
  }
  async getInvitees(a) {
    return await this.xhrGet("user/invitees/" + a);
  }
  async getRewardsAvailable(a) {
    a = await this.xhrGet("user/rewards-available/" + a);
    return JSON.parse(a);
  }
  async getRewards(a) {
    a = await this.xhrGet("user/rewards/" + a);
    return JSON.parse(a);
  }
  async postClaimShopReward(a) {
    a = await this.xhrPost("user/reward-shop", { id: a });
    return JSON.parse(a);
  }
  async postClaimRewards(a) {
    a = await this.xhrPost("user/reward-claim", { id: a });
    return JSON.parse(a);
  }
  async postLogin(a, b) {
    a = await this.xhrPost("user/login", { name: a, password: b });
    return JSON.parse(a);
  }
  async postAutoRegister() {
    const a = await this.xhrPost("user/auto-register", {});
    return JSON.parse(a);
  }
  async postRegister(a, b, c) {
    a = await this.xhrPost("user/register", { name: a, email: b, password: c });
    return JSON.parse(a);
  }
  async postSettings(a, b) {
    a = await this.xhrPost("user/settings", { settings: a, id: b });
    return JSON.parse(a);
  }
  async postRecovery(a, b, c) {
    a = await this.xhrPost("user/recover", { email: a, type: b, challenge: c });
    return JSON.parse(a);
  }
  async postRenewPassword(a, b, c) {
    a = await this.xhrPost("user/renewpassword", { newPassword: a, oldPassword: b, id: c });
    return JSON.parse(a);
  }
  async postDeactivateAccount(a, b) {
    a = await this.xhrPost("user/deactivate", { password: a, id: b });
    return JSON.parse(a);
  }
  async postCustomization(a, b) {
    a = await this.xhrPost("user/customization", { customization: a, id: b });
    return JSON.parse(a);
  }
  async postAutogenRename(a, b, c) {
    a = await this.xhrPost("user/autogen-rename", { name: a, password: b, id: c });
    return JSON.parse(a);
  }
  async postFriendInvite(a, b) {
    a = await this.xhrPost("user/invite", { name: a, id: b });
    return JSON.parse(a);
  }
  async postAcceptFriend(a, b) {
    a = await this.xhrPost("user/accept", { friendId: a, id: b });
    return JSON.parse(a);
  }
  async postDeclineFriend(a, b) {
    a = await this.xhrPost("user/decline", { friendId: a, id: b });
    return JSON.parse(a);
  }
  async postUnfriend(a, b) {
    a = await this.xhrPost("user/unfriend", { friendId: a, id: b });
    return JSON.parse(a);
  }
  async postFriendMessage(a, b, c) {
    a = await this.xhrPost("user/message", { friendId: a, message: b, id: c });
    return JSON.parse(a);
  }
  async postPurchase(a, b, c) {
    a = await this.xhrPost("user/purchase", { productType: a, productId: b, id: c });
    return JSON.parse(a);
  }
  async postUsername(a, b, c) {
    a = await this.xhrPost("user/rename", { name: a, password: b, id: c });
    return JSON.parse(a);
  }
  async postFriendGold(a, b, c) {
    a = await this.xhrPost("user/gold", { friendId: a, amount: b, id: c });
    return JSON.parse(a);
  }
  async postCreateGame(a, b, c, d, e, f, g, h) {
    a = await this.xhrPost("user/game/create", {
      gameId: a,
      type: b,
      mode: c,
      duration: d,
      name: e,
      password: f,
      customization: g,
      id: h,
    });
    return JSON.parse(a);
  }
  async postSocial(a, b, c) {
    a = await this.xhrPost("user/social", { type: a, url: b, id: c });
    return JSON.parse(a);
  }
}
var serverservice = {};
class ServerService extends ServiceBase {
  constructor() {
    super();
  }
  async getNews() {
    const a = await this.xhrGet("news");
    return JSON.parse(a);
  }
  async getServers() {
    const a = await this.xhrGet("server");
    return JSON.parse(a);
  }
  async getGames() {
    const a = await this.xhrGet("game");
    return JSON.parse(a);
  }
  async getMaps() {
    const a = await this.xhrGet("map");
    return JSON.parse(a);
  }
  async getItemDrops() {
    const a = await this.xhrGet("item-drop");
    return JSON.parse(a);
  }
}
var clanservice = {};
class ClanService extends ServiceBase {
  constructor() {
    super();
  }
  async getClanByClanId(a) {
    a = await this.xhrGet("clan/" + a + "/clan-id");
    return JSON.parse(a);
  }
  async getClanByAccountId(a) {
    a = await this.xhrGet("clan/" + a + "/account-id");
    return JSON.parse(a);
  }
  async getClanList() {
    const a = await this.xhrGet("clan/list");
    return JSON.parse(a);
  }
  async getClanSearch(a) {
    a = await this.xhrGet("clan/search/" + a);
    return JSON.parse(a);
  }
  async getClanMembers(a) {
    a = await this.xhrGet("clan/" + a + "/members");
    return JSON.parse(a);
  }
  async getClanInvitations(a) {
    a = await this.xhrGet("clan/invitations/" + a);
    return JSON.parse(a);
  }
  async postCreate(a, b) {
    a = await this.xhrPost("clan", { name: a, id: b });
    return JSON.parse(a);
  }
  async postLeaveMember(a) {
    a = await this.xhrPost("clan/leave", { id: a });
    return JSON.parse(a);
  }
  async postInviteMember(a, b) {
    a = await this.xhrPost("clan/invite", { targetId: a, id: b });
    return JSON.parse(a);
  }
  async postAcceptMember(a, b) {
    a = await this.xhrPost("clan/accept", { clanId: a, id: b });
    return JSON.parse(a);
  }
  async postDeclineMember(a, b) {
    a = await this.xhrPost("clan/decline", { clanId: a, id: b });
    return JSON.parse(a);
  }
  async postRemoveMember(a, b) {
    a = await this.xhrPost("clan/remove", { targetId: a, id: b });
    return JSON.parse(a);
  }
  async postPromoteMember(a, b) {
    a = await this.xhrPost("clan/promote", { targetId: a, id: b });
    return JSON.parse(a);
  }
  async postDemoteMember(a, b) {
    a = await this.xhrPost("clan/demote", { targetId: a, id: b });
    return JSON.parse(a);
  }
  async postBanner(a, b) {
    a = await this.xhrPost("clan/banner", { data: a, id: b });
    return JSON.parse(a);
  }
}
var apiclient = {};
class APIClient {
  static async getNews() {
    return await new ServerService().getNews();
  }
  static async getServers() {
    return await new ServerService().getServers();
  }
  static async getGames() {
    return await new ServerService().getGames();
  }
  static async getMaps() {
    return await new ServerService().getMaps();
  }
  static async getItemDrops() {
    return await new ServerService().getItemDrops();
  }
  static async getRanking() {
    return await new UserService().getRanking();
  }
  static async getRankingType(a, b) {
    return await new UserService().getRankingType(a, b);
  }
  static async getWeaponRanking() {
    return await new UserService().getWeaponRanking();
  }
  static async getWeaponRankingType(a) {
    return await new UserService().getWeaponRankingType(a);
  }
  static async getGuestCredentials(a) {
    return await new UserService().getGuestCredentials(a);
  }
  static async getCredentials(a) {
    return await new UserService().getCredentials(a);
  }
  static async getProfile(a) {
    return await new UserService().getProfile(a);
  }
  static async getUserProfile(a) {
    return await new UserService().getUserProfile(a);
  }
  static async getUserProfileByName(a) {
    return await new UserService().getUserProfileByName(a);
  }
  static async getUserSearch(a) {
    return await new UserService().getUserSearch(a);
  }
  static async getUserWeaponStats(a) {
    return await new UserService().getUserWeaponStats(a);
  }
  static async getChallenge() {
    return await new UserService().getChallenge();
  }
  static async getFriends(a) {
    return await new UserService().getFriends(a);
  }
  static async getMessages(a) {
    return await new UserService().getMessages(a);
  }
  static async getCurrency(a) {
    return await new UserService().getCurrency(a);
  }
  static async getSettings(a) {
    return await new UserService().getSettings(a);
  }
  static async getInvitations(a) {
    return await new UserService().getInvitations(a);
  }
  static async getInvitees(a) {
    return await new UserService().getInvitees(a);
  }
  static async getRewardsAvailable(a) {
    return await new UserService().getRewardsAvailable(a);
  }
  static async getRewards(a) {
    return await new UserService().getRewards(a);
  }
  static async postClaimShopReward(a) {
    return await new UserService().postClaimShopReward(a);
  }
  static async postClaimRewards(a) {
    return await new UserService().postClaimRewards(a);
  }
  static async postLogin(a, b) {
    return await new UserService().postLogin(a, b);
  }
  static async postAutoRegistration() {
    return await new UserService().postAutoRegister();
  }
  static async postRegistration(a, b, c) {
    return await new UserService().postRegister(a, b, c);
  }
  static async postSettings(a, b) {
    return await new UserService().postSettings(a, b);
  }
  static async postRecovery(a, b, c) {
    return await new UserService().postRecovery(a, b, c);
  }
  static async postCustomization(a, b) {
    return await new UserService().postCustomization(a, b);
  }
  static async postAutogenRename(a, b, c) {
    return await new UserService().postAutogenRename(a, b, c);
  }
  static async renewPassword(a, b, c) {
    return await new UserService().postRenewPassword(a, b, c);
  }
  static async deactivateAccount(a, b) {
    return await new UserService().postDeactivateAccount(a, b);
  }
  static async getCustomization(a) {
    return await new UserService().getCustomization(a);
  }
  static async postInviteFriend(a, b) {
    return await new UserService().postFriendInvite(a, b);
  }
  static async postAcceptFriend(a, b) {
    return await new UserService().postAcceptFriend(a, b);
  }
  static async postDeclineFriend(a, b) {
    return await new UserService().postDeclineFriend(a, b);
  }
  static async postUnfriend(a, b) {
    return await new UserService().postUnfriend(a, b);
  }
  static async postFriendMessage(a, b, c) {
    return await new UserService().postFriendMessage(a, b, c);
  }
  static async postPurchase(a, b, c) {
    return await new UserService().postPurchase(a, b, c);
  }
  static async postUsername(a, b, c) {
    return await new UserService().postUsername(a, b, c);
  }
  static async postFriendGold(a, b, c) {
    return await new UserService().postFriendGold(a, b, c);
  }
  static async postCreateGame(a, b, c, d, e, f, g, h) {
    return await new UserService().postCreateGame(a, b, c, d, e, f, g, h);
  }
  static async postSocial(a, b, c) {
    return await new UserService().postSocial(a, b, c);
  }
  static async getClanByClanId(a) {
    return await new ClanService().getClanByClanId(a);
  }
  static async getClanByAccountId(a) {
    return await new ClanService().getClanByAccountId(a);
  }
  static async getClanList() {
    return await new ClanService().getList();
  }
  static async getClanSearch(a) {
    return await new ClanService().getClanSearch(a);
  }
  static async getClanMembers(a) {
    return await new ClanService().getClanMembers(a);
  }
  static async getClanInvitations(a) {
    return await new ClanService().getClanInvitations(a);
  }
  static async postCreateClan(a, b) {
    return await new ClanService().postCreate(a, b);
  }
  static async postLeaveMember(a) {
    return await new ClanService().postLeaveMember(a);
  }
  static async postInviteMember(a, b) {
    return await new ClanService().postInviteMember(a, b);
  }
  static async postAcceptInviteMember(a, b) {
    return await new ClanService().postAcceptMember(a, b);
  }
  static async postDeclineInviteMember(a, b) {
    return await new ClanService().postDeclineMember(a, b);
  }
  static async postRemoveMember(a, b) {
    return await new ClanService().postRemoveMember(a, b);
  }
  static async postPromoteMember(a, b) {
    return await new ClanService().postPromoteMember(a, b);
  }
  static async postDemoteMember(a, b) {
    return await new ClanService().postDemoteMember(a, b);
  }
  static async postBanner(a, b) {
    return await new ClanService().postBanner(a, b);
  }
}
APIClient.ChallengeURL = ServiceBase.API_URL + "user/challenge";
var eventdispatcher = {};
function EventDispatcher() {
  this._listeners = {};
  this.addListener = function (a, b) {
    void 0 === this._listeners[a] ? (this._listeners[a] = [b]) : this._listeners[a].push(b);
  };
  this.removeListener = function (a, b) {
    if (void 0 !== this._listeners[a])
      for (let c = 0, d = this._listeners[a].length; c < d; c++)
        if (
          this._listeners[a][c] === b &&
          (this._listeners[a].splice(c, 1), 0 === this._listeners[a].length)
        ) {
          delete this._listeners[a];
          break;
        }
  };
  this.dispatchEvent = function (a) {
    let b = this._listeners[a.type];
    if (void 0 !== b)
      if (1 === b.length) b[0](a);
      else for (let c = 0, d = b.length; c < d; c++) b[c](a);
  };
  this.hasListener = function (a, b) {
    if (void 0 !== this._listeners[a]) {
      if (void 0 === b) return !0;
      a = this._listeners[a];
      for (let c = 0, d = a.length; c < d; c++) if (a[c] === b) return !0;
    }
    return !1;
  };
  return this;
}
var client = {};
class Client extends EventDispatcher {
  constructor() {
    super();
    this.pinger = this.socket = null;
    this.time = 0;
    this.serverSwitch = !1;
    this.onCloseForImmediateReconnect = null;
    this.server = Client.DefaultServer;
    this.connectionTimeout = null;
    this.allowNextAttempt = !0;
  }
  setServer(a) {
    this.server = a;
  }
  connect() {
    if (this.allowNextAttempt) {
      this.allowNextAttempt = !1;
      null !== this.connectionTimeout &&
        (clearTimeout(this.connectionTimeout), (this.connectionTimeout = null));
      this.connectionTimeout = setTimeout(() => {
        this.allowNextAttempt = !0;
      }, 1e3);
      var a = LZString.compressToEncodedURIComponent(JSON.stringify(App.Credential));
      a =
        ("1" === this.server.secure ? "wss" : "ws") +
        "://" +
        this.server.domain +
        ":" +
        this.server.port +
        "/ws?auth=" +
        a;
      this.socket &&
        this.socket.readyState !== WebSocket.CLOSED &&
        this.socket.readyState !== WebSocket.CLOSING &&
        this.socket.readyState !== WebSocket.CONNECTING &&
        this.disconnect();
      this.socket = new WebSocket(a, ["ninja.io"]);
      this.socket.onopen = this.onOpen.bind(this);
      this.socket.onmessage = this.onMessage.bind(this);
      this.socket.onclose = this.onClose.bind(this);
      this.socket.onerror = this.onError.bind(this);
      this.socket.binaryType = "arraybuffer";
    }
  }
  disconnect(a) {
    this.serverSwitch = a;
    this.socket.close();
    clearInterval(this.pinger);
    this.pinger = null;
    this.dispatchEvent({ type: Client.DISCONNECT });
  }
  onOpen(a) {
    this.addListener(Protocol.ECHO_RESP, this.onEchoResponse.bind(this));
    this.dispatchEvent({ type: Client.CONNECT });
    null !== this.pinger && (clearInterval(this.pinger), (this.pinger = null));
    this.pinger = setInterval(() => {
      this.time = DateUTC();
      this.emit({ type: Protocol.ECHO });
    }, 8e3);
  }
  onError(a) {
    this.dispatchEvent({ type: Client.CONNECTION_ERROR });
    console.log("Game server connection error", a);
  }
  onMessage(a) {
    a = Client.decompress(a.data);
    this.dispatchEvent(a);
  }
  onClose(a) {
    switch (a.code) {
      case Client.CODE_AUTH_FAILED:
        App.Console.log("Invalid credentials.", 16711680);
        this.dispatchEvent({ type: Client.AUTH_FAILED });
        break;
      case Client.CODE_MAX_CLIENTS:
        App.Console.log("This region is full.", 16711680);
        App.Console.log("Retry later or select a different region.", 16763904);
        this.dispatchEvent({ type: Client.SERVER_FULL });
        return;
      case Client.CODE_DUPLICATE_CLIENT:
        App.Console.log("This account is already connected.", 16711680);
    }
    if (this.serverSwitch) {
      if (((this.serverSwitch = !1), this.onCloseForImmediateReconnect))
        this.onCloseForImmediateReconnect();
    } else this.dispatchEvent({ type: Protocol.DISCONNECT });
  }
  emit(a) {
    this.socket.readyState === WebSocket.OPEN && ((a = Client.compress(a)), this.socket.send(a));
  }
  isConnected() {
    return null !== this.socket && this.socket.readyState === WebSocket.OPEN;
  }
  onEchoResponse() {
    let a = Date.now() - this.time;
    App.Stats.setPing(a);
  }
}
Client.compress = function (a) {
  let b = JSON.stringify(a),
    c = Client.SendBuffer.subarray(0, b.length + 1);
  c[0] = a.t ? 1 : 0;
  for (let d = 1, e = b.length; d < e + 1; d++) c[d] = b.charCodeAt(d - 1);
  return c;
};
Client.decompress = function (a) {
  a = new Uint8Array(a);
  let b;
  if (128 === a[0]) {
    b = Protocol.GAME_BIN;
    var c = Client.unpackGameData(a);
  } else {
    let d;
    switch (a[0]) {
      case 0:
        c = a.length - 1;
        for (d = Array(c); 0 < c--; ) d[c] = String.fromCharCode(a[c + 1]);
        c = JSON.parse(d.join(""));
        b = c.type;
        c = c.data;
        break;
      case 1:
        b = Protocol.GAME;
        c = a.length - 1;
        for (d = Array(c); 0 < c--; ) d[c] = String.fromCharCode(a[c + 1]);
        c = JSON.parse(d.join(""));
    }
  }
  return { data: c, type: b };
};
Client.unpackGameData = function (a) {
  return {
    t: Protocol.Game.UPDATE,
    d: JSON.parse(LZString.decompressFromUint8Array_Fast(a.subarray(1))),
  };
};
Client.SendBuffer = new Uint8Array(2048);
Client.CONNECT = "connect";
Client.DISCONNECT = "disconnect";
Client.AUTH_FAILED = "auth_failed";
Client.SERVER_FULL = "server_full";
Client.CONNECTION_ERROR = "connection_error";
Client.CODE_AUTH_FAILED = 1;
Client.CODE_MAX_CLIENTS = 2;
Client.CODE_DUPLICATE_CLIENT = 3;
Client.DefaultServer = {
  id: "6",
  uid: "EKWnN6sr",
  name: "NA 1",
  domain: "ca1.ninja.io",
  title: "North America 1",
  address: "167.114.144.181",
  port: "58391",
  secure: "1",
  region: "na_east",
  status: "online",
  players: "0",
  games: "0",
  modes: { deathmatch: "0", teamDeathmatch: "0", captureTheFlag: "0", dodgeball: "0" },
};
var inputstate = {};
class InputState {
  constructor() {
    this.mapping = InputState.InvertMapping(
      Registry.Instance[Registry.Key.SETTINGS].controls.keyBindings
    );
    this.oldB = this.b2 = this.b1 = 0;
    this.changed = !1;
    null === this.mapping &&
      (this.mapping = InputState.InvertMapping(InputState.DefaultBindings.QWERTY));
    this.$ =
      this._ =
      this.Q =
      this.R =
      this.F =
      this.X =
      this.E =
      this.D =
      this.S =
      this.A =
      this.W =
      this.RM =
      this.LM =
        0;
  }
  reset() {
    this.oldB = this.b2 = this.b1 = 0;
    this.changed = !1;
    this.$ =
      this._ =
      this.Q =
      this.R =
      this.F =
      this.X =
      this.E =
      this.D =
      this.S =
      this.A =
      this.W =
      this.RM =
      this.LM =
        0;
  }
  update(a, b) {
    let c = !1;
    this.mapping[a]
      ? ("ctrl_chat" === this.mapping[a] && App.Console.setActive(!0),
        (a = InputState.GetMappedCharacter(a, this.mapping)))
      : arrowsInv[a] && (a = arrowsInv[a]);
    void 0 !== this[a] && this[a] !== b && ((c = a), (this[a] = b), this.updateBytes(!1));
    return c;
  }
  updateFacing(a) {
    this._ = a;
    this.updateBytes(!0);
  }
  updateBytes(a) {
    let b = this.$ ? 1 : 0,
      c = 0;
    a
      ? (c = this.oldB)
      : (this.LM && (c |= 4),
        this.RM && (c |= 8),
        this.A && (c |= 16),
        this.D && (c |= 64),
        this.S && (c |= 32),
        this.W && (c |= 128),
        this.E && (c |= 256),
        this.X && (c |= 512),
        this.F && (c |= 1024),
        this.R && (c |= 2048),
        this.Q && (c |= 4096));
    c !== this.oldB || this.changed
      ? ((this.oldB = c),
        (this.changed = !0),
        (b |= 2),
        (this.b2 = (((this.$ & 16383) << 14) | this._) >>> 0))
      : ((c = this._ << 2), (this.b2 = this.$ & 16383));
    this.b1 = c | b;
  }
}
InputState.GetMappedCharacter = function (a, b) {
  return InputState.DefaultBindings.QWERTY[b[a]];
};
InputState.InvertMapping = function (a) {
  const b = {};
  for (let c in a) b[a[c]] = c;
  return b;
};
InputState.DefaultBindings = {
  QWERTY: {
    ctrl_jump: "W",
    ctrl_move_left: "A",
    ctrl_move_right: "D",
    ctrl_crouch: "S",
    ctrl_prone: "X",
    ctrl_fire: "LM",
    ctrl_fly: "RM",
    ctrl_reload: "R",
    ctrl_throw: "E",
    ctrl_drop: "F",
    ctrl_swap: "Q",
    ctrl_flag: "W+S",
    ctrl_chat: "T",
    ctrl_help: "H",
    ctrl_weapon: "G",
    ctrl_leader: "V",
  },
  AZERTY: {
    ctrl_jump: "Z",
    ctrl_move_left: "Q",
    ctrl_move_right: "D",
    ctrl_crouch: "S",
    ctrl_prone: "X",
    ctrl_fire: "LM",
    ctrl_fly: "RM",
    ctrl_reload: "R",
    ctrl_throw: "E",
    ctrl_drop: "F",
    ctrl_swap: "A",
    ctrl_flag: "Z+S",
    ctrl_chat: "T",
    ctrl_help: "H",
    ctrl_weapon: "G",
    ctrl_leader: "V",
  },
};
InputState.Descriptions = {
  ctrl_fly: "(right mouse) Fly",
  ctrl_fire: "(left mouse) Fire weapon",
  ctrl_jump: "Jump",
  ctrl_move_left: "Move left",
  ctrl_move_right: "Move right",
  ctrl_crouch: "Crouch, roll, teleport",
  ctrl_prone: "Prone",
  ctrl_reload: "Reload",
  ctrl_throw: "Throw weapon",
  ctrl_drop: "Drop weapon",
  ctrl_swap: "Swap weapon",
  ctrl_flag: "Thow flag",
  ctrl_chat: "(or ENTER) Chat",
  ctrl_help: "Display help",
  ctrl_weapon: "Display weapon menu",
  ctrl_leader: "Display leaderboard",
};
var registry = {};
class Registry {
  constructor() {
    this.settings = Registry.DefaultSettings;
    try {
      if (void 0 === window.localStorage) return;
    } catch (a) {
      return;
    }
    try {
      this[Registry.Key.MASTER] = JSON.parse(localStorage.getItem(Registry.Key.MASTER));
    } catch (a) {}
    try {
      this[Registry.Key.SETTINGS] = JSON.parse(localStorage.getItem(Registry.Key.SETTINGS));
    } catch (a) {}
    try {
      this[Registry.Key.CREDENTIAL] = JSON.parse(localStorage.getItem(Registry.Key.CREDENTIAL));
    } catch (a) {}
    null === this[Registry.Key.MASTER]
      ? ((this[Registry.Key.MASTER] = { registryVersion: Registry.Version, firstRun: !0 }),
        localStorage.setItem(Registry.Key.MASTER, JSON.stringify(this[Registry.Key.MASTER])))
      : this[Registry.Key.MASTER].firstRun &&
        ((this[Registry.Key.MASTER].firstRun = !1),
        localStorage.setItem(Registry.Key.MASTER, JSON.stringify(this[Registry.Key.MASTER])));
    null === this[Registry.Key.SETTINGS] &&
      ((this[Registry.Key.SETTINGS] = Registry.DefaultSettings),
      localStorage.setItem(Registry.Key.SETTINGS, JSON.stringify(this[Registry.Key.SETTINGS])));
    null === this[Registry.Key.CREDENTIAL] &&
      ((this[Registry.Key.CREDENTIAL] = { available: !1 }),
      localStorage.setItem(Registry.Key.CREDENTIAL, JSON.stringify(this[Registry.Key.CREDENTIAL])));
  }
  store(a, b) {
    Registry.SetLocalStorageItem(a, b, !0);
  }
  retrieve(a) {
    return Registry.GetLocalStorageItem(a, !0);
  }
  remove(a) {
    return Registry.RemoveStorageItem(a);
  }
}
Registry.GetLocalStorageItem = function (a, b = !1) {
  try {
    if (void 0 === window.localStorage) return;
  } catch (d) {
    return { available: !1 };
  }
  let c;
  if (b)
    try {
      c = JSON.parse(localStorage.getItem(a));
    } catch (d) {
      c = { error: !0 };
    }
  else c = localStorage.getItem(a);
  return c;
};
Registry.SetLocalStorageItem = function (a, b, c = !1) {
  try {
    if (void 0 === window.localStorage) return;
  } catch (d) {
    return;
  }
  this[a] = b;
  localStorage.setItem(a, c ? JSON.stringify(b) : b);
};
Registry.RemoveStorageItem = function (a) {
  try {
    if (void 0 === window.localStorage) return;
  } catch (b) {
    return;
  }
  void 0 !== this[a] && delete this[a];
  localStorage.removeItem(a);
};
Registry.Version = "1.0.0";
Registry.Key = {
  MASTER: "master",
  SETTINGS: "settings",
  CREDENTIAL: "credential",
  AUTOGEN: "autogen",
};
Registry.DefaultSettings = {
  controls: { keyBindings: InputState.DefaultBindings.QWERTY },
  graphics: { reticleLine: !0, aa: !1, fxaa: !1, shockwaveFx: !1 },
  sound: { enabled: !0, volume: 1 },
};
Registry.Instance = new Registry();
var feature = {};
class Feature extends PIXI.Graphics {
  constructor() {
    super();
    this.hides = [];
    this.container = new PIXI.Container();
    this.addChild(this.container);
  }
  show() {}
  hide() {}
  resize(a, b) {
    this.x = 0.5 * a;
    this.y = -8;
  }
  update() {}
}
var movementjoystick = {};
class MovementJoystick extends PIXI.Graphics {
  constructor() {
    super();
    this.lineStyle(2, 16777215, 0.6);
    this.beginFill(16777215, 0.1);
    this.drawRoundedRect(-60, -18, 36, 36, 8, 8);
    this.drawRoundedRect(24, -18, 36, 36, 8, 8);
    this.drawRoundedRect(-18, -60, 36, 36, 8, 8);
    this.drawRoundedRect(-18, 24, 36, 36, 8, 8);
    this.endFill();
    this.hitArea = new PIXI.Circle(0, 0, 60);
    this.interactive = !0;
    this.ny = this.nx = 0;
    this.pointerId = -1;
    this.on("pointerdown", (a) => this.onStart(a));
    this.on("pointermove", (a) => this.onMove(a));
    this.on("pointerup", (a) => this.onEnd(a));
    this.on("pointerupoutside", (a) => this.onEnd(a));
    this.on("touchstart", (a) => {
      a.stopPropagation();
    });
    this.jump = this.prone = this.crouch = this.fly = this.right = this.left = !1;
    this.stick = new PIXI.Graphics();
    this.addChild(this.stick);
    this.knob = new PIXI.Graphics();
    this.knob.lineStyle(3, 16777215, 0.4);
    this.knob.beginFill(16777215, 0.3);
    this.knob.drawCircle(0, 0, 15);
    this.knob.endFill();
    this.addChild(this.knob);
    this.scale.x = this.scale.y = 1.3;
    this.label = new PIXI.Text("Movement", {
      fontName: "Arial",
      fontSize: 15,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.label.x = 0;
    this.label.y = 0.5 * this.height - 14;
    this.label.resolution = 1.5 * App.DevicePixelRatio;
    this.label.anchor.x = this.label.anchor.y = 0.5;
    this.label.scale.x = this.label.scale.y = 1.2;
    this.label.alpha = 0.9;
    this.label.tint = 16763904;
    this.addChild(this.label);
  }
  onStart(a) {
    a.stopPropagation();
    this.pointerId = a.data.pointerId;
    let b = this.toGlobal(new PIXI.Point(0, 0)),
      c = a.data.global.x - b.x;
    a = a.data.global.y - b.y;
    60 < Math.sqrt(c * c + a * a) || this.update(c, a);
  }
  onEnd(a) {
    a.data.pointerId === this.pointerId &&
      ((this.pointerId = -1),
      a.stopPropagation(),
      this.stick.clear(),
      (this.knob.x = 0),
      (this.knob.y = 0),
      this.emit(Layer.Events.JOYSTICK_MOVE_STATE, {
        left: !1,
        right: !1,
        fly: !1,
        crouch: !1,
        prone: !1,
        jump: !1,
        nx: 0.7 * this.nx,
        ny: 0.7 * this.ny,
      }));
  }
  onMove(a) {
    if (a.data.pointerId === this.pointerId) {
      a.stopPropagation();
      var b = this.toGlobal(new PIXI.Point(0, 0));
      this.update(a.data.global.x - b.x, a.data.global.y - b.y);
    }
  }
  update(a, b) {
    let c = Math.atan2(b, a),
      d = Math.min(Math.sqrt(a * a + b * b), 60);
    this.knob.x = d * Math.cos(c);
    this.knob.y = d * Math.sin(c);
    this.stick.clear();
    this.stick.lineStyle(1, 16777215, 1, 0.5, !0);
    this.stick.moveTo(0, 0);
    this.stick.lineTo(this.knob.x, this.knob.y);
    this.left = -30 > a;
    this.right = 30 < a;
    this.jump = -15 > b && -60 < b;
    this.fly = -60 > b;
    this.crouch = 30 < b && 60 >= b;
    this.prone = 60 < b;
    this.nx = (d / 60) * Math.cos(c);
    this.ny = (d / 60) * Math.sin(c);
    this.emit(Layer.Events.JOYSTICK_MOVE_STATE, {
      left: this.left,
      right: this.right,
      fly: this.fly,
      crouch: this.crouch,
      prone: this.prone,
      jump: this.jump,
      nx: 0.7 * this.nx,
      ny: 0.7 * this.ny,
    });
  }
}
MovementJoystick.POINTER_DOWN = "pointer_down";
var targetingjoystick = {};
class TargetingJoystick extends PIXI.Graphics {
  constructor() {
    super();
    this.lineStyle(2, 16777215, 0.6);
    this.beginFill(16777215, 0.1);
    this.drawCircle(0, 0, 50);
    this.endFill();
    this.interactive = !0;
    this.throwing = !1;
    this.pointerCount = 0;
    this.pointerId = -1;
    this.ny = this.nx = 0;
    this.on("pointerdown", (a) => this.onStart(a));
    this.on("pointermove", (a) => this.onMove(a));
    this.on("pointerup", (a) => this.onEnd(a));
    this.on("pointerupoutside", (a) => this.onEnd(a));
    this.on("touchstart", (a) => {
      a.stopPropagation();
    });
    this.stick = new PIXI.Graphics();
    this.addChild(this.stick);
    this.knob = new PIXI.Graphics();
    this.knob.lineStyle(3, 16777215, 0.4);
    this.knob.beginFill(16777215, 0.3);
    this.knob.drawCircle(0, 0, 15);
    this.knob.endFill();
    this.addChild(this.knob);
    this.switchWeaponKey = new PIXI.Graphics();
    this.switchWeaponKey.lineStyle(3, 16777215, 0.4);
    this.switchWeaponKey.beginFill(16777215, 0.3);
    this.switchWeaponKey.drawRoundedRect(0, 0, 36, 36, 4);
    this.switchWeaponKey.endFill();
    this.switchWeaponKey.interactive = !0;
    this.addChild(this.switchWeaponKey);
    this.switchWeaponKey.on("pointerdown", (a) => this.onSwitch(a));
    this.switchWeaponKey.x = 56;
    this.switchWeaponKey.y = 40;
    this.tapTime = 0;
    this.scale.x = this.scale.y = 1.3;
    this.label = new PIXI.Text("View & Aim", {
      fontName: "Arial",
      fontSize: 15,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.label.x = 0;
    this.label.y = 0.5 * this.height - 29;
    this.label.resolution = 1.5 * App.DevicePixelRatio;
    this.label.anchor.x = this.label.anchor.y = 0.5;
    this.label.scale.x = this.label.scale.y = 1.2;
    this.label.alpha = 0.9;
    this.label.tint = 16763904;
    this.addChild(this.label);
  }
  onSwitch(a) {
    a.stopPropagation();
    this.emit(Layer.Events.JOYSTICK_TARGET_STATE, {
      nx: 0.7 * this.nx,
      ny: 0.7 * this.ny,
      fire: !1,
      throw: !1,
      end: !1,
      switch: !0,
    });
  }
  onStart(a) {
    a.stopPropagation();
    this.pointerCount += 2 > this.pointerCount ? 1 : 0;
    var b = Date.now();
    500 > b - this.tapTime && (this.throwing = !0);
    this.tapTime = b;
    this.pointerId = a.data.pointerId;
    let c = this.toGlobal(new PIXI.Point(0, 0));
    b = a.data.global.x - c.x;
    a = a.data.global.y - c.y;
    60 < Math.sqrt(b * b + a * a) || this.update(b, a);
  }
  onEnd(a) {
    a.data.pointerId === this.pointerId &&
      ((this.pointerCount -= 0 < this.pointerCount ? 1 : 0),
      (this.pointerId = -1),
      a.stopPropagation(),
      this.stick.clear(),
      (this.knob.x = 0),
      (this.knob.y = 0),
      (this.throwing = !1),
      this.emit(Layer.Events.JOYSTICK_TARGET_STATE, {
        nx: 0.7 * this.nx,
        ny: 0.7 * this.ny,
        fire: !1,
        throw: !1,
        end: !0,
      }));
  }
  onMove(a) {
    if (a.data.pointerId === this.pointerId) {
      a.stopPropagation();
      var b = this.toGlobal(new PIXI.Point(0, 0));
      this.update(a.data.global.x - b.x, a.data.global.y - b.y);
    }
  }
  update(a, b) {
    let c = Math.atan2(b, a);
    a = Math.min(Math.sqrt(a * a + b * b), 60);
    this.knob.x = a * Math.cos(c);
    this.knob.y = a * Math.sin(c);
    this.stick.clear();
    this.stick.lineStyle(1, 16777215, 1, 0.5, !0);
    this.stick.moveTo(0, 0);
    this.stick.lineTo(this.knob.x, this.knob.y);
    this.nx = (a / 60) * Math.cos(c);
    this.ny = (a / 60) * Math.sin(c);
    this.emit(Layer.Events.JOYSTICK_TARGET_STATE, {
      nx: 0.7 * this.nx,
      ny: 0.7 * this.ny,
      fire: 10 < a && 2 > this.pointerCount,
      throw: this.throwing,
    });
  }
}
MovementJoystick.POINTER_DOWN = "pointer_down";
var gamemenu = {};
class GameMenu extends Feature {
  constructor() {
    super();
    this.discButtonBackground = new PIXI.Graphics();
    this.discButtonBackground.beginFill(0, 0.35);
    this.discButtonBackground.drawRoundedRect(0, 0, 60, 20, 2);
    this.discButtonBackground.endFill();
    this.discButtonBackground.scale.x = this.discButtonBackground.scale.y = 1.2;
    this.discButtonBackground.x = App.ClientWidth - 89;
    this.discButtonBackground.y = 3;
    this.discButtonBackground.interactive = !0;
    this.discButtonBackground.hitArea = new PIXI.Rectangle(0, 0, 60, 20);
    this.addChild(this.discButtonBackground);
    this.discTitle = new PIXI.Text("Menu", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.discTitle.scale.x = this.discTitle.scale.y = 1.2;
    this.discTitle.x =
      this.discButtonBackground.x + 0.5 * (this.discButtonBackground.width - this.discTitle.width);
    this.discTitle.y = this.discButtonBackground.y - 2;
    this.discTitle.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.discTitle.resolution = 1.5 * App.DevicePixelRatio;
    this.discTitle.alpha = 0.9;
    this.discTitle.tint = 16763904;
    this.addChild(this.discTitle);
    this.discButtonBackground.on("mouseover", () => {
      this.discTitle.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.discButtonBackground.on("mouseout", () => {
      this.discTitle.alpha = 0.9;
    });
    this.discButtonBackground.on("mousedown", () => {
      this.emit(Layer.Events.ESCAPE_MENU_ACCESS);
      AudioEffects.ButtonClick.audio.play();
    });
    this.discButtonBackground.on("touchstart", () => {
      this.emit(Layer.Events.ESCAPE_MENU_ACCESS);
      AudioEffects.ButtonClick.audio.play();
    });
    this.helpButtonBackground = new PIXI.Graphics();
    this.helpButtonBackground.beginFill(0, 0.35);
    this.helpButtonBackground.drawRoundedRect(0, 0, 80, 20, 2);
    this.helpButtonBackground.endFill();
    this.helpButtonBackground.x = App.ClientWidth - 180;
    this.helpButtonBackground.y = 3;
    this.helpButtonBackground.scale.x = this.helpButtonBackground.scale.y = 1.2;
    this.helpButtonBackground.interactive = !0;
    this.helpButtonBackground.hitArea = new PIXI.Rectangle(0, 0, 80, 20);
    this.addChild(this.helpButtonBackground);
    this.helpTitle = new PIXI.Text("Controls", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.helpTitle.scale.x = this.helpTitle.scale.y = 1.2;
    this.helpTitle.x =
      this.helpButtonBackground.x + 0.5 * (this.helpButtonBackground.width - this.helpTitle.width);
    this.helpTitle.y = this.helpButtonBackground.y - 2;
    this.helpTitle.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.helpTitle.resolution = 1.5 * App.DevicePixelRatio;
    this.helpTitle.alpha = 0.7;
    this.helpTitle.tint = 65280;
    this.addChild(this.helpTitle);
    this.helpButtonBackground.on("mouseover", () => {
      this.helpTitle.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.helpButtonBackground.on("mouseout", () => {
      this.helpTitle.alpha = 0.7;
    });
    this.helpButtonBackground.on("mousedown", () => {
      this.emit(Layer.Events.DISPLAY_HELP);
      AudioEffects.ButtonClick.audio.play();
    });
    this.helpButtonBackground.on("touchstart", () => {
      this.emit(Layer.Events.DISPLAY_HELP);
      AudioEffects.ButtonClick.audio.play();
    });
    App.IsMobile &&
      ((this.movementJoystick = new MovementJoystick()),
      this.movementJoystick.on(Layer.Events.JOYSTICK_MOVE_STATE, (a) =>
        this.emit(Layer.Events.JOYSTICK_MOVE_STATE, a)
      ),
      this.addChild(this.movementJoystick),
      (this.targetingJoystick = new TargetingJoystick()),
      this.targetingJoystick.on(Layer.Events.JOYSTICK_TARGET_STATE, (a) =>
        this.emit(Layer.Events.JOYSTICK_TARGET_STATE, a)
      ),
      this.addChild(this.targetingJoystick));
    App.WhiteLabel !== App.WhiteLabel_POKI &&
      ((this.minmax = new PIXI.Sprite(App.CombinedTextures.max_screen)),
      (this.minmax.x = App.ClientWidth - 200),
      (this.minmax.y = 12),
      (this.minmax.anchor.x = this.minmax.anchor.y = 0.5),
      (this.minmax.alpha = 1),
      (this.minmax.scale.x = this.minmax.scale.y = 0.4),
      (this.minmax.interactive = !0),
      this.minmax.on("mousedown", () => {
        let a = window.document,
          b = a.documentElement,
          c =
            b.requestFullscreen ||
            b.mozRequestFullScreen ||
            b.webkitRequestFullScreen ||
            b.msRequestFullscreen,
          d =
            a.exitFullscreen ||
            a.mozCancelFullScreen ||
            a.webkitExitFullscreen ||
            a.msExitFullscreen;
        a.fullscreenElement ||
        a.mozFullScreenElement ||
        a.webkitFullscreenElement ||
        a.msFullscreenElement
          ? (d.call(a), (this.minmax.texture = App.CombinedTextures.max_screen))
          : (c.call(b), (this.minmax.texture = App.CombinedTextures.min_screen));
      }),
      this.addChild(this.minmax));
    App.IsMobile &&
      setInterval(() => {
        this.resize(App.ClientWidth, App.ClientHeight);
      }, 3e3);
  }
  show() {
    super.show();
    this.resize(App.ClientWidth, App.ClientHeight);
  }
  resize(a, b) {
    this.y = this.x = 0;
    var c = 0.9 > App.Scale ? 0.9 : App.Scale;
    this.discButtonBackground.scale.x = this.discButtonBackground.scale.y = 1.2 / c;
    this.discTitle.scale.x = this.discTitle.scale.y = 1.2 / c;
    let d = this.toLocal(new PIXI.Point(a - 190 * c, 3 * c), App.Stage);
    this.helpButtonBackground.scale.x = this.helpButtonBackground.scale.y = 1.2 / c;
    this.helpTitle.scale.x = this.helpTitle.scale.y = 1.2 / c;
    this.helpButtonBackground.x = d.x;
    this.helpTitle.x =
      this.helpButtonBackground.x + 0.5 * (this.helpButtonBackground.width - this.helpTitle.width);
    this.minmax &&
      this.minmax.parent &&
      ((this.minmax.scale.x = this.minmax.scale.y = 0.5 / c),
      (c = this.toLocal(new PIXI.Point(a - 210 * c, 13 * c), App.Stage)),
      (this.minmax.x = c.x));
    this.discButtonBackground.x = this.helpButtonBackground.x + this.helpButtonBackground.width + 6;
    this.discTitle.x =
      this.discButtonBackground.x + 0.5 * (this.discButtonBackground.width - this.discTitle.width);
    App.IsMobile &&
      ((c = this.toLocal(new PIXI.Point(0.15 * a, 0.8 * b), App.Stage)),
      (a = this.toLocal(new PIXI.Point(0.85 * a, 0.8 * b), App.Stage)),
      (this.movementJoystick.x = c.x),
      (this.movementJoystick.y = c.y),
      (this.targetingJoystick.x = a.x),
      (this.targetingJoystick.y = a.y));
    this.discTitle.y = this.discButtonBackground.y - 2;
    this.helpTitle.y = this.helpButtonBackground.y - 2;
  }
}
var guestmenu = {};
class GuestMenu extends Feature {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = -6;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(100, 14, 164, 32, 10);
    this.background.endFill();
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(0, 46, 100, 524);
    this.background.endFill();
    this.container.addChild(this.background);
    this.discordButton = new PIXI.Sprite(App.CombinedTextures.discord);
    this.discordButton.y = 8;
    this.discordButton.scale.x = this.discordButton.scale.y = 0.25;
    this.joinDiscordText = new PIXI.Text("Discord", {
      fontSize: 18,
      fontFamily: "Arial",
      fill: 16763904,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.joinDiscordText.y = this.discordButton.y + 6;
    this.joinDiscordText.tint = 16776960;
    this.joinDiscordText.resolution = 1.5 * App.DevicePixelRatio;
    this.joinDiscordText.interactive = !0;
    this.joinDiscordText.hitArea = new PIXI.Rectangle(-30, 0, 94, 24);
    this.joinDiscordText.on("mouseover", () => {
      this.discordButton.scale.x = this.discordButton.scale.y = 0.27;
      this.joinDiscordText.scale.x = this.joinDiscordText.scale.y = 1.1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.joinDiscordText.on("mouseout", () => {
      this.discordButton.scale.x = this.discordButton.scale.y = 0.25;
      this.joinDiscordText.scale.x = this.joinDiscordText.scale.y = 1;
    });
    this.joinDiscordText.on("mousedown", () => {
      window.open("https://discord.gg/yAYmSWZ", "_blank");
    });
    this.zapperButton = new PIXI.Sprite(App.CombinedTextures.zapper);
    this.zapperButton.y = App.ClientHeight - 35;
    this.zapperButton.scale.x = this.zapperButton.scale.y = 0.29;
    this.getZapperText = new PIXI.BitmapText("Play Zapper.io", {
      fontName: "Open Sans",
      fontSize: 24,
    });
    this.getZapperText.y = App.ClientHeight - 26;
    this.getZapperText.tint = 16776960;
    App.WhiteLabel !== App.WhiteLabel_POKI &&
      (this.addChild(this.discordButton), this.addChild(this.joinDiscordText));
    this.getZapperText.interactive = !0;
    this.getZapperText.hitArea = new PIXI.Rectangle(-30, 0, 220, 32);
    this.getZapperText.on("mouseover", () => {
      this.zapperButton.scale.x = this.zapperButton.scale.y = 0.32;
      this.getZapperText.scale.x = this.getZapperText.scale.y = 1.1;
    });
    this.getZapperText.on("mouseout", () => {
      this.zapperButton.scale.x = this.zapperButton.scale.y = 0.29;
      this.getZapperText.scale.x = this.getZapperText.scale.y = 1;
    });
    this.getZapperText.on("mousedown", () => {
      window.open(
        App.WhiteLabel === App.WhiteLabel_CG
          ? "https://www.crazygames.com/game/zapper-io"
          : "https://zapper.io",
        "_blank"
      );
    });
    this.loginButton = new PIXI.Graphics();
    this.loginButton.interactive = !0;
    this.loginButton.lineStyle(1, 16777215, 0.3, 0);
    this.loginButton.beginFill(16777215, 0.15);
    this.loginButton.drawRect(0, 0, 70, 25);
    this.loginButton.setActive = (a = !1) => {
      this.loginButton.tint = a ? 16777215 : 5592405;
    };
    this.loginButton.on("mousedown", () => {
      this.emit(Layer.Events.LOGIN_ACCESS);
    });
    this.loginButton.on("touchstart", () => {
      this.emit(Layer.Events.LOGIN_ACCESS);
    });
    this.loginButton.x = 110;
    this.loginButton.y = 14;
    this.loginButton.tint = 5592405;
    this.container.addChild(this.loginButton);
    this.loginText = new PIXI.Text("Login", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16750848,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.loginText.x = this.loginButton.x + 0.5 * (this.loginButton.width - this.loginText.width);
    this.loginText.y = this.loginButton.y + 2;
    this.loginText.resolution = 1.5 * App.DevicePixelRatio;
    this.loginText.alpha = 0.8;
    this.loginText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.loginText);
    this.loginButton.on("mouseover", () => {
      this.loginText.alpha = 1;
    });
    this.loginButton.on("mouseout", () => {
      this.loginText.alpha = 0.8;
    });
    this.registerButton = new PIXI.Graphics();
    this.registerButton.interactive = !0;
    this.registerButton.lineStyle(1, 16777215, 0.3, 0);
    this.registerButton.beginFill(16777215, 0.15);
    this.registerButton.drawRect(0, 0, 70, 25);
    this.registerButton.setActive = (a = !1) => {
      this.registerButton.tint = a ? 16777215 : 5592405;
    };
    this.registerButton.on("mousedown", () => {
      this.emit(Layer.Events.REGISTER_ACCESS);
    });
    this.registerButton.on("touchstart", () => {
      this.emit(Layer.Events.REGISTER_ACCESS);
    });
    this.registerButton.x = this.loginButton.x + 74;
    this.registerButton.y = this.loginButton.y;
    this.registerButton.tint = 5592405;
    this.container.addChild(this.registerButton);
    this.registerText = new PIXI.Text("Register", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16750848,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.registerText.x =
      this.registerButton.x + 0.5 * (this.registerButton.width - this.registerText.width);
    this.registerText.y = this.registerButton.y + 2;
    this.registerText.resolution = 1.5 * App.DevicePixelRatio;
    this.registerText.alpha = 0.8;
    this.registerText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.registerText);
    this.registerButton.on("mouseover", () => {
      this.registerText.alpha = 1;
    });
    this.registerButton.on("mouseout", () => {
      this.registerText.alpha = 0.8;
    });
    this.playButton = new GuestMenuButton("Play", 16763904, 18, "menu_icon_play");
    this.playButton.x = 0;
    this.playButton.y = 47;
    this.playButton.on(GuestMenuButton.BUTTON_PRESSED, () => this.emit(Layer.Events.MENU_ACCESS));
    this.container.addChild(this.playButton);
    this.profileButton = new GuestMenuButton("Profile", 16763904, 18, "menu_icon_profile");
    this.profileButton.x = 0;
    this.profileButton.y = this.playButton.y + 70;
    this.profileButton.on(GuestMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.GUEST_PROFILE_ACCESS)
    );
    this.container.addChild(this.profileButton);
    this.shopButton = new GuestMenuButton("Shop", 16763904, 18, "menu_icon_shop");
    this.shopButton.x = 0;
    this.shopButton.y = this.profileButton.y + 70;
    this.shopButton.on(GuestMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.CUSTOMIZATION_ACCESS)
    );
    this.container.addChild(this.shopButton);
    this.rankingButton = new GuestMenuButton("Ranking", 16763904, 18, "menu_icon_ranking");
    this.rankingButton.x = 0;
    this.rankingButton.y = this.shopButton.y + 70;
    this.rankingButton.on(GuestMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.RANKING_ACCESS)
    );
    this.container.addChild(this.rankingButton);
    this.memberButton = new GuestMenuButton("Players", 16763904, 18, "menu_icon_players");
    this.memberButton.x = 0;
    this.memberButton.y = this.rankingButton.y + 70;
    this.memberButton.on(GuestMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.MEMBER_ACCESS)
    );
    this.container.addChild(this.memberButton);
    this.clanButton = new GuestMenuButton("Clans", 16763904, 18, "menu_icon_clans");
    this.clanButton.x = 0;
    this.clanButton.y = this.memberButton.y + 70;
    this.clanButton.on(GuestMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.CLAN_BROWSER_ACCESS)
    );
    this.container.addChild(this.clanButton);
    this.settingsButton = new GuestMenuButton("Settings", 16763904, 18, "menu_icon_settings", !1);
    this.settingsButton.x = 0;
    this.settingsButton.y = this.clanButton.y + 70;
    this.settingsButton.on(GuestMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.SETTINGS_ACCESS)
    );
    this.container.addChild(this.settingsButton);
    this.setMode(GuestMenu.MODE_NONE);
  }
  setMode(a) {
    this.mode = a;
    this.playButton.setActive(a === GuestMenu.MODE_NONE);
    this.loginButton.setActive(a === GuestMenu.MODE_LOGIN);
    this.registerButton.setActive(a === GuestMenu.MODE_REGISTER);
    this.rankingButton.setActive(a === GuestMenu.MODE_RANKING);
    this.memberButton.setActive(a === GuestMenu.MODE_MEMBER);
    this.clanButton.setActive(a === GuestMenu.MODE_CLAN);
    this.shopButton.setActive(a === GuestMenu.MODE_SHOP);
    this.profileButton.setActive(a === GuestMenu.MODE_GUEST_PROFILE);
    this.settingsButton.setActive(a === GuestMenu.MODE_SETTINGS);
  }
  resize(a, b) {
    this.x = 0.5 * a - 430;
    this.y = -8;
    this.discordButton.x = 0;
    this.joinDiscordText.x = this.discordButton.x + this.discordButton.width + 2;
    this.zapperButton.x = 0.5 * -a + 0.5 * this.container.width + 5;
    this.getZapperText.x = this.zapperButton.x + this.zapperButton.width + 9;
    this.zapperButton.y = App.ClientHeight - 35;
    this.getZapperText.y = App.ClientHeight - 26;
  }
}
GuestMenu.MODE_NONE = "none";
GuestMenu.MODE_LOGIN = "login";
GuestMenu.MODE_REGISTER = "register";
GuestMenu.MODE_RANKING = "ranking";
GuestMenu.MODE_MEMBER = "member";
GuestMenu.MODE_CLAN = "clan";
GuestMenu.MODE_SHOP = "shop";
GuestMenu.MODE_PARTNER = "partner";
GuestMenu.MODE_GUEST_PROFILE = "guest_profile";
GuestMenu.MODE_SETTINGS = "settings";
class GuestMenuButton extends PIXI.Graphics {
  constructor(a = "", b = 16763904, c = 18, d = null, e = !0) {
    super();
    this.interactive = !0;
    this.active = !1;
    this.rectWidth = 98;
    this.rectHeight = 70;
    this.hitArea = new PIXI.Rectangle(0, 0, this.rectWidth, this.rectHeight);
    this.backgroundEnabled = new PIXI.Graphics();
    this.backgroundEnabled.lineStyle(1, 16763904, 0.8, 0);
    this.backgroundEnabled.beginFill(6710886, 0.4);
    this.backgroundEnabled.drawRoundedRect(4, 3, 92, 69, 6);
    this.backgroundEnabled.endFill();
    e &&
      (this.backgroundEnabled.lineStyle(1, 16777215, 0.1, 0),
      this.backgroundEnabled.moveTo(8, 70),
      this.backgroundEnabled.lineTo(92, 70));
    this.backgroundDisabled = new PIXI.Graphics();
    this.backgroundDisabled.drawRect(0, 1, 100, 69);
    e &&
      (this.backgroundDisabled.lineStyle(1, 16777215, 0.1, 0),
      this.backgroundDisabled.moveTo(8, 72),
      this.backgroundDisabled.lineTo(92, 72));
    this.addChild(this.backgroundDisabled);
    this.backgroundHover = new PIXI.Graphics();
    this.backgroundHover.beginFill(0, 0.2);
    this.backgroundHover.drawRect(4, 1, 92, 69);
    this.backgroundHover.visible = !1;
    this.addChild(this.backgroundHover);
    this.activeBackground = this.backgroundDisabled;
    d &&
      ((this.icon = new PIXI.Sprite(App.CombinedTextures[d])),
      (this.icon.x = 0.5 * this.rectWidth),
      (this.icon.y = 0.37 * this.rectHeight),
      (this.icon.tint = 13421772),
      (this.icon.scale.x = this.icon.scale.y = 0.35),
      (this.icon.anchor.x = this.icon.anchor.y = 0.5),
      this.addChild(this.icon));
    this.label = new PIXI.Text(a, {
      fontSize: c,
      fontFamily: "Arial",
      fill: b,
      lineJoin: "round",
      strokeThickness: 3,
    });
    this.label.resolution = 1.5 * App.DevicePixelRatio;
    this.label.x = 0.5 * (this.rectWidth - this.label.width);
    this.label.y = 46;
    this.addChild(this.label);
    this.on("mousedown", () => {
      this.emit(GuestMenuButton.BUTTON_PRESSED);
      this.backgroundHover.visible = !1;
      AudioEffects.ButtonClick.audio.play();
    });
    this.on("touchstart", () => {
      this.emit(GuestMenuButton.BUTTON_PRESSED);
      AudioEffects.ButtonClick.audio.play();
    });
    this.on("mouseover", () => {
      this.active || (this.backgroundHover.visible = !0);
      AudioEffects.ButtonHover.audio.play();
    });
    this.on("mouseout", () => {
      this.backgroundHover.visible = !1;
    });
  }
  setActive(a = !0) {
    (this.active = a)
      ? (this.backgroundDisabled.parent && this.removeChild(this.backgroundDisabled),
        this.addChildAt(this.backgroundEnabled, 0),
        (this.activeBackground = this.backgroundEnabled))
      : (this.backgroundEnabled.parent && this.removeChild(this.backgroundEnabled),
        this.addChildAt(this.backgroundDisabled, 0),
        (this.activeBackground = this.backgroundDisabled));
  }
}
GuestMenuButton.BUTTON_PRESSED = "button_pressed";
var membermenu = {};
class MemberMenu extends Feature {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = -6;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(100, 14, 120, 32, 10);
    this.background.endFill();
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(0, 46, 100, 524);
    this.background.endFill();
    this.container.addChild(this.background);
    this.discordButton = new PIXI.Sprite(App.CombinedTextures.discord);
    this.discordButton.y = 8;
    this.discordButton.scale.x = this.discordButton.scale.y = 0.25;
    this.joinDiscordText = new PIXI.Text("Discord", {
      fontSize: 18,
      fontFamily: "Arial",
      fill: 16763904,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.joinDiscordText.y = this.discordButton.y + 6;
    this.joinDiscordText.tint = 16776960;
    this.joinDiscordText.resolution = 1.5 * App.DevicePixelRatio;
    this.joinDiscordText.interactive = !0;
    this.joinDiscordText.hitArea = new PIXI.Rectangle(-30, 0, 94, 24);
    this.joinDiscordText.on("mouseover", () => {
      this.discordButton.scale.x = this.discordButton.scale.y = 0.27;
      this.joinDiscordText.scale.x = this.joinDiscordText.scale.y = 1.1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.joinDiscordText.on("mouseout", () => {
      this.discordButton.scale.x = this.discordButton.scale.y = 0.25;
      this.joinDiscordText.scale.x = this.joinDiscordText.scale.y = 1;
    });
    this.joinDiscordText.on("mousedown", () => {
      window.open("https://discord.gg/yAYmSWZ", "_blank");
    });
    this.zapperButton = new PIXI.Sprite(App.CombinedTextures.zapper);
    this.zapperButton.y = App.ClientHeight - 35;
    this.zapperButton.scale.x = this.zapperButton.scale.y = 0.29;
    this.getZapperText = new PIXI.BitmapText("Play Zapper.io", {
      fontName: "Open Sans",
      fontSize: 24,
    });
    this.getZapperText.y = App.ClientHeight - 26;
    this.getZapperText.tint = 16776960;
    App.WhiteLabel !== App.WhiteLabel_POKI &&
      (this.addChild(this.discordButton), this.addChild(this.joinDiscordText));
    this.getZapperText.interactive = !0;
    this.getZapperText.hitArea = new PIXI.Rectangle(-30, 0, 220, 32);
    this.getZapperText.on("mouseover", () => {
      this.zapperButton.scale.x = this.zapperButton.scale.y = 0.32;
      this.getZapperText.scale.x = this.getZapperText.scale.y = 1.1;
    });
    this.getZapperText.on("mouseout", () => {
      this.zapperButton.scale.x = this.zapperButton.scale.y = 0.29;
      this.getZapperText.scale.x = this.getZapperText.scale.y = 1;
    });
    this.getZapperText.on("mousedown", () => {
      window.open(
        App.WhiteLabel === App.WhiteLabel_CG
          ? "https://www.crazygames.com/game/zapper-io"
          : "https://zapper.io",
        "_blank"
      );
    });
    this.logoutButton = new PIXI.Graphics();
    this.logoutButton.interactive = !0;
    this.logoutButton.lineStyle(1, 16777215, 0.3, 0);
    this.logoutButton.beginFill(16777215, 0.15);
    this.logoutButton.drawRect(0, 0, 100, 25);
    this.logoutButton.setActive = () => {};
    this.logoutButton.on("mousedown", () => this.onLogout());
    this.logoutButton.on("touchstart", () => this.onLogout());
    this.logoutButton.x = 110;
    this.logoutButton.y = 14;
    this.logoutButton.tint = 5592405;
    this.container.addChild(this.logoutButton);
    this.logoutIcon = new PIXI.Sprite(App.CombinedTextures.logout);
    this.logoutIcon.x = this.logoutButton.x + this.logoutButton.width - 24;
    this.logoutIcon.y = this.logoutButton.y + 0.1 * this.logoutButton.height;
    this.logoutIcon.scale.x = this.logoutIcon.scale.y = 0.4;
    this.logoutIcon.interactive = !1;
    this.logoutIcon.alpha = 0.7;
    this.container.addChild(this.logoutIcon);
    this.logoutText = new PIXI.Text("Logout", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16750848,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.logoutText.x =
      this.logoutButton.x + 0.5 * (this.logoutButton.width - this.logoutText.width) - 10;
    this.logoutText.y = this.logoutButton.y + 2;
    this.logoutText.resolution = 1.5 * App.DevicePixelRatio;
    this.logoutText.alpha = 0.7;
    this.logoutText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.logoutText);
    this.logoutButton.on("mouseover", () => {
      this.logoutText.alpha = this.logoutIcon.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.logoutButton.on("mouseout", () => {
      this.logoutText.alpha = this.logoutIcon.alpha = 0.7;
    });
    this.playButton = new MemberMenuButton("Play", 16763904, 18, "menu_icon_play");
    this.playButton.x = 0;
    this.playButton.y = 47;
    this.playButton.on(MemberMenuButton.BUTTON_PRESSED, () => this.emit(Layer.Events.MENU_ACCESS));
    this.container.addChild(this.playButton);
    this.profileButton = new MemberMenuButton("Profile", 16763904, 18, "menu_icon_profile");
    this.profileButton.x = 0;
    this.profileButton.y = this.playButton.y + 70;
    this.profileButton.on(MemberMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.PROFILE_ACCESS)
    );
    this.container.addChild(this.profileButton);
    this.shopButton = new MemberMenuButton("Shop", 16763904, 18, "menu_icon_shop");
    this.shopButton.x = 0;
    this.shopButton.y = this.profileButton.y + 70;
    this.shopButton.on(MemberMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.CUSTOMIZATION_ACCESS)
    );
    this.container.addChild(this.shopButton);
    this.rankingButton = new MemberMenuButton("Ranking", 16763904, 18, "menu_icon_ranking");
    this.rankingButton.x = 0;
    this.rankingButton.y = this.shopButton.y + 70;
    this.rankingButton.on(MemberMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.RANKING_ACCESS)
    );
    this.container.addChild(this.rankingButton);
    this.memberButton = new MemberMenuButton("Players", 16763904, 18, "menu_icon_players");
    this.memberButton.x = 0;
    this.memberButton.y = this.rankingButton.y + 70;
    this.memberButton.on(MemberMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.MEMBER_ACCESS)
    );
    this.container.addChild(this.memberButton);
    this.clanButton = new MemberMenuButton("Clans", 16763904, 18, "menu_icon_clans");
    this.clanButton.x = 0;
    this.clanButton.y = this.memberButton.y + 70;
    this.clanButton.on(MemberMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.CLAN_BROWSER_ACCESS)
    );
    this.container.addChild(this.clanButton);
    this.settingsButton = new MemberMenuButton("Settings", 16763904, 18, "menu_icon_settings", !1);
    this.settingsButton.x = 0;
    this.settingsButton.y = this.clanButton.y + 70;
    this.settingsButton.on(MemberMenuButton.BUTTON_PRESSED, () =>
      this.emit(Layer.Events.SETTINGS_ACCESS)
    );
    this.container.addChild(this.settingsButton);
    this.setMode(MemberMenu.MODE_NONE);
  }
  setMode(a) {
    this.mode = a;
    this.playButton.setActive(a === MemberMenu.MODE_NONE);
    this.logoutButton.setActive(a === MemberMenu.MODE_LOGIN);
    this.rankingButton.setActive(a === MemberMenu.MODE_RANKING);
    this.memberButton.setActive(a === MemberMenu.MODE_MEMBER);
    this.clanButton.setActive(a === MemberMenu.MODE_CLAN);
    this.shopButton.setActive(a === MemberMenu.MODE_SHOP);
    this.profileButton.setActive(a === MemberMenu.MODE_PROFILE);
    this.settingsButton.setActive(a === MemberMenu.MODE_SETTINGS);
  }
  resize(a, b) {
    this.x = 0.5 * a - 430;
    this.y = -8;
    this.discordButton.x = 0;
    this.joinDiscordText.x = this.discordButton.x + this.discordButton.width + 2;
    this.zapperButton.x = 0.5 * -a + 0.5 * this.container.width + 5 - 300 * (1 - App.Scale);
    this.getZapperText.x = this.zapperButton.x + this.zapperButton.width + 9;
    this.zapperButton.y = App.ClientHeight - 35 + 500 * (1 - App.Scale);
    this.getZapperText.y = App.ClientHeight - 26 + 500 * (1 - App.Scale);
    this.getZapperText.visible = 860 > App.ClientWidth || 560 > App.ClientHeight ? !1 : !0;
  }
  onLogout() {
    App.Autogen ? this.emit(Layer.Events.LOGOUT_ACCESS) : this.emit(Layer.Events.LOGOUT);
  }
}
MemberMenu.MODE_NONE = "none";
MemberMenu.MODE_RANKING = "ranking";
MemberMenu.MODE_SHOP = "shop";
MemberMenu.MODE_MEMBER = "member";
MemberMenu.MODE_CLAN = "clan";
MemberMenu.MODE_PROFILE = "profile";
MemberMenu.MODE_SETTINGS = "settings";
class MemberMenuButton extends PIXI.Graphics {
  constructor(a = "", b = 16763904, c = 18, d = null, e = !0) {
    super();
    this.interactive = !0;
    this.active = !1;
    this.rectWidth = 98;
    this.rectHeight = 70;
    this.hitArea = new PIXI.Rectangle(0, 0, this.rectWidth, this.rectHeight);
    this.backgroundEnabled = new PIXI.Graphics();
    this.backgroundEnabled.lineStyle(1, 16763904, 0.8, 0);
    this.backgroundEnabled.beginFill(6710886, 0.4);
    this.backgroundEnabled.drawRoundedRect(4, 3, 92, 69, 6);
    this.backgroundEnabled.endFill();
    e &&
      (this.backgroundEnabled.lineStyle(1, 16777215, 0.1, 0),
      this.backgroundEnabled.moveTo(8, 72),
      this.backgroundEnabled.lineTo(92, 72));
    this.backgroundDisabled = new PIXI.Graphics();
    this.backgroundDisabled.drawRect(0, 1, 100, 69);
    e &&
      (this.backgroundDisabled.lineStyle(1, 16777215, 0.1, 0),
      this.backgroundDisabled.moveTo(8, 70),
      this.backgroundDisabled.lineTo(92, 70));
    this.addChild(this.backgroundDisabled);
    this.backgroundHover = new PIXI.Graphics();
    this.backgroundHover.beginFill(0, 0.2);
    this.backgroundHover.drawRect(4, 1, 92, 69);
    this.backgroundHover.visible = !1;
    this.addChild(this.backgroundHover);
    this.activeBackground = this.backgroundDisabled;
    d &&
      ((this.icon = new PIXI.Sprite(App.CombinedTextures[d])),
      (this.icon.x = 0.5 * this.rectWidth),
      (this.icon.y = 0.37 * this.rectHeight),
      (this.icon.tint = 13421772),
      (this.icon.scale.x = 0.35),
      (this.icon.scale.y = 0.35),
      (this.icon.anchor.x = 0.5),
      (this.icon.anchor.y = 0.5),
      this.addChild(this.icon));
    this.label = new PIXI.Text(a, {
      fontSize: c,
      fontFamily: "Arial",
      fill: b,
      lineJoin: "round",
      strokeThickness: 3,
    });
    this.label.resolution = 1.5 * App.DevicePixelRatio;
    this.label.x = 0.5 * (this.rectWidth - this.label.width);
    this.label.y = 46;
    this.addChild(this.label);
    this.on("mousedown", () => {
      this.emit(MemberMenuButton.BUTTON_PRESSED);
      this.backgroundHover.visible = !1;
      AudioEffects.ButtonClick.audio.play();
    });
    this.on("touchstart", () => {
      this.emit(MemberMenuButton.BUTTON_PRESSED);
      AudioEffects.ButtonClick.audio.play();
    });
    this.on("mouseover", () => {
      this.active || (this.backgroundHover.visible = !0);
      AudioEffects.ButtonHover.audio.play();
    });
    this.on("mouseout", () => {
      this.backgroundHover.visible = !1;
    });
  }
  setActive(a = !0) {
    (this.active = a)
      ? (this.backgroundDisabled.parent && this.removeChild(this.backgroundDisabled),
        this.addChildAt(this.backgroundEnabled, 0),
        (this.activeBackground = this.backgroundEnabled))
      : (this.backgroundEnabled.parent && this.removeChild(this.backgroundEnabled),
        this.addChildAt(this.backgroundDisabled, 0),
        (this.activeBackground = this.backgroundDisabled));
  }
}
MemberMenuButton.BUTTON_PRESSED = "button_pressed";
var memberbrowsermenu = {};
class MemberBrowserMenu extends Feature {
  constructor() {
    super();
    this.searchTimeout = null;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 1);
    this.background.drawRect(0, 0, 660, 524, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504, 10);
    this.background.endFill();
    this.background.drawRect(15, 42, 630, 2);
    this.container.addChild(this.background);
    this.ox = 40;
    this.oy = 20;
    this.searchValue = "";
    this.titleText = new PIXI.Text("Players", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleText.x = 0.5 * this.width - 20;
    this.titleText.y = this.oy + 36;
    this.titleText.anchor.x = 0.5;
    this.container.addChild(this.titleText);
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy + 34;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.MEMBER_CANCEL));
    this.container.addChild(this.closeButton);
    this.container.x = 0.5 * -this.width;
    this.usernameTitle = new PIXI.Text("Name search:", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.usernameTitle.x = this.ox - 12;
    this.usernameTitle.y = this.oy + 78;
    this.container.addChild(this.usernameTitle);
    this.searchField = new InputField("name_search");
    this.searchField.setDimensions(300, 35);
    this.searchField.forceLowerCase = !1;
    this.searchField.setMaxChars(18);
    this.searchField.x = this.ox + 100;
    this.searchField.y = this.oy + 76;
    this.searchField.scale.x = this.searchField.scale.y = 0.8;
    this.searchField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#^&*-._:=[]"
    );
    this.container.addChild(this.searchField);
    this.searchField.addListener(InputField.CHANGE, (a) => {
      this.searchValue = a.data.value;
      this.onSearch();
    });
    this.loaderText = new PIXI.Text("Search results will appear here.", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 13421772,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.loaderText.x = this.ox + 20;
    this.loaderText.y = this.oy + 139;
    this.container.addChild(this.loaderText);
    this.nameText = new PIXI.Text("Name", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.nameText.x = this.ox + 20;
    this.nameText.y = this.oy + 109;
    this.container.addChild(this.nameText);
    this.skillRankingText = new PIXI.Text("Skill rank", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.skillRankingText.x = this.ox + 275;
    this.skillRankingText.y = this.oy + 109;
    this.container.addChild(this.skillRankingText);
    this.rankingText = new PIXI.Text("Experience rank", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.rankingText.x = this.ox + 400;
    this.rankingText.y = this.oy + 109;
    this.container.addChild(this.rankingText);
    this.nameFieldTableContainerMask = new PIXI.Graphics();
    this.nameFieldTableContainerMask.beginFill(16777215, 1);
    this.nameFieldTableContainerMask.drawRect(-10, 150, 640, 390);
    this.nameFieldTableContainerMask.endFill();
    this.nameFieldTableContainerMask.x = 10;
    this.container.addChild(this.nameFieldTableContainerMask);
    this.nameFieldTableContainer = new PIXI.Container();
    this.nameFieldTableContainer.x = 10;
    this.nameFieldTableContainer.mask = this.nameFieldTableContainerMask;
    this.container.addChild(this.nameFieldTableContainer);
    this.nameFieldScrollbar = new MemberBrowserScrollbar(404);
    this.nameFieldScrollbar.x = 625;
    this.nameFieldScrollbar.y = 150;
    this.container.addChild(this.nameFieldScrollbar);
    this.nameFieldScrollbar.on(MemberBrowserScrollbar.SCROLL, (a) => {
      this.nameFieldTableContainer.height > this.nameFieldTableContainerMask.height &&
        (this.nameFieldTableContainer.y = -(
          a *
          (this.nameFieldTableContainer.height - this.nameFieldTableContainerMask.height)
        ));
    });
  }
  show() {
    this.nameFieldScrollbar.enableWheel();
  }
  hide() {
    this.nameFieldScrollbar.disableWheel();
  }
  async onSearch() {
    this.nameFieldTableContainer.removeChildren();
    this.loaderText.visible = !0;
    0 === this.searchValue.trim().length
      ? (this.loaderText.text = "No results.")
      : (null !== this.searchTimeout && clearTimeout(this.searchTimeout),
        (this.loaderText.text = "Searching.."),
        (this.searchTimeout = setTimeout(() => this.search(), 750)));
  }
  async search() {
    var a = this.searchValue;
    null !== this.searchTimeout && (clearTimeout(this.searchTimeout), (this.searchTimeout = null));
    if (4 > a.trim().length) this.loaderText.text = "Name too short. Enter at least 4 characters.";
    else {
      var b = await APIClient.getUserSearch(a);
      this.nameFieldTableContainer.removeChildren();
      if (0 === a.trim().length) this.loaderText.text = "No results.";
      else if (b.success) {
        0 === b.users.length
          ? (this.loaderText.text = "No results.")
          : (this.loaderText.visible = !1);
        for (a = 0; a < b.users.length; a++) {
          const c = b.users[a],
            d = new MemberTableRow(a, c.id, c.name, parseInt(c.level), c.ranking, c.skill_ranking);
          d.x = this.ox + 20;
          d.y = this.oy + 36 * a + 130;
          d.on("mousedown", () => {
            this.emit(Layer.Events.USER_ACCESS, c.id, !1);
            AudioEffects.ButtonClick.audio.play();
          });
          this.nameFieldTableContainer.addChild(d);
        }
        this.nameFieldScrollbar.reset();
        this.nameFieldTableContainer.y = 0;
      } else this.loaderText.text = "No results (" + b.error + ").";
    }
  }
}
class MemberTableRow extends PIXI.Container {
  constructor(a, b, c, d, e, f) {
    super();
    this.index = a;
    this.interactive = !0;
    a = Math.max(Math.floor((d / 160) * 10) + 1);
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.1);
    this.background.drawRect(-10, 2, 560, 32);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    });
    this.addChild(this.background);
    this.icon = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + a]);
    this.icon.x = -48;
    this.icon.y = -2;
    this.icon.scale.x = this.icon.scale.y = 0.5;
    this.addChild(this.icon);
    this.nameText = new PIXI.BitmapText(c, { fontName: "Open Sans", fontSize: 22 });
    this.nameText.x = 0;
    this.nameText.y = 9;
    this.addChild(this.nameText);
    this.skillRankText = new PIXI.BitmapText(f.toString(), { fontName: "Open Sans", fontSize: 22 });
    this.skillRankText.x = 250;
    this.skillRankText.y = 9;
    this.skillRankText.tint = 16763904;
    this.addChild(this.skillRankText);
    this.rankText = new PIXI.BitmapText(e.toString(), { fontName: "Open Sans", fontSize: 22 });
    this.rankText.x = 375;
    this.rankText.y = 9;
    this.rankText.tint = 16763904;
    this.addChild(this.rankText);
  }
}
class MemberBrowserScrollbar extends PIXI.Container {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, this.h, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-4, -4, 32, this.h + 8);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, 0, 16, 32, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.scrollBar.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (c) => {
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (c) => {
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointermove", (c) => this.scroll(c.data.global.y / App.Scale));
    this.wheelListener = (c) => {
      c = c.data.delta;
      this.scrolling = !0;
      this.scroll(this.oy + 0.2 * c);
      this.scrolling = !1;
    };
  }
  enableWheel() {
    UserInput.hasListener(UserInput.WHEEL, this.wheelListener) ||
      UserInput.addListener(UserInput.WHEEL, this.wheelListener);
  }
  disableWheel() {
    UserInput.removeListener(UserInput.WHEEL, this.wheelListener);
  }
  scroll(a) {
    if (this.scrolling) {
      let b = this.scrollButton.y + (a - this.oy);
      -3 > b ? (b = -3) : b > this.h - 39 && (b = this.h - 39);
      let c = this.h / (this.h - 39);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(MemberBrowserScrollbar.SCROLL, (1 / this.h) * (b + 3) * c);
    }
  }
  reset() {
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
MemberBrowserScrollbar.SCROLL = "scroll";
var util = {};
Math.PI05 = 0.5 * Math.PI;
Base62Charset = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
Clamp = function (a, b, c) {
  return c < a ? a : c > b ? b : c;
};
ToPrecision = function (a, b) {
  a *= Math.pow(10, a);
  return Math.round(b * a) / a;
};
ShortAngle = function (a, b) {
  if (b > a) {
    var c = b - a;
    a = c < Math.PI ? c : -1 * (2 * Math.PI - b + a);
  } else (c = a - b), (a = c < Math.PI ? -1 * c : 2 * Math.PI - a + b);
  return a;
};
fastSplice = function (a, b) {
  const c = a.length - 1;
  b < c && (a[b] = a[c]);
  a.pop();
};
numberWithPeriods = function (a) {
  return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
};
polyAreaTri = function (a, b, c) {
  return (b.y - a.y) * (c.x - b.x) - (b.x - a.x) * (c.y - b.y);
};
polyArea = function (a) {
  for (var b = 0, c = 0, d = a.length; c < d; c++) {
    var e = (c + 1) % d;
    b += a[e].x * a[c].y - a[c].x * a[e].y;
  }
  return b / 2;
};
polyCenter = function (a) {
  for (var b = { x: 0, y: 0 }, c = a.length, d = 0; d < c; d++) (b.x += a[d].x), (b.y += a[d].y);
  b.x /= c;
  b.y /= c;
  return b;
};
polyScaleCenter = function (a, b) {
  for (var c = polyCenter(a), d = a.length, e = 0; e < d; e++) {
    var f = a[e].y - c.y;
    a[e].x += (a[e].x - c.x) * (b - 1);
    a[e].y += f * (b - 1);
  }
};
polyScaleUnitCenter = function (a, b) {
  for (var c = polyCenter(a), d = a.length, e = 0; e < d; e++) {
    var f = a[e].x - c.x,
      g = a[e].y - c.y,
      h = Math.sqrt(f * f + g * g);
    a[e].x += (f / h) * b;
    a[e].y += (g / h) * b;
  }
};
polyCenterArr = function (a) {
  for (var b = { x: 0, y: 0 }, c = a.length, d = 0; d < c; d += 2) (b.x += a[d]), (b.y += a[d + 1]);
  b.x /= 0.5 * c;
  b.y /= 0.5 * c;
  return b;
};
polyRotate = function (a, b, c) {
  c = c || { x: 0, y: 0 };
  for (var d = a.length, e = 0; e < d; e++) {
    var f = a[e].x - c.x,
      g = a[e].y - c.y,
      h = Math.sqrt(f * f + g * g);
    f = Math.atan2(g, f);
    a[e].x = h * Math.cos(f + b) + c.x;
    a[e].y = h * Math.sin(f + b) + c.y;
  }
  return a;
};
polyRotateCopy = function (a, b, c) {
  c = c || { x: 0, y: 0 };
  for (var d = a.length, e = [], f = 0; f < d; f++) {
    var g = a[f].x - c.x,
      h = a[f].y - c.y,
      m = Math.sqrt(g * g + h * h);
    g = Math.atan2(h, g);
    e[f] = { x: m * Math.cos(g + b) + c.x, y: m * Math.sin(g + b) + c.y };
  }
  return e;
};
function getDir(a, b, c) {
  return 0 > (b.x - a.x) * (c.y - a.y) - (b.y - a.y) * (c.x - a.x) ? -1 : 1;
}
function fastAtan2(a, b) {
  var c = Math.PI;
  if (0 === b) return 0 < a ? c / 2 : 0 === a ? 0 : -c / 2;
  var d = a / b;
  if (-1 > d || 1 < d) {
    if (((d = c / 2 - d / (d * d + 0.28)), 0 > a)) return d - c;
  } else if (((d /= 1 + 0.28 * d * d), 0 > b)) return 0 > a ? d - c : d + c;
  return d;
}
function Intersect(a, b, c, d, e, f, g, h, m) {
  c -= a;
  d -= b;
  g -= e;
  var n = h - f;
  h = (-d * (a - e) + c * (b - f)) / (-g * d + c * n);
  e = (g * (b - f) - n * (a - e)) / (-g * d + c * n);
  return 0 <= h && 1 >= h && 0 <= e && 1 >= e ? ((m.x = a + e * c), (m.y = b + e * d), !0) : !1;
}
function Intersect3(a, b, c, d, e, f, g, h) {
  var m = d - b,
    n = a - c,
    l = c * b - a * d;
  if (0 < (m * e + n * f + l) * (m * g + n * h + l)) return -1;
  var k = h - f;
  var p = e - g;
  l = g * f - e * h;
  g = k * a + p * b + l;
  h = k * c + p * d + l;
  return 0 < g * h ? -1 : 0 === m * p - k * n ? 0 : 1;
}
polyRotateFast = function (a, b) {
  for (var c = 0, d = a.length; c < d; c++) {
    var e = a[c].x,
      f = a[c].y,
      g = Math.sqrt(e * e + f * f);
    e = fastAtan2(f, e);
    a[c].x = g * Math.cos(e + b);
    a[c].y = g * Math.sin(e + b);
  }
};
polyRotateCopyFast = function (a, b) {
  for (var c = [], d = 0, e = a.length; d < e; d++) {
    var f = a[d].x,
      g = a[d].y,
      h = Math.sqrt(f * f + g * g);
    f = fastAtan2(g, f);
    c[d] = { x: h * Math.cos(f + b), y: h * Math.sin(f + b) };
  }
  return c;
};
polyBounds = function (a, b) {
  let c = { x: 0, y: 0, width: 0, height: 0 };
  for (let e = 0, f = a.length; e < f; e++) {
    var d = a[e].x;
    let g = a[e].y;
    d < c.x ? (c.x = d) : d > c.width && (c.width = d);
    g < c.y ? (c.y = g) : g > c.height && (c.height = g);
  }
  c.width -= c.x;
  c.height -= c.y;
  b &&
    ((a = b.x < c.x ? b.x : c.x),
    (d = b.y < c.y ? b.y : c.y),
    (c.width = (b.x + b.width < c.x + c.width ? c.x + c.width : b.x + b.width) - a),
    (c.height = (b.y + b.height < c.y + c.height ? c.y + c.height : b.y + b.height) - d),
    (c.x = a),
    (c.y = d));
  return c;
};
uintToVec4 = function (a) {
  return {
    w: parseInt(a[0] + a[1], 16) / 255,
    x: parseInt(a[2] + a[3], 16) / 255,
    y: parseInt(a[4] + a[5], 16) / 255,
    z: parseInt(a[6] + a[7], 16) / 255,
  };
};
uintToArr = function (a, b) {
  return [
    (parseInt(a[2] + a[3], 16) / 255) * b,
    (parseInt(a[4] + a[5], 16) / 255) * b,
    (parseInt(a[6] + a[7], 16) / 255) * b,
    (parseInt(a[0] + a[1], 16) / 255) * b,
  ];
};
DateUTC = function () {
  var a = new Date();
  return Date.UTC(
    a.getUTCFullYear(),
    a.getUTCMonth(),
    a.getUTCDate(),
    a.getUTCHours(),
    a.getUTCMinutes(),
    a.getUTCSeconds(),
    a.getUTCMilliseconds()
  );
};
dp = function (a, b) {
  return a.x * b.x + a.y * b.y;
};
perp = function (a, b) {
  var c = { x: 0, y: 0 };
  b ? ((c.x = -a.y), (c.y = a.x)) : ((c.x = a.y), (c.y = -a.x));
  return c;
};
mag = function (a) {
  return Math.sqrt(a.x * a.x + a.y * a.y);
};
norm = function (a) {
  var b = mag(a),
    c = { x: 0, y: 0 };
  if (0 === b) return c;
  c.x = a.x / b;
  c.y = a.y / b;
  return c;
};
project = function (a, b) {
  var c = norm(b),
    d = mag(a),
    e = mag(b);
  a = dp(a, b) / (0 === d * e ? 1e-4 : d * e);
  d *= a;
  c.x *= d;
  c.y *= d;
  return c;
};
RandomBrightColor = function () {
  let a = [Math.round(Math.random()), Math.round(Math.random()), Math.round(Math.random())];
  0 === a[0] + a[1] + a[2] && (a[Math.floor(3 * Math.random())] = 1);
  a[0] *= 170 + Math.ceil(86 * Math.random());
  a[1] *= 170 + Math.ceil(86 * Math.random());
  a[2] *= 170 + Math.ceil(86 * Math.random());
  return (a[0] << 16) | (a[1] << 8) | a[2];
};
xorshift128_seed = function (a) {
  xorshift128.s[0] = a;
  xorshift128.s[1] = (a << 1) ^ a;
};
xorshift128 = function () {
  var a = xorshift128.s[0],
    b = xorshift128.s[1],
    c = a + b;
  xorshift128.s[0] = a;
  b ^= b << 23;
  xorshift128.s[1] = b ^ a ^ (b >> 17) ^ (a >> 26);
  return c;
};
Base62Encode = function (a) {
  if (0 === a) return Base62Charset[0];
  let b = "";
  for (; 0 < a; ) (b = Base62Charset[a % 62] + b), (a = Math.floor((a / 62) >>> 0));
  return b;
};
Base62Decode = function (a) {
  var b = 0,
    c = a.length,
    d;
  for (d = 0; d < c; d++) {
    var e = a.charCodeAt(d);
    e = 58 > e ? e - 48 : 91 > e ? e - 29 : e - 87;
    b += e * Math.pow(62, c - d - 1);
  }
  return b;
};
xorshift128.s = [55403919, 12823250];
setCookie = function (a, b, c) {
  var d = "";
  c && ((d = new Date()), d.setTime(d.getTime() + 864e5 * c), (d = "; expires=" + d.toUTCString()));
  document.cookie = a + "=" + (b || "") + d + "; path=/; domain=ninja.io";
};
var clanbrowsermenu = {};
class ClanBrowserMenu extends Feature {
  constructor() {
    super();
    this.searchTimeout = null;
    this.lastRefresh = 0;
    this.clans = [];
    this.clanPropSort = "members";
    this.clanPropDir = { name: 1, skill: 1, members: -1, experience: 1 };
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 1);
    this.background.drawRect(0, 0, 660, 524, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504, 10);
    this.background.endFill();
    this.background.drawRect(15, 42, 630, 2);
    this.container.addChild(this.background);
    this.ox = 40;
    this.oy = 20;
    this.searchValue = "";
    this.titleText = new PIXI.Text("Clans", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleText.x = 0.5 * this.width - 20;
    this.titleText.y = this.oy + 36;
    this.titleText.anchor.x = 0.5;
    this.container.addChild(this.titleText);
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy + 34;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.CLAN_BROWSER_CANCEL));
    this.container.addChild(this.closeButton);
    this.container.x = 0.5 * -this.width;
    this.clanNameTitle = new PIXI.Text("Name search:", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanNameTitle.x = this.ox - 12;
    this.clanNameTitle.y = this.oy + 78;
    this.container.addChild(this.clanNameTitle);
    this.searchField = new InputField("name_search");
    this.searchField.setDimensions(300, 35);
    this.searchField.forceLowerCase = !1;
    this.searchField.setMaxChars(18);
    this.searchField.x = this.ox + 100;
    this.searchField.y = this.oy + 76;
    this.searchField.scale.x = this.searchField.scale.y = 0.8;
    this.searchField.setFilter("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890 ");
    this.container.addChild(this.searchField);
    this.searchField.addListener(InputField.CHANGE, (a) => {
      this.searchValue = a.data.value;
      this.onSearch();
    });
    this.loaderText = new PIXI.Text("Search results will appear here.", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 13421772,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.loaderText.x = this.ox + 20;
    this.loaderText.y = this.oy + 139;
    this.container.addChild(this.loaderText);
    this.nameText = new PIXI.Text("Name", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.nameText.x = this.ox + 20;
    this.nameText.y = this.oy + 109;
    this.nameText.tint = 16755200;
    this.nameText.interactive = !0;
    this.nameText.hitArea = new PIXI.Rectangle(0, 0, this.nameText.width, this.nameText.height);
    this.container.addChild(this.nameText);
    this.nameText.on("mouseover", () => {
      this.nameText.tint = 16776960;
    });
    this.nameText.on("mouseout", () => {
      this.nameText.tint = 16755200;
    });
    this.nameText.on("mousedown", () => {
      this.clanPropSort = "name";
      this.clanPropDir[this.clanPropSort] *= -1;
      this.sortClans(this.clanPropSort, this.clanPropDir[this.clanPropSort]);
      AudioEffects.ButtonClick.audio.play();
    });
    this.membersText = new PIXI.Text("Members", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.membersText.x = this.ox + 220;
    this.membersText.y = this.oy + 109;
    this.membersText.tint = 16755200;
    this.membersText.interactive = !0;
    this.membersText.hitArea = new PIXI.Rectangle(
      0,
      0,
      this.membersText.width,
      this.membersText.height
    );
    this.container.addChild(this.membersText);
    this.membersText.on("mouseover", () => {
      this.membersText.tint = 16776960;
    });
    this.membersText.on("mouseout", () => {
      this.membersText.tint = 16755200;
    });
    this.membersText.on("mousedown", () => {
      this.clanPropSort = "members";
      this.clanPropDir[this.clanPropSort] *= -1;
      this.sortClans(this.clanPropSort, this.clanPropDir[this.clanPropSort]);
      AudioEffects.ButtonClick.audio.play();
    });
    this.skillRankingText = new PIXI.Text("Avg. skill", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.skillRankingText.x = this.ox + 340;
    this.skillRankingText.y = this.oy + 109;
    this.skillRankingText.tint = 16755200;
    this.skillRankingText.interactive = !0;
    this.skillRankingText.hitArea = new PIXI.Rectangle(
      0,
      0,
      this.skillRankingText.width,
      this.skillRankingText.height
    );
    this.container.addChild(this.skillRankingText);
    this.skillRankingText.on("mouseover", () => {
      this.skillRankingText.tint = 16776960;
    });
    this.skillRankingText.on("mouseout", () => {
      this.skillRankingText.tint = 16755200;
    });
    this.skillRankingText.on("mousedown", () => {
      this.clanPropSort = "skill";
      this.clanPropDir[this.clanPropSort] *= -1;
      this.sortClans(this.clanPropSort, this.clanPropDir[this.clanPropSort]);
      AudioEffects.ButtonClick.audio.play();
    });
    this.experienceRankingText = new PIXI.Text("Avg. experience", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.experienceRankingText.x = this.ox + 440;
    this.experienceRankingText.y = this.oy + 109;
    this.experienceRankingText.tint = 16755200;
    this.experienceRankingText.interactive = !0;
    this.experienceRankingText.hitArea = new PIXI.Rectangle(
      0,
      0,
      this.experienceRankingText.width,
      this.experienceRankingText.height
    );
    this.container.addChild(this.experienceRankingText);
    this.experienceRankingText.on("mouseover", () => {
      this.experienceRankingText.tint = 16776960;
    });
    this.experienceRankingText.on("mouseout", () => {
      this.experienceRankingText.tint = 16755200;
    });
    this.experienceRankingText.on("mousedown", () => {
      this.clanPropSort = "experience";
      this.clanPropDir[this.clanPropSort] *= -1;
      this.sortClans(this.clanPropSort, this.clanPropDir[this.clanPropSort]);
      AudioEffects.ButtonClick.audio.play();
    });
    this.nameFieldTableContainerMask = new PIXI.Graphics();
    this.nameFieldTableContainerMask.beginFill(16777215, 1);
    this.nameFieldTableContainerMask.drawRect(-10, 150, 640, 390);
    this.nameFieldTableContainerMask.endFill();
    this.nameFieldTableContainerMask.x = 10;
    this.container.addChild(this.nameFieldTableContainerMask);
    this.nameFieldTableContainer = new PIXI.Container();
    this.nameFieldTableContainer.x = 10;
    this.nameFieldTableContainer.mask = this.nameFieldTableContainerMask;
    this.container.addChild(this.nameFieldTableContainer);
    this.nameFieldScrollbar = new ClanBrowserScrollbar(404);
    this.nameFieldScrollbar.x = 625;
    this.nameFieldScrollbar.y = 150;
    this.container.addChild(this.nameFieldScrollbar);
    this.nameFieldScrollbar.on(ClanBrowserScrollbar.SCROLL, (a) => {
      this.nameFieldTableContainer.height > this.nameFieldTableContainerMask.height &&
        (this.nameFieldTableContainer.y = -(
          a *
          (this.nameFieldTableContainer.height - this.nameFieldTableContainerMask.height)
        ));
    });
  }
  show() {
    super.show();
    let a = Date.now();
    6e4 < a - this.lastRefresh && ((this.lastRefresh = a), this.onSearch(!1));
    this.nameFieldScrollbar.enableWheel();
  }
  hide() {
    this.nameFieldScrollbar.disableWheel();
  }
  onSearch(a = !0) {
    this.nameFieldTableContainer.removeChildren();
    this.loaderText.visible = !0;
    null !== this.searchTimeout && clearTimeout(this.searchTimeout);
    this.loaderText.text = "Searching..";
    a ? (this.searchTimeout = setTimeout(async () => this.search(), 750)) : this.search();
  }
  async search() {
    this.clans = [];
    var a = this.searchValue;
    null !== this.searchTimeout && (clearTimeout(this.searchTimeout), (this.searchTimeout = null));
    0 === a.trim().length && (a = "*");
    a = await APIClient.getClanSearch(a);
    if (a.success) {
      0 === a.clans.length
        ? (this.loaderText.text = "No results.")
        : (this.loaderText.visible = !1);
      this.clans = a.clans;
      for (let b = 0; b < a.clans.length; b++) {
        const c = a.clans[b],
          d = new ClanTableRow(b, c.id, c.name, c.members, c.skill, c.experience, c.level);
        d.x = this.ox + 20;
        d.y = this.oy + 36 * b + 130;
        d.on("mousedown", () => {
          this.emit(Layer.Events.CLAN_ACCESS, c.id);
          AudioEffects.ButtonClick.audio.play();
        });
        c.row = d;
        this.nameFieldTableContainer.addChild(d);
      }
      this.sortClans(this.clanPropSort, this.clanPropDir[this.clanPropSort]);
      this.nameFieldScrollbar.reset();
      this.nameFieldTableContainer.y = 0;
    } else this.loaderText.text = "No results (error).";
  }
  sortClans(a, b = 1) {
    "name" === a
      ? this.clans.sort((c, d) =>
          c[a].toLowerCase() < d[a].toLowerCase()
            ? -b
            : c[a].toLowerCase() > d[a].toLowerCase()
            ? b
            : 0
        )
      : this.clans.sort((c, d) =>
          parseInt(c[a]) < parseInt(d[a]) ? -b : parseInt(c[a]) > parseInt(d[a]) ? b : 0
        );
    for (let c = 0; c < this.clans.length; c++)
      (this.clans[c].row.y = this.oy + 36 * c + 130), this.clans[c].row.setIndex(c);
  }
}
class ClanTableRow extends PIXI.Container {
  constructor(a, b, c, d, e, f, g) {
    super();
    this.index = a;
    this.interactive = !0;
    b = Math.max(Math.floor((parseInt(g) / 160) * 10) + 1);
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.1);
    this.background.drawRect(-10, 2, 560, 32);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    });
    this.addChild(this.background);
    this.setIndex(a);
    this.icon = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + b]);
    this.icon.x = -48;
    this.icon.y = -2;
    this.icon.scale.x = this.icon.scale.y = 0.5;
    this.addChild(this.icon);
    this.nameText = new PIXI.BitmapText(c, { fontName: "Open Sans", fontSize: 22 });
    this.nameText.x = 0;
    this.nameText.y = 9;
    this.nameText.tint = 16763904;
    this.addChild(this.nameText);
    this.membersText = new PIXI.BitmapText(numberWithPeriods(parseInt(d)), {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.membersText.x = 195;
    this.membersText.y = 9;
    this.addChild(this.membersText);
    this.skillText = new PIXI.BitmapText(numberWithPeriods(parseInt(e)), {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.skillText.x = 315;
    this.skillText.y = 9;
    this.addChild(this.skillText);
    this.experienceText = new PIXI.BitmapText(numberWithPeriods(parseInt(f)), {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.experienceText.x = 415;
    this.experienceText.y = 9;
    this.addChild(this.experienceText);
  }
  setIndex(a = -1) {
    -1 !== a && (this.index = a);
    this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
  }
}
class ClanBrowserScrollbar extends PIXI.Container {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, this.h, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-4, -4, 32, this.h + 8);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, 0, 16, 32, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.scrollBar.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (c) => {
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (c) => {
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointermove", (c) => this.scroll(c.data.global.y / App.Scale));
    this.wheelListener = (c) => {
      c = c.data.delta;
      this.scrolling = !0;
      this.scroll(this.oy + 0.2 * c);
      this.scrolling = !1;
    };
  }
  enableWheel() {
    UserInput.hasListener(UserInput.WHEEL, this.wheelListener) ||
      UserInput.addListener(UserInput.WHEEL, this.wheelListener);
  }
  disableWheel() {
    UserInput.removeListener(UserInput.WHEEL, this.wheelListener);
  }
  scroll(a) {
    if (this.scrolling) {
      let b = this.scrollButton.y + (a - this.oy);
      -3 > b ? (b = -3) : b > this.h - 39 && (b = this.h - 39);
      let c = this.h / (this.h - 39);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(ClanBrowserScrollbar.SCROLL, (1 / this.h) * (b + 3) * c);
    }
  }
  reset() {
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
ClanBrowserScrollbar.SCROLL = "scroll";
var button = {};
class Button extends PIXI.Graphics {
  constructor(a, b = null, c = null, d = null) {
    super();
    EventDispatcher.call(this);
    this.id = a || "button";
    this.value = "";
    this.interactive = this.enabled = !0;
    this.pressed = !1;
    this.clickInterval = d;
    this.hoverImage = this.image = this.clickTimeout = null;
    null !== b && ((this.image = new PIXI.Sprite(b)), this.addChild(this.image));
    null !== c &&
      ((this.hoverImage = new PIXI.Sprite(c)),
      (this.hoverImage.visible = !1),
      this.addChild(this.hoverImage));
    this.edge = new PIXI.Graphics();
    this.on("mousedown", (e) => this.onMouseDown(e));
    this.on("mouseup", (e) => this.onMouseUp(e));
    this.on("mouseover", () => this.onMouseOver());
    this.on("mouseout", () => this.onMouseOut());
    this.on("touchstart", (e) => this.onMouseDown(e));
    this.on("pointerup", (e) => this.onMouseUp(e));
  }
  setText(a, b, c) {
    this.text
      ? (this.text.text = a)
      : ((this.text = new PIXI.Text(a, {
          fontSize: 22,
          fontFamily: "Arial",
          fill: 16777215,
          lineJoin: "round",
          strokeThickness: 3,
        })),
        (this.text.resolution = 1.5 * App.DevicePixelRatio));
    this.addChild(this.text);
    this.text.x = b || 0;
    this.text.y = c || 5;
    this.draw();
  }
  redraw() {}
  draw() {
    this.image ||
      (this.clear(),
      this.lineStyle(3, 16777215, 0.2, 1),
      this.beginFill(11184810, 0.3),
      this.drawRoundedRect(-10, 0, this.text.width + 21, 36, 6),
      this.endFill(),
      this.edge.clear(),
      this.edge.lineStyle(3, 16777215, 0.4, 1),
      this.edge.drawRoundedRect(-10, 0, this.text.width + 21, 36, 6));
  }
  withinClickInterval() {
    if (null === this.clickInterval) return !1;
    if (null !== this.clickTimeout) return !0;
    this.clickTimeout = setTimeout(() => {
      this.clickTimeout = null;
      this.enable();
    }, this.clickInterval);
    this.disable();
    return !1;
  }
  onMouseDown(a) {
    a.stopPropagation();
    this.interactive &&
      !this.pressed &&
      (this.dispatchEvent(new CustomEvent(Button.BUTTON_PRESSED, { id: this.id })),
      (this.pressed = !0),
      AudioEffects.ButtonClick.audio.play());
  }
  onMouseUp(a) {
    a.stopPropagation();
    this.interactive &&
      !this.withinClickInterval() &&
      this.pressed &&
      (this.dispatchEvent(new CustomEvent(Button.BUTTON_RELEASED, { id: this.id })),
      (this.pressed = !1));
  }
  onMouseOver() {
    this.interactive &&
      (this.edge.parent || this.addChild(this.edge),
      AudioEffects.ButtonHover.audio.play(),
      this.image && this.hoverImage && ((this.image.visible = !1), (this.hoverImage.visible = !0)));
  }
  onMouseOut() {
    this.interactive &&
      (this.edge.parent && this.removeChild(this.edge),
      this.image && this.hoverImage && ((this.image.visible = !0), (this.hoverImage.visible = !1)));
  }
  disable() {
    this.alpha = 0.5;
    this.enabled = this.interactive = !1;
  }
  enable() {
    this.alpha = 1;
    this.enabled = this.interactive = !0;
  }
  setValue(a) {
    this.value = a;
  }
  setSize(a, b) {
    this.text.x = 0.25 * (a - this.text.width);
    this.text.y = 0.25 * (b - this.text.height);
  }
  setTint(a) {
    this.tint = a;
    this.text && (this.text.tint = a);
    this.image ||
      (this.edge.clear(),
      this.edge.lineStyle(3, this.tint, 0.4, 1),
      this.edge.drawRoundedRect(-10, 0, this.text.width + 21, 36, 6));
  }
}
Button.BUTTON_PRESSED = "buttonPressed";
Button.BUTTON_RELEASED = "buttonReleased";
var loginmenu = {};
class LoginMenu extends Feature {
  constructor() {
    super();
    this.storeCredentialFlag = !0;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504);
    this.background.endFill();
    this.background.drawRect(15, 42, 630, 2);
    this.background.beginFill(0, 0.3);
    this.background.drawRect(130, 53, 400, 451);
    this.background.endFill();
    this.container.addChild(this.background);
    this.ox = 160;
    this.oy = 40;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy + 14;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.LOGIN_CANCEL));
    this.container.addChild(this.closeButton);
    this.loginTitle = new PIXI.Text("Login", {
      fontName: "Arial",
      fontSize: 19,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.loginTitle.x = 0.5 * this.width - 0.5 * this.loginTitle.width;
    this.loginTitle.y = this.oy + 16;
    this.container.addChild(this.loginTitle);
    this.usernameTitle = new PIXI.Text("Username", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.usernameTitle.x = this.ox;
    this.usernameTitle.y = this.oy + 80;
    this.container.addChild(this.usernameTitle);
    this.passwordTitle = new PIXI.Text("Password", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.passwordTitle.x = this.ox;
    this.passwordTitle.y = this.oy + 140;
    this.container.addChild(this.passwordTitle);
    this.errorMessage = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 19,
      fill: 16711680,
      strokeThickness: 3,
      lineJoin: "round",
      wordWrap: !0,
      wordWrapWidth: 360,
    });
    this.errorMessage.x = this.ox;
    this.errorMessage.y = this.oy + 280;
    this.recoverTitle = new PIXI.Text("Recover username / password", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.recoverTitle.x = this.ox;
    this.recoverTitle.y = this.oy + 480;
    this.recoverTitle.tint = 16746496;
    App.WhiteLabel !== App.WhiteLabel_POKI && this.container.addChild(this.recoverTitle);
    this.recoverTitle.interactive = !0;
    this.recoverTitle.hitArea = this.recoverTitle.getLocalBounds();
    this.recoverTitle.on("mousedown", () => {
      this.recoverTitle.tint = 16746496;
      this.emit(Layer.Events.RECOVER_ACCESS);
    });
    this.recoverTitle.on("mouseover", () => (this.recoverTitle.tint = 16763904));
    this.recoverTitle.on("mouseout", () => (this.recoverTitle.tint = 16746496));
    this.nameField = new InputField("login_name");
    this.nameField.setDimensions(300, 35);
    this.nameField.forceLowerCase = !1;
    this.nameField.setMaxChars(18);
    this.nameField.x = this.ox;
    this.nameField.y = this.oy + 100;
    this.nameField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#^&*-._:=[]"
    );
    this.container.addChild(this.nameField);
    this.passwordField = new InputField("login_password");
    this.passwordField.setDimensions(300, 35);
    this.passwordField.forceLowerCase = !1;
    this.passwordField.setMaxChars(32);
    this.passwordField.setPassword(!0);
    this.passwordField.x = this.ox;
    this.passwordField.y = this.oy + 160;
    this.passwordField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-.@!#$%^&*()[]"
    );
    this.container.addChild(this.passwordField);
    this.storeCredential = new Checkbox("storeCredential", "Stay logged in", !0);
    this.storeCredential.x = this.ox;
    this.storeCredential.y = this.oy + 204;
    this.storeCredential.setChecked(this.storeCredentialFlag);
    this.storeCredential.on(Checkbox.CHANGE, (a) => (this.storeCredentialFlag = a));
    this.container.addChild(this.storeCredential);
    this.submitButton = new Button("login");
    this.submitButton.selected = !0;
    this.submitButton.setText("Login");
    this.submitButton.scale.x = this.submitButton.scale.y = 0.8;
    this.submitButton.addListener(Button.BUTTON_RELEASED, this.onSubmitButtonReleased.bind(this));
    this.submitButton.x = this.ox + 11;
    this.submitButton.y = this.oy + 244;
    this.submitButton.setTint(16763904);
    this.container.addChild(this.submitButton);
    this.loadingContainer = new PIXI.Container();
    this.loadingBackground = new PIXI.Graphics();
    this.loadingBackground.x = 0;
    this.loadingBackground.y = 0;
    this.loadingBackground.lineStyle(3, 11184810, 0.5, 0);
    this.loadingBackground.beginFill(0, 0.8);
    this.loadingBackground.drawRoundedRect(0, 0, 300, 80, 10);
    this.loadingBackground.endFill();
    this.loadingContainer.addChild(this.loadingBackground);
    this.loadingText = new PIXI.Text("Processing login...", {
      fontName: "Arial",
      fontSize: 19,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.loadingText.x = 0.5 * this.loadingBackground.width;
    this.loadingText.y = 0.5 * this.loadingBackground.height;
    this.loadingText.anchor.x = this.loadingText.anchor.y = 0.5;
    this.loadingContainer.addChild(this.loadingText);
    this.loadingContainer.x = 0.5 * -this.loadingBackground.width;
    this.loadingContainer.y = 0.5 * this.container.height - 0.5 * this.loadingBackground.height;
    this.completedContainer = new PIXI.Container();
    this.completedBackground = new PIXI.Graphics();
    this.completedBackground.x = 0;
    this.completedBackground.y = 0;
    this.completedBackground.lineStyle(3, 11184810, 0.5, 0);
    this.completedBackground.beginFill(0, 0.8);
    this.completedBackground.drawRoundedRect(0, 0, 360, 130, 10);
    this.completedBackground.endFill();
    this.completedContainer.addChild(this.completedBackground);
    this.completedText = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 19,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.completedText.x = 0.5 * this.completedBackground.width;
    this.completedText.y = 0.3 * this.completedBackground.height;
    this.completedText.anchor.x = this.completedText.anchor.y = 0.5;
    this.completedContainer.addChild(this.completedText);
    this.completedButton = new Button("continue");
    this.completedButton.selected = !0;
    this.completedButton.setText("Continue");
    this.completedButton.scale.x = this.completedButton.scale.y = 0.8;
    this.completedButton.addListener(
      Button.BUTTON_RELEASED,
      this.onCompletedButtonReleased.bind(this)
    );
    this.completedButton.x =
      0.5 * this.completedBackground.width - 0.5 * this.completedButton.width;
    this.completedButton.y = this.completedBackground.height - (this.completedButton.height + 16);
    this.completedContainer.addChild(this.completedButton);
    this.completedContainer.x = 0.5 * -this.completedBackground.width;
    this.completedContainer.y = 0.5 * this.container.height - 0.5 * this.completedBackground.height;
    this.container.x = 0.5 * -this.width;
  }
  show() {
    this.container.interactiveChildren = !0;
    this.submitButton.enable();
    this.container.alpha = 1;
  }
  reset() {
    this.loadingContainer.parent && this.removeChild(this.loadingContainer);
    this.completedContainer.parent && this.removeChild(this.completedContainer);
    this.passwordField.setText("");
    this.container.interactiveChildren = !0;
    this.submitButton.enable();
    this.container.alpha = 1;
  }
  validateForm() {
    let a = !0,
      b = "",
      c = this.nameField.getText(),
      d = this.passwordField.getText();
    4 > c.length
      ? ((a = !1), (b = "Invalid username."), this.nameField.markInvalid())
      : this.nameField.markNone();
    a && 8 > d.length
      ? ((a = !1), (b = "Invalid password."), this.passwordField.markInvalid())
      : this.passwordField.markNone();
    return { valid: a, error: b };
  }
  onSubmitButtonReleased() {
    const a = this.validateForm();
    a.valid
      ? (this.displayErrorMessage(""),
        this.displayLoadingMessage(),
        this.emit(Layer.Events.LOGIN_SUBMIT, {
          name: this.nameField.text.text,
          password: this.passwordField.text.text,
          store: this.storeCredentialFlag,
        }))
      : this.displayErrorMessage(a.error);
  }
  displayLoadingMessage() {
    this.container.interactiveChildren = !1;
    this.addChild(this.loadingContainer);
    this.submitButton.disable();
    this.container.alpha = 0.5;
  }
  displayCompletedMessage() {
    this.loadingContainer.parent && this.removeChild(this.loadingContainer);
    this.container.interactiveChildren = !1;
    this.addChild(this.completedContainer);
    this.submitButton.disable();
    this.container.alpha = 0.5;
    this.completedText.text = "Logged in as " + this.nameField.getText();
  }
  onCompletedButtonReleased() {
    this.loadingContainer.parent && this.removeChild(this.loadingContainer);
    this.completedContainer.parent && this.removeChild(this.completedContainer);
    this.passwordField.setText("");
    this.emit(Layer.Events.LOGIN_CANCEL);
  }
  onCancelButtonReleased() {
    this.emit(Layer.Events.LOGIN_CANCEL);
  }
  displayErrorMessage(a) {
    this.errorMessage.text = a;
    this.errorMessage.parent || this.container.addChild(this.errorMessage);
  }
}
var checkbox = {};
class Checkbox extends PIXI.Container {
  constructor(a, b, c) {
    super();
    this.id = a;
    this.labelText = b;
    this.checked = c || !1;
    this.tex_unchecked = App.CombinedTextures.checkbox;
    this.tex_checked = App.CombinedTextures.checkbox_checked;
    this.icon = new PIXI.Sprite(this.checked ? this.tex_checked : this.tex_unchecked);
    this.icon.scale.x = this.icon.scale.y = 0.4;
    this.interactive = !0;
    this.label = new PIXI.Text(this.labelText, {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.label.x = this.icon.x + 34;
    this.label.y = this.icon.y + 3;
    this.label.resolution = 1.5 * App.DevicePixelRatio;
    this.pointerDownListener = this.mouseDownListener = null;
    this.addChild(this.icon);
    this.addChild(this.label);
    this.setEnabled(!0);
  }
  onMouseDown(a) {
    this.checked = !this.checked;
    this.icon.texture = this.checked ? this.tex_checked : this.tex_unchecked;
    this.emit(Checkbox.CHANGE, this.checked);
    AudioEffects.ButtonClick.audio.play();
  }
  setChecked(a, b = !0) {
    this.checked = a;
    this.icon.texture = this.checked ? this.tex_checked : this.tex_unchecked;
    b && this.emit(Checkbox.CHANGE, this.checked);
  }
  setEnabled(a) {
    a
      ? (null === this.mouseDownListener &&
          ((this.mouseDownListener = this.onMouseDown.bind(this)),
          this.on("mousedown", this.mouseDownListener),
          (this.pointerDownListener = this.onMouseDown.bind(this)),
          this.on("touchstart", this.pointerDownListener)),
        (this.alpha = 1))
      : (null !== this.mouseDownListener &&
          (this.removeListener("mousedown", this.mouseDownListener),
          (this.mouseDownListener = null),
          this.removeListener("touchstart", this.pointerDownListener),
          (this.pointerDownListener = null)),
        (this.alpha = 0.25));
  }
  setTint(a) {
    this.label.tint = a;
  }
}
Checkbox.CHANGE = "checkbox_change";
var registermenu = {};
class RegisterMenu extends Feature {
  constructor() {
    super();
    let a = App.WhiteLabel === App.WhiteLabel_POKI ? -96 : 0;
    this.challengeTexture = null;
    this.hasVerifiedEmail = !1;
    this.emailDisabled = !0;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504);
    this.background.endFill();
    this.background.drawRect(15, 42, 630, 2);
    this.background.beginFill(0, 0.3);
    this.background.drawRect(100, 53, 460, 451);
    this.background.endFill();
    this.container.addChild(this.background);
    this.ox = 130;
    this.oy = 40;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy + 14;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.REGISTER_CANCEL));
    this.container.addChild(this.closeButton);
    this.loginTitle = new PIXI.Text("Register", {
      fontName: "Arial",
      fontSize: 19,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.loginTitle.x = 0.5 * this.width - 0.5 * this.loginTitle.width;
    this.loginTitle.y = this.oy + 16;
    this.container.addChild(this.loginTitle);
    this.emailCheck = new Checkbox("email_check", "Register without email", !0);
    this.emailCheck.x = this.ox;
    this.emailCheck.y = this.oy + 84;
    this.emailCheck.setChecked(!0);
    this.emailCheck.on(Checkbox.CHANGE, (b) => {
      this.emailTitle.alpha = b ? 0.3 : 1;
      this.emailField.alpha = b ? 0.3 : 1;
      this.emailField.interactive = b ? !1 : !0;
      this.emailDisabled = b;
    });
    this.emailTitle = new PIXI.Text("Email", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.emailTitle.x = this.ox;
    this.emailTitle.y = this.oy + 118;
    App.WhiteLabel !== App.WhiteLabel_POKI &&
      (this.container.addChild(this.emailCheck), this.container.addChild(this.emailTitle));
    this.usernameTitle = new PIXI.Text("Username", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.usernameTitle.x = this.ox;
    this.usernameTitle.y = this.oy + 180 + a;
    this.container.addChild(this.usernameTitle);
    this.passwordTitle = new PIXI.Text("Password", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.passwordTitle.x = this.ox;
    this.passwordTitle.y = this.oy + 240 + a;
    this.container.addChild(this.passwordTitle);
    this.errorMessage = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16711680,
      strokeThickness: 2,
      lineJoin: "round",
      wordWrap: !0,
      wordWrapWidth: 380,
    });
    this.errorMessage.x = this.ox;
    this.errorMessage.y = this.oy + 350 + a;
    this.emailField = new InputField("register_email");
    this.emailField.setDimensions(300, 35);
    this.emailField.forceLowerCase = !1;
    this.emailField.setMaxChars(64);
    this.emailField.x = this.ox;
    this.emailField.y = this.oy + 140 + a;
    this.emailField.alpha = 0.3;
    this.emailField.interactive = !1;
    this.emailField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890@.+_-"
    );
    this.container.addChild(this.emailField);
    App.WhiteLabel !== App.WhiteLabel_POKI && this.container.addChild(this.emailField);
    this.nameField = new InputField("register_name");
    this.nameField.setDimensions(300, 35);
    this.nameField.forceLowerCase = !1;
    this.nameField.setMaxChars(18);
    this.nameField.x = this.ox;
    this.nameField.y = this.oy + 200 + a;
    this.nameField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-().[]!"
    );
    this.container.addChild(this.nameField);
    this.passwordField = new InputField("register_password");
    this.passwordField.setDimensions(300, 35);
    this.passwordField.forceLowerCase = !1;
    this.passwordField.setMaxChars(32);
    this.passwordField.setPassword(!0);
    this.passwordField.x = this.ox;
    this.passwordField.y = this.oy + 260 + a;
    this.passwordField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-.@!#$%^&*()[]"
    );
    this.container.addChild(this.passwordField);
    this.submitButton = new Button("register");
    this.submitButton.selected = !0;
    this.submitButton.setText("Register");
    this.submitButton.scale.x = this.submitButton.scale.y = 0.8;
    this.submitButton.addListener(Button.BUTTON_RELEASED, this.onSubmitButtonReleased.bind(this));
    this.submitButton.x = this.ox + 11;
    this.submitButton.y = this.oy + 314 + a;
    this.submitButton.setTint(16763904);
    this.container.addChild(this.submitButton);
    this.loadingContainer = new PIXI.Container();
    this.loadingBackground = new PIXI.Graphics();
    this.loadingBackground.x = 0;
    this.loadingBackground.y = 0;
    this.loadingBackground.lineStyle(3, 11184810, 0.5, 0);
    this.loadingBackground.beginFill(0, 0.8);
    this.loadingBackground.drawRoundedRect(0, 0, 300, 80, 10);
    this.loadingBackground.endFill();
    this.loadingContainer.addChild(this.loadingBackground);
    this.loadingText = new PIXI.BitmapText("Processing registration...", {
      fontName: "Open Sans",
      fontSize: 26,
      align: "left",
    });
    this.loadingText.x = 0.5 * this.loadingBackground.width;
    this.loadingText.y = 0.5 * this.loadingBackground.height;
    this.loadingText.tint = 16763904;
    this.loadingText.anchor.x = this.loadingText.anchor.y = 0.5;
    this.loadingContainer.addChild(this.loadingText);
    this.loadingContainer.x = 0.5 * -this.loadingBackground.width;
    this.loadingContainer.y = 0.5 * this.container.height - 0.5 * this.loadingBackground.height;
    this.emailVerificationContainer = new PIXI.Container();
    this.emailVerificationBackground = new PIXI.Graphics();
    this.emailVerificationBackground.x = 0;
    this.emailVerificationBackground.y = 0;
    this.emailVerificationBackground.lineStyle(3, 11184810, 0.5, 0);
    this.emailVerificationBackground.beginFill(0, 0.8);
    this.emailVerificationBackground.drawRoundedRect(0, 0, 440, 240, 10);
    this.emailVerificationBackground.endFill();
    this.emailVerificationContainer.addChild(this.emailVerificationBackground);
    this.emailVerificationContainer.x = 0.5 * -this.emailVerificationContainer.width;
    this.emailVerificationContainer.y =
      0.5 * this.container.height - 0.5 * this.emailVerificationContainer.height;
    this.emailVerificationText = new PIXI.BitmapText("Verify email address", {
      fontName: "Open Sans",
      fontSize: 26,
      align: "center",
      multiline: !0,
    });
    this.emailVerificationText.x = 0.5 * this.emailVerificationContainer.width;
    this.emailVerificationText.y = 40;
    this.emailVerificationText.tint = 16763904;
    this.emailVerificationText.anchor.x = this.emailVerificationText.anchor.y = 0.5;
    this.emailVerificationContainer.addChild(this.emailVerificationText);
    this.emailVerificationWarning = new PIXI.BitmapText(
      "Enter your email address again to verify",
      { fontName: "Open Sans", fontSize: 22, align: "left" }
    );
    this.emailVerificationWarning.x = 0.5 * this.emailVerificationContainer.width;
    this.emailVerificationWarning.y = 66;
    this.emailVerificationWarning.tint = 16733440;
    this.emailVerificationWarning.anchor.x = this.emailVerificationText.anchor.y = 0.5;
    this.emailVerificationContainer.addChild(this.emailVerificationWarning);
    this.emailVerificationField = new InputField("verify_email");
    this.emailVerificationField.setDimensions(380, 35);
    this.emailVerificationField.forceLowerCase = !1;
    this.emailVerificationField.setMaxChars(64);
    this.emailVerificationField.x =
      0.5 * (this.emailVerificationContainer.width - this.emailVerificationField.width);
    this.emailVerificationField.y = 90;
    this.emailVerificationField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890@.+_-"
    );
    this.emailVerificationContainer.addChild(this.emailVerificationField);
    this.verifyBox = new Checkbox("verify", "", !0);
    this.verifyBox.x = 28;
    this.verifyBox.y = 140;
    this.verifyBox.setChecked(this.hasVerifiedEmail);
    this.verifyBox.on(Checkbox.CHANGE, (b) => (this.hasVerifiedEmail = b));
    this.emailVerificationContainer.addChild(this.verifyBox);
    this.verificationBoxWarning = new PIXI.BitmapText(
      "Verify that you own this email address.\nYou cannot access this account without it.",
      { fontName: "Open Sans", fontSize: 22, align: "left" }
    );
    this.verificationBoxWarning.x = 60;
    this.verificationBoxWarning.y = this.verifyBox.y - 6;
    this.verificationBoxWarning.tint = 16776960;
    this.verificationBoxWarning.anchor.x = this.verificationBoxWarning.anchor.y = 0;
    this.emailVerificationContainer.addChild(this.verificationBoxWarning);
    this.emailVerificationButton = new Button("verify_email");
    this.emailVerificationButton.selected = !0;
    this.emailVerificationButton.setText("Verify");
    this.emailVerificationButton.scale.x = this.emailVerificationButton.scale.y = 0.6;
    this.emailVerificationButton.addListener(
      Button.BUTTON_RELEASED,
      this.onEmailVerificationButtonReleased.bind(this)
    );
    this.emailVerificationButton.x =
      0.5 * (this.emailVerificationContainer.width - this.emailVerificationButton.width) - 50;
    this.emailVerificationButton.y = 190;
    this.emailVerificationContainer.addChild(this.emailVerificationButton);
    this.emailVerificationCancelButton = new Button("verify_cancel_email");
    this.emailVerificationCancelButton.selected = !1;
    this.emailVerificationCancelButton.setText("Cancel");
    this.emailVerificationCancelButton.scale.x = this.emailVerificationCancelButton.scale.y = 0.6;
    this.emailVerificationCancelButton.addListener(
      Button.BUTTON_RELEASED,
      this.onCancelEmailVerificationButtonReleased.bind(this)
    );
    this.emailVerificationCancelButton.x =
      0.5 * (this.emailVerificationContainer.width - this.emailVerificationCancelButton.width) + 50;
    this.emailVerificationCancelButton.y = 190;
    this.emailVerificationContainer.addChild(this.emailVerificationCancelButton);
    this.completedContainer = new PIXI.Container();
    this.completedBackground = new PIXI.Graphics();
    this.completedBackground.x = 0;
    this.completedBackground.y = 0;
    this.completedBackground.lineStyle(3, 11184810, 0.5, 0);
    this.completedBackground.beginFill(0, 0.8);
    this.completedBackground.drawRoundedRect(0, 0, 400, 280, 10);
    this.completedBackground.endFill();
    this.completedContainer.addChild(this.completedBackground);
    this.completedText = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 26,
      align: "center",
      multiline: !0,
    });
    this.completedText.x = 0.5 * this.completedBackground.width;
    this.completedText.y = 0.35 * this.completedBackground.height;
    this.completedText.tint = 16763904;
    this.completedText.anchor.x = this.completedText.anchor.y = 0.5;
    this.completedContainer.addChild(this.completedText);
    this.completedButton = new Button("continue");
    this.completedButton.selected = !0;
    this.completedButton.setText("Continue");
    this.completedButton.scale.x = this.completedButton.scale.y = 0.6;
    this.completedButton.addListener(
      Button.BUTTON_RELEASED,
      this.onCompletedButtonReleased.bind(this)
    );
    this.completedButton.x =
      0.5 * this.completedBackground.width - 0.5 * this.completedButton.width;
    this.completedButton.y = this.completedBackground.height - (this.completedButton.height + 16);
    this.completedContainer.addChild(this.completedButton);
    this.completedContainer.x = 0.5 * -this.completedBackground.width;
    this.completedContainer.y = 0.5 * this.container.height - 0.5 * this.completedBackground.height;
    this.container.x = 0.5 * -this.width;
  }
  validateForm() {
    let a = !0,
      b = "";
    const c = this.emailField.getText(),
      d = this.nameField.getText(),
      e = this.passwordField.getText();
    if (!this.emailDisabled)
      if (
        (a &&
          (3 > c.length ||
            !c.match(
              /^[\w-]+(\.[\w-]+)*@([a-z0-9-]+(\.[a-z0-9-]+)*?\.[a-z]{2,6}|(\d{1,3}\.){3}\d{1,3})(:\d{4})?$/g
            ))) ||
        -1 !== c.indexOf("@gmai.") ||
        -1 !== c.indexOf("@gamil.") ||
        -1 !== c.indexOf("@gmial.") ||
        -1 !== c.indexOf("@gail.") ||
        -1 !== c.indexOf("@gmali.") ||
        -1 !== c.indexOf("@mgail.") ||
        ".ed" === c.substr(-3) ||
        "ocm" === c.substr(-3) ||
        "cmo" === c.substr(-3) ||
        -1 !== c.indexOf("@gnail.") ||
        -1 !== c.indexOf(".gmail.") ||
        -1 !== c.indexOf("@hayoo") ||
        -1 !== c.indexOf("gmail.com.") ||
        -1 !== c.indexOf("@gmail.org") ||
        (-1 !== c.indexOf("@gmail.") && "com" !== c.substr(-3)) ||
        -1 !== c.indexOf("@youtube.com") ||
        -1 !== c.indexOf("@example.com") ||
        -1 !== c.indexOf("@example.org")
      )
        (b = "Invalid email address."), (a = !1), this.emailField.markInvalid();
      else {
        let f = !1;
        for (let g = 0; g < RegisterMenu.EmailWhitelist.length; g++)
          if (-1 !== c.indexOf(RegisterMenu.EmailWhitelist[g])) {
            f = !0;
            break;
          }
        f
          ? this.emailField.markValid()
          : ((b =
              "This email provider is not supported.\nPlease use Gmail or another major email provider."),
            (a = !1),
            this.emailField.markInvalid());
      }
    a && 4 > d.length
      ? ((b = "Username is too short."), (a = !1), this.nameField.markInvalid())
      : a && this.nameField.markValid();
    a && 8 > e.length
      ? (this.passwordField.setText(""),
        (b = "Password must be at least 8 characters long."),
        (a = !1),
        this.passwordField.markInvalid())
      : a && this.passwordField.markValid();
    a && this.passwordField.markValid();
    return { valid: a, error: b };
  }
  onSubmitButtonReleased() {
    const a = this.validateForm();
    a.valid
      ? (this.displayErrorMessage(""),
        this.emailDisabled
          ? this.submitForm("", this.nameField.getText(), this.passwordField.getText())
          : this.displayEmailVerification())
      : (this.nameField.markInvalid(), this.displayErrorMessage(a.error));
  }
  reset() {
    this.loadingContainer.parent && this.removeChild(this.loadingContainer);
    this.completedContainer.parent && this.removeChild(this.completedContainer);
    this.container.interactiveChildren = !0;
    this.submitButton.enable();
    this.container.alpha = 1;
    this.hasVerifiedEmail = !1;
    this.verifyBox.setChecked(!1);
    this.verificationBoxWarning.tint = 16776960;
    this.emailField.markNone();
    this.nameField.markNone();
    this.passwordField.markNone();
  }
  show() {}
  hide() {}
  resetRobotChallenge() {
    this.challengeTexture && PIXI.Texture.removeFromCache(this.challengeTexture);
    this.challengeTexture = PIXI.Texture.from(
      APIClient.ChallengeURL + "?cache_id=" + Math.random()
    );
    this.robotChallenge.texture = this.challengeTexture;
  }
  onCancelButtonReleased() {
    this.submitButton.enable();
    this.emit(Layer.Events.REGISTER_CANCEL);
  }
  onCompletedButtonReleased() {
    this.loadingContainer.parent && this.removeChild(this.loadingContainer);
    this.completedContainer.parent && this.removeChild(this.completedContainer);
    this.emit(Layer.Events.REGISTER_CANCEL);
  }
  onCancelEmailVerificationButtonReleased() {
    this.emailField.setText("");
    this.emailVerificationField.setText("");
    this.emailField.visible = !0;
    this.hasVerifiedEmail = !1;
    this.verifyBox.setChecked(!1);
    this.emailVerificationContainer.parent && this.removeChild(this.emailVerificationContainer);
    this.reset();
  }
  onEmailVerificationButtonReleased() {
    this.hasVerifiedEmail = !1;
    if (this.verifyBox.checked) {
      this.emailField.visible = !0;
      var a = this.emailField.getText().toLowerCase(),
        b = this.emailVerificationField.getText().toLowerCase();
      this.emailVerificationField.setText("");
      a !== b
        ? (this.emailField.setText(""),
          this.emailVerificationContainer.parent &&
            this.removeChild(this.emailVerificationContainer),
          this.reset(),
          this.displayErrorMessage("Email verification failed. Please try again."))
        : (this.emailVerificationContainer.parent &&
            this.removeChild(this.emailVerificationContainer),
          this.displayLoadingMessage(),
          this.submitForm(
            this.emailField.getText(),
            this.nameField.getText(),
            this.passwordField.getText()
          ));
    } else this.verificationBoxWarning.tint = 16711680;
  }
  submitForm(a, b, c) {
    this.emit(Layer.Events.REGISTER_SUBMIT, { email: a, name: b, password: c });
  }
  displayLoadingMessage() {
    this.container.interactiveChildren = !1;
    this.addChild(this.loadingContainer);
    this.submitButton.disable();
    this.container.alpha = 0.5;
  }
  displayEmailVerification() {
    this.emailField.visible = !1;
    this.container.interactiveChildren = !1;
    this.addChild(this.emailVerificationContainer);
    this.submitButton.disable();
    this.container.alpha = 0.5;
  }
  displayCompletedMessage(a = !0) {
    this.loadingContainer.parent && this.removeChild(this.loadingContainer);
    this.passwordField.setText("");
    this.container.interactiveChildren = !1;
    this.addChild(this.completedContainer);
    this.submitButton.disable();
    this.container.alpha = 0.5;
    a
      ? ((this.completedButton.visible = !0),
        (this.completedText.text =
          "A verification email has been sent to\n " +
          this.emailField.getText() +
          "\n(Check your spam folder)\n\nImportant: Click the verification link in\nthis email to activate your account!"))
      : ((this.completedButton.visible = !1),
        (this.completedText.text =
          "Your Ninja.io account has been created.\n\nLogging in as " + this.nameField.getText()));
  }
  displayErrorMessage(a) {
    this.submitButton.enable();
    this.errorMessage.text = a;
    this.errorMessage.parent || this.container.addChild(this.errorMessage);
  }
}
RegisterMenu.EmailWhitelist =
  "@gmail.com @icloud.com @yahoo.com @hotmail.com @mail.ru @outlook.com @comcast.net @inbox.ru @yandex.ru @wp.pl @protonmail.com @aol.com @googlemail.com @volny.cz @sdale.org @pdsb.net".split(
    " "
  );
var upresetmenu = {};
class UPResetMenu extends Feature {
  constructor() {
    super();
    this.challengeTexture = null;
    this.preferredCheck = UPResetMenu.CHECK_NAME;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504);
    this.background.endFill();
    this.background.drawRect(15, 42, 630, 2);
    this.container.addChild(this.background);
    this.ox = 40;
    this.oy = 20;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy + 34;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.onCancelButtonReleased());
    this.container.addChild(this.closeButton);
    this.accountRecoveryTitle = new PIXI.Text("Account recovery", {
      fontName: "Arial",
      fontSize: 19,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.accountRecoveryTitle.x = 0.5 * this.width - 0.5 * this.accountRecoveryTitle.width;
    this.accountRecoveryTitle.y = this.oy + 36;
    this.container.addChild(this.accountRecoveryTitle);
    this.emailTitle = new PIXI.Text("Email", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.emailTitle.x = this.ox;
    this.emailTitle.y = this.oy + 80;
    this.container.addChild(this.emailTitle);
    this.recoverTitle = new PIXI.Text("Recover", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.recoverTitle.x = this.ox;
    this.recoverTitle.y = this.oy + 145;
    this.container.addChild(this.recoverTitle);
    this.captchaTitle = new PIXI.Text("Captcha", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.captchaTitle.x = this.ox;
    this.captchaTitle.y = this.oy + 204;
    this.container.addChild(this.captchaTitle);
    this.errorMessage = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16711680,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.errorMessage.x = this.ox;
    this.errorMessage.y = this.oy + 310;
    this.errorMessage.maxWidth = 380;
    this.container.x = 0.5 * -this.width;
    this.emailField = new InputField("register_email");
    this.emailField.setDimensions(300, 35);
    this.emailField.forceLowerCase = !1;
    this.emailField.setMaxChars(64);
    this.emailField.x = this.ox;
    this.emailField.y = this.oy + 100;
    this.emailField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890@.+_-"
    );
    this.container.addChild(this.emailField);
    this.nameCheck = new Checkbox("name_check", "Username", !0);
    this.nameCheck.x = this.ox;
    this.nameCheck.y = this.oy + 168;
    this.nameCheck.setChecked(!0);
    this.container.addChild(this.nameCheck);
    this.passwordCheck = new Checkbox("password_check", "Password", !0);
    this.passwordCheck.x = this.ox + 150;
    this.passwordCheck.y = this.oy + 168;
    this.passwordCheck.setChecked(!1);
    this.passwordCheck.on(Checkbox.CHANGE, (a) => {
      a && (this.preferredCheck = UPResetMenu.CHECK_PASSWORD);
    });
    this.container.addChild(this.passwordCheck);
    this.nameCheck.on(Checkbox.CHANGE, (a) => {
      a && (this.passwordCheck.setChecked(!1), (this.preferredCheck = UPResetMenu.CHECK_NAME));
    });
    this.passwordCheck.on(Checkbox.CHANGE, (a) => {
      a && (this.nameCheck.setChecked(!1), (this.preferredCheck = UPResetMenu.CHECK_PASSWORD));
    });
    this.robotChallengeField = new InputField("register_name");
    this.robotChallengeField.setDimensions(100, 35);
    this.robotChallengeField.forceUpperCase = !0;
    this.robotChallengeField.setMaxChars(5);
    this.robotChallengeField.x = this.ox;
    this.robotChallengeField.y = this.oy + 228;
    this.robotChallengeField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-().[]"
    );
    this.container.addChild(this.robotChallengeField);
    this.robotChallengeField.on("mousedown", () => {
      this.emailField.interactive = !1;
      this.emailField.alpha = 0.3;
    });
    this.robotChallengeContainer = new PIXI.Container();
    this.robotChallengeContainer.interactive = !0;
    this.robotChallengeContainer.interactiveChildren = !1;
    this.robotChallengeContainer.buttonMode = !0;
    this.robotChallengeContainer.x = this.ox + 142;
    this.robotChallengeContainer.y = this.oy + 245;
    this.container.addChild(this.robotChallengeContainer);
    (async () => {
      this.robotChallenge = new PIXI.Sprite();
      this.robotChallenge.anchor.x = this.robotChallenge.anchor.y = 0.5;
      this.robotChallenge.scale.x = this.robotChallenge.scale.y = 2;
      this.robotChallengeContainer.addChild(this.robotChallenge);
      this.robotChallenge.interactive = !1;
    })();
    this.robotChallengeContainer.hitArea = new PIXI.Rectangle(-40, -20, 80, 40);
    this.robotChallengeContainer.on("mousedown", () => this.resetRobotChallenge());
    this.robotChallengeContainer.on(
      "mouseover",
      () => (this.robotChallenge.scale.x = this.robotChallenge.scale.y = 2.5)
    );
    this.robotChallengeContainer.on(
      "mouseout",
      () => (this.robotChallenge.scale.x = this.robotChallenge.scale.y = 2)
    );
    this.submitButton = new Button("recover");
    this.submitButton.selected = !0;
    this.submitButton.setText("Recover");
    this.submitButton.scale.x = this.submitButton.scale.y = 0.8;
    this.submitButton.addListener(Button.BUTTON_RELEASED, this.onSubmitButtonReleased.bind(this));
    this.submitButton.x = this.ox + 11;
    this.submitButton.y = this.oy + 274;
    this.submitButton.setTint(16763904);
    this.container.addChild(this.submitButton);
    this.loadingContainer = new PIXI.Container();
    this.loadingBackground = new PIXI.Graphics();
    this.loadingBackground.x = 0;
    this.loadingBackground.y = 0;
    this.loadingBackground.lineStyle(3, 11184810, 0.5, 0);
    this.loadingBackground.beginFill(0, 0.8);
    this.loadingBackground.drawRoundedRect(0, 0, 300, 80, 10);
    this.loadingBackground.endFill();
    this.loadingContainer.addChild(this.loadingBackground);
    this.loadingText = new PIXI.Text("Processing request...", {
      fontName: "Arial",
      fontSize: 20,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.loadingText.x = 0.5 * this.loadingBackground.width;
    this.loadingText.y = 0.5 * this.loadingBackground.height;
    this.loadingText.anchor.x = this.loadingText.anchor.y = 0.5;
    this.loadingContainer.addChild(this.loadingText);
    this.loadingContainer.x = 0.5 * -this.loadingBackground.width;
    this.loadingContainer.y = 0.5 * this.container.height - 0.5 * this.loadingBackground.height;
    this.completedContainer = new PIXI.Container();
    this.completedBackground = new PIXI.Graphics();
    this.completedBackground.x = 0;
    this.completedBackground.y = 0;
    this.completedBackground.lineStyle(3, 11184810, 0.5, 0);
    this.completedBackground.beginFill(0, 0.8);
    this.completedBackground.drawRoundedRect(0, 0, 400, 130, 10);
    this.completedBackground.endFill();
    this.completedContainer.addChild(this.completedBackground);
    this.completedText = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 20,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.completedText.x = 0.5 * this.completedBackground.width;
    this.completedText.y = 0.3 * this.completedBackground.height;
    this.completedText.anchor.x = this.completedText.anchor.y = 0.5;
    this.completedContainer.addChild(this.completedText);
    this.completedButton = new Button("continue");
    this.completedButton.selected = !0;
    this.completedButton.setText("Continue");
    this.completedButton.scale.x = this.completedButton.scale.y = 0.8;
    this.completedButton.addListener(
      Button.BUTTON_RELEASED,
      this.onCompletedButtonReleased.bind(this)
    );
    this.completedButton.x =
      0.5 * this.completedBackground.width - 0.5 * this.completedButton.width;
    this.completedButton.y = this.completedBackground.height - (this.completedButton.height + 16);
    this.completedContainer.addChild(this.completedButton);
    this.completedContainer.x = 0.5 * -this.completedBackground.width;
    this.completedContainer.y = 0.5 * this.container.height - 0.5 * this.completedBackground.height;
  }
  show() {
    this.resetRobotChallenge();
  }
  hide() {}
  resetRobotChallenge() {
    this.robotChallengeField.setText("");
    this.challengeTexture && PIXI.Texture.removeFromCache(this.challengeTexture);
    this.challengeTexture = PIXI.Texture.from(
      APIClient.ChallengeURL + "?cache_id=" + Math.random()
    );
    this.robotChallenge.texture = this.challengeTexture;
  }
  validateForm() {
    let a = !0,
      b = "";
    const c = this.emailField.getText(),
      d = this.robotChallengeField.getText();
    a &&
    (3 > c.length ||
      !c.match(
        /^[\w-]+(\.[\w-]+)*@([a-z0-9-]+(\.[a-z0-9-]+)*?\.[a-z]{2,6}|(\d{1,3}\.){3}\d{1,3})(:\d{4})?$/g
      ))
      ? ((b = "Invalid email address."), (a = !1), this.emailField.markInvalid())
      : this.emailField.markValid();
    a && 5 > d.length
      ? (this.robotChallengeField.markInvalid(), (b = "Robot challenge incomplete."), (a = !1))
      : a && this.robotChallengeField.markNone();
    return { valid: a, error: b };
  }
  onSubmitButtonReleased() {
    const a = this.validateForm();
    a.valid
      ? (this.displayErrorMessage(""),
        this.displayLoadingMessage(),
        this.emit(Layer.Events.RECOVER_SUBMIT, {
          email: this.emailField.getText(),
          type: this.preferredCheck,
          challenge: this.robotChallengeField.getText(),
        }))
      : this.displayErrorMessage(a.error);
  }
  displayLoadingMessage() {
    this.container.interactiveChildren = !1;
    this.addChild(this.loadingContainer);
    this.submitButton.disable();
    this.container.alpha = 0.5;
  }
  displayCompletedMessage() {
    this.loadingContainer.parent && this.removeChild(this.loadingContainer);
    this.container.interactiveChildren = !1;
    this.addChild(this.completedContainer);
    this.submitButton.disable();
    this.container.alpha = 0.5;
    this.completedText.text = "A recovery email has been sent to\n " + this.emailField.getText();
  }
  onCompletedButtonReleased() {
    this.loadingContainer.parent && this.removeChild(this.loadingContainer);
    this.completedContainer.parent && this.removeChild(this.completedContainer);
    this.container.interactiveChildren = !0;
    this.submitButton.enable();
    this.container.alpha = 1;
    this.emailField.markNone();
    this.emailField.setText("");
    this.robotChallengeField.setText("");
    this.emit(Layer.Events.RECOVER_CANCEL);
  }
  onCancelButtonReleased() {
    this.submitButton.enable();
    this.emit(Layer.Events.RECOVER_CANCEL);
  }
  displayErrorMessage(a) {
    this.submitButton.enable();
    this.errorMessage.text = a;
    this.errorMessage.parent || this.container.addChild(this.errorMessage);
  }
  reset() {
    this.loadingContainer.parent && this.removeChild(this.loadingContainer);
    this.completedContainer.parent && this.removeChild(this.completedContainer);
    this.resetRobotChallenge();
    this.container.interactiveChildren = !0;
    this.submitButton.enable();
    this.container.alpha = 1;
    this.emailField.markNone();
  }
}
UPResetMenu.CHECK_NAME = "name";
UPResetMenu.CHECK_PASSWORD = "password";
var visualizer = {};
class Visualizer extends PIXI.Container {
  constructor(a, b, c = !0, d = !0, e = !0) {
    super();
    this.renderBackground = c;
    this.interactive = d;
    this.displayAura = e;
    this.customExtra = this.customFace = this.customAura = !1;
    this.w = a;
    this.h = b;
    this.s = 0.004 * this.w;
    this.numParticles = 64;
    this.customization = {};
    this.customAuraFx = {};
    this.customFaceFx = {};
    this.customExtraFx = {};
    this.initialize();
    this.offsetY = this.offsetX = this.time = 0;
    this.head = new PIXI.Sprite();
    this.head.x = this.head.ox = -2;
    this.head.y = this.head.oy = 0.179 * -this.h;
    this.head.scale.x = this.head.scale.y = this.s;
    this.head.anchor.x = 0.5;
    this.head.anchor.y = 0.75;
    this.head.rotation = this.head.or = -0.15;
    this.face = new PIXI.Sprite();
    this.face.rotation = this.face.or = -0;
    this.torsoUpper = new PIXI.Sprite();
    this.torsoUpper.scale.x = this.torsoUpper.scale.y = 1.2 * this.s;
    this.torsoUpper.x = this.torsoUpper.ox = 0;
    this.torsoUpper.y = this.torsoUpper.oy = 0.105 * -this.h;
    this.torsoUpper.anchor.x = 0.5;
    this.torsoUpper.anchor.y = 0.4;
    this.torsoUpper.rotation = this.torsoUpper.or = -0.1;
    this.torsoLower = new PIXI.Sprite();
    this.torsoLower.x = this.torsoLower.ox = 2;
    this.torsoLower.y = this.torsoLower.oy = 0.03 * -this.h;
    this.torsoLower.scale.x = this.torsoLower.scale.y = 1 * this.s;
    this.torsoLower.anchor.x = 0.5;
    this.torsoLower.anchor.y = 0.4;
    this.torsoLower.rotation = this.torsoLower.or = -0.1;
    this.armLeftUpper = new PIXI.Sprite();
    this.armLeftUpper.x = this.armLeftUpper.ox = -12;
    this.armLeftUpper.y = this.armLeftUpper.oy = 0.14 * -this.h;
    this.armLeftUpper.scale.x = this.armLeftUpper.scale.y = 1 * this.s;
    this.armLeftUpper.anchor.x = 0.6;
    this.armLeftUpper.anchor.y = 0.23;
    this.armLeftUpper.rotation = this.armLeftUpper.or = -0.05;
    this.armLeftLower = new PIXI.Sprite();
    this.armLeftLower.x = this.armLeftLower.ox = -17;
    this.armLeftLower.y = this.armLeftLower.oy = 0.02 * this.h;
    this.armLeftLower.scale.x = this.armLeftLower.scale.y = 0.95 * this.s;
    this.armLeftLower.anchor.x = 0.6;
    this.armLeftLower.anchor.y = 0.23;
    this.armLeftLower.rotation = this.armLeftLower.or = 0.55 * Math.PI;
    this.armRightUpper = new PIXI.Sprite();
    this.armRightUpper.x = this.armRightUpper.ox = 15;
    this.armRightUpper.y = this.armRightUpper.oy = 0.17 * -this.h;
    this.armRightUpper.scale.x = this.armRightUpper.scale.y = 1 * this.s;
    this.armRightUpper.anchor.x = 0.55;
    this.armRightUpper.anchor.y = 0.23;
    this.armRightUpper.rotation = this.armRightUpper.or = -0.3;
    this.armRightLower = new PIXI.Sprite();
    this.armRightLower.x = this.armRightLower.ox = 22;
    this.armRightLower.y = this.armRightLower.oy = 0.02 * -this.h;
    this.armRightLower.scale.x = 0.95 * -this.s;
    this.armRightLower.scale.y = 0.95 * this.s;
    this.armRightLower.anchor.x = 0.66;
    this.armRightLower.anchor.y = 0.23;
    this.armRightLower.rotation = this.armRightLower.or = 0.26 * Math.PI;
    this.legLeftUpper = new PIXI.Sprite();
    this.legLeftUpper.x = this.legLeftUpper.ox = -1;
    this.legLeftUpper.y = this.legLeftUpper.oy = 0.085 * this.h;
    this.legLeftUpper.scale.x = this.legLeftUpper.scale.y = 1 * this.s;
    this.legLeftUpper.anchor.x = 0.55;
    this.legLeftUpper.anchor.y = 0.31;
    this.legLeftUpper.rotation = this.legLeftUpper.or = 0.23 * Math.PI;
    this.legLeftLower = new PIXI.Sprite();
    this.legLeftLower.x = this.legLeftLower.ox = 10;
    this.legLeftLower.y = this.legLeftLower.oy = 0.25 * this.h;
    this.legLeftLower.scale.x = this.legLeftLower.scale.y = 1 * this.s;
    this.legLeftLower.anchor.x = 0.58;
    this.legLeftLower.anchor.y = 0.36;
    this.legLeftLower.rotation = this.legLeftLower.or = 0.3 * -Math.PI;
    this.legRightUpper = new PIXI.Sprite();
    this.legRightUpper.x = this.legRightUpper.ox = 9;
    this.legRightUpper.y = this.legRightUpper.oy = 0.07 * this.h;
    this.legRightUpper.scale.x = this.legRightUpper.scale.y = 1 * this.s;
    this.legRightUpper.anchor.x = 0.55;
    this.legRightUpper.anchor.y = 0.3;
    this.legRightUpper.rotation = this.legRightUpper.or = 0.01 * Math.PI;
    this.legRightLower = new PIXI.Sprite();
    this.legRightLower.x = this.legRightLower.ox = -19;
    this.legRightLower.y = this.legRightLower.oy = 0.21 * this.h;
    this.legRightLower.scale.x = this.legRightLower.scale.y = 1 * this.s;
    this.legRightLower.anchor.x = 0.58;
    this.legRightLower.anchor.y = 0.36;
    this.legRightLower.rotation = this.legRightLower.or = 0.22 * -Math.PI;
    this.bandana = new PIXI.Sprite(App.CombinedTextures.bandana_team_alpha);
    this.bandana.x = this.bandana.ox = this.head.x + 13;
    this.bandana.y = this.bandana.oy = this.head.y - 16;
    this.bandana.rotation = this.bandana.or = 0.32 * Math.PI;
    this.bandana.scale.x = 0.9 * this.s;
    this.bandana.scale.y = 0.5 * this.s;
    this.bandana.anchor.x = 0;
    this.bandana.anchor.y = 0.5;
    this.bandana.tint = 12255232;
    this.extra = new PIXI.Container();
    this.ninja = new PIXI.Container();
    this.ninja.x = 0.5 * this.w;
    this.ninja.y = 0.5 * this.h;
    this.marker = new PIXI.Graphics();
    this.marker.alpha = 0;
    this.marker.lineStyle(4, 0, 0.5, 0);
    this.marker.drawRoundedRect(0, 0, this.w, this.h, 8);
    this.marker.endFill();
    this.addChild(this.marker);
    this.aura = new PIXI.Sprite();
    this.aura.x = 0;
    this.aura.y = 0;
    this.aura.scale.x = this.aura.scale.y = 1.4;
    this.aura.anchor.x = this.aura.anchor.y = 0.5;
    this.aura.visible = this.displayAura;
    this.aura.rotation = Math.PI;
    this.on("mouseover", () => {
      this.marker.alpha = 1;
      this.aura.visible = !this.customAura;
      this.drawBackground(!1);
    });
    this.on("mouseout", () => {
      this.marker.alpha = 0;
      this.aura.visible = !1;
      this.drawBackground(!0);
    });
    this.ninja.addChild(this.aura);
    this.ninja.addChild(this.bandana);
    this.ninja.addChild(this.legRightLower);
    this.ninja.addChild(this.legLeftUpper);
    this.ninja.addChild(this.legLeftLower);
    this.ninja.addChild(this.legRightUpper);
    this.ninja.addChild(this.armLeftUpper);
    this.ninja.addChild(this.armLeftLower);
    this.ninja.addChild(this.torsoLower);
    this.ninja.addChild(this.torsoUpper);
    this.ninja.addChild(this.armRightLower);
    this.ninja.addChild(this.armRightUpper);
    this.ninja.addChild(this.head);
    this.ninja.addChild(this.extra);
    this.head.addChild(this.face);
    this.bodyparts = [
      this.head,
      this.armLeftUpper,
      this.armLeftLower,
      this.torsoLower,
      this.torsoUpper,
      this.armRightUpper,
      this.armRightLower,
      this.legLeftUpper,
      this.legLeftLower,
      this.legRightUpper,
      this.legRightLower,
      this.bandana,
    ];
    this.addChild(this.ninja);
    this.topParticles = new PIXI.ParticleContainer(1024, { position: !0, rotation: !0, tint: !0 });
    this.addChild(this.topParticles);
  }
  generateCharacter() {
    this.extra.removeChildren();
    this.foregroundParticles.removeChildren();
    this.topParticles.removeChildren();
    this.customAuraFx = {};
    const a = App.CombinedTextures;
    var b = this.customization;
    this.aura.tint = void 0 === b.orb ? 16777215 : b.orb.data.energy;
    this.face.rotation = 0;
    this.face.vr = 0;
    let c = "head_alpha";
    if (b.hair) {
      var d = !1;
      b.face && b.face.cdata && !1 === b.face.cdata.hair && (d = !0);
      d ? (c += "_slick") : 0 < b.hair.texture.length && (c += "_" + b.hair.texture);
    }
    var e = "torsoupper";
    b.torso && 0 < b.torso.texture.length && (e += "_" + b.torso.texture);
    d = "energy_shell";
    this.customAura = !1;
    this.aura.visible = this.displayAura;
    b.orb &&
      (b.orb.cdata && b.orb.cdata.custom
        ? ((this.customAura = b.orb.cdata.custom),
          (this.aura.visible = !1),
          this.initializeCustomEnergyFx())
        : 0 < b.orb.texture.length && (d += "_" + b.orb.texture));
    var f = "torsolower";
    this.torsoLower.x = this.torsoLower.ox = 2;
    this.torsoLower.y = this.torsoLower.oy = 0.03 * -this.h;
    this.torsoLower.anchor.x = 0.5;
    this.torsoLower.anchor.y = 0.4;
    if (b.belt && 0 < b.belt.texture.length) {
      f += "_" + b.belt.texture;
      var g = b.belt.cdata;
      void 0 !== g &&
        (void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.torsoLower.anchor.x = g.ax), (this.torsoLower.anchor.y = g.ay)),
        void 0 !== g.ox &&
          void 0 !== g.ox &&
          ((this.torsoLower.x = g.ox), (this.torsoLower.y = g.oy)),
        void 0 !== g.s && (this.torsoLower.scale.x = this.torsoLower.scale.y = this.s * g.s));
    }
    var h = "armleftlower";
    this.armLeftLower.x = -17;
    this.armLeftLower.y = 0.02 * this.h;
    this.armLeftLower.anchor.x = 0.6;
    this.armLeftLower.anchor.y = 0.23;
    b.armleftlower &&
      0 < b.armleftlower.texture.length &&
      ((h += "_" + b.armleftlower.texture),
      (g = b.armleftlower.cdata),
      void 0 !== g &&
        (void 0 !== g.ox &&
          void 0 !== g.oy &&
          ((this.armLeftLower.x = this.armLeftLower.ox = g.ox),
          (this.armLeftLower.y = this.armLeftLower.oy = g.oy)),
        void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.armLeftLower.anchor.x = g.ax), (this.armLeftLower.anchor.y = g.ay))));
    var m = "armleftupper";
    this.armLeftUpper.x = this.armLeftUpper.ox = -13;
    this.armLeftUpper.y = this.armLeftUpper.oy = 0.14 * -this.h;
    this.armLeftUpper.anchor.x = 0.55;
    this.armLeftUpper.anchor.y = 0.23;
    b.armleftupper &&
      0 < b.armleftupper.texture.length &&
      ((m += "_" + b.armleftupper.texture),
      (g = b.armleftupper.cdata),
      void 0 !== g &&
        (void 0 !== g.ox &&
          void 0 !== g.oy &&
          ((this.armLeftUpper.x = this.armLeftUpper.ox = g.ox),
          (this.armLeftUpper.y = this.armLeftUpper.oy = g.oy)),
        void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.armLeftUpper.anchor.x = g.ax), (this.armLeftUpper.anchor.y = g.ay))));
    var n = "armrightupper";
    this.armRightUpper.x = this.armRightUpper.ox = 15;
    this.armRightUpper.y = this.armRightUpper.oy = 0.17 * -this.h;
    this.armRightUpper.anchor.x = 0.55;
    this.armRightUpper.anchor.y = 0.23;
    b.armrightupper &&
      0 < b.armrightupper.texture.length &&
      ((n += "_" + b.armrightupper.texture),
      (g = b.armrightupper.cdata),
      void 0 !== g &&
        (void 0 !== g.ox &&
          void 0 !== g.oy &&
          ((this.armRightUpper.x = this.armRightUpper.ox = g.ox),
          (this.armRightUpper.y = this.armRightUpper.oy = g.oy)),
        void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.armRightUpper.anchor.x = g.ax), (this.armRightUpper.anchor.y = g.ay))));
    var l = "armrightlower";
    this.armRightLower.x = 22;
    this.armRightLower.y = 0.02 * -this.h;
    this.armRightLower.anchor.x = 0.66;
    this.armRightLower.anchor.y = 0.23;
    b.armrightlower &&
      0 < b.armrightlower.texture.length &&
      ((l += "_" + b.armrightlower.texture),
      (g = b.armrightlower.cdata),
      void 0 !== g &&
        (void 0 !== g.ox &&
          void 0 !== g.oy &&
          ((this.armRightLower.x = this.armRightLower.ox = g.ox),
          (this.armRightLower.y = this.armRightLower.oy = g.oy)),
        void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.armRightLower.anchor.x = g.ax), (this.armRightLower.anchor.y = g.ay))));
    var k = "legleftlower";
    this.legLeftLower.x = this.legLeftLower.ox = 10;
    this.legLeftLower.y = this.legLeftLower.oy = 0.25 * this.h;
    this.legLeftLower.anchor.x = 0.58;
    this.legLeftLower.anchor.y = 0.36;
    b.legleftlower &&
      (0 < b.legleftlower.texture.length && (k += "_" + b.legleftlower.texture),
      (g = b.legleftlower.cdata),
      void 0 !== g &&
        (void 0 !== g.ox &&
          void 0 !== g.oy &&
          ((this.legLeftLower.x = this.legLeftLower.ox = g.ox),
          (this.legLeftLower.y = this.legLeftLower.oy = g.oy)),
        void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.legLeftLower.anchor.x = g.ax), (this.legLeftLower.anchor.y = g.ay))));
    g = "legrightlower";
    this.legRightLower.x = this.legRightLower.ox = -19;
    this.legRightLower.y = this.legRightLower.oy = 0.21 * this.h;
    this.legRightLower.anchor.x = 0.58;
    this.legRightLower.anchor.y = 0.36;
    if (b.legrightlower) {
      0 < b.legrightlower.texture.length && (g += "_" + b.legrightlower.texture);
      var p = b.legrightlower.cdata;
      void 0 !== p &&
        (void 0 !== p.ox &&
          void 0 !== p.oy &&
          ((this.legRightLower.x = this.legRightLower.ox = p.ox),
          (this.legRightLower.y = this.legRightLower.oy = p.oy)),
        void 0 !== p.ax &&
          void 0 !== p.ay &&
          ((this.legRightLower.anchor.x = p.ax), (this.legRightLower.anchor.y = p.ay)));
    }
    let r = "legleftupper";
    this.legLeftUpper.x = this.legLeftUpper.ox = -1;
    this.legLeftUpper.y = this.legLeftUpper.oy = 0.085 * this.h;
    this.legLeftUpper.anchor.x = 0.55;
    this.legLeftUpper.anchor.y = 0.31;
    b.legleftupper &&
      (0 < b.legleftupper.texture.length && (r += "_" + b.legleftupper.texture),
      (p = b.legleftupper.cdata),
      void 0 !== p &&
        (void 0 !== p.ox &&
          void 0 !== p.oy &&
          ((this.legLeftUpper.x = this.legLeftUpper.ox = p.ox),
          (this.legLeftUpper.y = this.legLeftUpper.oy = p.oy)),
        void 0 !== p.ax &&
          void 0 !== p.ay &&
          ((this.legLeftUpper.anchor.x = p.ax), (this.legLeftUpper.anchor.y = p.ay))));
    p = "legrightupper";
    this.legRightUpper.x = this.legRightUpper.ox = 9;
    this.legRightUpper.y = this.legRightUpper.oy = 0.07 * this.h;
    this.legRightUpper.anchor.x = 0.55;
    this.legRightUpper.anchor.y = 0.3;
    if (b.legrightupper) {
      0 < b.legrightupper.texture.length && (p += "_" + b.legrightupper.texture);
      var q = b.legrightupper.cdata;
      void 0 !== q &&
        (void 0 !== q.ox &&
          void 0 !== q.oy &&
          ((this.legRightUpper.x = this.legRightUpper.ox = q.ox),
          (this.legRightUpper.y = this.legRightUpper.oy = q.oy)),
        void 0 !== q.ax &&
          void 0 !== q.ay &&
          ((this.legRightUpper.anchor.x = q.ax), (this.legRightUpper.anchor.y = q.ay)));
    }
    this.customFace = !1;
    if (b.face)
      if (b.face.cdata && b.face.cdata.custom)
        (this.customFace = b.face.cdata.custom),
          this.initializeCustomFaceFx(),
          (this.face.visible = !1);
      else if (0 < b.face.texture.length) {
        if (
          ((this.face.texture = a["face_" + b.face.texture]),
          (this.face.visible = !0),
          (q = b.face.cdata))
        )
          void 0 !== q.ax && void 0 !== q.ay
            ? ((this.face.anchor.x = q.ax), (this.face.anchor.y = q.ay))
            : ((this.face.anchor.x = 0), (this.face.anchor.y = 0)),
            void 0 !== q.ox && void 0 !== q.ox
              ? ((this.face.x = q.ox), (this.face.y = q.oy))
              : ((this.face.x = 0), (this.face.y = 0)),
            q.vr && (this.face.vr = 0),
            void 0 !== q.s && (this.face.scale.x = this.face.scale.y = 0.78 * q.s);
      } else this.face.visible = !1;
    else this.face.visible = !1;
    this.customExtra = !1;
    b.extra &&
      b.extra.cdata &&
      b.extra.cdata.custom &&
      ((this.customExtra = b.extra.cdata.custom), this.initializeCustomExtraFx());
    b = a[e];
    f = a[f];
    e = a[m];
    h = a[h];
    n = a[n];
    l = a[l];
    m = a[r];
    k = a[k];
    p = a[p];
    g = a[g];
    d = a[d];
    this.head.texture = a[c];
    this.torsoUpper.texture = b;
    this.torsoLower.texture = f;
    this.armLeftUpper.texture = e;
    this.armLeftLower.texture = h;
    this.armRightUpper.texture = n;
    this.armRightLower.texture = l;
    this.legLeftUpper.texture = m;
    this.legLeftLower.texture = k;
    this.legRightUpper.texture = p;
    this.legRightLower.texture = g;
    this.aura.texture = d;
  }
  initialize() {
    if (this.renderBackground) {
      this.maskGraphic = new PIXI.Graphics();
      this.maskGraphic.beginFill(16777215, 1);
      this.maskGraphic.drawRoundedRect(0, 0, this.w, this.h, 8);
      this.maskGraphic.endFill();
      this.addChild(this.maskGraphic);
      this.gradientTexture = this.generateGradientTexture();
      this.background = new PIXI.Graphics();
      this.drawBackground();
      this.addChild(this.background);
      this.backgroundParticles = new PIXI.Container();
      this.backgroundParticles.mask = this.maskGraphic;
      for (let a = 0; a < this.numParticles; a++) {
        const b = new PIXI.Sprite(App.CombinedTextures.streak);
        b.delta = 20 * Math.random();
        b.theta = Math.random() * Math.PI * 2;
        b.x = 0.5 * this.w + b.delta * Math.cos(b.theta) * Math.random() * this.w * 0.5;
        b.y = 0.5 * this.h + b.delta * Math.sin(b.theta) * Math.random() * this.h * 0.5;
        b.scale.x = 0.1;
        b.scale.y = 0.2;
        b.alpha = 0;
        b.anchor.x = 0;
        b.anchor.y = 0.5;
        b.rotation = Math.atan2(b.theta + Math.PI);
        b.tint = 0;
        this.backgroundParticles.addChild(b);
      }
      this.addChild(this.backgroundParticles);
    }
    this.foregroundParticles = new PIXI.ParticleContainer(1024, {
      position: !0,
      rotation: !0,
      tint: !0,
    });
    this.addChild(this.foregroundParticles);
  }
  drawBackground(a = !0) {
    !1 !== this.gradientTexture &&
      (this.background.clear(),
      this.background.lineStyle(3, 0, 0.2, 0),
      this.background.beginTextureFill({ texture: this.gradientTexture }),
      this.background.drawRoundedRect(0, 0, this.w, this.h, 8),
      this.background.endFill(),
      a &&
        (this.background.lineStyle(0, 0, 0),
        this.background.beginFill(16777215, 0.1),
        this.background.drawCircle(0.5 * this.w, 0.5 * this.h, 0.4 * this.w),
        this.background.endFill()));
  }
  applyCustomization(a) {
    this.customization = {};
    a && (this.customization = a);
    this.generateCharacter();
    this.update();
  }
  generateGradientTexture() {
    const a = document.createElement("canvas");
    a.width = this.w;
    a.height = this.h;
    const b = a.getContext("2d");
    if (null === b) return !1;
    let c = b.createLinearGradient(0, 0, 0, this.h);
    c.addColorStop(0, "#729fcf");
    c.addColorStop(1, "#204a87");
    b.fillStyle = c;
    b.fillRect(0, 0, this.w, this.h);
    return PIXI.Texture.from(a);
  }
  hide() {
    this.ninja.visible = !1;
  }
  show() {
    this.ninja.visible = !0;
  }
  update() {
    var a = this.customization.face;
    a &&
      a.cdata &&
      ((a = a.cdata),
      a.fr && (this.face.rotation = -this.head.rotation),
      a.vr && ((this.face.vr += a.vr), (this.face.rotation += this.face.vr)));
    this.offsetX = 2 * Math.sin(0.01 * this.time);
    this.offsetY = 6 * Math.sin(0.04 * this.time);
    this.updateCustom();
    this.aura.alpha = 1;
    this.aura.rotation = 2 * Math.PI * Math.random();
    for (a = 0; a < this.bodyparts.length; a++) {
      var b = this.bodyparts[a];
      b.x = b.ox + this.offsetX;
      b.y = b.oy - this.offsetY;
      b.rotation =
        b.or +
        0.04 *
          Math.cos(0.04 * this.time + 0.1 * a) *
          (2 === a || 6 === a || 7 === a || 9 === a ? -1 : 1);
    }
    this.aura.x = this.offsetX;
    this.aura.y = -this.offsetY;
    if (this.renderBackground)
      for (a = this.backgroundParticles.children, b = 0; b < this.numParticles; b++) {
        const c = a[b];
        c.delta += 5;
        c.delta *= 0.5;
        c.theta += -0.08 + 0.16 * Math.random();
        c.x += c.delta * Math.cos(c.theta);
        c.y += c.delta * Math.sin(c.theta);
        c.scale.x = 0.01 + 0.05 * c.delta;
        c.rotation = c.theta + Math.PI;
        1 > c.alpha && (c.alpha += 0.02 * Math.random());
        if (c.x > this.w + 8 || -8 > c.x || c.y > this.h + 8 || -8 > c.y)
          (c.x = 0.5 * this.w), (c.y = 0.5 * this.h), (c.alpha = -0.05);
      }
    this.time += 1;
  }
  initializeCustomEnergyFx() {
    switch (this.customAura) {
      case EnergyJetFeet.ID:
        this.customAuraFx.particles = [];
        break;
      case EnergyJetFeet2.ID:
        this.customAuraFx.counter = 0;
        this.customAuraFx.particles1 = [];
        this.customAuraFx.particles2 = [];
        this.customAuraFx.update = () => {
          this.customAuraFx.counter++;
        };
        break;
      case EnergyVacuum.ID:
        this.customAuraFx.rotation = 0;
        this.customAuraFx.index = 0;
        this.customAuraFx.particles = [];
        this.customAuraFx.update = () => {
          this.customAuraFx.rotation -= 0.03;
          this.customAuraFx.index =
            8 === this.customAuraFx.index + 1 ? 0 : this.customAuraFx.index + 1;
        };
        break;
      case EnergyDragon.ID:
        (this.customAuraFx.rotation = 0),
          (this.customAuraFx.particles = []),
          (this.customAuraFx.update = () => {
            this.customAuraFx.rotation -= 0.1;
          });
    }
  }
  initializeCustomFaceFx() {
    this.customFaceFx = {};
    this.customFaceFx.update = () => {};
    switch (this.customFace) {
      case FaceRedFireEyes.ID:
        this.customFaceFx.tint = 16711680;
        this.customFaceFx.particles = [];
        break;
      case FaceFireEyes.ID:
        this.customFaceFx.tint = 16777215;
        this.customFaceFx.particles = [];
        break;
      case FacePinkFireEyes.ID:
        this.customFaceFx.tint = 16738740;
        this.customFaceFx.particles = [];
        break;
      case FaceGreenFireEyes.ID:
        this.customFaceFx.tint = 65280;
        this.customFaceFx.particles = [];
        break;
      case FaceBlueFireEyes.ID:
        this.customFaceFx.tint = 255;
        this.customFaceFx.particles = [];
        break;
      case FaceYellowFireEyes.ID:
        this.customFaceFx.tint = 16776960;
        this.customFaceFx.particles = [];
        break;
      case FaceOrangeFireEyes.ID:
        (this.customFaceFx.tint = 16753920), (this.customFaceFx.particles = []);
    }
  }
  initializeCustomExtraFx() {
    this.customExtraFx = {};
    switch (this.customExtra) {
      case RedCape.ID:
      case GreenCape.ID:
      case BlackCape.ID:
      case YellowCape.ID:
      case BlueCape.ID:
      case PinkCape.ID:
      case OrangeCape.ID:
      case CamoCape.ID:
      case CamoCapeJungle.ID:
      case CamoCapeWinter.ID:
      case CamoCapeDesert.ID:
        let b = [];
        for (var a = 0; 6 > a; a++) b.push(new PIXI.Point(0, 20 * a));
        a = new Player();
        a.torsoupper.p.vx = -1.5;
        let c = new Extra.Map[this.customExtra](App.CombinedTextures[this.customExtra], a);
        c.scale.x = c.scale.y = c.targetScale = 0.9;
        this.customExtraFx.player = a;
        this.customExtraFx.counter = 0;
        this.customExtraFx.cape = c;
        this.customExtraFx.particles = [];
        this.customExtraFx.points = b;
        this.customExtraFx.update = () => {};
        this.extra.addChild(c);
        this.extra.scale.x = -1;
    }
  }
  updateCustom() {
    switch (this.customFace) {
      case FaceFireEyes.ID:
      case FaceRedFireEyes.ID:
      case FacePinkFireEyes.ID:
      case FaceGreenFireEyes.ID:
      case FaceBlueFireEyes.ID:
      case FaceYellowFireEyes.ID:
      case FaceOrangeFireEyes.ID:
        this.updateFireEyes();
    }
    switch (this.customAura) {
      case EnergyJetFeet.ID:
        this.updateJetFeet();
        break;
      case EnergyJetFeet2.ID:
        this.updateJetFeet2();
        break;
      case EnergyVacuum.ID:
        this.updateVacuum();
        break;
      case EnergyDragon.ID:
        this.updateDragon();
    }
    switch (this.customExtra) {
      case RedCape.ID:
      case GreenCape.ID:
      case BlackCape.ID:
      case YellowCape.ID:
      case BlueCape.ID:
      case PinkCape.ID:
      case OrangeCape.ID:
      case CamoCape.ID:
      case CamoCapeJungle.ID:
      case CamoCapeWinter.ID:
      case CamoCapeDesert.ID:
        this.updateCape();
    }
  }
  updateJetFeet() {
    var a = new PIXI.Sprite(App.CombinedTextures[ParticleEffects.EnergyJetFeet.tex]);
    let b = 0.5 > Math.random() ? this.legLeftLower : this.legRightLower;
    a.tint = this.aura.tint;
    a.anchor.x = a.anchor.y = 0.5;
    a.x = this.ninja.x + 35 + b.x + 10 * Math.cos(b.rotation - 0.5 * Math.PI);
    a.y = this.ninja.y + 35 + b.y + 10 * Math.sin(b.rotation - 0.5 * Math.PI);
    a.scale.x = a.scale.y = 1.5;
    a.rotation = Math.random() * Math.PI * 2;
    a.vx = 1 * Math.random();
    a.vy = 1 * Math.random();
    a.ttl = ParticleEffects.EnergyJetFeet.ttl;
    this.foregroundParticles.addChild(a);
    this.customAuraFx.particles.push(a);
    for (let c = 0, d = this.customAuraFx.particles.length; c < d; c++)
      (a = this.customAuraFx.particles[c]),
        (a.x += a.vx),
        (a.y += a.vy),
        (a.scale.x -= 0.03),
        (a.scale.y -= 0.03),
        0 === --a.ttl &&
          (this.foregroundParticles.removeChild(a),
          fastSplice(this.customAuraFx.particles, c),
          d--,
          c--);
  }
  updateJetFeet2() {
    let a, b;
    this.customAuraFx.update();
    if (0 === this.customAuraFx.counter % 2) {
      var c =
        this.ninja.x +
        35 +
        this.legLeftLower.x +
        25 * Math.cos(this.legLeftLower.rotation - 0.5 * Math.PI) +
        8;
      a =
        this.ninja.y +
        35 +
        this.legLeftLower.y +
        25 * Math.sin(this.legLeftLower.rotation - 0.5 * Math.PI) -
        3;
      b = this.legLeftLower.rotation;
    } else
      (c =
        this.ninja.x +
        35 +
        this.legRightLower.x +
        25 * Math.cos(this.legRightLower.rotation - 0.5 * Math.PI) -
        4),
        (a =
          this.ninja.y +
          35 +
          this.legRightLower.y +
          25 * Math.sin(this.legRightLower.rotation - 0.5 * Math.PI) +
          8),
        (b = this.legRightLower.rotation);
    let d = new PIXI.Sprite(App.CombinedTextures[ParticleEffects.EnergyJetFeet2.tex]);
    d.tint = this.aura.tint;
    d.anchor.x = d.anchor.y = 0.5;
    d.scale.x = d.scale.y = 2.5;
    d.rotation = b;
    d.vx = -8 * Math.cos(b - 0.5 * Math.PI);
    d.vy = -12 * Math.sin(b - 0.5 * Math.PI);
    d.x = c - d.vx;
    d.y = a - d.vy;
    d.alpha = 1.2;
    d.ttl = ParticleEffects.EnergyJetFeet2.ttl;
    this.foregroundParticles.addChild(d);
    this.customAuraFx.particles1.push(d);
    d = new PIXI.Sprite(App.CombinedTextures[ParticleEffects.EnergyJetGlow.tex]);
    d.anchor.x = d.anchor.y = 0.5;
    d.x = c;
    d.y = a;
    d.scale.x = d.scale.y = 1;
    d.rotation = Math.random() * Math.PI * 2;
    d.vx = 2 + (-1 + 2 * Math.random());
    d.vy = 3 + (-1.5 + 3 * Math.random());
    d.ttl = ParticleEffects.EnergyJetGlow.ttl;
    this.foregroundParticles.addChild(d);
    this.customAuraFx.particles2.push(d);
    for (let e = 0, f = this.customAuraFx.particles2.length; e < f; e++)
      (c = this.customAuraFx.particles2[e]),
        (c.x += c.vx),
        (c.y += c.vy),
        (c.scale.x -= 0.1),
        (c.scale.y -= 0.1),
        (c.alpha -= 0.05),
        0 === --c.ttl &&
          (this.foregroundParticles.removeChild(c),
          fastSplice(this.customAuraFx.particles2, e),
          f--,
          e--);
    for (let e = 0, f = this.customAuraFx.particles1.length; e < f; e++)
      (c = this.customAuraFx.particles1[e]),
        (c.x += c.vx),
        (c.y += c.vy),
        (c.scale.x -= 0.4),
        (c.scale.y -= 0.4),
        (c.alpha -= 0.2),
        0 === --c.ttl &&
          (this.foregroundParticles.removeChild(c),
          fastSplice(this.customAuraFx.particles1, e),
          f--,
          e--);
  }
  updateVacuum() {
    var a = App.CombinedTextures[ParticleEffects.EnergyVacuum.tex];
    this.customAuraFx.update();
    a = new PIXI.Sprite(a);
    a.tint = this.aura.tint;
    a.anchor.x = a.anchor.y = 0.5;
    a.alpha = 0.01;
    let b = (this.customAuraFx.index * Math.PI) / 4 + this.customAuraFx.rotation;
    a.x = this.ninja.x + 90 * Math.cos(b);
    a.y = this.ninja.y + 90 * Math.sin(b);
    a.scale.x = a.scale.y = 1.5;
    a.rotation = Math.random() * Math.PI * 2;
    a.vx = 0.02 * (0.5 * this.w - a.x);
    a.vy = 0.02 * (0.5 * this.h - a.y);
    a.ttl = ParticleEffects.EnergyVacuum.ttl;
    this.foregroundParticles.addChild(a);
    this.customAuraFx.particles.push(a);
    for (let c = 0, d = this.customAuraFx.particles.length; c < d; c++)
      (a = this.customAuraFx.particles[c]),
        (a.x += a.vx),
        (a.y += a.vy),
        (a.scale.x -= 0.05),
        (a.scale.y -= 0.05),
        (a.alpha += 0.033),
        0 === --a.ttl &&
          (this.foregroundParticles.removeChild(a),
          this.customAuraFx.particles.splice(c, 1),
          d--,
          c--);
  }
  updateDragon() {
    var a = App.CombinedTextures[ParticleEffects.EnergyDragonball.tex];
    this.customAuraFx.update();
    for (let b = 0; 3 > b; b++) {
      let c = new PIXI.Sprite(a);
      c.tint = this.aura.tint;
      c.anchor.x = c.anchor.y = 0.5;
      let d = this.customAuraFx.rotation + (b * Math.PI) / 1.5;
      c.x = this.ninja.x + 80 * Math.cos(d);
      c.y = this.ninja.y + 80 * Math.sin(d);
      c.scale.x = c.scale.y = 1.25;
      c.rotation = Math.random() * Math.PI * 2;
      c.ttl = 10;
      this.foregroundParticles.addChild(c);
      this.customAuraFx.particles.push(c);
    }
    for (let b = 0, c = this.customAuraFx.particles.length; b < c; b++)
      (a = this.customAuraFx.particles[b]),
        (a.scale.x -= 0.1),
        (a.scale.y -= 0.1),
        (a.alpha -= 0.1),
        0 === --a.ttl &&
          (this.foregroundParticles.removeChild(a),
          this.customAuraFx.particles.splice(b, 1),
          c--,
          b--);
  }
  updateFireEyes() {
    var a = App.CombinedTextures[ParticleEffects.FireEyes.tex];
    this.customFaceFx.update();
    let b = new PIXI.Sprite(a);
    b.tint = void 0 !== this.customFaceFx.tint ? this.customFaceFx.tint : 16777215;
    b.anchor.x = b.anchor.y = 0.5;
    b.alpha = 1.1;
    b.x = this.ninja.x + this.head.x - 17;
    b.y = this.ninja.y + this.head.y - 9;
    b.scale.x = b.scale.y = 0.5;
    b.rotation = Math.random() * Math.PI * 2;
    b.vx = 2 + 1 * Math.random();
    b.vy = -1.5 + 1 * Math.random();
    b.ttl = 20;
    this.topParticles.addChild(b);
    this.customFaceFx.particles.push(b);
    b = new PIXI.Sprite(a);
    b.tint = 16777215;
    b.anchor.x = b.anchor.y = 0.5;
    b.alpha = 1.1;
    b.x = this.ninja.x + this.head.x - 17;
    b.y = this.ninja.y + this.head.y - 9;
    b.scale.x = b.scale.y = 0.3;
    b.rotation = Math.random() * Math.PI * 2;
    b.vx = 1.5 + 0.75 * Math.random();
    b.vy = -1 + 0.75 * Math.random();
    b.ttl = 5;
    this.topParticles.addChild(b);
    this.customFaceFx.particles.push(b);
    for (let c = 0, d = this.customFaceFx.particles.length; c < d; c++)
      (a = this.customFaceFx.particles[c]),
        (a.x += a.vx),
        (a.y += a.vy),
        (a.scale.x -= 0.025),
        (a.scale.y -= 0.025),
        (a.alpha -= 0.05),
        0 === --a.ttl &&
          (this.topParticles.removeChild(a), this.customFaceFx.particles.splice(c, 1), d--, c--);
  }
  updateCape() {
    this.customExtraFx.counter += 0.8;
    this.customExtraFx.player.torsoupper.p.vx = 1.5;
    this.customExtraFx.player.torsoupper.p.vy = 10 * Math.sin(0.1 * this.torsoUpper.y + 1.5);
    this.customExtraFx.cape.update();
    this.extra.x = this.torsoUpper.x + 20;
    this.extra.y = this.torsoUpper.y - 20;
  }
}
var accounttab = {};
class AccountTab extends Feature {
  constructor(a, b) {
    super();
    this.w = a;
    this.h = b;
    this.ox = 20;
    this.oy = 126;
    this.sections = 3;
    this.currentSection = 0;
    this.accountSettingsTitle = new PIXI.Text("Account settings", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.accountSettingsTitle.x = this.ox - 4;
    this.accountSettingsTitle.y = 100;
    this.accountSettingsTitle.tint = 16763904;
    this.addChild(this.accountSettingsTitle);
    this.tableContainerMask = new PIXI.Graphics();
    this.tableContainerMask.beginFill(16777215, 1);
    this.tableContainerMask.drawRect(0, 100, 638, 390);
    this.tableContainerMask.endFill();
    this.tableContainerMask.x = 11;
    this.container.addChild(this.tableContainerMask);
    this.container.mask = this.tableContainerMask;
    this.scrollLeftButton = new Button("scroll_right");
    this.scrollLeftButton.selected = !0;
    this.scrollLeftButton.setText("<< Previous setting");
    this.scrollLeftButton.setTint(16763989);
    this.scrollLeftButton.scale.x = this.scrollLeftButton.scale.y = 0.7;
    this.scrollLeftButton.disable();
    this.scrollLeftButton.addListener(Button.BUTTON_RELEASED, () => {
      for (let c = 0; c < this.container.children.length; c++)
        this.container.children[c] !== this.tableContainerMask &&
          (this.container.children[c].x += 318);
      0 < this.currentSection && this.currentSection--;
      0 === this.currentSection &&
        (this.scrollLeftButton.disable(), 2 < this.sections && this.scrollRightButton.enable());
    });
    this.scrollLeftButton.x = 23;
    this.scrollLeftButton.y = 128;
    this.addChild(this.scrollLeftButton);
    this.scrollRightButton = new Button("scroll_right");
    this.scrollRightButton.selected = !0;
    this.scrollRightButton.setText("Next setting >>");
    this.scrollRightButton.setTint(16763989);
    this.scrollRightButton.scale.x = this.scrollRightButton.scale.y = 0.7;
    this.scrollRightButton.addListener(Button.BUTTON_RELEASED, () => {
      for (let c = 0; c < this.container.children.length; c++)
        this.container.children[c] !== this.tableContainerMask &&
          (this.container.children[c].x -= 318);
      this.currentSection < this.sections - 2 && this.currentSection++;
      this.currentSection >= this.sections - 2 &&
        (this.scrollRightButton.disable(), 2 < this.sections && this.scrollLeftButton.enable());
    });
    this.scrollRightButton.x = 520;
    this.scrollRightButton.y = 128;
    this.addChild(this.scrollRightButton);
    this.passwordBackground = new PIXI.Graphics();
    this.passwordBackground.x = this.ox - 6;
    this.passwordBackground.y = this.oy + 32;
    this.passwordBackground.beginFill(6710886, 0.3);
    this.passwordBackground.drawRoundedRect(0, 0, 314, 336, 8);
    this.passwordBackground.endFill();
    this.container.addChild(this.passwordBackground);
    this.passwordResetTitle = new PIXI.BitmapText("Change password", {
      fontName: "Open Sans",
      fontSize: 26,
    });
    this.passwordResetTitle.x = this.ox;
    this.passwordResetTitle.y = this.oy + 40;
    this.passwordResetTitle.tint = 16746496;
    this.container.addChild(this.passwordResetTitle);
    this.oldPasswordTitle = new PIXI.BitmapText("Current password", {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.oldPasswordTitle.x = this.ox;
    this.oldPasswordTitle.y = this.oy + 78;
    this.oldPasswordTitle.tint = 16777215;
    this.container.addChild(this.oldPasswordTitle);
    this.newPasswordTitle = new PIXI.BitmapText("New password", {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.newPasswordTitle.x = this.ox;
    this.newPasswordTitle.y = this.oy + 143;
    this.newPasswordTitle.tint = 16777215;
    this.container.addChild(this.newPasswordTitle);
    this.repeatPasswordTitle = new PIXI.BitmapText("Repeat new password", {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.repeatPasswordTitle.x = this.ox;
    this.repeatPasswordTitle.y = this.oy + 208;
    this.repeatPasswordTitle.tint = 16777215;
    this.container.addChild(this.repeatPasswordTitle);
    this.savePasswordButton = new Button("save_password");
    this.savePasswordButton.selected = !0;
    this.savePasswordButton.setText("Change password");
    this.savePasswordButton.setTint(16763904);
    this.savePasswordButton.scale.x = this.savePasswordButton.scale.y = 0.8;
    this.savePasswordButton.addListener(
      Button.BUTTON_RELEASED,
      this.onSavePasswordButtonReleased.bind(this)
    );
    this.savePasswordButton.x = this.ox + 10;
    this.savePasswordButton.y = this.oy + 284;
    this.container.addChild(this.savePasswordButton);
    this.oldPasswordField = new InputField("old_password");
    this.oldPasswordField.setDimensions(300, 35);
    this.oldPasswordField.forceLowerCase = !1;
    this.oldPasswordField.setMaxChars(32);
    this.oldPasswordField.setPassword(!0);
    this.oldPasswordField.x = this.ox;
    this.oldPasswordField.y = this.oy + 100;
    this.oldPasswordField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-.@!#$%^&*()[]"
    );
    this.container.addChild(this.oldPasswordField);
    this.newPasswordField = new InputField("new_password");
    this.newPasswordField.setDimensions(300, 35);
    this.newPasswordField.forceLowerCase = !1;
    this.newPasswordField.setMaxChars(32);
    this.newPasswordField.setPassword(!0);
    this.newPasswordField.x = this.ox;
    this.newPasswordField.y = this.oy + 165;
    this.newPasswordField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-.@!#$%^&*()[]"
    );
    this.container.addChild(this.newPasswordField);
    this.repeatPasswordField = new InputField("repeat_password");
    this.repeatPasswordField.setDimensions(300, 35);
    this.repeatPasswordField.forceLowerCase = !1;
    this.repeatPasswordField.setMaxChars(32);
    this.repeatPasswordField.setPassword(!0);
    this.repeatPasswordField.x = this.ox;
    this.repeatPasswordField.y = this.oy + 230;
    this.repeatPasswordField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-.@!#$%^&*()[]"
    );
    this.container.addChild(this.repeatPasswordField);
    this.errorMessage = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 22,
      align: "left",
      multiline: !0,
    });
    this.errorMessage.x = this.ox;
    this.errorMessage.y = this.oy + 320;
    this.errorMessage.tint = 16711680;
    this.errorMessage.maxWidth = 300;
    this.container.addChild(this.errorMessage);
    this.successMessage = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 22,
      align: "left",
      multiline: !0,
    });
    this.successMessage.x = this.ox;
    this.successMessage.y = this.oy + 320;
    this.successMessage.tint = 65280;
    this.successMessage.maxWidth = 300;
    this.container.addChild(this.successMessage);
    this.changeNameBackground = new PIXI.Graphics();
    this.changeNameBackground.x = this.ox + 312;
    this.changeNameBackground.y = this.oy + 32;
    this.changeNameBackground.beginFill(6710886, 0.3);
    this.changeNameBackground.drawRoundedRect(0, 0, 314, 336, 8);
    this.changeNameBackground.endFill();
    this.container.addChild(this.changeNameBackground);
    this.changeNameTitle = new PIXI.BitmapText("Change username", {
      fontName: "Open Sans",
      fontSize: 26,
    });
    this.changeNameTitle.x = this.ox + 318;
    this.changeNameTitle.y = this.oy + 40;
    this.changeNameTitle.tint = 16746496;
    this.container.addChild(this.changeNameTitle);
    this.newPasswordTitle = new PIXI.BitmapText("Username", {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.newPasswordTitle.x = this.ox + 318;
    this.newPasswordTitle.y = this.oy + 78;
    this.newPasswordTitle.tint = 16777215;
    this.container.addChild(this.newPasswordTitle);
    this.nameField = new InputField("username");
    this.nameField.setDimensions(300, 35);
    this.nameField.forceLowerCase = !1;
    this.nameField.setMaxChars(32);
    this.nameField.x = this.ox + 318;
    this.nameField.y = this.oy + 100;
    this.nameField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-().[]!"
    );
    this.nameField.setText(App.Credential.username);
    this.container.addChild(this.nameField);
    this.newPasswordTitle = new PIXI.BitmapText("Password", {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.newPasswordTitle.x = this.ox + 318;
    this.newPasswordTitle.y = this.oy + 143;
    this.newPasswordTitle.tint = 16777215;
    this.container.addChild(this.newPasswordTitle);
    this.verificationPasswordField = new InputField("password");
    this.verificationPasswordField.setDimensions(300, 35);
    this.verificationPasswordField.forceLowerCase = !1;
    this.verificationPasswordField.setMaxChars(32);
    this.verificationPasswordField.setPassword(!0);
    this.verificationPasswordField.x = this.ox + 318;
    this.verificationPasswordField.y = this.oy + 165;
    this.verificationPasswordField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-.@!#$%^&*()[]"
    );
    this.container.addChild(this.verificationPasswordField);
    this.usernameInfo = new PIXI.BitmapText(
      "Costs 1.000 gold.\nCan be changed once every 30 days.\n",
      { fontName: "Open Sans", fontSize: 22 }
    );
    this.usernameInfo.x = this.ox + 318;
    this.usernameInfo.y = this.oy + 210;
    this.usernameInfo.tint = 13421772;
    this.container.addChild(this.usernameInfo);
    this.saveUsernameButton = new Button("save_username");
    this.saveUsernameButton.selected = !0;
    this.saveUsernameButton.setText("Change username");
    this.saveUsernameButton.setTint(16763904);
    this.saveUsernameButton.scale.x = this.saveUsernameButton.scale.y = 0.8;
    this.saveUsernameButton.addListener(
      Button.BUTTON_RELEASED,
      this.onSaveUsernameButtonReleased.bind(this)
    );
    this.saveUsernameButton.x = this.ox + 328;
    this.saveUsernameButton.y = this.oy + 284;
    this.container.addChild(this.saveUsernameButton);
    this.goldIcon = new PIXI.Sprite(App.CombinedTextures.gold1);
    this.goldIcon.x = this.saveUsernameButton.x + this.saveUsernameButton.width + 4;
    this.goldIcon.y = this.saveUsernameButton.y;
    this.goldIcon.scale.x = this.goldIcon.scale.y = 0.5;
    this.container.addChild(this.goldIcon);
    this.goldInfo = new PIXI.BitmapText("-1.000", { fontName: "Open Sans", fontSize: 22 });
    this.goldInfo.x = this.goldIcon.x + this.goldIcon.width + 4;
    this.goldInfo.y = this.goldIcon.y + 5;
    this.goldInfo.tint = 16711680;
    this.container.addChild(this.goldInfo);
    this.changeUsernameErrorMessage = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 22,
      align: "left",
      multiline: !0,
    });
    this.changeUsernameErrorMessage.x = this.ox + 328;
    this.changeUsernameErrorMessage.y = this.oy + 320;
    this.changeUsernameErrorMessage.tint = 16711680;
    this.changeUsernameErrorMessage.maxWidth = 300;
    this.container.addChild(this.changeUsernameErrorMessage);
    this.changeUsernameSuccessMessage = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 22,
      align: "left",
      multiline: !0,
    });
    this.changeUsernameSuccessMessage.x = this.ox + 328;
    this.changeUsernameSuccessMessage.y = this.oy + 320;
    this.changeUsernameSuccessMessage.tint = 65280;
    this.changeUsernameSuccessMessage.maxWidth = 300;
    this.container.addChild(this.changeUsernameSuccessMessage);
    this.deactivationBackground = new PIXI.Graphics();
    this.deactivationBackground.x = this.ox + 630;
    this.deactivationBackground.y = this.oy + 32;
    this.deactivationBackground.beginFill(6710886, 0.3);
    this.deactivationBackground.drawRoundedRect(0, 0, 314, 336, 8);
    this.deactivationBackground.endFill();
    this.container.addChild(this.deactivationBackground);
    this.deactivationTitle = new PIXI.BitmapText("Deactivate account", {
      fontName: "Open Sans",
      fontSize: 26,
    });
    this.deactivationTitle.x = this.ox + 638;
    this.deactivationTitle.y = this.oy + 40;
    this.deactivationTitle.tint = 16746496;
    this.container.addChild(this.deactivationTitle);
    this.deactivationInfo = new PIXI.BitmapText(
      "Permanently deactivate this account.\n\nThe email address associated with\nthis account will become available for\nnew account registration.",
      { fontName: "Open Sans", fontSize: 22 }
    );
    this.deactivationInfo.x = this.ox + 636;
    this.deactivationInfo.y = this.oy + 78;
    this.deactivationInfo.tint = 13421772;
    this.container.addChild(this.deactivationInfo);
    this.passwordTitle = new PIXI.BitmapText("Password", { fontName: "Open Sans", fontSize: 22 });
    this.passwordTitle.x = this.ox + 636;
    this.passwordTitle.y = this.oy + 210;
    this.passwordTitle.tint = 16777215;
    this.container.addChild(this.passwordTitle);
    this.passwordField = new InputField("password");
    this.passwordField.setDimensions(300, 35);
    this.passwordField.forceLowerCase = !1;
    this.passwordField.setMaxChars(32);
    this.passwordField.setPassword(!0);
    this.passwordField.x = this.ox + 636;
    this.passwordField.y = this.oy + 230;
    this.passwordField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-.@!#$%^&*()[]"
    );
    this.container.addChild(this.passwordField);
    this.deactivateButton = new Button("deactivate_account");
    this.deactivateButton.selected = !0;
    this.deactivateButton.setText("Deactivate account");
    this.deactivateButton.scale.x = this.deactivateButton.scale.y = 0.8;
    this.deactivateButton.addListener(
      Button.BUTTON_RELEASED,
      this.onDeactivateButtonReleased.bind(this)
    );
    this.deactivateButton.x = this.ox + 646;
    this.deactivateButton.y = this.oy + 284;
    this.deactivateButton.setTint(16711680);
    this.container.addChild(this.deactivateButton);
    this.deactivationErrorMessage = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 22,
      align: "left",
      multiline: !0,
    });
    this.deactivationErrorMessage.x = this.ox + 648;
    this.deactivationErrorMessage.y = this.oy + 320;
    this.deactivationErrorMessage.tint = 16711680;
    this.deactivationErrorMessage.maxWidth = 300;
    this.container.addChild(this.deactivationErrorMessage);
  }
  validatePasswordForm() {
    let a = !0,
      b = "";
    const c = this.oldPasswordField.getText(),
      d = this.newPasswordField.getText(),
      e = this.repeatPasswordField.getText();
    8 > c.length
      ? ((a = !1),
        (b = "Password must be at least 8 characters long."),
        this.oldPasswordField.markInvalid())
      : this.oldPasswordField.markNone();
    a && 8 > d.length
      ? ((a = !1),
        (b = "Password must be at least 8 characters long."),
        this.newPasswordField.markInvalid())
      : this.newPasswordField.markNone();
    a && 8 > e.length
      ? ((a = !1),
        (b = "Password must be at least 8 characters long."),
        this.repeatPasswordField.markInvalid())
      : this.repeatPasswordField.markNone();
    a && d !== e
      ? ((a = !1),
        (b = "Passwords do not match."),
        this.newPasswordField.markInvalid(),
        this.repeatPasswordField.markInvalid())
      : (this.newPasswordField.markNone(), this.repeatPasswordField.markNone());
    a && this.displayErrorMessage("");
    this.successMessage.text = "";
    return { valid: a, error: b };
  }
  validateDeactivationForm() {
    let a = !0,
      b = "";
    8 > this.passwordField.getText().length
      ? ((a = !1), (b = "Invalid password."), this.passwordField.markInvalid())
      : this.passwordField.markNone();
    a && this.displayDeactivationErrorMessage("");
    return { valid: a, error: b };
  }
  validateNameChangeForm() {
    let a = !0,
      b = "";
    4 > this.nameField.getText().length
      ? ((b = "Username is too short."), (a = !1), this.nameField.markInvalid())
      : a && this.nameField.markValid();
    const c = this.verificationPasswordField.getText();
    a && 8 > c.length
      ? ((a = !1), (b = "Invalid password."), this.verificationPasswordField.markInvalid())
      : this.verificationPasswordField.markNone();
    a && this.displayUsernameErrorMessage("");
    return { valid: a, error: b };
  }
  async onSavePasswordButtonReleased() {
    this.savePasswordButton.disable();
    var a = this.validatePasswordForm();
    a.valid
      ? ((a = await APIClient.renewPassword(
          this.newPasswordField.getText(),
          this.oldPasswordField.getText(),
          App.Credential.id
        )),
        this.savePasswordButton.enable(),
        !1 === a.success
          ? this.displayErrorMessage(a.error)
          : (this.oldPasswordField.setText(""),
            this.newPasswordField.setText(""),
            this.repeatPasswordField.setText(""),
            (this.successMessage.text = "New password saved.")))
      : (this.displayErrorMessage(a.error), this.savePasswordButton.enable());
  }
  async onSaveUsernameButtonReleased() {
    this.saveUsernameButton.disable();
    var a = this.validateNameChangeForm();
    if (a.valid)
      if (
        ((a = await APIClient.postUsername(
          this.nameField.getText(),
          this.verificationPasswordField.getText(),
          App.Credential.id
        )),
        this.saveUsernameButton.enable(),
        !1 === a.success)
      )
        this.displayUsernameErrorMessage(a.error);
      else {
        a = this.nameField.getText().trim();
        var b = this.verificationPasswordField.getText();
        this.verificationPasswordField.setText("");
        this.changeUsernameSuccessMessage.text = "Username changed.";
        this.saveUsernameButton.disable();
        this.emit(Layer.Events.PROFILE_RENAME, { name: a, password: b });
      }
    else this.displayUsernameErrorMessage(a.error), this.saveUsernameButton.enable();
  }
  async onDeactivateButtonReleased() {
    this.deactivateButton.disable();
    var a = this.validateDeactivationForm();
    a.valid
      ? ((a = await APIClient.deactivateAccount(this.passwordField.getText(), App.Credential.id)),
        this.deactivateButton.enable(),
        !1 === a.success
          ? this.displayDeactivationErrorMessage(a.error)
          : (this.passwordField.setText(""),
            this.displayDeactivationErrorMessage("Account deactivated."),
            Registry.Instance.store(Registry.Key.CREDENTIAL, { available: !1 }),
            setTimeout(() => this.emit(Layer.Events.LOGOUT), 1e3)))
      : (this.displayDeactivationErrorMessage(a.error), this.deactivateButton.enable());
  }
  displayErrorMessage(a) {
    this.errorMessage.text = a;
  }
  displayUsernameErrorMessage(a) {
    this.changeUsernameErrorMessage.text = a;
  }
  displayDeactivationErrorMessage(a) {
    this.deactivationErrorMessage.text = a;
  }
  load() {
    this.nameField.setText(App.Credential.username);
  }
}
AccountTab.LOGOUT = "logout";
var incompleteaccounttab = {};
class IncompleteAccountTab extends Feature {
  constructor(a, b) {
    super();
    this.w = a;
    this.h = b;
    this.ox = 20;
    this.oy = 126;
    this.accountSettingsTitle = new PIXI.Text("Account settings", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.accountSettingsTitle.x = this.ox - 4;
    this.accountSettingsTitle.y = 100;
    this.accountSettingsTitle.tint = 16763904;
    this.addChild(this.accountSettingsTitle);
    this.autogenDescription = new PIXI.Text(
      "Your account does not have a password.\nAccount settings will be available after you set a password for this account.\n\nClick the 'Complete registration' button below to set a password and get full access to account settings.",
      {
        fontSize: 17,
        fontFamily: "Arial",
        fill: 15658734,
        lineJoin: "round",
        strokeThickness: 2,
        lineHeight: 24,
        align: "left",
        wordWrap: !0,
        wordWrapWidth: 600,
      }
    );
    this.autogenDescription.x = this.ox + 10;
    this.autogenDescription.y = 156;
    this.container.addChild(this.autogenDescription);
    this.renameButton = new Button("rename");
    this.renameButton.selected = !0;
    this.renameButton.setText("Complete registration");
    this.renameButton.scale.x = this.renameButton.scale.y = 0.9;
    this.renameButton.addListener(Button.BUTTON_RELEASED, () =>
      this.emit(Layer.Events.RENAME_ACCESS)
    );
    this.renameButton.x = this.ox + 14;
    this.renameButton.y = this.oy + 200;
    this.renameButton.setTint(16763904);
    this.container.addChild(this.renameButton);
  }
}
var levelbar = {};
class LevelBar extends PIXI.Container {
  constructor() {
    super();
    this.ox = 0;
    this.w = 300;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.1);
    this.background.drawRoundedRect(0, 0, this.w, 16, 8);
    this.background.endFill();
    this.addChild(this.background);
    this.bar = new PIXI.Graphics();
    this.addChild(this.bar);
    this.previousText = new PIXI.BitmapText("", { fontName: "Open Sans", fontSize: 24 });
    this.previousText.x = this.ox - 4;
    this.previousText.y = -4;
    this.previousText.tint = 16755200;
    this.previousText.anchor.x = 1;
    this.addChild(this.previousText);
    this.previousXpText = new PIXI.BitmapText("", { fontName: "Open Sans", fontSize: 22 });
    this.previousXpText.x = this.ox + 24;
    this.previousXpText.y = 18;
    this.previousXpText.tint = 13421772;
    this.previousXpText.anchor.x = 1;
    this.addChild(this.previousXpText);
    this.currentText = new PIXI.BitmapText("", { fontName: "Open Sans", fontSize: 22 });
    this.currentText.x = this.ox;
    this.currentText.y = 32;
    this.currentText.anchor.x = 0.5;
    this.currentText.tint = 16777215;
    this.addChild(this.currentText);
    this.nextText = new PIXI.BitmapText("", { fontName: "Open Sans", fontSize: 24 });
    this.nextText.x = this.w + 4;
    this.nextText.y = -4;
    this.nextText.tint = 16755200;
    this.addChild(this.nextText);
    this.nextXpText = new PIXI.BitmapText("", { fontName: "Open Sans", fontSize: 22 });
    this.nextXpText.x = this.w - 28;
    this.nextXpText.y = 16;
    this.nextXpText.tint = 13421772;
    this.nextXpText.anchor.x = 0;
    this.addChild(this.nextXpText);
  }
  load(a, b, c) {
    let d = LevelBar.XPToLevel(a),
      e = LevelBar.XPToLevel(c),
      f = Math.min((1 / (c - a)) * (this.w - this.ox - 16) * (b - a), this.w - 16);
    this.currentText.x = f;
    this.previousXpText.text = numberWithPeriods(Math.ceil(a));
    this.nextXpText.text = numberWithPeriods(Math.ceil(c));
    this.currentText.text = numberWithPeriods(Math.ceil(b));
    this.previousText.text = numberWithPeriods(d);
    this.nextText.text = numberWithPeriods(e);
    this.bar.clear();
    this.bar.beginFill(16777215, 0.3);
    this.bar.drawRect(8, 5, f, 6);
    this.bar.endFill();
    this.bar.lineStyle(1, 16777215, 1);
    this.bar.moveTo(f + 8, -1);
    this.bar.lineTo(f + 8, 20);
  }
}
LevelBar.XPToLevel = (a) => Math.min(Math.max(Math.floor(0.2 * Math.sqrt(a / 15.625)), 1), 160);
var usermenu = {};
class UserMenu extends Feature {
  constructor() {
    super();
    this.id = null;
    this.ox = 20;
    this.oy = 50;
    this.playerName = "";
    this.clanId = -1;
    this.weapons = [];
    this.weaponData = [];
    this.twitchUrl = this.youtubeUrl = "";
    this.display = UserMenu.GENERAL;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 1);
    this.background.drawRect(0, 0, 660, 524, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504, 10);
    this.background.endFill();
    this.background.beginFill(6710886, 0.3);
    this.background.drawRoundedRect(20, 22, 620, 270, 8);
    this.background.endFill();
    this.background.beginFill(6710886, 0.3);
    this.background.drawRoundedRect(30, 242, 182, 40, 8);
    this.background.drawRoundedRect(20, 304, 620, 120, 8);
    this.background.endFill();
    this.container.addChild(this.background);
    this.background.interactive = !0;
    this.w = this.width;
    this.h = this.height;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 48;
    this.closeButton.y = this.oy + 14;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.onCloseButtonReleased());
    this.container.addChild(this.closeButton);
    this.generalStatsButton = new PIXI.Graphics();
    this.generalStatsButton.lineStyle(1, 16777215, 0.1, 0);
    this.generalStatsButton.beginFill(16777215, 0.2);
    this.generalStatsButton.drawRect(0, 0, 100, 28, 4);
    this.generalStatsButton.endFill();
    this.generalStatsButton.x = this.ox + 202;
    this.generalStatsButton.y = this.oy + 24;
    this.generalStatsButton.tint = 13421772;
    this.generalStatsButton.interactive = !0;
    this.generalStatsButton.on("mouseover", () => {
      this.generalStatsLabel.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.generalStatsButton.on("mouseout", () => {
      this.generalStatsLabel.alpha = this.display === UserMenu.GENERAL ? 1 : 0.5;
    });
    this.generalStatsButton.on("mousedown", () => {
      this.displayGeneralContainer();
      AudioEffects.ButtonClick.audio.play();
    });
    this.container.addChild(this.generalStatsButton);
    this.generalStatsLabel = new PIXI.Text("General", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.generalStatsLabel.x =
      this.generalStatsButton.x +
      0.5 * (this.generalStatsButton.width - this.generalStatsLabel.width);
    this.generalStatsLabel.y = this.generalStatsButton.y + 2;
    this.generalStatsLabel.resolution = 1.5;
    this.generalStatsLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.generalStatsLabel);
    this.weaponStatsButton = new PIXI.Graphics();
    this.weaponStatsButton.lineStyle(1, 16777215, 0.1, 0);
    this.weaponStatsButton.beginFill(16777215, 0.2);
    this.weaponStatsButton.drawRect(0, 0, 100, 28, 4);
    this.weaponStatsButton.endFill();
    this.weaponStatsButton.x = this.generalStatsButton.x + this.generalStatsButton.width + 8;
    this.weaponStatsButton.y = this.oy + 24;
    this.weaponStatsButton.tint = 13421772;
    this.weaponStatsButton.alpha = 0.5;
    this.weaponStatsButton.interactive = !0;
    this.weaponStatsButton.on("mouseover", () => {
      this.weaponStatsLabel.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.weaponStatsButton.on("mouseout", () => {
      this.weaponStatsLabel.alpha = this.display === UserMenu.WEAPONS ? 1 : 0.5;
    });
    this.weaponStatsButton.on("mousedown", () => {
      this.displayWeaponContainer();
      AudioEffects.ButtonClick.audio.play();
    });
    this.container.addChild(this.weaponStatsButton);
    this.weaponStatsLabel = new PIXI.Text("Weapons", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.weaponStatsLabel.alpha = 0.5;
    this.weaponStatsLabel.resolution = 1.5;
    this.weaponStatsLabel.x =
      this.weaponStatsButton.x + 0.5 * (this.weaponStatsButton.width - this.weaponStatsLabel.width);
    this.weaponStatsLabel.y = this.weaponStatsButton.y + 2;
    this.weaponStatsLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.weaponStatsLabel);
    this.contactButton = new PIXI.Graphics();
    this.contactButton.lineStyle(1, 16777215, 0.1, 0);
    this.contactButton.beginFill(16777215, 0.2);
    this.contactButton.drawRect(0, 0, 100, 28, 4);
    this.contactButton.endFill();
    this.contactButton.x = this.weaponStatsButton.x + this.weaponStatsButton.width + 8;
    this.contactButton.y = this.oy + 24;
    this.contactButton.tint = 13421772;
    this.contactButton.alpha = 0.5;
    this.contactButton.interactive = !0;
    this.contactButton.on("mouseover", () => {
      this.contactLabel.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.contactButton.on("mouseout", () => {
      this.contactLabel.alpha = this.display === UserMenu.CONTACT ? 1 : 0.5;
    });
    this.contactButton.on("mousedown", () => {
      this.displayContactContainer();
      AudioEffects.ButtonClick.audio.play();
    });
    this.container.addChild(this.contactButton);
    this.contactLabel = new PIXI.Text("Contact", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.contactLabel.alpha = 1;
    this.contactLabel.x =
      this.contactButton.x + 0.5 * (this.contactButton.width - this.contactLabel.width);
    this.contactLabel.y = this.contactButton.y + 2;
    this.contactLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.contactLabel);
    this.creationLabel = new PIXI.Text("Created", {
      fontName: "Arial",
      fontSize: 15,
      fill: 8947848,
      strokeThickness: 2,
    });
    this.creationLabel.x = this.ox;
    this.creationLabel.y = this.h - 20;
    this.container.addChild(this.creationLabel);
    this.createdText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 15,
      fill: 11184810,
      strokeThickness: 2,
    });
    this.createdText.x = this.ox + 62;
    this.createdText.y = this.h - 20;
    this.container.addChild(this.createdText);
    this.activityLabel = new PIXI.Text("Last seen", {
      fontName: "Arial",
      fontSize: 15,
      fill: 8947848,
      strokeThickness: 2,
    });
    this.activityLabel.x = this.ox;
    this.activityLabel.y = this.h;
    this.container.addChild(this.activityLabel);
    this.activityText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 15,
      fill: 11184810,
      strokeThickness: 2,
    });
    this.activityText.x = this.ox + 72;
    this.activityText.y = this.h;
    this.activityText.tint = 16777215;
    this.container.addChild(this.activityText);
    this.visualizer = new Visualizer(176, 176, !0, !0, !1);
    this.visualizer.x = this.ox + 12;
    this.visualizer.y = this.oy + 54;
    this.visualizer.interactive = !0;
    this.container.addChild(this.visualizer);
    this.overviewTitle = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16763904,
      strokeThickness: 4,
      lineJoin: "round",
    });
    this.overviewTitle.x = this.visualizer.x + 0.5 * this.visualizer.width;
    this.overviewTitle.y = this.oy + 23;
    this.overviewTitle.anchor.x = 0.5;
    this.container.addChild(this.overviewTitle);
    this.clanLabelText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.clanLabelText.x = this.visualizer.x + 0.5 * this.visualizer.width;
    this.clanLabelText.y = this.oy + 232;
    this.clanLabelText.anchor.x = 0.5;
    this.clanLabelText.interactive = !0;
    this.clanLabelText.hitArea = new PIXI.Rectangle(
      0.5 * -this.clanLabelText.width,
      0.25 * -this.clanLabelText.height,
      this.clanLabelText.width,
      40
    );
    this.clanLabelText.on("mouseover", () => {
      this.clanLabelText.tint = 16776960;
      this.clanText.tint = 16711680;
    });
    this.clanLabelText.on("mouseout", () => {
      this.clanLabelText.tint = 16777215;
      this.clanText.tint = 16763904;
    });
    this.clanLabelText.on("mousedown", () => {
      -1 !== this.clanId && this.emit(Layer.Events.CLAN_ACCESS, this.clanId);
    });
    this.container.addChild(this.clanLabelText);
    this.clanText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.clanText.x = this.visualizer.x + 0.5 * this.visualizer.width;
    this.clanText.y = this.oy + 251;
    this.clanText.anchor.x = 0.5;
    this.clanText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.clanText);
    this.generalContainer = new PIXI.Container();
    this.levelLabel = new PIXI.Text("Level", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.levelLabel.x = this.ox + 210;
    this.levelLabel.y = this.oy + 60;
    this.generalContainer.addChild(this.levelLabel);
    this.levelText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.levelText.x = this.ox + 233;
    this.levelText.y = this.oy + 86;
    this.generalContainer.addChild(this.levelText);
    this.rankLabel = new PIXI.Text("Level rank", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.rankLabel.x = this.ox + 210;
    this.rankLabel.y = this.oy + 114;
    this.generalContainer.addChild(this.rankLabel);
    this.rankText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.rankText.x = this.ox + 210;
    this.rankText.y = this.oy + 138;
    this.generalContainer.addChild(this.rankText);
    this.skillLabel = new PIXI.Text("Skill rank", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 20,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.skillLabel.x = this.ox + 210;
    this.skillLabel.y = this.oy + 168;
    this.generalContainer.addChild(this.skillLabel);
    this.skillText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.skillText.x = this.ox + 210;
    this.skillText.y = this.oy + 192;
    this.generalContainer.addChild(this.skillText);
    this.killsLabel = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.killsLabel.x = this.ox + 360;
    this.killsLabel.y = this.oy + 60;
    this.generalContainer.addChild(this.killsLabel);
    this.killsText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.killsText.x = this.ox + 360;
    this.killsText.y = this.oy + 84;
    this.generalContainer.addChild(this.killsText);
    this.deathsLabel = new PIXI.Text("Deaths", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.deathsLabel.x = this.ox + 360;
    this.deathsLabel.y = this.oy + 114;
    this.generalContainer.addChild(this.deathsLabel);
    this.deathsText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.deathsText.x = this.ox + 360;
    this.deathsText.y = this.oy + 138;
    this.generalContainer.addChild(this.deathsText);
    this.capsLabel = new PIXI.Text("CTF caps", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.capsLabel.x = this.ox + 360;
    this.capsLabel.y = this.oy + 168;
    this.generalContainer.addChild(this.capsLabel);
    this.capsText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.capsText.x = this.ox + 360;
    this.capsText.y = this.oy + 192;
    this.capsText.tint = 16777215;
    this.generalContainer.addChild(this.capsText);
    this.levelIcon = new PIXI.Sprite();
    this.levelIcon.x = this.ox + 200;
    this.levelIcon.y = this.oy + 76;
    this.levelIcon.scale.x = this.levelIcon.scale.y = 0.5;
    this.generalContainer.addChild(this.levelIcon);
    this.socialTitle = new PIXI.Text("Streaming & video channels", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.socialTitle.x = this.ox + 12;
    this.socialTitle.y = this.oy + 300;
    this.socialTitle.tint = 16777215;
    this.container.addChild(this.socialTitle);
    this.youtubeButton = new PIXI.Graphics();
    this.youtubeButton.lineStyle(1, 16777215, 0.1, 0);
    this.youtubeButton.drawRoundedRect(0, 0, 240, 34, 4);
    this.youtubeButton.x = this.ox + 12;
    this.youtubeButton.y = this.oy + 328;
    this.youtubeButton.tint = 13421772;
    this.youtubeButton.interactive = !0;
    this.youtubeButton.on("mouseover", () => {
      this.youtubeTitle.tint = 16777215;
      this.youtubeLogo.tint = 16777215;
    });
    this.youtubeButton.on("mouseout", () => {
      this.youtubeTitle.tint = 13421772;
      this.youtubeLogo.tint = 13421772;
    });
    this.youtubeButton.on("mousedown", () => {
      20 < this.youtubeUrl.length && window.open(this.youtubeUrl, "_blank");
    });
    this.youtubeButton.hitArea = new PIXI.Rectangle(0, 0, 240, 34);
    this.container.addChild(this.youtubeButton);
    this.youtubeLogo = new PIXI.Sprite(App.CombinedTextures.youtube_logo);
    this.youtubeLogo.scale.x = this.youtubeLogo.scale.y = 0.5;
    this.youtubeLogo.x = this.ox + 18;
    this.youtubeLogo.y = this.oy + 333;
    this.youtubeLogo.tint = 13421772;
    this.container.addChild(this.youtubeLogo);
    this.youtubeTitle = new PIXI.Text("YouTube", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16776960,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.youtubeTitle.x = this.ox + 58;
    this.youtubeTitle.y = this.oy + 334;
    this.youtubeTitle.tint = 13421772;
    this.container.addChild(this.youtubeTitle);
    this.twitchButton = new PIXI.Graphics();
    this.twitchButton.lineStyle(1, 16777215, 0.1, 0);
    this.twitchButton.drawRoundedRect(0, 0, 240, 34, 4);
    this.twitchButton.x = this.ox + 12;
    this.twitchButton.y = this.oy + 368;
    this.twitchButton.tint = 13421772;
    this.twitchButton.interactive = !0;
    this.twitchButton.on("mouseover", () => {
      this.twitchTitle.tint = 16777215;
      this.twitchLogo.tint = 16777215;
    });
    this.twitchButton.on("mouseout", () => {
      this.twitchTitle.tint = 13421772;
      this.twitchLogo.tint = 13421772;
    });
    this.twitchButton.on("mousedown", () => {
      20 < this.twitchUrl.length && window.open(this.twitchUrl, "_blank");
    });
    this.twitchButton.hitArea = new PIXI.Rectangle(0, 0, 240, 34);
    this.container.addChild(this.twitchButton);
    this.twitchLogo = new PIXI.Sprite(App.CombinedTextures.twitch_logo);
    this.twitchLogo.scale.x = this.twitchLogo.scale.y = 0.75;
    this.twitchLogo.x = this.ox + 16;
    this.twitchLogo.y = this.oy + 370;
    this.twitchLogo.tint = 13421772;
    this.container.addChild(this.twitchLogo);
    this.twitchTitle = new PIXI.Text("Twitch", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16776960,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.twitchTitle.x = this.ox + 59;
    this.twitchTitle.y = this.oy + 374;
    this.twitchTitle.tint = 13421772;
    this.container.addChild(this.twitchTitle);
    this.weaponContainer = new PIXI.Container();
    this.weaponTitle = new PIXI.Text("Favorite weapons", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.weaponTitle.x = this.ox + 210;
    this.weaponTitle.y = this.oy + 60;
    this.weaponContainer.addChild(this.weaponTitle);
    this.weaponNameLabel = new PIXI.Text("Type", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.weaponNameLabel.x = this.ox + 210;
    this.weaponNameLabel.y = this.oy + 82;
    this.weaponContainer.addChild(this.weaponNameLabel);
    this.weaponKillsLabel = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.weaponKillsLabel.x = this.ox + 480;
    this.weaponKillsLabel.y = this.oy + 82;
    this.weaponContainer.addChild(this.weaponKillsLabel);
    this.listContainer = new PIXI.Container();
    this.listContainer.x = this.ox + 204;
    this.listContainer.y = this.oy + 60;
    this.weaponListContainer = new PIXI.Container();
    this.listContainer.addChild(this.weaponListContainer);
    this.weaponContainer.addChild(this.listContainer);
    this.scrollbar = new WeaponListScrollbar(172);
    this.scrollbar.x = this.ox + 598;
    this.scrollbar.y = this.oy + 102;
    this.scrollbar.on(WeaponListScrollbar.SCROLL, (a) => {
      this.maskWeaponList(a);
    });
    this.contactContainer = new PIXI.Container();
    this.friendInvitationText = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16776960,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.friendInvitationButton = new Button("connect");
    this.friendInvitationButton.selected = !0;
    this.friendInvitationButton.setText("Send friend invitation");
    this.friendInvitationButton.scale.x = this.friendInvitationButton.scale.y = 0.8;
    this.friendInvitationButton.addListener(Button.BUTTON_RELEASED, async () => {
      this.friendInvitationButton.disable();
      let a = await APIClient.postInviteFriend(this.playerName, App.Credential.id);
      this.friendInvitationText.text = a.success
        ? "Friend invitation sent to " + this.playerName
        : a.error;
    });
    this.friendInvitationButton.x = this.ox + 210;
    this.friendInvitationButton.y = this.oy + 70;
    this.friendInvitationButton.setTint(16763904);
    this.contactContainer.addChild(this.friendInvitationButton);
    this.friendInvitationText.x = this.friendInvitationButton.x - 5;
    this.friendInvitationText.y = this.friendInvitationButton.y + 40;
    this.contactContainer.addChild(this.friendInvitationText);
    this.displayGeneralContainer();
  }
  async load(a, b = "id") {
    this.clanId = this.id = -1;
    this.youtubeButton.interactive = !1;
    this.youtubeLogo.alpha = 0.4;
    this.youtubeTitle.alpha = 0.4;
    this.youtubeUrl = "";
    this.youtubeTitle.text = "YouTube";
    this.twitchButton.interactive = !1;
    this.twitchLogo.alpha = 0.4;
    this.twitchTitle.alpha = 0.4;
    this.twitchUrl = "";
    this.twitchTitle.text = "Twitch";
    this.friendInvitationButton.disable();
    this.friendInvitationText.text =
      "guest" === App.Credential.accounttype
        ? "Register or login to invite friends.\nFriends can invite you to join their clan."
        : "Friends can invite you to join their clan.";
    this.visualizer.hide();
    this.overviewTitle.text = "Loading..";
    this.levelText.text = "Loading..";
    this.rankText.text = "Loading..";
    this.skillText.text = "Loading..";
    this.killsText.text = "Loading..";
    this.deathsText.text = "Loading..";
    this.capsText.text = "Loading..";
    this.createdText.text = "Loading..";
    this.activityText.text = "Loading..";
    this.clanLabelText.text = "Loading..";
    this.clanText.text = "";
    if (
      (a = "id" === b ? await APIClient.getUserProfile(a) : await APIClient.getUserProfileByName(a))
    ) {
      this.id = a.id;
      "guest" !== App.Credential.accounttype &&
        this.id !== App.Credential.playerid &&
        this.friendInvitationButton.enable();
      this.playerName = a.name;
      b = new Date(Date.parse(a.seen));
      var c = b.getDate().toString().padStart(2, "0"),
        d = (b.getMonth() + 1).toString().padStart(2, "0"),
        e = b.getFullYear();
      b = Date.now() - 864e5 < b.getTime() ? "Today" : c + "-" + d + "-" + e;
      c = new Date(Date.parse(a.created));
      d = c.getDate().toString().padStart(2, "0");
      e = (c.getMonth() + 1).toString().padStart(2, "0");
      var f = c.getFullYear();
      c = Date.now() - 864e5 < c.getTime() ? "Today" : d + "-" + e + "-" + f;
      d = Math.min(Math.max(Math.floor(0.2 * Math.sqrt(parseInt(a.experience) / 15.625)), 1), 160);
      e = Math.max(Math.floor((d / 160) * 10) + 1);
      this.overviewTitle.text = a.name;
      this.overviewTitle.scale.x = this.overviewTitle.scale.y =
        200 < this.overviewTitle.width ? 200 / this.overviewTitle.width : 1;
      this.levelText.text = numberWithPeriods(d);
      this.skillText.text =
        numberWithPeriods(a.skill_ranking) + "\n" + Game.MapSkillToTitle(a.skill);
      this.killsText.text = numberWithPeriods(a.kills);
      this.deathsText.text = numberWithPeriods(a.deaths);
      this.capsText.text = numberWithPeriods(a.caps);
      this.createdText.text = c;
      this.activityText.text = b;
      this.rankText.text = numberWithPeriods(a.ranking);
      this.visualizer.applyCustomization(a.customization);
      this.visualizer.show();
      this.levelIcon.texture = App.CombinedTextures["skill_icon_" + e];
      -1 !== a.clan_id && null !== a.clan_id
        ? ((this.clanId = a.clan_id),
          (this.clanLabelText.text = "Clan " + a.clan_role + " of "),
          (this.clanText.text = a.clan_name),
          (this.clanLabelText.hitArea = new PIXI.Rectangle(
            0.5 * -this.clanLabelText.width,
            0.25 * -this.clanLabelText.height,
            this.clanLabelText.width,
            40
          )))
        : ((this.clanLabelText.text = "Not in a clan."), (this.clanText.text = ""));
      if (App.WhiteLabel !== App.WhiteLabel_POKI)
        for (b = 0; b < a.social.length; b++)
          switch (((c = a.social[b]), c.type)) {
            case "youtube":
              this.youtubeUrl = c.url;
              this.youtubeButton.interactive = !0;
              this.youtubeLogo.alpha = 1;
              this.youtubeTitle.alpha = 1;
              -1 !== c.url.indexOf("youtube.com/user/")
                ? (this.youtubeTitle.text =
                    "YouTube - " + c.url.substring(c.url.indexOf("youtube.com/user/") + 17))
                : (this.youtubeTitle.text = "YouTube - " + a.name);
              break;
            case "twitch":
              (this.twitchUrl = c.url),
                (this.twitchButton.interactive = !0),
                (this.twitchLogo.alpha = 1),
                (this.twitchTitle.alpha = 1),
                -1 !== c.url.indexOf("twitch.tv/")
                  ? (this.twitchTitle.text =
                      "Twitch - " + c.url.substring(c.url.indexOf("twitch.tv/") + 10))
                  : (this.twitchTitle.text = "Twitch - " + a.name);
          }
      if ((a = await APIClient.getUserWeaponStats(this.id))) {
        this.weaponData = JSON.parse(a);
        this.weaponListContainer.removeChildren();
        this.weapons = [];
        a = this.weaponData;
        for (b = 0; b < a.length; b++)
          (c = a[b]),
            (c = new WeaponItem(c.id, c.kills)),
            (c.x = 0),
            (c.y = 47 + b * WeaponListScrollbar.ItemHeight),
            this.weapons.push(c);
        this.weapons.length >
        Math.floor(WeaponListScrollbar.ListHeight / WeaponListScrollbar.ItemHeight)
          ? this.weaponContainer.addChild(this.scrollbar)
          : this.weaponContainer.removeChild(this.scrollbar);
        this.scrollbar.reset();
        this.maskWeaponList(0);
      }
    }
  }
  maskWeaponList(a) {
    let b = Math.floor(WeaponListScrollbar.ListHeight / WeaponListScrollbar.ItemHeight);
    if (this.weapons.length <= b) this.weaponListContainer.y = 0;
    else {
      this.weaponListContainer.removeChildren();
      this.weaponListContainer.y = -(
        a *
        (this.weapons.length * WeaponListScrollbar.ItemHeight -
          (WeaponListScrollbar.ListHeight - WeaponListScrollbar.ItemHeight))
      );
      a = this.weaponListContainer.y;
      var c = Math.round(Math.abs(a / WeaponListScrollbar.ItemHeight));
      for (let e = 0; e < b; e++) {
        let f = this.weapons[c + e];
        this.weaponListContainer.addChild(f);
        if (0 === e) {
          var d = c * WeaponListScrollbar.ItemHeight + a;
          f.alpha = 0 <= d ? 1 : 1 - (1 / (0.5 * WeaponListScrollbar.ItemHeight)) * Math.abs(d);
        } else
          e === b - 1
            ? ((d = c * WeaponListScrollbar.ItemHeight + a),
              (f.alpha =
                0 > d ? 1 : 1 - (1 / (0.5 * WeaponListScrollbar.ItemHeight)) * Math.abs(d)))
            : (f.alpha = 1);
      }
    }
  }
  displayGeneralContainer() {
    this.generalContainer.parent || this.container.addChild(this.generalContainer);
    this.weaponContainer.parent && this.container.removeChild(this.weaponContainer);
    this.contactContainer.parent && this.container.removeChild(this.contactContainer);
    this.generalStatsLabel.alpha = 1;
    this.generalStatsButton.alpha = 1;
    this.weaponStatsLabel.alpha = 0.5;
    this.weaponStatsButton.alpha = 0.5;
    this.contactLabel.alpha = 0.5;
    this.contactButton.alpha = 0.5;
    this.display = UserMenu.GENERAL;
  }
  displayWeaponContainer() {
    this.weaponContainer.parent || this.container.addChild(this.weaponContainer);
    this.generalContainer.parent && this.container.removeChild(this.generalContainer);
    this.contactContainer.parent && this.container.removeChild(this.contactContainer);
    this.generalStatsLabel.alpha = 0.5;
    this.generalStatsButton.alpha = 0.5;
    this.weaponStatsLabel.alpha = 1;
    this.weaponStatsButton.alpha = 1;
    this.contactLabel.alpha = 0.5;
    this.contactButton.alpha = 0.5;
    this.display = UserMenu.WEAPONS;
  }
  displayContactContainer() {
    this.generalContainer.parent && this.container.removeChild(this.generalContainer);
    this.weaponContainer.parent && this.container.removeChild(this.weaponContainer);
    this.contactContainer.parent || this.container.addChild(this.contactContainer);
    this.generalStatsLabel.alpha = 0.5;
    this.generalStatsButton.alpha = 0.5;
    this.weaponStatsLabel.alpha = 0.5;
    this.weaponStatsButton.alpha = 0.5;
    this.contactLabel.alpha = 1;
    this.contactButton.alpha = 1;
    this.display = UserMenu.CONTACT;
  }
  resize(a, b) {
    this.x = 0.5 * a - 0.5 * this.container.width;
    this.y = -8;
  }
  update() {
    this.visualizer.update();
  }
  onCloseButtonReleased() {
    this.emit(Layer.Events.USER_CANCEL);
  }
}
UserMenu.GENERAL = "general";
UserMenu.WEAPONS = "weapons";
UserMenu.CONTACT = "contact";
class WeaponItem extends PIXI.Container {
  constructor(a, b) {
    super();
    var c = Game.MapEventWepToId(a);
    this.id = c;
    this.name = void 0 !== ItemMap[c] ? ItemMap[c].title : this.id;
    this.kills = b;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.2);
    this.background.drawRoundedRect(0, 0, 392, 38, 4);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.alpha = 0.5;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0.5;
    });
    this.addChild(this.background);
    this.icon = Game.MapEventWepToIcon(a);
    this.icon.x = 25;
    this.icon.y = 23;
    a = this.icon.width;
    b = this.icon.height;
    c = a > b ? (24 < a ? 24 : a) : 12 < b ? 12 : b;
    this.icon.scale.x = this.icon.scale.y = a > b ? c / this.icon.width : c / this.icon.height;
    this.icon.rotation = -0.2;
    this.addChild(this.icon);
    this.nameLabel = new PIXI.Text(this.name, {
      fontName: "Arial",
      fontSize: 17,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.nameLabel.x = 90;
    this.nameLabel.y = 10;
    this.addChild(this.nameLabel);
    this.killsLabel = new PIXI.Text(numberWithPeriods(this.kills), {
      fontName: "Arial",
      fontSize: 17,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.killsLabel.x = 278;
    this.killsLabel.y = 10;
    this.addChild(this.killsLabel);
  }
}
class WeaponListScrollbar extends PIXI.Container {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.bh = this.h - 39;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, this.h, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-10, -2, 50, this.h + 30);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, -3, 16, 35, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = this.bh * this.start;
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.scrollBar.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (c) => {
      this.scroll(c);
    });
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (c) => {
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
      this.scroll(c);
    });
    this.scrollBar.on("pointermove", (c) => this.scroll(c));
  }
  scroll(a) {
    if (this.scrolling) {
      a = a.data.global.y / App.Scale;
      let b = this.scrollButton.y + (a - this.oy);
      b = 0 > b ? 0 : b > this.bh ? this.bh : b;
      let c = (1 / this.h) * b * (this.h / this.bh);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(WeaponListScrollbar.SCROLL, c);
    }
  }
  reset() {
    this.scrollButton.y = (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
WeaponListScrollbar.SCROLL = "scroll";
WeaponListScrollbar.ListHeight = 200;
WeaponListScrollbar.ItemHeight = 42;
var overviewtab = {};
class OverviewTab extends Feature {
  constructor(a, b) {
    super();
    this.w = a;
    this.h = b;
    this.ox = 20;
    this.oy = 100;
    this.display = UserMenu.GENERAL;
    this.weapons = [];
    this.weaponData = [];
    this.background = new PIXI.Graphics();
    this.background.x = this.ox - 6;
    this.background.y = this.oy + 4;
    this.background.beginFill(6710886, 0.3);
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.drawRoundedRect(0, 0, 632, 300, 8);
    this.background.drawRoundedRect(0, 304, 632, 96, 8);
    this.background.endFill();
    this.container.addChild(this.background);
    this.background.interactive = !0;
    this.generalStatsButton = new PIXI.Graphics();
    this.generalStatsButton.beginFill(16777215, 0.2);
    this.generalStatsButton.lineStyle(1, 16777215, 0.1, 0);
    this.generalStatsButton.drawRect(0, 0, 100, 28, 4);
    this.generalStatsButton.endFill();
    this.generalStatsButton.x = this.ox + 202;
    this.generalStatsButton.y = this.oy + 12;
    this.generalStatsButton.tint = 13421772;
    this.generalStatsButton.interactive = !0;
    this.generalStatsButton.on("mouseover", () => {
      this.generalStatsLabel.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.generalStatsButton.on("mouseout", () => {
      this.generalStatsLabel.alpha = this.display === OverviewTab.GENERAL ? 1 : 0.5;
    });
    this.generalStatsButton.on("mousedown", () => {
      this.displayGeneralContainer();
      AudioEffects.ButtonHover.audio.play();
    });
    this.generalStatsButton.on("touchstart", () => this.displayGeneralContainer());
    this.container.addChild(this.generalStatsButton);
    this.generalStatsLabel = new PIXI.Text("General", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.generalStatsLabel.x =
      this.generalStatsButton.x +
      0.5 * (this.generalStatsButton.width - this.generalStatsLabel.width);
    this.generalStatsLabel.y = this.generalStatsButton.y + 2;
    this.generalStatsLabel.resolution = 1.5;
    this.generalStatsLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.generalStatsLabel);
    this.weaponStatsButton = new PIXI.Graphics();
    this.weaponStatsButton.beginFill(16777215, 0.2);
    this.weaponStatsButton.lineStyle(1, 16777215, 0.1, 0);
    this.weaponStatsButton.drawRect(0, 0, 100, 28, 4);
    this.weaponStatsButton.endFill();
    this.weaponStatsButton.x = this.generalStatsButton.x + this.generalStatsButton.width + 8;
    this.weaponStatsButton.y = this.oy + 12;
    this.weaponStatsButton.tint = 13421772;
    this.weaponStatsButton.alpha = 0.5;
    this.weaponStatsButton.interactive = !0;
    this.weaponStatsButton.on("mouseover", () => {
      this.weaponStatsLabel.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.weaponStatsButton.on("mouseout", () => {
      this.weaponStatsLabel.alpha = this.display === OverviewTab.WEAPONS ? 1 : 0.5;
    });
    this.weaponStatsButton.on("mousedown", () => {
      this.displayWeaponContainer();
      AudioEffects.ButtonClick.audio.play();
    });
    this.weaponStatsButton.on("touchstart", () => this.displayWeaponContainer());
    this.container.addChild(this.weaponStatsButton);
    this.weaponStatsLabel = new PIXI.Text("Weapons", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.weaponStatsLabel.alpha = 0.5;
    this.weaponStatsLabel.resolution = 1.5;
    this.weaponStatsLabel.x =
      this.weaponStatsButton.x + 0.5 * (this.weaponStatsButton.width - this.weaponStatsLabel.width);
    this.weaponStatsLabel.y = this.weaponStatsButton.y + 2;
    this.weaponStatsLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.weaponStatsLabel);
    this.creationLabel = new PIXI.Text("Created", {
      fontName: "Arial",
      fontSize: 15,
      fill: 8947848,
      strokeThickness: 2,
    });
    this.creationLabel.x = this.ox;
    this.creationLabel.y = this.h - 14;
    this.container.addChild(this.creationLabel);
    this.createdText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 15,
      fill: 11184810,
      strokeThickness: 2,
    });
    this.createdText.x = this.ox + 60;
    this.createdText.y = this.h - 14;
    this.container.addChild(this.createdText);
    this.activityLabel = new PIXI.Text("Last seen", {
      fontName: "Arial",
      fontSize: 15,
      fill: 8947848,
      strokeThickness: 2,
    });
    this.activityLabel.x = this.ox;
    this.activityLabel.y = this.h + 6;
    this.container.addChild(this.activityLabel);
    this.activityText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 15,
      fill: 11184810,
      strokeThickness: 2,
    });
    this.activityText.x = this.ox + 68;
    this.activityText.y = this.h + 6;
    this.activityText.tint = 16777215;
    this.container.addChild(this.activityText);
    this.visualizer = new Visualizer(176, 176, !0, !0, !1);
    this.visualizer.x = this.ox + 12;
    this.visualizer.y = 142;
    this.visualizer.interactive = !0;
    this.container.addChild(this.visualizer);
    this.overviewTitle = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16763904,
      strokeThickness: 4,
      lineJoin: "round",
    });
    this.overviewTitle.x = this.visualizer.x + 0.5 * this.visualizer.width;
    this.overviewTitle.y = this.oy + 10;
    this.overviewTitle.anchor.x = 0.5;
    this.container.addChild(this.overviewTitle);
    this.generalContainer = new PIXI.Container();
    this.levelLabel = new PIXI.Text("Level", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.levelLabel.x = this.ox + 210;
    this.levelLabel.y = this.oy + 46;
    this.generalContainer.addChild(this.levelLabel);
    this.levelText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.levelText.x = this.ox + 232;
    this.levelText.y = this.oy + 72;
    this.generalContainer.addChild(this.levelText);
    this.rankLabel = new PIXI.Text("Level rank", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.rankLabel.x = this.ox + 210;
    this.rankLabel.y = this.oy + 100;
    this.generalContainer.addChild(this.rankLabel);
    this.rankText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.rankText.x = this.ox + 210;
    this.rankText.y = this.oy + 124;
    this.generalContainer.addChild(this.rankText);
    this.skillLabel = new PIXI.Text("Skill rank", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.skillLabel.x = this.ox + 210;
    this.skillLabel.y = this.oy + 154;
    this.generalContainer.addChild(this.skillLabel);
    this.skillText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 20,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.skillText.x = this.ox + 210;
    this.skillText.y = this.oy + 178;
    this.generalContainer.addChild(this.skillText);
    this.killsLabel = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.killsLabel.x = this.ox + 360;
    this.killsLabel.y = this.oy + 46;
    this.generalContainer.addChild(this.killsLabel);
    this.killsText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.killsText.x = this.ox + 360;
    this.killsText.y = this.oy + 70;
    this.generalContainer.addChild(this.killsText);
    this.deathsLabel = new PIXI.Text("Deaths", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.deathsLabel.x = this.ox + 360;
    this.deathsLabel.y = this.oy + 100;
    this.generalContainer.addChild(this.deathsLabel);
    this.deathsText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.deathsText.x = this.ox + 360;
    this.deathsText.y = this.oy + 124;
    this.generalContainer.addChild(this.deathsText);
    this.capsLabel = new PIXI.Text("CTF caps", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.capsLabel.x = this.ox + 360;
    this.capsLabel.y = this.oy + 154;
    this.generalContainer.addChild(this.capsLabel);
    this.capsText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.capsText.x = this.ox + 360;
    this.capsText.y = this.oy + 178;
    this.generalContainer.addChild(this.capsText);
    this.levelIcon = new PIXI.Sprite();
    this.levelIcon.x = this.ox + 200;
    this.levelIcon.y = this.oy + 62;
    this.levelIcon.scale.x = this.levelIcon.scale.y = 0.5;
    this.generalContainer.addChild(this.levelIcon);
    this.levelBarTitle = new PIXI.Text("Progress", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.levelBarTitle.x = 400;
    this.levelBarTitle.y = 324;
    this.generalContainer.addChild(this.levelBarTitle);
    this.levelBar = new LevelBar();
    this.levelBar.x = 280;
    this.levelBar.y = 350;
    this.generalContainer.addChild(this.levelBar);
    this.goldBackground = new PIXI.Graphics();
    this.goldBackground.x = 36;
    this.goldBackground.y = 324;
    this.goldBackground.beginFill(0, 0.2);
    this.goldBackground.drawRoundedRect(0, 0, 170, 52, 4);
    this.goldBackground.endFill();
    this.container.addChild(this.goldBackground);
    this.goldIcon = new PIXI.Sprite(App.CombinedTextures.gold1);
    this.goldIcon.x = 42;
    this.goldIcon.y = 329;
    this.goldIcon.scale.x = this.goldIcon.scale.y = 0.65;
    this.addChild(this.goldIcon);
    this.goldText = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.goldText.x = this.goldIcon.x + this.goldIcon.width + 10;
    this.goldText.y = this.goldIcon.y + 11;
    this.addChild(this.goldText);
    this.weaponContainer = new PIXI.Container();
    this.weaponTitle = new PIXI.Text("Favorite weapons", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.weaponTitle.x = this.ox + 210;
    this.weaponTitle.y = this.oy + 48;
    this.weaponContainer.addChild(this.weaponTitle);
    this.weaponNameLabel = new PIXI.Text("Type", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.weaponNameLabel.x = this.ox + 210;
    this.weaponNameLabel.y = this.oy + 70;
    this.weaponContainer.addChild(this.weaponNameLabel);
    this.weaponKillsLabel = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.weaponKillsLabel.x = this.ox + 480;
    this.weaponKillsLabel.y = this.oy + 70;
    this.weaponContainer.addChild(this.weaponKillsLabel);
    this.youtubeLogo = new PIXI.Sprite(App.CombinedTextures.youtube_logo);
    this.youtubeLogo.scale.x = this.youtubeLogo.scale.y = 0.5;
    this.youtubeLogo.x = this.ox + 4;
    this.youtubeLogo.y = this.oy + 321;
    this.container.addChild(this.youtubeLogo);
    this.youtubeTitle = new PIXI.Text("YouTube\nchannel", {
      fontName: "Arial",
      fontSize: 15,
      lineHeight: 16,
      fill: 16776960,
      strokeThickness: 2,
    });
    this.youtubeTitle.x = this.ox + 44;
    this.youtubeTitle.y = this.oy + 318;
    this.youtubeTitle.tint = 16776960;
    this.container.addChild(this.youtubeTitle);
    this.youtubeField = new InputField("youtube_field", !1, 20);
    this.youtubeField.setDimensions(370, 35);
    this.youtubeField.forceLowerCase = !1;
    this.youtubeField.setMaxChars(64);
    this.youtubeField.x = this.ox + 112;
    this.youtubeField.y = this.oy + 318;
    this.youtubeField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890:/?._"
    );
    this.youtubeField.addListener(InputField.CHANGE, (c) => {
      c = c.data.value;
      0 === c.length ||
      0 === c.indexOf("https://www.youtube.com/") ||
      0 === c.indexOf("https://youtube.com/")
        ? (this.youtubeField.markNone(), this.saveYoutubeButton.enable())
        : (this.youtubeField.markInvalid(), this.saveYoutubeButton.disable());
    });
    this.container.addChild(this.youtubeField);
    this.pasteYoutubeButton = new Button("paste_yt");
    this.pasteYoutubeButton.selected = !0;
    this.pasteYoutubeButton.setText("Paste");
    this.pasteYoutubeButton.scale.x = this.pasteYoutubeButton.scale.y = 0.75;
    this.pasteYoutubeButton.addListener(Button.BUTTON_RELEASED, () => {
      navigator.clipboard.readText().then((c) => {
        this.youtubeField.setText(c);
        0 === c.length ||
        0 === c.indexOf("https://www.youtube.com/") ||
        0 === c.indexOf("https://youtube.com/")
          ? (this.youtubeField.markNone(), this.saveYoutubeButton.enable())
          : (this.youtubeField.markInvalid(), this.saveYoutubeButton.disable());
      });
    });
    this.pasteYoutubeButton.x = this.ox + this.youtubeField.x + this.youtubeField.width - 4;
    this.pasteYoutubeButton.y = this.oy + 322;
    this.container.addChild(this.pasteYoutubeButton);
    this.saveYoutubeButton = new Button("save_yt");
    this.saveYoutubeButton.selected = !0;
    this.saveYoutubeButton.setText("Save");
    this.saveYoutubeButton.setTint(16763904);
    this.saveYoutubeButton.scale.x = this.saveYoutubeButton.scale.y = 0.75;
    this.saveYoutubeButton.disable();
    this.saveYoutubeButton.addListener(Button.BUTTON_RELEASED, async () => {
      let c = this.youtubeField.getText();
      this.saveYoutubeButton.disable();
      (await this.submitSocial("youtube", c))
        ? this.youtubeField.markValid()
        : this.youtubeField.markInvalid();
    });
    this.saveYoutubeButton.x = this.pasteYoutubeButton.x + this.pasteYoutubeButton.width + 4;
    this.saveYoutubeButton.y = this.oy + 322;
    this.container.addChild(this.saveYoutubeButton);
    this.twitchLogo = new PIXI.Sprite(App.CombinedTextures.twitch_logo);
    this.twitchLogo.scale.x = this.twitchLogo.scale.y = 0.75;
    this.twitchLogo.x = this.ox + 4;
    this.twitchLogo.y = this.oy + 360;
    this.container.addChild(this.twitchLogo);
    this.twitchTitle = new PIXI.Text("Twitch\nchannel", {
      fontName: "Arial",
      fontSize: 15,
      lineHeight: 16,
      fill: 16776960,
      strokeThickness: 2,
    });
    this.twitchTitle.x = this.ox + 47;
    this.twitchTitle.y = this.oy + 362;
    this.twitchTitle.tint = 16776960;
    this.container.addChild(this.twitchTitle);
    this.twitchField = new InputField("twitch_field", !1, 20);
    this.twitchField.setDimensions(370, 35);
    this.twitchField.forceLowerCase = !1;
    this.twitchField.setMaxChars(64);
    this.twitchField.x = this.ox + 112;
    this.twitchField.y = this.oy + 362;
    this.twitchField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890:/?._"
    );
    this.twitchField.addListener(InputField.CHANGE, (c) => {
      c = c.data.value;
      0 === c.length ||
      0 === c.indexOf("https://www.twitch.tv/") ||
      0 === c.indexOf("https://twitch.tv/")
        ? (this.twitchField.markNone(), this.saveTwitchButton.enable())
        : (this.twitchField.markInvalid(), this.saveTwitchButton.disable());
    });
    this.container.addChild(this.twitchField);
    this.pasteTwitchButton = new Button("paste_tw");
    this.pasteTwitchButton.selected = !0;
    this.pasteTwitchButton.setText("Paste");
    this.pasteTwitchButton.scale.x = this.pasteTwitchButton.scale.y = 0.75;
    this.pasteTwitchButton.addListener(Button.BUTTON_RELEASED, () => {
      navigator.clipboard.readText().then((c) => {
        this.twitchField.setText(c);
        0 === c.length ||
        0 === c.indexOf("https://www.twitch.tv/") ||
        0 === c.indexOf("https://twitch.tv/")
          ? (this.twitchField.markNone(), this.saveTwitchButton.enable())
          : (this.twitchField.markInvalid(), this.saveTwitchButton.disable());
      });
    });
    this.pasteTwitchButton.x = this.ox + this.twitchField.x + this.twitchField.width - 4;
    this.pasteTwitchButton.y = this.oy + 366;
    this.container.addChild(this.pasteTwitchButton);
    this.saveTwitchButton = new Button("save_yt");
    this.saveTwitchButton.selected = !0;
    this.saveTwitchButton.setText("Save");
    this.saveTwitchButton.setTint(16763904);
    this.saveTwitchButton.scale.x = this.saveTwitchButton.scale.y = 0.75;
    this.saveTwitchButton.disable();
    this.saveTwitchButton.addListener(Button.BUTTON_RELEASED, async () => {
      let c = this.twitchField.getText();
      this.saveTwitchButton.disable();
      (await this.submitSocial("twitch", c))
        ? this.twitchField.markValid()
        : this.twitchField.markInvalid();
    });
    this.saveTwitchButton.x = this.pasteTwitchButton.x + this.pasteTwitchButton.width + 4;
    this.saveTwitchButton.y = this.oy + 366;
    this.container.addChild(this.saveTwitchButton);
    this.listContainer = new PIXI.Container();
    this.listContainer.x = this.ox + 204;
    this.listContainer.y = this.oy + 48;
    this.weaponListContainer = new PIXI.Container();
    this.listContainer.addChild(this.weaponListContainer);
    this.weaponContainer.addChild(this.listContainer);
    this.scrollbar = new WeaponListScrollbar(172);
    this.scrollbar.x = this.ox + 598;
    this.scrollbar.y = this.oy + 90;
    this.scrollbar.on(WeaponListScrollbar.SCROLL, (c) => {
      this.maskWeaponList(c);
    });
    this.displayGeneralContainer();
  }
  async submitSocial(a, b) {
    return (await APIClient.postSocial(a, b, App.Credential.id)).success;
  }
  async load() {
    var a = await APIClient.getProfile(App.Credential.id);
    this.visualizer.hide();
    this.overviewTitle.text = "Loading..";
    this.levelText.text = "Loading..";
    this.rankText.text = "Loading..";
    this.skillText.text = "Loading..";
    this.killsText.text = "Loading..";
    this.deathsText.text = "Loading..";
    this.capsText.text = "Loading..";
    this.createdText.text = "Loading..";
    this.activityText.text = "Loading..";
    this.youtubeField.markNone();
    this.twitchField.markNone();
    if (a) {
      a = JSON.parse(a);
      var b = new Date(Date.parse(a.seen)),
        c = b.getDate().toString().padStart(2, "0"),
        d = (b.getMonth() + 1).toString().padStart(2, "0"),
        e = b.getFullYear();
      b = Date.now() - 864e5 < b.getTime() ? "Today" : c + "-" + d + "-" + e;
      c = new Date(Date.parse(a.created));
      d = c.getDate().toString().padStart(2, "0");
      e = (c.getMonth() + 1).toString().padStart(2, "0");
      var f = c.getFullYear();
      d = Date.now() - 864e5 < c.getTime() ? "Today" : d + "-" + e + "-" + f;
      e = Math.min(Math.max(Math.floor(0.2 * Math.sqrt(parseInt(a.experience) / 15.625)), 1), 160);
      c = Math.max(Math.floor((e / 160) * 10) + 1);
      f = 15.625 * Math.pow(e / 0.2, 2);
      var g = 15.625 * Math.pow((e + 1) / 0.2, 2);
      this.levelBar.load(1 === e ? 0 : f, parseInt(a.experience, 10), g);
      this.overviewTitle.text = a.name;
      this.overviewTitle.scale.x = this.overviewTitle.scale.y =
        200 < this.overviewTitle.width ? 200 / this.overviewTitle.width : 1;
      this.levelText.text = numberWithPeriods(e);
      this.skillText.text =
        numberWithPeriods(a.skill_ranking) + "\n" + Game.MapSkillToTitle(a.skill);
      this.killsText.text = numberWithPeriods(a.kills);
      this.deathsText.text = numberWithPeriods(a.deaths);
      this.capsText.text = numberWithPeriods(a.caps);
      this.createdText.text = d;
      this.activityText.text = b;
      this.rankText.text = numberWithPeriods(a.ranking);
      this.goldText.text = numberWithPeriods(a.gold);
      for (b = 0; b < a.social.length; b++)
        switch (((d = a.social[b]), d.type)) {
          case "youtube":
            this.youtubeField.setText(d.url);
            break;
          case "twitch":
            this.twitchField.setText(d.url);
        }
      this.visualizer.show();
      this.visualizer.applyCustomization(a.customization);
      this.levelIcon.texture = App.CombinedTextures["skill_icon_" + c];
      if ((a = await APIClient.getUserWeaponStats(App.Credential.playerid))) {
        this.weaponData = JSON.parse(a);
        this.weaponListContainer.removeChildren();
        this.weapons = [];
        a = this.weaponData;
        for (b = 0; b < a.length; b++)
          (c = a[b]),
            (c = new WeaponItem(c.id, c.kills)),
            (c.x = 0),
            (c.y = 47 + b * WeaponListScrollbar.ItemHeight),
            this.weapons.push(c);
        this.weapons.length >
        Math.floor(WeaponListScrollbar.ListHeight / WeaponListScrollbar.ItemHeight)
          ? this.weaponContainer.addChild(this.scrollbar)
          : this.weaponContainer.removeChild(this.scrollbar);
        this.scrollbar.reset();
        this.maskWeaponList(0);
      }
    }
  }
  maskWeaponList(a) {
    let b = Math.floor(WeaponListScrollbar.ListHeight / WeaponListScrollbar.ItemHeight);
    if (this.weapons.length <= b) this.weaponListContainer.y = 0;
    else {
      this.weaponListContainer.removeChildren();
      this.weaponListContainer.y = -(
        a *
        (this.weapons.length * WeaponListScrollbar.ItemHeight -
          (WeaponListScrollbar.ListHeight - WeaponListScrollbar.ItemHeight))
      );
      a = this.weaponListContainer.y;
      var c = Math.round(Math.abs(a / WeaponListScrollbar.ItemHeight));
      for (let e = 0; e < b; e++) {
        let f = this.weapons[c + e];
        this.weaponListContainer.addChild(f);
        if (0 === e) {
          var d = c * WeaponListScrollbar.ItemHeight + a;
          f.alpha = 0 <= d ? 1 : 1 - (1 / (0.5 * WeaponListScrollbar.ItemHeight)) * Math.abs(d);
        } else
          e === b - 1
            ? ((d = c * WeaponListScrollbar.ItemHeight + a),
              (f.alpha =
                0 > d ? 1 : 1 - (1 / (0.5 * WeaponListScrollbar.ItemHeight)) * Math.abs(d)))
            : (f.alpha = 1);
      }
    }
  }
  displayGeneralContainer() {
    this.generalContainer.parent || this.container.addChild(this.generalContainer);
    this.weaponContainer.parent && this.container.removeChild(this.weaponContainer);
    this.generalStatsLabel.alpha = 1;
    this.generalStatsButton.alpha = 1;
    this.weaponStatsLabel.alpha = 0.5;
    this.weaponStatsButton.alpha = 0.5;
    this.display = OverviewTab.GENERAL;
  }
  displayWeaponContainer() {
    this.weaponContainer.parent || this.container.addChild(this.weaponContainer);
    this.generalContainer.parent && this.container.removeChild(this.generalContainer);
    this.generalStatsLabel.alpha = 0.5;
    this.generalStatsButton.alpha = 0.5;
    this.weaponStatsLabel.alpha = 1;
    this.weaponStatsButton.alpha = 1;
    this.display = OverviewTab.WEAPONS;
  }
  update() {
    this.visualizer.update();
  }
}
OverviewTab.GENERAL = "general";
OverviewTab.WEAPONS = "weapons";
var clantab = {};
class ClanTab extends Feature {
  constructor(a, b) {
    super();
    this.w = a;
    this.h = b;
    this.ox = 20;
    this.oy = 126;
    this.members = [];
    this.clanSettingsTitle = new PIXI.Text("Clan", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanSettingsTitle.x = this.ox - 4;
    this.clanSettingsTitle.y = 100;
    this.clanSettingsTitle.tint = 16763904;
    this.addChild(this.clanSettingsTitle);
    this.creationContainer = new PIXI.Container();
    this.clanCreationBackground = new PIXI.Graphics();
    this.clanCreationBackground.x = this.ox - 6;
    this.clanCreationBackground.y = this.oy;
    this.clanCreationBackground.beginFill(6710886, 0.3);
    this.clanCreationBackground.drawRoundedRect(0, 0, 632, 372, 8);
    this.clanCreationBackground.endFill();
    this.clanCreationBackground.beginFill(6710886, 0.3);
    this.clanCreationBackground.drawRoundedRect(16, 140, 600, 208, 8);
    this.clanCreationBackground.endFill();
    this.creationContainer.addChild(this.clanCreationBackground);
    this.clanSettingsTitle = new PIXI.Text(
      "You are not in a clan. Create your own clan or join an existing clan.\nYou can only be in 1 clan at a time.\nIf you create a clan, you will become the clan leader. Clan leaders can invite\nnew members and promote existing members to the role of 'captain'.\nCaptains can invite new members and remove lower ranking members.\nCreating a clan costs 10.000 gold.",
      {
        fontName: "Arial",
        fontSize: 16,
        fill: 13421772,
        strokeThickness: 2,
        lineJoin: "round",
        wordWrap: !0,
        wordWrapWidth: 640,
      }
    );
    this.clanSettingsTitle.x = this.ox;
    this.clanSettingsTitle.y = this.oy + 5;
    this.creationContainer.addChild(this.clanSettingsTitle);
    this.clanCreationMenuTitle = new PIXI.Text("Create a clan", {
      fontName: "Arial",
      fontSize: 20,
      fill: 16746496,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanCreationMenuTitle.x = this.ox + 16;
    this.clanCreationMenuTitle.y = this.oy + 142;
    this.creationContainer.addChild(this.clanCreationMenuTitle);
    this.clanCreationTitle = new PIXI.Text("Clan name", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.clanCreationTitle.x = this.ox + 20;
    this.clanCreationTitle.y = this.oy + 180;
    this.creationContainer.addChild(this.clanCreationTitle);
    this.clanNameField = new InputField("clan_name");
    this.clanNameField.setDimensions(300, 35);
    this.clanNameField.forceLowerCase = !1;
    this.clanNameField.setMaxChars(18);
    this.clanNameField.x = this.ox + 20;
    this.clanNameField.y = this.oy + 208;
    this.clanNameField.setFilter("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890 ");
    this.creationContainer.addChild(this.clanNameField);
    this.createClanButton = new Button("create_clan");
    this.createClanButton.selected = !0;
    this.createClanButton.setText("Create");
    this.createClanButton.setTint(16763904);
    this.createClanButton.scale.x = this.createClanButton.scale.y = 0.8;
    this.createClanButton.addListener(
      Button.BUTTON_RELEASED,
      this.onCreateClanButtonReleased.bind(this)
    );
    this.createClanButton.x = this.ox + 30;
    this.createClanButton.y = this.oy + 265;
    this.creationContainer.addChild(this.createClanButton);
    this.goldIcon = new PIXI.Sprite(App.CombinedTextures.gold1);
    this.goldIcon.x = this.createClanButton.x + this.createClanButton.width + 4;
    this.goldIcon.y = this.createClanButton.y;
    this.goldIcon.scale.x = this.goldIcon.scale.y = 0.5;
    this.creationContainer.addChild(this.goldIcon);
    this.goldInfo = new PIXI.Text("-10.000", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16711680,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.goldInfo.x = this.goldIcon.x + this.goldIcon.width + 4;
    this.goldInfo.y = this.goldIcon.y + 6;
    this.creationContainer.addChild(this.goldInfo);
    this.createClanErrorMessage = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 19,
      fill: 16711680,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.createClanErrorMessage.x = this.ox + 24;
    this.createClanErrorMessage.y = this.createClanButton.y + 44;
    this.createClanErrorMessage.tint = 16711680;
    this.createClanErrorMessage.maxWidth = 380;
    this.creationContainer.addChild(this.createClanErrorMessage);
    this.displayContainer = new PIXI.Container();
    this.clanOverviewBackground = new PIXI.Graphics();
    this.clanOverviewBackground.x = this.ox - 6;
    this.clanOverviewBackground.y = this.oy;
    this.clanOverviewBackground.beginFill(6710886, 0.3);
    this.clanOverviewBackground.drawRoundedRect(0, 0, 632, 372, 8);
    this.clanOverviewBackground.endFill();
    this.clanOverviewBackground.beginFill(6710886, 0.3);
    this.clanOverviewBackground.drawRoundedRect(321, 160, 305, 196, 8);
    this.clanOverviewBackground.endFill();
    this.clanOverviewBackground.beginFill(6710886, 0.3);
    this.clanOverviewBackground.drawRoundedRect(12, 12, 48, 48, 4);
    this.clanOverviewBackground.endFill();
    this.displayContainer.addChild(this.clanOverviewBackground);
    this.uploadText = new PIXI.Text("Clan\nbanner\ncoming soon", {
      fontName: "Arial",
      fontSize: 12,
      fill: 12303291,
      strokeThickness: 2,
      lineJoin: "round",
      wordWrap: !0,
      wordWrapWidth: 80,
      align: "center",
    });
    this.uploadText.x = this.ox - 6;
    this.uploadText.y = this.oy + 10;
    this.displayContainer.addChild(this.uploadText);
    this.nameText = new PIXI.BitmapText("", { fontName: "Open Sans", fontSize: 30, align: "left" });
    this.nameText.x = this.ox + 68;
    this.nameText.y = this.oy + 20;
    this.nameText.tint = 16776960;
    this.displayContainer.addChild(this.nameText);
    this.memberText = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.memberText.x = this.ox + 10;
    this.memberText.y = this.oy + 68;
    this.displayContainer.addChild(this.memberText);
    this.roleLabelText = new PIXI.Text("Your role: ", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.roleLabelText.x = this.ox + 10;
    this.roleLabelText.y = this.oy + 98;
    this.displayContainer.addChild(this.roleLabelText);
    this.hintText = new PIXI.Text(
      "Leaders and captains can right-click\nfriends to invite them into their clan.",
      {
        fontName: "Arial",
        fontSize: 15,
        fill: 13421772,
        strokeThickness: 2,
        lineJoin: "round",
        wordWrap: !0,
        wordWrapWidth: 280,
      }
    );
    this.hintText.x = this.ox + 10;
    this.hintText.y = this.oy + 130;
    this.displayContainer.addChild(this.hintText);
    this.roleText = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.roleText.x = this.roleLabelText.x + this.roleLabelText.width + 8;
    this.roleText.y = this.roleLabelText.y;
    this.displayContainer.addChild(this.roleText);
    this.createdText = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 15,
      fill: 13412864,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.createdText.x = 478;
    this.createdText.y = this.oy + 5;
    this.displayContainer.addChild(this.createdText);
    this.membersTitle = new PIXI.Text("Members", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16750848,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.membersTitle.x = this.ox + 320;
    this.membersTitle.y = this.oy + 138;
    this.displayContainer.addChild(this.membersTitle);
    this.membersHint = new PIXI.Text("(right-click to manage)", {
      fontName: "Arial",
      fontSize: 15,
      fill: 13421772,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.membersHint.x = this.membersTitle.x + this.membersTitle.width + 6;
    this.membersHint.y = this.membersTitle.y + 1;
    this.displayContainer.addChild(this.membersHint);
    this.listContainer = new PIXI.Container();
    this.listContainer.x = this.ox + 318;
    this.listContainer.y = this.oy + 122;
    this.memberListContainer = new PIXI.Container();
    this.listContainer.addChild(this.memberListContainer);
    this.displayContainer.addChild(this.listContainer);
    this.scrollbar = new MemberListScrollbar(195);
    this.scrollbar.x = this.ox + 598;
    this.scrollbar.y = this.oy + 166;
    this.scrollbar.on(MemberListScrollbar.SCROLL, (c) => {
      this.maskMemberList(c);
    });
    this.memberDropdown = new MemberDropdown();
    this.memberDropdown.on(MemberDropdown.ACTION_PROMOTE, (c) => this.promoteMember(c));
    this.memberDropdown.on(MemberDropdown.ACTION_DEMOTE, (c) => this.demoteMember(c));
    this.memberDropdown.on(MemberDropdown.ACTION_REMOVE, (c) => this.removeMember(c));
    this.leaveClanButton = new Button("leave_clan");
    this.leaveClanButton.setText("Leave clan");
    this.leaveClanButton.setTint(16733525);
    this.leaveClanButton.scale.x = this.leaveClanButton.scale.y = 0.8;
    this.leaveClanButton.addListener(
      Button.BUTTON_RELEASED,
      this.onLeaveClanButtonReleased.bind(this)
    );
    this.leaveClanButton.x = this.ox + 520;
    this.leaveClanButton.y = this.oy + 32;
    this.displayContainer.addChild(this.leaveClanButton);
    this.leaveClanContainer = new PIXI.Container();
    this.leaveClanBackground = new PIXI.Graphics();
    this.leaveClanBackground.x = 0;
    this.leaveClanBackground.y = 0;
    this.leaveClanBackground.lineStyle(3, 11184810, 0.5, 0);
    this.leaveClanBackground.beginFill(0, 0.8);
    this.leaveClanBackground.drawRoundedRect(0, 0, 440, 200, 10);
    this.leaveClanBackground.endFill();
    this.leaveClanBackground.interactive = !0;
    this.leaveClanVerificationText = new PIXI.Text("Are you sure you want to leave this clan?", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
      wordWrap: !0,
      wordWrapWidth: 380,
      align: "center",
    });
    this.leaveClanVerificationText.x = 0.5 * this.leaveClanBackground.width;
    this.leaveClanVerificationText.y = 40;
    this.leaveClanVerificationText.anchor.x = this.leaveClanVerificationText.anchor.y = 0.5;
    this.leaveClanAcceptButton = new Button("leave_clan_accept");
    this.leaveClanAcceptButton.setText("Confirm");
    this.leaveClanAcceptButton.scale.x = this.leaveClanAcceptButton.scale.y = 0.8;
    this.leaveClanAcceptButton.addListener(
      Button.BUTTON_RELEASED,
      this.onLeaveClanAcceptButtonReleased.bind(this)
    );
    this.leaveClanAcceptButton.x =
      0.5 * (this.leaveClanBackground.width - this.leaveClanAcceptButton.width) + 70;
    this.leaveClanAcceptButton.y = 140;
    this.leaveClanAcceptButton.setTint(16711680);
    this.leaveClanDeclineButton = new Button("leave_clan_cancel");
    this.leaveClanDeclineButton.setText("Cancel");
    this.leaveClanDeclineButton.scale.x = this.leaveClanDeclineButton.scale.y = 0.8;
    this.leaveClanDeclineButton.addListener(
      Button.BUTTON_RELEASED,
      this.onleaveClanCancelButtonReleased.bind(this)
    );
    this.leaveClanDeclineButton.x =
      0.5 * (this.leaveClanBackground.width - this.leaveClanDeclineButton.width) - 70;
    this.leaveClanDeclineButton.y = 140;
    this.leaveClanDeclineButton.setTint(16763904);
    this.leaveClanErrorText = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 22,
      align: "center",
      multiline: !0,
    });
    this.leaveClanErrorText.x = 0.5 * this.leaveClanBackground.width;
    this.leaveClanErrorText.y = 186;
    this.leaveClanErrorText.tint = 16711680;
    this.leaveClanErrorText.anchor.x = this.leaveClanErrorText.anchor.y = 0.5;
    this.leaveClanContainer.addChild(this.leaveClanBackground);
    this.leaveClanContainer.addChild(this.leaveClanAcceptButton);
    this.leaveClanContainer.addChild(this.leaveClanDeclineButton);
    this.leaveClanContainer.addChild(this.leaveClanVerificationText);
    this.leaveClanContainer.addChild(this.leaveClanErrorText);
    this.leaveClanContainer.x = 0.5 * (this.w - this.leaveClanContainer.width);
    this.leaveClanContainer.y = 0.5 * (this.h - this.leaveClanContainer.height);
  }
  async load() {
    let a = await APIClient.getClanByAccountId(App.Credential.playerid);
    a && (a.clan.id ? this.displayOverview(a.clan) : this.displayCreate());
  }
  displayCreate() {
    this.creationContainer.parent || this.container.addChild(this.creationContainer);
    this.displayContainer.parent && this.container.removeChild(this.displayContainer);
  }
  async displayOverview(a) {
    this.displayContainer.parent || this.container.addChild(this.displayContainer);
    this.creationContainer.parent && this.container.removeChild(this.creationContainer);
    var b = new Date(Date.parse(a.created)),
      c = b.getFullYear(),
      d = b.getMonth() + 1;
    b = b.getDate();
    c = c.toString() + "-" + d.toString().padStart(2, "0") + "-" + b.toString().padStart(2, "0");
    this.nameText.text = a.name;
    this.memberText.text = a.members + " members";
    this.roleText.text = a.role;
    this.createdText.text = "Founded on " + c;
    c = await APIClient.getClanMembers(a.id);
    if (c.success) {
      this.members = [];
      this.memberListContainer.removeChildren();
      a = a.role;
      c = c.members;
      for (d = 0; d < c.length; d++) {
        b = {};
        let e = !1,
          f = c[d];
        "leader" === a &&
          "member" === f.role &&
          ((b[MemberDropdown.ACTION_PROMOTE] = "Promote"), (e = !0));
        "leader" === a &&
          "captain" === f.role &&
          ((b[MemberDropdown.ACTION_DEMOTE] = "Demote"), (e = !0));
        if (
          ("leader" === a && ("member" === f.role || "captain" === f.role)) ||
          ("captain" === a && "member" === f.role)
        )
          (b[MemberDropdown.ACTION_REMOVE] = "Remove"), (e = !0);
        let g = new MemberItem(f.id, f.name, f.role, b);
        g.x = 0;
        g.y = 47 + d * MemberListScrollbar.ItemHeight;
        g.on(ClanTab.ACCESS_PROFILE, (h) => this.emit(Layer.Events.USER_ACCESS, h));
        if (e && f.id !== App.Credential.playerid)
          g.on(ClanTab.SHOW_DROPDOWN, (h) => this.showDropdown(f.id, g, h));
        this.members.push(g);
        this.members.length <
          Math.floor(MemberListScrollbar.ListHeight / MemberListScrollbar.ItemHeight) &&
          this.memberListContainer.addChild(g);
      }
      this.members.length >
      Math.floor(MemberListScrollbar.ListHeight / MemberListScrollbar.ItemHeight)
        ? this.displayContainer.addChild(this.scrollbar)
        : this.displayContainer.removeChild(this.scrollbar);
      this.scrollbar.reset();
      this.maskMemberList(0);
    }
  }
  showDropdown(a, b, c) {
    this.memberDropdown.id === a && this.memberDropdown.parent
      ? this.container.removeChild(this.memberDropdown)
      : ((this.memberDropdown.id = a),
        (this.memberDropdown.name = b.name),
        this.container.addChild(this.memberDropdown),
        (this.memberDropdown.x = this.listContainer.x + b.x),
        (this.memberDropdown.y =
          this.listContainer.y + this.memberListContainer.y + b.y + b.height),
        this.memberDropdown.display(c, a));
  }
  validateClanCreationForm() {
    let a = !0,
      b = "",
      c = this.clanNameField.getText().trim();
    2 > c.length || 20 < c.field
      ? ((a = !1),
        (b = "Clan names should be longer than 2 and shorter than 21 characters."),
        this.clanNameField.markInvalid())
      : this.clanNameField.markNone();
    a && (this.createClanErrorMessage.text = "");
    return { valid: a, error: b };
  }
  async onCreateClanButtonReleased() {
    this.createClanButton.disable();
    var a = this.validateClanCreationForm();
    a.valid
      ? ((a = this.clanNameField.getText().trim()),
        (a = await APIClient.postCreateClan(a, App.Credential.id)),
        a.success
          ? ((a = await APIClient.getClanByAccountId(App.Credential.playerid)),
            this.displayOverview(a.clan),
            this.maskMemberList(0),
            this.emit(Layer.Events.CREATE_CLAN))
          : ((this.createClanErrorMessage.text = a.error), this.createClanButton.enable()))
      : ((this.createClanErrorMessage.text = a.error), this.createClanButton.enable());
  }
  async onLeaveClanButtonReleased() {
    this.leaveClanContainer.parent || this.displayContainer.addChild(this.leaveClanContainer);
    this.leaveClanButton.disable();
  }
  async onLeaveClanAcceptButtonReleased() {
    (await APIClient.postLeaveMember(App.Credential.id)).success
      ? (this.leaveClanContainer.parent &&
          this.displayContainer.removeChild(this.leaveClanContainer),
        this.emit(Layer.Events.LEAVE_CLAN),
        this.leaveClanButton.enable(),
        this.displayCreate())
      : ((this.leaveClanErrorText.text = "Error: unable to leave clan."),
        this.leaveClanButton.enable());
  }
  async onleaveClanCancelButtonReleased() {
    this.leaveClanContainer.parent && this.displayContainer.removeChild(this.leaveClanContainer);
    this.leaveClanButton.enable();
    this.leaveClanErrorText.text = "";
  }
  maskMemberList(a) {
    let b = Math.floor(MemberListScrollbar.ListHeight / MemberListScrollbar.ItemHeight);
    if (this.members.length <= b) this.memberListContainer.y = 0;
    else {
      this.memberListContainer.removeChildren();
      this.memberListContainer.y = -(
        a *
        (this.members.length * MemberListScrollbar.ItemHeight -
          (MemberListScrollbar.ListHeight - MemberListScrollbar.ItemHeight))
      );
      a = this.memberListContainer.y;
      var c = Math.round(Math.abs(a / MemberListScrollbar.ItemHeight));
      for (let e = 0; e < b; e++) {
        let f = this.members[c + e];
        this.memberListContainer.addChild(f);
        if (0 === e) {
          var d = c * MemberListScrollbar.ItemHeight + a;
          f.alpha = 0 <= d ? 1 : 1 - (1 / (0.5 * MemberListScrollbar.ItemHeight)) * Math.abs(d);
        } else
          e === b - 1
            ? ((d = c * MemberListScrollbar.ItemHeight + a),
              (f.alpha =
                0 > d ? 1 : 1 - (1 / (0.5 * MemberListScrollbar.ItemHeight)) * Math.abs(d)))
            : (f.alpha = 1);
      }
    }
  }
  async promoteMember(a) {
    this.memberDropdown.parent && this.container.removeChild(this.memberDropdown);
    await APIClient.postPromoteMember(a, App.Credential.id);
    (a = await APIClient.getClanByAccountId(App.Credential.playerid)) &&
      this.displayOverview(a.clan);
  }
  async demoteMember(a) {
    this.memberDropdown.parent && this.container.removeChild(this.memberDropdown);
    await APIClient.postDemoteMember(a, App.Credential.id);
    (a = await APIClient.getClanByAccountId(App.Credential.playerid)) &&
      this.displayOverview(a.clan);
  }
  async removeMember(a) {
    this.memberDropdown.parent && this.container.removeChild(this.memberDropdown);
    await APIClient.postRemoveMember(a, App.Credential.id);
    (a = await APIClient.getClanByAccountId(App.Credential.playerid)) &&
      this.displayOverview(a.clan);
  }
}
ClanTab.SHOW_DROPDOWN = "showDropdown";
ClanTab.ACCESS_PROFILE = "accessProfile";
class MemberListScrollbar extends PIXI.Container {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.bh = this.h - 39;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, this.h, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-10, -2, 50, this.h + 30);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, -3, 16, 35, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = this.bh * this.start;
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.scrollBar.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (c) => {
      this.scroll(c);
    });
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (c) => {
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
      this.scroll(c);
    });
    this.scrollBar.on("pointermove", (c) => this.scroll(c));
  }
  scroll(a) {
    if (this.scrolling) {
      a = a.data.global.y / App.Scale;
      let b = this.scrollButton.y + (a - this.oy);
      b = 0 > b ? 0 : b > this.bh ? this.bh : b;
      let c = (1 / this.h) * b * (this.h / this.bh);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(MemberListScrollbar.SCROLL, c);
    }
  }
  reset() {
    this.scrollButton.y = (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
MemberListScrollbar.SCROLL = "scroll";
MemberListScrollbar.ListHeight = 208;
MemberListScrollbar.ItemHeight = 30;
class MemberItem extends PIXI.Container {
  constructor(a, b, c, d) {
    super();
    this.id = a;
    this.name = b;
    this.role = c;
    this.options = d;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.2);
    this.background.drawRoundedRect(0, 0, 276, 26, 4);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.alpha = 0.5;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0.5;
    });
    this.background.on("mousedown", () => this.emit(ClanTab.ACCESS_PROFILE, this.id));
    this.background.on("rightdown", () => this.emit(ClanTab.SHOW_DROPDOWN, this.options));
    this.addChild(this.background);
    this.nameLabel = new PIXI.BitmapText(this.name, {
      fontName: "Open Sans",
      fontSize: 22,
      align: "left",
    });
    this.nameLabel.x = 8;
    this.nameLabel.y = 2;
    this.nameLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.nameLabel);
    if ("captain" === this.role || "leader" === this.role)
      (this.roleLabel = new PIXI.BitmapText(this.role, {
        fontName: "Open Sans",
        fontSize: 22,
        align: "left",
      })),
        (this.roleLabel.x = 270 - this.roleLabel.width),
        (this.roleLabel.y = 2),
        (this.roleLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0)),
        (this.roleLabel.tint = "leader" === this.role ? 8978312 : 16746632),
        this.addChild(this.roleLabel);
  }
}
class MemberDropdown extends PIXI.Container {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.addChild(this.background);
    this.itemContainer = new PIXI.Graphics();
    this.addChild(this.itemContainer);
  }
  display(a, b) {
    this.background.clear();
    this.itemContainer.removeChildren();
    let c = 0;
    for (let d in a) {
      let e = new MemberDropdownActionRow(a[d], d, 16777215);
      e.on(d, () => this.emit(d, b));
      e.x = 10;
      e.y = 6 + 30 * c;
      this.itemContainer.addChild(e);
      c++;
    }
    this.background.lineStyle(1, 16777215, 0.4, 0);
    this.background.beginFill(5592405, 0.9);
    this.background.drawRoundedRect(0, 0, 110, 2 + 30 * c, 4);
    this.background.endFill();
  }
}
MemberDropdown.ACTION_PROMOTE = "promote";
MemberDropdown.ACTION_DEMOTE = "demote";
MemberDropdown.ACTION_REMOVE = "remove";
class MemberDropdownActionRow extends PIXI.Container {
  constructor(a, b, c, d = !0) {
    super();
    this.text = a;
    this.tintValue = c;
    switch (b) {
      case MemberDropdown.ACTION_PROMOTE:
        this.tintValue = 65280;
        break;
      case MemberDropdown.ACTION_DEMOTE:
        this.tintValue = 16776960;
        break;
      case MemberDropdown.ACTION_REMOVE:
        this.tintValue = 16711680;
    }
    this.actionText = new PIXI.Text(this.text, {
      fontName: "Arial",
      fontSize: 17,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.confirmation = d;
    this.confirming = !1;
    this.interactive = !0;
    this.hitArea = new PIXI.Rectangle(0, 0, 100, 30);
    this.actionText.tint = this.tintValue;
    this.actionText.alpha = 0.7;
    this.on("mouseover", () => {
      this.actionText.alpha = 1;
    });
    this.on("mouseout", () => {
      this.actionText.alpha = 0.7;
      this.confirmation &&
        ((this.confirming = !1),
        (this.actionText.text = this.text),
        (this.actionText.tint = this.tintValue));
    });
    this.on("mousedown", () => {
      this.confirmation
        ? this.confirming
          ? (this.emit(b), (this.actionText.tint = this.tintValue))
          : ((this.actionText.text = "Confirm?"),
            (this.actionText.tint = 16746496),
            (this.confirming = !0))
        : (this.emit(b), (this.actionText.tint = this.tintValue));
    });
    this.addChild(this.actionText);
  }
}
MemberDropdownActionRow.CONFIRM = "confirm";
MemberDropdownActionRow.SELECT = "select";
var settingstab = {};
class SettingsTab extends Feature {
  constructor(a, b) {
    super();
    this.settings = { allow_invite: !1 };
    this.w = a;
    this.h = b;
    this.ox = 20;
    this.oy = 126;
    this.initialized = !1;
    this.background = new PIXI.Graphics();
    this.background.x = this.ox - 6;
    this.background.y = this.oy + 4;
    this.background.beginFill(6710886, 0.3);
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.drawRoundedRect(0, 0, 632, 300, 8);
    this.background.endFill();
    this.container.addChild(this.background);
    this.settingsTitle = new PIXI.Text("Social preferences", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.settingsTitle.x = this.ox - 4;
    this.settingsTitle.y = 100;
    this.settingsTitle.tint = 16763904;
    this.addChild(this.settingsTitle);
    this.allowInviteCheck = new Checkbox(
      "allowInvite",
      "Allow friend invitations",
      this.settings.allow_invite
    );
    this.allowInviteCheck.x = this.ox + 20;
    this.allowInviteCheck.y = this.oy + 40;
    this.allowInviteCheck.on(Checkbox.CHANGE, (c) => (this.settings.allow_invite = c));
    this.container.addChild(this.allowInviteCheck);
    this.allowInviteCheck.setChecked(this.settings.allow_invite);
    this.applyButton = new Button("save");
    this.applyButton.x = this.ox + 20;
    this.applyButton.y = this.background.height - 46;
    this.applyButton.setText("Save preferences");
    this.applyButton.scale.x = this.applyButton.scale.y = 0.8;
    this.applyButton.addListener(Button.BUTTON_RELEASED, this.onApplyButtonReleased.bind(this));
    this.applyButton.setTint(16763904);
    this.container.addChild(this.applyButton);
  }
  async onApplyButtonReleased() {
    this.applyButton.disable();
    await APIClient.postSettings(this.settings, App.Credential.id);
    this.applyButton.enable();
  }
  async load() {
    if (!this.initialized) {
      var a = await APIClient.getSettings(App.Credential.id);
      a.success &&
        ((this.initialized = !0),
        (this.settings = a.settings),
        this.allowInviteCheck.setChecked(this.settings.allow_invite));
    }
  }
}
var profilemenu = {};
class ProfileMenu extends Feature {
  constructor() {
    super();
    this.tab = null;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 1);
    this.background.drawRect(0, 0, 660, 524, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504, 10);
    this.background.endFill();
    this.background.lineStyle(2, 16777215, 0.1);
    this.background.moveTo(10, 59);
    this.background.lineTo(650, 59);
    this.container.addChild(this.background);
    this.ox = 0;
    this.oy = 40;
    this.overviewTabButton = new PIXI.Graphics();
    this.overviewTabButton.beginFill(13421772, 0.2);
    this.overviewTabButton.drawRoundedRect(0, 0, 96, 40, 8);
    this.overviewTabButton.endFill();
    this.overviewTabButton.interactive = !0;
    this.overviewTabButton.x = this.ox + 14;
    this.overviewTabButton.y = this.oy + 14;
    this.overviewTabButton.on("mousedown", () => this.openTab(ProfileMenu.TAB_OVERVIEW));
    this.overviewTabButton.on("touchstart", () => this.openTab(ProfileMenu.TAB_OVERVIEW));
    this.container.addChild(this.overviewTabButton);
    this.overviewTabTitle = new PIXI.Text("Overview", {
      fontName: "Open Sans",
      fontSize: 20,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.overviewTabTitle.scale.x = this.overviewTabTitle.scale.y = 0.9;
    this.overviewTabTitle.anchor.x = this.overviewTabTitle.anchor.y = 0.5;
    this.overviewTabTitle.x = this.overviewTabButton.x + 0.5 * this.overviewTabButton.width;
    this.overviewTabTitle.y = this.overviewTabButton.y + 20;
    this.overviewTabTitle.interactive = !0;
    this.overviewTabTitle.resolution = 1.5;
    this.overviewTabTitle.on("mouseover", () => {
      this.overviewTabTitle.scale.x = this.overviewTabTitle.scale.y = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.overviewTabTitle.on(
      "mouseout",
      () => (this.overviewTabTitle.scale.x = this.overviewTabTitle.scale.y = 0.9)
    );
    this.overviewTabButton.on(
      "mouseover",
      () => (this.overviewTabTitle.scale.x = this.overviewTabTitle.scale.y = 1)
    );
    this.overviewTabButton.on(
      "mouseout",
      () => (this.overviewTabTitle.scale.x = this.overviewTabTitle.scale.y = 0.9)
    );
    this.overviewTabTitle.on("mousedown", () => this.openTab(ProfileMenu.TAB_OVERVIEW));
    this.overviewTabTitle.on("touchstart", () => this.openTab(ProfileMenu.TAB_OVERVIEW));
    this.container.addChild(this.overviewTabTitle);
    this.clanTabButton = new PIXI.Graphics();
    this.clanTabButton.beginFill(13421772, 0.2);
    this.clanTabButton.drawRoundedRect(0, 0, 96, 40, 8);
    this.clanTabButton.endFill();
    this.clanTabButton.interactive = !0;
    this.clanTabButton.x = this.ox + this.overviewTabButton.x + this.overviewTabButton.width + 4;
    this.clanTabButton.y = this.oy + 14;
    this.clanTabButton.on("mousedown", () => this.openTab(ProfileMenu.TAB_CLAN));
    this.clanTabButton.on("touchstart", () => this.openTab(ProfileMenu.TAB_CLAN));
    this.container.addChild(this.clanTabButton);
    this.clanTabTitle = new PIXI.Text("Clan", {
      fontName: "Open Sans",
      fontSize: 20,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanTabTitle.scale.x = this.clanTabTitle.scale.y = 0.9;
    this.clanTabTitle.anchor.x = this.clanTabTitle.anchor.y = 0.5;
    this.clanTabTitle.x = this.clanTabButton.x + 0.5 * this.clanTabButton.width;
    this.clanTabTitle.y = this.clanTabButton.y + 20;
    this.clanTabTitle.resolution = 1.5;
    this.clanTabTitle.interactive = !0;
    this.clanTabTitle.on("mouseover", () => {
      this.clanTabTitle.scale.x = this.clanTabTitle.scale.y = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.clanTabTitle.on(
      "mouseout",
      () => (this.clanTabTitle.scale.x = this.clanTabTitle.scale.y = 0.9)
    );
    this.clanTabButton.on(
      "mouseover",
      () => (this.clanTabTitle.scale.x = this.clanTabTitle.scale.y = 1)
    );
    this.clanTabButton.on(
      "mouseout",
      () => (this.clanTabTitle.scale.x = this.clanTabTitle.scale.y = 0.9)
    );
    this.clanTabTitle.on("mousedown", () => this.openTab(ProfileMenu.TAB_CLAN));
    this.clanTabTitle.on("touchstart", () => this.openTab(ProfileMenu.TAB_CLAN));
    this.container.addChild(this.clanTabTitle);
    this.accountTabButton = new PIXI.Graphics();
    this.accountTabButton.beginFill(13421772, 0.2);
    this.accountTabButton.drawRoundedRect(0, 0, 96, 40, 8);
    this.accountTabButton.endFill();
    this.accountTabButton.interactive = !0;
    this.accountTabButton.x = this.ox + this.clanTabButton.x + this.clanTabButton.width + 4;
    this.accountTabButton.y = this.oy + 14;
    this.accountTabButton.on("mousedown", () => this.openTab(ProfileMenu.TAB_ACCOUNT));
    this.accountTabButton.on("touchstart", () => this.openTab(ProfileMenu.TAB_ACCOUNT));
    this.container.addChild(this.accountTabButton);
    this.accountTabTitle = new PIXI.Text("Account", {
      fontName: "Open Sans",
      fontSize: 20,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.accountTabTitle.scale.x = this.accountTabTitle.scale.y = 0.9;
    this.accountTabTitle.anchor.x = this.accountTabTitle.anchor.y = 0.5;
    this.accountTabTitle.x = this.accountTabButton.x + 0.5 * this.accountTabButton.width;
    this.accountTabTitle.y = this.accountTabButton.y + 20;
    this.accountTabTitle.interactive = !0;
    this.accountTabTitle.alpha = 0.75;
    this.accountTabTitle.resolution = 1.5;
    this.accountTabTitle.on("mouseover", () => {
      this.accountTabTitle.scale.x = this.accountTabTitle.scale.y = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.accountTabTitle.on(
      "mouseout",
      () => (this.accountTabTitle.scale.x = this.accountTabTitle.scale.y = 0.9)
    );
    this.accountTabTitle.on("mousedown", () => this.openTab(ProfileMenu.TAB_ACCOUNT));
    this.accountTabTitle.on("touchstart", () => this.openTab(ProfileMenu.TAB_ACCOUNT));
    this.accountTabButton.on(
      "mouseover",
      () => (this.accountTabTitle.scale.x = this.accountTabTitle.scale.y = 1)
    );
    this.accountTabButton.on(
      "mouseout",
      () => (this.accountTabTitle.scale.x = this.accountTabTitle.scale.y = 0.9)
    );
    this.container.addChild(this.accountTabTitle);
    this.settingsTabButton = new PIXI.Graphics();
    this.settingsTabButton.beginFill(13421772, 0.2);
    this.settingsTabButton.drawRoundedRect(0, 0, 96, 40, 8);
    this.settingsTabButton.endFill();
    this.settingsTabButton.interactive = !0;
    this.settingsTabButton.x = this.ox + this.accountTabButton.x + this.accountTabButton.width + 4;
    this.settingsTabButton.y = this.oy + 14;
    this.settingsTabButton.on("mousedown", () => this.openTab(ProfileMenu.TAB_SETTINGS));
    this.settingsTabButton.on("touchstart", () => this.openTab(ProfileMenu.TAB_SETTINGS));
    this.container.addChild(this.settingsTabButton);
    this.settingsTabTitle = new PIXI.Text("Settings", {
      fontName: "Open Sans",
      fontSize: 20,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.settingsTabTitle.scale.x = this.settingsTabTitle.scale.y = 0.9;
    this.settingsTabTitle.anchor.x = this.settingsTabTitle.anchor.y = 0.5;
    this.settingsTabTitle.x = this.settingsTabButton.x + 0.5 * this.settingsTabButton.width;
    this.settingsTabTitle.y = this.settingsTabButton.y + 20;
    this.settingsTabTitle.resolution = 1.5;
    this.settingsTabTitle.interactive = !0;
    this.settingsTabTitle.on("mouseover", () => {
      this.settingsTabTitle.scale.x = this.settingsTabTitle.scale.y = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.settingsTabTitle.on(
      "mouseout",
      () => (this.settingsTabTitle.scale.x = this.settingsTabTitle.scale.y = 0.9)
    );
    this.settingsTabButton.on(
      "mouseover",
      () => (this.settingsTabTitle.scale.x = this.settingsTabTitle.scale.y = 1)
    );
    this.settingsTabButton.on(
      "mouseout",
      () => (this.settingsTabTitle.scale.x = this.settingsTabTitle.scale.y = 0.9)
    );
    this.settingsTabTitle.on("mousedown", () => this.openTab(ProfileMenu.TAB_SETTINGS));
    this.settingsTabTitle.on("touchstart", () => this.openTab(ProfileMenu.TAB_SETTINGS));
    this.container.addChild(this.settingsTabTitle);
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy + 14;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.PROFILE_CANCEL));
    this.container.addChild(this.closeButton);
    this.container.x = 0.5 * -this.width;
    this.overviewTab = new OverviewTab(this.width, this.height);
    this.accountTab = new AccountTab(this.width, this.height);
    this.accountTab.on(Layer.Events.LOGOUT, () => this.emit(Layer.Events.LOGOUT));
    this.accountTab.on(Layer.Events.PROFILE_RENAME, (a) =>
      this.emit(Layer.Events.PROFILE_RENAME, a)
    );
    this.incompleteAccountTab = new IncompleteAccountTab(this.width, this.height);
    this.incompleteAccountTab.on(Layer.Events.RENAME_ACCESS, () =>
      this.emit(Layer.Events.RENAME_ACCESS)
    );
    this.clanTab = new ClanTab(this.width, this.height);
    this.clanTab.on(Layer.Events.USER_ACCESS, (a) => this.emit(Layer.Events.USER_ACCESS, a));
    this.clanTab.on(Layer.Events.LEAVE_CLAN, (a) => this.emit(Layer.Events.LEAVE_CLAN, a));
    this.clanTab.on(Layer.Events.CREATE_CLAN, (a) => this.emit(Layer.Events.CREATE_CLAN, a));
    this.settingsTab = new SettingsTab();
  }
  openTab(a, b = !0) {
    b && AudioEffects.ButtonClick.audio.play();
    this.tab = a;
    switch (a) {
      case ProfileMenu.TAB_ACCOUNT:
        this.accountTabTitle.alpha = 1;
        this.accountTabButton.alpha = 0.3;
        App.Autogen
          ? (this.accountTab.parent && this.container.removeChild(this.accountTab),
            this.container.addChild(this.incompleteAccountTab))
          : (this.incompleteAccountTab.parent &&
              this.container.removeChild(this.incompleteAccountTab),
            this.container.addChild(this.accountTab),
            this.accountTab.load());
        this.overviewTabTitle.alpha = 0.75;
        this.overviewTabButton.alpha = 1;
        this.overviewTab.parent && this.container.removeChild(this.overviewTab);
        this.clanTabTitle.alpha = 0.75;
        this.clanTabButton.alpha = 1;
        this.clanTab.parent && this.container.removeChild(this.clanTab);
        this.settingsTabTitle.alpha = 0.75;
        this.settingsTabButton.alpha = 1;
        this.settingsTab.parent && this.container.removeChild(this.settingsTab);
        break;
      case ProfileMenu.TAB_CLAN:
        this.clanTabTitle.alpha = 1;
        this.clanTabButton.alpha = 0.3;
        this.container.addChild(this.clanTab);
        this.clanTab.load();
        this.overviewTabTitle.alpha = 0.75;
        this.overviewTabButton.alpha = 1;
        this.overviewTab.parent && this.container.removeChild(this.overviewTab);
        this.accountTabTitle.alpha = 0.75;
        this.accountTabButton.alpha = 1;
        this.accountTab.parent && this.container.removeChild(this.accountTab);
        this.incompleteAccountTab.parent && this.container.removeChild(this.incompleteAccountTab);
        this.settingsTabTitle.alpha = 0.75;
        this.settingsTabButton.alpha = 1;
        this.settingsTab.parent && this.container.removeChild(this.settingsTab);
        break;
      case ProfileMenu.TAB_OVERVIEW:
        this.overviewTabTitle.alpha = 1;
        this.overviewTabButton.alpha = 0.3;
        this.container.addChild(this.overviewTab);
        this.overviewTab.load();
        this.accountTabTitle.alpha = 0.75;
        this.accountTabButton.alpha = 1;
        this.accountTab.parent && this.container.removeChild(this.accountTab);
        this.clanTabTitle.alpha = 0.75;
        this.clanTabButton.alpha = 1;
        this.clanTab.parent && this.container.removeChild(this.clanTab);
        this.incompleteAccountTab.parent && this.container.removeChild(this.incompleteAccountTab);
        this.settingsTabTitle.alpha = 0.75;
        this.settingsTabButton.alpha = 1;
        this.settingsTab.parent && this.container.removeChild(this.settingsTab);
        break;
      case ProfileMenu.TAB_SETTINGS:
        (this.settingsTabTitle.alpha = 1),
          (this.settingsTabButton.alpha = 0.3),
          this.container.addChild(this.settingsTab),
          this.settingsTab.load(),
          (this.overviewTabTitle.alpha = 0.75),
          (this.overviewTabButton.alpha = 1),
          this.overviewTab.parent && this.container.removeChild(this.overviewTab),
          (this.accountTabTitle.alpha = 0.75),
          (this.accountTabButton.alpha = 1),
          this.accountTab.parent && this.container.removeChild(this.accountTab),
          (this.clanTabTitle.alpha = 0.75),
          (this.clanTabButton.alpha = 1),
          this.clanTab.parent && this.container.removeChild(this.clanTab),
          this.incompleteAccountTab.parent && this.container.removeChild(this.incompleteAccountTab);
    }
  }
  update() {
    this.tab === ProfileMenu.TAB_OVERVIEW && this.overviewTab.update();
  }
  show() {
    this.openTab(this.tab, !1);
  }
  reset() {}
}
ProfileMenu.TAB_OVERVIEW = "tab_overview";
ProfileMenu.TAB_CLAN = "tab_clan";
ProfileMenu.TAB_ACCOUNT = "tab_account";
ProfileMenu.TAB_SETTINGS = "tab_settings";
var userinput = {},
  UserInput = {
    pressed: {},
    hasFocus: !1,
    setFocus: function (a) {
      this.hasFocus = !0;
      this.onFocus = a;
    },
    releaseFocus: function () {
      this.hasFocus = !1;
      this.onFocus = null;
    },
    emulateKeyDown: function (a) {
      this.dispatchEvent(new CustomEvent(UserInput.KEY_DOWN, a));
    },
    emulateKeyUp: function (a) {
      this.dispatchEvent(new CustomEvent(UserInput.KEY_UP, a));
    },
    onKeyDown: function (a) {
      var b = a.keyCode || a.char,
        c = { char: this.getMappedChar(b, a.shiftKey), code: b, ctrl: a.ctrlKey };
      if (this.onFocus) this.onFocus(new CustomEvent(UserInput.KEY_PRESS, c));
      else
        this.dispatchEvent(new CustomEvent(UserInput.KEY_PRESS, c)),
          this.dispatchEvent(new CustomEvent(UserInput.KEY_DOWN, c));
      this.pressed[b] = !0;
      App.FieldHasFocus || 8 !== a.keyCode || a.preventDefault();
    },
    onKeyUp: function (a) {
      var b = a.keyCode || a.char;
      this.pressed[b] &&
        (this.onFocus ||
          this.dispatchEvent(
            new CustomEvent(UserInput.KEY_UP, { char: this.getMappedChar(b, a.shiftKey), code: b })
          ),
        (this.pressed[b] = !1));
    },
    getMappedChar: function (a, b) {
      8 !== a && 191 !== a && 220 !== a && String.fromCharCode(a);
      return b ? characterMapShift[a] : characterMap[a];
    },
    azertyToQwerty: function (a) {
      var b = azertyMap[a];
      return b ? b : a;
    },
  };
EventDispatcher.call(UserInput);
UserInput.KEY_DOWN = "keyDown";
UserInput.KEY_UP = "keyUp";
UserInput.KEY_PRESS = "keyPress";
UserInput.BACKSPACE = 8;
UserInput.ENTER = 13;
UserInput.NUMERIC = "1234567890";
UserInput.ALPHANUMERIC = "1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
UserInput.ALPHA_EXT =
  "\u00e4\u00e7\u00eb\u00e9\u00e8\u00ef\u00ed\u00ec\u00f6\u00f3\u00f2\u00df\u00fc\u00fa\u00f9\u00fd\u00ff\u00c4\u00c7\u00cb\u00c9\u00c8\u00cf\u00cd\u00cc\u00d6\u00d3\u00d2\u00a7\u00dc\u00da\u00d9\u00dd";
UserInput.CHAT_SYMBOLS = ",|{}[]~'`\"?:\\/()*&^%$#@!=;-! ._<>+";
UserInput.WHEEL = "wheel";
UserInput.ExclusiveWheel = null;
document.addEventListener("keydown", (a) => UserInput.onKeyDown(a));
document.addEventListener("keyup", (a) => UserInput.onKeyUp(a));
window.addEventListener("keydown", (a) => {
  ["ArrowDown", "ArrowUp", " "].includes(a.key) && a.preventDefault();
});
window.addEventListener(
  "wheel",
  (a) => {
    a.preventDefault();
    null !== UserInput.ExclusiveWheel
      ? UserInput.ExclusiveWheel(new CustomEvent(UserInput.WHEEL, { delta: a.deltaY }))
      : UserInput.dispatchEvent(new CustomEvent(UserInput.WHEEL, { delta: a.deltaY }));
  },
  { passive: !1 }
);
var characterMapCTRL = [];
characterMapCTRL[16] = "SHT";
characterMapCTRL[17] = "CTL";
characterMapCTRL[18] = "ALT";
characterMapCTRL[32] = "SPC";
characterMapCTRL[37] = "LFT";
characterMapCTRL[38] = "UP";
characterMapCTRL[39] = "RGT";
characterMapCTRL[40] = "DWN";
var arrowsInv = { LFT: "A", UP: "W", RGT: "D", DWN: "S" },
  azertyMap = [];
azertyMap[91] = 87;
azertyMap[81] = 65;
azertyMap[83] = 83;
azertyMap[68] = 68;
azertyMap[65] = 81;
azertyMap[87] = 90;
var characterMapShift = [];
characterMapShift[8] = "";
characterMapShift[9] = "";
characterMapShift[13] = "\n";
characterMapShift[16] = "";
characterMapShift[17] = "";
characterMapShift[18] = "";
characterMapShift[19] = "";
characterMapShift[20] = "";
characterMapShift[27] = "";
characterMapShift[32] = " ";
characterMapShift[33] = "";
characterMapShift[34] = "";
characterMapShift[35] = "";
characterMapShift[36] = "";
characterMapShift[37] = "";
characterMapShift[38] = "";
characterMapShift[39] = "";
characterMapShift[40] = "";
characterMapShift[45] = "";
characterMapShift[46] = "";
characterMapShift[48] = ")";
characterMapShift[49] = "!";
characterMapShift[50] = "@";
characterMapShift[51] = "#";
characterMapShift[52] = "$";
characterMapShift[53] = "%";
characterMapShift[54] = "^";
characterMapShift[55] = "&";
characterMapShift[56] = "*";
characterMapShift[57] = "(";
characterMapShift[59] = ":";
characterMapShift[61] = "+";
characterMapShift[65] = "A";
characterMapShift[66] = "B";
characterMapShift[67] = "C";
characterMapShift[68] = "D";
characterMapShift[69] = "E";
characterMapShift[70] = "F";
characterMapShift[71] = "G";
characterMapShift[72] = "H";
characterMapShift[73] = "I";
characterMapShift[74] = "J";
characterMapShift[75] = "K";
characterMapShift[76] = "L";
characterMapShift[77] = "M";
characterMapShift[78] = "N";
characterMapShift[79] = "O";
characterMapShift[80] = "P";
characterMapShift[81] = "Q";
characterMapShift[82] = "R";
characterMapShift[83] = "S";
characterMapShift[84] = "T";
characterMapShift[85] = "U";
characterMapShift[86] = "V";
characterMapShift[87] = "W";
characterMapShift[88] = "X";
characterMapShift[89] = "Y";
characterMapShift[90] = "Z";
characterMapShift[91] = "";
characterMapShift[92] = "";
characterMapShift[93] = "";
characterMapShift[96] = "0";
characterMapShift[97] = "1";
characterMapShift[98] = "2";
characterMapShift[99] = "3";
characterMapShift[100] = "4";
characterMapShift[101] = "5";
characterMapShift[102] = "6";
characterMapShift[103] = "7";
characterMapShift[104] = "8";
characterMapShift[105] = "9";
characterMapShift[106] = "*";
characterMapShift[107] = "+";
characterMapShift[109] = "_";
characterMapShift[107] = "+";
characterMapShift[111] = "/";
characterMapShift[112] = "";
characterMapShift[113] = "";
characterMapShift[114] = "";
characterMapShift[115] = "";
characterMapShift[116] = "";
characterMapShift[117] = "";
characterMapShift[118] = "";
characterMapShift[119] = "";
characterMapShift[120] = "";
characterMapShift[121] = "";
characterMapShift[122] = "";
characterMapShift[123] = "";
characterMapShift[144] = "";
characterMapShift[145] = "";
characterMapShift[186] = ":";
characterMapShift[187] = "+";
characterMapShift[188] = "<";
characterMapShift[189] = "_";
characterMapShift[190] = ">";
characterMapShift[191] = "?";
characterMapShift[192] = "~";
characterMapShift[219] = "{";
characterMapShift[220] = "|";
characterMapShift[221] = "}";
characterMapShift[222] = '"';
var characterMap = [];
characterMap[8] = "";
characterMap[9] = "";
characterMap[13] = "\n";
characterMap[16] = "";
characterMap[17] = "";
characterMap[18] = "";
characterMap[19] = "";
characterMap[20] = "";
characterMap[27] = "";
characterMap[32] = " ";
characterMap[33] = "";
characterMap[34] = "";
characterMap[35] = "";
characterMap[36] = "";
characterMap[37] = "";
characterMap[38] = "";
characterMap[39] = "";
characterMap[40] = "";
characterMap[45] = "";
characterMap[46] = "";
characterMap[48] = "0";
characterMap[49] = "1";
characterMap[50] = "2";
characterMap[51] = "3";
characterMap[52] = "4";
characterMap[53] = "5";
characterMap[54] = "6";
characterMap[55] = "7";
characterMap[56] = "8";
characterMap[57] = "9";
characterMap[59] = ";";
characterMap[61] = "=";
characterMap[65] = "a";
characterMap[66] = "b";
characterMap[67] = "c";
characterMap[68] = "d";
characterMap[69] = "e";
characterMap[70] = "f";
characterMap[71] = "g";
characterMap[72] = "h";
characterMap[73] = "i";
characterMap[74] = "j";
characterMap[75] = "k";
characterMap[76] = "l";
characterMap[77] = "m";
characterMap[78] = "n";
characterMap[79] = "o";
characterMap[80] = "p";
characterMap[81] = "q";
characterMap[82] = "r";
characterMap[83] = "s";
characterMap[84] = "t";
characterMap[85] = "u";
characterMap[86] = "v";
characterMap[87] = "w";
characterMap[88] = "x";
characterMap[89] = "y";
characterMap[90] = "z";
characterMap[91] = "";
characterMap[92] = "";
characterMap[93] = "";
characterMap[96] = "0";
characterMap[97] = "1";
characterMap[98] = "2";
characterMap[99] = "3";
characterMap[100] = "4";
characterMap[101] = "5";
characterMap[102] = "6";
characterMap[103] = "7";
characterMap[104] = "8";
characterMap[105] = "9";
characterMap[106] = "*";
characterMap[107] = "+";
characterMap[109] = "_";
characterMap[107] = "+";
characterMap[111] = "/";
characterMap[112] = "";
characterMap[113] = "";
characterMap[114] = "";
characterMap[115] = "";
characterMap[116] = "";
characterMap[117] = "";
characterMap[118] = "";
characterMap[119] = "";
characterMap[120] = "";
characterMap[121] = "";
characterMap[122] = "";
characterMap[123] = "";
characterMap[144] = "";
characterMap[145] = "";
characterMap[186] = ";";
characterMap[187] = "=";
characterMap[188] = ",";
characterMap[189] = "-";
characterMap[190] = ".";
characterMap[191] = "/";
characterMap[192] = "`";
characterMap[219] = "[";
characterMap[220] = "\\";
characterMap[221] = "]";
characterMap[222] = "'";
var itemoverview = {};
class ItemOverview extends PIXI.Container {
  constructor() {
    super();
    this.items = [];
    this.title = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 20,
      lineHeight: 16,
      fill: 16750848,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.title.x = 0;
    this.title.y = 6;
    this.addChild(this.title);
    this.comingSoon = new PIXI.Text("Coming soon..", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.comingSoon.x = 4;
    this.comingSoon.y = 58;
    this.comingSoon.visible = !1;
    this.addChild(this.comingSoon);
    this.background = new PIXI.Graphics();
    this.background.lineStyle(1, 16777215, 0.2, 0);
    this.background.drawRoundedRect(-5, -5, 250, 370, 4);
    this.background.endFill();
    this.background.x = 0;
    this.background.y = 50;
    this.addChild(this.background);
    this.container = new PIXI.Container();
    this.container.x = 0;
    this.container.y = 50;
    this.containerMask = new PIXI.Graphics();
    this.containerMask.beginFill(16777215, 1);
    this.containerMask.drawRoundedRect(0, 0, 240, 360, 4);
    this.containerMask.endFill();
    this.containerMask.x = 0;
    this.containerMask.y = 50;
    this.scrollbar = new IOScrollbar();
    this.scrollbar.x = 248;
    this.scrollbar.y = 50;
    this.addChild(this.scrollbar);
    this.scrollbar.on(IOScrollbar.SCROLL, (a) => {
      this.container.height > this.containerMask.height &&
        (this.container.y = 50 + a * (this.container.height - this.containerMask.height) * -1);
    });
    this.addChild(this.containerMask);
    this.addChild(this.container);
    this.container.mask = this.containerMask;
  }
  show() {
    this.scrollbar.enableWheel();
  }
  hide() {
    this.scrollbar.disableWheel();
  }
  setTitle(a) {
    this.title.text = a;
  }
  select(a) {
    for (let b = 0; b < this.items.length; b++)
      if (this.items[b].data.id === a) {
        this.items[b].select();
        break;
      }
  }
  loadItems(a, b = "", c, d) {
    this.setTitle(b);
    this.container.removeChildren();
    this.container.y = 50;
    this.scrollbar.reset();
    this.comingSoon.visible = 0 === a.length ? !0 : !1;
    for (b = 0; b < a.length; b++) {
      const e = new IOItem(a[b], d);
      e.x = 0;
      e.y = 70 * b;
      this.items.push(e);
      this.container.addChild(e);
      e.on(IOItem.SELECT, (f) => this.onItemSelected(f));
      e.data.id === c && e.select();
    }
  }
  onItemSelected(a) {
    for (let b = 0; b < this.items.length; b++)
      a.id !== this.items[b].data.id && this.items[b].deselect();
    this.emit(ItemOverview.SELECT, a);
  }
}
ItemOverview.SELECT = "select";
class IOScrollbar extends PIXI.Container {
  constructor() {
    super();
    this.scrolling = !1;
    this.h = 370;
    this.bh = this.h - 39;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, 370, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-10, -20, 50, 400);
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (a) => {
      this.scrolling = !0;
      this.oy = a.data.global.y / App.Scale;
      this.scroll(a.data.global.y / App.Scale);
    });
    this.scrollBar.on("mouseup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (a) => this.scroll(a.data.global.y / App.Scale));
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (a) => {
      this.scrolling = !0;
      this.oy = a.data.global.y / App.Scale;
      this.scroll(a.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointermove", (a) => this.scroll(a.data.global.y / App.Scale));
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, 0, 16, 32, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = -3;
    this.scrollButton.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.wheelListener = (a) => {
      a = a.data.delta;
      this.scrolling = !0;
      this.scroll(this.oy + 0.2 * a);
      this.scrolling = !1;
    };
  }
  enableWheel() {
    UserInput.hasListener(UserInput.WHEEL, this.wheelListener) ||
      UserInput.addListener(UserInput.WHEEL, this.wheelListener);
  }
  disableWheel() {
    UserInput.removeListener(UserInput.WHEEL, this.wheelListener);
  }
  scroll(a) {
    if (this.scrolling) {
      let b = this.scrollButton.y + (a - this.oy);
      b = 0 > b ? 0 : b > this.bh ? this.bh : b;
      let c = (1 / this.h) * b * (this.h / this.bh);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(IOScrollbar.SCROLL, c);
    }
  }
  reset() {
    this.scrollButton.y = -3;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
IOScrollbar.SCROLL = "scroll";
class IOItem extends PIXI.Container {
  constructor(a, b) {
    super();
    this.selected = !1;
    this.data = a;
    this.itemBackground = new PIXI.Graphics();
    this.itemBackground.lineStyle(1, 16777215, 0.4, 0);
    this.itemBackground.beginFill(16777215, 0.2);
    this.itemBackground.drawRoundedRect(0, 0, 240, 64, 4);
    this.itemBackground.endFill();
    this.itemBackground.alpha = 0.5;
    this.itemBackground.x = 0;
    this.itemBackground.y = 0;
    this.itemBackground.interactive = !0;
    this.itemBackground.on("mouseover", () => this.onMouseOver());
    this.itemBackground.on("mouseout", () => this.onMouseOut());
    this.itemBackground.on("mousedown", () => this.select());
    this.itemBackground.on("pointerdown", () => this.select());
    this.addChild(this.itemBackground);
    var c = a.texture;
    b && 0 < b.length && (c = b + (0 < a.texture.length ? "_" : "") + c);
    b = new PIXI.Sprite(App.CombinedTextures[c]);
    this.timeout = !1;
    c = JSON.parse(a.data);
    let d = 1;
    d = b.height > b.width ? (68 < b.height ? 68 / b.height : 1) : 68 < b.width ? 68 / b.width : 1;
    b.scale.x = d;
    b.scale.y = d;
    b.x = 4;
    b.y = 0.5 * (70 - b.height) - 2;
    this.addChild(b);
    void 0 !== c.tint && (b.tint = parseInt(c.tint, 16));
    c = new PIXI.Text(a.title, {
      fontName: "Arial",
      fontSize: 15,
      lineHeight: 16,
      fill: 16777215,
      wordWrap: !0,
      wordWrapWidth: 100,
      strokeThickness: 2,
      lineJoin: "round",
    });
    c.x = 72 + (0 < b.width - 68 ? b.width - 68 : 0);
    c.y = 24;
    c.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(c);
    a = "free" === a.status ? "Free" : a.own ? "Owned" : numberWithPeriods(a.price);
    a = new PIXI.Text(a, {
      fontName: "Arial",
      fontSize: 15,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    a.x = 180;
    a.y = 26;
    a.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(a);
  }
  onMouseOver() {
    this.itemBackground.alpha = 1;
    AudioEffects.ButtonHover.audio.play();
  }
  onMouseOut() {
    this.selected || (this.itemBackground.alpha = 0.5);
  }
  select() {
    this.timeout ||
      ((this.timeout = !0),
      setTimeout(() => (this.timeout = !1), 100),
      (this.selected = !0),
      (this.itemBackground.tint = 7864183),
      (this.itemBackground.alpha = 1),
      this.emit(IOItem.SELECT, this.data),
      AudioEffects.ButtonClick.audio.play());
  }
  deselect() {
    this.selected = !1;
    this.itemBackground.tint = 16777215;
    this.itemBackground.alpha = 0.5;
  }
  drawBackground(a, b) {}
}
IOItem.SELECT = "item_select";
var itempicker = {};
class ItemPicker extends PIXI.Container {
  constructor(a, b, c, d) {
    super();
    this.title = a;
    this.type = b;
    this.data = null;
    this.itemTint = 16777215;
    this.prefix = c;
    this.callback = d;
    this.selected = this.timeout = !1;
    this.interactive = this.interactive = this.owned = !0;
    this.hitArea = new PIXI.Rectangle(0, 0, 64, 64);
    this.on("mousedown", () => {
      this.timeout ||
        (this.callback(),
        this.emit(ItemPicker.SELECT, this.type),
        AudioEffects.ButtonClick.audio.play(),
        (this.timeout = !0),
        setTimeout(() => (this.timeout = !1), 100));
    });
    this.on("pointerdown", () => {
      this.timeout ||
        (this.callback(),
        this.emit(ItemPicker.SELECT, this.type),
        AudioEffects.ButtonClick.audio.play(),
        (this.timeout = !0),
        setTimeout(() => (this.timeout = !1), 100));
    });
    this.on("mouseover", () => {
      this.background.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.on("mouseout", () => {
      this.background.alpha = 0.5;
    });
    this.background = new PIXI.Graphics();
    this.draw();
    this.addChild(this.background);
    this.icon = new PIXI.Sprite();
  }
  select() {
    this.selected = !0;
    this.draw();
  }
  deselect() {
    this.selected = !1;
    this.draw();
    this.background.tint = this.owned ? 16777215 : 16711680;
  }
  draw() {
    this.background.clear();
    this.background.alpha = 0.5;
    this.selected || !this.owned
      ? (this.background.lineStyle(3, 16777215, 1, 0), this.background.beginFill(16777215, 0.4))
      : (this.background.lineStyle(1, 16777215, 0.4, 0), this.background.beginFill(16777215, 0.2));
    this.background.drawRoundedRect(0, 0, 64, 64, 4);
    this.background.endFill();
  }
  displayItem(a, b = !0) {
    this.owned = b || a.own;
    this.background.tint = this.owned ? 16777215 : 16763904;
    this.icon.parent && this.removeChild(this.icon);
    b = a.texture;
    this.prefix &&
      0 < this.prefix.length &&
      (b = this.prefix + (0 < a.texture.length ? "_" : "") + b);
    this.icon = new PIXI.Sprite(App.CombinedTextures[b]);
    this.icon.tint = this.itemTint;
    this.icon.anchor.x = this.icon.anchor.y = 0.5;
    this.icon.x = 32;
    this.icon.y = 32;
    this.data = a;
    a =
      void 0 !== this.data.cdata
        ? this.data.cdata
        : "string" === typeof this.data.data
        ? JSON.parse(this.data.data)
        : this.data.data;
    void 0 !== a &&
      (void 0 !== a.r && (this.icon.rotation = a.r),
      void 0 !== a.h && (this.icon.scale.x = this.icon.scale.y = a.h / this.icon.height),
      void 0 !== a.tint && (this.icon.tint = parseInt(a.tint, 16)));
    64 < this.icon.width &&
      64 < this.icon.height &&
      (this.icon.scale.x = this.icon.scale.y = (1 / this.icon.height) * 54);
    "orb" === this.type && (this.icon.tint = this.itemTint);
    this.addChild(this.icon);
  }
  setTint(a) {
    this.itemTint = a;
    this.icon.tint = a;
  }
}
ItemPicker.SELECT = "select";
var colorpicker = {};
class ColorPicker extends PIXI.Container {
  constructor(a) {
    super();
    EventDispatcher.call(this);
    this.size = a;
    this.barColors = [];
    this.sliceColors = [];
    this.dragSlice = this.dragBar = !1;
    this.barWidth = Math.floor(this.size / 10);
    this.texSlice = this.texBar = null;
    this.barPointer = new PIXI.Graphics();
    this.barPointer.lineStyle(1, 8947848, 1, 0.5, !0);
    this.barPointer.drawRect(0, -3, this.barWidth, 8);
    this.barPointer.lineStyle(1, 15658734, 1, 0.5, !0);
    this.barPointer.drawRect(-1, -4, this.barWidth, 8);
    this.background = new PIXI.Graphics();
    this.background.beginFill(0, 1e-4);
    this.background.drawRect(-100, -100, this.size + 100, this.size + 100);
    this.background.endFill();
    this.background.interactive = !0;
    this.addChild(this.background);
    this.colorPointer = new PIXI.Graphics();
    this.colorPointer.lineStyle(1, 8947848, 1, 0.5, !0);
    this.colorPointer.drawRect(-3, -3, 8, 8);
    this.colorPointer.lineStyle(1, 15658734, 1, 0.5, !0);
    this.colorPointer.drawRect(-4, -4, 8, 8);
    this.colorPointer.x = 0;
    this.colorPointer.y = 0;
    this.colorSlice = this.drawColorSlice(16711680);
    this.colorBar = this.drawColorBar();
    this.colorBar.on("mousedown", (b) => this.onColorBarDown(b));
    this.colorBar.on("mousemove", (b) => this.onColorBarMove(b));
    this.colorBar.on("touchstart", (b) => this.onColorBarDown(b));
    this.colorBar.on("pointermove", (b) => this.onColorBarMove(b));
    this.colorBar.x = this.size + 4;
    this.addChild(this.colorSlice);
    this.addChild(this.colorBar);
    this.colorBar.addChild(this.barPointer);
    this.canvas = null;
    this.interactive = !0;
    this.on("mouseout", () => this.onMouseUp());
    this.on("mouseup", () => this.onMouseUp());
  }
  drawColorSlice(a) {
    this.sliceColors = [];
    if (this.initContext(this.size, this.size)) {
      var b = this.context.createImageData(this.size, this.size),
        c = b.data,
        d = (a & 16711680) >> 16,
        e = (a & 65280) >> 8;
      a &= 255;
      for (var f, g, h, m, n, l = this.size, k = 0; k < this.size; k++)
        for (var p = 0; p < this.size; p++)
          (n = 4 * (k * l + p)),
            (h = 255 - (255 / l) * p),
            (m = l - k),
            (f = h + (d / l) * p),
            (g = h + (e / l) * p),
            (h += (a / l) * p),
            (c[n] = Math.floor((h / l) * m)),
            (c[n + 1] = Math.floor((g / l) * m)),
            (c[n + 2] = Math.floor((f / l) * m)),
            (c[n + 3] = 255),
            this.sliceColors.push((c[n] << 16) | (c[n + 1] << 8) | c[n + 2]);
      this.context.putImageData(b, 0, 0);
      this.texSlice && this.texSlice.destroy();
      this.texSlice = PIXI.Texture.from(this.canvas);
      b = new PIXI.Sprite(this.texSlice);
      b.interactive = !0;
      b.buttonMode = !0;
      b.addChild(this.colorPointer);
      b.on("mousedown", (r) => this.onColorSliceDown(r));
      b.on("mousemove", (r) => this.onColorSliceMove(r));
      b.on("touchstart", (r) => this.onColorSliceDown(r));
      b.on("pointermove", (r) => this.onColorSliceMove(r));
      return b;
    }
  }
  drawColorBar() {
    this.barColors = [];
    if (this.initContext(this.barWidth, this.size)) {
      for (
        var a = this.context.createImageData(this.barWidth, this.size),
          b = a.data,
          c = Math.ceil(this.size / 6),
          d = ColorPicker.COLORS,
          e,
          f,
          g,
          h,
          m,
          n,
          l,
          k = 0;
        k < this.barWidth;
        k++
      )
        for (var p = 0; p < this.size; p++)
          (l = 4 * (p * this.barWidth + k)),
            (n = Math.floor(p / c)),
            (e = (d[n] & 16711680) >> 16),
            (f = (d[n] & 65280) >> 8),
            (g = d[n] & 255),
            (h = (d[(n + 1) % 7] & 16711680) >> 16),
            (m = (d[(n + 1) % 7] & 65280) >> 8),
            (n = d[(n + 1) % 7] & 255),
            (b[l] = g + ((n - g) / c) * (p % c)),
            (b[l + 1] = f + ((m - f) / c) * (p % c)),
            (b[l + 2] = e + ((h - e) / c) * (p % c)),
            (b[l + 3] = 255),
            k || this.barColors.push(0 | (b[l + 2] << 16) | (b[l + 1] << 8) | b[l]);
      this.context.putImageData(a, 0, 0);
      this.texBar && this.texBar.destroy();
      this.texBar = PIXI.Texture.from(this.canvas);
      a = new PIXI.Sprite(this.texBar);
      a.interactive = !0;
      a.buttonMode = !0;
      return a;
    }
  }
  initContext(a, b) {
    this.canvas = document.createElement("canvas");
    this.canvas.width = a;
    this.canvas.height = b;
    this.context = this.canvas.getContext("2d");
    return null !== this.context;
  }
  onColorBarDown(a) {
    const b = this.toGlobal(new PIXI.Point(this.x, this.y));
    a = Clamp(0, this.size - 1, Math.floor(a.data.global.y - (b.y - this.y)));
    this.barPointer.y = a;
    this.updateColorSlice(a);
  }
  onColorBarMove(a) {
    if (this.dragBar) {
      const b = this.toGlobal(new PIXI.Point(this.x, this.y));
      a = Clamp(0, this.size - 1, Math.floor(a.data.global.y - (b.y - this.y)));
      this.barPointer.y = a;
      this.updateColorSlice(a);
    }
  }
  updateColorSlice(a, b) {
    this.dragBar = !0;
    this.colorSlice &&
      (this.colorSlice.removeChild(this.colorPointer), this.removeChild(this.colorSlice));
    this.colorSlice = this.drawColorSlice(a < this.barColors.length ? this.barColors[a] : 16711680);
    this.addChild(this.colorSlice);
    a = this.colorPointer.y * this.size + this.colorPointer.x;
    void 0 === b && this.emit(ColorPicker.COLOR_SELECTED, this.sliceColors[a]);
  }
  onColorSliceDown(a) {
    const b = this.toGlobal(new PIXI.Point(this.x, this.y));
    var c = a.data.global.x - (b.x - this.x);
    a = a.data.global.y - (b.y - this.y);
    this.dragSlice = !0;
    c = Clamp(0, this.size - 1, Math.floor(c));
    a = Clamp(0, this.size - 1, Math.floor(a));
    this.colorPointer.x = c;
    this.colorPointer.y = a;
    this.emit(ColorPicker.COLOR_SELECTED, this.sliceColors[a * this.size + c]);
  }
  onColorSliceMove(a) {
    const b = this.toGlobal(new PIXI.Point(this.x, this.y));
    var c = a.data.global.x - (b.x - this.x);
    a = a.data.global.y - (b.y - this.y);
    this.dragSlice &&
      ((c = Clamp(0, this.size - 1, Math.floor(c))),
      (a = Clamp(0, this.size - 1, Math.floor(a))),
      (this.colorPointer.x = c),
      (this.colorPointer.y = a),
      this.emit(ColorPicker.COLOR_SELECTED, this.sliceColors[a * this.size + c]));
  }
  setSelectedColor(a, b, c) {
    var d = this.size / 255,
      e = Math.max(a, b, c),
      f = Math.min(a, b, c);
    c = e === a ? (f === b ? c : b) : f === a ? (c === e ? b : c) : a;
    f = (255 / (0 === e ? 0.001 : e)) * (e - f) * d;
    d *= 255 - e;
    this.colorPointer.x = 511 < Math.floor(f) ? 511 : Math.floor(f);
    this.colorPointer.y = 511 < Math.floor(d) ? 511 : Math.floor(d);
    d = c / e;
    a = Math.ceil(
      (1 / 6) *
        (a === e
          ? b === c
            ? 2 + d
            : 1 - (d - 1)
          : b === e
          ? a === c
            ? 1 - (d - 3)
            : 4 + d
          : b === c
          ? 1 - (d - 5)
          : d) *
        this.size
    );
    this.barPointer.y = a;
    this.updateColorSlice(a, !1);
  }
  onMouseUp(a) {
    this.dragSlice = this.dragBar = !1;
  }
}
ColorPicker.COLOR_SELECTED = "cpColorSelected";
ColorPicker.COLORS = [16711680, 16711935, 255, 65535, 65280, 16776960, 16711680];
var purchasepanel = {};
class PurchasePanel extends PIXI.Container {
  constructor() {
    super();
    this.container = new PIXI.Container();
    this.w = 330;
    this.h = 220;
    this.activeItem = null;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.beginFill(0, 0.5);
    this.background.drawRect(0, 0, 660, 524, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 0.95);
    this.background.drawRoundedRect(0.5 * (660 - this.w), 0.5 * (524 - this.h), this.w, this.h, 10);
    this.background.endFill();
    this.background.beginFill(4473924, 0.95);
    this.background.drawRoundedRect(
      0.5 * (660 - this.w) + 20,
      0.5 * (524 - this.h) + 36,
      290,
      68,
      6
    );
    this.background.endFill();
    this.background.interactive = !0;
    this.background.hitArea = new PIXI.Rectangle(0, 0, 660, 524);
    this.addChild(this.background);
    this.container.x = 0.5 * (this.background.width - this.w);
    this.container.y = 0.5 * (this.background.height - this.h);
    this.title = new PIXI.Text("Purchase item", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.title.x = 20;
    this.title.y = 50;
    this.container.addChild(this.title);
    this.itemIcon = new PIXI.Sprite();
    this.itemIcon.x = 40;
    this.itemIcon.y = 80;
    this.itemIcon.anchor.x = this.itemIcon.anchor.y = 0.5;
    this.container.addChild(this.itemIcon);
    this.itemName = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.itemName.x = 100;
    this.itemName.y = 82;
    this.container.addChild(this.itemName);
    this.goldIcon = new PIXI.Sprite(App.CombinedTextures.gold1);
    this.goldIcon.x = 96;
    this.goldIcon.y = 106;
    this.goldIcon.scale.x = this.goldIcon.scale.y = 0.5;
    this.container.addChild(this.goldIcon);
    this.itemPrice = new PIXI.Text("0", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.itemPrice.x = 130;
    this.itemPrice.y = 112;
    this.itemPrice.anchor.x = 0;
    this.container.addChild(this.itemPrice);
    this.currentTitle = new PIXI.Text("Current gold:", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.currentTitle.x = 20;
    this.currentTitle.y = 154;
    this.container.addChild(this.currentTitle);
    this.currentGold = new PIXI.Text("0", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.currentGold.x = this.currentTitle.x + this.currentTitle.width + 8;
    this.currentGold.y = this.currentTitle.y;
    this.currentGold.anchor.x = 0;
    this.container.addChild(this.currentGold);
    this.remainingTitle = new PIXI.Text("After purchase:", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.remainingTitle.x = 20;
    this.remainingTitle.y = 180;
    this.container.addChild(this.remainingTitle);
    this.remainingGold = new PIXI.Text("0", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.remainingGold.x = this.remainingTitle.x + this.remainingTitle.width + 8;
    this.remainingGold.y = this.remainingTitle.y;
    this.remainingGold.anchor.x = 0;
    this.container.addChild(this.remainingGold);
    this.purchaseButton = new Button("purchase");
    this.purchaseButton.selected = !0;
    this.purchaseButton.setText("Purchase");
    this.purchaseButton.scale.x = this.purchaseButton.scale.y = 0.8;
    this.purchaseButton.addListener(
      Button.BUTTON_RELEASED,
      this.onPurchaseButtonReleased.bind(this)
    );
    this.purchaseButton.x = 24;
    this.purchaseButton.y = this.h - 8;
    this.purchaseButton.setTint(16763904);
    this.container.addChild(this.purchaseButton);
    this.cancelButton = new Button("cancel");
    this.cancelButton.selected = !0;
    this.cancelButton.setText("Cancel");
    this.cancelButton.scale.x = this.cancelButton.scale.y = 0.8;
    this.cancelButton.addListener(Button.BUTTON_RELEASED, this.onCancelButtonReleased.bind(this));
    this.cancelButton.x = this.w - (this.cancelButton.width + 8);
    this.cancelButton.y = this.h - 8;
    this.container.addChild(this.cancelButton);
    this.addChild(this.container);
    this.successContainer = new PIXI.Graphics();
    this.successContainer.lineStyle(1, 16777215, 0.1, 0);
    this.successContainer.beginFill(3355443, 1);
    this.successContainer.drawRoundedRect(0, 0, this.w, this.h, 10);
    this.successContainer.beginFill(0, 0.3);
    this.successContainer.drawRoundedRect(10, 10, this.w - 20, this.h - 20, 10);
    this.successContainer.endFill();
    this.successContainer.interactive = !0;
    this.successContainer.x = 0.5 * (this.background.width - this.successContainer.width);
    this.successContainer.y = 0.5 * (this.background.height - this.successContainer.height) + 40;
    this.successTitle = new PIXI.Text("Processing transaction..", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
      wordWrap: !0,
      wordWrapWidth: 330,
      align: "center",
    });
    this.successTitle.x = 0.5 * this.successContainer.width;
    this.successTitle.y = 0.5 * this.successContainer.height - 60;
    this.successTitle.anchor.x = 0.5;
    this.successTitle.anchor.y = 0.5;
    this.successContainer.addChild(this.successTitle);
    this.successTitleDesc = new PIXI.Text("...", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
      wordWrap: !0,
      wordWrapWidth: 330,
      align: "center",
    });
    this.successTitleDesc.x = 0.5 * this.successContainer.width;
    this.successTitleDesc.y = this.successTitle.y + 108;
    this.successTitleDesc.anchor.x = 0.5;
    this.successTitleDesc.anchor.y = 0.5;
    this.successContainer.addChild(this.successTitleDesc);
    this.successContainerItemIcon = new PIXI.Sprite();
    this.successContainerItemIcon.x = 0.5 * this.successContainer.width;
    this.successContainerItemIcon.y = this.successTitle.y + 40;
    this.successContainerItemIcon.anchor.x = this.successContainerItemIcon.anchor.y = 0.5;
    this.successContainer.addChild(this.successContainerItemIcon);
  }
  async display(a) {
    this.activeItem = a;
    this.purchaseButton.disable();
    var b = await APIClient.getCurrency(App.Credential.id);
    b || this.emit(PurchasePanel.CANCEL);
    var c =
      0 < a.prefix.length
        ? a.prefix + (0 < a.data.texture.length ? "_" + a.data.texture : "")
        : a.data.texture;
    this.itemIcon.texture = App.CombinedTextures[c];
    this.successContainerItemIcon.texture = App.CombinedTextures[c];
    b = parseInt(b.currency.gold);
    c = b - parseInt(a.data.price, 10);
    0 <= c
      ? (this.purchaseButton.enable(), (this.remainingGold.tint = 16763904))
      : (this.remainingGold.tint = 16711680);
    this.itemName.text = a.data.title;
    this.itemPrice.text = numberWithPeriods(a.data.price);
    this.currentGold.text = numberWithPeriods(b.toString());
    this.remainingGold.text = numberWithPeriods(c.toString());
    a = 64 / this.itemIcon.width;
    this.itemIcon.x = 56;
    this.itemIcon.y = 110;
    this.itemIcon.scale.x = this.itemIcon.scale.y = 1 < a ? 1 : a;
  }
  onCancelButtonReleased() {
    this.emit(PurchasePanel.CANCEL);
  }
  async onPurchaseButtonReleased() {
    this.successTitle.tint = 16777215;
    this.purchaseButton.disable();
    this.addChild(this.successContainer);
    this.successTitle.text = "Processing transaction..";
    this.successTitleDesc.text = "...";
    (await APIClient.postPurchase("customization", this.activeItem.data.id, App.Credential.id))
      .success
      ? ((this.successTitle.tint = 16763904),
        (this.successTitle.text = "Transaction completed."),
        (this.successTitleDesc.text = "The product has been added to your inventory."))
      : ((this.successTitle.tint = 16711680), (this.successTitle.text = "Transaction failed."));
    setTimeout(() => {
      this.successContainer.parent && this.removeChild(this.successContainer);
      this.emit(PurchasePanel.UPDATE);
    }, 4e3);
  }
}
PurchasePanel.CANCEL = "cancel";
PurchasePanel.UPDATE = "update";
var weaponcontainer = {};
class WeaponContainer extends PIXI.Graphics {
  constructor() {
    super();
    this.title = new PIXI.Text("Coming soon..", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.title.x = 30;
    this.title.y = 100;
    this.addChild(this.title);
  }
}
var customizationmenu = {};
class CustomizationMenu extends Feature {
  constructor() {
    super();
    this.initial = !0;
    this.customizationPickers = [];
    this.display = CustomizationMenu.PLAYER;
    this.rewardToken = this.selectedItem = null;
    this.goldAnimation = !1;
    this.ox = 16;
    this.oy = 10;
    this.gold = 0;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(0, 0, 660, 524, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(8, 8, 644, 508, 10);
    this.background.endFill();
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(1118481, 0.3);
    this.background.drawRect(14, 45, 632, 422, 10);
    this.background.endFill();
    this.container.addChild(this.background);
    this.playerContainer = new PIXI.Container();
    this.container.addChild(this.playerContainer);
    this.weaponContainer = new WeaponContainer();
    this.weaponContainer.visible = !1;
    this.container.addChild(this.weaponContainer);
    this.container.x = -330;
    this.savedText = new PIXI.Text("Customization saved.", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 16,
      fill: 52224,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.savedText.x = this.width - 340;
    this.savedText.y = this.height - 4;
    this.playerContainer.addChild(this.savedText);
    this.savedText.visible = !1;
    this.customizationTitle = new PIXI.Text("Shop", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.customizationTitle.x = this.ox + 2;
    this.customizationTitle.y = this.oy + 48;
    this.container.addChild(this.customizationTitle);
    this.errorMessage = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 16,
      fill: 16711680,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.errorMessage.x = this.width - 340;
    this.errorMessage.y = this.height - 4;
    this.playerContainer.addChild(this.errorMessage);
    this.container.x = 0.5 * -this.width;
    this.goldIcon = new PIXI.Sprite(App.CombinedTextures.gold1);
    this.goldIcon.x = 21;
    this.goldIcon.y = this.height - 10;
    this.goldIcon.scale.x = this.goldIcon.scale.y = 0.5;
    this.playerContainer.addChild(this.goldIcon);
    this.goldText = new PIXI.Text("loading...", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.goldText.x = 57;
    this.goldText.y = this.goldIcon.y + 6;
    this.playerContainer.addChild(this.goldText);
    this.goldRewardText = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.goldRewardText.x = this.goldText.x;
    this.goldRewardText.y = this.goldText.y;
    this.playerContainer.addChild(this.goldRewardText);
    this.goldRewardText.visible = !1;
    this.playerCustomizationButton = new PIXI.Graphics();
    this.playerCustomizationButton.beginFill(16777215, 0.2);
    this.playerCustomizationButton.lineStyle(1, 16777215, 0.1, 0);
    this.playerCustomizationButton.drawRect(0, 0, 100, 28, 4);
    this.playerCustomizationButton.endFill();
    this.playerCustomizationButton.x = this.ox + 112;
    this.playerCustomizationButton.y = this.oy + 48;
    this.playerCustomizationButton.tint = 13421772;
    this.playerCustomizationButton.alpha = 1;
    this.playerCustomizationButton.interactive = !0;
    this.playerCustomizationButton.on("mouseover", () => {
      this.playerCustomizationLabel.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.playerCustomizationButton.on("mouseout", () => {
      this.playerCustomizationLabel.alpha = this.display === CustomizationMenu.PLAYER ? 1 : 0.5;
    });
    this.playerCustomizationButton.on("mousedown", () => {
      this.display = CustomizationMenu.PLAYER;
      this.playerContainer.visible = !0;
      this.weaponContainer.visible = !1;
      this.playerCustomizationLabel.alpha = 1;
      this.weaponCustomizationLabel.alpha = 0.5;
      this.playerCustomizationButton.alpha = 1;
      this.weaponCustomizationButton.alpha = 0.5;
      AudioEffects.ButtonClick.audio.play();
    });
    this.container.addChild(this.playerCustomizationButton);
    this.playerCustomizationLabel = new PIXI.Text("Ninja", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16759552,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.playerCustomizationLabel.alpha = 1;
    this.playerCustomizationLabel.x =
      this.playerCustomizationButton.x +
      0.5 * (this.playerCustomizationButton.width - this.playerCustomizationLabel.width);
    this.playerCustomizationLabel.y = this.playerCustomizationButton.y + 2;
    this.playerCustomizationLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.playerCustomizationLabel);
    this.weaponCustomizationButton = new PIXI.Graphics();
    this.weaponCustomizationButton.beginFill(16777215, 0.2);
    this.weaponCustomizationButton.lineStyle(1, 16777215, 0.1, 0);
    this.weaponCustomizationButton.drawRect(0, 0, 100, 28, 4);
    this.weaponCustomizationButton.endFill();
    this.weaponCustomizationButton.x =
      this.playerCustomizationButton.x + this.playerCustomizationButton.width + 8;
    this.weaponCustomizationButton.y = this.oy + 48;
    this.weaponCustomizationButton.tint = 13421772;
    this.weaponCustomizationButton.alpha = 0.5;
    this.weaponCustomizationButton.interactive = !0;
    this.weaponCustomizationButton.on("mouseover", () => {
      this.weaponCustomizationLabel.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.weaponCustomizationButton.on("mouseout", () => {
      this.weaponCustomizationLabel.alpha = this.display === CustomizationMenu.WEAPONS ? 1 : 0.5;
    });
    this.weaponCustomizationButton.on("mousedown", () => {
      this.display = CustomizationMenu.WEAPONS;
      this.playerContainer.visible = !1;
      this.weaponContainer.visible = !0;
      this.playerCustomizationLabel.alpha = 0.5;
      this.weaponCustomizationLabel.alpha = 1;
      this.playerCustomizationButton.alpha = 0.5;
      this.weaponCustomizationButton.alpha = 1;
      AudioEffects.ButtonClick.audio.play();
    });
    this.container.addChild(this.weaponCustomizationButton);
    this.weaponCustomizationLabel = new PIXI.Text("Weapons", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16759552,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.weaponCustomizationLabel.alpha = 0.5;
    this.weaponCustomizationLabel.x =
      this.weaponCustomizationButton.x +
      0.5 * (this.weaponCustomizationButton.width - this.weaponCustomizationLabel.width);
    this.weaponCustomizationLabel.y = this.weaponCustomizationButton.y + 2;
    this.weaponCustomizationLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.weaponCustomizationLabel);
    this.submitButton = new Button("save");
    this.submitButton.selected = !0;
    this.submitButton.setText("Save");
    this.submitButton.scale.x = this.submitButton.scale.y = 0.8;
    this.submitButton.addListener(Button.BUTTON_RELEASED, this.onSubmitButtonReleased.bind(this));
    this.submitButton.x = this.width - (this.submitButton.width + 12);
    this.submitButton.y = this.height - 8;
    this.playerContainer.addChild(this.submitButton);
    this.submitButton.disable();
    this.purchaseButton = new Button("purchase");
    this.purchaseButton.selected = !0;
    this.purchaseButton.setText("Buy");
    this.purchaseButton.scale.x = this.purchaseButton.scale.y = 0.8;
    this.purchaseButton.addListener(
      Button.BUTTON_RELEASED,
      this.onPurchaseButtonReleased.bind(this)
    );
    this.purchaseButton.x = this.width - (this.purchaseButton.width + 84);
    this.purchaseButton.y = this.height - 8;
    this.purchaseButton.setTint(16763904);
    this.playerContainer.addChild(this.purchaseButton);
    this.purchaseButton.disable();
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 36;
    this.closeButton.y = this.oy + 40;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.onCancelButtonReleased());
    this.closeButton.mobileSetup();
    this.container.addChild(this.closeButton);
    this.rewardButton = new PIXI.Sprite(App.CombinedTextures.reward_button);
    this.rewardButton.scale.x = this.rewardButton.scale.y = 0.58;
    this.rewardButton.x = this.ox + 133;
    this.rewardButton.y = this.height - 16;
    this.rewardButton.interactive = !0;
    this.playerContainer.addChild(this.rewardButton);
    this.rewardButton.on("mousedown", () => {
      this.onRewardButtonReleased();
    });
    this.rewardButton.on("mouseover", () => {
      this.rewardButton.texture = App.CombinedTextures.reward_button_down;
    });
    this.rewardButton.on("mouseout", () => {
      this.rewardButton.texture = App.CombinedTextures.reward_button;
    });
    this.errorRewardMessage = new PIXI.Text("Disable AdBlock", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 16,
      fill: 16711680,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.errorRewardMessage.x = this.rewardButton.x;
    this.errorRewardMessage.y = this.rewardButton.y + 14;
    this.errorRewardMessage.visible = !1;
    this.playerContainer.addChild(this.errorRewardMessage);
    this.countdownMessage = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 16,
      fill: 16776960,
      strokeThickness: 4,
      lineJoin: "round",
    });
    this.countdownMessage.x = this.errorRewardMessage.x + 10;
    this.countdownMessage.y = this.errorRewardMessage.y;
    this.countdownMessage.visible = !1;
    this.playerContainer.addChild(this.countdownMessage);
    this.visualizer = new Visualizer(176, 176, !0, !0, !1);
    this.visualizer.x = 0.5 * this.width - 0.5 * this.visualizer.width + 140;
    this.visualizer.y = 0.5 * this.height - 0.5 * this.visualizer.height - 11;
    this.visualizer.interactive = !0;
    this.playerContainer.addChild(this.visualizer);
    this.purchasePanel = new PurchasePanel();
    this.purchasePanel.x = 0.5 * this.width - 0.5 * this.purchasePanel.width;
    this.purchasePanel.y = 0.5 * this.height - 0.5 * this.purchasePanel.height;
    this.purchasePanel.on(PurchasePanel.CANCEL, () => {
      this.playerContainer.removeChild(this.purchasePanel);
      this.purchaseButton.enable();
    });
    this.purchasePanel.on(PurchasePanel.UPDATE, () => {
      this.playerContainer.removeChild(this.purchasePanel);
      this.initial = !0;
      this.customization = null;
      this.show();
      this.onCustomizationSelected(this.selectedItem.data);
    });
    this.itemOverview = new ItemOverview();
    this.itemOverview.x = this.ox + 10;
    this.itemOverview.y = this.oy + 78;
    this.playerContainer.addChild(this.itemOverview);
    this.itemOverview.on(ItemOverview.SELECT, (a) => this.onCustomizationSelected(a));
    this.hairPicker = new ItemPicker("Hair style", "hair", "head_alpha", () =>
      this.itemOverview.loadItems(
        App.Customization.HAIR,
        "Hair style",
        this.activeCustomization.hair ? this.activeCustomization.hair.id : 0,
        "head_alpha"
      )
    );
    this.hairPicker.x = this.visualizer.x + 52;
    this.hairPicker.y = this.visualizer.y - 72;
    this.hairPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.hairPicker);
    this.playerContainer.addChild(this.hairPicker);
    this.beltPicker = new ItemPicker("Belt", "belt", "torsolower", () =>
      this.itemOverview.loadItems(
        App.Customization.BELT,
        "Belt",
        this.activeCustomization.belt ? this.activeCustomization.belt.id : 0,
        "torsolower"
      )
    );
    this.beltPicker.x = this.visualizer.x - 72;
    this.beltPicker.y = this.visualizer.y + 182;
    this.beltPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.beltPicker);
    this.playerContainer.addChild(this.beltPicker);
    this.legLeftUpperPicker = new ItemPicker("Right leg", "legleftupper", "legleftupper", () =>
      this.itemOverview.loadItems(
        App.Customization.LEGLEFTUPPER,
        "Right leg",
        this.activeCustomization.legleftupper ? this.activeCustomization.legleftupper.id : 0,
        "legleftupper"
      )
    );
    this.legLeftUpperPicker.x = this.visualizer.x + 12;
    this.legLeftUpperPicker.y = this.visualizer.y + 182;
    this.legLeftUpperPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.legLeftUpperPicker);
    this.playerContainer.addChild(this.legLeftUpperPicker);
    this.legRightUpperPicker = new ItemPicker("Left leg", "legrightupper", "legrightupper", () =>
      this.itemOverview.loadItems(
        App.Customization.LEGRIGHTUPPER,
        "Left leg",
        this.activeCustomization.legrightupper ? this.activeCustomization.legrightupper.id : 0,
        "legrightupper"
      )
    );
    this.legRightUpperPicker.x = this.visualizer.x + 98;
    this.legRightUpperPicker.y = this.visualizer.y + 182;
    this.legRightUpperPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.legRightUpperPicker);
    this.playerContainer.addChild(this.legRightUpperPicker);
    this.legRightLowerPicker = new ItemPicker("Right foot", "legrightlower", "legrightlower", () =>
      this.itemOverview.loadItems(
        App.Customization.LEGRIGHTLOWER,
        "Right foot",
        this.activeCustomization.legrightlower ? this.activeCustomization.legrightlower.id : 0,
        "legleftlower"
      )
    );
    this.legRightLowerPicker.x = this.visualizer.x + 12;
    this.legRightLowerPicker.y = this.visualizer.y + 263;
    this.legRightLowerPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.legRightLowerPicker);
    this.playerContainer.addChild(this.legRightLowerPicker);
    this.legLeftLowerPicker = new ItemPicker("Left foot", "legleftlower", "legleftlower", () =>
      this.itemOverview.loadItems(
        App.Customization.LEGLEFTLOWER,
        "Left foot",
        this.activeCustomization.legleftlower ? this.activeCustomization.legleftlower.id : 0,
        "legrightlower"
      )
    );
    this.legLeftLowerPicker.x = this.visualizer.x + 98;
    this.legLeftLowerPicker.y = this.visualizer.y + 263;
    this.legLeftLowerPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.legLeftLowerPicker);
    this.playerContainer.addChild(this.legLeftLowerPicker);
    this.torsoPicker = new ItemPicker("Torso", "torso", "torsoupper", () =>
      this.itemOverview.loadItems(
        App.Customization.TORSO,
        "Torso",
        this.activeCustomization.torso ? this.activeCustomization.torso.id : 0,
        "torsoupper"
      )
    );
    this.torsoPicker.x = this.visualizer.x + 132;
    this.torsoPicker.y = this.visualizer.y - 72;
    this.torsoPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.torsoPicker);
    this.playerContainer.addChild(this.torsoPicker);
    this.orbPicker = new ItemPicker("Flight aura", "orb", "energy_shell", () =>
      this.itemOverview.loadItems(
        App.Customization.ORB,
        "Flight aura",
        this.activeCustomization.orb ? this.activeCustomization.orb.id : 0,
        "energy_shell"
      )
    );
    this.orbPicker.x = this.visualizer.x + 182;
    this.orbPicker.y = this.visualizer.y + 182;
    this.orbPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a, !0));
    this.customizationPickers.push(this.orbPicker);
    this.playerContainer.addChild(this.orbPicker);
    this.facePicker = new ItemPicker("Face", "face", "face", () =>
      this.itemOverview.loadItems(
        App.Customization.FACE,
        "Face",
        this.activeCustomization.face ? this.activeCustomization.face.id : 0,
        "face"
      )
    );
    this.facePicker.x = this.visualizer.x - 28;
    this.facePicker.y = this.visualizer.y - 72;
    this.facePicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.facePicker);
    this.playerContainer.addChild(this.facePicker);
    this.armRightUpperPicker = new ItemPicker(
      "Left shoulder",
      "armrightupper",
      "armrightupper",
      () =>
        this.itemOverview.loadItems(
          App.Customization.ARMRIGHTUPPER,
          "Left shoulder",
          this.activeCustomization.armrightupper ? this.activeCustomization.armrightupper.id : 0,
          "armrightupper"
        )
    );
    this.armRightUpperPicker.x = this.visualizer.x + 182;
    this.armRightUpperPicker.y = this.visualizer.y + 15;
    this.armRightUpperPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.armRightUpperPicker);
    this.playerContainer.addChild(this.armRightUpperPicker);
    this.armLeftUpperPicker = new ItemPicker("Right shoulder", "armleftupper", "armleftupper", () =>
      this.itemOverview.loadItems(
        App.Customization.ARMLEFTUPPER,
        "Right shoulder",
        this.activeCustomization.armleftupper ? this.activeCustomization.armleftupper.id : 0,
        "armleftupper"
      )
    );
    this.armLeftUpperPicker.x = this.visualizer.x - 72;
    this.armLeftUpperPicker.y = this.visualizer.y + 15;
    this.armLeftUpperPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.armLeftUpperPicker);
    this.playerContainer.addChild(this.armLeftUpperPicker);
    this.armLeftLowerPicker = new ItemPicker("Right hand", "armleftlower", "armleftlower", () =>
      this.itemOverview.loadItems(
        App.Customization.ARMLEFTLOWER,
        "Right hand",
        this.activeCustomization.armleftlower ? this.activeCustomization.armleftlower.id : 0,
        "armleftlower"
      )
    );
    this.armLeftLowerPicker.x = this.visualizer.x - 72;
    this.armLeftLowerPicker.y = this.visualizer.y + 96;
    this.armLeftLowerPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.armLeftLowerPicker);
    this.playerContainer.addChild(this.armLeftLowerPicker);
    this.armRightLowerPicker = new ItemPicker("Left hand", "armrightlower", "armrightlower", () =>
      this.itemOverview.loadItems(
        App.Customization.ARMRIGHTLOWER,
        "Left hand",
        this.activeCustomization.armrightlower ? this.activeCustomization.armrightlower.id : 0,
        "armrightlower"
      )
    );
    this.armRightLowerPicker.x = this.visualizer.x + 182;
    this.armRightLowerPicker.y = this.visualizer.y + 96;
    this.armRightLowerPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.armRightLowerPicker);
    this.playerContainer.addChild(this.armRightLowerPicker);
    this.extraPicker = new ItemPicker("Extra", "extra", "", () =>
      this.itemOverview.loadItems(
        App.Customization.EXTRA,
        "Extra",
        this.activeCustomization.extra ? this.activeCustomization.extra.id : 0,
        ""
      )
    );
    this.extraPicker.x = this.visualizer.x + 182;
    this.extraPicker.y = this.visualizer.y + 263;
    this.extraPicker.on(ItemPicker.SELECT, (a) => this.onSelectCustomization(a));
    this.customizationPickers.push(this.extraPicker);
    this.playerContainer.addChild(this.extraPicker);
    this.colorPicker = new ColorPicker(178);
    this.colorPicker.x = this.orbPicker.x - 532;
    this.colorPicker.y = this.orbPicker.y - 0;
    this.colorPicker.on(ColorPicker.COLOR_SELECTED, (a) => {
      this.orbPicker.setTint(a);
      if (!this.activeCustomization.orb || Array.isArray(this.activeCustomization.orb.data))
        this.activeCustomization.orb = { id: 32, texture: "energy_shell", data: {} };
      this.activeCustomization.orb.data.energy = "0x" + a.toString(16).padStart(6, "0");
      this.submitButton.enabled || this.submitButton.enable();
      this.visualizer.applyCustomization(this.activeCustomization);
    });
    this.customization = null;
    this.particleContainer = new ParticleContainer();
    this.container.addChild(this.particleContainer);
  }
  async show() {
    this.itemOverview.show();
    this.savedText.visible = !1;
    this.activeCustomization = JSON.parse(JSON.stringify(App.Credential.customization));
    if (this.initial) {
      if (!this.customization) {
        var a = await APIClient.getCustomization(App.Credential.id);
        if (!a) return;
        a = JSON.parse(a);
        a = a.customization;
        for (var b in App.Customization) App.Customization[b] = [];
        for (b = 0; b < a.length; b++) {
          const c = a[b],
            d = App.Customization[c.type.toUpperCase()];
          d && d.push(c);
        }
      }
      this.hairPicker.select();
      this.selectedItem = this.hairPicker;
      this.itemOverview.loadItems(
        App.Customization.HAIR,
        "Hair style",
        App.Credential.customization.hair ? App.Credential.customization.hair.id : null,
        "head_alpha"
      );
    }
    this.activeCustomization.hair
      ? this.hairPicker.displayItem(this.activeCustomization.hair)
      : (this.hairPicker.displayItem({ id: 2, texture: "", data: {} }),
        (this.activeCustomization.hair = { id: 2, texture: "", data: {} }));
    this.activeCustomization.orb
      ? this.orbPicker.displayItem(this.activeCustomization.orb)
      : (this.orbPicker.displayItem({ id: 32, texture: "", data: {} }),
        (this.activeCustomization.orb = { id: 32, texture: "", data: {} }));
    this.activeCustomization.torso
      ? this.torsoPicker.displayItem(this.activeCustomization.torso)
      : (this.torsoPicker.displayItem({ id: 33, texture: "", data: {} }),
        (this.activeCustomization.torso = { id: 33, texture: "", data: {} }));
    this.activeCustomization.belt
      ? this.beltPicker.displayItem(this.activeCustomization.belt)
      : (this.beltPicker.displayItem({ id: 68, texture: "", data: {} }),
        (this.activeCustomization.belt = { id: 68, texture: "", data: {} }));
    this.activeCustomization.face
      ? this.facePicker.displayItem(this.activeCustomization.face)
      : (this.facePicker.displayItem({ id: 45, texture: "", data: {} }),
        (this.activeCustomization.face = { id: 45, texture: "", data: {} }));
    this.activeCustomization.armleftlower
      ? this.armLeftLowerPicker.displayItem(this.activeCustomization.armleftlower)
      : (this.armLeftLowerPicker.displayItem({ id: 52, texture: "", data: {} }),
        (this.activeCustomization.armleftlower = { id: 52, texture: "", data: {} }));
    this.activeCustomization.armrightupper
      ? this.armRightUpperPicker.displayItem(this.activeCustomization.armrightupper)
      : (this.armRightUpperPicker.displayItem({ id: 62, texture: "", data: {} }),
        (this.activeCustomization.armrightupper = { id: 62, texture: "", data: {} }));
    this.activeCustomization.armleftupper
      ? this.armLeftUpperPicker.displayItem(this.activeCustomization.armleftupper)
      : (this.armLeftUpperPicker.displayItem({ id: 60, texture: "", data: {} }),
        (this.activeCustomization.armleftupper = { id: 60, texture: "", data: {} }));
    this.activeCustomization.armrightlower
      ? this.armRightLowerPicker.displayItem(this.activeCustomization.armrightlower)
      : (this.armRightLowerPicker.displayItem({ id: 54, texture: "", data: {} }),
        (this.activeCustomization.armrightlower = { id: 54, texture: "", data: {} }));
    this.activeCustomization.legleftlower
      ? this.legLeftLowerPicker.displayItem(this.activeCustomization.legleftlower)
      : (this.legLeftLowerPicker.displayItem({ id: 58, texture: "", data: {} }),
        (this.activeCustomization.legleftlower = { id: 58, texture: "", data: {} }));
    this.activeCustomization.legrightlower
      ? this.legRightLowerPicker.displayItem(this.activeCustomization.legrightlower)
      : (this.legRightLowerPicker.displayItem({ id: 56, texture: "", data: {} }),
        (this.activeCustomization.legrightlower = { id: 56, texture: "", data: {} }));
    this.activeCustomization.legleftupper
      ? this.legLeftUpperPicker.displayItem(this.activeCustomization.legleftupper)
      : (this.legLeftUpperPicker.displayItem({ id: 64, texture: "", data: {} }),
        (this.activeCustomization.legleftupper = { id: 64, texture: "", data: {} }));
    this.activeCustomization.legrightupper
      ? this.legRightUpperPicker.displayItem(this.activeCustomization.legrightupper)
      : (this.legRightUpperPicker.displayItem({ id: 66, texture: "", data: {} }),
        (this.activeCustomization.legrightupper = { id: 66, texture: "", data: {} }));
    this.activeCustomization.extra
      ? this.extraPicker.displayItem(this.activeCustomization.extra)
      : (this.extraPicker.displayItem({ id: 211, texture: "", data: {} }),
        (this.activeCustomization.extra = { id: 211, texture: "", data: {} }));
    this.initial = !1;
    this.visualizer.applyCustomization(this.activeCustomization);
    App.Credential.customization.orb &&
      this.orbPicker.setTint(parseInt(App.Credential.customization.orb.data.energy, 16));
    this.selectedItem && this.selectedItem.data
      ? (this.selectedItem.select(),
        this.itemOverview.select(this.activeCustomization[this.selectedItem.data.type]))
      : (this.selectedItem.select(),
        this.activeCustomization.hair &&
          this.itemOverview.select(this.activeCustomization.hair.id));
    a = await APIClient.getCurrency(App.Credential.id);
    b = a.currency.gold.toString();
    this.gold = parseInt(a.currency.gold);
    this.goldText.text = numberWithPeriods(b);
  }
  hide() {
    this.itemOverview.hide();
  }
  onSelectCustomization(a, b = !1) {
    var c = !1;
    this.colorPicker.parent && (this.removeChild(this.colorPicker), (c = !0));
    b && !c && (this.colorPicker.parent || this.addChild(this.colorPicker));
    for (b = 0; b < this.customizationPickers.length; b++)
      (c = this.customizationPickers[b]),
        a !== c.type ? c.deselect() : (c.select(), (this.selectedItem = c));
  }
  onCustomizationSelected(a) {
    a.own || "free" === a.status
      ? this.submitButton.enabled || (this.submitButton.enable(), this.purchaseButton.disable())
      : (this.submitButton.disable(), this.purchaseButton.enable());
    for (const b of this.customizationPickers) b.type === a.type && b.displayItem(a, !1);
    this.activeCustomization[a.type] || (this.activeCustomization[a.type] = { data: {} });
    this.activeCustomization[a.type].texture = a.texture;
    this.activeCustomization[a.type].id = a.id;
    this.activeCustomization[a.type].cdata =
      "string" === typeof a.data ? JSON.parse(a.data) : a.data;
    this.visualizer.applyCustomization(this.activeCustomization);
  }
  displayPurchasePopup(a) {
    this.purchasePanel.parent || this.playerContainer.addChild(this.purchasePanel);
    this.purchasePanel.display(a);
  }
  reset() {
    this.initial = !0;
  }
  validateForm() {
    return { valid: !0, error: "" };
  }
  async onSubmitButtonReleased() {
    this.savedText.visible = !1;
    this.validateForm();
    this.submitButton.disable();
    this.displayErrorMessage("");
    let a = await APIClient.postCustomization(this.activeCustomization, App.Credential.id);
    a.success
      ? (this.emit(Layer.Events.UPDATE_CREDENTIAL, a.credential), (this.savedText.visible = !0))
      : (this.submitButton.enable(), this.displayErrorMessage("Invalid customization."));
  }
  onPurchaseButtonReleased() {
    this.colorPicker.parent && this.removeChild(this.colorPicker);
    this.purchaseButton.disable();
    this.displayPurchasePopup(this.selectedItem);
  }
  displayLoadingMessage() {}
  displayCompletedMessage() {}
  onCompletedButtonReleased() {}
  onCancelButtonReleased() {
    this.emit(Layer.Events.CUSTOMIZATION_CANCEL);
  }
  onRewardButtonReleased() {
    this.triggerRewardedBreak();
  }
  disableRewardButton() {
    this.rewardButton.interactive = !1;
    this.rewardButton.alpha = 0.5;
  }
  enableRewardButton() {
    this.rewardButton.interactive = !0;
    this.rewardButton.alpha = 1;
  }
  displayLimitReached() {
    this.rewardButton.alpha = 0.2;
    this.rewardButton.interactive = !1;
    this.countdownMessage.visible = !0;
    this.countdownMessage.text = "Daily limit reached.";
  }
  displayRewardCountdown() {
    this.rewardButton.alpha = 0.2;
    this.rewardButton.interactive = !1;
    this.countdownMessage.visible = !0;
    let a = 59;
    this.countdownMessage.text = "Next in.. 60";
    null !== this.rewardInterval &&
      (clearInterval(this.rewardInterval), (this.rewardInterval = null));
    this.rewardInterval = setInterval(() => {
      this.countdownMessage.text = "Next in.. " + a.toString();
      0 >= a &&
        (clearInterval(this.rewardInterval),
        (this.rewardInterval = null),
        (this.countdownMessage.visible = !1),
        (this.countdownMessage.text = ""),
        this.enableRewardButton());
      a--;
    }, 1e3);
  }
  triggerRewardedBreak() {
    this.disableRewardButton();
    switch (App.WhiteLabel) {
      case App.WhiteLabel_CG:
        App.ShowRewardedShopAd = !0;
        App.CrazySDK.requestAd("rewarded");
        break;
      case App.WhiteLabel_POKI:
      case App.WhiteLabel_POKI_MAIN:
        App.PokiSDK.rewardedBreak().then((a) => {
          a ? this.claimRewards() : this.emit(Layer.Events.REWARDS_CLAIMED, !1, 0);
        });
    }
  }
  async claimRewards() {
    let a = await APIClient.postClaimShopReward(App.Credential.id);
    a.success ? this.displayRewardDialog(a.limit ? !0 : !1) : this.displayWarning(a.error);
  }
  displayRewardDialog(a = !1) {
    AudioEffects.GoldPickup[
      Math.floor(Math.random() * AudioEffects.GoldPickup.length)
    ].audio.play();
    this.goldRewardText.alpha = 1;
    this.goldRewardText.visible = !0;
    this.goldRewardText.x = this.goldText.x + 16;
    this.goldRewardText.y = this.goldText.y;
    this.goldAnimation = !0;
    this.goldRewardText.text = "+100";
    this.gold += 100;
    this.goldText.text = numberWithPeriods(this.gold);
    let b = this.goldIcon.x + 0.5 * this.goldIcon.width,
      c = this.goldIcon.y + 0.5 * this.goldIcon.height;
    for (let d = 0; 20 > d; d++) {
      let e = ParticleEffects.GoldGlitter;
      e.x = b;
      e.y = c;
      e.vx = -2 + 4 * Math.random();
      e.vy = -2 + 4 * Math.random();
      e.vr = -0.3 + 0.6 * Math.random();
      e.a = 0.7;
      let f = e.s;
      e.s = 1;
      this.particleContainer.spawn(e);
      e.s = f;
    }
    setTimeout(() => {
      this.goldAnimation = !1;
    }, 3e3);
    a ? this.displayLimitReached() : this.displayRewardCountdown();
  }
  update() {
    this.visualizer.update();
    this.goldAnimation &&
      ((this.goldRewardText.alpha -= 0.01),
      (this.goldRewardText.y -= 0.5),
      0.01 >= this.goldRewardText.alpha && (this.goldAnimation = !1),
      this.particleContainer.update());
  }
  displayWarning(a = "Disable AdBlock") {
    this.errorRewardMessage.visible = !0;
    this.rewardButton.visible = !1;
    this.errorRewardMessage.text = a;
    setTimeout(() => {
      this.errorRewardMessage.visible = !1;
      this.rewardButton.visible = !0;
      this.enableRewardButton();
    }, 3e3);
  }
  displayErrorMessage(a) {
    this.errorMessage.text = a;
  }
}
CustomizationMenu.PLAYER = "player";
CustomizationMenu.WEAPONS = "weapons";
var inputfield = {};
class InputField extends PIXI.Container {
  constructor(a, b = !1, c = 26, d = !0) {
    super();
    EventDispatcher.call(this);
    this.id = a || "button";
    this.focus = !1;
    this.marker = new PIXI.BitmapText(">", { fontName: "Open Sans", align: "left", fontSize: c });
    this.text = d
      ? new PIXI.BitmapText("", { fontName: "Open Sans", align: "left", fontSize: c })
      : new PIXI.Text("", {
          fontSize: 22,
          fontFamily: "Arial",
          fill: 16777215,
          lineJoin: "round",
          strokeThickness: 3,
          align: "left",
        });
    this.text.tint = 16777215;
    this.text.anchor.y = 1;
    this.passwordText = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      align: "left",
      fontSize: c,
    });
    this.passwordText.anchor.y = 1;
    this.previousText = "";
    this.background = new PIXI.Graphics();
    this.background.alpha = 0.3;
    this.markingColor = 16777215;
    b || this.addChild(this.background);
    this.addChild(this.marker);
    this.addChild(this.text);
    this.addChild(this.passwordText);
    this.minimal = !1;
    this.marker.x = 2;
    this.marker.y = 6;
    this.marker.visible = !1;
    this.marker.tint = 11184810;
    this.text.x = 15 - (26 - c);
    this.text.y = (d ? 30 : 26) - (26 - c);
    this.passwordText.x = 15 - (26 - c);
    this.passwordText.y = (d ? 30 : 26) - (26 - c);
    this.passwordMode = !1;
    this.filterEnabled = !0;
    this.filtered = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";
    this.inversed = this.mouseOver = !1;
    this.noMouse = b || !1;
    this.interactive = !this.noMouse;
    this.maxChars = 32;
    this.boundGlobalPointerInputListener = this.boundGlobalInputListener = null;
    this.centerInput = this.forceUpperCase = this.forceLowerCase = !1;
    this.configuredWidth = 100;
    this.configuredHeight = 30;
    this.boundOnInput = this.onInput.bind(this);
    this.ignoreMouse ||
      (this.on("mousedown", this.onMouseDown.bind(this)),
      this.on("touchstart", this.onMouseDown.bind(this)),
      this.on("move", this.onMouseOver.bind(this)),
      this.on("mouseover", this.onMouseOver.bind(this)),
      this.on("mouseout", this.onMouseOut.bind(this)),
      this.on("pointerup", this.onMouseOut.bind(this)));
  }
  async onInput(a) {
    let b = this.preProcessInput(a);
    if (this.isFiltered(a)) {
      var c = a.data.char;
      if (a.data.code !== UserInput.ENTER) {
        var d = this.text.text;
        a.data.ctrl && "v" === c
          ? navigator.clipboard.readText().then((e) => {
              this.applyInput(e, "", d, a);
            })
          : this.applyInput(b, c, d, a);
      }
    }
  }
  applyInput(a, b, c, d) {
    0 === a.length && d.data.code === UserInput.BACKSPACE
      ? (this.text.text = "" + b)
      : (a.length >= this.maxChars && (a = a.slice(0, this.maxChars - 1)),
        " " === a && (a = a.slice(0, a.length - 1)),
        " " === b && 0 === a.length && (a = " "),
        (this.text.text =
          a + (this.forceLowerCase ? b.toLowerCase() : this.forceUpperCase ? b.toUpperCase() : b)));
    c !== this.text.text &&
      this.dispatchEvent(new CustomEvent(InputField.CHANGE, { value: this.text.text }));
    this.passwordMode && (this.passwordText.text = "*".repeat(this.text.text.length));
    this.text.scale.x = this.text.scale.y = 1 - 0.006 * this.text.text.length;
    this.passwordMode ||
      (this.text.width + 20 > this.configuredWidth
        ? this.setDimensions(this.text.width + 20, this.configuredHeight, !1)
        : this.setDimensions(this.configuredWidth, this.configuredHeight, !1));
  }
  preProcessInput(a) {
    let b = this.text.text;
    switch (a.data.code) {
      case UserInput.BACKSPACE:
        0 < b.length && (b = b.slice(0, b.length - 1));
        break;
      case UserInput.ENTER:
        " " === b[0] && (b = b.slice(1)),
          (this.text.text = b),
          this.setFocus(!1),
          this.dispatchEvent(new CustomEvent(InputField.SUBMIT, { value: b }));
    }
    return b;
  }
  isFiltered(a) {
    return this.filterEnabled
      ? -1 !== this.filtered.indexOf(a.data.char)
        ? !this.inversed
        : !1
      : !0;
  }
  setFilter(a, b) {
    this.filtered = a;
    this.inversed = b || !1;
  }
  onMouseDown(a) {
    this.interactive &&
      ((this.mouseOver = !0),
      this.setFocus(!0),
      this.dispatchEvent(new CustomEvent(Button.BUTTON_PRESSED, { id: this.id })),
      AudioEffects.ButtonClick.audio.play());
  }
  onGlobalMouseDown(a) {
    this.focus && !this.mouseOver && this.setFocus(!1);
  }
  setFocus(a) {
    (a && UserInput.hasFocus && this.focus) ||
      ((this.focus = a)
        ? (UserInput.setFocus(this.onInput.bind(this)),
          (this.marker.visible = !0),
          UserInput.hasListener(UserInput.KEY_PRESS, this.boundOnInput) ||
            UserInput.addListener(UserInput.KEY_PRESS, this.boundOnInput),
          this.ignoreMouse ||
            null !== this.boundGlobalInputListener ||
            ((this.boundGlobalInputListener = this.onGlobalMouseDown.bind(this)),
            (this.boundGlobalPointerInputListener = this.onGlobalMouseDown.bind(this)),
            App.Stage.on("mousedown", this.boundGlobalInputListener),
            App.Stage.on("touchstart", this.boundGlobalPointerInputListener),
            (this.background.alpha = 0.6)))
        : (UserInput.releaseFocus(this.onInput.bind(this)),
          (this.marker.visible = !1),
          UserInput.hasListener(UserInput.KEY_PRESS, this.boundOnInput) &&
            UserInput.removeListener(UserInput.KEY_PRESS, this.boundOnInput),
          this.ignoreMouse ||
            null === this.boundGlobalInputListener ||
            (App.Stage.removeListener("mousedown", this.boundGlobalInputListener),
            App.Stage.removeListener("touchstart", this.boundGlobalPointerInputListener),
            (this.boundGlobalPointerInputListener = this.boundGlobalInputListener = null),
            (this.background.alpha = 0.3))),
      a && (this.previousText = this.getText()),
      this.emit(InputField.FOCUS, a));
  }
  setPassword(a) {
    (this.passwordMode = a)
      ? ((this.text.visible = !1), (this.passwordText.visible = !0))
      : ((this.text.visible = !0), (this.passwordText.visible = !1));
  }
  onMouseOver(a) {
    this.mouseOver = !0;
    this.background.alpha = this.focus ? 1 : 0.6;
    AudioEffects.ButtonHover.audio.play();
  }
  onMouseOut(a) {
    this.mouseOver = !1;
    this.background.alpha = this.focus ? 0.6 : 0.3;
  }
  setMaxChars(a) {
    this.maxChars = a;
  }
  setText(a) {
    this.previousText = a;
    this.text.text = a;
    this.passwordMode && (this.passwordText.text = "*".repeat(a.length));
    this.text.scale.x = this.text.scale.y = 1 - 0.006 * this.text.text.length;
    this.text.width + 20 > this.configuredWidth
      ? this.setDimensions(this.text.width + 20, this.configuredHeight, !1)
      : this.setDimensions(this.configuredWidth, this.configuredHeight, !1);
  }
  getText() {
    return this.text.text;
  }
  setDimensions(a, b, c = !0) {
    this.ignoreMouse ||
      (c && ((this.configuredWidth = a), (this.configuredHeight = b)),
      this.background.clear(),
      this.minimal || this.background.lineStyle(2, this.markingColor, 1, 0),
      this.background.beginFill(5592405, 1),
      this.background.drawRoundedRect(this.minimal ? 10 : 0, 0, this.minimal ? a - 10 : a, b, 4),
      this.background.endFill(),
      this.centerInput && (this.text.x = 0.5 * (this.width - this.text.width) + 6));
  }
  hideBorders() {
    this.minimal = !0;
    this.setDimensions(this.configuredWidth, this.configuredHeight, !1);
  }
  markNone() {
    this.markingColor = 16777215;
    this.background.tint = 16777215;
    this.setDimensions(this.configuredWidth, this.configuredHeight, !1);
  }
  markValid() {
    this.markingColor = 65280;
    this.background.tint = 65280;
    this.setDimensions(this.configuredWidth, this.configuredHeight, !1);
  }
  markInvalid() {
    this.markingColor = 16711680;
    this.background.tint = 16711680;
    this.setDimensions(this.configuredWidth, this.configuredHeight, !1);
  }
}
InputField.SUBMIT = "submitInput";
InputField.FOCUS = "focusInput";
InputField.CHANGE = "changeInput";
var socialmenu = {};
class SocialMenu extends Feature {
  constructor() {
    super();
    this.autoCollapsed = this.down = this.dragging = this.collapsed = !1;
    this.friends = [];
    this.friendScrollRatio = 0;
    this.invites = [];
    this.inviteScrollRatio = 0;
    this.members = [];
    this.memberScrollRatio = 0;
    this.clanInvitations = [];
    this.clanInvitationScrollRatio = 0;
    this.autoRefreshFriendsCounter = 60;
    this.ignoreInput = !1;
    this.oy = this.ox = this.friendsLastLoadedDate = 0;
    this.container = new PIXI.Container();
    this.lineStyle(1, 16777215, 0.1, 0);
    this.beginFill(3355443, 0.9);
    this.drawRoundedRect(0, 0, 380, 256, 4);
    this.endFill();
    this.interactive = !0;
    this.listContainer = new PIXI.Container();
    this.scrollbar = new SocialMenuScrollbar(212);
    this.scrollbar.x = 354;
    this.scrollbar.y = 42;
    this.scrollbar.on(SocialMenuScrollbar.SCROLL, (a) => {
      switch (this.mode) {
        case SocialMenu.MODE_FRIENDS:
          this.maskFriendList(a);
          break;
        case SocialMenu.MODE_INVITATIONS:
          this.maskInvitationList(a);
          break;
        case SocialMenu.MODE_CLAN_MEMBERS:
          this.maskMemberList(a);
          break;
        case SocialMenu.MODE_CLAN_INVITATIONS:
          this.maskClanInvitationList(a);
      }
    });
    this.friendsButton = new Button("friends");
    this.friendsButton.setText("Friends");
    this.friendsButton.scale.x = this.friendsButton.scale.y = 0.7;
    this.friendsButton.addListener(Button.BUTTON_RELEASED, this.onFriendsButtonReleased.bind(this));
    this.friendsButton.x = 16;
    this.friendsButton.y = 8;
    this.invitationsButton = new Button("invitations");
    this.invitationsButton.setText("Invitations");
    this.invitationsButton.scale.x = this.invitationsButton.scale.y = 0.7;
    this.invitationsButton.addListener(
      Button.BUTTON_RELEASED,
      this.onInvitationsButtonReleased.bind(this)
    );
    this.invitationsButton.x = this.friendsButton.x + this.friendsButton.width + 6;
    this.invitationsButton.y = 8;
    this.clanButton = new Button("clan");
    this.clanButton.setText("Clan");
    this.clanButton.scale.x = this.clanButton.scale.y = 0.7;
    this.clanButton.addListener(Button.BUTTON_RELEASED, this.onClanButtonReleased.bind(this));
    this.clanButton.x = this.invitationsButton.x + this.invitationsButton.width + 6;
    this.clanButton.y = 8;
    this.clanChatButton = new Button("clan_chat");
    this.clanChatButton.setText("Clan chat");
    this.clanChatButton.scale.x = this.clanChatButton.scale.y = 0.7;
    this.clanChatButton.addListener(
      Button.BUTTON_RELEASED,
      this.onClanChatButtonReleased.bind(this)
    );
    this.clanChatButton.x = this.clanButton.x + this.clanButton.width + 6;
    this.clanChatButton.y = 8;
    this.friendDropdown = new FriendDropdown();
    this.friendDropdown.on(SocialMenu.REFRESH, () => this.refresh());
    this.friendDropdown.on(SocialMenu.SHOW_CHAT, (a) => this.showChat(a));
    this.friendDropdown.on(SocialMenu.SEND_GOLD, (a) => this.showGoldForm(a));
    this.clanDropdown = new SocialMemberDropdown();
    this.clanDropdown.on(SocialMenu.REFRESH, () => this.refresh());
    this.clanDropdown.on(SocialMenu.SHOW_CHAT, (a) => this.showChat(a));
    -1 === parseInt(App.Credential.clan_id) || App.WhiteLabel === App.WhiteLabel_POKI
      ? this.clanChatButton.disable()
      : this.clanChatButton.enable();
    this.friendText = new PIXI.Text(
      "Join a game and right click on a player in the leaderboard to send a friend invitation.",
      {
        fontName: "Arial",
        fontSize: 16,
        lineHeight: 18,
        fill: 13421568,
        strokeThickness: 2,
        lineJoin: "round",
        wordWrap: !0,
        wordWrapWidth: 330,
      }
    );
    this.friendText.x = 10;
    this.friendText.y = 40;
    this.friendText.resolution = 1.5 * App.DevicePixelRatio;
    this.infoText = new PIXI.Text("Right-click friend for more actions.", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 13408512,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.infoText.x = 10;
    this.infoText.y = 234;
    this.infoText.resolution = 1.5 * App.DevicePixelRatio;
    this.infoText.maxWidth = 350;
    this.collapseButton = new PIXI.Sprite(App.CombinedTextures["chat-hide"]);
    this.collapseButton.scale.x = this.collapseButton.scale.y = 0.6;
    this.collapseButton.interactive = !0;
    this.collapseButton.x = 347;
    this.collapseButton.y = 2;
    this.collapseButton.alpha = 0.7;
    this.on("mousedown", (a) => {
      a.stopPropagation();
      this.down = !0;
      this.ox = a.data.global.x / this.parent.scale.x;
      this.oy = a.data.global.y / this.parent.scale.y;
    });
    this.on("mouseup", (a) => {
      a.stopPropagation();
      this.down = this.dragging = !1;
    });
    this.on("mouseupoutside", (a) => {
      a.stopPropagation();
      this.down = this.dragging = !1;
    });
    this.on("mousemove", (a) => {
      if (this.down && !this.ignoreInput) {
        let b = a.data.global.x / this.parent.scale.x;
        a = a.data.global.y / this.parent.scale.y;
        let c = b - this.ox,
          d = a - this.oy;
        this.x += c;
        this.y += d;
        this.ox = b;
        this.oy = a;
        0 < Math.sqrt(c * c + d * d) &&
          ((this.chatWindow.x -= c),
          (this.chatWindow.y -= d),
          (this.goldWindow.x -= c),
          (this.goldWindow.y -= d),
          (this.dragging = !0));
      }
    });
    this.on("mouseover", () => {
      this.collapsed || this.scrollbar.enableWheel();
    });
    this.on("mouseout", () => this.scrollbar.disableWheel());
    this.collapseButton.on("mouseover", (a) => {
      a.stopPropagation();
      this.collapseButton.alpha = 1;
    });
    this.collapseButton.on("mouseout", (a) => {
      a.stopPropagation();
      this.collapseButton.alpha = 0.7;
    });
    this.collapseButton.on("mousedown", (a) => {
      this.down = !0;
      this.ox = a.data.global.x;
      this.oy = a.data.global.y;
      AudioEffects.ButtonClick.audio.play();
    });
    this.collapseButton.on("mouseup", () => this.collapseMenu());
    this.container.addChild(this.infoText);
    this.container.addChild(this.listContainer);
    this.container.addChild(this.invitationsButton);
    this.container.addChild(this.friendsButton);
    this.container.addChild(this.clanButton);
    this.container.addChild(this.clanChatButton);
    this.addChild(this.container);
    this.addChild(this.collapseButton);
    this.chatWindow = new ChatWindow();
    this.chatWindow.on("rightdown", () => {
      this.chatWindow.active = !1;
      this.removeChild(this.chatWindow);
    });
    this.chatWindow.on(ChatWindow.CLOSE, () => {
      this.chatWindow.active = !1;
      this.removeChild(this.chatWindow);
    });
    this.goldWindow = new GoldWindow();
    this.goldWindow.on("rightdown", () => {
      this.goldWindow.active = !1;
      this.removeChild(this.goldWindow);
    });
    this.goldWindow.on(GoldWindow.CLOSE, () => {
      this.goldWindow.active = !1;
      this.removeChild(this.goldWindow);
    });
    this.resize(void 0, void 0, !0);
    this.loadConversationInterval = null;
    600 > App.ClientHeight && this.collapseMenu();
  }
  repositionForGame() {
    var a = new PIXI.Point(App.ClientWidth, App.ClientHeight);
    a = App.Layer.toLocal(a, App.Stage);
    this.x = this.collapsed ? a.x - 400 * this.scale.x : a.x - 380 * this.scale.x;
    this.y = a.y - (this.height + 20);
  }
  repositionForMenu() {
    let a = new PIXI.Point(App.ClientWidth, App.ClientHeight);
    this.y = App.Layer.toLocal(a, App.Stage).y - 300;
  }
  collapseMenu(a = !1, b = !0) {
    this.autoCollapsed = a;
    this.down = !1;
    if (!this.scrollbar.scrolling)
      if (this.dragging) this.dragging = !1;
      else {
        this.collapsed = !this.collapsed;
        a = this.x;
        var c = this.y;
        this.collapsed
          ? (this.scrollbar.disableWheel(),
            this.clear(),
            this.resize(),
            this.removeChild(this.container),
            (this.collapseButton.alpha = 0.7),
            (this.collapseButton.scale.x = this.collapseButton.scale.y = 0.9),
            (this.collapseButton.texture = App.CombinedTextures.chat))
          : (b && this.scrollbar.enableWheel(),
            this.lineStyle(1, 16777215, 0.1, 0),
            this.beginFill(3355443, 0.9),
            this.drawRoundedRect(0, 0, 380, 256, 4),
            this.endFill(),
            this.addChild(this.container),
            this.setChildIndex(this.collapseButton, this.children.length - 1),
            this.resize(),
            (this.collapseButton.scale.x = this.collapseButton.scale.y = 0.6),
            (this.collapseButton.texture = App.CombinedTextures["chat-hide"]),
            (this.collapseButton.alpha = 1));
        this.chatWindow.x += a - this.x;
        this.chatWindow.y += c - this.y;
        this.chatWindow.parent && this.setChildIndex(this.chatWindow, this.children.length - 1);
      }
  }
  maskFriendList(a) {
    let b = Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight);
    if (this.friends.length <= b) this.listContainer.y = 0;
    else {
      this.listContainer.removeChildren();
      this.listContainer.y = -(
        a *
        (this.friends.length * SocialMenu.ItemHeight -
          (SocialMenu.ListHeight - SocialMenu.ItemHeight))
      );
      var c = this.listContainer.y,
        d = Math.round(Math.abs(c / SocialMenu.ItemHeight));
      for (let f = 0; f < b; f++) {
        let g = this.friends[d + f];
        this.listContainer.addChild(g);
        if (0 === f) {
          var e = d * SocialMenu.ItemHeight + c;
          g.alpha = 0 <= e ? 1 : 1 - (1 / (0.5 * SocialMenu.ItemHeight)) * Math.abs(e);
        } else
          f === b - 1
            ? ((e = d * SocialMenu.ItemHeight + c),
              (g.alpha = 0 > e ? 1 : 1 - (1 / (0.5 * SocialMenu.ItemHeight)) * Math.abs(e)))
            : (g.alpha = 1);
      }
      this.friendScrollRatio = a;
    }
  }
  maskInvitationList(a) {
    let b = Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight);
    if (this.invites.length <= b) this.listContainer.y = 0;
    else {
      this.listContainer.removeChildren();
      this.listContainer.y = -(
        a *
        (this.invites.length * SocialMenu.ItemHeight -
          (SocialMenu.ListHeight - SocialMenu.ItemHeight))
      );
      var c = this.listContainer.y,
        d = Math.round(Math.abs(c / SocialMenu.ItemHeight));
      for (let f = 0; f < b; f++) {
        let g = this.invites[d + f];
        this.listContainer.addChild(g);
        if (0 === f) {
          var e = d * SocialMenu.ItemHeight + c;
          g.alpha = 0 <= e ? 1 : 1 - (1 / (0.5 * SocialMenu.ItemHeight)) * Math.abs(e);
        } else
          f === b - 1
            ? ((e = d * SocialMenu.ItemHeight + c),
              (g.alpha = 0 > e ? 1 : 1 - (1 / (0.5 * SocialMenu.ItemHeight)) * Math.abs(e)))
            : (g.alpha = 1);
      }
      this.inviteScrollRatio = a;
    }
  }
  maskClanInvitationList(a) {
    let b = Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight);
    if (this.clanInvitations.length <= b) this.listContainer.y = 0;
    else {
      this.listContainer.removeChildren();
      this.listContainer.y = -(
        a *
        (this.clanInvitations.length * SocialMenu.ItemHeight -
          (SocialMenu.ListHeight - SocialMenu.ItemHeight))
      );
      var c = this.listContainer.y,
        d = Math.round(Math.abs(c / SocialMenu.ItemHeight));
      for (let f = 0; f < b; f++) {
        let g = this.clanInvitations[d + f];
        this.listContainer.addChild(g);
        if (0 === f) {
          var e = d * SocialMenu.ItemHeight + c;
          g.alpha = 0 <= e ? 1 : 1 - (1 / (0.5 * SocialMenu.ItemHeight)) * Math.abs(e);
        } else
          f === b - 1
            ? ((e = d * SocialMenu.ItemHeight + c),
              (g.alpha = 0 > e ? 1 : 1 - (1 / (0.5 * SocialMenu.ItemHeight)) * Math.abs(e)))
            : (g.alpha = 1);
      }
      this.clanInvitationScrollRatio = a;
    }
  }
  maskMemberList(a) {
    let b = Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight);
    if (this.members.length <= b) this.listContainer.y = 0;
    else {
      this.listContainer.removeChildren();
      this.listContainer.y = -(
        a *
        (this.members.length * SocialMenu.ItemHeight -
          (SocialMenu.ListHeight - SocialMenu.ItemHeight))
      );
      var c = this.listContainer.y,
        d = Math.round(Math.abs(c / SocialMenu.ItemHeight));
      for (let f = 0; f < b; f++) {
        let g = this.members[d + f];
        this.listContainer.addChild(g);
        if (0 === f) {
          var e = d * SocialMenu.ItemHeight + c;
          g.alpha = 0 <= e ? 1 : 1 - (1 / (0.5 * SocialMenu.ItemHeight)) * Math.abs(e);
        } else
          f === b - 1
            ? ((e = d * SocialMenu.ItemHeight + c),
              (g.alpha = 0 > e ? 1 : 1 - (1 / (0.5 * SocialMenu.ItemHeight)) * Math.abs(e)))
            : (g.alpha = 1);
      }
      this.memberScrollRatio = a;
    }
  }
  async refresh() {
    switch (this.mode) {
      case SocialMenu.MODE_FRIENDS:
        this.loadFriends();
        break;
      case SocialMenu.MODE_INVITATIONS:
        this.loadInvitations();
        break;
      case SocialMenu.MODE_CLAN_MEMBERS:
        this.loadClanMembers();
        break;
      case SocialMenu.MODE_CLAN_INVITATIONS:
        this.loadClanInvitations();
    }
  }
  async loadConversations() {
    var a = await APIClient.getMessages(App.Credential.id);
    if ((a = JSON.parse(a)))
      ChatWindow.UpdateConversations(a),
        this.chatWindow.active && this.chatWindow.loadConversation();
  }
  async loadFriends(a = !1) {
    var b = Date.now();
    if (
      !(2e3 > b - this.friendsLastLoadedDate) &&
      ((this.friendsLastLoadedDate = b),
      this.friendsButton.setTint(16763904),
      this.invitationsButton.setTint(16777215),
      this.clanButton.setTint(16777215),
      (this.mode = SocialMenu.MODE_FRIENDS),
      this.friendsButton.disable(),
      (this.friendsButton.interactive = !0),
      (b = await APIClient.getFriends(App.Credential.id)),
      !1 !== b.success)
    ) {
      this.friends = [];
      b = JSON.parse(b);
      this.friendsButton.enable();
      this.listContainer.removeChildren();
      if (b.friends) {
        this.friendText.parent && this.container.removeChild(this.friendText);
        for (let c = 0; c < b.friends.length; c++) {
          const d = b.friends[c];
          let e = new FriendItem(d.id, d.name, d.seen, d.clan_id);
          e.x = 10;
          e.y = 47 + c * SocialMenu.ItemHeight;
          e.on(SocialMenu.REFRESH, () => this.refresh());
          e.on(SocialMenu.ACCESS_PROFILE, (f) => this.emit(Layer.Events.USER_ACCESS, f));
          e.on(SocialMenu.SHOW_FRIEND_DROPDOWN, () => this.showFriendDropdown(d.id, e));
          this.friends.push(e);
          this.friends.length <= Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight) &&
            this.listContainer.addChild(e);
          void 0 === SocialMenu.Friends[d.id] &&
            (SocialMenu.Friends[d.id] = { name: d.name, seen: d.seen });
        }
        b.friends.length > Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight)
          ? this.container.addChild(this.scrollbar)
          : this.container.removeChild(this.scrollbar);
        null === this.loadConversationInterval &&
          (this.loadConversationInterval = setInterval(() => {
            0 < this.friends.length && this.loadConversations();
            this.autoRefreshFriendsCounter--;
            0 >= this.autoRefreshFriendsCounter &&
              (this.collapsed || this.down || this.friendDropdown.parent || this.loadFriends(),
              (this.autoRefreshFriendsCounter = SocialMenu.AutoRefreshFriends));
          }, 4e4));
      } else
        this.container.addChild(this.friendText),
          this.container.removeChild(this.scrollbar),
          null !== this.loadConversationInterval &&
            (clearInterval(this.loadConversationInterval), (this.loadConversationInterval = null));
      this.friendDropdown.parent && this.container.removeChild(this.friendDropdown);
      a && ((this.friendScrollRatio = 0), this.scrollbar.reset());
      this.maskFriendList(this.friendScrollRatio);
    }
  }
  async loadInvitations(a = !1) {
    this.friendText.parent && this.container.removeChild(this.friendText);
    this.friendsButton.setTint(16777215);
    this.invitationsButton.setTint(16763904);
    this.clanButton.setTint(16777215);
    this.mode = SocialMenu.MODE_INVITATIONS;
    this.invitationsButton.disable();
    this.invitationsButton.interactive = !0;
    var b = await APIClient.getInvitations(App.Credential.id);
    if (!1 !== b.success) {
      b = JSON.parse(b);
      this.invites = [];
      this.invitationsButton.enable();
      this.listContainer.removeChildren();
      if (b.invitations) {
        for (let d = 0; d < b.invitations.length; d++) {
          var c = b.invitations[d];
          c = new AcceptInvitationItem(c.id, c.userId, c.name);
          c.x = 10;
          c.y = 40 + d * SocialMenu.ItemHeight;
          c.on(SocialMenu.REFRESH, () => this.refresh());
          c.on(SocialMenu.ACCESS_PROFILE, (e) => this.emit(Layer.Events.USER_ACCESS, e));
          this.invites.push(c);
          this.invites.length <= Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight) &&
            this.listContainer.addChild(c);
        }
        b.invitations.length > Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight)
          ? this.container.addChild(this.scrollbar)
          : this.container.removeChild(this.scrollbar);
      } else this.container.removeChild(this.scrollbar);
      this.friendDropdown.parent && this.container.removeChild(this.friendDropdown);
      a && ((this.inviteScrollRatio = 0), this.scrollbar.reset());
      this.maskInvitationList(this.inviteScrollRatio);
    }
  }
  showFriendDropdown(a, b) {
    this.friendDropdown.id === a && this.friendDropdown.parent
      ? this.container.removeChild(this.friendDropdown)
      : ((this.friendDropdown.id = a),
        (this.friendDropdown.name = b.name),
        this.friendDropdown.update({
          clanInvite:
            null !== b.clan ||
            -1 === parseInt(App.Credential.clan_id) ||
            ("captain" !== App.Credential.clan_role && "leader" !== App.Credential.clan_role)
              ? !1
              : !0,
        }),
        this.container.addChild(this.friendDropdown),
        (this.friendDropdown.x = b.x),
        (this.friendDropdown.y = b.y + b.parent.y + b.height));
  }
  showClanDropdown(a, b) {
    this.clanDropdown.id === a && this.clanDropdown.parent
      ? this.container.removeChild(this.clanDropdown)
      : ((this.clanDropdown.id = a),
        (this.clanDropdown.name = b.name),
        this.container.addChild(this.clanDropdown),
        (this.clanDropdown.x = b.x),
        (this.clanDropdown.y = b.y + b.parent.y + b.height));
  }
  showGoldForm(a) {
    this.goldWindow.load(a);
    this.goldWindow.active = !0;
    this.goldWindow.x = -10;
    this.goldWindow.y = 30;
    this.addChild(this.goldWindow);
    this.setChildIndex(this.goldWindow, this.children.length - 1);
    this.friendDropdown.parent && this.container.removeChild(this.friendDropdown);
  }
  showChat(a, b) {
    this.chatWindow.loadConversation(a);
    this.chatWindow.active = !0;
    this.chatWindow.x = this.x < 0.5 * App.ClientWidth ? 0 : -20;
    this.chatWindow.y = 36;
    this.addChild(this.chatWindow);
    this.setChildIndex(this.chatWindow, this.children.length - 1);
    this.friendDropdown.parent && this.container.removeChild(this.friendDropdown);
  }
  async loadInvitees() {
    this.mode = SocialMenu.MODE_INVITEES;
    !1 !== (await APIClient.getInvitees(App.Credential.id)).success &&
      this.listContainer.removeChildren();
  }
  async loadClanMembers(a = !1) {
    this.friendText.parent && this.container.removeChild(this.friendText);
    this.friendsButton.setTint(16777215);
    this.invitationsButton.setTint(16777215);
    this.clanButton.setTint(16763904);
    this.mode = SocialMenu.MODE_CLAN_MEMBERS;
    this.clanButton.disable();
    this.clanButton.interactive = !0;
    const b = await APIClient.getClanMembers(App.Credential.clan_id);
    if (!1 !== b.success) {
      this.members = [];
      this.clanButton.enable();
      this.listContainer.removeChildren();
      if (b.members) {
        0 < b.members.length && App.WhiteLabel !== App.WhiteLabel_POKI
          ? this.clanChatButton.enable()
          : this.clanChatButton.disable();
        for (let c = 0; c < b.members.length; c++) {
          const d = b.members[c],
            e = new ClanMemberItem(d.id, d.name, d.role);
          e.x = 10;
          e.y = 40 + c * SocialMenu.ItemHeight;
          e.on(SocialMenu.REFRESH, () => this.refresh());
          e.on(SocialMenu.ACCESS_PROFILE, (f) => this.emit(Layer.Events.USER_ACCESS, f));
          if (SocialMenu.Friends[d.id])
            e.on(SocialMenu.SHOW_CLAN_DROPDOWN, () => this.showClanDropdown(d.id, e));
          this.members.push(e);
          this.members.length <= Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight) &&
            this.listContainer.addChild(e);
        }
        b.members.length > Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight)
          ? this.container.addChild(this.scrollbar)
          : this.container.removeChild(this.scrollbar);
      } else this.container.removeChild(this.scrollbar);
      this.friendDropdown.parent && this.container.removeChild(this.friendDropdown);
      a && ((this.memberScrollRatio = 0), this.scrollbar.reset());
      this.maskMemberList(this.memberScrollRatio);
    }
  }
  async loadClanInvitations(a = !1) {
    this.friendText.parent && this.container.removeChild(this.friendText);
    this.friendsButton.setTint(16777215);
    this.invitationsButton.setTint(16777215);
    this.clanButton.setTint(16763904);
    this.mode = SocialMenu.MODE_CLAN_INVITATIONS;
    this.clanButton.disable();
    this.clanButton.interactive = !0;
    const b = await APIClient.getClanInvitations(App.Credential.id);
    if (!1 !== b.success) {
      this.clanInvitations = [];
      this.clanButton.enable();
      this.listContainer.removeChildren();
      if (b.invitations) {
        for (let d = 0; d < b.invitations.length; d++) {
          var c = b.invitations[d];
          c = new AcceptClanInvitationItem(c.clan_id, c.clan_name, c.initiator_name);
          c.x = 10;
          c.y = 40 + d * SocialMenu.ItemHeight;
          c.on(SocialMenu.REFRESH, () => this.refresh());
          c.on(Layer.Events.JOIN_CLAN, () => this.emit(Layer.Events.JOIN_CLAN));
          this.clanInvitations.push(c);
          this.clanInvitations.length <=
            Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight) &&
            this.listContainer.addChild(c);
        }
        b.invitations.length > Math.floor(SocialMenu.ListHeight / SocialMenu.ItemHeight)
          ? this.container.addChild(this.scrollbar)
          : this.container.removeChild(this.scrollbar);
      } else this.container.removeChild(this.scrollbar);
      this.friendDropdown.parent && this.container.removeChild(this.friendDropdown);
      a && ((this.clanInvitationScrollRatio = 0), this.scrollbar.reset());
      this.maskClanInvitationList(this.clanInvitationScrollRatio);
    }
  }
  onInvitationsButtonReleased() {
    this.loadInvitations(!0);
  }
  onFriendsButtonReleased() {
    this.loadFriends(!0);
  }
  onClanButtonReleased() {
    -1 !== parseInt(App.Credential.clan_id)
      ? this.loadClanMembers(!0)
      : this.loadClanInvitations(!0);
  }
  onClanChatButtonReleased() {
    this.emit(Layer.Events.CLAN_CHAT_ACCESS);
  }
  show() {
    this.loadFriends();
  }
  hide() {
    null !== this.loadConversationInterval &&
      (clearInterval(this.loadConversationInterval), (this.loadConversationInterval = null));
    this.scrollbar.disableWheel();
  }
  update() {}
  collapse() {
    this.collapsed = !0;
    this.resize();
    this.scrollbar.disableWheel();
  }
  expand() {
    this.collapsed = !1;
    this.resize();
  }
  resize(a, b, c = !1) {
    this.scale.x = this.scale.y = 1.2 + (1 - App.Scale);
    a = a ?? App.ClientWidth;
    b = b ?? App.ClientHeight;
    a = new PIXI.Point(a, b);
    a = App.Layer.toLocal(a, App.Stage);
    this.x = this.collapsed ? a.x - 400 * this.scale.x : a.x - 380 * this.scale.x;
    this.y + this.height > a.y
      ? (this.y = a.y - this.height)
      : c && (this.y = a.y - 2.1 * this.height);
  }
}
SocialMenu.REFRESH = "refresh";
SocialMenu.ACCESS_PROFILE = "access_profile";
SocialMenu.MODE_INVITATIONS = "invitations";
SocialMenu.MODE_INVITEES = "invitees";
SocialMenu.MODE_FRIENDS = "friends";
SocialMenu.MODE_CLAN_INVITATIONS = "clan_invitations";
SocialMenu.MODE_CLAN_MEMBERS = "clan_members";
SocialMenu.SHOW_FRIEND_DROPDOWN = "show_dropdown";
SocialMenu.SHOW_CLAN_DROPDOWN = "show_clan_dropdown";
SocialMenu.SHOW_CHAT = "show_chat";
SocialMenu.SEND_GOLD = "send_gold";
SocialMenu.MODE_GAME = !1;
SocialMenu.Friends = {};
SocialMenu.AutoRefreshFriends = 10;
SocialMenu.ListHeight = 208;
SocialMenu.ItemHeight = 30;
class FriendItem extends PIXI.Graphics {
  constructor(a, b, c, d) {
    super();
    this.id = a;
    this.name = b;
    this.seen = new Date(Date.parse(c) - 6e4 * new Date().getTimezoneOffset());
    this.clan = d;
    this.beginFill(16777215, 0.15);
    this.drawRoundedRect(0, 0, 340, 26, 4);
    this.endFill();
    this.interactive = !0;
    this.tint = 12303291;
    this.on("mouseover", () => {
      this.tint = 16777215;
    });
    this.on("mouseout", () => {
      this.tint = 12303291;
    });
    this.on("mousedown", () => this.emit(SocialMenu.ACCESS_PROFILE, this.id));
    this.on("rightdown", () => this.emit(SocialMenu.SHOW_FRIEND_DROPDOWN, this.id));
    30 > Math.round((Date.now() - this.seen.getTime()) / 1e3)
      ? this.beginFill(65280, 1)
      : this.beginFill(8947848, 1);
    this.drawCircle(320, 13, 8);
    this.endFill();
    this.nameLabel = new PIXI.BitmapText(this.name, { fontName: "Open Sans", fontSize: 22 });
    this.nameLabel.x = 8;
    this.nameLabel.y = 2;
    this.addChild(this.nameLabel);
  }
}
class ClanMemberItem extends PIXI.Graphics {
  constructor(a, b, c) {
    super();
    this.id = a;
    this.name = b;
    this.role = c;
    this.isFriend = !1;
    SocialMenu.Friends[this.id]
      ? ((this.isFriend = !0),
        (this.seen = new Date(
          Date.parse(SocialMenu.Friends[this.id].seen) - 6e4 * new Date().getTimezoneOffset()
        )))
      : (this.seen = this.id === App.Credential.playerid ? new Date() : new Date(0));
    this.beginFill(16777215, 0.15);
    this.drawRoundedRect(0, 0, 340, 26, 4);
    this.endFill();
    this.interactive = !0;
    this.tint = 12303291;
    this.on("mouseover", () => {
      this.tint = 16777215;
    });
    this.on("mouseout", () => {
      this.tint = 12303291;
    });
    this.on("mousedown", () => this.emit(SocialMenu.ACCESS_PROFILE, this.id));
    this.on("rightdown", () => this.emit(SocialMenu.SHOW_CLAN_DROPDOWN, this.id));
    30 > Math.round((Date.now() - this.seen.getTime()) / 1e3)
      ? this.beginFill(65280, 1)
      : this.beginFill(8947848, 1);
    this.drawCircle(320, 13, 8);
    this.endFill();
    this.nameLabel = new PIXI.BitmapText(this.name, { fontName: "Open Sans", fontSize: 22 });
    this.nameLabel.x = 8;
    this.nameLabel.y = 2;
    this.nameLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.nameLabel);
    this.isFriend && (this.nameLabel.tint = 12320699);
    if ("captain" === this.role || "leader" === this.role)
      (this.roleLabel = new PIXI.BitmapText(this.role, {
        fontName: "Open Sans",
        fontSize: 22,
        align: "left",
      })),
        (this.roleLabel.x = 300 - this.roleLabel.width),
        (this.roleLabel.y = 2),
        (this.roleLabel.tint = "leader" === this.role ? 8978312 : 16746632),
        (this.roleLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0)),
        this.addChild(this.roleLabel);
  }
}
class AcceptClanInvitationItem extends PIXI.Graphics {
  constructor(a, b, c) {
    super();
    this.id = a;
    this.clanName = b;
    this.initiatorName = c;
    this.beginFill(16777215, 0.15);
    this.drawRoundedRect(0, 0, 340, 26, 4);
    this.endFill();
    this.interactive = !0;
    this.tint = 12303291;
    this.on("mouseover", () => {
      this.tint = 16777215;
    });
    this.on("mouseout", () => {
      this.tint = 12303291;
    });
    this.nameLabel = new PIXI.BitmapText(this.clanName + " by " + this.initiatorName, {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.nameLabel.x = 8;
    this.nameLabel.y = 2;
    this.addChild(this.nameLabel);
    this.acceptButton = new Button("accept");
    this.acceptButton.setText("Accept");
    this.acceptButton.scale.x = this.acceptButton.scale.y = 0.55;
    this.acceptButton.addListener(Button.BUTTON_RELEASED, this.onAccept.bind(this));
    this.acceptButton.x = 225;
    this.acceptButton.y = 3;
    this.acceptButton.setTint(8978312);
    this.addChild(this.acceptButton);
    this.cancelButton = new Button("decline");
    this.cancelButton.setText("Decline");
    this.cancelButton.scale.x = this.cancelButton.scale.y = 0.55;
    this.cancelButton.addListener(Button.BUTTON_RELEASED, this.onDecline.bind(this));
    this.cancelButton.x = 287;
    this.cancelButton.y = 3;
    this.cancelButton.setTint(16746632);
    this.addChild(this.cancelButton);
  }
  async onAccept() {
    this.acceptButton.disable();
    !1 !== (await APIClient.postAcceptInviteMember(this.id, App.Credential.id)).success &&
      (this.acceptButton.enable(),
      this.emit(Layer.Events.JOIN_CLAN),
      this.emit(SocialMenu.REFRESH));
  }
  async onDecline() {
    this.cancelButton.disable();
    !1 !== (await APIClient.postDeclineInviteMember(this.id, App.Credential.id)).success &&
      (this.cancelButton.enable(), this.emit(SocialMenu.REFRESH));
  }
}
class AcceptInvitationItem extends PIXI.Graphics {
  constructor(a, b, c) {
    super();
    this.id = a;
    this.name = c;
    this.userId = b;
    this.beginFill(16777215, 0.2);
    this.drawRoundedRect(0, 0, 340, 26, 4);
    this.endFill();
    this.interactive = !0;
    this.tint = 12303291;
    this.on("mouseover", () => {
      this.tint = 16777215;
    });
    this.on("mouseout", () => {
      this.tint = 12303291;
    });
    this.on("mousedown", () => this.emit(SocialMenu.ACCESS_PROFILE, b));
    this.nameLabel = new PIXI.BitmapText(this.name, { fontName: "Open Sans", fontSize: 22 });
    this.nameLabel.x = 8;
    this.nameLabel.y = 2;
    this.addChild(this.nameLabel);
    this.acceptButton = new Button("accept");
    this.acceptButton.setText("Accept");
    this.acceptButton.scale.x = this.acceptButton.scale.y = 0.55;
    this.acceptButton.addListener(Button.BUTTON_RELEASED, this.onAccept.bind(this));
    this.acceptButton.x = 225;
    this.acceptButton.y = 3;
    this.acceptButton.setTint(8978312);
    this.addChild(this.acceptButton);
    this.cancelButton = new Button("decline");
    this.cancelButton.setText("Decline");
    this.cancelButton.scale.x = this.cancelButton.scale.y = 0.55;
    this.cancelButton.addListener(Button.BUTTON_RELEASED, this.onDecline.bind(this));
    this.cancelButton.x = 287;
    this.cancelButton.y = 3;
    this.cancelButton.setTint(16746632);
    this.addChild(this.cancelButton);
  }
  async onAccept() {
    this.acceptButton.disable();
    !1 !== (await APIClient.postAcceptFriend(this.userId, App.Credential.id)).success &&
      (this.acceptButton.enable(), this.emit(SocialMenu.REFRESH));
  }
  async onDecline() {
    this.cancelButton.disable();
    !1 !== (await APIClient.postDeclineFriend(this.userId, App.Credential.id)).success &&
      (this.cancelButton.enable(), this.emit(SocialMenu.REFRESH));
  }
}
class SocialMenuScrollbar extends PIXI.Graphics {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.bh = this.h - 39;
    this.oy = 0;
    this.alpha = 0.5;
    this.lineStyle(1, 16777215, 0.8, 0);
    this.drawRoundedRect(0, -5, 20, this.h, 4);
    this.endFill();
    this.interactive = !0;
    this.hitArea = new PIXI.Rectangle(-10, -4, 32, this.h);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, -3, 16, 35, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = this.bh * this.start;
    this.on("mouseover", () => {
      this.alpha = 0.8;
    });
    this.on("mouseout", () => {
      this.alpha = 0.5;
    });
    this.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.on("mousemove", (c) => {
      this.scroll(c.data.global.y / App.Scale);
    });
    this.wheelListener = (c) => {
      c = c.data.delta;
      this.scrolling = !0;
      this.scroll(this.oy + 0.2 * c);
      this.scrolling = !1;
    };
  }
  enableWheel() {
    UserInput.ExclusiveWheel = this.wheelListener;
  }
  disableWheel() {
    UserInput.ExclusiveWheel = null;
  }
  scroll(a) {
    if (this.scrolling) {
      let b = this.scrollButton.y + (a - this.oy);
      b = 0 > b ? 0 : b > this.bh ? this.bh : b;
      let c = (1 / this.h) * b * (this.h / this.bh);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(SocialMenuScrollbar.SCROLL, c);
    }
  }
  reset() {
    this.scrollButton.y = (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
SocialMenuScrollbar.SCROLL = "scroll";
class FriendDropdown extends PIXI.Container {
  constructor() {
    super();
    this.id = null;
    this.background = new PIXI.Graphics();
    this.messageRow = new FriendDropdownActionRow(
      "Message",
      FriendDropdown.Action.MESSAGE,
      16777215
    );
    this.messageRow.on(FriendDropdownActionRow.SELECT, () =>
      this.emit(SocialMenu.SHOW_CHAT, this.id)
    );
    this.unfriendRow = new FriendDropdownActionRow(
      "Unfriend",
      FriendDropdown.Action.UNFRIEND,
      11141120,
      !0
    );
    this.unfriendRow.on(FriendDropdownActionRow.CONFIRM, () => this.onUnfriend());
    this.goldRow = new FriendDropdownActionRow(
      "Send gold",
      FriendDropdown.Action.SEND_GOLD,
      16763904
    );
    this.goldRow.on(FriendDropdownActionRow.SELECT, () => this.emit(SocialMenu.SEND_GOLD, this.id));
    this.clanRow = new FriendDropdownActionRow(
      "Invite to clan",
      FriendDropdown.Action.CLAN_INVITE,
      5635925
    );
    this.clanRow.on(FriendDropdownActionRow.SELECT, () => this.onInviteToClan());
    this.messageRow.x = 10;
    this.messageRow.y = 4;
    this.goldRow.x = 10;
    this.goldRow.y = 34;
    this.unfriendRow.x = 10;
    this.unfriendRow.y = 64;
    this.clanRow.x = 10;
    this.clanRow.y = 64;
    this.addChild(this.background);
    App.WhiteLabel !== App.WhiteLabel_POKI && this.addChild(this.messageRow);
    this.addChild(this.goldRow);
    this.addChild(this.unfriendRow);
    this.update();
  }
  update(a) {
    this.background.clear();
    this.background.lineStyle(1, 16777215, 0.4, 0.3);
    this.background.beginFill(5592405, 0.9);
    a && a.clanInvite
      ? (this.clanRow.parent || this.addChild(this.clanRow),
        this.background.drawRoundedRect(0, 0, 128, 130, 4),
        (this.unfriendRow.y = 94))
      : (this.clanRow.parent && this.removeChild(this.clanRow),
        this.background.drawRoundedRect(0, 0, 110, 94, 4),
        (this.unfriendRow.y = 64));
    this.background.endFill();
  }
  async onUnfriend() {
    (await APIClient.postUnfriend(this.id, App.Credential.id)) && this.emit(SocialMenu.REFRESH);
  }
  async onInviteToClan() {
    let a = await APIClient.postInviteMember(this.id, App.Credential.id);
    a
      ? !1 === a.success
        ? App.Console.log(a.error)
        : (App.Console.log("Clan invitation sent."), this.emit(SocialMenu.REFRESH))
      : App.Console.log("Unable to send clan invitation.");
  }
}
FriendDropdown.Action = {
  MESSAGE: "message",
  SEND_GOLD: "send_gold",
  UNFRIEND: "unfriend",
  CLAN_INVITE: "clanInvite",
};
class FriendDropdownActionRow extends PIXI.Container {
  constructor(a, b, c, d = !1) {
    super();
    this.text = a;
    this.tintValue = c;
    this.actionText = new PIXI.BitmapText(this.text, { fontName: "Open Sans", fontSize: 24 });
    this.confirmation = d;
    this.confirming = !1;
    this.interactive = !0;
    this.hitArea = new PIXI.Rectangle(0, 0, 100, 30);
    this.actionText.tint = this.tintValue;
    this.actionText.alpha = 0.7;
    this.on("mouseover", () => {
      this.actionText.alpha = 1;
    });
    this.on("mouseout", () => {
      this.actionText.alpha = 0.7;
      this.confirmation && ((this.confirming = !1), (this.actionText.text = this.text));
    });
    this.on("mousedown", () => {
      this.confirmation
        ? this.confirming
          ? this.emit(FriendDropdownActionRow.CONFIRM)
          : ((this.actionText.text = "Confirm?"), (this.confirming = !0))
        : this.emit(FriendDropdownActionRow.SELECT);
    });
    this.addChild(this.actionText);
  }
}
FriendDropdownActionRow.CONFIRM = "confirm";
FriendDropdownActionRow.SELECT = "select";
class SocialMemberDropdown extends PIXI.Container {
  constructor() {
    super();
    this.id = null;
    this.background = new PIXI.Graphics();
    this.background.lineStyle(1, 16777215, 0.4, 0);
    this.background.beginFill(5592405, 0.9);
    this.background.drawRoundedRect(0, 0, 110, 32, 4);
    this.background.endFill();
    this.messageRow = new SocialMemberDropdownActionRow(
      "Message",
      SocialMemberDropdown.Action.MESSAGE,
      16777215
    );
    this.messageRow.on(SocialMemberDropdownActionRow.SELECT, () =>
      this.emit(SocialMenu.SHOW_CHAT, this.id)
    );
    this.messageRow.x = 10;
    this.messageRow.y = 4;
    this.addChild(this.background);
    App.WhiteLabel !== App.WhiteLabel_POKI && this.addChild(this.messageRow);
  }
  async onUnfriend() {
    (await APIClient.postUnfriend(this.id, App.Credential.id)) && this.emit(SocialMenu.REFRESH);
  }
}
SocialMemberDropdown.Action = { MESSAGE: "message" };
class SocialMemberDropdownActionRow extends PIXI.Container {
  constructor(a, b, c, d = !1) {
    super();
    this.text = a;
    this.tintValue = c;
    this.actionText = new PIXI.BitmapText(this.text, { fontName: "Open Sans", fontSize: 24 });
    this.confirmation = d;
    this.confirming = !1;
    this.interactive = !0;
    this.hitArea = new PIXI.Rectangle(0, 0, 100, 30);
    this.actionText.tint = this.tintValue;
    this.actionText.alpha = 0.7;
    this.on("mouseover", () => {
      this.actionText.alpha = 1;
    });
    this.on("mouseout", () => {
      this.actionText.alpha = 0.7;
      this.confirmation && ((this.confirming = !1), (this.actionText.text = this.text));
    });
    this.on("mousedown", () => {
      this.confirmation
        ? this.confirming
          ? this.emit(SocialMemberDropdownActionRow.CONFIRM)
          : ((this.actionText.text = "Confirm?"), (this.confirming = !0))
        : this.emit(SocialMemberDropdownActionRow.SELECT);
    });
    this.addChild(this.actionText);
  }
}
SocialMemberDropdownActionRow.CONFIRM = "confirm";
SocialMemberDropdownActionRow.SELECT = "select";
class GoldWindow extends PIXI.Container {
  constructor() {
    super();
    this.id = null;
    this.dragging = this.active = !1;
    this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.lineStyle(1, 16777215, 0.1);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRoundedRect(0, 0, 170, 110, 4);
    this.background.endFill();
    this.addChild(this.background);
    this.on("mousedown", (a) => {
      this.dragging = !0;
      this.ox = a.data.global.x;
      this.oy = a.data.global.y;
    });
    this.on("mouseup", () => {
      this.dragging = !1;
      this.parent.ignoreInput = !1;
    });
    this.on("mouseupoutside", () => {
      this.dragging = !1;
      this.parent.ignoreInput = !1;
    });
    this.on("mousemove", (a) => {
      if (this.dragging) {
        var b = a.data.global.x;
        a = a.data.global.y;
        var c = a - this.oy;
        this.x += b - this.ox;
        this.y += c;
        this.ox = b;
        this.oy = a;
        this.parent && (this.parent.ignoreInput = !0);
      }
    });
    this.title = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 22,
      multiline: !0,
      align: "center",
    });
    this.title.x = 4;
    this.title.y = 3;
    this.title.tint = 16763904;
    this.errorMsg = new PIXI.BitmapText("", { fontName: "Open Sans", fontSize: 22 });
    this.errorMsg.x = 0.5 * this.background.width;
    this.errorMsg.y = 82;
    this.errorMsg.anchor.x = 0.5;
    this.errorMsg.tint = 16746496;
    this.inputField = new InputField("gold_value");
    this.inputField.setDimensions(80, 30);
    this.inputField.forceLowerCase = !1;
    this.inputField.setMaxChars(4);
    this.inputField.x = 0.5 * (this.background.width - this.inputField.width);
    this.inputField.y = 48;
    this.inputField.setFilter(UserInput.NUMERIC);
    this.inputField.addListener(InputField.SUBMIT, (a) => this.onSubmitGold(a.data.value));
    this.addChild(this.background);
    this.addChild(this.title);
    this.addChild(this.errorMsg);
    this.addChild(this.inputField);
  }
  load(a) {
    this.id = a;
    this.title.text = "Send gold to " + SocialMenu.Friends[this.id].name + "\n(max 1000/hour)";
    this.errorMsg.text = "";
    this.inputField.setText("0");
  }
  async onSubmitGold(a) {
    a = parseInt(a, 10);
    1e3 < a && (this.errorMsg.text = "1000 is the maximum.");
    const b = await APIClient.postFriendGold(this.id, a, App.Credential.id);
    b &&
      (b.success
        ? (this.inputField.setText("0"), (this.errorMsg.text = a + " gold sent"))
        : (this.errorMsg.text = b.error));
  }
}
class ChatWindow extends PIXI.Graphics {
  constructor() {
    super();
    this.id = null;
    this.dragging = !1;
    this.interactive = !0;
    this.active = !1;
    this.convo = null;
    this.messages = [];
    this.oy = this.ox = 0;
    this.lineStyle(1, 16777215, 0.1);
    this.beginFill(3355443, 0.9);
    this.drawRoundedRect(0, 0, 400, 220, 4);
    this.endFill();
    this.on("mousedown", (a) => {
      this.dragging = !0;
      this.ox = a.data.global.x;
      this.oy = a.data.global.y;
    });
    this.on("mouseup", () => {
      this.dragging = !1;
      this.parent.ignoreInput = !1;
    });
    this.on("mouseupoutside", () => {
      this.dragging = !1;
      this.parent.ignoreInput = !1;
    });
    this.on("mousemove", (a) => {
      if (this.dragging) {
        var b = a.data.global.x;
        a = a.data.global.y;
        var c = a - this.oy;
        this.x += b - this.ox;
        this.y += c;
        this.ox = b;
        this.oy = a;
        this.parent && (this.parent.ignoreInput = !0);
      }
    });
    this.title = new PIXI.BitmapText("", { fontName: "Open Sans", fontSize: 22 });
    this.title.x = 4;
    this.title.y = 3;
    this.title.tint = 16763904;
    this.scrollbar = new SocialMenuScrollbar(186, 1);
    this.scrollbar.x = 378;
    this.scrollbar.y = 8;
    this.closeButton = new PIXI.Sprite(App.CombinedTextures.exit);
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.alpha = 0.5;
    this.closeButton.interactive = !0;
    this.closeButton.x = this.width - 28;
    this.closeButton.y = 2;
    this.closeButton.on("mousedown", (a) => {
      this.closeButton.alpha = 0.5;
      this.emit(ChatWindow.CLOSE);
    });
    this.closeButton.on("mouseover", (a) => {
      this.closeButton.alpha = 1;
    });
    this.closeButton.on("mouseout", (a) => {
      this.closeButton.alpha = 0.5;
    });
    this.inputField = new InputField("chat_msg");
    this.inputField.setDimensions(400, 30);
    this.inputField.forceLowerCase = !1;
    this.inputField.setMaxChars(72);
    this.inputField.x = 0;
    this.inputField.y = this.height - 30;
    this.inputField.setFilter(
      UserInput.ALPHANUMERIC + UserInput.CHAT_SYMBOLS + UserInput.ALPHA_EXT
    );
    this.inputField.addListener(InputField.SUBMIT, (a) => this.onSubmitMessage(a.data.value));
    for (let a = 0; a < ChatWindow.MaxMessages; a++) {
      const b = new PIXI.BitmapText("", {
        fontName: "Open Sans",
        fontSize: 22,
        multiline: !0,
        align: "left",
      });
      b.maxWidth = 360;
      b.interactive = !1;
      b.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
      this.addChild(b);
      this.messages.push(b);
    }
    this.addChild(this.title);
    this.addChild(this.inputField);
    this.addChild(this.closeButton);
  }
  async onSubmitMessage(a) {
    const b = await APIClient.postFriendMessage(this.id, a, App.Credential.id);
    this.inputField.setText("");
    SocialMenu.MODE_GAME || this.inputField.setFocus(!0);
    b.success
      ? ChatWindow.PutMessage({ target: this.id, message: a, created: Date.now() }, !0)
      : ChatWindow.PutMessage(
          { target: this.id, message: b.error, created: Date.now(), error: !0 },
          !0
        );
    this.loadConversation();
  }
  loadConversation(a) {
    void 0 !== a && (this.id = a);
    this.title.text = "Messaging " + SocialMenu.Friends[this.id].name;
    this.convo =
      void 0 === ChatWindow.Conversations[this.id]
        ? (ChatWindow.Conversations[this.id] = { messages: [] })
        : ChatWindow.Conversations[this.id];
    a = 0;
    for (let b = ChatWindow.MaxMessages - 1; 0 <= b; b--) {
      const c = this.convo.messages[b],
        d = this.messages[b];
      c
        ? ((d.text =
            (c.own ? (c.error ? "Error: " : "You: ") : SocialMenu.Friends[this.id].name + ": ") +
            c.text),
          (a += d.height + 4),
          (d.x = 8),
          (d.y = 192 - a),
          (d.tint = c.own ? (c.error ? 16711680 : 13434828) : 13421823),
          (d.alpha = 16 > d.y ? 0 : 1))
        : (d.text = "");
    }
  }
}
ChatWindow.Conversations = {};
ChatWindow.CLOSE = "close";
ChatWindow.PutMessage = (a, b) => {
  let c = ChatWindow.Conversations[a.target];
  void 0 === c && (c = ChatWindow.Conversations[a.target] = { messages: [] });
  c.messages.length === ChatWindow.MaxMessages && c.messages.shift();
  c.messages.push({ own: b, text: a.message, created: a.created, error: a.error ? !0 : !1 });
  b ||
    ("1" === a.system
      ? App.Console.log("[SYS] " + a.message, 16763904)
      : App.Console.log("[PM] " + SocialMenu.Friends[a.target].name + ": " + a.message, 3407667));
};
ChatWindow.UpdateConversations = (a) => {
  for (let b = 0; b < a.messages.length; b++) ChatWindow.PutMessage(a.messages[b], !1);
};
ChatWindow.MaxMessages = 8;
var imgbutton = {};
class ImgButton extends PIXI.Sprite {
  constructor(a = ImgButton.TYPE_CLOSE, b = !0) {
    let c = null;
    switch (a) {
      case ImgButton.TYPE_CLOSE:
        c = App.CombinedTextures.exit;
    }
    super(c);
    this.type = a;
    this.enabled = b;
    this.interactive = !0;
    this.alpha = this.enabled ? 0.7 : 0.4;
    this.on("mouseover", () => this.onMouseOver());
    this.on("mouseout", () => this.onMouseOut());
    this.on("mousedown", () => this.onMouseDown());
    this.on("touchstart", () => this.onMouseDown());
  }
  mobileSetup() {
    App.IsMobile &&
      this.type === ImgButton.TYPE_CLOSE &&
      ((this.scale.x = this.scale.y *= 1.4), (this.x -= 10), (this.y -= 2));
  }
  onMouseOver() {
    this.enabled && ((this.alpha = 1), AudioEffects.ButtonHover.audio.play());
  }
  onMouseDown() {
    this.enabled &&
      ((this.alpha = 0.7), this.emit(ImgButton.CLICK), AudioEffects.ButtonClick.audio.play());
  }
  onMouseOut() {
    this.enabled && (this.alpha = 0.7);
  }
  setEnabled(a) {
    this.alpha = (this.enabled = a) ? 0.7 : 0.4;
  }
}
ImgButton.TYPE_CLOSE = "close";
ImgButton.CLICK = "click";
var rankingmenu = {};
class RankingMenu extends Feature {
  constructor() {
    super();
    this.lastRefresh = 0;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 1);
    this.background.drawRect(0, 0, 660, 524, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504, 10);
    this.background.endFill();
    this.background.drawRect(15, 42, 630, 2);
    this.container.addChild(this.background);
    this.ox = 40;
    this.oy = 20;
    this.display = RankingMenu.GLOBAL_RANKING;
    this.titleText = new PIXI.Text("Ranking & statistics", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleText.x = 0.5 * this.width - 20;
    this.titleText.y = this.oy + 36;
    this.titleText.anchor.x = 0.5;
    this.container.addChild(this.titleText);
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy + 34;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.RANKING_CANCEL));
    this.container.addChild(this.closeButton);
    this.globalRankingButton = new PIXI.Graphics();
    this.globalRankingButton.lineStyle(1, 16777215, 0.1, 0);
    this.globalRankingButton.beginFill(16777215, 0.2);
    this.globalRankingButton.drawRect(0, 0, 130, 24, 4);
    this.globalRankingButton.endFill();
    this.globalRankingButton.x = 0.5 * this.background.width - 220;
    this.globalRankingButton.y = this.oy + 68;
    this.globalRankingButton.tint = 13421772;
    this.globalRankingButton.alpha = 0.5;
    this.globalRankingButton.interactive = !0;
    this.globalRankingButton.on("mouseover", () => {
      this.globalRankingLabel.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.globalRankingButton.on("mouseout", () => {
      this.globalRankingLabel.alpha = this.display === RankingMenu.GLOBAL_RANKING ? 1 : 0.5;
    });
    this.globalRankingButton.on("mousedown", () => this.displayGlobalRanking());
    this.globalRankingButton.on("touchstart", () => this.displayGlobalRanking());
    this.container.addChild(this.globalRankingButton);
    this.globalRankingLabel = new PIXI.Text("Experience", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16759552,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.globalRankingLabel.alpha = 0.7;
    this.globalRankingLabel.x =
      this.globalRankingButton.x +
      0.5 * (this.globalRankingButton.width - this.globalRankingLabel.width);
    this.globalRankingLabel.y = this.globalRankingButton.y + 1;
    this.globalRankingLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.globalRankingLabel);
    this.skillRankingButton = new PIXI.Graphics();
    this.skillRankingButton.lineStyle(1, 16777215, 0.1, 0);
    this.skillRankingButton.beginFill(16777215, 0.2);
    this.skillRankingButton.drawRect(0, 0, 130, 24, 4);
    this.skillRankingButton.endFill();
    this.skillRankingButton.x = this.globalRankingButton.x + this.globalRankingButton.width + 8;
    this.skillRankingButton.y = this.globalRankingButton.y;
    this.skillRankingButton.tint = 13421772;
    this.skillRankingButton.alpha = 1;
    this.skillRankingButton.interactive = !0;
    this.skillRankingButton.on("mouseover", () => {
      this.skillRankingLabel.alpha = 1;
    });
    this.skillRankingButton.on("mouseout", () => {
      this.skillRankingLabel.alpha = this.display === RankingMenu.SKILL_RANKING ? 1 : 0.5;
    });
    this.skillRankingButton.on("mousedown", () => this.displaySkillRanking());
    this.skillRankingButton.on("touchstart", () => this.displaySkillRanking());
    this.container.addChild(this.skillRankingButton);
    this.skillRankingLabel = new PIXI.Text("Skill", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16759552,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillRankingLabel.alpha = 1;
    this.skillRankingLabel.x =
      this.skillRankingButton.x +
      0.5 * (this.skillRankingButton.width - this.skillRankingLabel.width);
    this.skillRankingLabel.y = this.skillRankingButton.y + 1;
    this.skillRankingLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.skillRankingLabel);
    this.weaponStatsButton = new PIXI.Graphics();
    this.weaponStatsButton.lineStyle(1, 16777215, 0.1, 0);
    this.weaponStatsButton.beginFill(16777215, 0.2);
    this.weaponStatsButton.drawRect(0, 0, 130, 24, 4);
    this.weaponStatsButton.endFill();
    this.weaponStatsButton.x = this.skillRankingButton.x + this.skillRankingButton.width + 8;
    this.weaponStatsButton.y = this.skillRankingButton.y;
    this.weaponStatsButton.tint = 13421772;
    this.weaponStatsButton.alpha = 0.5;
    this.weaponStatsButton.interactive = !0;
    this.weaponStatsButton.on("mouseover", () => {
      this.weaponStatsLabel.alpha = 1;
    });
    this.weaponStatsButton.on("mouseout", () => {
      this.weaponStatsLabel.alpha = this.display === RankingMenu.WEAPON_STATS ? 1 : 0.5;
    });
    this.weaponStatsButton.on("mousedown", () => this.displayWeaponStats());
    this.weaponStatsButton.on("touchstart", () => this.displayWeaponStats());
    this.container.addChild(this.weaponStatsButton);
    this.weaponStatsLabel = new PIXI.Text("Weapons", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16759552,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.weaponStatsLabel.alpha = 0.5;
    this.weaponStatsLabel.x =
      this.weaponStatsButton.x + 0.5 * (this.weaponStatsButton.width - this.weaponStatsLabel.width);
    this.weaponStatsLabel.y = this.weaponStatsButton.y + 1;
    this.weaponStatsLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.weaponStatsLabel);
    this.globalRankingContainer = new PIXI.Container();
    this.skillRankingContainer = new PIXI.Container();
    this.weaponStatsContainer = new PIXI.Container();
    this.weaponTypeContainer = new PIXI.Container();
    this.nameText = new PIXI.Text("Name", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.nameText.x = this.ox + 66;
    this.nameText.y = this.oy + 104;
    this.globalRankingContainer.addChild(this.nameText);
    this.levelText = new PIXI.Text("Level", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.levelText.x = this.ox + 246;
    this.levelText.y = this.oy + 104;
    this.globalRankingContainer.addChild(this.levelText);
    this.experienceText = new PIXI.Text("Experience", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.experienceText.x = this.ox + 366;
    this.experienceText.y = this.oy + 104;
    this.globalRankingContainer.addChild(this.experienceText);
    this.socialGlText = new PIXI.Text("Channels", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.socialGlText.x = this.ox + 506;
    this.socialGlText.y = this.oy + 104;
    this.globalRankingContainer.addChild(this.socialGlText);
    this.globalRankingTableContainerMask = new PIXI.Graphics();
    this.globalRankingTableContainerMask.beginFill(16777215, 1);
    this.globalRankingTableContainerMask.drawRect(-10, 150, 640, 390);
    this.globalRankingTableContainerMask.endFill();
    this.globalRankingTableContainerMask.x = 10;
    this.globalRankingContainer.addChild(this.globalRankingTableContainerMask);
    this.globalRankingTableContainer = new PIXI.Container();
    this.globalRankingTableContainer.x = 10;
    this.globalRankingTableContainer.mask = this.globalRankingTableContainerMask;
    this.globalRankingContainer.addChild(this.globalRankingTableContainer);
    this.globalRanking = new GlobalRankingScrollbar(404);
    this.globalRanking.x = 625;
    this.globalRanking.y = 150;
    this.globalRankingContainer.addChild(this.globalRanking);
    this.globalRanking.on(GlobalRankingScrollbar.SCROLL, (a) => {
      this.globalRankingTableContainer.height > this.globalRankingTableContainerMask.height &&
        (this.globalRankingTableContainer.y = -(
          a *
          (this.globalRankingTableContainer.height - this.globalRankingTableContainerMask.height)
        ));
    });
    this.nameSkillText = new PIXI.Text("Name", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.nameSkillText.x = this.ox + 66;
    this.nameSkillText.y = this.oy + 104;
    this.skillRankingContainer.addChild(this.nameSkillText);
    this.skillTitleText = new PIXI.Text("Title", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.skillTitleText.x = this.ox + 270;
    this.skillTitleText.y = this.oy + 104;
    this.skillRankingContainer.addChild(this.skillTitleText);
    this.skillText = new PIXI.Text("Skill", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.skillText.x = this.ox + 410;
    this.skillText.y = this.oy + 104;
    this.skillRankingContainer.addChild(this.skillText);
    this.socialText = new PIXI.Text("Channels", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.socialText.x = this.ox + 506;
    this.socialText.y = this.oy + 104;
    this.skillRankingContainer.addChild(this.socialText);
    this.skillRankingTableContainerMask = new PIXI.Graphics();
    this.skillRankingTableContainerMask.beginFill(16777215, 1);
    this.skillRankingTableContainerMask.drawRect(-10, 150, 640, 390);
    this.skillRankingTableContainerMask.endFill();
    this.skillRankingTableContainerMask.x = 10;
    this.skillRankingContainer.addChild(this.skillRankingTableContainerMask);
    this.skillRankingTableContainer = new PIXI.Container();
    this.skillRankingTableContainer.x = 10;
    this.skillRankingTableContainer.mask = this.skillRankingTableContainerMask;
    this.skillRankingContainer.addChild(this.skillRankingTableContainer);
    this.skillRanking = new SkillRankingScrollbar(404);
    this.skillRanking.x = 625;
    this.skillRanking.y = 150;
    this.skillRankingContainer.addChild(this.skillRanking);
    this.skillRanking.on(SkillRankingScrollbar.SCROLL, (a) => {
      this.skillRankingTableContainer.height > this.skillRankingTableContainerMask.height &&
        (this.skillRankingTableContainer.y = -(
          a *
          (this.skillRankingTableContainer.height - this.skillRankingTableContainerMask.height)
        ));
    });
    this.weaponTypeText = new PIXI.Text("Weapon type", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.weaponTypeText.x = this.ox - 4;
    this.weaponTypeText.y = this.oy + 104;
    this.weaponStatsContainer.addChild(this.weaponTypeText);
    this.weaponKillsText = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.weaponKillsText.x = this.ox + 390;
    this.weaponKillsText.y = this.oy + 104;
    this.weaponStatsContainer.addChild(this.weaponKillsText);
    this.weaponStatsTableContainerMask = new PIXI.Graphics();
    this.weaponStatsTableContainerMask.beginFill(16777215, 1);
    this.weaponStatsTableContainerMask.drawRect(-10, 150, 640, 390);
    this.weaponStatsTableContainerMask.endFill();
    this.weaponStatsTableContainerMask.x = 10;
    this.weaponStatsContainer.addChild(this.weaponStatsTableContainerMask);
    this.weaponStatsTableContainer = new PIXI.Container();
    this.weaponStatsTableContainer.x = 10;
    this.weaponStatsTableContainer.mask = this.weaponStatsTableContainerMask;
    this.weaponStatsContainer.addChild(this.weaponStatsTableContainer);
    this.weaponStats = new WeaponStatsScrollbar(404);
    this.weaponStats.x = 625;
    this.weaponStats.y = 150;
    this.weaponStatsContainer.addChild(this.weaponStats);
    this.weaponStats.on(WeaponStatsScrollbar.SCROLL, (a) => {
      this.weaponStatsTableContainer.height > this.weaponStatsTableContainerMask.height &&
        (this.weaponStatsTableContainer.y = -(
          a *
          (this.weaponStatsTableContainer.height - this.weaponStatsTableContainerMask.height)
        ));
    });
    this.weaponTypeIcon = null;
    this.weaponTypeLabel = new PIXI.Text("loading...", {
      fontName: "Arial",
      fontSize: 20,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.weaponTypeLabel.x = this.ox + 280;
    this.weaponTypeLabel.y = this.oy + 110;
    this.weaponTypeContainer.addChild(this.weaponTypeLabel);
    this.weaponTypeNameText = new PIXI.Text("Name", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.weaponTypeNameText.x = this.ox + 70;
    this.weaponTypeNameText.y = this.oy + 150;
    this.weaponTypeContainer.addChild(this.weaponTypeNameText);
    this.weaponTypeKillsText = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.weaponTypeKillsText.x = this.ox + 390;
    this.weaponTypeKillsText.y = this.oy + 150;
    this.weaponTypeContainer.addChild(this.weaponTypeKillsText);
    this.weaponTypeTableContainerMask = new PIXI.Graphics();
    this.weaponTypeTableContainerMask.beginFill(16777215, 1);
    this.weaponTypeTableContainerMask.drawRect(-10, 200, 640, 350);
    this.weaponTypeTableContainerMask.endFill();
    this.weaponTypeTableContainerMask.x = 10;
    this.weaponTypeContainer.addChild(this.weaponTypeTableContainerMask);
    this.weaponTypeTableContainer = new PIXI.Container();
    this.weaponTypeTableContainer.x = 10;
    this.weaponTypeTableContainer.y = 50;
    this.weaponTypeTableContainer.mask = this.weaponTypeTableContainerMask;
    this.weaponTypeContainer.addChild(this.weaponTypeTableContainer);
    this.weaponType = new WeaponTypeStatsScrollbar(354);
    this.weaponType.x = 625;
    this.weaponType.y = 200;
    this.weaponTypeContainer.addChild(this.weaponType);
    this.weaponType.on(WeaponTypeStatsScrollbar.SCROLL, (a) => {
      this.weaponTypeTableContainer.height > this.weaponTypeTableContainerMask.height &&
        (this.weaponTypeTableContainer.y =
          -(a * (this.weaponTypeTableContainer.height - this.weaponTypeTableContainerMask.height)) +
          50);
    });
    this.container.x = 0.5 * -this.width;
    this.displaySkillRanking();
  }
  onCloseButtonReleased() {
    this.emit(Layer.Events.RANKING_CANCEL);
  }
  async show() {
    this.globalRanking.disableWheel();
    this.skillRanking.disableWheel();
    this.weaponStats.disableWheel();
    this.weaponType.disableWheel();
    switch (this.display) {
      case RankingMenu.GLOBAL_RANKING:
        this.globalRanking.enableWheel();
        break;
      case RankingMenu.SKILL_RANKING:
        this.skillRanking.enableWheel();
        break;
      case RankingMenu.WEAPON_STATS:
        this.weaponStats.enableWheel();
        break;
      case RankingMenu.WEAPON_USERS:
        this.weaponType.enableWheel();
    }
    var a = Date.now();
    if (
      !(6e4 > a - this.lastRefresh) &&
      ((this.lastRefresh = a),
      (a = await APIClient.getRanking()),
      a.success && a.level_ranking && a.skill_ranking)
    ) {
      this.globalRankingTableContainer.removeChildren();
      for (var b = 0; b < a.level_ranking.length; b++) {
        const d = a.level_ranking[b];
        var c = new GlobalRankingTableRow(b, d.id, d.name, d.level, d.experience, d.tw, d.yt);
        c.x = this.ox + 20;
        c.y = this.oy + 36 * b + 130;
        c.on("mousedown", () => {
          this.emit(Layer.Events.USER_ACCESS, d.account_id, !1);
          AudioEffects.ButtonClick.audio.play();
        });
        c.on("touchstart", () => {
          this.emit(Layer.Events.USER_ACCESS, d.account_id, !1);
          AudioEffects.ButtonClick.audio.play();
        });
        this.globalRankingTableContainer.addChild(c);
      }
      this.skillRankingTableContainer.removeChildren();
      for (b = 0; b < a.skill_ranking.length; b++) {
        const d = a.skill_ranking[b];
        c = new SkillRankingTableRow(
          b,
          d.id,
          d.name,
          Game.MapSkillToTitle(d.skill),
          d.skill,
          d.yt,
          d.tw
        );
        c.x = this.ox + 20;
        c.y = this.oy + 36 * b + 130;
        c.on("mousedown", () => {
          this.emit(Layer.Events.USER_ACCESS, d.account_id, !1);
          AudioEffects.ButtonClick.audio.play();
        });
        c.on("touchstart", () => {
          this.emit(Layer.Events.USER_ACCESS, d.account_id, !1);
          AudioEffects.ButtonClick.audio.play();
        });
        this.skillRankingTableContainer.addChild(c);
      }
      a = await APIClient.getWeaponRanking();
      if (a.success && a.ranking)
        for (this.weaponStatsTableContainer.removeChildren(), b = 0; b < a.ranking.length; b++) {
          const d = a.ranking[b];
          c = new WeaponStatsTableRow(b, d.id, d.kills);
          c.x = this.ox - 20;
          c.y = this.oy + 42 * b + 130;
          c.on("mousedown", () => {
            this.displayWeaponUsers(d.id);
            AudioEffects.ButtonClick.audio.play();
          });
          c.on("touchstart", () => {
            this.displayWeaponUsers(d.id);
            AudioEffects.ButtonClick.audio.play();
          });
          this.weaponStatsTableContainer.addChild(c);
        }
    }
  }
  hide() {
    this.globalRanking.disableWheel();
    this.skillRanking.disableWheel();
    this.weaponStats.disableWheel();
    this.weaponType.disableWheel();
  }
  displayGlobalRanking() {
    this.globalRanking.enableWheel();
    this.skillRanking.disableWheel();
    this.weaponStats.disableWheel();
    this.weaponType.disableWheel();
    AudioEffects.ButtonClick.audio.play();
    this.globalRankingContainer.parent || this.container.addChild(this.globalRankingContainer);
    this.weaponStatsContainer.parent && this.container.removeChild(this.weaponStatsContainer);
    this.weaponTypeContainer.parent && this.container.removeChild(this.weaponTypeContainer);
    this.skillRankingContainer.parent && this.container.removeChild(this.skillRankingContainer);
    this.globalRankingButton.alpha = 1;
    this.globalRankingLabel.alpha = 1;
    this.weaponStatsButton.alpha = 0.5;
    this.weaponStatsLabel.alpha = 0.5;
    this.skillRankingButton.alpha = 0.5;
    this.skillRankingLabel.alpha = 0.5;
    this.display = RankingMenu.GLOBAL_RANKING;
  }
  displaySkillRanking() {
    this.globalRanking.disableWheel();
    this.skillRanking.enableWheel();
    this.weaponStats.disableWheel();
    this.weaponType.disableWheel();
    AudioEffects.ButtonClick.audio.play();
    this.skillRankingContainer.parent || this.container.addChild(this.skillRankingContainer);
    this.weaponTypeContainer.parent && this.container.removeChild(this.weaponTypeContainer);
    this.weaponStatsContainer.parent && this.container.removeChild(this.weaponStatsContainer);
    this.globalRankingContainer.parent && this.container.removeChild(this.globalRankingContainer);
    this.globalRankingButton.alpha = 0.5;
    this.globalRankingLabel.alpha = 0.5;
    this.weaponStatsButton.alpha = 0.5;
    this.weaponStatsLabel.alpha = 0.5;
    this.skillRankingButton.alpha = 1;
    this.skillRankingLabel.alpha = 1;
    this.display = RankingMenu.SKILL_RANKING;
  }
  displayWeaponStats() {
    this.globalRanking.disableWheel();
    this.skillRanking.disableWheel();
    this.weaponStats.enableWheel();
    this.weaponType.disableWheel();
    AudioEffects.ButtonClick.audio.play();
    this.weaponStatsContainer.parent || this.container.addChild(this.weaponStatsContainer);
    this.globalRankingContainer.parent && this.container.removeChild(this.globalRankingContainer);
    this.weaponTypeContainer.parent && this.container.removeChild(this.weaponTypeContainer);
    this.skillRankingContainer.parent && this.container.removeChild(this.skillRankingContainer);
    this.globalRankingButton.alpha = 0.5;
    this.globalRankingLabel.alpha = 0.5;
    this.weaponStatsButton.alpha = 1;
    this.weaponStatsLabel.alpha = 1;
    this.skillRankingButton.alpha = 0.5;
    this.skillRankingLabel.alpha = 0.5;
    this.display = RankingMenu.WEAPON_STATS;
  }
  async displayWeaponUsers(a) {
    this.globalRanking.disableWheel();
    this.skillRanking.disableWheel();
    this.weaponStats.disableWheel();
    this.weaponType.enableWheel();
    this.weaponTypeContainer.parent || this.container.addChild(this.weaponTypeContainer);
    this.weaponStatsContainer.parent && this.container.removeChild(this.weaponStatsContainer);
    this.weaponTypeIcon &&
      this.weaponTypeIcon.parent &&
      (this.weaponTypeContainer.removeChild(this.weaponTypeIcon), (this.weaponTypeIcon = null));
    this.weaponTypeIcon = Game.MapEventWepToIcon(a);
    this.weaponTypeIcon.x = this.ox + 190;
    this.weaponTypeIcon.y = this.oy + 130;
    var b = this.weaponTypeIcon.width,
      c = this.weaponTypeIcon.height;
    let d = b > c ? (38 < b ? 38 : b) : 32 < c ? 32 : c;
    this.weaponTypeIcon.scale.x = this.weaponTypeIcon.scale.y =
      b > c ? d / this.weaponTypeIcon.width : d / this.weaponTypeIcon.height;
    this.weaponTypeIcon.rotation = -0.2;
    this.weaponTypeContainer.addChild(this.weaponTypeIcon);
    b = Game.MapEventWepToId(a);
    b = void 0 !== ItemMap[b] ? ItemMap[b].title : a;
    this.weaponTypeLabel.text = "Loading...";
    this.weaponTypeTableContainer.removeChildren();
    a = await APIClient.getWeaponRankingType(a);
    this.weaponTypeTableContainer.removeChildren();
    this.weaponTypeLabel.text = b;
    if (a.success && a.ranking)
      for (b = 0; b < a.ranking.length; b++) {
        const e = a.ranking[b];
        c = new WeaponTypeStatsTableRow(b, e.id, e.name, e.kills);
        c.x = this.ox - 20;
        c.y = this.oy + 42 * b + 130;
        c.on("mousedown", () => {
          this.emit(Layer.Events.USER_ACCESS, e.accountId, !1);
          AudioEffects.ButtonClick.audio.play();
        });
        c.on("touchstart", () => {
          this.emit(Layer.Events.USER_ACCESS, e.accountId, !1);
          AudioEffects.ButtonClick.audio.play();
        });
        this.weaponTypeTableContainer.addChild(c);
      }
  }
}
RankingMenu.GLOBAL_RANKING = "globalRanking";
RankingMenu.SKILL_RANKING = "skillRanking";
RankingMenu.WEAPON_STATS = "weaponStats";
RankingMenu.WEAPON_USERS = "weaponUsers";
class GlobalRankingTableRow extends PIXI.Container {
  constructor(a, b, c, d, e, f, g) {
    super();
    this.index = a;
    this.interactive = !0;
    a = Math.max(Math.floor((d / 160) * 10) + 1);
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.1);
    this.background.drawRect(-10, 2, 560, 32);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    });
    this.addChild(this.background);
    this.icon = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + a]);
    this.icon.x = -48;
    this.icon.y = -2;
    this.icon.scale.x = this.icon.scale.y = 0.5;
    this.addChild(this.icon);
    this.rankText = new PIXI.BitmapText(b, { fontName: "Open Sans", fontSize: 22 });
    this.rankText.x = 0;
    this.rankText.y = 9;
    this.rankText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.rankText.tint = 16763904;
    this.addChild(this.rankText);
    this.nameText = new PIXI.BitmapText(c, { fontName: "Open Sans", fontSize: 22 });
    this.nameText.x = 40;
    this.nameText.y = 9;
    this.nameText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.nameText);
    this.levelText = new PIXI.BitmapText(numberWithPeriods(d), {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.levelText.x = 220;
    this.levelText.y = 9;
    this.levelText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.levelText);
    this.experienceText = new PIXI.BitmapText(numberWithPeriods(e), {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.experienceText.x = 340;
    this.experienceText.y = 9;
    this.experienceText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.experienceText);
    this.ytIcon = new PIXI.Sprite(App.CombinedTextures.youtube_logo);
    this.ytIcon.scale.x = this.ytIcon.scale.y = 0.4;
    this.ytIcon.x = 478;
    this.ytIcon.y = 9;
    this.addChild(this.ytIcon);
    "" !== g
      ? ((this.ytIcon.interactive = !0),
        (this.ytIcon.alpha = 0.8),
        this.ytIcon.on("mouseover", () => (this.ytIcon.alpha = 1)),
        this.ytIcon.on("mouseout", () => (this.ytIcon.alpha = 0.8)),
        this.ytIcon.on("mousedown", (h) => {
          window.open(g, "_blank");
          h.stopPropagation();
        }),
        this.ytIcon.on("touchstart", (h) => {
          window.open(g, "_blank");
          h.stopPropagation();
        }))
      : (this.ytIcon.alpha = 0.1);
    this.twIcon = new PIXI.Sprite(App.CombinedTextures.twitch_logo);
    this.twIcon.scale.x = this.twIcon.scale.y = 0.6;
    this.twIcon.x = 516;
    this.twIcon.y = 5;
    this.addChild(this.twIcon);
    "" !== f
      ? ((this.twIcon.interactive = !0),
        this.twIcon.on("mouseover", () => (this.twIcon.alpha = 1)),
        this.twIcon.on("mouseout", () => (this.twIcon.alpha = 0.8)),
        this.twIcon.on("mousedown", (h) => {
          window.open(f, "_blank");
          h.stopPropagation();
        }),
        this.twIcon.on("touchstart", (h) => {
          window.open(f, "_blank");
          h.stopPropagation();
        }))
      : (this.twIcon.alpha = 0.1);
    App.WhiteLabel === App.WhiteLabel_POKI &&
      ((this.ytIcon.interactive = !1),
      (this.ytIcon.alpha = 0.1),
      (this.twIcon.interactive = !1),
      (this.twIcon.alpha = 0.1));
  }
}
class GlobalRankingScrollbar extends PIXI.Container {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, this.h, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-4, -4, 32, this.h + 8);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, 0, 16, 32, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.scrollBar.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (c) => {
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (c) => {
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointermove", (c) => this.scroll(c.data.global.y / App.Scale));
    this.wheelListener = (c) => {
      c = c.data.delta;
      this.scrolling = !0;
      this.scroll(this.oy + 0.2 * c);
      this.scrolling = !1;
    };
  }
  enableWheel() {
    UserInput.hasListener(UserInput.WHEEL, this.wheelListener) ||
      UserInput.addListener(UserInput.WHEEL, this.wheelListener);
  }
  disableWheel() {
    UserInput.removeListener(UserInput.WHEEL, this.wheelListener);
  }
  scroll(a) {
    if (this.scrolling) {
      let b = this.scrollButton.y + (a - this.oy);
      -3 > b ? (b = -3) : b > this.h - 39 && (b = this.h - 39);
      let c = this.h / (this.h - 39);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(GlobalRankingScrollbar.SCROLL, (1 / this.h) * (b + 3) * c);
    }
  }
  reset() {
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
GlobalRankingScrollbar.SCROLL = "scroll";
class SkillRankingTableRow extends PIXI.Container {
  constructor(a, b, c, d, e, f = "", g = "") {
    super();
    this.index = a;
    this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.1);
    this.background.drawRect(-10, 2, 560, 32);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    });
    this.addChild(this.background);
    this.rankText = new PIXI.BitmapText(b, { fontName: "Open Sans", fontSize: 22 });
    this.rankText.x = 0;
    this.rankText.y = 9;
    this.rankText.tint = 16763904;
    this.rankText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.rankText);
    this.nameText = new PIXI.BitmapText(c, { fontName: "Open Sans", fontSize: 22 });
    this.nameText.x = 40;
    this.nameText.y = 9;
    this.nameText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.nameText);
    this.titleText = new PIXI.BitmapText(d, { fontName: "Open Sans", fontSize: 22 });
    this.titleText.x = 232;
    this.titleText.y = 9;
    this.titleText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.titleText);
    this.skillText = new PIXI.BitmapText(numberWithPeriods(e), {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.skillText.x = 372;
    this.skillText.y = 9;
    this.skillText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.skillText);
    this.ytIcon = new PIXI.Sprite(App.CombinedTextures.youtube_logo);
    this.ytIcon.scale.x = this.ytIcon.scale.y = 0.4;
    this.ytIcon.x = 478;
    this.ytIcon.y = 9;
    this.addChild(this.ytIcon);
    "" !== f
      ? ((this.ytIcon.interactive = !0),
        (this.ytIcon.alpha = 0.8),
        this.ytIcon.on("mouseover", () => (this.ytIcon.alpha = 1)),
        this.ytIcon.on("mouseout", () => (this.ytIcon.alpha = 0.8)),
        this.ytIcon.on("mousedown", (h) => {
          window.open(f, "_blank");
          h.stopPropagation();
        }),
        this.ytIcon.on("touchstart", (h) => {
          window.open(f, "_blank");
          h.stopPropagation();
        }))
      : (this.ytIcon.alpha = 0.1);
    this.twIcon = new PIXI.Sprite(App.CombinedTextures.twitch_logo);
    this.twIcon.scale.x = this.twIcon.scale.y = 0.6;
    this.twIcon.x = 516;
    this.twIcon.y = 5;
    this.addChild(this.twIcon);
    "" !== g
      ? ((this.twIcon.interactive = !0),
        this.twIcon.on("mouseover", () => (this.twIcon.alpha = 1)),
        this.twIcon.on("mouseout", () => (this.twIcon.alpha = 0.8)),
        this.twIcon.on("mousedown", (h) => {
          window.open(g, "_blank");
          h.stopPropagation();
        }),
        this.twIcon.on("touchstart", (h) => {
          window.open(g, "_blank");
          h.stopPropagation();
        }))
      : (this.twIcon.alpha = 0.1);
    App.WhiteLabel === App.WhiteLabel_POKI &&
      ((this.ytIcon.interactive = !1),
      (this.ytIcon.alpha = 0.1),
      (this.twIcon.interactive = !1),
      (this.twIcon.alpha = 0.1));
  }
}
class SkillRankingScrollbar extends PIXI.Container {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, this.h, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-4, -4, 32, this.h + 8);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, 0, 16, 32, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.scrollBar.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (c) => {
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (c) => {
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointermove", (c) => this.scroll(c.data.global.y / App.Scale));
    this.wheelListener = (c) => {
      c = c.data.delta;
      this.scrolling = !0;
      this.scroll(this.oy + 0.2 * c);
      this.scrolling = !1;
    };
  }
  enableWheel() {
    UserInput.hasListener(UserInput.WHEEL, this.wheelListener) ||
      UserInput.addListener(UserInput.WHEEL, this.wheelListener);
  }
  disableWheel() {
    UserInput.removeListener(UserInput.WHEEL, this.wheelListener);
  }
  scroll(a) {
    if (this.scrolling) {
      let b = this.scrollButton.y + (a - this.oy);
      -3 > b ? (b = -3) : b > this.h - 39 && (b = this.h - 39);
      let c = this.h / (this.h - 39);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(SkillRankingScrollbar.SCROLL, (1 / this.h) * (b + 3) * c);
    }
  }
  reset() {
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
SkillRankingScrollbar.SCROLL = "scroll";
class WeaponStatsTableRow extends PIXI.Container {
  constructor(a, b, c) {
    super();
    var d = Game.MapEventWepToId(b);
    this.id = d;
    d = void 0 !== ItemMap[d] ? ItemMap[d].title : this.id;
    this.index = a.toString();
    this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.1);
    this.background.drawRect(-10, 2, 590, 38);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    });
    this.addChild(this.background);
    this.icon = Game.MapEventWepToIcon(b);
    this.icon.x = 20;
    this.icon.y = 23;
    a = this.icon.width;
    b = this.icon.height;
    let e = a > b ? (24 < a ? 24 : a) : 12 < b ? 12 : b;
    this.icon.scale.x = this.icon.scale.y = a > b ? e / this.icon.width : e / this.icon.height;
    this.icon.rotation = -0.2;
    this.addChild(this.icon);
    this.nameText = new PIXI.BitmapText(d, { fontName: "Open Sans", fontSize: 22 });
    this.nameText.x = 86;
    this.nameText.y = 10;
    this.nameText.tint = 16763904;
    this.nameText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.nameText);
    this.killsText = new PIXI.BitmapText(numberWithPeriods(c), {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.killsText.x = 400;
    this.killsText.y = 10;
    this.killsText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.killsText);
  }
}
class WeaponStatsScrollbar extends PIXI.Container {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, this.h, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-4, -4, 32, this.h + 8);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, 0, 16, 32, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.scrollBar.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (c) => {
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (c) => {
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointermove", (c) => this.scroll(c.data.global.y / App.Scale));
    this.wheelListener = (c) => {
      c = c.data.delta;
      this.scrolling = !0;
      this.scroll(this.oy + 0.2 * c);
      this.scrolling = !1;
    };
  }
  enableWheel() {
    UserInput.hasListener(UserInput.WHEEL, this.wheelListener) ||
      UserInput.addListener(UserInput.WHEEL, this.wheelListener);
  }
  disableWheel() {
    UserInput.removeListener(UserInput.WHEEL, this.wheelListener);
  }
  scroll(a) {
    if (this.scrolling) {
      let b = this.scrollButton.y + (a - this.oy);
      -3 > b ? (b = -3) : b > this.h - 39 && (b = this.h - 39);
      let c = this.h / (this.h - 39);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(WeaponStatsScrollbar.SCROLL, (1 / this.h) * (b + 3) * c);
    }
  }
  reset() {
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
WeaponStatsScrollbar.SCROLL = "scroll";
class WeaponTypeStatsTableRow extends PIXI.Container {
  constructor(a, b, c, d) {
    super();
    this.index = a;
    this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.1);
    this.background.drawRect(-10, 2, 590, 38);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    });
    this.addChild(this.background);
    this.icon = new PIXI.Sprite();
    this.icon.x = 12;
    this.icon.y = 23;
    a = this.icon.width;
    b = this.icon.height;
    let e = a > b ? (24 < a ? 24 : a) : 12 < b ? 12 : b;
    this.icon.scale.x = this.icon.scale.y = a > b ? e / this.icon.width : e / this.icon.height;
    this.icon.rotation = -0.2;
    this.addChild(this.icon);
    this.indexText = new PIXI.BitmapText((this.index + 1).toString(), {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.indexText.x = 20;
    this.indexText.y = 10;
    this.indexText.tint = 16763904;
    this.indexText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.indexText);
    this.nameText = new PIXI.BitmapText(c, { fontName: "Open Sans", fontSize: 22 });
    this.nameText.x = 78;
    this.nameText.y = 10;
    this.nameText.tint = 16763904;
    this.nameText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.nameText);
    this.killsText = new PIXI.BitmapText(numberWithPeriods(d), {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.killsText.x = 400;
    this.killsText.y = 10;
    this.killsText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.killsText);
  }
}
class WeaponTypeStatsScrollbar extends PIXI.Container {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, this.h, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-4, -4, 32, this.h + 8);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, 0, 16, 32, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.scrollBar.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (c) => {
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (c) => {
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointermove", (c) => this.scroll(c.data.global.y / App.Scale));
    this.wheelListener = (c) => {
      c = c.data.delta;
      this.scrolling = !0;
      this.scroll(this.oy + 0.2 * c);
      this.scrolling = !1;
    };
  }
  enableWheel() {
    UserInput.hasListener(UserInput.WHEEL, this.wheelListener) ||
      UserInput.addListener(UserInput.WHEEL, this.wheelListener);
  }
  disableWheel() {
    UserInput.removeListener(UserInput.WHEEL, this.wheelListener);
  }
  scroll(a) {
    if (this.scrolling) {
      let b = this.scrollButton.y + (a - this.oy);
      -3 > b ? (b = -3) : b > this.h - 39 && (b = this.h - 39);
      let c = this.h / (this.h - 39);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(WeaponTypeStatsScrollbar.SCROLL, (1 / this.h) * (b + 3) * c);
    }
  }
  reset() {
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
WeaponTypeStatsScrollbar.SCROLL = "scroll";
var newsmenu = {};
class NewsMenu extends Feature {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504);
    this.background.endFill();
    this.background.drawRect(15, 42, 630, 2);
    this.container.addChild(this.background);
    this.ox = 20;
    this.oy = 60;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy - 6;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.NEWS_CANCEL));
    this.container.addChild(this.closeButton);
    this.newsTitle = new PIXI.Text("News", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.newsTitle.x = 0.5 * this.width - 20;
    this.newsTitle.y = this.oy - 4;
    this.newsTitle.anchor.x = 0.5;
    this.container.addChild(this.newsTitle);
    this.container.x = 0.5 * -this.width;
    this.newsItemContainer = new PIXI.Container();
    this.newsItemContainer.x = this.ox;
    this.newsItemContainer.y = this.oy + 50;
    this.container.addChild(this.newsItemContainer);
  }
  async show() {
    const a = await APIClient.getNews();
    this.newsItemContainer.removeChildren();
    let b = 0;
    for (let d = 0; d < a.length; d++) {
      var c = a[d];
      c = new NewsItem(c.title, c.message, c.created);
      c.x = 5;
      c.y = b;
      this.newsItemContainer.addChild(c);
      b += c.height + 10;
    }
  }
}
class NewsItem extends PIXI.Container {
  constructor(a, b, c) {
    super();
    c = new Date(Date.parse(c));
    const d = c.getDate().toString().padStart(2, "0"),
      e = (c.getMonth() + 1).toString().padStart(2, "0"),
      f = c.getFullYear();
    c = Date.now() - 864e5 < c.getTime() ? "Today" : d + "-" + e + "-" + f;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 0;
    this.addChild(this.background);
    this.title = new PIXI.Text(c + " - " + a, {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.title.x = 10;
    this.title.y = 0;
    this.title.tint = 16746496;
    this.addChild(this.title);
    this.message = new PIXI.Text(b, {
      fontName: "Arial",
      fontSize: 14,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
      wordWrap: !0,
      wordWrapWidth: 580,
    });
    this.message.x = 10;
    this.message.y = 30;
    this.message.tint = 16777215;
    this.addChild(this.message);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRoundedRect(0, -10, 600, this.height + 20, 8);
    this.background.endFill();
  }
}
var partnermenu = {};
class PartnerMenu extends Feature {
  constructor() {
    super();
    this.partners = [
      { title: "crazygames.com", url: "https://www.crazygames.com/c/io" },
      { title: "silvergames.com", url: "https://www.silvergames.com/" },
      { title: "pacogames.com", url: "https://www.pacogames.com/" },
      { title: "iogames.space", url: "https://www.iogames.space/" },
      { title: "gametop.com", url: "https://www.gametop.com/" },
    ];
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(0, 0, 660, 524, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504, 10);
    this.background.endFill();
    this.container.addChild(this.background);
    this.ox = 20;
    this.oy = 60;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy - 6;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.PARTNER_CANCEL));
    this.container.addChild(this.closeButton);
    this.partnerTitle = new PIXI.BitmapText("Partners", { fontName: "Open Sans", fontSize: 30 });
    this.partnerTitle.x = 0.5 * this.width;
    this.partnerTitle.y = this.oy;
    this.partnerTitle.anchor.x = 0.5;
    this.partnerTitle.tint = 16763904;
    this.container.addChild(this.partnerTitle);
    this.container.x = 0.5 * -this.width;
    for (let a = 0; a < this.partners.length; a++) {
      let b = this.partners[a],
        c = new PIXI.BitmapText(b.title, { fontName: "Open Sans", fontSize: 26 });
      c.x = 0.5 * this.width;
      c.y = this.oy + 44 * a + 92;
      c.anchor.x = 0.5;
      c.tint = 16763904;
      c.interactive = !0;
      c.hitArea = new PIXI.Rectangle(0.5 * -c.width, 8, c.width, c.height);
      c.on("mouseover", () => {
        c.scale.x = c.scale.y = 1.1;
      });
      c.on("mouseout", () => {
        c.scale.x = c.scale.y = 1;
      });
      c.on("mousedown", () => window.open(b.url, "_blank"));
      this.background.beginFill(16777215, 0.1);
      this.background.drawRect(200, this.oy + 44 * (a + 1) + 2, 260, 40);
      this.background.endFill();
      this.container.addChild(c);
    }
  }
  show() {}
}
var serverlistmenu = {};
class ServerListMenu extends Feature {
  constructor() {
    super();
    this.oy = this.ox = 20;
    this.gameList = [];
    this.activeMode = ServerListMenu.MODE_ALL;
    this.activeRegion = ServerListMenu.REGION_ALL;
    this.activePrivate = ServerListMenu.PRIVATE_ALL;
    this.activeRanked = ServerListMenu.RANKED_ALL;
    this.activeCustom = ServerListMenu.CUSTOM_ALL;
    this.sortedCol = ServerListMenu.COL_PLAYERS;
    this.playerSort = this.nameSort = this.regionSort = this.modeSort = ServerListMenu.SORT_DEFAULT;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 1);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504);
    this.background.endFill();
    this.background.beginFill(2105376, 1);
    this.background.drawRect(15, 120, 628, 345);
    this.background.endFill();
    this.background.lineStyle(1, 16777215, 0.25);
    this.background.moveTo(18, this.oy + 125);
    this.background.lineTo(612, this.oy + 125);
    this.container.addChild(this.background);
    this.container.x = 0.5 * -this.width;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy + 34;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.SERVER_LIST_CANCEL));
    this.container.addChild(this.closeButton);
    this.serverListingTitle = new PIXI.Text("Game list", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.serverListingTitle.x = this.ox;
    this.serverListingTitle.y = this.oy + 40;
    this.container.addChild(this.serverListingTitle);
    this.passwordLabel = new PIXI.Text("Password", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.passwordLabel.x = this.ox + 267;
    this.passwordLabel.y = this.oy + 107;
    this.container.addChild(this.passwordLabel);
    this.passwordField = new InputField("password");
    this.passwordField.setDimensions(110, 35);
    this.passwordField.forceLowerCase = !1;
    this.passwordField.setMaxChars(8);
    this.passwordField.x = this.ox + 346;
    this.passwordField.y = this.oy + 100;
    this.passwordField.setPassword(!0);
    this.passwordField.setFilter("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890");
    this.container.addChild(this.passwordField);
    this.filterPrivate = new Checkbox("private", "Private", !0);
    this.filterPrivate.x = this.ox + 502;
    this.filterPrivate.y = this.oy + 50;
    this.filterPrivate.scale.x = this.filterPrivate.scale.y = 0.9;
    this.filterPrivate.on(Checkbox.CHANGE, (a) =>
      this.filter(
        this.activeMode,
        this.activeRegion,
        a ? ServerListMenu.PRIVATE_ALL : !1,
        this.activeRanked,
        this.activeCustom
      )
    );
    this.container.addChild(this.filterPrivate);
    this.privateIcon = new PIXI.Sprite(App.CombinedTextures.lock_icon);
    this.privateIcon.x = this.ox + 470;
    this.privateIcon.y = this.filterPrivate.y - 3;
    this.privateIcon.scale.x = this.privateIcon.scale.y = 0.4;
    this.container.addChild(this.privateIcon);
    this.filterRanked = new Checkbox("ranked", "Ranked", !0);
    this.filterRanked.x = this.ox + 502;
    this.filterRanked.y = this.oy + 80;
    this.filterRanked.scale.x = this.filterRanked.scale.y = 0.9;
    this.filterRanked.on(Checkbox.CHANGE, (a) =>
      this.filter(
        this.activeMode,
        this.activeRegion,
        this.activePrivate,
        a ? ServerListMenu.RANKED_ALL : !1,
        this.activeCustom
      )
    );
    this.container.addChild(this.filterRanked);
    this.rankedIcon = new PIXI.Sprite(App.CombinedTextures.ranked_icon);
    this.rankedIcon.x = this.ox + 470;
    this.rankedIcon.y = this.filterRanked.y - 3;
    this.rankedIcon.scale.x = this.rankedIcon.scale.y = 0.4;
    this.container.addChild(this.rankedIcon);
    this.filterCustom = new Checkbox("custom", "Custom", !0);
    this.filterCustom.x = this.ox + 502;
    this.filterCustom.y = this.oy + 110;
    this.filterCustom.scale.x = this.filterCustom.scale.y = 0.9;
    this.filterCustom.on(Checkbox.CHANGE, (a) =>
      this.filter(
        this.activeMode,
        this.activeRegion,
        this.activePrivate,
        this.activeRanked,
        a ? ServerListMenu.CUSTOM_ALL : !1
      )
    );
    this.container.addChild(this.filterCustom);
    this.customIcon = new PIXI.Sprite(App.CombinedTextures.gears_icon);
    this.customIcon.x = this.ox + 470;
    this.customIcon.y = this.filterCustom.y - 3;
    this.customIcon.scale.x = this.customIcon.scale.y = 0.4;
    this.container.addChild(this.customIcon);
    this.modeText = new PIXI.Text("Mode", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.modeText.x = this.ox + 15;
    this.modeText.y = this.oy + 144;
    this.container.addChild(this.modeText);
    this.regionText = new PIXI.Text("Region", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.regionText.x = this.ox + 75;
    this.regionText.y = this.oy + 144;
    this.container.addChild(this.regionText);
    this.nameText = new PIXI.Text("Name", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.nameText.x = this.ox + 146;
    this.nameText.y = this.oy + 144;
    this.container.addChild(this.nameText);
    this.playersText = new PIXI.Text("Players", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.playersText.x = this.ox + 360;
    this.playersText.y = this.oy + 144;
    this.container.addChild(this.playersText);
    this.modeSorting = new PIXI.Graphics();
    this.modeSorting.interactive = !0;
    this.modeSorting.x = this.modeText.x - 4;
    this.modeSorting.y = this.modeText.y;
    this.modeSorting.beginFill(16777215, 0.2);
    this.modeSorting.drawRect(0, 0, 54, 22, 8);
    this.modeSorting.endFill();
    this.modeSorting.alpha = 0.5;
    this.modeSorting.on("mouseover", () => (this.modeSorting.alpha = 1));
    this.modeSorting.on("mouseout", () => (this.modeSorting.alpha = 0.5));
    this.modeSorting.on("mousedown", () => {
      this.sortedCol = ServerListMenu.COL_MODE;
      this.modeSort =
        this.modeSort === ServerListMenu.SORT_UP
          ? ServerListMenu.SORT_DOWN
          : ServerListMenu.SORT_UP;
      this.sort(this.modeSort);
    });
    this.container.addChild(this.modeSorting);
    this.regionSorting = new PIXI.Graphics();
    this.regionSorting.interactive = !0;
    this.regionSorting.x = this.regionText.x - 4;
    this.regionSorting.y = this.regionText.y;
    this.regionSorting.beginFill(16777215, 0.2);
    this.regionSorting.drawRect(0, 0, 64, 22, 8);
    this.regionSorting.endFill();
    this.regionSorting.alpha = 0.5;
    this.regionSorting.on("mouseover", () => (this.regionSorting.alpha = 1));
    this.regionSorting.on("mouseout", () => (this.regionSorting.alpha = 0.5));
    this.regionSorting.on("mousedown", () => {
      this.sortedCol = ServerListMenu.COL_REGION;
      this.regionSort =
        this.regionSort === ServerListMenu.SORT_UP
          ? ServerListMenu.SORT_DOWN
          : ServerListMenu.SORT_UP;
      this.sort(ServerListMenu.SORT_DEFAULT, this.regionSort);
    });
    this.container.addChild(this.regionSorting);
    this.nameSorting = new PIXI.Graphics();
    this.nameSorting.interactive = !0;
    this.nameSorting.x = this.nameText.x - 4;
    this.nameSorting.y = this.nameText.y;
    this.nameSorting.beginFill(16777215, 0.2);
    this.nameSorting.drawRect(0, 0, 54, 22, 8);
    this.nameSorting.endFill();
    this.nameSorting.alpha = 0.5;
    this.nameSorting.on("mouseover", () => (this.nameSorting.alpha = 1));
    this.nameSorting.on("mouseout", () => (this.nameSorting.alpha = 0.5));
    this.nameSorting.on("mousedown", () => {
      this.sortedCol = ServerListMenu.COL_NAME;
      this.nameSort =
        this.nameSort === ServerListMenu.SORT_UP
          ? ServerListMenu.SORT_DOWN
          : ServerListMenu.SORT_UP;
      this.sort(ServerListMenu.SORT_DEFAULT, ServerListMenu.SORT_DEFAULT, this.nameSort);
    });
    this.container.addChild(this.nameSorting);
    this.playerSorting = new PIXI.Graphics();
    this.playerSorting.interactive = !0;
    this.playerSorting.x = this.playersText.x - 4;
    this.playerSorting.y = this.playersText.y;
    this.playerSorting.beginFill(16777215, 0.2);
    this.playerSorting.drawRect(0, 0, 68, 22, 8);
    this.playerSorting.endFill();
    this.playerSorting.alpha = 0.5;
    this.playerSorting.on("mouseover", () => (this.playerSorting.alpha = 1));
    this.playerSorting.on("mouseout", () => (this.playerSorting.alpha = 0.5));
    this.playerSorting.on("mousedown", () => {
      this.sortedCol = ServerListMenu.COL_PLAYERS;
      this.playerSort =
        this.playerSort === ServerListMenu.SORT_UP
          ? ServerListMenu.SORT_DOWN
          : ServerListMenu.SORT_UP;
      this.sort(
        ServerListMenu.SORT_DEFAULT,
        ServerListMenu.SORT_DEFAULT,
        ServerListMenu.SORT_DEFAULT,
        this.playerSort
      );
    });
    this.container.addChild(this.playerSorting);
    this.serverInfoText = new PIXI.Text("0 players in 0 servers", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 13421772,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.serverInfoText.x = 36;
    this.serverInfoText.y = this.background.height - 16;
    this.container.addChild(this.serverInfoText);
    this.refreshButton = new Button("refresh");
    this.refreshButton.selected = !0;
    this.refreshButton.setText("Refresh");
    this.refreshButton.scale.x = this.refreshButton.scale.y = 0.8;
    this.refreshButton.addListener(Button.BUTTON_RELEASED, () =>
      this.emit(Layer.Events.SERVER_LIST_REFRESH)
    );
    this.refreshButton.x = this.width - 100;
    this.refreshButton.y = this.height - 10;
    this.refreshButton.setTint(8978312);
    this.container.addChild(this.refreshButton);
    this.serverListContainer = new PIXI.Container();
    this.serverListContainer.y = 36;
    this.serverListTableContainerMask = new PIXI.Graphics();
    this.serverListTableContainerMask.beginFill(16777215, 1);
    this.serverListTableContainerMask.drawRect(-10, 150, 640, 316);
    this.serverListTableContainerMask.endFill();
    this.serverListTableContainerMask.x = 10;
    this.serverListContainer.addChild(this.serverListTableContainerMask);
    this.serverListTableContainer = new PIXI.Container();
    this.serverListTableContainer.x = 0;
    this.serverListTableContainer.mask = this.serverListTableContainerMask;
    this.serverListContainer.addChild(this.serverListTableContainer);
    this.serverListScrollbar = new ServerListScrollbar(318);
    this.serverListScrollbar.x = 615;
    this.serverListScrollbar.y = 154;
    this.serverListContainer.addChild(this.serverListScrollbar);
    this.serverListScrollbar.on(ServerListScrollbar.SCROLL, (a) => {
      this.serverListTableContainer.height > this.serverListTableContainerMask.height &&
        (this.serverListTableContainer.y = -(
          a *
          (this.serverListTableContainer.height - this.serverListTableContainerMask.height)
        ));
    });
    this.container.addChild(this.serverListContainer);
    this.modeList = new Dropdown("modeSelect", "Mode", 200, 200, !0);
    this.modeList.addListener(Button.BUTTON_RELEASED, (a) => this.onModeListSelect(a.data.value));
    this.modeList.x = 26;
    this.modeList.y = 130;
    this.modeList.addItem("All modes", ServerListMenu.MODE_ALL, "");
    this.modeList.addItem(
      "Deathmatch",
      ServerListMenu.MODE_DEATHMATCH,
      "",
      App.CombinedTextures.dm_icon_notxt
    );
    this.modeList.addItem(
      "Team Deathmatch",
      ServerListMenu.MODE_TEAM_DEATHMATCH,
      "",
      App.CombinedTextures.tdm_icon_notxt
    );
    this.modeList.addItem(
      "Capture the flag",
      ServerListMenu.MODE_CAPTURE_THE_FLAG,
      "",
      App.CombinedTextures.ctf_icon_notxt
    );
    this.modeList.addItem(
      "Dodgeball",
      ServerListMenu.MODE_DODGEBALL,
      "",
      App.CombinedTextures.db_icon_notxt
    );
    this.modeList.scale.x = this.modeList.scale.y = 0.9;
    this.container.addChild(this.modeList);
    this.regionList = new Dropdown("regionSelect", "Region", 200, 200, !0);
    this.regionList.addListener(Button.BUTTON_RELEASED, (a) =>
      this.onRegionListSelect(a.data.value)
    );
    this.regionList.x = 26;
    this.regionList.y = 100;
    this.regionList.addItem(
      "All regions",
      ServerListMenu.REGION_ALL,
      "",
      App.CombinedTextures.globe,
      0.4,
      4
    );
    this.regionList.addItem(
      "North America",
      ServerListMenu.REGION_NA_EAST,
      "",
      App.CombinedTextures.globe_na,
      0.4,
      4
    );
    this.regionList.addItem(
      "Europe",
      ServerListMenu.REGION_EU_WEST,
      "",
      App.CombinedTextures.globe_eu,
      0.4,
      4
    );
    this.regionList.addItem(
      "Asia",
      ServerListMenu.REGION_AS_SOUTH,
      "",
      App.CombinedTextures.globe_as,
      0.4,
      4
    );
    this.regionList.scale.x = this.regionList.scale.y = 0.9;
    this.container.addChild(this.regionList);
  }
  onModeListSelect(a) {
    this.filter(a, this.activeRegion, this.activePrivate, this.activeRanked, this.activeCustom);
  }
  onRegionListSelect(a) {
    this.filter(this.activeMode, a, this.activePrivate, this.activeRanked, this.activeCustom);
  }
  show() {
    this.refresh();
    Dropdown.AddInstance(this.regionList);
    Dropdown.AddInstance(this.modeList);
    this.serverListScrollbar.enableWheel();
  }
  hide() {
    this.serverListScrollbar.disableWheel();
  }
  async refresh() {
    this.refreshButton.disable();
    this.gameList = await APIClient.getGames();
    this.sort();
    setTimeout(() => this.refreshButton.enable(), 4e3);
  }
  sort(
    a = ServerListMenu.SORT_DEFAULT,
    b = ServerListMenu.SORT_DEFAULT,
    c = ServerListMenu.SORT_DEFAULT,
    d = ServerListMenu.SORT_DEFAULT
  ) {
    a === ServerListMenu.SORT_DOWN
      ? this.gameList.sort((e, f) => (e.mode < f.mode ? -1 : e.mode > f.mode ? 1 : 0))
      : a === ServerListMenu.SORT_UP &&
        this.gameList.sort((e, f) => (e.mode < f.mode ? 1 : e.mode > f.mode ? -1 : 0));
    b === ServerListMenu.SORT_DOWN
      ? this.gameList.sort((e, f) => (e.region < f.region ? -1 : e.region > f.region ? 1 : 0))
      : b === ServerListMenu.SORT_UP &&
        this.gameList.sort((e, f) => (e.region < f.region ? 1 : e.region > f.region ? -1 : 0));
    c === ServerListMenu.SORT_DOWN
      ? this.gameList.sort((e, f) => (e.name < f.name ? -1 : e.name > f.name ? 1 : 0))
      : c === ServerListMenu.SORT_UP &&
        this.gameList.sort((e, f) => (e.name < f.name ? 1 : e.name > f.name ? -1 : 0));
    d === ServerListMenu.SORT_DOWN
      ? this.gameList.sort((e, f) =>
          parseInt(e.players) < parseInt(f.players)
            ? -1
            : parseInt(e.players) > parseInt(f.players)
            ? 1
            : 0
        )
      : d === ServerListMenu.SORT_UP &&
        this.gameList.sort((e, f) =>
          parseInt(e.players) < parseInt(f.players)
            ? 1
            : parseInt(e.players) > parseInt(f.players)
            ? -1
            : 0
        );
    this.filter(
      this.activeMode,
      this.activeRegion,
      this.activePrivate,
      this.activeRanked,
      this.activeCustom
    );
  }
  filter(
    a = ServerListMenu.MODE_ALL,
    b = ServerListMenu.REGION_ALL,
    c = ServerListMenu.PRIVATE_ALL,
    d = ServerListMenu.RANKED_ALL,
    e = ServerListMenu.CUSTOM_ALL
  ) {
    let f = 0,
      g = 0,
      h = 0,
      m = !1;
    this.serverListTableContainer.removeChildren();
    this.serverListTableContainer.y = 0;
    this.serverListScrollbar.reset();
    this.activeMode = a;
    this.activeRegion = b;
    this.activePrivate = c;
    this.activeRanked = d;
    this.activeCustom = e;
    for (let l = 0; l < this.gameList.length; l++) {
      const k = this.gameList[l];
      if (a !== ServerListMenu.MODE_ALL && Game.MODE_MAP[k.mode] !== a) {
        m = !0;
        continue;
      }
      if (b !== ServerListMenu.REGION_ALL && k.region !== b) {
        m = !0;
        continue;
      }
      var n = parseInt(k.private);
      let p = parseInt(k.ranked),
        r = parseInt(k.custom);
      n && p && r
        ? (m = !(
            c === ServerListMenu.PRIVATE_ALL ||
            d === ServerListMenu.RANKED_ALL ||
            e === ServerListMenu.CUSTOM_ALL
          ))
        : n && p
        ? (m = !(c === ServerListMenu.PRIVATE_ALL || d === ServerListMenu.RANKED_ALL))
        : n && r
        ? (m = !(c === ServerListMenu.PRIVATE_ALL || e === ServerListMenu.CUSTOM_ALL))
        : p && r
        ? (m = !(d === ServerListMenu.RANKED_ALL || e === ServerListMenu.CUSTOM_ALL))
        : n
        ? (m = c !== ServerListMenu.PRIVATE_ALL)
        : p
        ? (m = d !== ServerListMenu.RANKED_ALL)
        : r && (m = e !== ServerListMenu.CUSTOM_ALL);
      m ||
        (g++,
        (h += parseInt(k.players, 10)),
        f++,
        (n = new ServerListTableRow(
          f + 1,
          ServerListMenu.REGION_MAP[k.region],
          k.server_id,
          k.name,
          k.mode,
          k.players,
          k.private,
          k.ranked,
          k.custom
        )),
        (n.x = this.ox + 20),
        (n.y = this.oy + 36 * f + 100),
        n.on(ServerListTableRow.JOIN_GAME, (q) => {
          this.passwordField.markNone();
          let t = this.passwordField.getText().trim();
          1 === parseInt(k.private) && 0 === t.length
            ? this.passwordField.markInvalid()
            : this.emit(Layer.Events.JOIN_GAME, q, k.server_id, t);
        }),
        n.on(ServerListTableRow.DISPLAY_DETAILS, () =>
          this.emit(Layer.Events.SERVER_DETAIL_ACCESS, k)
        ),
        this.serverListTableContainer.addChild(n));
    }
    this.serverInfoText.text = "" + h + " players in " + g + " servers" + (m ? " [filtered]" : "");
  }
  setPasswordInvalid() {
    this.passwordField.markInvalid();
  }
}
ServerListMenu.MODE_ALL = "all";
ServerListMenu.REGION_ALL = "all";
ServerListMenu.PRIVATE_ALL = "all";
ServerListMenu.RANKED_ALL = "all";
ServerListMenu.CUSTOM_ALL = "all";
ServerListMenu.MODE_DEATHMATCH = "dm";
ServerListMenu.MODE_TEAM_DEATHMATCH = "tdm";
ServerListMenu.MODE_CAPTURE_THE_FLAG = "ctf";
ServerListMenu.MODE_DODGEBALL = "db";
ServerListMenu.MODE_TRAINING = "tr";
ServerListMenu.REGION_NA_EAST = "na_east";
ServerListMenu.REGION_EU_WEST = "eu_west";
ServerListMenu.REGION_AS_SOUTH = "as_south";
ServerListMenu.REGION_MAP = {
  [ServerListMenu.REGION_NA_EAST]: "na",
  [ServerListMenu.REGION_EU_WEST]: "eu",
  [ServerListMenu.REGION_AS_SOUTH]: "as",
};
ServerListMenu.SORT_UP = "up";
ServerListMenu.SORT_DOWN = "down";
ServerListMenu.SORT_DEFAULT = "default";
ServerListMenu.COL_MODE = "mode";
ServerListMenu.COL_REGION = "region";
ServerListMenu.COL_NAME = "name";
ServerListMenu.COL_PLAYERS = "players";
class ServerListTableRow extends PIXI.Container {
  constructor(a, b, c, d, e, f, g, h, m) {
    super();
    this.id = c;
    this.index = a.toString();
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.1);
    this.background.drawRect(-10, 2, 570, 38);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    this.hitArea = new PIXI.Rectangle(-10, 2, 570, 38);
    this.interactive = !0;
    this.on("mouseover", () => {
      this.background.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.on("mouseout", () => {
      this.background.alpha = 0 === this.index % 2 ? 0.3 : 0;
    });
    this.addChild(this.background);
    this.background.on("mousedown", () => {
      this.emit(ServerListTableRow.DISPLAY_DETAILS);
      AudioEffects.ButtonClick.audio.play();
    });
    this.modeIcon = new PIXI.Sprite(App.CombinedTextures[Game.MODE_MAP[e] + "_icon"]);
    this.modeIcon.x = 0;
    this.modeIcon.y = 5;
    this.modeIcon.scale.x = this.modeIcon.scale.y = 0.5;
    this.addChild(this.modeIcon);
    this.regionIcon = new PIXI.Sprite(App.CombinedTextures["globe_" + b]);
    this.regionIcon.x = 56;
    this.regionIcon.y = 8;
    this.regionIcon.scale.x = this.regionIcon.scale.y = 0.4;
    this.addChild(this.regionIcon);
    this.regionText = new PIXI.BitmapText(b.toUpperCase(), { fontName: "Open Sans", fontSize: 22 });
    this.regionText.x = 84;
    this.regionText.y = 10;
    this.regionText.tint = 16763904;
    this.addChild(this.regionText);
    this.nameText = new PIXI.BitmapText(d, { fontName: "Open Sans", fontSize: 22 });
    this.nameText.x = 132;
    this.nameText.y = 10;
    this.nameText.tint = 16777215;
    this.addChild(this.nameText);
    220 < this.nameText.width && (this.nameText.width = 220);
    this.playerText = new PIXI.BitmapText(f + (12 === parseInt(f) ? " (full)" : ""), {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.playerText.x = 360;
    this.playerText.y = 10;
    this.playerText.tint = 12 === parseInt(f) ? 16763904 : 16777215;
    this.addChild(this.playerText);
    a = 1 === parseInt(g);
    h = 1 === parseInt(h);
    m = 1 === parseInt(m);
    a &&
      ((this.privateIcon = new PIXI.Sprite(App.CombinedTextures.lock_icon)),
      (this.privateIcon.x = 400),
      (this.privateIcon.y = 8),
      (this.privateIcon.scale.x = this.privateIcon.scale.y = 0.4),
      this.addChild(this.privateIcon));
    h &&
      ((this.rankedIcon = new PIXI.Sprite(App.CombinedTextures.ranked_icon)),
      (this.rankedIcon.x = 430),
      (this.rankedIcon.y = 8),
      (this.rankedIcon.scale.x = this.rankedIcon.scale.y = 0.4),
      this.addChild(this.rankedIcon));
    m &&
      ((this.customIcon = new PIXI.Sprite(App.CombinedTextures.gears_icon)),
      (this.customIcon.x = 460),
      (this.customIcon.y = 8),
      (this.customIcon.scale.x = this.customIcon.scale.y = 0.4),
      this.addChild(this.customIcon));
    this.joinButton = new Button("join");
    this.joinButton.selected = !1;
    this.joinButton.setText("Join");
    this.joinButton.scale.x = this.joinButton.scale.y = 0.7;
    this.joinButton.setTint(16763904);
    this.joinButton.addListener(Button.BUTTON_RELEASED, () => {
      this.emit(ServerListTableRow.JOIN_GAME, d, this.id);
    });
    this.joinButton.x = 514;
    this.joinButton.y = 8;
    this.addChild(this.joinButton);
  }
}
ServerListTableRow.JOIN_GAME = "joinGame";
ServerListTableRow.DISPLAY_DETAILS = "displayDetails";
class ServerListScrollbar extends PIXI.Container {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, this.h, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-4, -4, 32, this.h + 8);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, 0, 16, 32, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.scrollBar.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (c) => {
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (c) => {
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointermove", (c) => this.scroll(c.data.global.y / App.Scale));
    this.wheelListener = (c) => {
      c = c.data.delta;
      this.scrolling = !0;
      this.scroll(this.oy + 0.2 * c);
      this.scrolling = !1;
    };
  }
  enableWheel() {
    UserInput.hasListener(UserInput.WHEEL, this.wheelListener) ||
      UserInput.addListener(UserInput.WHEEL, this.wheelListener);
  }
  disableWheel() {
    UserInput.removeListener(UserInput.WHEEL, this.wheelListener);
  }
  scroll(a) {
    if (this.scrolling) {
      let b = this.scrollButton.y + (a - this.oy);
      -3 > b ? (b = -3) : b > this.h - 39 && (b = this.h - 39);
      let c = this.h / (this.h - 39);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(ServerListScrollbar.SCROLL, (1 / this.h) * (b + 3) * c);
    }
  }
  reset() {
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
ServerListScrollbar.SCROLL = "scroll";
var servercustomizationmenu = {};
class ServerCustomizationMenu extends Feature {
  constructor() {
    super();
    this.ox = 0;
    this.oy = 20;
    this.maps = [];
    this.drops = [];
    this.settings = { maps: [], weapons: [], drops: [], shuriken: !0 };
    this.selectedMode = null;
    this.container.x = 0.5 * -this.width;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 1);
    this.background.drawRect(0, 0, 660, 524, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(14, 136, 208, 330, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(226, 136, 208, 330, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(438, 136, 208, 330, 10);
    this.background.endFill();
    this.background.interactive = !0;
    this.container.addChild(this.background);
    this.serverCustomizationTitle = new PIXI.Text("Customize game", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.serverCustomizationTitle.x = this.ox + 20;
    this.serverCustomizationTitle.y = this.oy + 40;
    this.container.addChild(this.serverCustomizationTitle);
    this.weaponTypeLabel = new PIXI.Text(
      "Select the weapons and maps that should be available in the server.\n- Deselecting all weapons will disable the weapon menu.\n- Deselecting all maps will enable one random map.",
      { fontSize: 16, fontFamily: "Arial", fill: 16777215, lineJoin: "round", strokeThickness: 2 }
    );
    this.weaponTypeLabel.x = this.ox + 24;
    this.weaponTypeLabel.y = this.oy + 70;
    this.weaponTypeLabel.tint = 16777215;
    this.container.addChild(this.weaponTypeLabel);
    this.weaponTypeLabel = new PIXI.Text("Weapons", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16772608,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.weaponTypeLabel.x = this.ox + 20;
    this.weaponTypeLabel.y = this.oy + 134;
    this.container.addChild(this.weaponTypeLabel);
    this.mapLabel = new PIXI.Text("Maps", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16772608,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.mapLabel.x = this.ox + 230;
    this.mapLabel.y = this.oy + 134;
    this.container.addChild(this.mapLabel);
    this.dropLabel = new PIXI.Text("Item drops", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16772608,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.dropLabel.x = this.ox + 440;
    this.dropLabel.y = this.oy + 134;
    this.container.addChild(this.dropLabel);
    this.acceptButton = new Button("accept");
    this.acceptButton.setText("Apply");
    this.acceptButton.scale.x = this.acceptButton.scale.y = 0.8;
    this.acceptButton.addListener(Button.BUTTON_RELEASED, () => this.onAccept());
    this.acceptButton.x = this.width - 80;
    this.acceptButton.y = this.height - 10;
    this.acceptButton.setTint(16763904);
    this.container.addChild(this.acceptButton);
    this.weaponListContainer = new PIXI.Container();
    this.weaponListContainer.x = 0;
    this.weaponListContainer.y = 32;
    this.weaponListTableContainerMask = new PIXI.Graphics();
    this.weaponListTableContainerMask.beginFill(16777215, 1);
    this.weaponListTableContainerMask.drawRect(20, 148, 180, 320);
    this.weaponListTableContainerMask.endFill();
    this.weaponListTableContainerMask.x = -4;
    this.weaponListContainer.addChild(this.weaponListTableContainerMask);
    this.weaponListTableContainer = new PIXI.Container();
    this.weaponListTableContainer.x = 13;
    this.weaponListTableContainer.mask = this.weaponListTableContainerMask;
    this.weaponListContainer.addChild(this.weaponListTableContainer);
    this.weaponSelectionListScrollbar = new SelectionListScrollbar(322);
    this.weaponSelectionListScrollbar.x = 200;
    this.weaponSelectionListScrollbar.y = 152;
    this.weaponListContainer.addChild(this.weaponSelectionListScrollbar);
    this.weaponSelectionListScrollbar.on(SelectionListScrollbar.SCROLL, (b) => {
      this.weaponListTableContainer.height > this.weaponListTableContainerMask.height &&
        (this.weaponListTableContainer.y = -(
          b *
          (this.weaponListTableContainer.height - this.weaponListTableContainerMask.height)
        ));
    });
    this.container.addChild(this.weaponListContainer);
    let a = 0;
    for (let b in ItemMap) {
      let c = ItemMap[b];
      if (c.equip === ItemMap.Equip.PRIMARY || c.equip === ItemMap.Equip.SECONDARY) {
        this.settings.weapons.push(b);
        const d = new WeaponSelectionListTableRow(a, b, c.title);
        d.x = this.ox + 4;
        d.y = this.oy + 42 * a + 130;
        d.on(WeaponSelectionListTableRow.CHANGE, (e) =>
          this.onWeaponSelectionChange(e, d.selected)
        );
        this.weaponListTableContainer.addChild(d);
        a++;
      }
    }
    this.mapListContainer = new PIXI.Container();
    this.mapListContainer.x = 212;
    this.mapListContainer.y = 32;
    this.mapListTableContainerMask = new PIXI.Graphics();
    this.mapListTableContainerMask.beginFill(16777215, 1);
    this.mapListTableContainerMask.drawRect(20, 148, 180, 320);
    this.mapListTableContainerMask.endFill();
    this.mapListTableContainerMask.x = -4;
    this.mapListContainer.addChild(this.mapListTableContainerMask);
    this.mapListTableContainer = new PIXI.Container();
    this.mapListTableContainer.x = 0;
    this.mapListTableContainer.mask = this.mapListTableContainerMask;
    this.mapListContainer.addChild(this.mapListTableContainer);
    this.mapSelectionListScrollbar = new SelectionListScrollbar(322);
    this.mapSelectionListScrollbar.x = 200;
    this.mapSelectionListScrollbar.y = 152;
    this.mapListContainer.addChild(this.mapSelectionListScrollbar);
    this.mapSelectionListScrollbar.on(SelectionListScrollbar.SCROLL, (b) => {
      this.mapListTableContainer.height > this.mapListTableContainerMask.height &&
        (this.mapListTableContainer.y = -(
          b *
          (this.mapListTableContainer.height - this.mapListTableContainerMask.height)
        ));
    });
    this.container.addChild(this.mapListContainer);
    this.dropListContainer = new PIXI.Container();
    this.dropListContainer.x = 424;
    this.dropListContainer.y = 32;
    this.dropListTableContainerMask = new PIXI.Graphics();
    this.dropListTableContainerMask.beginFill(16777215, 1);
    this.dropListTableContainerMask.drawRect(20, 148, 180, 320);
    this.dropListTableContainerMask.endFill();
    this.dropListTableContainerMask.x = -4;
    this.dropListContainer.addChild(this.dropListTableContainerMask);
    this.dropListTableContainer = new PIXI.Container();
    this.dropListTableContainer.x = 0;
    this.dropListTableContainer.mask = this.dropListTableContainerMask;
    this.dropListContainer.addChild(this.dropListTableContainer);
    this.dropSelectionListScrollbar = new SelectionListScrollbar(322);
    this.dropSelectionListScrollbar.x = 200;
    this.dropSelectionListScrollbar.y = 152;
    this.dropListContainer.addChild(this.dropSelectionListScrollbar);
    this.dropSelectionListScrollbar.on(SelectionListScrollbar.SCROLL, (b) => {
      this.dropListTableContainer.height > this.dropListTableContainerMask.height &&
        (this.dropListTableContainer.y = -(
          b *
          (this.dropListTableContainer.height - this.dropListTableContainerMask.height)
        ));
    });
    this.container.addChild(this.dropListContainer);
    this.setShuriken = new Checkbox("shuriken", "Spawn with Shuriken", !0);
    this.setShuriken.x = this.ox + 32;
    this.setShuriken.y = this.height - 6;
    this.setShuriken.scale.x = this.setShuriken.scale.y = 0.9;
    this.setShuriken.setTint(16776960);
    this.setShuriken.on(Checkbox.CHANGE, (b) => this.onSetShuriken(b));
    this.container.addChild(this.setShuriken);
    this.loadContent();
  }
  onSetShuriken(a) {
    this.settings.shuriken = a;
  }
  onWeaponSelectionChange(a, b) {
    b
      ? this.settings.weapons.push(a)
      : this.settings.weapons.splice(this.settings.weapons.indexOf(a), 1);
  }
  onMapSelectionChange(a, b) {
    b ? this.settings.maps.push(a) : this.settings.maps.splice(this.settings.maps.indexOf(a), 1);
  }
  onDropSelectionChange(a, b) {
    b ? this.settings.drops.push(a) : this.settings.drops.splice(this.settings.drops.indexOf(a), 1);
  }
  onAccept() {
    this.emit(ServerCustomizationMenu.ACCEPT, this.settings);
  }
  onCancel() {
    this.emit(ServerCustomizationMenu.CANCEL);
  }
  async loadContent() {
    var a = await APIClient.getItemDrops();
    if (a) {
      this.drops = a;
      this.settings.drops = [];
      this.dropListTableContainer.removeChildren();
      a = 0;
      for (let b = 0; b < this.drops.length; b++) {
        const c = this.drops[b];
        this.settings.drops.push(c.item_id);
        const d = new DropSelectionListTableRow(a, c.item_id, c.prefab_id, c.name);
        d.x = this.ox + 4;
        d.y = this.oy + 42 * a + 130;
        d.on(DropSelectionListTableRow.CHANGE, (e) => this.onDropSelectionChange(e, d.selected));
        this.dropListTableContainer.addChild(d);
        a++;
      }
      if ((a = await APIClient.getMaps())) (this.maps = a), this.filterMaps();
    }
  }
  setMode(a) {
    this.selectedMode !== a && ((this.selectedMode = a), this.filterMaps());
  }
  filterMaps() {
    this.mapSelectionListScrollbar.reset();
    this.mapListTableContainer.y = 0;
    this.settings.maps = [];
    this.mapListTableContainer.removeChildren();
    let a = 0;
    for (let b = 0; b < this.maps.length; b++) {
      const c = this.maps[b];
      if (
        !(
          this.selectedMode === c.mode ||
          (c.mode === Game.MODE_CTF && this.selectedMode === Game.MODE_DM) ||
          (c.mode === Game.MODE_CTF && this.selectedMode === Game.MODE_TDM)
        )
      )
        continue;
      this.settings.maps.push(c.id);
      const d = new MapSelectionListTableRow(a, c.id, c.title, c.mode);
      d.x = this.ox + 4;
      d.y = this.oy + 42 * a + 130;
      d.on(MapSelectionListTableRow.CHANGE, (e) => this.onMapSelectionChange(e, d.selected));
      this.mapListTableContainer.addChild(d);
      a++;
    }
    this.emit(ServerCustomizationMenu.INIT, this.settings);
  }
}
ServerCustomizationMenu.ACCEPT = "cust_accept";
ServerCustomizationMenu.CANCEL = "cust_cancel";
ServerCustomizationMenu.INIT = "cust_init";
ServerCustomizationMenu.SHOW = "cust_show";
class WeaponSelectionListTableRow extends PIXI.Container {
  constructor(a, b, c) {
    super();
    this.id = b;
    this.index = a;
    this.selected = this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.2);
    this.background.drawRect(0, 2, 200, 38);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.tint = 65280;
    this.background.alpha = 0.6;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0.6;
    });
    this.background.on("mousedown", () => {
      this.selected = !this.selected;
      this.background.tint = this.selected ? 65280 : 16777215;
      this.emit(WeaponSelectionListTableRow.CHANGE, this.id);
      AudioEffects.ButtonClick.audio.play();
    });
    this.addChild(this.background);
    this.icon = new SpriteMap[b]();
    this.icon.x = 23;
    this.icon.y = 26;
    a = this.icon.width;
    b = this.icon.height;
    let d = a > b ? (64 <= a ? 64 : a) : 42 <= b ? 42 : b;
    this.icon.scale.x = this.icon.scale.y = a > b ? d / this.icon.width : d / this.icon.height;
    this.icon.rotation = -0.2;
    this.addChild(this.icon);
    this.nameText = new PIXI.Text(c, {
      fontSize: 14,
      fontFamily: "Arial",
      fill: 16777215,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.nameText.x = 75;
    this.nameText.y = 12;
    this.nameText.tint = 16777215;
    this.addChild(this.nameText);
  }
}
WeaponSelectionListTableRow.CHANGE = "wsl_change";
class MapSelectionListTableRow extends PIXI.Container {
  constructor(a, b, c, d) {
    super();
    this.id = b;
    this.index = a;
    this.selected = this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.2);
    this.background.drawRect(0, 2, 200, 38);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.tint = 65280;
    this.background.alpha = 0.6;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0.6;
    });
    this.background.on("mousedown", () => {
      this.selected = !this.selected;
      this.background.tint = this.selected ? 65280 : 16777215;
      this.emit(MapSelectionListTableRow.CHANGE, this.id);
      AudioEffects.ButtonClick.audio.play();
    });
    this.addChild(this.background);
    this.icon = new PIXI.Sprite(App.CombinedTextures[Game.MODE_MAP[d] + "_icon"]);
    this.icon.x = 10;
    this.icon.y = 10;
    a = this.icon.width;
    b = this.icon.height;
    d = a > b ? (64 <= a ? 64 : a) : 42 <= b ? 42 : b;
    this.icon.scale.x = this.icon.scale.y = a > b ? d / this.icon.width : d / this.icon.height;
    this.icon.rotation = -0.2;
    this.addChild(this.icon);
    this.nameText = new PIXI.Text(c, {
      fontSize: 14,
      fontFamily: "Arial",
      fill: 16777215,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.nameText.x = 48;
    this.nameText.y = 12;
    this.addChild(this.nameText);
  }
}
MapSelectionListTableRow.CHANGE = "msl_change";
class DropSelectionListTableRow extends PIXI.Container {
  constructor(a, b, c, d) {
    super();
    this.id = b;
    this.index = a;
    this.selected = this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.2);
    this.background.drawRect(0, 2, 200, 38);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.tint = 65280;
    this.background.alpha = 0.6;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0.6;
    });
    this.background.on("mousedown", () => {
      this.selected = !this.selected;
      this.background.tint = this.selected ? 65280 : 16777215;
      this.emit(DropSelectionListTableRow.CHANGE, this.id);
      AudioEffects.ButtonClick.audio.play();
    });
    this.addChild(this.background);
    this.icon = new SpriteMap[c]();
    this.icon.x = 30;
    this.icon.y = 22;
    a = this.icon.width;
    b = this.icon.height;
    c = a > b ? (10 <= a ? 10 : a) : 10 <= b ? 10 : b;
    this.icon.scale.x = this.icon.scale.y = a > b ? c / this.icon.width : c / this.icon.height;
    this.icon.rotation = 0;
    this.addChild(this.icon);
    this.nameText = new PIXI.Text(d, {
      fontSize: 14,
      fontFamily: "Arial",
      fill: 16777215,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.nameText.x = 56;
    this.nameText.y = 12;
    this.addChild(this.nameText);
  }
}
DropSelectionListTableRow.CHANGE = "dsl_change";
class SelectionListScrollbar extends PIXI.Container {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, this.h, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-4, -4, 32, this.h + 8);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, 0, 16, 32, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.scrollBar.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (c) => {
      this.scroll(c);
    });
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (c) => {
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
      this.scroll(c);
    });
    this.scrollBar.on("pointermove", (c) => this.scroll(c));
  }
  scroll(a) {
    if (this.scrolling) {
      a = a.data.global.y / App.Scale;
      let b = this.scrollButton.y + (a - this.oy);
      -3 > b ? (b = -3) : b > this.h - 39 && (b = this.h - 39);
      let c = this.h / (this.h - 39);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(SelectionListScrollbar.SCROLL, (1 / this.h) * (b + 3) * c);
    }
  }
  reset() {
    this.scrollButton.y = -3 + (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
SelectionListScrollbar.SCROLL = "scroll";
var servercreationmenu = {};
class ServerCreationMenu extends Feature {
  constructor() {
    super();
    this.price = 0;
    this.duration = ServerCreationMenu.DURATION_B;
    this.mode = Game.MODE_DM;
    this.customization = { maps: [], weapons: [], drops: [], shuriken: !0 };
    this.isPrivate = !1;
    this.isRanked = !0;
    this.isCustom = !1;
    this.onClientConnectBinding = this.onClientConnect.bind(this);
    this.createdServerName = "";
    this.createdServerId = -1;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 1);
    this.background.drawRect(0, 0, 660, 524, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(18, 40, 624, 44, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(18, 120, 624, 104, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(18, 258, 624, 44, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(18, 336, 624, 44, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(18, 414, 624, 44, 10);
    this.background.endFill();
    this.background.interactive = !0;
    this.container.addChild(this.background);
    this.ox = -20;
    this.oy = 20;
    this.container.x = 0.5 * -this.width;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy + 34;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.SERVER_CREATION_CANCEL));
    this.container.addChild(this.closeButton);
    this.customizationMenu = new ServerCustomizationMenu();
    this.customizationMenu.on(ServerCustomizationMenu.ACCEPT, (a) => {
      this.customization = a;
      this.container.removeChild(this.customizationMenu);
    });
    this.customizationMenu.on(ServerCustomizationMenu.INIT, (a) => (this.customization = a));
    this.customizationMenu.on(ServerCustomizationMenu.CANCEL, () =>
      this.container.removeChild(this.customizationMenu)
    );
    this.confirmationBackground = new PIXI.Graphics();
    this.confirmationBackground.beginFill(4473924, 1);
    this.confirmationBackground.drawRect(0, 0, 400, 300);
    this.confirmationBackground.endFill();
    this.confirmationBackground.beginFill(0, 0.3);
    this.confirmationBackground.drawRect(8, 8, 384, 284);
    this.confirmationBackground.endFill();
    this.confirmationBackground.interactive = !0;
    this.confirmationContainer = new PIXI.Container();
    this.confirmationContainer.addChild(this.confirmationBackground);
    this.confirmationContainer.x = 0.5 * (this.container.width - this.confirmationContainer.width);
    this.confirmationContainer.y =
      0.5 * (this.container.height - this.confirmationContainer.height);
    this.confirmationAccept = new Button();
    this.confirmationAccept.setText("Accept & create");
    this.confirmationAccept.scale.x = this.confirmationAccept.scale.y = 0.8;
    this.confirmationAccept.addListener(Button.BUTTON_RELEASED, () => this.onCreateServerConfirm());
    this.confirmationAccept.x = this.confirmationBackground.width - 222;
    this.confirmationAccept.y = this.confirmationBackground.height - 52;
    this.confirmationAccept.setTint(16763904);
    this.confirmationContainer.addChild(this.confirmationAccept);
    this.confirmationDecline = new Button();
    this.confirmationDecline.setText("Cancel");
    this.confirmationDecline.scale.x = this.confirmationDecline.scale.y = 0.8;
    this.confirmationDecline.addListener(Button.BUTTON_RELEASED, () => this.onCreateServerCancel());
    this.confirmationDecline.x = this.confirmationBackground.width - 322;
    this.confirmationDecline.y = this.confirmationBackground.height - 52;
    this.confirmationDecline.setTint(16777215);
    this.confirmationContainer.addChild(this.confirmationDecline);
    this.serverCreationConfirmationTitle = new PIXI.BitmapText("Confirm server creation", {
      fontName: "Open Sans",
      fontSize: 26,
    });
    this.serverCreationConfirmationTitle.x =
      0.5 * (this.confirmationBackground.width - this.serverCreationConfirmationTitle.width);
    this.serverCreationConfirmationTitle.y = 12;
    this.serverCreationConfirmationTitle.tint = 16763904;
    this.confirmationContainer.addChild(this.serverCreationConfirmationTitle);
    this.confirmationInfoTitle = new PIXI.BitmapText(
      "You are about to create a new game server.\nYou can't create a new server until this one ends.\nImportant:\nInappropriate server names can result in\npermanent account closure.",
      { fontName: "Open Sans", fontSize: 22, align: "center" }
    );
    this.confirmationInfoTitle.x =
      0.5 * (this.confirmationBackground.width - this.confirmationInfoTitle.width);
    this.confirmationInfoTitle.y = 42;
    this.confirmationInfoTitle.tint = 16753920;
    this.confirmationContainer.addChild(this.confirmationInfoTitle);
    this.errorMessage = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 22,
      align: "center",
    });
    this.errorMessage.x = 0.5 * (this.confirmationBackground.width - this.errorMessage.width);
    this.errorMessage.y = this.confirmationBackground.height - 124;
    this.errorMessage.tint = 16711680;
    this.confirmationContainer.addChild(this.errorMessage);
    this.successBackground = new PIXI.Graphics();
    this.successBackground.beginFill(4473924, 1);
    this.successBackground.drawRect(0, 0, 400, 200);
    this.successBackground.endFill();
    this.successBackground.beginFill(0, 0.3);
    this.successBackground.drawRect(8, 8, 384, 184);
    this.successBackground.endFill();
    this.successBackground.interactive = !0;
    this.successContainer = new PIXI.Container();
    this.successContainer.addChild(this.successBackground);
    this.successContainer.x = 0.5 * (this.container.width - this.successContainer.width);
    this.successContainer.y = 0.5 * (this.container.height - this.successContainer.height);
    this.serverCreationSuccessTitle = new PIXI.BitmapText("Server created", {
      fontName: "Open Sans",
      fontSize: 26,
    });
    this.serverCreationSuccessTitle.x =
      0.5 * (this.successBackground.width - this.serverCreationSuccessTitle.width);
    this.serverCreationSuccessTitle.y = 12;
    this.serverCreationSuccessTitle.tint = 16763904;
    this.successContainer.addChild(this.serverCreationSuccessTitle);
    this.successInfoTitle = new PIXI.BitmapText(
      "Your server has been created.\nIt will soon be visible in the server lobby.",
      { fontName: "Open Sans", fontSize: 22, align: "center" }
    );
    this.successInfoTitle.x = 0.5 * (this.successBackground.width - this.successInfoTitle.width);
    this.successInfoTitle.y = 42;
    this.successInfoTitle.tint = 16753920;
    this.successContainer.addChild(this.successInfoTitle);
    this.successAccept = new Button();
    this.successAccept.setText("Join game");
    this.successAccept.scale.x = this.successAccept.scale.y = 0.8;
    this.successAccept.addListener(Button.BUTTON_RELEASED, () => this.onSuccessJoinGameAccept());
    this.successAccept.x = 240;
    this.successAccept.y = this.successBackground.height - 52;
    this.successAccept.setTint(16763904);
    this.successContainer.addChild(this.successAccept);
    this.toLobbyAccept = new Button();
    this.toLobbyAccept.setText("Go to lobby");
    this.toLobbyAccept.scale.x = this.toLobbyAccept.scale.y = 0.8;
    this.toLobbyAccept.addListener(Button.BUTTON_RELEASED, () => this.onSuccessToLobbyAccept());
    this.toLobbyAccept.x = 60;
    this.toLobbyAccept.y = this.successBackground.height - 52;
    this.toLobbyAccept.setTint(16763904);
    this.successContainer.addChild(this.toLobbyAccept);
    this.serverCreationTitle = new PIXI.Text("Create game", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.serverCreationTitle.x = this.ox + 40;
    this.serverCreationTitle.y = this.oy + 33;
    this.container.addChild(this.serverCreationTitle);
    this.serverCreationTypeLabel = new PIXI.BitmapText("Type", {
      fontName: "Open Sans",
      fontSize: 24,
    });
    this.serverCreationTypeLabel.x = this.ox + 44;
    this.serverCreationTypeLabel.y = this.oy + 110;
    this.serverCreationTypeLabel.tint = 16777215;
    this.container.addChild(this.serverCreationTypeLabel);
    this.customizationButton = new Button("customize");
    this.customizationButton.setText("Customize game");
    this.customizationButton.scale.x = this.customizationButton.scale.y = 0.8;
    this.customizationButton.addListener(Button.BUTTON_RELEASED, () =>
      this.onCustomizeServerInit()
    );
    this.customizationButton.x = this.width - 332;
    this.customizationButton.y = this.height - 14;
    this.customizationButton.setTint(8978312);
    this.customizationButton.alpha = 0.5;
    this.customizationButton.interactive = !1;
    this.container.addChild(this.customizationButton);
    this.createButton = new Button("create");
    this.createButton.setText("Create game");
    this.createButton.scale.x = this.createButton.scale.y = 0.8;
    this.createButton.addListener(Button.BUTTON_RELEASED, () => this.onCreateServerInit());
    this.createButton.x = this.width - 150;
    this.createButton.y = this.height - 14;
    this.createButton.setTint(16763904);
    this.container.addChild(this.createButton);
    this.setPrivate = new Checkbox("private", "Private", !1);
    this.setPrivate.x = this.ox + 82;
    this.setPrivate.y = this.oy + 150;
    this.setPrivate.scale.x = this.setPrivate.scale.y = 0.9;
    this.setPrivate.on(Checkbox.CHANGE, (a) => this.onSetPrivate(a));
    this.container.addChild(this.setPrivate);
    this.privateIcon = new PIXI.Sprite(App.CombinedTextures.lock_icon);
    this.privateIcon.x = this.ox + 50;
    this.privateIcon.y = this.setPrivate.y - 3;
    this.privateIcon.scale.x = this.privateIcon.scale.y = 0.4;
    this.container.addChild(this.privateIcon);
    this.setRanked = new Checkbox("ranked", "Ranked", !0);
    this.setRanked.x = this.ox + 82;
    this.setRanked.y = this.oy + 180;
    this.setRanked.scale.x = this.setRanked.scale.y = 0.9;
    this.setRanked.on(Checkbox.CHANGE, (a) => this.onSetRanked(a));
    this.container.addChild(this.setRanked);
    this.rankedIcon = new PIXI.Sprite(App.CombinedTextures.ranked_icon);
    this.rankedIcon.x = this.ox + 50;
    this.rankedIcon.y = this.setRanked.y - 3;
    this.rankedIcon.scale.x = this.rankedIcon.scale.y = 0.4;
    this.container.addChild(this.rankedIcon);
    this.setCustom = new Checkbox("custom", "Custom", !1);
    this.setCustom.x = this.ox + 82;
    this.setCustom.y = this.oy + 210;
    this.setCustom.scale.x = this.setCustom.scale.y = 0.9;
    this.setCustom.on(Checkbox.CHANGE, (a) => this.onSetCustom(a));
    this.container.addChild(this.setCustom);
    this.customIcon = new PIXI.Sprite(App.CombinedTextures.gears_icon);
    this.customIcon.x = this.ox + 50;
    this.customIcon.y = this.setCustom.y - 3;
    this.customIcon.scale.x = this.customIcon.scale.y = 0.4;
    this.container.addChild(this.customIcon);
    this.serverCreationPriceLabel = new PIXI.BitmapText("Price", {
      fontName: "Open Sans",
      fontSize: 24,
    });
    this.serverCreationPriceLabel.x = this.ox + 44;
    this.serverCreationPriceLabel.y = this.oy + 330;
    this.serverCreationPriceLabel.tint = 16777215;
    this.container.addChild(this.serverCreationPriceLabel);
    this.goldIcon = new PIXI.Sprite(App.CombinedTextures.gold1);
    this.goldIcon.x = this.ox + 54;
    this.goldIcon.y = this.oy + 366;
    this.goldIcon.scale.x = this.goldIcon.scale.y = 0.4;
    this.container.addChild(this.goldIcon);
    this.serverCreationPriceValue = new PIXI.BitmapText("0", {
      fontName: "Open Sans",
      fontSize: 24,
    });
    this.serverCreationPriceValue.x = this.goldIcon.x + this.goldIcon.width + 8;
    this.serverCreationPriceValue.y = this.goldIcon.y;
    this.serverCreationPriceValue.tint = 16763904;
    this.container.addChild(this.serverCreationPriceValue);
    this.serverCreationNameLabel = new PIXI.BitmapText("Name", {
      fontName: "Open Sans",
      fontSize: 24,
    });
    this.serverCreationNameLabel.x = this.ox + 44;
    this.serverCreationNameLabel.y = this.oy + 406;
    this.serverCreationNameLabel.tint = 16777215;
    this.container.addChild(this.serverCreationNameLabel);
    this.nameField = new InputField("name");
    this.nameField.setDimensions(280, 35);
    this.nameField.forceLowerCase = !1;
    this.nameField.setMaxChars(20);
    this.nameField.x = this.ox + 54;
    this.nameField.y = this.oy + 438;
    this.nameField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-& !*"
    );
    this.container.addChild(this.nameField);
    this.serverCreationPasswordLabel = new PIXI.BitmapText("Password", {
      fontName: "Open Sans",
      fontSize: 24,
    });
    this.serverCreationPasswordLabel.x = this.nameField.x + this.nameField.width + 16;
    this.serverCreationPasswordLabel.y = this.oy + 406;
    this.serverCreationPasswordLabel.tint = 16777215;
    this.container.addChild(this.serverCreationPasswordLabel);
    this.passwordField = new InputField("password");
    this.passwordField.setDimensions(110, 35);
    this.passwordField.forceLowerCase = !1;
    this.passwordField.setMaxChars(8);
    this.passwordField.setPassword(!0);
    this.passwordField.x = this.nameField.x + this.nameField.width + 32;
    this.passwordField.y = this.oy + 438;
    this.passwordField.setFilter("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890");
    this.container.addChild(this.passwordField);
    this.serverCreationModeLabel = new PIXI.BitmapText("Mode", {
      fontName: "Open Sans",
      fontSize: 24,
    });
    this.serverCreationModeLabel.x = this.ox + 44;
    this.serverCreationModeLabel.y = this.oy + 250;
    this.serverCreationModeLabel.tint = 16777215;
    this.container.addChild(this.serverCreationModeLabel);
    this.modeList = new Dropdown("modeSelect", "", 200, 200);
    this.modeList.addListener(Button.BUTTON_RELEASED, (a) => this.onModeListSelect(a.data.value));
    this.modeList.x = this.ox - 10;
    this.modeList.y = this.oy + 290;
    this.modeList.addItem(
      Game.MODE_TITLES[Game.MODE_DM],
      Game.MODE_DM,
      "",
      App.CombinedTextures.dm_icon_notxt
    );
    this.modeList.addItem(
      Game.MODE_TITLES[Game.MODE_TDM],
      Game.MODE_TDM,
      "",
      App.CombinedTextures.tdm_icon_notxt
    );
    this.modeList.addItem(
      Game.MODE_TITLES[Game.MODE_CTF],
      Game.MODE_CTF,
      "",
      App.CombinedTextures.ctf_icon_notxt
    );
    this.modeList.addItem(
      Game.MODE_TITLES[Game.MODE_DB],
      Game.MODE_DB,
      "",
      App.CombinedTextures.db_icon_notxt
    );
    this.modeList.scale.x = this.modeList.scale.y = 0.9;
    this.container.addChild(this.modeList);
    this.serverCreationDurationLabel = new PIXI.BitmapText("Duration", {
      fontName: "Open Sans",
      fontSize: 24,
    });
    this.serverCreationDurationLabel.x = this.ox + 244;
    this.serverCreationDurationLabel.y = this.oy + 250;
    this.serverCreationDurationLabel.tint = 16777215;
    this.container.addChild(this.serverCreationDurationLabel);
    this.durationList = new Dropdown("duration", "", 120, 120);
    this.durationList.addListener(Button.BUTTON_RELEASED, (a) =>
      this.onDurationListSelect(a.data.value)
    );
    this.durationList.x = this.ox + 190;
    this.durationList.y = this.oy + 290;
    this.durationList.addItem("30 min", ServerCreationMenu.DURATION_A, "");
    this.durationList.addItem("1 hour", ServerCreationMenu.DURATION_B, "");
    this.durationList.addItem("1.5 hours", ServerCreationMenu.DURATION_C, "");
    this.durationList.addItem("2 hours", ServerCreationMenu.DURATION_D, "");
    this.durationList.addItem("3 hours", ServerCreationMenu.DURATION_E, "");
    this.durationList.addItem("4 hours", ServerCreationMenu.DURATION_F, "");
    this.durationList.addItem("6 hours", ServerCreationMenu.DURATION_G, "");
    this.durationList.scale.x = this.durationList.scale.y = 0.9;
    this.durationList.setValue(this.duration);
    this.container.addChild(this.durationList);
    this.serverList = new Dropdown("serverSelect", "Region", 180, 256);
    this.serverList.x = this.ox + 40;
    this.serverList.y = this.oy + 70;
    this.serverList.addListener(Button.BUTTON_RELEASED, (a) => {
      this.emit(Layer.Events.SERVER_CREATION_REGION, a.data.value);
    });
    this.container.addChild(this.serverList);
    this.serverList.setTint(16777215);
    this.updatePrice();
  }
  show() {
    super.show();
    Dropdown.AddInstance(this.serverList);
    Dropdown.AddInstance(this.durationList);
    Dropdown.AddInstance(this.modeList);
    this.serverList.clear();
    for (var a = 0; a < App.Servers.length; a++) {
      let b = App.Servers[a];
      this.serverList.addItem(b.title, b.id, b.players + " players");
    }
    0 < App.Servers.length &&
      (void 0 !== App.ConnectedServer.id
        ? this.serverList.setValue(App.ConnectedServer.id)
        : this.serverList.setValue(App.Servers[Math.floor(Math.random() * App.Servers.length)].id));
  }
  onModeListSelect(a) {
    this.mode = a;
    this.updatePrice();
  }
  onDurationListSelect(a) {
    this.duration = a;
    this.updatePrice();
  }
  onSetPrivate(a) {
    this.isPrivate = a;
    this.updatePrice();
  }
  onSetRanked(a) {
    this.isRanked = a;
    this.updatePrice();
  }
  onSetCustom(a) {
    this.isCustom = a;
    this.updatePrice();
    a
      ? ((this.customizationButton.alpha = 1), (this.customizationButton.interactive = !0))
      : ((this.customizationButton.alpha = 0.5), (this.customizationButton.interactive = !1));
  }
  updatePrice() {
    let a = 100;
    this.isPrivate
      ? ((a += 100),
        (this.serverCreationPasswordLabel.alpha = 1),
        (this.passwordField.alpha = 1),
        (this.passwordField.interactive = !0))
      : ((this.serverCreationPasswordLabel.alpha = 0.5),
        (this.passwordField.alpha = 0.5),
        this.passwordField.setText(""),
        (this.passwordField.interactive = !1));
    this.isRanked && (a += 0);
    this.isCustom && (a += 0);
    a += ServerCreationMenu.DURATION_PRICE_MAP[this.duration];
    this.serverCreationPriceValue.text = a.toString();
  }
  onCustomizeServerInit() {
    this.customizationMenu.setMode(this.mode);
    this.container.addChild(this.customizationMenu);
  }
  onCreateServerCancel() {
    this.enableCreationInput();
    this.hideConfirmationContainer();
  }
  setErrorMessage(a = "") {
    this.errorMessage.text = a;
    this.errorMessage.x = 0.5 * (this.confirmationBackground.width - this.errorMessage.width);
  }
  onClientConnect() {
    this.setErrorMessage("");
  }
  onClientDisconnect() {}
  async onCreateServerInit() {
    this.disableCreationInput();
    this.setErrorMessage();
    this.confirmationAccept.enable();
    this.confirmationDecline.enable();
    this.container.addChild(this.confirmationContainer);
    await App.Layer.updateCredentialsIfExpired();
    App.Client.isConnected() ||
      (App.Client.hasListener(Client.CONNECT, this.onClientConnect) ||
        App.Client.addListener(Client.CONNECT, this.onClientConnectBinding),
      App.Client.connect(),
      this.setErrorMessage("Connecting.. please wait."));
  }
  hideConfirmationContainer() {
    this.container.removeChild(this.confirmationContainer);
  }
  disableCreationInput() {
    this.createButton.interactive = !1;
    this.createButton.alpha = 0.5;
    this.closeButton.setEnabled(!1);
    this.modeList.interactive = !1;
    this.modeList.alpha = 0.5;
    this.modeList.collapse();
    this.serverList.interactive = !1;
    this.serverList.alpha = 0.5;
    this.serverList.collapse();
    this.durationList.interactive = !1;
    this.durationList.alpha = 0.5;
    this.durationList.collapse();
    this.nameField.interactive = !1;
    this.nameField.alpha = 0.5;
    this.setPrivate.setEnabled(!1);
    this.setRanked.setEnabled(!1);
    this.setCustom.setEnabled(!1);
    this.isCustom &&
      ((this.customizationButton.interactive = !1), (this.customizationButton.alpha = 0.5));
    this.isPrivate && ((this.passwordField.interactive = !1), (this.passwordField.alpha = 0.5));
  }
  enableCreationInput() {
    this.createButton.interactive = !0;
    this.createButton.alpha = 1;
    this.closeButton.setEnabled(!0);
    this.modeList.interactive = !0;
    this.modeList.alpha = 1;
    this.serverList.interactive = !0;
    this.serverList.alpha = 1;
    this.durationList.interactive = !0;
    this.durationList.alpha = 1;
    this.isCustom &&
      ((this.customizationButton.interactive = !0), (this.customizationButton.alpha = 1));
    this.nameField.interactive = !0;
    this.nameField.alpha = 1;
    this.setPrivate.setEnabled(!0);
    this.setRanked.setEnabled(!0);
    this.setCustom.setEnabled(!0);
    this.isPrivate && ((this.passwordField.interactive = !0), (this.passwordField.alpha = 1));
  }
  async onCreateServerConfirm() {
    if (App.Client.isConnected()) {
      this.confirmationAccept.disable();
      this.confirmationDecline.disable();
      var a = App.ConnectedServer.id,
        b =
          (this.isPrivate ? "private," : "") +
          (this.isCustom ? "custom," : "") +
          (this.isRanked ? "ranked" : ""),
        c = this.mode,
        d = this.duration,
        e = this.nameField.getText().trim(),
        f = this.passwordField.getText().trim(),
        g = App.Credential.id,
        h = {
          weapons: this.isCustom ? this.customization.weapons.map((m) => m.substring(1)) : [],
          maps: this.customization.maps,
          drops: this.customization.drops,
          shuriken: this.customization.shuriken,
        };
      (a = await APIClient.postCreateGame(a, b, c, d, e, f, h, g)) && !0 === a.success
        ? (this.disableCreationInput(),
          (this.createdServerName = a.token.name),
          (this.createdServerId = a.token.gameId),
          this.emit(Layer.Events.SERVER_CREATION_SESSION_INIT, a.token))
        : (this.setErrorMessage(a.error),
          this.confirmationAccept.enable(),
          this.confirmationDecline.enable());
    } else this.setErrorMessage("Not connected to any server.");
  }
  setCreatedStatus(a) {
    this.confirmationAccept.enable();
    this.confirmationDecline.enable();
    a.success
      ? (this.hideConfirmationContainer(), this.container.addChild(this.successContainer))
      : this.setErrorMessage(a.info);
  }
  onSuccessJoinGameAccept() {
    this.enableCreationInput();
    this.container.removeChild(this.successContainer);
    if (-1 !== this.createdServerId) {
      let a = this.passwordField.getText().trim();
      this.emit(Layer.Events.JOIN_GAME, this.createdServerName, this.createdServerId, a);
      this.createdServerId = -1;
      this.createdServerName = "";
    }
  }
  onSuccessToLobbyAccept() {
    this.enableCreationInput();
    this.container.removeChild(this.successContainer);
    this.emit(Layer.Events.SERVER_CREATION_JOIN_LOBBY);
    this.createdServerId = -1;
    this.createdServerName = "";
  }
}
ServerCreationMenu.DURATION_A = "30m";
ServerCreationMenu.DURATION_B = "60m";
ServerCreationMenu.DURATION_C = "90m";
ServerCreationMenu.DURATION_D = "120m";
ServerCreationMenu.DURATION_E = "180m";
ServerCreationMenu.DURATION_F = "240m";
ServerCreationMenu.DURATION_G = "360m";
ServerCreationMenu.DURATION_PRICE_MAP = {
  [ServerCreationMenu.DURATION_A]: 50,
  [ServerCreationMenu.DURATION_B]: 100,
  [ServerCreationMenu.DURATION_C]: 200,
  [ServerCreationMenu.DURATION_D]: 300,
  [ServerCreationMenu.DURATION_E]: 400,
  [ServerCreationMenu.DURATION_F]: 500,
  [ServerCreationMenu.DURATION_G]: 600,
};
var chatclient = {};
class ChatClient extends PIXI.utils.EventEmitter {
  constructor() {
    super();
    this.socket = null;
  }
  connect(a) {
    this.socket && this.socket.readyState !== WebSocket.CLOSED && this.disconnect();
    a = -1 === window.location.hostname.indexOf("local") ? !0 : !1;
    let b = btoa(JSON.stringify(App.Credential));
    this.socket = new WebSocket(
      (a ? "wss" : "ws") + "://" + (a ? ChatClient.SERVER_DOMAIN : "localhost") + "?auth=" + b
    );
    this.socket.binaryType = "arraybuffer";
    this.socket.onopen = this.onOpen.bind(this);
    this.socket.onmessage = this.onMessage.bind(this);
    this.socket.onclose = this.onClose.bind(this);
    this.socket.onerror = this.onError.bind(this);
  }
  disconnect() {
    this.socket.close();
  }
  onOpen(a) {
    this.emit(ChatClient.CONNECT);
  }
  onMessage(a) {
    let b;
    try {
      b = JSON.parse(a.data);
    } catch (c) {
      return;
    }
    switch (b.type) {
      case ChatClient.TYPE_MSG:
        this.emit(ChatClient.MESSAGE, b);
        break;
      case ChatClient.TYPE_STATUS:
        this.emit(ChatClient.STATUS, b);
    }
  }
  onClose(a) {
    this.emit(ChatClient.DISCONNECT);
  }
  onError(a) {
    console.log("Chat client connection error");
  }
  compose(a = ChatClient.TYPE_MSG, b) {
    a = { type: a };
    void 0 !== b && (a.msg = b);
    return JSON.stringify(a);
  }
  send(a = ChatClient.TYPE_MSG, b) {
    this.socket.readyState === WebSocket.OPEN && ((a = this.compose(a, b)), this.socket.send(a));
  }
  isConnected() {
    return null !== this.socket && this.socket.readyState === WebSocket.OPEN;
  }
}
ChatClient.TYPE_LOCAL = -1;
ChatClient.TYPE_JOIN_CLAN_CHAT = 0;
ChatClient.TYPE_LEAVE_CLAN_CHAT = 1;
ChatClient.TYPE_MSG = 2;
ChatClient.TYPE_STATUS = 3;
ChatClient.MSG_PUBLIC = 0;
ChatClient.MSG_CLAN = 1;
ChatClient.MSG_FRIEND = 2;
ChatClient.SERVER_DOMAIN = "api.ninja.io:8081";
ChatClient.SERVER_PORT = 8081;
ChatClient.CONNECT = "connect";
ChatClient.DISCONNECT = "disconnect";
ChatClient.MESSAGE = "message";
ChatClient.STATUS = "status";
var clanchatmenu = {};
class ClanChatMenu extends Feature {
  constructor() {
    super();
    this.client = new ChatClient();
    this.client.on(ChatClient.CONNECT, () => this.onConnect());
    this.client.on(ChatClient.DISCONNECT, () => this.onDisconnect());
    this.client.on(ChatClient.MESSAGE, (a) => this.onMessage(a));
    this.client.on(ChatClient.STATUS, (a) => this.onStatus(a));
    this.messages = [];
    this.lines = [];
    this.down = this.dragging = !1;
    this.background = new PIXI.Graphics();
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRoundedRect(0, 0, 400, 320, 4);
    this.background.interactive = !0;
    this.container.addChild(this.background);
    this.background.on("mousedown", (a) => {
      a.stopPropagation();
      this.down = !0;
      this.ox = a.data.global.x;
      this.oy = a.data.global.y;
    });
    this.background.on("mouseup", (a) => {
      a.stopPropagation();
      this.down = this.dragging = !1;
    });
    this.background.on("mousemove", (a) => {
      if (this.down) {
        let b = a.data.global.x;
        a = a.data.global.y;
        let c = b - this.ox,
          d = a - this.oy;
        this.x += c;
        this.y += d;
        this.ox = b;
        this.oy = a;
        0 < Math.sqrt(c * c + d * d) && (this.dragging = !0);
      }
    });
    this.title = new PIXI.BitmapText(App.Credential.clan_name + " clan chat", {
      fontName: "Open Sans",
      fontSize: 22,
    });
    this.title.x = 4;
    this.title.y = 3;
    this.title.tint = 16763904;
    this.container.addChild(this.title);
    this.inputField = new InputField("chat_msg");
    this.inputField.setDimensions(400, 30);
    this.inputField.forceLowerCase = !1;
    this.inputField.setMaxChars(72);
    this.inputField.x = 0;
    this.inputField.y = this.height - 30;
    this.inputField.setFilter(
      UserInput.ALPHANUMERIC + UserInput.CHAT_SYMBOLS + UserInput.ALPHA_EXT
    );
    this.inputField.addListener(InputField.SUBMIT, (a) => this.onSubmitMessage(a.data.value));
    this.container.addChild(this.inputField);
    this.closeButton = new PIXI.Sprite(App.CombinedTextures.exit);
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.alpha = 0.5;
    this.closeButton.interactive = !0;
    this.closeButton.x = this.width - 28;
    this.closeButton.y = 2;
    this.closeButton.on("mousedown", (a) => {
      this.closeButton.alpha = 0.5;
      this.emit(Layer.Events.CLAN_CHAT_CANCEL);
      AudioEffects.ButtonClick.audio.play();
    });
    this.closeButton.on("mouseover", (a) => {
      this.closeButton.alpha = 1;
      AudioEffects.ButtonHover.audio.play();
    });
    this.closeButton.on("mouseout", (a) => {
      this.closeButton.alpha = 0.5;
    });
    this.container.addChild(this.closeButton);
    for (let a = 0; a < ClanChatMenu.MaxMessages; a++) {
      const b = new PIXI.BitmapText("", {
        fontName: "Open Sans",
        fontSize: 22,
        multiline: !0,
        align: "left",
      });
      b.x = 5;
      b.maxWidth = 360;
      b.interactive = !1;
      b.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
      this.addChild(b);
      this.lines.push(b);
    }
  }
  async onSubmitMessage(a) {
    a = a.trim();
    0 < a.length && this.client.send(ChatClient.TYPE_MSG, a);
    this.inputField.setText("");
    this.inputField.setFocus(!0);
  }
  onMessage(a) {
    this.addMessage(a);
  }
  onStatus(a) {
    this.title.text = App.Credential.clan_name + " clan chat [" + a.online + " online]";
  }
  addMessage(a) {
    this.messages.length === ClanChatMenu.MaxMessages && this.messages.shift();
    this.messages.push(a);
    this.updateConversation();
  }
  updateConversation() {
    let a = 290;
    for (let b = this.messages.length - 1; 0 <= b; b--) {
      const c = this.messages[b],
        d = this.lines[b];
      -1 === c.id
        ? ((d.text = c.msg), (d.tint = 16776960))
        : -2 === c.id
        ? ((d.text = c.msg), (d.tint = 16711680))
        : ((d.text = c.from + ": " + c.msg), (d.tint = 16777215));
      a -= d.height + 3;
      d.y = a;
      d.alpha = 16 > a ? 0 : 1;
    }
  }
  addLocalInfoMessage(a) {
    this.addMessage({ type: ChatClient.TYPE_LOCAL, from: "local", id: -1, msg: a });
  }
  removeMessages() {
    for (let a = 0; a < this.messages.length; a++) {
      let b = this.messages[a];
      b.msg = "";
      b.id = -1;
      b.from = "";
    }
    this.updateConversation();
  }
  onConnect() {
    this.title.text = App.Credential.clan_name + " clan chat [connected]";
    this.client.send(ChatClient.TYPE_JOIN_CLAN_CHAT);
  }
  onDisconnect() {
    this.title.text = App.Credential.clan_name + " clan chat [disconnected]";
  }
  show() {
    super.show();
    this.title.text = App.Credential.clan_name + " clan chat [connecting]";
    this.client.connect();
  }
  hide() {
    super.hide();
    this.client.disconnect();
    this.removeMessages();
  }
}
ClanChatMenu.MaxMessages = 12;
var clanmenu = {};
class ClanMenu extends Feature {
  constructor() {
    super();
    this.searchTimeout = null;
    this.members = [];
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.interactive = !0;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 1);
    this.background.drawRect(0, 0, 660, 524, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504, 10);
    this.background.endFill();
    this.background.drawRect(15, 42, 630, 2);
    this.background.beginFill(6710886, 0.3);
    this.background.drawRoundedRect(24, 48, 48, 48, 4);
    this.background.endFill();
    this.background.drawRoundedRect(22, 138, 307, 356, 4);
    this.background.endFill();
    this.background.beginFill(6710886, 0.3);
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.drawRoundedRect(340, 138, 296, 190, 8);
    this.background.endFill();
    this.container.addChild(this.background);
    this.ox = 40;
    this.oy = 20;
    this.searchValue = "";
    this.titleText = new PIXI.Text("Clan profile", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleText.x = 0.5 * this.width - 20;
    this.titleText.y = this.oy + 36;
    this.titleText.anchor.x = 0.5;
    this.container.addChild(this.titleText);
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy + 34;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.CLAN_CANCEL));
    this.container.addChild(this.closeButton);
    this.uploadText = new PIXI.Text("Clan\nbanner", {
      fontName: "Arial",
      fontSize: 12,
      fill: 12303291,
      strokeThickness: 2,
      lineJoin: "round",
      wordWrap: !0,
      wordWrapWidth: 80,
      align: "center",
    });
    this.uploadText.x = this.ox - 12;
    this.uploadText.y = this.oy + 76;
    this.container.addChild(this.uploadText);
    this.nameText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16776960,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.nameText.x = this.ox + 44;
    this.nameText.y = this.oy + 78;
    this.container.addChild(this.nameText);
    this.memberText = new PIXI.Text("- members", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.memberText.x = this.ox - 14;
    this.memberText.y = this.oy + 128;
    this.container.addChild(this.memberText);
    this.statsText = new PIXI.Text("Clan statistics", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.statsText.x = this.ox + 300;
    this.statsText.y = this.oy + 128;
    this.container.addChild(this.statsText);
    this.levelIcon = new PIXI.Sprite();
    this.levelIcon.x = this.ox + 305;
    this.levelIcon.y = this.oy + 180;
    this.levelIcon.scale.x = this.levelIcon.scale.y = 0.5;
    this.container.addChild(this.levelIcon);
    this.levelLabel = new PIXI.Text("Avg. level", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.levelLabel.x = this.ox + 314;
    this.levelLabel.y = this.oy + 164;
    this.container.addChild(this.levelLabel);
    this.levelText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.levelText.x = this.ox + 341;
    this.levelText.y = this.oy + 188;
    this.container.addChild(this.levelText);
    this.levelRankLabel = new PIXI.Text("Level rank", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.levelRankLabel.x = this.ox + 314;
    this.levelRankLabel.y = this.oy + 218;
    this.container.addChild(this.levelRankLabel);
    this.levelRankText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.levelRankText.x = this.ox + 314;
    this.levelRankText.y = this.oy + 242;
    this.container.addChild(this.levelRankText);
    this.skillRankLabel = new PIXI.Text("Skill rank", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.skillRankLabel.x = this.ox + 314;
    this.skillRankLabel.y = this.oy + 272;
    this.container.addChild(this.skillRankLabel);
    this.skillRankText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.skillRankText.x = this.ox + 314;
    this.skillRankText.y = this.oy + 296;
    this.container.addChild(this.skillRankText);
    this.killsLabel = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.killsLabel.x = this.ox + 460;
    this.killsLabel.y = this.oy + 164;
    this.container.addChild(this.killsLabel);
    this.killsText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.killsText.x = this.ox + 460;
    this.killsText.y = this.oy + 188;
    this.container.addChild(this.killsText);
    this.deathsLabel = new PIXI.Text("Deaths", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.deathsLabel.x = this.ox + 460;
    this.deathsLabel.y = this.oy + 218;
    this.container.addChild(this.deathsLabel);
    this.deathsText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.deathsText.x = this.ox + 460;
    this.deathsText.y = this.oy + 242;
    this.container.addChild(this.deathsText);
    this.ctfLabel = new PIXI.Text("CTF caps", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16746496,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.ctfLabel.x = this.ox + 460;
    this.ctfLabel.y = this.oy + 272;
    this.container.addChild(this.ctfLabel);
    this.ctfText = new PIXI.Text("Loading..", {
      fontName: "Arial",
      fontSize: 17,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.ctfText.x = this.ox + 460;
    this.ctfText.y = this.oy + 296;
    this.container.addChild(this.ctfText);
    this.createdText = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 15,
      fill: 13412864,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.createdText.x = 478;
    this.createdText.y = this.oy + 72;
    this.container.addChild(this.createdText);
    this.listContainer = new PIXI.Container();
    this.listContainer.x = this.ox - 14;
    this.listContainer.y = this.oy + 122;
    this.memberListContainer = new PIXI.Container();
    this.listContainer.addChild(this.memberListContainer);
    this.container.addChild(this.listContainer);
    this.scrollbar = new ClanMemberListScrollbar(350);
    this.scrollbar.x = this.ox + 265;
    this.scrollbar.y = this.oy + 166;
    this.scrollbar.on(ClanMemberListScrollbar.SCROLL, (a) => {
      this.maskMemberList(a);
    });
    this.container.x = 0.5 * -this.width;
  }
  show(a) {
    super.show();
    this.loadClan(a);
    this.scrollbar.enableWheel();
  }
  hide() {
    this.scrollbar.disableWheel();
  }
  async loadClan(a) {
    var b = await APIClient.getClanByClanId(a);
    if (b.success) {
      var c = b.clan,
        d = new Date(Date.parse(c.created)),
        e = d.getFullYear(),
        f = d.getMonth() + 1;
      d = d.getDate();
      e = e.toString() + "-" + f.toString().padStart(2, "0") + "-" + d.toString().padStart(2, "0");
      f = Math.min(
        Math.max(
          Math.floor(0.2 * Math.sqrt(parseInt(c.experience) / parseInt(b.memberCount) / 15.625)),
          1
        ),
        160
      );
      d = Math.max(Math.floor((f / 160) * 10) + 1);
      this.nameText.text = c.name;
      this.memberText.text = b.memberCount + " members";
      this.createdText.text = "Founded on " + e;
      this.levelText.text = numberWithPeriods(f);
      this.levelIcon.texture = App.CombinedTextures["skill_icon_" + d];
      this.levelRankText.text = c.experience_ranking.toString();
      this.skillRankText.text =
        c.skill_ranking.toString() +
        "\n" +
        Game.MapSkillToTitle(parseInt(c.skill) / parseInt(b.memberCount));
      this.killsText.text = numberWithPeriods(c.kills);
      this.deathsText.text = numberWithPeriods(c.deaths);
      this.ctfText.text = numberWithPeriods(c.caps);
      b = await APIClient.getClanMembers(a);
      if (b.success) {
        this.members = [];
        this.memberListContainer.removeChildren();
        a = b.members;
        for (b = 0; b < a.length; b++)
          (c = a[b]),
            (c = new ClanMemberMenuItem(c.id, c.name, c.role, {})),
            (c.x = 0),
            (c.y = 47 + b * ClanMemberListScrollbar.ItemHeight),
            c.on(ClanMenu.ACCESS_PROFILE, (g) => this.emit(Layer.Events.USER_ACCESS, g)),
            this.members.push(c),
            this.members.length <
              Math.floor(ClanMemberListScrollbar.ListHeight / ClanMemberListScrollbar.ItemHeight) &&
              this.memberListContainer.addChild(c);
        this.members.length >
        Math.floor(ClanMemberListScrollbar.ListHeight / ClanMemberListScrollbar.ItemHeight)
          ? this.container.addChild(this.scrollbar)
          : this.container.removeChild(this.scrollbar);
        this.scrollbar.reset();
        this.maskMemberList(0);
      }
    }
  }
  maskMemberList(a) {
    let b = Math.floor(ClanMemberListScrollbar.ListHeight / ClanMemberListScrollbar.ItemHeight);
    if (this.members.length <= b) this.memberListContainer.y = 0;
    else {
      this.memberListContainer.removeChildren();
      this.memberListContainer.y = -(
        a *
        (this.members.length * ClanMemberListScrollbar.ItemHeight -
          (ClanMemberListScrollbar.ListHeight - ClanMemberListScrollbar.ItemHeight))
      );
      a = this.memberListContainer.y;
      var c = Math.round(Math.abs(a / ClanMemberListScrollbar.ItemHeight));
      for (let e = 0; e < b; e++) {
        let f = this.members[c + e];
        this.memberListContainer.addChild(f);
        if (0 === e) {
          var d = c * ClanMemberListScrollbar.ItemHeight + a;
          f.alpha = 0 <= d ? 1 : 1 - (1 / (0.5 * ClanMemberListScrollbar.ItemHeight)) * Math.abs(d);
        } else
          e === b - 1
            ? ((d = c * ClanMemberListScrollbar.ItemHeight + a),
              (f.alpha =
                0 > d ? 1 : 1 - (1 / (0.5 * ClanMemberListScrollbar.ItemHeight)) * Math.abs(d)))
            : (f.alpha = 1);
      }
    }
  }
}
ClanMenu.ACCESS_PROFILE = "accessProfile";
class ClanMemberListScrollbar extends PIXI.Container {
  constructor(a, b = 0) {
    super();
    this.scrolling = !1;
    this.start = b;
    this.h = a;
    this.bh = this.h - 39;
    this.oy = 0;
    this.scrollBar = new PIXI.Graphics();
    this.scrollBar.lineStyle(1, 16777215, 0.4, 0);
    this.scrollBar.drawRoundedRect(0, -5, 20, this.h, 4);
    this.scrollBar.endFill();
    this.scrollBar.x = 0;
    this.scrollBar.y = 0;
    this.scrollBar.interactive = !0;
    this.scrollBar.alpha = 0.5;
    this.addChild(this.scrollBar);
    this.scrollBar.hitArea = new PIXI.Rectangle(-10, -2, 50, this.h + 30);
    this.scrollButton = new PIXI.Graphics();
    this.scrollButton.lineStyle(1, 16777215, 0.4, 0);
    this.scrollButton.beginFill(16777215, 0.2);
    this.scrollButton.drawRoundedRect(0, -3, 16, 35, 4);
    this.scrollButton.endFill();
    this.addChild(this.scrollButton);
    this.scrollButton.x = 2;
    this.scrollButton.y = this.bh * this.start;
    this.scrollBar.on("mouseover", () => {
      this.scrollBar.alpha = 1;
    });
    this.scrollBar.on("mouseout", () => {
      this.scrollBar.alpha = 0.5;
    });
    this.scrollBar.on("mouseupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("mousedown", (c) => {
      c.stopPropagation();
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
    });
    this.scrollBar.on("mouseup", (c) => {
      c.stopPropagation();
      this.scrolling = !1;
    });
    this.scrollBar.on("mousemove", (c) => {
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointerup", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerupoutside", () => {
      this.scrolling = !1;
    });
    this.scrollBar.on("pointerdown", (c) => {
      this.scrolling = !0;
      this.oy = c.data.global.y / App.Scale;
      this.scroll(c.data.global.y / App.Scale);
    });
    this.scrollBar.on("pointermove", (c) => this.scroll(c.data.global.y / App.Scale));
    this.wheelListener = (c) => {
      c = c.data.delta;
      this.scrolling = !0;
      this.scroll(this.oy + 0.2 * c);
      this.scrolling = !1;
    };
  }
  enableWheel() {
    UserInput.hasListener(UserInput.WHEEL, this.wheelListener) ||
      UserInput.addListener(UserInput.WHEEL, this.wheelListener);
  }
  disableWheel() {
    UserInput.removeListener(UserInput.WHEEL, this.wheelListener);
  }
  scroll(a) {
    if (this.scrolling) {
      let b = this.scrollButton.y + (a - this.oy);
      b = 0 > b ? 0 : b > this.bh ? this.bh : b;
      let c = (1 / this.h) * b * (this.h / this.bh);
      this.scrollButton.y = b;
      this.oy = a;
      this.emit(ClanMemberListScrollbar.SCROLL, c);
    }
  }
  reset() {
    this.scrollButton.y = (this.h - 39) * this.start;
  }
  onMouseOver() {
    this.scrollButton.alpha = 1;
  }
  onMouseOut() {
    this.scrollButton.alpha = 0.5;
  }
}
ClanMemberListScrollbar.SCROLL = "scroll";
ClanMemberListScrollbar.ListHeight = 355;
ClanMemberListScrollbar.ItemHeight = 30;
class ClanMemberMenuItem extends PIXI.Container {
  constructor(a, b, c, d) {
    super();
    this.id = a;
    this.name = b;
    this.role = c;
    this.options = d;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.2);
    this.background.drawRoundedRect(0, 0, 276, 26, 4);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.alpha = 0.5;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0.5;
    });
    this.background.on("mousedown", () => this.emit(ClanMenu.ACCESS_PROFILE, this.id));
    this.addChild(this.background);
    this.nameLabel = new PIXI.BitmapText(this.name, {
      fontName: "Open Sans",
      fontSize: 22,
      align: "left",
    });
    this.nameLabel.x = 8;
    this.nameLabel.y = 2;
    this.nameLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.addChild(this.nameLabel);
    if ("captain" === this.role || "leader" === this.role)
      (this.roleLabel = new PIXI.BitmapText(this.role, {
        fontName: "Open Sans",
        fontSize: 22,
        align: "left",
      })),
        (this.roleLabel.x = 270 - this.roleLabel.width),
        (this.roleLabel.y = 2),
        (this.roleLabel.tint = "leader" === this.role ? 8978312 : 16746632),
        (this.roleLabel.hitArea = new PIXI.Rectangle(0, 0, 0, 0)),
        this.addChild(this.roleLabel);
  }
}
var loadingmenu = {};
class LoadingMenu extends Feature {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 0;
    this.background.beginFill(0, 0);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.lineStyle(3, 3355443, 1, 2);
    this.background.beginFill(0, 0.8);
    this.background.drawRect(130, 100, 400, 140, 8);
    this.background.endFill();
    this.container.addChild(this.background);
    this.background.hitArea = new PIXI.Rectangle(0, 0, 660, 524);
    this.background.interactive = !0;
    this.cancelCount = LoadingMenu.CANCEL_COUNT;
    this.title = new PIXI.BitmapText("Loading...", { fontName: "Open Sans", fontSize: 30 });
    this.title.x = 290;
    this.title.y = 150;
    this.title.tint = 16763904;
    this.container.addChild(this.title);
    this.container.x = 0.5 * -this.container.width;
    this.container.y = 40;
    this.visualizer = new Visualizer(176, 176, !1, !1, !0);
    this.visualizer.scale.x = -0.7;
    this.visualizer.scale.y = 0.7;
    this.visualizer.x = 268;
    this.visualizer.y = 110;
    this.container.addChild(this.visualizer);
    this.cancelButton = new Button("cancel");
    this.cancelButton.selected = !0;
    this.cancelButton.setText("Cancel");
    this.cancelButton.scale.x = this.cancelButton.scale.y = 0.8;
    this.cancelButton.addListener(Button.BUTTON_RELEASED, () =>
      this.emit(Layer.Events.LOADING_CANCEL)
    );
    this.cancelButton.x = this.title.x + 0.5 * (this.title.width - this.cancelButton.width);
    this.cancelButton.y = this.title.y + 40;
    this.cancelButton.setTint(16763904);
    this.container.addChild(this.cancelButton);
    this.cancelButton.visible = !1;
  }
  update() {
    this.visualizer.update();
    0 === this.cancelCount ? (this.cancelButton.visible = !0) : this.cancelCount--;
  }
  show() {
    this.cancelButton.visible = !1;
    this.cancelCount = LoadingMenu.CANCEL_COUNT;
    this.visualizer.applyCustomization(App.Credential.customization);
    this.setTitle("Loading...");
    this.container.x = 0.5 * -this.container.width;
  }
  setTitle(a) {
    this.title.text = a;
  }
}
LoadingMenu.CANCEL_COUNT = 60;
var renamemenu = {};
class RenameMenu extends Feature {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.2, 0);
    this.background.beginFill(0, 0.4);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(120, 88, 420, 348, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(130, 97, 400, 330, 10);
    this.background.endFill();
    this.background.interactive = !0;
    this.container.addChild(this.background);
    this.ox = 160;
    this.oy = 108;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 160;
    this.closeButton.y = this.oy + 34;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.RENAME_CANCEL));
    this.container.addChild(this.closeButton);
    this.loginTitle = new PIXI.Text("Complete registration", {
      fontName: "Arial",
      fontSize: 19,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.loginTitle.x = this.ox - 10;
    this.loginTitle.y = this.oy + 48;
    this.container.addChild(this.loginTitle);
    this.renameDescription = new PIXI.Text(
      "Choose a username and a password.\nAll your current progress will be saved.",
      {
        fontSize: 16,
        fontFamily: "Arial",
        fill: 15658734,
        lineJoin: "round",
        strokeThickness: 2,
        lineHeight: 24,
        align: "left",
        wordWrap: !0,
        wordWrapWidth: 380,
      }
    );
    this.renameDescription.x = this.ox - 10;
    this.renameDescription.y = this.oy + 88;
    this.container.addChild(this.renameDescription);
    this.usernameTitle = new PIXI.Text("Username", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.usernameTitle.x = this.ox;
    this.usernameTitle.y = this.oy + 140;
    this.container.addChild(this.usernameTitle);
    this.passwordTitle = new PIXI.Text("Password", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16755200,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.passwordTitle.x = this.ox;
    this.passwordTitle.y = this.oy + 200;
    this.container.addChild(this.passwordTitle);
    this.errorMessage = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 16711680,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.errorMessage.x = this.ox;
    this.errorMessage.y = this.oy + 310;
    this.nameField = new InputField("rename_name");
    this.nameField.setDimensions(300, 35);
    this.nameField.forceLowerCase = !1;
    this.nameField.setMaxChars(18);
    this.nameField.x = this.ox;
    this.nameField.y = this.oy + 160;
    this.nameField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#^&*-._:=[]"
    );
    this.container.addChild(this.nameField);
    this.passwordField = new InputField("rename_password");
    this.passwordField.setDimensions(300, 35);
    this.passwordField.forceLowerCase = !1;
    this.passwordField.setMaxChars(32);
    this.passwordField.setPassword(!0);
    this.passwordField.x = this.ox;
    this.passwordField.y = this.oy + 220;
    this.passwordField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_-.@!#$%^&*()[]"
    );
    this.container.addChild(this.passwordField);
    this.submitButton = new Button("rename");
    this.submitButton.selected = !0;
    this.submitButton.setText("Save");
    this.submitButton.scale.x = this.submitButton.scale.y = 0.8;
    this.submitButton.addListener(Button.BUTTON_RELEASED, this.onSubmitButtonReleased.bind(this));
    this.submitButton.x = this.ox + 11;
    this.submitButton.y = this.oy + 274;
    this.submitButton.setTint(16763904);
    this.container.addChild(this.submitButton);
    this.loadingContainer = new PIXI.Container();
    this.loadingBackground = new PIXI.Graphics();
    this.loadingBackground.x = 0;
    this.loadingBackground.y = 0;
    this.loadingBackground.lineStyle(3, 11184810, 0.5, 0);
    this.loadingBackground.beginFill(0, 0.8);
    this.loadingBackground.drawRoundedRect(0, 0, 300, 80, 10);
    this.loadingBackground.endFill();
    this.loadingContainer.addChild(this.loadingBackground);
    this.loadingText = new PIXI.Text("Updating account...", {
      fontName: "Arial",
      fontSize: 19,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.loadingText.x = 0.5 * this.loadingBackground.width;
    this.loadingText.y = 0.5 * this.loadingBackground.height;
    this.loadingText.anchor.x = this.loadingText.anchor.y = 0.5;
    this.loadingContainer.addChild(this.loadingText);
    this.loadingContainer.x = 0.5 * -this.loadingBackground.width;
    this.loadingContainer.y = 0.5 * this.container.height - 0.5 * this.loadingBackground.height;
    this.completedContainer = new PIXI.Container();
    this.completedBackground = new PIXI.Graphics();
    this.completedBackground.x = 0;
    this.completedBackground.y = 0;
    this.completedBackground.lineStyle(3, 11184810, 0.5, 0);
    this.completedBackground.beginFill(0, 0.8);
    this.completedBackground.drawRoundedRect(0, 0, 260, 140, 10);
    this.completedBackground.endFill();
    this.completedContainer.addChild(this.completedBackground);
    this.completedText = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 19,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
      align: "center",
      wordWrap: !0,
      wordWrapWidth: 330,
    });
    this.completedText.x = 0.5 * this.completedBackground.width;
    this.completedText.y = 0.3 * this.completedBackground.height;
    this.completedText.anchor.x = this.completedText.anchor.y = 0.5;
    this.completedContainer.addChild(this.completedText);
    this.completedButton = new Button("continue");
    this.completedButton.selected = !0;
    this.completedButton.setText("Continue");
    this.completedButton.scale.x = this.completedButton.scale.y = 0.8;
    this.completedButton.addListener(
      Button.BUTTON_RELEASED,
      this.onCompletedButtonReleased.bind(this)
    );
    this.completedButton.x =
      0.5 * this.completedBackground.width - 0.5 * this.completedButton.width;
    this.completedButton.y = this.completedBackground.height - (this.completedButton.height + 16);
    this.completedButton.setTint(16763904);
    this.completedContainer.addChild(this.completedButton);
    this.completedContainer.x = 0.5 * -this.completedBackground.width;
    this.completedContainer.y = 0.5 * this.container.height - 0.5 * this.completedBackground.height;
    this.container.x = 0.5 * -this.width;
  }
  show() {
    this.nameField.setText(App.Credential.username);
  }
  reset() {}
  validateForm() {
    let a = !0,
      b = "",
      c = this.nameField.getText(),
      d = this.passwordField.getText();
    4 > c.length
      ? ((a = !1),
        (b = "Username too short. Use at least 4 characters."),
        this.nameField.markInvalid())
      : this.nameField.markNone();
    a && 8 > d.length
      ? ((a = !1),
        (b = "Password too short. Use at least 8 characters."),
        this.passwordField.markInvalid())
      : this.passwordField.markNone();
    return { valid: a, error: b };
  }
  async onSubmitButtonReleased() {
    var a = this.validateForm();
    a.valid
      ? (this.displayErrorMessage(""),
        this.displayLoadingMessage(),
        (a = await APIClient.postAutogenRename(
          this.nameField.text.text,
          this.passwordField.text.text,
          App.Credential.id
        )),
        this.loadingContainer.parent && this.removeChild(this.loadingContainer),
        (this.container.alpha = 1),
        a.success
          ? (Registry.Instance.remove(Registry.Key.AUTOGEN),
            (App.Autogen = !1),
            this.emit(Layer.Events.RENAME_COMPLETED),
            this.displayCompletedMessage())
          : (this.displayErrorMessage(a.error),
            this.submitButton.enable(),
            this.nameField.markInvalid(),
            (this.nameField.interactive = !0),
            (this.passwordField.interactive = !0)))
      : this.displayErrorMessage(a.error);
  }
  displayLoadingMessage() {
    this.addChild(this.loadingContainer);
    this.submitButton.disable();
    this.nameField.interactive = !1;
    this.passwordField.interactive = !1;
  }
  displayCompletedMessage() {
    this.loadingContainer.parent && this.removeChild(this.loadingContainer);
    this.addChild(this.completedContainer);
    this.submitButton.disable();
    this.completedText.text = "Registration completed.";
    this.nameField.interactive = !1;
    this.passwordField.interactive = !1;
  }
  onCompletedButtonReleased() {
    this.loadingContainer.parent && this.removeChild(this.loadingContainer);
    this.completedContainer.parent && this.removeChild(this.completedContainer);
    this.passwordField.setText("");
    this.emit(Layer.Events.RENAME_CANCEL);
  }
  onCancelButtonReleased() {
    this.emit(Layer.Events.RENAME_CANCEL);
  }
  displayErrorMessage(a) {
    this.errorMessage.text = a;
    this.errorMessage.parent || this.container.addChild(this.errorMessage);
  }
}
var logoutmenu = {};
class LogoutMenu extends Feature {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.2, 0);
    this.background.beginFill(0, 0.4);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(120, 88, 420, 348, 10);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(130, 97, 400, 330, 10);
    this.background.endFill();
    this.background.interactive = !0;
    this.container.addChild(this.background);
    this.ox = 160;
    this.oy = 108;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 160;
    this.closeButton.y = this.oy + 34;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.LOGOUT_CANCEL));
    this.container.addChild(this.closeButton);
    this.loginTitle = new PIXI.Text("Logout", {
      fontName: "Arial",
      fontSize: 19,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.loginTitle.x = this.ox - 10;
    this.loginTitle.y = this.oy + 48;
    this.container.addChild(this.loginTitle);
    this.autogenDescription = new PIXI.Text(
      "Important: No password has been set for this account.\n\nLogging out means you will lose all progress.\n\nClick on 'Complete registration' to save your progress.",
      {
        fontSize: 16,
        fontFamily: "Arial",
        fill: 15658734,
        lineJoin: "round",
        strokeThickness: 2,
        lineHeight: 24,
        align: "left",
        wordWrap: !0,
        wordWrapWidth: 330,
      }
    );
    this.autogenDescription.x = this.ox - 10;
    this.autogenDescription.y = this.oy + 88;
    this.container.addChild(this.autogenDescription);
    this.renameButton = new Button("rename");
    this.renameButton.selected = !0;
    this.renameButton.setText("Complete registration");
    this.renameButton.scale.x = this.renameButton.scale.y = 0.8;
    this.renameButton.addListener(Button.BUTTON_RELEASED, this.onRenameButtonReleased.bind(this));
    this.renameButton.x = this.ox + 4;
    this.renameButton.y = this.oy + 300;
    this.renameButton.setTint(16763904);
    this.container.addChild(this.renameButton);
    this.logoutButton = new Button("logout");
    this.logoutButton.selected = !0;
    this.logoutButton.setText("Logout");
    this.logoutButton.scale.x = this.logoutButton.scale.y = 0.8;
    this.logoutButton.addListener(Button.BUTTON_RELEASED, this.onLogoutButtonReleased.bind(this));
    this.logoutButton.x = this.renameButton.x + this.renameButton.width + 16;
    this.logoutButton.y = this.oy + 300;
    this.logoutButton.setTint(16711680);
    this.container.addChild(this.logoutButton);
    this.container.x = 0.5 * -this.width;
  }
  show() {
    this.loginTitle.text = "Logout - " + App.Credential.username;
  }
  reset() {}
  onRenameButtonReleased() {
    this.emit(Layer.Events.RENAME_ACCESS);
  }
  onLogoutButtonReleased() {
    this.emit(Layer.Events.LOGOUT);
  }
}
var game = {};
class Game extends PIXI.Container {
  constructor(a) {
    super();
    this.sessionId = a;
    this.settings = Registry.Instance[Registry.Key.SETTINGS];
    this.canvas = new Canvas();
    this.manager = new Manager(this.sessionId);
    this.manager.setCamera(this.canvas.getCamera());
    this.manager.mute(!this.settings.sound.enabled);
    this.manager.on(Protocol.GAME, (b) => this.emit(Protocol.GAME, b));
    this.manager.on(ModelEvent.PLAYER_SPAWN, () => this.onPlayerSpawn());
    this.manager.on(ModelEvent.PLAYER_DEATH, (b) => this.onPlayerDeath(b));
    this.manager.on(ModelEvent.PLAYER_SCORE, (b) => this.onPlayerScore(b));
    this.manager.on(ModelEvent.PLAYER_COMBO, () => this.onPlayerCombo());
    this.manager.on(ModelEvent.PLAYER_SPREE, () => this.onPlayerSpree());
    this.manager.on(ModelEvent.DB_ROUND_END, (b) => this.onDbRoundEnd(b));
    this.manager.on(ModelEvent.UPDATE_ENVIRONMENT, () => this.onUpdateEnvironment());
    this.manager.on(ModelEvent.MESSAGE, (b) => this.onModelMessage(b));
    this.manager.on(ModelEvent.INITIAL, () => this.canvas.initial());
    this.manager.on(ModelEvent.SUBMERGE, (b) => this.canvas.onSubmerge(b));
    this.manager.on(ModelEvent.SURFACE, (b) => this.canvas.onSurface(b));
    this.canvas.on(CanvasEvent.MOUSE_DOWN, () => this.onMouseDown());
    this.canvas.on(CanvasEvent.MOUSE_UP, () => this.onMouseUp());
    this.canvas.on(CanvasEvent.RIGHT_DOWN, () => this.onRightDown());
    this.canvas.on(CanvasEvent.RIGHT_UP, () => this.onRightUp());
    this.canvas.on(CanvasEvent.MOUSE_MOVE, (b) => this.onMouseMove(b));
    this.canvas.on(CanvasEvent.REQUEST_LOCAL_OBJECT, (b) => this.manager.requestLocalObject(b));
    this.canvas.on(CanvasEvent.SCALE, (b) =>
      this.canvas.layers.forEach((c) => (c.scale.x = c.scale.y = b))
    );
    this.onKeyDownListener = (b) => this.onKeyDown(b);
    this.onKeyUpListener = (b) => this.onKeyUp(b);
    this.canvas.setManager(this.manager);
    this.clients = {};
    this.numClients = 0;
    this.onDisplayAdButton = this.mode = null;
    this.ignoreMovementJoystickViewing = this.readyToSpawn = !1;
    this.lastJoystickNV = { x: 0, y: 0 };
    this.mutePref = !1;
    this.lastSent = "";
    this.hud = new Hud(this.manager);
    this.hud.on(HudEvent.SELECT_ITEM, (b) => this.onSelectItem(b));
    this.hud.on(HudEvent.MUTE_SOUND, (b) => {
      this.onMute(b);
    });
    this.hud.on(HudEvent.EXIT, () => this.emit(Layer.Events.DISCONNECT));
    this.lastInputUpdateTime = 0;
    this.reticle = new PIXI.Sprite(App.CombinedTextures.cursor_def);
    this.reticle.anchor.x = 0.5;
    this.reticle.anchor.y = 0.5;
    this.reticle.alpha = 0.8;
    this.reticle.x = 0.5 * App.ClientWidth;
    this.reticle.y = 0.5 * App.ClientHeight;
    App.IsMobile && (this.reticle.visible = !1);
    this.reticle.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.animTimeout = this.busyTimeout = null;
    this.canvas.layers.forEach((b) => this.addChild(b));
    this.addChild(this.hud);
    this.settings.graphics.reticleLine &&
      ((this.reticleLine = new PIXI.Sprite(App.CombinedTextures.reticle_line)),
      (this.reticleLine.alpha = 0.4),
      (this.reticleLine.anchor.x = 1),
      (this.reticleLine.anchor.y = 0.5),
      this.addChild(this.reticleLine),
      App.IsMobile && (this.reticleLine.visible = !1));
    this.addChild(this.reticle);
    this.gameover = !1;
    this.input = Player.Input;
    this.interpreter = new Interpreter(this);
    this.interpreter.addCommand(GameCommands.MESSAGE, (b) => this.onCmdMessage(b));
    this.interpreter.addCommand(GameCommands.CLEAR, () => this.onCmdClear());
    this.interpreter.addCommand(GameCommands.SHUTDOWN, () => this.onCmdShutdown());
    this.interpreter.addCommand(GameCommands.LOAD, (b) => this.onCmdLoad(b));
    this.interpreter.addCommand(GameCommands.SPAWN, () => this.onCmdSpawn());
    this.interpreter.addCommand(GameCommands.PAUSE, () => this.onCmdPause());
    this.interpreter.addCommand(GameCommands.SPECTATE, () => this.onCmdSpectate());
    this.interpreter.addCommand(GameCommands.JOIN, () => this.onCmdJoin());
    this.interpreter.addCommand(GameCommands.KILL, (b) => this.onCmdKill(b));
    this.interpreter.addCommand(GameCommands.LOGIN, (b) => this.onCmdLogin(b));
    this.interpreter.addCommand(GameCommands.CLIENTS, () => this.onCmdClients());
    this.interpreter.addCommand(GameCommands.COMMANDS, () => this.onCmdCommands());
    this.interpreter.addCommand(GameCommands.KICK, (b) => this.onCmdKick(b));
    this.interpreter.addCommand(GameCommands.BALANCE, () => this.onCmdBalance());
    this.interpreter.addCommand(GameCommands.PARAMS, () => this.onCmdParams());
    this.interpreter.addCommand(GameCommands.MEMSTATS, () => this.onCmdMemStats());
    this.interpreter.addCommand(GameCommands.WAVE, () => this.onCmdWave());
    this.interpreter.addCommand(GameCommands.SALUTE, () => this.onCmdSalute());
    this.interpreter.addCommand(GameCommands.LOG_PERF, () => this.onCmdLogPerf());
    this.interpreter.addCommand(GameCommands.SPAWN_BOT, (b) => this.onCmdSpawnBot(b));
    this.interpreter.setDefaultCommand(GameCommands.MESSAGE);
    App.Console.on(CommandConsole.SHOW, () => this.onShowConsole());
    App.Console.on(CommandConsole.HIDE, () => this.onHideConsole());
    this.onGameDataMap = {
      [Protocol.Game.INFO]: (b) => this.onInfo(b),
      [Protocol.Game.MESSAGE]: (b) => this.onMessage(b),
      [Protocol.Game.STATUS]: (b) => this.onStatus(b),
    };
    this.gameStatusMap = {
      [GameStatus.Player.JOIN]: (b) => {
        this.playerJoined(b);
      },
      [GameStatus.Player.LEAVE]: (b) => {
        this.playerLeft(b);
      },
      [GameStatus.Player.SPEC]: (b) => {
        b.spec ? this.setSpectator(b.sid) : this.setParticipant(b.sid);
      },
      [GameStatus.Player.LIST]: (b) => {
        for (let c = 0, d = b.players.length; c < d; c++) this.playerJoined(b.players[c], !0);
      },
      [GameStatus.Game.RUNNING]: (b) => {
        this.resumeGame(b);
      },
      [GameStatus.Game.PAUSED]: (b) => {
        this.pauseGame();
      },
      [GameStatus.Game.GAMEOVER]: (b) => {
        this.endGame(b);
      },
      [GameStatus.Game.COUNTDOWN]: (b) => {
        this.onNextGameCountdown(b);
      },
      [GameStatus.Game.LEADER]: (b) => {
        this.onLeaderStatus(b);
      },
      [GameStatus.Game.TEAM]: (b) => {
        this.onTeamStatus(b);
      },
      [GameStatus.Settings.WORLD]: (b) => {
        this.applySettings(b.settings);
        this.applyStats(b.stats);
        b.running ? this.resumeGame(b) : this.pauseGame();
      },
    };
    this.frameCount = 0;
    this.player = null;
    this.timeSinceLastUpdate = 0;
    this.manager.onPlayerSpawn = (b) => this.clients[b];
    App.Console.linkInterpreter(this.interpreter);
    UserInput.addListener(UserInput.KEY_DOWN, this.onKeyDownListener);
    UserInput.addListener(UserInput.KEY_UP, this.onKeyUpListener);
  }
  onStatus(a) {
    this.gameStatusMap[a.d.t](a.d.s);
  }
  mute(a) {
    this.manager.mute(a ? !0 : !1);
    this.hud.setMuted(a ? !0 : !1);
  }
  step(a) {
    let b = this.manager.getLocalPlayer();
    if (b && b.alive) {
      if (b.primaryItem) {
        var c = b.primaryItem.itemType,
          d = this.reticle.scale.x;
        if (ItemMap[c].resizeReticle) {
          c = ItemMap[c].resizeReticle;
          let e = 0.01 * (b.p.vx * b.p.vx + b.p.vy * b.p.vy),
            f = c.max - c.min,
            g = App.Time - b.lastInjuredTime;
          2e3 > g && (e += 0.01 * (2e3 - g));
          c = c.min + (e * f > f ? f : e * f);
          this.reticle.scale.x = this.reticle.scale.y += c < d ? 0.1 * -(d - c) : 0.1 * (c - d);
        } else 1 !== d && (this.reticle.scale.x = this.reticle.scale.y = 1);
      }
      b.facingChanged &&
        (this.input.updateFacing(Math.round((16383 / (2 * Math.PI)) * (b.virtualFacing + Math.PI))),
        (b.facingChanged = !1),
        this.reticleLine &&
          this.reticleLine.visible &&
          ((this.reticleLine.x = this.reticle.x),
          (this.reticleLine.y = this.reticle.y),
          (d = 0.5 * App.ClientWidth - this.reticle.x),
          (c = 0.5 * App.ClientHeight - this.reticle.y),
          (d = Math.sqrt(d * d + c * c)),
          (this.reticleLine.scale.x = 0.003 * d),
          (this.reticleLine.alpha = 0.5 < 8e-4 * d ? 0.5 : 8e-4 * d),
          (this.reticleLine.rotation = b.facing + Math.PI)));
    }
    this.manager.update(a);
    this.canvas.update(this.manager.suspended, a);
    this.timeSinceLastUpdate += a;
    this.frameCount++;
    this.timeSinceLastUpdate >= 1e3 / 30 && (this.dispatchInput(), (this.timeSinceLastUpdate = 0));
  }
  showReticleLine() {
    this.reticleLine && (this.reticleLine.visible = !0);
  }
  hideReticleLine() {
    this.reticleLine && (this.reticleLine.visible = !1);
  }
  dispatchInput() {
    let a = Base62Encode(((this.input.b2 << 16) | this.input.b1) >>> 0);
    a !== this.lastSent &&
      (this.emit(Protocol.GAME, { t: Protocol.Game.INPUT, d: a }),
      (this.lastSent = a),
      (this.input.changed = !1));
    this.lastInputUpdateTime = App.Time;
  }
  dispatchInputIfInDelta() {
    33 < App.Time - this.lastInputUpdateTime && this.dispatchInput();
  }
  onBinData(a) {
    this.manager.pushUpdates(a.d);
  }
  onData(a) {
    this.onGameDataMap[a.t](a);
  }
  onInfo(a) {
    App.Console.log("# " + a.msg, 13421772);
  }
  onMessage(a) {
    let b = this.clients[a.sender];
    if (void 0 !== b) {
      if (App.WhiteLabel !== App.WhiteLabel_POKI)
        if ("admin" === b.type) App.Console.log("[admin] " + b.name + ": " + a.msg, 13434624);
        else {
          if (-1 !== Game.Muted.indexOf(b.sid)) return;
          var c = Team.LabelColors[b.team];
          App.Console.log(b.name + ": " + a.msg, c);
        }
      b.spec || this.manager.showPlayerChat(b.sid, a.msg);
    }
  }
  setSpectator(a) {}
  setParticipant(a) {}
  applyStats(a) {
    this.hud.updateTeamStats(a);
  }
  applySettings(a) {
    this.manager.applySettings(a);
    this.mode = a.mode;
    this.hud.setGameMode(this.mode);
    this.hud.setAvailableItems(a.items);
    this.gameover || this.hud.displayWeaponMenu(!0);
  }
  playerJoined(a, b) {
    this.clients[a.sid] = a;
    this.numClients++;
    this.gameover ||
      (a.sid === this.sessionId
        ? ((this.player = a), (a.local = !0), b || void 0 === a.team || this.hud.addClient(a))
        : void 0 !== a.team && this.hud.addClient(a));
  }
  onTeamStatus(a) {
    let b = this.clients[a.sid];
    this.hud.removeClient(b);
    b.team = a.index;
    b.sid === this.sessionId &&
      this.hud.textBarMessage(
        "You have joined team " + Team.Colors[b.team],
        Team.HexColors[b.team]
      );
    this.hud.addClient(b);
  }
  playerLeft(a) {
    let b = this.clients[a.sid];
    void 0 === b
      ? console.log("warning: playerLeft() - client does not exist")
      : (-1 !== Game.Muted.indexOf(b.sid) && Game.Muted.splice(Game.Muted.indexOf(b.sid), 1),
        this.hud.removeClient(b),
        delete this.clients[a.sid],
        this.numClients--);
  }
  shutdown() {
    this.manager.destroy();
    UserInput.removeListener(UserInput.KEY_DOWN, this.onKeyDownListener);
    UserInput.removeListener(UserInput.KEY_UP, this.onKeyUpListener);
    App.Console.unlinkInterpreter(this.interpreter);
    this.hud.cleanup();
  }
  pauseGame() {
    this.reticle.scale.x = this.reticle.scale.y = 1;
    this.gameover || (this.manager.suspend(), App.Console.log("Game paused"));
  }
  resumeGame() {
    this.emit(Game.MATCH_START);
    this.gameover = !1;
    this.canvas.endVictoryAnimation();
    this.manager.resume();
    this.hud.displayWeaponMenu(!0);
    App.Console.log("Game resumed");
  }
  endGame(a) {
    this.emit(Game.MATCH_END);
    this.reticle.scale.x = this.reticle.scale.y = 1;
    this.gameover = !0;
    this.hideReticleLine();
    if (this.onDisplayAdButton) this.onDisplayAdButton();
    if (!a.skip) {
      var b = "";
      if (1 === a.mode) {
        var c = !1;
        let d = this.manager.getLocalPlayer(),
          e;
        switch (this.mode) {
          case Game.MODE_CTF:
            -1 === a.winner
              ? (b = "The game ended in a draw.")
              : ((b = Team.Names[a.winner]),
                (b = b.charAt(0).toUpperCase() + b.slice(1)),
                (b = "Team " + b + " has won the game!"),
                (c = d && a.winner === d.team));
            setTimeout(() => {
              this.manager.suspend();
              (e = this.manager.getLastScoringPlayer()) &&
                this.canvas.initCTFVictoryAnimation(e.torsoupper.id);
            }, 150);
            break;
          case Game.MODE_TDM:
            -1 === a.winner
              ? (b = "The game ended in a draw.")
              : ((b = Team.Names[a.winner]),
                (b = b.charAt(0).toUpperCase() + b.slice(1)),
                (b = "Team " + b + " has won the game!"),
                (c = d && a.winner === d.team));
            setTimeout(() => this.manager.suspend(), 150);
            break;
          case Game.MODE_DM:
            c = this.clients[a.winner];
            b = c.name + " has won the game!";
            setTimeout(() => {
              this.manager.suspend();
              (e = this.manager.getPlayerById(a.winner)) &&
                this.canvas.initDMVictoryAnimation(e.torsoupper.id);
            }, 150);
            c = d && c.id === d.id;
            break;
          case Game.MODE_DB:
            -1 === a.winner
              ? (b = "The game ended in a draw.")
              : ((b = Team.Names[a.winner]),
                (b = b.charAt(0).toUpperCase() + b.slice(1)),
                (b = "Team " + b + " has won the game!"),
                (c = d && a.winner === d.team));
            setTimeout(() => this.manager.suspend(), 150);
            break;
          case Game.MODE_TR:
            (e = this.clients[d.id]),
              (b = "Training match has ended."),
              setTimeout(() => {
                this.manager.suspend();
                (e = this.manager.getPlayerById(d.id)) &&
                  this.canvas.initDMVictoryAnimation(e.torsoupper.id);
              }, 150),
              (c = !1);
        }
        if (c)
          switch (App.WhiteLabel) {
            case App.WhiteLabel_CG:
              App.CrazySDK.happytime();
              break;
            case App.WhiteLabel_POKI:
            case App.WhiteLabel_POKI_MAIN:
              App.PokiSDK && App.PokiSDK.happyTime(1);
          }
        a.completed && App.Console.log("This game has completed. Shutting down.", 16766720);
      } else
        (b = a.completed ? "This game has completed. Shutting down." : "Starting next round.."),
          this.manager.suspend();
      this.hud.setGameoverState({ msg: b, countdown: a.countdown, completed: a.completed });
      App.Console.log(b, 16766720);
      if (a.leaderboard) {
        a.leaderboard.name = [];
        for (let d = 0, e = a.leaderboard.id.length; d < e; d++)
          (b = this.clients[a.leaderboard.id[d]]) && a.leaderboard.name.push(b.name);
        this.hud.setLeaderboard(a.leaderboard);
      }
    }
  }
  onStartNewGame() {
    this.reticle.scale.x = this.reticle.scale.y = 1;
    this.readyToSpawn = !1;
    this.manager.clear();
    this.hud.setPlayMode();
    this.hud.emptyLeaderboard();
    this.canvas.endVictoryAnimation();
    this.manager.resume();
    for (let a in this.clients) this.hud.addClient(this.clients[a]);
    this.hud.textBarMessage("Loading map...", 11184810);
  }
  onNextGameCountdown(a) {
    0 === a.count
      ? (this.hud.setGameoverCount(5), this.onStartNewGame())
      : this.hud.setGameoverCount(a.count);
  }
  onLeaderStatus(a) {
    let b = this.clients[a.id];
    b
      ? this.mode === Game.MODE_DM && App.Console.log(b.name + " takes the lead!")
      : console.log("WARNING: onLeaderStatus - client " + a.id + " does not exist");
  }
  focus() {
    this.manager.focus();
  }
  onPlayerSpawn() {
    App.IsMobile || this.showReticleLine();
    App.Console.isActive() &&
      (null !== this.busyTimeout && clearTimeout(this.busyTimeout),
      (this.busyTimeout = setTimeout(() => this.requestDisplayChatBubble(), 400)));
  }
  onPlayerDeath(a) {
    a.killer !== a.victim && this.hud.registerKill(a.killer);
    a.victim.sid === this.player.sid &&
      ((this.reticle.scale.x = this.reticle.scale.y = 1), this.hideReticleLine());
  }
  onPlayerScore(a) {
    this.hud.registerScore(a.player);
  }
  onDbRoundEnd(a) {
    this.hud.registerDbRoundWin(a.team);
  }
  displayHelp() {
    this.hud.displayHelpImage();
  }
  onPlayerCombo() {}
  onPlayerSpree() {}
  onUpdateEnvironment() {}
  onSelectItem(a) {
    a &&
      this.emit(Protocol.GAME, {
        t: Protocol.Game.COMMAND,
        cmd: { name: GameCommands.PREFERENCE, pref: { item: a.itemId } },
      });
    (this.readyToSpawn && a) ||
      ((this.readyToSpawn = !0),
      this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.SPAWN } }));
  }
  onModelMessage(a) {
    this.hud.textBarMessage(a.text, a.color, a.icon);
  }
  onKeyUp(a) {
    if (void 0 !== a.data.char) {
      var b = a.data.char.toUpperCase();
      characterMapCTRL[a.data.code] && (b = characterMapCTRL[a.data.code]);
      this.input.update(b, 0) && this.dispatchInputIfInDelta();
    }
  }
  onMouseDown() {
    App.Console.isActive() && App.Console.setActive(!1);
    this.readyToSpawn
      ? this.input.update("LM", 1) && this.dispatchInputIfInDelta()
      : ((this.readyToSpawn = !0),
        this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.SPAWN } }));
  }
  onMouseUp() {
    this.input.update("LM", 0) &&
      (this.dispatchInputIfInDelta(),
      this.canvas.getCamera().tracking &&
        !this.gameover &&
        this.manager.getLocalPlayer().alive &&
        this.manager.trackPlayer(this.player.sid));
  }
  onMouseMove(a) {
    this.reticle.x = a.x;
    this.reticle.y = a.y;
  }
  onRightDown() {
    this.input.update("RM", 1) && this.dispatchInputIfInDelta();
    this.player && this.player.spec && this.manager.setTrackObject(null);
  }
  onRightUp() {
    this.input.update("RM", 0) && this.dispatchInputIfInDelta();
  }
  onKeyDown(a) {
    if (!App.Console.isActive() && void 0 !== a.data.char) {
      var b = a.data.char.toUpperCase();
      characterMapCTRL[a.data.code] && (b = characterMapCTRL[a.data.code]);
      switch (a.data.code) {
        case 191:
          App.Console.isActive() || (App.Console.setActive(!0), App.Console.addInputString("/"));
          break;
        case 13:
          App.Console.setActive(!0);
          break;
        case 49:
          this.onCmdWave();
          break;
        case 50:
          this.onCmdSalute();
      }
      this.input.update(b, 1) && this.dispatchInputIfInDelta();
    }
  }
  requestDisplayChatBubble() {
    App.Console.isActive() &&
      (this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.BUSY } }),
      (this.busyTimeout = null));
  }
  requestHideChatBubble() {
    App.Console.isActive() ||
      (this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.DONE } }),
      (this.busyTimeout = null));
  }
  updateJoystickMoveState(a) {
    a.left
      ? (this.input.update("A", 1), this.input.update("D", 0))
      : a.right
      ? (this.input.update("A", 0), this.input.update("D", 1))
      : (this.input.update("A", 0), this.input.update("D", 0));
    a.jump ? this.input.update("W", 1) : this.input.update("W", 0);
    a.fly
      ? (this.input.update("X", 0), this.input.update("S", 0), this.input.update("RM", 1))
      : (a.crouch
          ? (this.input.update("X", 0), this.input.update("S", 1))
          : (a.prone ? this.input.update("X", 1) : this.input.update("X", 0),
            this.input.update("S", 0)),
        this.input.update("RM", 0));
    this.ignoreMovementJoystickViewing ||
      this.canvas.mousePositionFromNormalizedVector({ x: a.nx, y: a.ny }, 0.2);
    this.dispatchInputIfInDelta();
  }
  updateJoystickTargetState(a) {
    a.end
      ? ((this.ignoreMovementJoystickViewing = !1),
        this.canvas.mousePositionFromNormalizedVector({
          x: 0.1 * this.lastJoystickNV.x,
          y: 0.1 * this.lastJoystickNV.y,
        }))
      : ((this.ignoreMovementJoystickViewing = !0),
        this.canvas.mousePositionFromNormalizedVector({ x: a.nx, y: a.ny }),
        (this.lastJoystickNV.x = a.nx),
        (this.lastJoystickNV.y = a.ny));
    a.fire ? this.input.update("LM", 1) : this.input.update("LM", 0);
    a.throw ? this.input.update("E", 1) : this.input.update("E", 0);
    a.switch ? this.input.update("Q", 1) : this.input.update("Q", 0);
    this.dispatchInputIfInDelta();
  }
  onEscapeMenuAccess() {
    this.hud.displayEscapeMenu();
  }
  onMute(a) {
    this.mutePref = a ? !0 : null;
    this.manager.mute(a);
  }
  onCmdMessage(a) {
    0 < a.length && this.emit(Protocol.GAME, { t: Protocol.Game.MESSAGE, msg: a });
  }
  onCmdClear() {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.CLEAR } });
  }
  onCmdShutdown() {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.SHUTDOWN } });
  }
  onCmdLoad(a) {
    this.emit(Protocol.GAME, {
      t: Protocol.Game.COMMAND,
      cmd: { name: GameCommands.LOAD, map: a },
    });
  }
  onCmdSpawn() {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.SPAWN } });
  }
  onCmdPause() {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.PAUSE } });
  }
  onCmdSpectate() {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.SPECTATE } });
  }
  onCmdJoin() {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.JOIN } });
  }
  onCmdKill(a) {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.KILL }, id: a });
  }
  onCmdLogin(a) {
    a &&
      0 < a.length &&
      this.emit(Protocol.GAME, {
        t: Protocol.Game.COMMAND,
        cmd: { name: GameCommands.LOGIN },
        password: a,
      });
  }
  onCmdClients() {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.CLIENTS } });
  }
  onCmdCommands() {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.COMMANDS } });
  }
  onCmdKick(a) {
    null !== a &&
      0 < a.length &&
      this.emit(Protocol.GAME, {
        t: Protocol.Game.COMMAND,
        cmd: { name: GameCommands.KICK },
        id: a,
      });
  }
  onCmdBalance() {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.BALANCE } });
  }
  onCmdParams() {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.PARAMS } });
  }
  onCmdMemStats() {
    this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.MEMSTATS } });
  }
  onCmdWave() {
    null === this.animTimeout &&
      (this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.WAVE } }),
      (this.animTimeout = setTimeout(() => {
        this.animTimeout = null;
      }, 2e3)));
  }
  onCmdSalute() {
    null === this.animTimeout &&
      (this.emit(Protocol.GAME, { t: Protocol.Game.COMMAND, cmd: { name: GameCommands.SALUTE } }),
      (this.animTimeout = setTimeout(() => {
        this.animTimeout = null;
      }, 2e3)));
  }
  onCmdLogPerf() {
    App.DisplayFrameTime = !App.DisplayFrameTime;
    App.DisplayFrameTime
      ? App.Console.log(
          "# LOGGING PERFORMANCE [ FT = total frame time, L = game logic time, R = render time ]"
        )
      : App.Console.log("# LOGGING STOPPED");
  }
  onCmdSpawnBot(a) {
    this.emit(Protocol.GAME, {
      t: Protocol.Game.COMMAND,
      cmd: { name: GameCommands.SPAWN_BOT },
      num: a,
    });
  }
  resize() {}
  onShowConsole() {
    null !== this.busyTimeout && clearTimeout(this.busyTimeout);
    this.busyTimeout = setTimeout(() => this.requestDisplayChatBubble(), 400);
  }
  onHideConsole() {
    null !== this.busyTimeout && clearTimeout(this.busyTimeout);
    this.busyTimeout = setTimeout(() => this.requestHideChatBubble(), 400);
  }
}
Game.Muted = [];
Game.MODE_CTF = "captureTheFlag";
Game.MODE_DM = "deathmatch";
Game.MODE_TDM = "teamDeathmatch";
Game.MODE_DB = "dodgeball";
Game.MODE_TR = "training";
Game.MODE_1V1 = "1v1";
Game.MATCH_END = "matchEnd";
Game.MATCH_START = "matchStart";
Game.MODE_MAP = {
  [Game.MODE_CTF]: "ctf",
  [Game.MODE_DM]: "dm",
  [Game.MODE_TDM]: "tdm",
  [Game.MODE_DB]: "db",
  [Game.MODE_TR]: "tr",
  [Game.MODE_1V1]: "1v1",
};
Game.MODE_TITLES = {
  [Game.MODE_CTF]: "Capture the flag",
  [Game.MODE_DM]: "Deathmatch",
  [Game.MODE_TDM]: "Team deathmatch",
  [Game.MODE_DB]: "Dodgeball",
  [Game.MODE_TR]: "Training",
  [Game.MODE_1V1]: "1 vs 1",
};
Game.EVENT_DEATH = "death";
Game.RankTitles =
  "Newbie Beginner Novice Initiated Trained Competent Adept Skilled Proficient Advanced Expert Elite Champion Master Grandmaster Ninja".split(
    " "
  );
Game.MapSkillToTitle = function (a) {
  return 49500 <= a
    ? Game.RankTitles[Game.RankTitles.length - 1]
    : Game.RankTitles[Math.floor((1 / 30) * (Math.sqrt(6 * a + 11025) - 135)) + 1];
};
Game.MapEventWepToId = function (a) {
  void 0 !== Game.WeaponMapping[a] &&
    -1 === Game.WeaponMapping[a].indexOf("_") &&
    (a = Game.WeaponMapping[a]);
  return "i" + a;
};
Game.MapEventWepToIcon = function (a) {
  if (void 0 !== Game.WeaponMapping[a]) a = Game.WeaponMapping[a];
  else if (-1 === a) return null;
  if (-3 === a) {
    var b = "900";
    a = 0.25;
  } else (b = "i" + a), (a = 0.35);
  return SpriteMap[b] ? ((b = new SpriteMap[b]()), (b.scale.x *= a), (b.scale.y *= a), b) : null;
};
Game.WeaponMapping = {
  "-1": "0",
  213: "11",
  204: "30",
  24: "31",
  25: "25_",
  22: "21_",
  20: "20_",
  23: "23_",
  26: "32",
  27: "33",
  28: "34",
  21: "21_",
  29: "35",
  30: "36",
  31: "37",
};
var serverdetailmenu = {};
class ServerDetailMenu extends Feature {
  constructor() {
    super();
    this.isPrivate = !1;
    this.isRanked = !0;
    this.isCustom = !1;
    this.maps = [];
    this.drops = [];
    this.weapons = [];
    this.mode = null;
    this.serverId = this.serverName = "";
    this.oy = this.ox = 20;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 1);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(14, 136, 208, 210, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(226, 136, 208, 210, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(438, 136, 208, 210, 10);
    this.background.endFill();
    this.background.beginFill(3355443, 1);
    this.background.drawRect(14, 60, 632, 36, 10);
    this.background.endFill();
    this.background.interactive = !0;
    this.container.addChild(this.background);
    this.container.x = 0.5 * -this.width;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy + 34;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.SERVER_DETAIL_CANCEL));
    this.container.addChild(this.closeButton);
    this.serverListingTitle = new PIXI.Text("Server details", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.serverListingTitle.x = this.ox;
    this.serverListingTitle.y = this.oy + 40;
    this.container.addChild(this.serverListingTitle);
    this.weaponListContainer = new PIXI.Container();
    this.weaponListContainer.x = 0;
    this.weaponListContainer.y = 32;
    this.weaponListTableContainerMask = new PIXI.Graphics();
    this.weaponListTableContainerMask.beginFill(16777215, 1);
    this.weaponListTableContainerMask.drawRect(20, 148, 180, 200);
    this.weaponListTableContainerMask.endFill();
    this.weaponListTableContainerMask.x = -4;
    this.weaponListContainer.addChild(this.weaponListTableContainerMask);
    this.weaponListTableContainer = new PIXI.Container();
    this.weaponListTableContainer.x = 0;
    this.weaponListTableContainer.mask = this.weaponListTableContainerMask;
    this.weaponListContainer.addChild(this.weaponListTableContainer);
    this.weaponSelectionListScrollbar = new SelectionListScrollbar(202);
    this.weaponSelectionListScrollbar.x = 200;
    this.weaponSelectionListScrollbar.y = 152;
    this.weaponListContainer.addChild(this.weaponSelectionListScrollbar);
    this.weaponSelectionListScrollbar.on(SelectionListScrollbar.SCROLL, (a) => {
      this.weaponListTableContainer.height > this.weaponListTableContainerMask.height &&
        (this.weaponListTableContainer.y = -(
          a *
          (this.weaponListTableContainer.height - this.weaponListTableContainerMask.height)
        ));
    });
    this.container.addChild(this.weaponListContainer);
    this.mapListContainer = new PIXI.Container();
    this.mapListContainer.x = 212;
    this.mapListContainer.y = 32;
    this.mapListTableContainerMask = new PIXI.Graphics();
    this.mapListTableContainerMask.beginFill(16777215, 1);
    this.mapListTableContainerMask.drawRect(20, 148, 180, 200);
    this.mapListTableContainerMask.endFill();
    this.mapListTableContainerMask.x = -4;
    this.mapListContainer.addChild(this.mapListTableContainerMask);
    this.mapListTableContainer = new PIXI.Container();
    this.mapListTableContainer.x = 0;
    this.mapListTableContainer.mask = this.mapListTableContainerMask;
    this.mapListContainer.addChild(this.mapListTableContainer);
    this.mapSelectionListScrollbar = new SelectionListScrollbar(202);
    this.mapSelectionListScrollbar.x = 200;
    this.mapSelectionListScrollbar.y = 152;
    this.mapListContainer.addChild(this.mapSelectionListScrollbar);
    this.mapSelectionListScrollbar.on(SelectionListScrollbar.SCROLL, (a) => {
      this.mapListTableContainer.height > this.mapListTableContainerMask.height &&
        (this.mapListTableContainer.y = -(
          a *
          (this.mapListTableContainer.height - this.mapListTableContainerMask.height)
        ));
    });
    this.container.addChild(this.mapListContainer);
    this.dropListContainer = new PIXI.Container();
    this.dropListContainer.x = 424;
    this.dropListContainer.y = 32;
    this.dropListTableContainerMask = new PIXI.Graphics();
    this.dropListTableContainerMask.beginFill(16777215, 1);
    this.dropListTableContainerMask.drawRect(20, 148, 180, 200);
    this.dropListTableContainerMask.endFill();
    this.dropListTableContainerMask.x = -4;
    this.dropListContainer.addChild(this.dropListTableContainerMask);
    this.dropListTableContainer = new PIXI.Container();
    this.dropListTableContainer.x = 0;
    this.dropListTableContainer.mask = this.dropListTableContainerMask;
    this.dropListContainer.addChild(this.dropListTableContainer);
    this.dropSelectionListScrollbar = new SelectionListScrollbar(202);
    this.dropSelectionListScrollbar.x = 200;
    this.dropSelectionListScrollbar.y = 152;
    this.dropListContainer.addChild(this.dropSelectionListScrollbar);
    this.dropSelectionListScrollbar.on(SelectionListScrollbar.SCROLL, (a) => {
      this.dropListTableContainer.height > this.dropListTableContainerMask.height &&
        (this.dropListTableContainer.y = -(
          a *
          (this.dropListTableContainer.height - this.dropListTableContainerMask.height)
        ));
    });
    this.container.addChild(this.dropListContainer);
    this.modeIcon = new PIXI.Sprite();
    this.modeIcon.x = this.ox + 4;
    this.modeIcon.y = this.oy + 83;
    this.container.addChild(this.modeIcon);
    this.regionIcon = new PIXI.Sprite();
    this.regionIcon.x = this.ox + 39;
    this.regionIcon.y = this.oy + 87;
    this.regionIcon.scale.x = this.regionIcon.scale.y = 0.4;
    this.container.addChild(this.regionIcon);
    this.serverTitleLabel = new PIXI.Text("", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16777215,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.serverTitleLabel.x = this.ox + 70;
    this.serverTitleLabel.y = this.oy + 90;
    this.container.addChild(this.serverTitleLabel);
    this.weaponTypeLabel = new PIXI.Text("Weapons", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16772608,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.weaponTypeLabel.x = this.ox + 4;
    this.weaponTypeLabel.y = this.oy + 134;
    this.container.addChild(this.weaponTypeLabel);
    this.mapLabel = new PIXI.Text("Maps", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16772608,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.mapLabel.x = this.ox + 214;
    this.mapLabel.y = this.oy + 134;
    this.container.addChild(this.mapLabel);
    this.dropLabel = new PIXI.Text("Item drops", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16772608,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.dropLabel.x = this.ox + 424;
    this.dropLabel.y = this.oy + 134;
    this.container.addChild(this.dropLabel);
    this.privateIcon = new PIXI.Sprite(App.CombinedTextures.lock_icon);
    this.privateIcon.x = this.width - 110;
    this.privateIcon.y = this.serverTitleLabel.y - 5;
    this.privateIcon.scale.x = this.privateIcon.scale.y = 0.4;
    this.container.addChild(this.privateIcon);
    this.rankedIcon = new PIXI.Sprite(App.CombinedTextures.ranked_icon);
    this.rankedIcon.x = this.privateIcon.x + 30;
    this.rankedIcon.y = this.serverTitleLabel.y - 5;
    this.rankedIcon.scale.x = this.rankedIcon.scale.y = 0.4;
    this.container.addChild(this.rankedIcon);
    this.customIcon = new PIXI.Sprite(App.CombinedTextures.gears_icon);
    this.customIcon.x = this.rankedIcon.x + 30;
    this.customIcon.y = this.serverTitleLabel.y - 5;
    this.customIcon.scale.x = this.customIcon.scale.y = 0.4;
    this.container.addChild(this.customIcon);
    this.activePlayersText = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
      align: "right",
    });
    this.activePlayersText.x = this.width - 100;
    this.activePlayersText.y = this.serverTitleLabel.y;
    this.activePlayersText.anchor.x = 1;
    this.container.addChild(this.activePlayersText);
    this.shurikenLabel = new PIXI.Text("", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16772608,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.shurikenLabel.x = this.ox + 40;
    this.shurikenLabel.y = this.oy + 382;
    this.container.addChild(this.shurikenLabel);
    this.shurikenIcon = new PIXI.Sprite(App.CombinedTextures.shuriken);
    this.shurikenIcon.x = this.ox + 10;
    this.shurikenIcon.y = this.oy + 380;
    this.shurikenIcon.scale.x = this.shurikenIcon.scale.y = 0.7;
    this.container.addChild(this.shurikenIcon);
    this.passwordLabel = new PIXI.Text("Password", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.passwordLabel.x = this.ox + 10;
    this.passwordLabel.y = this.oy + 426;
    this.container.addChild(this.passwordLabel);
    this.passwordField = new InputField("password");
    this.passwordField.setDimensions(110, 35);
    this.passwordField.forceLowerCase = !1;
    this.passwordField.setMaxChars(8);
    this.passwordField.x = this.ox + 100;
    this.passwordField.y = this.oy + 420;
    this.passwordField.setPassword(!0);
    this.passwordField.setFilter("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890");
    this.container.addChild(this.passwordField);
    this.joinButton = new Button("join");
    this.joinButton.selected = !1;
    this.joinButton.setText("Join now");
    this.joinButton.scale.x = this.joinButton.scale.y = 0.8;
    this.joinButton.setTint(16763904);
    this.joinButton.addListener(Button.BUTTON_RELEASED, () => {
      this.joinButton.disable();
      this.emit(Layer.Events.SERVER_DETAIL_CANCEL);
      this.emit(
        Layer.Events.JOIN_GAME,
        this.serverName,
        this.serverId,
        this.passwordField.getText().trim()
      );
    });
    this.joinButton.x = this.width - (this.joinButton.width + 16);
    this.joinButton.y = this.height - 16;
    this.container.addChild(this.joinButton);
  }
  async show(a) {
    super.show();
    this.passwordField.setText("");
    this.weaponListTableContainer.removeChildren();
    this.mapListTableContainer.removeChildren();
    this.weaponSelectionListScrollbar.reset();
    this.weaponListTableContainer.y = 0;
    this.mapSelectionListScrollbar.reset();
    this.mapListTableContainer.y = 0;
    this.mode = a.mode;
    var b = (this.isCustom = 1 === parseInt(a.custom) && void 0 !== a.data) ? a.data.weapons : [];
    let c = this.isCustom ? a.data.maps : [];
    var d = this.isCustom ? a.data.drops : [],
      e = this.isCustom ? a.data.shuriken : !0;
    this.shurikenLabel.text = e ? "Shuriken enabled" : "Shuriken disabled";
    this.serverName = a.name;
    this.serverId = a.server_id;
    this.shurikenLabel.alpha = e ? 1 : 0.3;
    this.shurikenIcon.alpha = e ? 1 : 0.3;
    this.serverTitleLabel.text = a.name;
    this.activePlayersText.text = a.players.toString() + " players in game";
    this.activePlayersText.x = this.width - 28;
    this.modeIcon.texture = App.CombinedTextures[Game.MODE_MAP[this.mode] + "_icon"];
    this.regionIcon.texture = App.CombinedTextures["globe_" + ServerListMenu.REGION_MAP[a.region]];
    this.privateIcon.x = this.serverTitleLabel.x + this.serverTitleLabel.width + 10;
    this.rankedIcon.x = this.privateIcon.x + 30;
    this.customIcon.x = this.rankedIcon.x + 30;
    this.privateIcon.alpha = 1 === parseInt(a.private) ? 1 : 0.3;
    this.rankedIcon.alpha = 1 === parseInt(a.ranked) ? 1 : 0.3;
    this.customIcon.alpha = 1 === parseInt(a.custom) ? 1 : 0.3;
    0 === parseInt(a.private)
      ? ((this.passwordField.interactive = !1),
        (this.passwordField.alpha = 0.3),
        (this.passwordLabel.alpha = 0.3))
      : ((this.passwordField.interactive = !0),
        (this.passwordField.alpha = 1),
        (this.passwordLabel.alpha = 1));
    a = this.drops;
    if (0 === this.drops.length && ((a = await APIClient.getItemDrops()), !a)) return;
    this.drops = a;
    this.dropListTableContainer.removeChildren();
    a = 0;
    for (e = 0; e < this.drops.length; e++) {
      var f = this.drops[e];
      f = new DropDisplayTableRow(
        a,
        f.item_id,
        f.prefab_id,
        f.name,
        !this.isCustom || (this.isCustom && -1 !== d.indexOf(f.item_id))
      );
      f.x = this.ox + 4;
      f.y = this.oy + 42 * a + 130;
      this.dropListTableContainer.addChild(f);
      a++;
    }
    d = 0;
    for (let g in ItemMap)
      if (
        ((a = ItemMap[g]), a.equip === ItemMap.Equip.PRIMARY || a.equip === ItemMap.Equip.SECONDARY)
      )
        (a = new WeaponDisplayTableRow(
          d,
          g,
          a.title,
          !this.isCustom || (this.isCustom && -1 !== b.indexOf(g.substring(1)))
        )),
          (a.x = this.ox + 4),
          (a.y = this.oy + 42 * d + 130),
          this.weaponListTableContainer.addChild(a),
          d++;
    b = this.maps;
    if (0 === this.maps.length && ((b = await APIClient.getMaps()), !b)) return;
    this.maps = b;
    this.isCustom || (c = this.maps.map((g) => g.id));
    this.filterMaps(c);
    this.joinButton.enable();
  }
  filterMaps(a) {
    let b = 0;
    for (let d = 0; d < this.maps.length; d++) {
      var c = this.maps[d];
      if (
        this.mode === c.mode ||
        (c.mode === Game.MODE_CTF && this.mode === Game.MODE_DM) ||
        (c.mode === Game.MODE_CTF && this.mode === Game.MODE_TDM)
      )
        (c = new MapDisplayTableRow(
          b,
          c.id,
          c.title,
          c.mode,
          !this.isCustom || (this.isCustom && -1 !== a.indexOf(c.id))
        )),
          (c.x = this.ox + 4),
          (c.y = this.oy + 42 * b + 130),
          this.mapListTableContainer.addChild(c),
          b++;
    }
  }
}
class WeaponDisplayTableRow extends PIXI.Container {
  constructor(a, b, c, d) {
    super();
    this.id = b;
    this.index = a;
    this.interactive = !0;
    this.selected = d;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.2);
    this.background.drawRect(0, 2, 200, 38);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.tint = this.selected ? 65280 : 16711680;
    this.background.alpha = 0.6;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0.6;
    });
    this.addChild(this.background);
    this.icon = new SpriteMap[b]();
    this.icon.x = 23;
    this.icon.y = 26;
    a = this.icon.width;
    b = this.icon.height;
    d = a > b ? (64 <= a ? 64 : a) : 42 <= b ? 42 : b;
    this.icon.scale.x = this.icon.scale.y = a > b ? d / this.icon.width : d / this.icon.height;
    this.icon.rotation = -0.2;
    this.addChild(this.icon);
    this.nameText = new PIXI.Text(c, {
      fontSize: 14,
      fontFamily: "Arial",
      fill: 16777215,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.nameText.x = 75;
    this.nameText.y = 12;
    this.nameText.tint = 16777215;
    this.addChild(this.nameText);
  }
}
class MapDisplayTableRow extends PIXI.Container {
  constructor(a, b, c, d, e) {
    super();
    this.id = b;
    this.index = a;
    this.interactive = !0;
    this.selected = e;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.2);
    this.background.drawRect(0, 2, 200, 38);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.tint = this.selected ? 65280 : 16711680;
    this.background.alpha = 0.6;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0.6;
    });
    this.addChild(this.background);
    this.icon = new PIXI.Sprite(App.CombinedTextures[Game.MODE_MAP[d] + "_icon"]);
    this.icon.x = 10;
    this.icon.y = 10;
    a = this.icon.width;
    b = this.icon.height;
    d = a > b ? (64 <= a ? 64 : a) : 42 <= b ? 42 : b;
    this.icon.scale.x = this.icon.scale.y = a > b ? d / this.icon.width : d / this.icon.height;
    this.icon.rotation = -0.2;
    this.addChild(this.icon);
    this.nameText = new PIXI.Text(c, {
      fontSize: 14,
      fontFamily: "Arial",
      fill: 16777215,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.nameText.x = 48;
    this.nameText.y = 12;
    this.addChild(this.nameText);
  }
}
class DropDisplayTableRow extends PIXI.Container {
  constructor(a, b, c, d, e) {
    super();
    this.id = b;
    this.index = a;
    this.interactive = !0;
    this.selected = e;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.2);
    this.background.drawRect(0, 2, 200, 38);
    this.background.endFill();
    this.background.interactive = !0;
    this.background.tint = this.selected ? 65280 : 16711680;
    this.background.alpha = 0.6;
    this.background.on("mouseover", () => {
      this.background.alpha = 1;
    });
    this.background.on("mouseout", () => {
      this.background.alpha = 0.6;
    });
    this.addChild(this.background);
    this.icon = new SpriteMap[c]();
    this.icon.x = 30;
    this.icon.y = 22;
    a = this.icon.width;
    b = this.icon.height;
    c = a > b ? (10 <= a ? 10 : a) : 10 <= b ? 10 : b;
    this.icon.scale.x = this.icon.scale.y = a > b ? c / this.icon.width : c / this.icon.height;
    this.icon.rotation = 0;
    this.addChild(this.icon);
    this.nameText = new PIXI.Text(d, {
      fontSize: 14,
      fontFamily: "Arial",
      fill: 16777215,
      lineJoin: "round",
      strokeThickness: 2,
    });
    this.nameText.x = 56;
    this.nameText.y = 12;
    this.addChild(this.nameText);
  }
}
var guestprofilemenu = {};
class GuestProfileMenu extends Feature {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.interactive = !0;
    this.background.x = 0;
    this.background.y = 40;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504);
    this.background.endFill();
    this.background.drawRect(15, 42, 630, 2);
    this.container.addChild(this.background);
    this.ox = 20;
    this.oy = 60;
    this.closeButton = new ImgButton();
    this.closeButton.x = this.background.width - 40;
    this.closeButton.y = this.oy - 6;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.GUEST_PROFILE_HIDE));
    this.container.addChild(this.closeButton);
    this.guestProfileTitle = new PIXI.Text("Profile", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.guestProfileTitle.x = 0.5 * this.width - 20;
    this.guestProfileTitle.y = this.oy - 4;
    this.guestProfileTitle.anchor.x = 0.5;
    this.container.addChild(this.guestProfileTitle);
    this.container.x = 0.5 * -this.width;
    this.profileItemContainer = new PIXI.Container();
    this.profileItemContainer.x = this.ox;
    this.profileItemContainer.y = this.oy + 50;
    this.container.addChild(this.profileItemContainer);
    this.registerDesc = new PIXI.Text(
      "You are currently on a guest account.\n\nPlease login or register to get full access to all game features.",
      { fontName: "Arial", fontSize: 16, fill: 16763904, strokeThickness: 2, lineJoin: "round" }
    );
    this.registerDesc.x = this.ox + 10;
    this.registerDesc.y = this.oy + 50;
    this.container.addChild(this.registerDesc);
    this.loginButton = new Button("login");
    this.loginButton.selected = !0;
    this.loginButton.setText("Login");
    this.loginButton.scale.x = this.loginButton.scale.y = 0.8;
    this.loginButton.addListener(Button.BUTTON_RELEASED, () =>
      this.emit(Layer.Events.LOGIN_ACCESS)
    );
    this.loginButton.x = this.ox + 20;
    this.loginButton.y = this.oy + 140;
    this.loginButton.setTint(16763904);
    this.container.addChild(this.loginButton);
    this.registerButton = new Button("register");
    this.registerButton.selected = !0;
    this.registerButton.setText("Register");
    this.registerButton.scale.x = this.registerButton.scale.y = 0.8;
    this.registerButton.addListener(Button.BUTTON_RELEASED, () =>
      this.emit(Layer.Events.REGISTER_ACCESS)
    );
    this.registerButton.x = this.loginButton.x + this.loginButton.width + 20;
    this.registerButton.y = this.oy + 140;
    this.registerButton.setTint(16763904);
    this.container.addChild(this.registerButton);
  }
  setTitle(a) {
    this.guestProfileTitle.text = a;
  }
  async show() {}
}
var highscoremenu = {};
class HighscoreMenu extends Feature {
  constructor() {
    super();
    this.display =
      0.5 < Math.random() ? HighscoreMenu.DISPLAY_EXPERIENCE : HighscoreMenu.DISPLAY_SKILL;
    this.skillRanking = [];
    this.experienceRanking = [];
    this.thumbnailContainer = new PIXI.Container();
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = -6;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRect(0, 46, 100, 524);
    this.background.endFill();
    this.container.addChild(this.background);
    this.topTitle = new PIXI.Text("Top players", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.topTitle.x = 50;
    this.topTitle.y = 46;
    this.topTitle.anchor.x = 0.5;
    this.topTitle.resolution = 1.5 * App.DevicePixelRatio;
    this.container.addChild(this.topTitle);
    this.skillButtonBg = new PIXI.Graphics();
    this.skillButtonBg.beginFill(16777215, 0.2);
    this.skillButtonBg.lineStyle(1, 16777215, 0.1, 0);
    this.skillButtonBg.drawRect(0, 0, 96, 22);
    this.container.addChild(this.skillButtonBg);
    this.skillButtonBg.x = 2;
    this.skillButtonBg.y = 80;
    this.skillButtonBg.alpha = this.display === HighscoreMenu.DISPLAY_SKILL ? 1 : 0.5;
    this.skillButtonBg.interactive = !0;
    this.skillButton = new PIXI.Text("Skill", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16776960,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillButton.x = 50;
    this.skillButton.y = 81;
    this.skillButton.anchor.x = 0.5;
    this.skillButton.resolution = 1.5 * App.DevicePixelRatio;
    this.skillButton.interactive = !1;
    this.container.addChild(this.skillButton);
    this.skillButton.alpha = this.display === HighscoreMenu.DISPLAY_SKILL ? 1 : 0.5;
    this.skillButton.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.experienceButtonBg = new PIXI.Graphics();
    this.experienceButtonBg.beginFill(16777215, 0.2);
    this.experienceButtonBg.lineStyle(1, 16777215, 0.1, 0);
    this.experienceButtonBg.drawRect(0, 0, 96, 22);
    this.container.addChild(this.experienceButtonBg);
    this.experienceButtonBg.x = 2;
    this.experienceButtonBg.y = 106;
    this.experienceButtonBg.alpha = this.display === HighscoreMenu.DISPLAY_EXPERIENCE ? 1 : 0.5;
    this.experienceButtonBg.interactive = !0;
    this.experienceButton = new PIXI.Text("Experience", {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 16,
      fill: 16776960,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.experienceButton.x = 50;
    this.experienceButton.y = 107;
    this.experienceButton.anchor.x = 0.5;
    this.experienceButton.resolution = 1.5 * App.DevicePixelRatio;
    this.experienceButton.interactive = !1;
    this.container.addChild(this.experienceButton);
    this.experienceButton.alpha = this.display === HighscoreMenu.DISPLAY_EXPERIENCE ? 1 : 0.5;
    this.experienceButton.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.skillButtonBg.on("mouseover", () => {
      this.skillButton.alpha = 1;
    });
    this.skillButtonBg.on("mouseout", () => {
      this.display !== HighscoreMenu.DISPLAY_SKILL && (this.skillButton.alpha = 0.5);
    });
    this.skillButtonBg.on("mousedown", () => {
      this.display !== HighscoreMenu.DISPLAY_SKILL &&
        ((this.display = HighscoreMenu.DISPLAY_SKILL),
        (this.skillButton.alpha = 1),
        (this.experienceButton.alpha = 0.5),
        this.refresh());
    });
    this.skillButtonBg.on("touchstart", () => {
      this.display !== HighscoreMenu.DISPLAY_SKILL &&
        ((this.display = HighscoreMenu.DISPLAY_SKILL),
        (this.skillButton.alpha = 1),
        (this.experienceButton.alpha = 0.5),
        this.refresh());
    });
    this.experienceButtonBg.on("mouseover", () => {
      this.experienceButton.alpha = 1;
    });
    this.experienceButtonBg.on("mouseout", () => {
      this.display !== HighscoreMenu.DISPLAY_EXPERIENCE && (this.experienceButton.alpha = 0.5);
    });
    this.experienceButtonBg.on("mousedown", () => {
      this.display !== HighscoreMenu.DISPLAY_EXPERIENCE &&
        ((this.display = HighscoreMenu.DISPLAY_EXPERIENCE),
        (this.skillButton.alpha = 0.5),
        (this.experienceButton.alpha = 1),
        this.refresh());
    });
    this.experienceButtonBg.on("touchstart", () => {
      this.display !== HighscoreMenu.DISPLAY_EXPERIENCE &&
        ((this.display = HighscoreMenu.DISPLAY_EXPERIENCE),
        (this.skillButton.alpha = 0.5),
        (this.experienceButton.alpha = 1),
        this.refresh());
    });
    this.container.addChild(this.thumbnailContainer);
    this.load();
  }
  async load() {
    let a = await APIClient.getRankingType("skill", 10);
    this.skillRanking = a.ranking;
    a = await APIClient.getRankingType("level", 10);
    this.experienceRanking = a.ranking;
    this.refresh();
  }
  refresh() {
    this.thumbnailContainer.removeChildren();
    let a;
    switch (this.display) {
      case HighscoreMenu.DISPLAY_SKILL:
        a = this.skillRanking;
        break;
      case HighscoreMenu.DISPLAY_EXPERIENCE:
        a = this.experienceRanking;
    }
    for (let b = 0; b < a.length; b++) {
      let c = new Thumbnail(200, 200, !0, !1);
      c.applyCustomization(a[b].cust);
      c.x = 65 + (0 !== b % 2 ? 45 : 0);
      c.y = 135 + 38 * b;
      c.scale.x = -0.4;
      c.scale.y = 0.4;
      c.hitArea = new PIXI.Circle(100, 110, 70);
      c.anchor.x = c.anchor.y = 0.5;
      c.on("mouseover", () => {
        c.scale.x = -0.5;
        c.scale.y = 0.5;
        c.x += 10;
        c.y -= 10;
        this.thumbnailContainer.setChildIndex(c, this.thumbnailContainer.children.length - 1);
      });
      c.on("mouseout", () => {
        c.scale.x = -0.4;
        c.scale.y = 0.4;
        c.x -= 10;
        c.y += 10;
      });
      c.on("mousedown", () => {
        this.emit(Layer.Events.USER_ACCESS, a[b].id);
      });
      c.on("touchstart", () => {
        this.emit(Layer.Events.USER_ACCESS, a[b].id);
      });
      this.thumbnailContainer.addChild(c);
    }
  }
  resize(a, b) {
    this.x = 0.5 * a + 330;
    this.y = -8;
  }
}
HighscoreMenu.DISPLAY_SKILL = "skill";
HighscoreMenu.DISPLAY_EXPERIENCE = "experience";
var particlecontainer = {};
class ParticleContainer extends PIXI.Container {
  constructor() {
    super();
    this.lastUpdate = 0;
  }
  spawnDirect(a) {
    this.addChild(a);
  }
  spawn(a, b) {
    for (b ||= 1; 0 < b--; ) {
      if (a.randV) {
        var c = a.randV;
        if (c.angular) {
          var d = 0;
          c.dir && (d = c.dir);
          d = d + c.minAngle + Math.random() * (c.maxAngle - c.minAngle);
          c = c.minDelta + Math.random() * (c.maxDelta - c.minDelta);
          a.nvx = a.vx + c * Math.cos(d);
          a.nvy = a.vy + c * Math.sin(d);
        } else
          (a.nvx = a.vx + c.minX + Math.random() * c.rangeX),
            (a.nvy = a.vy + c.minY + Math.random() * c.rangeY);
        10 === a._r && (a.r = Math.atan2(a.nvy, a.nvx) + 0.5 * Math.PI);
      }
      c = new PIXI.Sprite(App.CombinedTextures[a.tex]);
      c.startTTL = a.ttl;
      a.anchor
        ? ((c.anchor.x = a.anchor.x), (c.anchor.y = a.anchor.y))
        : (c.anchor.x = c.anchor.y = 0.5);
      c.x = a.x;
      c.y = a.y;
      c.rotation = a.r ?? 0;
      c.alpha = a.a ?? 1;
      c.vx = a.nvx ? a.nvx : a.vx ? a.vx : 0;
      c.vy = a.nvy ? a.nvy : a.vy ? a.vy : 0;
      c.ttl = a.ttl;
      void 0 !== a.s && (c.scale.x = c.scale.y = a.s);
      a.rs &&
        ((d = Math.random() * (a.rs.max - a.rs.min)),
        (c.scale.x *= a.rs.min + d),
        (c.scale.y *= a.rs.min + d));
      a.vat && (c.vat = a.vat);
      a.vs && (c.vs = a.vs);
      a.vr ? (c.vr = a.vr) : 10 === a._r && (c.dr = !0);
      void 0 !== a.va && (c.va = a.va);
      a.gs && (c.gs = a.gs);
      a.collide && (c.collide = a.collide);
      a.appear && ((c.alpha = 0), (c.appear = a.appear));
      void 0 !== a.tt && (c.tint = a.tt);
      this.addChild(c);
    }
  }
  update() {
    var a = App.Time;
    let b = 1;
    var c = a - this.lastUpdate;
    34 < c && (b = 50 < c ? 3 : 2);
    this.lastUpdate = a;
    for (a = this.children.length; 0 < a--; )
      (c = this.children[a]),
        0 >= c.ttl
          ? this.removeChild(c)
          : ((c.x += c.vx),
            (c.y += c.vy),
            c.vr
              ? (c.rotation += c.vr)
              : c.dr && (c.rotation = Math.atan2(c.vy, c.vx) + 0.5 * Math.PI),
            void 0 !== c.va
              ? (c.vat && c.ttl < c.vat
                  ? (c.alpha -= 1 / (c.vat * b))
                  : void 0 !== c.appear
                  ? 0 < c.appear
                    ? ((c.alpha = 0), c.appear--)
                    : 0 === c.appear && ((c.alpha = 0.75), (c.appear = void 0))
                  : (c.alpha += c.va * b),
                (c.alpha = Math.max(c.alpha, 0)))
              : (c.alpha = (1 / c.startTTL) * c.ttl),
            c.vs && ((c.scale.x += c.vs), (c.scale.y += c.vs)),
            c.gs &&
              ((c.vx += (PC.GRAVITY.x / PC.PM_RATIO) * c.gs),
              (c.vy += (PC.GRAVITY.y / PC.PM_RATIO) * c.gs)),
            c.collide && this.checkCollision(c),
            (c.ttl -= b));
  }
  checkCollision(a) {
    var b = a.x + a.vx;
    let c = a.y + a.vy,
      d = ParticleContainer.FB.search(b, c, b + a.vx, c + a.vy),
      e = Math.min(d.length, 8);
    for (let f = 0; f < e; f++) {
      let g = ParticleContainer.Segments[d[f]];
      if (0 <= Intersect3(a.x, a.y, b, c, g.x1, g.y1, g.x1 + g.x2, g.y1 + g.y2)) {
        b = (2 * (a.vx * g.x2 + a.vy * g.y2)) / (g.x2 * g.x2 + g.y2 * g.y2);
        a.vx = 0.5 * (b * g.x2 - a.vx);
        a.vy = 0.5 * (b * g.y2 - a.vy);
        break;
      }
    }
  }
  clear() {
    this.removeChildren();
    ParticleContainer.Segments = [];
    ParticleContainer.FB = { search: () => [] };
  }
}
ParticleContainer.FB = { search: () => [] };
ParticleContainer.Segments = [];
ParticleContainer.AddLineSegment = function (a) {
  ParticleContainer.Segments.push(a);
};
ParticleContainer.ProcessCollisionMesh = function () {
  let a = ParticleContainer.Segments.length;
  if (0 !== a) {
    ParticleContainer.FB = new Flatbush(a);
    for (let b = 0; b < a; b++) {
      let c = ParticleContainer.Segments[b],
        d = c.x1 + c.x2,
        e = c.y1 + c.y2;
      ParticleContainer.FB.add(
        (c.x1 < d ? c.x1 : d) - 8,
        (c.y1 < e ? c.y1 : e) - 8,
        (c.x1 < d ? d : c.x1) + 8,
        (c.y1 < e ? e : c.y1) + 8
      );
      ParticleContainer.Segments[b] = c;
    }
    ParticleContainer.FB.finish();
  }
};
var rewardsmenu = {};
class RewardsMenu extends Feature {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 40;
    this.background.beginFill(0, 0.5);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.99);
    this.background.drawRect(130, 100, 390, 324);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(140, 110, 370, 304);
    this.background.endFill();
    this.background.drawRect(145, 142, 360, 2);
    this.container.addChild(this.background);
    this.ox = 20;
    this.oy = 60;
    this.title = new PIXI.Text("Rewards", {
      fontName: "Arial",
      fontSize: 19,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.title.x = 0.5 * (this.background.width - this.title.width);
    this.title.y = 158;
    this.container.addChild(this.title);
    this.rewardsList = new PIXI.Container();
    this.rewardsList.x = 140;
    this.rewardsList.y = 150;
    this.container.addChild(this.rewardsList);
    this.closeButton = new ImgButton();
    this.closeButton.x = 480;
    this.closeButton.y = 154;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.emit(Layer.Events.REWARDS_CANCEL));
    this.container.addChild(this.closeButton);
    this.treasureIcon = new PIXI.Sprite(App.CombinedTextures.treasure);
    this.treasureIcon.x = 156;
    this.treasureIcon.y = 400;
    this.treasureIcon.interactive = !1;
    this.container.addChild(this.treasureIcon);
    this.totalAmount = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 5,
      lineJoin: "round",
    });
    this.totalAmount.x = 180;
    this.totalAmount.y = 422;
    this.totalAmount.anchor.x = 0.5;
    this.container.addChild(this.totalAmount);
    this.warningText = new PIXI.Text("Disable AdBlock to claim reward", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 16,
      fill: 16711680,
      strokeThickness: 4,
      lineJoin: "round",
    });
    this.warningText.x = 220;
    this.warningText.y = 412;
    this.warningText.resolution = 1.5 * App.DevicePixelRatio;
    this.container.addChild(this.warningText);
    this.warningText.visible = !1;
    this.rewardButton = new PIXI.Sprite(App.CombinedTextures.reward_button_claim);
    this.rewardButton.scale.x = this.rewardButton.scale.y = 0.58;
    this.rewardButton.x = 220;
    this.rewardButton.y = 394;
    this.rewardButton.interactive = !0;
    this.container.addChild(this.rewardButton);
    this.disableRewardButton();
    this.rewardButton.on("mousedown", () => {
      this.triggerRewardedBreak();
    });
    this.rewardButton.on("mouseover", () => {
      this.rewardButton.texture = App.CombinedTextures.reward_button_claim_down;
    });
    this.rewardButton.on("mouseout", () => {
      this.rewardButton.texture = App.CombinedTextures.reward_button_claim;
    });
    this.rewardContainer = new PIXI.Container();
    this.rewardContainer.visible = !1;
    this.rewardBackground = new PIXI.Graphics();
    this.rewardBackground.beginFill(0, 0.5);
    this.rewardBackground.drawRect(0, 0, 660, 524);
    this.rewardBackground.endFill();
    this.rewardBackground.lineStyle(1, 16777215, 0.1, 0);
    this.rewardBackground.beginFill(3355443, 1);
    this.rewardBackground.drawRoundedRect(165, 150, 330, 220, 10);
    this.rewardBackground.beginFill(0, 0.3);
    this.rewardBackground.drawRoundedRect(175, 160, 310, 200, 10);
    this.rewardBackground.endFill();
    this.rewardBackground.interactive = !0;
    this.rewardContainer.addChild(this.rewardBackground);
    this.rewardBackground.x = 0;
    this.rewardBackground.y = 40;
    this.rewardedAmountCounter = new PIXI.Text("0", {
      fontName: "Arial",
      fontSize: 26,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 5,
      lineJoin: "round",
    });
    this.rewardedAmountCounter.resolution = 2 * App.DevicePixelRatio;
    this.rewardedAmountCounter.anchor.x = 0.5;
    this.rewardContainer.addChild(this.rewardedAmountCounter);
    this.rewardedTreasureIcon = new PIXI.Sprite(App.CombinedTextures.treasure);
    this.rewardedTreasureIcon.x = 330;
    this.rewardedTreasureIcon.y = 250;
    this.rewardedTreasureIcon.scale.x = this.rewardedTreasureIcon.scale.y = 1.2;
    this.rewardedTreasureIcon.anchor.x = this.rewardedTreasureIcon.anchor.y = 0.5;
    this.rewardedTreasureIcon.interactive = !1;
    this.rewardContainer.addChild(this.rewardedTreasureIcon);
    this.rewardedAmountCounter.x = this.rewardedTreasureIcon.x;
    this.rewardedAmountCounter.y = this.rewardedTreasureIcon.y + 50;
    this.rewardedAmount = new PIXI.Text("Gold added to account!", {
      fontName: "Arial",
      fontSize: 20,
      lineHeight: 16,
      fill: 16763904,
      strokeThickness: 5,
      lineJoin: "round",
    });
    this.rewardedAmount.x = this.rewardedTreasureIcon.x;
    this.rewardedAmount.y = this.rewardedTreasureIcon.y + 100;
    this.rewardedAmount.anchor.x = 0.5;
    this.rewardedAmount.resolution = 1.5 * App.DevicePixelRatio;
    this.rewardContainer.addChild(this.rewardedAmount);
    this.container.x = 0.5 * -this.width;
    this.rewardContainer.x = 0.5 * -this.width;
    this.addChild(this.rewardContainer);
    this.time = 0;
    this.particles = [];
    this.animationContainer = new PIXI.Sprite();
    this.particleContainer = new ParticleContainer();
  }
  update() {
    if (this.rewardContainer.visible) {
      var a = this.rewardedTreasureIcon.x,
        b = this.rewardedTreasureIcon.y;
      for (let d = 0, e = this.particles.length; d < e; d++) {
        var c = this.particles[d];
        let f = a - c.x,
          g = b - c.y;
        10 > Math.sqrt(f * f + g * g)
          ? ((this.rewardedAmountCounter.scale.x += 0.001),
            (this.rewardedAmountCounter.scale.y += 0.001),
            (this.rewardedTreasureIcon.scale.x += 0.001),
            (this.rewardedTreasureIcon.scale.y += 0.001),
            this.animationContainer.removeChild(c),
            this.particles.splice(d, 1),
            d--,
            e--,
            AudioEffects.GoldPickup[
              Math.floor(Math.random() * AudioEffects.GoldPickup.length)
            ].audio.play())
          : ((c.x += 0.02 * f),
            (c.y += 0.04 * g),
            (c.rotation += c.vr),
            (c.vx *= 0.99),
            (c.vy *= 0.99),
            (c.alpha -= 0.004),
            (c.scale.x -= 0.002),
            (c.scale.y -= 0.002));
      }
      5 < this.particles.length &&
        ((c = ParticleEffects.GoldGlitter),
        (c.x = a),
        (c.y = b),
        (c.vx = -2 + 4 * Math.random()),
        (c.vy = -2 + 4 * Math.random()),
        (c.vr = -0.3 + 0.6 * Math.random()),
        (c.a = 0.7),
        (a = c.s),
        (c.s = 1),
        this.particleContainer.spawn(c),
        (c.s = a));
      this.particleContainer.update();
    }
  }
  displayRewardDialog(a) {
    this.container.visible = !1;
    this.rewardContainer.visible = !0;
    this.rewardedTreasureIcon.scale.x = this.rewardedTreasureIcon.scale.y = 1.2;
    this.rewardedAmountCounter.scale.x = this.rewardedAmountCounter.scale.y = 1;
    let b = parseInt(a, 10);
    this.time = 0;
    this.rewardedAmountCounter.text = "0";
    this.rewardContainer.addChild(this.animationContainer);
    this.rewardContainer.addChild(this.particleContainer);
    let c = 0;
    a = Math.round((b / 30) * 1e3);
    let d = this.rewardedTreasureIcon.x,
      e = this.rewardedTreasureIcon.y,
      f = setInterval(() => {
        let g = new PIXI.Sprite(App.CombinedTextures.gold1);
        g.anchor.x = g.anchor.y = 0.5;
        g.x = d + 100 * Math.cos(0.5 * c);
        g.y = e - 150 + 10 * Math.sin(0.5 * c);
        g.scale.x = 0.4;
        g.scale.y = 0.4;
        g.vx = 0;
        g.vy = 0;
        g.vr = 0.5 < Math.random() ? -0.2 : 0.2;
        this.particles.push(g);
        this.animationContainer.addChild(g);
        for (let h = 0; 10 > h; h++) {
          let m = ParticleEffects.GoldGlitter;
          m.x = g.x;
          m.y = g.y;
          m.vx = -1 + 2 * Math.random();
          m.vy = -1 + 2 * Math.random();
          m.vr = -0.3 + 0.6 * Math.random();
          m.a = 0.7;
          let n = m.s;
          m.s = 0.5;
          this.particleContainer.spawn(m);
          m.s = n;
        }
        c++;
        this.rewardedAmountCounter.text = c.toString();
        c >= b && (clearInterval(f), (f = null));
      }, 1e3 / 30);
    setTimeout(() => {
      null !== f && clearInterval(f);
    }, a);
    setTimeout(() => {
      this.emit(Layer.Events.REWARDS_CANCEL);
      this.rewardContainer.removeChild(this.animationContainer);
      this.rewardContainer.removeChild(this.particleContainer);
      this.animationContainer.removeChildren();
      this.particleContainer.clear();
      this.particles = [];
    }, a + 2e3);
  }
  displayRegular() {
    this.rewardContainer.visible = !1;
    this.container.visible = !0;
  }
  displayWarning() {
    this.rewardButton.visible = !1;
    this.warningText.visible = !0;
    setTimeout(() => {
      this.rewardButton.visible = !0;
      this.warningText.visible = !1;
      this.enableRewardButton();
    }, 4e3);
  }
  triggerRewardedBreak() {
    this.disableRewardButton();
    switch (App.WhiteLabel) {
      case App.WhiteLabel_CG:
        App.ShowRewardedAd = !0;
        App.CrazySDK.requestAd("rewarded");
        break;
      case App.WhiteLabel_POKI:
      case App.WhiteLabel_POKI_MAIN:
        App.PokiSDK.rewardedBreak().then((a) => {
          a
            ? this.claimRewards()
            : (this.emit(Layer.Events.REWARDS_CLAIMED, !1, 0), this.displayWarning());
        });
    }
  }
  async claimRewards() {
    let a = await APIClient.postClaimRewards(App.Credential.id);
    a.success
      ? ((App.HadRewards = !1),
        this.emit(Layer.Events.REWARDS_CLAIMED, !0, a.reward),
        this.displayRewardDialog(a.reward))
      : this.emit(Layer.Events.REWARDS_CLAIMED, !1, 0);
  }
  disableRewardButton() {
    this.rewardButton.alpha = 0.5;
    this.rewardButton.interactive = !1;
  }
  enableRewardButton() {
    this.rewardButton.alpha = 1;
    this.rewardButton.interactive = !0;
  }
  async show() {
    this.displayRegular();
    var a = await APIClient.getRewards(App.Credential.id);
    this.rewardsList.removeChildren();
    if (a.success) {
      null === a.rewards && (a.rewards = []);
      a = a.rewards;
      var b = 0,
        c = 0;
      for (let d in RewardRow.TYPE) {
        let e = new RewardRow(d, RewardRow.TYPE_AMOUNT[d]);
        e.x = 14;
        e.y = 54 + 64 * c;
        this.rewardsList.addChild(e);
        e.setInactive();
        for (let f = 0; f < a.length; f++) {
          let g = a[f];
          if (d === g.type) {
            e.setActive();
            b += parseInt(g.reward);
            break;
          }
        }
        c++;
      }
      0 < b && this.enableRewardButton();
      this.totalAmount.text = b.toString();
    }
  }
}
class RewardRow extends PIXI.Graphics {
  constructor(a, b) {
    super();
    this.lineStyle(1, 16777215, 0.1, 0);
    this.beginFill(3355443, 0.99);
    this.drawRect(0, 0, 340, 60);
    this.endFill();
    this.unlockedTitle = RewardRow.TYPE[a];
    this.goldIcon = new PIXI.Sprite(App.CombinedTextures.gold);
    this.goldIcon.scale.x = this.goldIcon.scale.y = 0.5;
    this.goldIcon.x = 10;
    this.goldIcon.y = 4;
    this.addChild(this.goldIcon);
    this.goldAmount = new PIXI.Text(b, {
      fontName: "Arial",
      fontSize: 15,
      fill: 16763904,
      strokeThickness: 4,
      lineJoin: "round",
    });
    this.goldAmount.x = this.goldIcon.x + 0.5 * this.goldIcon.width + 1;
    this.goldAmount.y = 34;
    this.goldAmount.anchor.x = 0.5;
    this.addChild(this.goldAmount);
    this.title = new PIXI.Text(this.unlockedTitle + " [locked]", {
      fontName: "Arial",
      fontSize: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.title.x = 50;
    this.title.y = 6;
    this.addChild(this.title);
    this.desc = new PIXI.Text(RewardRow.TYPE_DESC[a], {
      fontName: "Arial",
      fontSize: 15,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.desc.x = 50;
    this.desc.y = 33;
    this.addChild(this.desc);
    this.alpha = 0.5;
  }
  setActive() {
    this.alpha = 1;
    this.title.text = this.unlockedTitle;
  }
  setInactive() {
    this.alpha = 0.5;
  }
}
RewardRow.TYPE = { day: "Daily reward", "10m": "10 minutes played", "30m": "30 minutes played" };
RewardRow.TYPE_AMOUNT = { day: 150, "10m": 125, "30m": 150 };
RewardRow.TYPE_DESC = {
  day: "Join every day to get this reward.",
  "10m": "Play for 10 minutes to get this reward.",
  "30m": "Play for 30 minutes to get this reward.",
};
var layer = {};
class Layer extends PIXI.Container {
  constructor() {
    super();
    this.mode = null;
    this.member = !1;
    this.w = App.ReferenceWidth;
    this.h = App.ReferenceHeight;
    this.features = [];
    this.updateFeatures = [];
    this.gameMenu = new GameMenu();
    this.guestMenu = new GuestMenu();
    this.memberMenu = new MemberMenu();
    this.memberBrowserMenu = new MemberBrowserMenu();
    this.clanBrowserMenu = new ClanBrowserMenu();
    this.loginMenu = new LoginMenu();
    this.registerMenu = new RegisterMenu();
    this.upResetMenu = new UPResetMenu();
    this.profileMenu = new ProfileMenu();
    this.customizationMenu = new CustomizationMenu();
    this.userMenu = new UserMenu();
    this.rankingMenu = new RankingMenu();
    this.newsMenu = new NewsMenu();
    this.partnerMenu = new PartnerMenu();
    this.serverListMenu = new ServerListMenu();
    this.serverCreationMenu = new ServerCreationMenu();
    this.clanMenu = new ClanMenu();
    this.loadingMenu = new LoadingMenu();
    this.renameMenu = new RenameMenu();
    this.logoutMenu = new LogoutMenu();
    this.serverDetailMenu = new ServerDetailMenu();
    this.guestProfileMenu = new GuestProfileMenu();
    this.highscoreMenu = new HighscoreMenu();
    this.rewardsMenu = new RewardsMenu();
    this.mainMenuHides = [
      this.loginMenu,
      this.profileMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.serverListMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.serverCreationMenu,
      this.renameMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu,
    ];
    this.loginMenu.hides.push(
      this.registerMenu,
      this.upResetMenu,
      this.profileMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.partnerMenu,
      this.serverListMenu,
      this.serverCreationMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.memberBrowserMenu.hides.push(
      this.loginMenu,
      this.registerMenu,
      this.upResetMenu,
      this.profileMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.partnerMenu,
      this.serverListMenu,
      this.serverCreationMenu,
      this.loadingMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.clanBrowserMenu.hides.push(
      this.loginMenu,
      this.registerMenu,
      this.upResetMenu,
      this.profileMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.partnerMenu,
      this.serverListMenu,
      this.serverCreationMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.registerMenu.hides.push(
      this.loginMenu,
      this.upResetMenu,
      this.profileMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.partnerMenu,
      this.serverListMenu,
      this.serverCreationMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.upResetMenu.hides.push(
      this.loginMenu,
      this.registerMenu,
      this.profileMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.partnerMenu,
      this.serverListMenu,
      this.serverCreationMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.profileMenu.hides.push(
      this.loginMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.partnerMenu,
      this.serverListMenu,
      this.serverCreationMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.userMenu.hides.push(
      this.loginMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.newsMenu,
      this.partnerMenu,
      this.serverListMenu,
      this.serverCreationMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.rankingMenu.hides.push(
      this.loginMenu,
      this.profileMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.userMenu,
      this.newsMenu,
      this.partnerMenu,
      this.serverListMenu,
      this.serverCreationMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.newsMenu.hides.push(
      this.loginMenu,
      this.profileMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.partnerMenu,
      this.serverListMenu,
      this.serverCreationMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.partnerMenu.hides.push(
      this.loginMenu,
      this.profileMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.serverListMenu,
      this.serverCreationMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.serverListMenu.hides.push(
      this.loginMenu,
      this.profileMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.serverCreationMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.clanMenu.hides.push(
      this.loginMenu,
      this.profileMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.rankingMenu,
      this.newsMenu,
      this.serverCreationMenu,
      this.serverListMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.serverCreationMenu.hides.push(
      this.loginMenu,
      this.profileMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.serverListMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.renameMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.renameMenu.hides.push(
      this.loginMenu,
      this.profileMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.serverListMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.serverCreationMenu,
      this.logoutMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.logoutMenu.hides.push(
      this.loginMenu,
      this.profileMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.serverListMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.serverCreationMenu,
      this.renameMenu,
      this.serverDetailMenu,
      this.guestProfileMenu,
      this.rewardsMenu
    );
    this.guestProfileMenu.hides.push(
      this.loginMenu,
      this.profileMenu,
      this.registerMenu,
      this.upResetMenu,
      this.customizationMenu,
      this.userMenu,
      this.rankingMenu,
      this.newsMenu,
      this.serverListMenu,
      this.loadingMenu,
      this.memberBrowserMenu,
      this.clanBrowserMenu,
      this.clanMenu,
      this.serverCreationMenu,
      this.renameMenu,
      this.serverDetailMenu,
      this.rewardsMenu
    );
    this.features.push(this.gameMenu);
    this.features.push(this.guestMenu);
    this.features.push(this.memberMenu);
    this.features.push(this.memberBrowserMenu);
    this.features.push(this.clanBrowserMenu);
    this.features.push(this.loginMenu);
    this.features.push(this.registerMenu);
    this.features.push(this.upResetMenu);
    this.features.push(this.profileMenu);
    this.features.push(this.customizationMenu);
    this.features.push(this.userMenu);
    this.features.push(this.rankingMenu);
    this.features.push(this.newsMenu);
    this.features.push(this.partnerMenu);
    this.features.push(this.serverListMenu);
    this.features.push(this.serverCreationMenu);
    this.features.push(this.clanMenu);
    this.features.push(this.loadingMenu);
    this.features.push(this.renameMenu);
    this.features.push(this.logoutMenu);
    this.features.push(this.serverDetailMenu);
    this.features.push(this.guestProfileMenu);
    this.features.push(this.highscoreMenu);
    this.features.push(this.rewardsMenu);
    this.updateFeatures.push(
      this.profileMenu,
      this.userMenu,
      this.loadingMenu,
      this.rewardsMenu,
      this.customizationMenu
    );
    this.cursor = new PIXI.Sprite(App.CombinedTextures.mouse_pointer);
    this.cursor.x = 0.5 * App.ReferenceWidth;
    this.cursor.y = 0.5 * App.ReferenceHeight;
    this.cursor.anchor.x = 0;
    this.cursor.anchor.y = 0;
    this.cursor.scale.x = this.cursor.scale.y = 0.25;
    this.cursor.visible = !1;
    this.cursor.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.interactive = !0;
    this.onKeyDownListener = this.onKeyDown.bind(this);
    this.on("mousemove", (a) => {
      this.cursor.x = (a.data.global.x - this.x) / this.scale.x;
      this.cursor.y = (a.data.global.y - this.y) / this.scale.y;
    });
    this.on("mouseover", (a) => {
      this.cursor.visible = !0;
      this.cursor.parent && this.setChildIndex(this.cursor, this.children.length - 1);
    });
    this.on("mouseout", (a) => {
      this.cursor.visible = !1;
    });
    this.on("mousedown", (a) => {
      this.cursor.visible = !0;
      this.cursor.parent && this.setChildIndex(this.cursor, this.children.length - 1);
    });
    this.on("touchstart", (a) => {
      this.cursor.visible = !1;
    });
    this.setupEventRouting();
    switch (new URLSearchParams(window.location.search).get("action")) {
      case "login":
        this.onLoginShow();
    }
  }
  setupEventRouting() {
    this.gameMenu.on(Layer.Events.DISCONNECT, () => this.emit(Layer.Events.DISCONNECT));
    this.gameMenu.on(Layer.Events.JOYSTICK_MOVE_STATE, (a) =>
      this.emit(Layer.Events.JOYSTICK_MOVE_STATE, a)
    );
    this.gameMenu.on(Layer.Events.JOYSTICK_TARGET_STATE, (a) =>
      this.emit(Layer.Events.JOYSTICK_TARGET_STATE, a)
    );
    this.gameMenu.on(Layer.Events.DISPLAY_HELP, () => this.emit(Layer.Events.DISPLAY_HELP));
    this.gameMenu.on(Layer.Events.MUTE_TOGGLE, (a) => this.emit(Layer.Events.MUTE_TOGGLE, a));
    this.gameMenu.on(Layer.Events.ESCAPE_MENU_ACCESS, () =>
      this.emit(Layer.Events.ESCAPE_MENU_ACCESS)
    );
    this.guestMenu.on(Layer.Events.MENU_ACCESS, () => this.onMenuAccess());
    this.guestMenu.on(Layer.Events.LOGIN_ACCESS, () => this.onLoginShow());
    this.guestMenu.on(Layer.Events.REGISTER_ACCESS, () => this.onRegisterShow());
    this.guestMenu.on(Layer.Events.RANKING_ACCESS, () => this.onRankingShow());
    this.guestMenu.on(Layer.Events.CUSTOMIZATION_ACCESS, () => this.onGuestCustomizationAccess());
    this.guestMenu.on(Layer.Events.MEMBER_ACCESS, () => this.onMemberShow());
    this.guestMenu.on(Layer.Events.CLAN_BROWSER_ACCESS, () => this.onClanBrowserShow());
    this.guestMenu.on(Layer.Events.PARTNER_ACCESS, () => this.onPartnerShow());
    this.guestMenu.on(Layer.Events.GUEST_PROFILE_ACCESS, () => this.onGuestProfileAccess());
    this.guestMenu.on(Layer.Events.SETTINGS_ACCESS, () => this.onSettingsAccess());
    this.guestProfileMenu.on(Layer.Events.GUEST_PROFILE_HIDE, () => this.onGuestProfileHide());
    this.guestProfileMenu.on(Layer.Events.LOGIN_ACCESS, () => this.onLoginShow());
    this.guestProfileMenu.on(Layer.Events.REGISTER_ACCESS, () => this.onRegisterShow());
    this.memberMenu.on(Layer.Events.MENU_ACCESS, () => this.onMenuAccess());
    this.memberMenu.on(Layer.Events.LOGOUT, () => this.onLogout());
    this.memberMenu.on(Layer.Events.RANKING_ACCESS, () => this.onRankingShow());
    this.memberMenu.on(Layer.Events.MEMBER_ACCESS, () => this.onMemberShow());
    this.memberMenu.on(Layer.Events.CLAN_BROWSER_ACCESS, () => this.onClanBrowserShow());
    this.memberMenu.on(Layer.Events.CUSTOMIZATION_ACCESS, () => this.onCustomizationShow());
    this.memberMenu.on(Layer.Events.LOGOUT_ACCESS, () => this.onLogoutAccess());
    this.memberMenu.on(Layer.Events.SETTINGS_ACCESS, () => this.onSettingsAccess());
    this.memberMenu.on(Layer.Events.PROFILE_ACCESS, () => this.onProfileAccess());
    this.memberBrowserMenu.on(Layer.Events.MEMBER_CANCEL, () => this.onMemberCancel());
    this.memberBrowserMenu.on(Layer.Events.USER_ACCESS, (a) => this.onUserAccess(a));
    this.clanBrowserMenu.on(Layer.Events.CLAN_ACCESS, (a) => this.onClanAccess(a));
    this.clanBrowserMenu.on(Layer.Events.CLAN_BROWSER_CANCEL, () => this.onClanBrowserCancel());
    this.loginMenu.on(Layer.Events.LOGIN_SUBMIT, (a) => this.onLoginSubmit(a));
    this.loginMenu.on(Layer.Events.LOGIN_CANCEL, () => this.onLoginCancel());
    this.loginMenu.on(Layer.Events.RECOVER_ACCESS, () => this.onRecoverShow());
    this.registerMenu.on(Layer.Events.REGISTER_SUBMIT, (a) => this.onRegisterSubmit(a));
    this.registerMenu.on(Layer.Events.REGISTER_CANCEL, () => this.onRegisterCancel());
    this.upResetMenu.on(Layer.Events.RECOVER_SUBMIT, (a) => this.onRecoverSubmit(a));
    this.upResetMenu.on(Layer.Events.RECOVER_CANCEL, () => this.onRecoverCancel());
    this.profileMenu.on(Layer.Events.PROFILE_ACCESS, () => this.onProfileAccess());
    this.profileMenu.on(Layer.Events.PROFILE_CANCEL, () => this.onProfileCancel());
    this.profileMenu.on(Layer.Events.PROFILE_RENAME, (a) => this.onProfileRename(a));
    this.profileMenu.on(Layer.Events.USER_ACCESS, (a) => this.onUserAccess(a));
    this.profileMenu.on(Layer.Events.LEAVE_CLAN, () => this.onProfileLeaveClan());
    this.profileMenu.on(Layer.Events.CREATE_CLAN, () => this.onProfileCreateClan());
    this.profileMenu.on(Layer.Events.RENAME_ACCESS, () => this.onRenameAccess());
    this.profileMenu.on(Layer.Events.LOGOUT, () => this.onAccountDeactivateLogout());
    this.customizationMenu.on(Layer.Events.CUSTOMIZATION_CANCEL, () =>
      this.onCustomizationCancel()
    );
    this.customizationMenu.on(Layer.Events.UPDATE_CREDENTIAL, (a) =>
      this.emit(Layer.Events.UPDATE_CREDENTIAL, a, !0)
    );
    this.customizationMenu.on(Layer.Events.REWARDS_CLAIMED, (a) =>
      this.onRewardedShopAdFinished(a)
    );
    this.userMenu.on(Layer.Events.USER_UNFRIEND, () => this.onUserUnfriend());
    this.userMenu.on(Layer.Events.USER_CANCEL, () => this.onUserCancel());
    this.userMenu.on(Layer.Events.CLAN_ACCESS, (a) => this.onClanAccess(a));
    this.rankingMenu.on(Layer.Events.USER_ACCESS, (a) => this.onUserAccess(a));
    this.rankingMenu.on(Layer.Events.RANKING_CANCEL, () => this.onRankingCancel());
    this.newsMenu.on(Layer.Events.NEWS_CANCEL, () => this.onNewsCancel());
    this.serverListMenu.on(Layer.Events.SERVER_LIST_CANCEL, () => this.onServerListClose());
    this.serverListMenu.on(Layer.Events.JOIN_GAME, (a, b, c) => this.onServerListJoinGame(a, b, c));
    this.serverListMenu.on(Layer.Events.SERVER_LIST_REFRESH, () => this.onServerListRefresh());
    this.serverListMenu.on(Layer.Events.SERVER_DETAIL_ACCESS, (a) => this.onServerDetailAccess(a));
    this.serverCreationMenu.on(Layer.Events.SERVER_CREATION_INIT, () =>
      this.onServerCreationInit()
    );
    this.serverCreationMenu.on(Layer.Events.SERVER_CREATION_CANCEL, () =>
      this.onServerCreationClose()
    );
    this.serverCreationMenu.on(Layer.Events.SERVER_CREATION_REGION, (a) =>
      this.onServerCreationRegion(a)
    );
    this.serverCreationMenu.on(Layer.Events.SERVER_CREATION_JOIN_LOBBY, () =>
      this.onServerCreationJoinLobby()
    );
    this.serverCreationMenu.on(Layer.Events.SERVER_CREATION_SESSION_INIT, (a) =>
      this.onServerCreationInitSession(a)
    );
    this.serverCreationMenu.on(Layer.Events.JOIN_GAME, (a, b, c) =>
      this.onServerCreationJoinGame(a, b, c)
    );
    this.loadingMenu.on(Layer.Events.LOADING_CANCEL, () => this.onLoadingCancel());
    this.partnerMenu.on(Layer.Events.PARTNER_CANCEL, () => this.onPartnerCancel());
    this.clanMenu.on(Layer.Events.CLAN_CANCEL, () => this.onClanCancel());
    this.clanMenu.on(Layer.Events.USER_ACCESS, (a) => this.onUserAccess(a));
    this.renameMenu.on(Layer.Events.RENAME_COMPLETED, () => this.onRenameCompleted());
    this.renameMenu.on(Layer.Events.RENAME_CANCEL, () => this.onRenameCancel());
    this.logoutMenu.on(Layer.Events.LOGOUT, () => this.onLogout());
    this.logoutMenu.on(Layer.Events.LOGOUT_CANCEL, () => this.onLogoutCancel());
    this.logoutMenu.on(Layer.Events.RENAME_ACCESS, () => this.onRenameAccess());
    this.serverDetailMenu.on(Layer.Events.SERVER_DETAIL_CANCEL, () => this.onServerDetailCancel());
    this.serverDetailMenu.on(Layer.Events.JOIN_GAME, (a, b, c) =>
      this.onServerListJoinGame(a, b, c)
    );
    this.highscoreMenu.on(Layer.Events.USER_ACCESS, (a) => this.onUserAccess(a));
    this.rewardsMenu.on(Layer.Events.REWARDS_CANCEL, () => this.onRewardsCancel());
    this.rewardsMenu.on(Layer.Events.REWARDS_CLAIMED, (a, b) => this.onRewardsClaimed(a, b));
  }
  async setMode(a) {
    if (this.mode !== a) {
      switch (a) {
        case Layer.MODE_GAME:
          this.setModeGame();
          break;
        case Layer.MODE_MENU:
          this.setModeMenu();
      }
      this.mode = a;
      await this.updateCredentialsIfExpired();
      this.mode === Layer.MODE_GAME && this.addChild(this.cursor);
    }
  }
  async updateCredentialsIfExpired(a = !1) {
    let b = Registry.Instance.credential;
    void 0 === b || !1 === b.available || void 0 === b.accounttype
      ? this.applyGuestSetup()
      : a || Date.now() > 1e3 * b.ts + 24e4
      ? ((a = await APIClient.getCredentials(App.Credential.id)),
        (b = a.success ? a.credential : { available: !1 }),
        "guest" === b.accounttype
          ? App.Autogen
            ? ((a = Registry.Instance.retrieve(Registry.Key.AUTOGEN)),
              void 0 !== a.name &&
                void 0 !== a.password &&
                ((b = await APIClient.postLogin(a.name, atob(a.password))),
                this.emit(Layer.Events.UPDATE_CREDENTIAL, b, !0),
                "guest" !== b.accounttype ? this.applyMemberSetup() : this.applyGuestSetup()))
            : (this.emit(Layer.Events.UPDATE_CREDENTIAL, b, !0), this.applyGuestSetup())
          : (this.emit(Layer.Events.UPDATE_CREDENTIAL, b, !0), this.applyMemberSetup()))
      : "guest" === b.accounttype
      ? this.applyGuestSetup()
      : this.applyMemberSetup();
  }
  onKeyDown(a) {
    if (27 === a.data.code) {
      this.mainMenuHides.forEach((b) => this.hideFeature(b));
      switch (this.setup) {
        case Layer.SETUP_GUEST:
          this.guestMenu.setMode(GuestMenu.MODE_NONE);
          break;
        case Layer.SETUP_MEMBER:
          this.memberMenu.setMode(MemberMenu.MODE_NONE);
      }
      this.emit(Layer.Events.SHOW_MENU);
    }
  }
  setModeGame() {
    UserInput.removeListener(UserInput.KEY_DOWN, this.onKeyDownListener);
    this.guestMenu.parent && this.removeChild(this.guestMenu);
    this.loginMenu.parent && this.removeChild(this.loginMenu);
    this.memberMenu.parent && this.removeChild(this.memberMenu);
    this.registerMenu.parent && this.removeChild(this.registerMenu);
    this.upResetMenu.parent && this.removeChild(this.upResetMenu);
    this.serverListMenu.parent && this.removeChild(this.serverListMenu);
    this.serverCreationMenu.parent && this.removeChild(this.serverCreationMenu);
    this.loadingMenu.parent && this.removeChild(this.loadingMenu);
    this.highscoreMenu.parent && this.removeChild(this.highscoreMenu);
    this.addChild(this.gameMenu);
    this.gameMenu.show();
    SocialMenu.MODE_GAME = !0;
    this.socialMenu &&
      this.socialMenu.parent &&
      (this.socialMenu.collapsed || this.socialMenu.collapseMenu(!0, !1),
      this.socialMenu.repositionForGame());
  }
  setModeMenu() {
    UserInput.addListener(UserInput.KEY_DOWN, this.onKeyDownListener);
    this.gameMenu.parent && this.removeChild(this.gameMenu);
    this.cursor.parent && this.removeChild(this.cursor);
    SocialMenu.MODE_GAME = !1;
    this.socialMenu &&
      this.socialMenu.parent &&
      (this.socialMenu.autoCollapsed && this.socialMenu.collapseMenu(!1, !1),
      this.socialMenu.collapsed || this.socialMenu.repositionForMenu());
  }
  update() {
    for (let a = 0; a < this.updateFeatures.length; a++)
      this.updateFeatures[a].parent && this.updateFeatures[a].update();
  }
  resize(a, b) {
    this.w = a;
    this.h = b;
    for (let c = 0; c < this.features.length; c++) this.features[c].resize(a, b);
  }
  async onLoginSubmit(a) {
    const b = await APIClient.postLogin(a.name, a.password);
    !1 === b.success
      ? (this.loginMenu.reset(),
        this.loginMenu.displayErrorMessage(
          void 0 !== b.error ? b.error : "Invalid username or password"
        ))
      : (this.emit(Layer.Events.UPDATE_CREDENTIAL, b, a.store),
        this.loginMenu.displayCompletedMessage(),
        this.applyMemberSetup());
  }
  applyGuestSetup() {
    this.setup = Layer.SETUP_GUEST;
    this.memberMenu.parent && this.removeChild(this.memberMenu);
    this.customizationMenu.parent &&
      (this.customizationMenu.hide(),
      this.removeChild(this.customizationMenu),
      this.emit(Layer.Events.SHOW_MENU));
    this.mode === Layer.MODE_MENU &&
      (this.addChild(this.guestMenu),
      this.highscoreMenu.parent || this.addChild(this.highscoreMenu));
    if (this.socialMenu && this.socialMenu.parent) {
      this.socialMenu.hide();
      this.removeChild(this.socialMenu);
      for (let a = 0; a < this.features.length; a++)
        if (this.features[a] === this.socialMenu) {
          this.features.splice(a, 1);
          break;
        }
    }
    if (this.clanChatMenu && this.clanChatMenu.parent) this.onClanChatCancel();
  }
  applyMemberSetup() {
    this.guestMenu.parent && this.removeChild(this.guestMenu);
    this.mode === Layer.MODE_MENU &&
      (this.addChild(this.memberMenu),
      this.highscoreMenu.parent || this.addChild(this.highscoreMenu));
    this.socialMenu &&
      this.socialMenu.parent &&
      this.setChildIndex(this.socialMenu, this.children.length - 1);
    this.setup !== Layer.SETUP_MEMBER &&
      ((this.setup = Layer.SETUP_MEMBER),
      this.socialMenu ||
        ((this.socialMenu = new SocialMenu()),
        this.socialMenu.on(Layer.Events.USER_ACCESS, (a) => this.onUserAccess(a)),
        this.socialMenu.on(Layer.Events.JOIN_CLAN, () => this.onSocialmenuJoinClan()),
        this.socialMenu.on(Layer.Events.CLAN_CHAT_ACCESS, () => this.onClanChatAccess()),
        this.socialMenu.show()),
      this.socialMenu.loadFriends(),
      this.features.push(this.socialMenu),
      App.IsMobile || this.addChild(this.socialMenu),
      this.socialMenu.resize(this.w, this.h),
      this.clanChatMenu ||
        ((this.clanChatMenu = new ClanChatMenu()),
        this.clanChatMenu.on(Layer.Events.CLAN_CHAT_CANCEL, () => this.onClanChatCancel())));
  }
  onClanChatCancel() {
    this.clanChatMenu.hide();
    this.removeChild(this.clanChatMenu);
    for (let a = 0; a < this.features.length; a++)
      if (this.features[a] === this.clanChatMenu) {
        this.features.splice(a, 1);
        break;
      }
  }
  hideFeature(a) {
    this.removeChild(a);
    a.hide();
  }
  onLoginShow() {
    this.loginMenu.hides.forEach((a) => this.hideFeature(a));
    if (this.guestMenu.mode === GuestMenu.MODE_LOGIN) this.onLoginCancel();
    else
      this.loginMenu.show(),
        this.guestMenu.setMode(GuestMenu.MODE_LOGIN),
        this.emit(Layer.Events.HIDE_MENU),
        this.loginMenu.parent || this.addChild(this.loginMenu);
  }
  onLoginCancel() {
    this.guestMenu.setMode(GuestMenu.MODE_NONE);
    this.loginMenu.parent && this.removeChild(this.loginMenu);
    this.emit(Layer.Events.SHOW_MENU);
  }
  onRegisterShow() {
    this.registerMenu.hides.forEach((a) => this.hideFeature(a));
    if (this.guestMenu.mode === GuestMenu.MODE_REGISTER) this.onRegisterCancel();
    else
      this.guestMenu.setMode(GuestMenu.MODE_REGISTER),
        this.emit(Layer.Events.HIDE_MENU),
        this.registerMenu.parent || this.addChild(this.registerMenu),
        this.registerMenu.show();
  }
  onRegisterCancel() {
    this.guestMenu.setMode(GuestMenu.MODE_NONE);
    this.registerMenu.parent && this.removeChild(this.registerMenu);
    this.emit(Layer.Events.SHOW_MENU);
  }
  onLogout() {
    this.memberMenu.setMode(MemberMenu.MODE_NONE);
    this.loginMenu.hides.forEach((b) => this.hideFeature(b));
    const a = { available: !1 };
    Registry.Instance.remove(Registry.Key.AUTOGEN);
    App.Autogen = !1;
    Registry.Instance.store(Registry.Key.CREDENTIAL, a);
    this.applyGuestSetup();
    this.registerMenu.reset();
    this.loginMenu.reset();
    this.customizationMenu.reset();
    this.emit(Layer.Events.UPDATE_CREDENTIAL, a);
    this.memberMenu.setMode(MemberMenu.MODE_NONE);
    this.guestMenu.setMode(GuestMenu.MODE_NONE);
    this.emit(Layer.Events.SHOW_MENU);
  }
  onAccountDeactivateLogout() {
    this.applyGuestSetup();
    this.registerMenu.reset();
    this.loginMenu.reset();
    this.customizationMenu.reset();
    this.profileMenu.parent && this.removeChild(this.profileMenu);
    this.emit(Layer.Events.UPDATE_CREDENTIAL, { available: !1 });
    this.emit(Layer.Events.SHOW_MENU);
  }
  async onRegisterSubmit(a) {
    const b = await APIClient.postRegistration(a.name, a.email, a.password);
    !1 === b.success
      ? (this.registerMenu.reset(), this.registerMenu.displayErrorMessage(b.error))
      : 0 === a.email.length
      ? (this.registerMenu.displayCompletedMessage(!1),
        setTimeout(async () => {
          const c = await APIClient.postLogin(a.name, a.password);
          this.emit(Layer.Events.UPDATE_CREDENTIAL, c, !0);
          this.applyMemberSetup();
          this.onRegisterCancel();
        }, 4e3))
      : this.registerMenu.displayCompletedMessage();
  }
  onRecoverShow() {
    this.upResetMenu.hides.forEach((a) => this.hideFeature(a));
    this.guestMenu.setMode(GuestMenu.MODE_NONE);
    this.upResetMenu.parent || this.addChild(this.upResetMenu);
    this.upResetMenu.show();
  }
  onRecoverCancel() {
    this.onLoginShow();
  }
  async onRecoverSubmit(a) {
    a = await APIClient.postRecovery(a.email, a.type, a.challenge);
    !1 === a.success
      ? (this.upResetMenu.reset(), this.upResetMenu.displayErrorMessage(a.error))
      : this.upResetMenu.displayCompletedMessage();
  }
  onProfileShow() {
    this.profileMenu.hides.forEach((a) => this.hideFeature(a));
    this.profileMenu.parent || this.addChild(this.profileMenu);
    this.profileMenu.show();
    this.emit(Layer.Events.HIDE_MENU);
    null === this.profileMenu.tab && this.profileMenu.openTab(ProfileMenu.TAB_OVERVIEW);
  }
  onGuestProfileAccess() {
    this.guestProfileMenu.hides.forEach((a) => this.hideFeature(a));
    if (this.guestMenu.mode === GuestMenu.MODE_GUEST_PROFILE) this.onGuestProfileHide();
    else
      this.emit(Layer.Events.HIDE_MENU),
        this.guestProfileMenu.parent || this.addChild(this.guestProfileMenu),
        this.guestMenu.setMode(GuestMenu.MODE_GUEST_PROFILE),
        this.guestProfileMenu.setTitle("Profile");
  }
  onGuestCustomizationAccess() {
    this.guestProfileMenu.hides.forEach((a) => this.hideFeature(a));
    if (this.guestMenu.mode === GuestMenu.MODE_SHOP) this.onGuestProfileHide();
    else
      this.emit(Layer.Events.HIDE_MENU),
        this.guestProfileMenu.parent || this.addChild(this.guestProfileMenu),
        this.guestMenu.setMode(GuestMenu.MODE_SHOP),
        this.guestProfileMenu.setTitle("Shop");
  }
  onGuestProfileHide() {
    this.guestProfileMenu.parent && this.removeChild(this.guestProfileMenu);
    this.emit(Layer.Events.SHOW_MENU);
    this.guestMenu.setMode(GuestMenu.MODE_NONE);
  }
  onSettingsAccess() {
    this.mainMenuHides.forEach((a) => this.hideFeature(a));
    if (
      this.guestMenu.mode === GuestMenu.MODE_SETTINGS ||
      this.memberMenu.mode === MemberMenu.MODE_SETTINGS
    )
      this.onSettingsHide();
    else {
      switch (this.setup) {
        case Layer.SETUP_GUEST:
          this.guestMenu.setMode(GuestMenu.MODE_SETTINGS);
          break;
        case Layer.SETUP_MEMBER:
          this.memberMenu.setMode(MemberMenu.MODE_SETTINGS);
      }
      this.emit(Layer.Events.SHOW_MENU);
      this.emit(Layer.Events.SETTINGS_ACCESS);
    }
  }
  onSettingsHide() {
    switch (this.setup) {
      case Layer.SETUP_GUEST:
        this.guestMenu.setMode(GuestMenu.MODE_NONE);
        break;
      case Layer.SETUP_MEMBER:
        this.memberMenu.setMode(MemberMenu.MODE_NONE);
    }
    this.emit(Layer.Events.SETTINGS_HIDE);
    this.emit(Layer.Events.SHOW_MENU);
  }
  onProfileAccess() {
    this.emit(Layer.Events.HIDE_MENU);
    this.profileMenu.hides.forEach((a) => this.hideFeature(a));
    if (this.memberMenu.mode === MemberMenu.MODE_PROFILE) this.onProfileCancel();
    else
      this.profileMenu.parent || this.addChild(this.profileMenu),
        this.memberMenu.setMode(MemberMenu.MODE_PROFILE),
        this.profileMenu.show(),
        null === this.profileMenu.tab && this.profileMenu.openTab(ProfileMenu.TAB_OVERVIEW);
  }
  onProfileCancel() {
    this.profileMenu.parent && this.removeChild(this.profileMenu);
    this.emit(Layer.Events.SHOW_MENU);
    this.memberMenu.setMode(MemberMenu.MODE_NONE);
  }
  async onProfileRename(a) {
    a = await APIClient.postLogin(a.name, a.password);
    this.emit(Layer.Events.UPDATE_CREDENTIAL, a, !0);
  }
  async onSocialmenuJoinClan() {
    let a = await APIClient.getCredentials(App.Credential.id);
    a.success &&
      ((credential = a.credential), this.emit(Layer.Events.UPDATE_CREDENTIAL, credential, !0));
    this.socialMenu.refresh();
  }
  onClanChatAccess() {
    this.clanChatMenu.parent ||
      (this.addChild(this.clanChatMenu),
      this.clanChatMenu.show(),
      this.clanChatMenu.resize(this.w, this.h),
      (this.clanChatMenu.x =
        this.socialMenu.x + (this.socialMenu.x < 0.5 * App.ReferenceWidth ? 0 : -20)),
      (this.clanChatMenu.y = this.socialMenu.y + 36));
  }
  async onProfileLeaveClan() {
    let a = await APIClient.getCredentials(App.Credential.id);
    a.success &&
      ((credential = a.credential), this.emit(Layer.Events.UPDATE_CREDENTIAL, credential, !0));
    this.socialMenu.refresh();
  }
  async onProfileCreateClan() {
    let a = await APIClient.getCredentials(App.Credential.id);
    a.success &&
      ((credential = a.credential), this.emit(Layer.Events.UPDATE_CREDENTIAL, credential, !0));
    this.socialMenu.refresh();
  }
  onServerCreationShow() {
    this.serverCreationMenu.hides.forEach((a) => this.hideFeature(a));
    this.serverCreationMenu.parent || this.addChild(this.serverCreationMenu);
    this.serverCreationMenu.show();
  }
  onServerCreationInit() {}
  onServerCreationClose() {
    this.serverCreationMenu.parent && this.removeChild(this.serverCreationMenu);
    this.emit(Layer.Events.SHOW_MENU);
  }
  onServerCreationRegion(a) {
    this.emit(Layer.Events.JOIN_SERVER, a);
  }
  onServerCreationJoinLobby() {
    this.onServerListingShow();
  }
  onServerCreationInitSession(a) {
    this.emit(Layer.Events.CREATE_SERVER, a);
  }
  onServerListingShow() {
    this.serverListMenu.hides.forEach((a) => this.hideFeature(a));
    this.serverListMenu.parent || this.addChild(this.serverListMenu);
    this.serverListMenu.show();
  }
  onServerListClose() {
    this.serverListMenu.parent && this.removeChild(this.serverListMenu);
    this.serverListMenu.hide();
    this.emit(Layer.Events.SHOW_MENU);
  }
  onServerListRefresh() {
    this.serverListMenu.refresh();
  }
  async onServerListJoinGame(a, b, c) {
    await this.updateCredentialsIfExpired();
    this.loadingMenu.parent || (this.addChild(this.loadingMenu), this.loadingMenu.show());
    this.emit(Layer.Events.JOIN_GAME, a, b, c);
  }
  onJoinGameMode() {
    this.loadingMenu.parent || (this.addChild(this.loadingMenu), this.loadingMenu.show());
    this.socialMenu &&
      300 > this.socialMenu.y &&
      (this.socialMenu.y =
        App.ReferenceHeight - (100 > this.socialMenu.height ? 200 : this.socialMenu.height));
  }
  onServerCreationJoinGame(a, b, c) {
    this.loadingMenu.parent || (this.addChild(this.loadingMenu), this.loadingMenu.show());
    this.emit(Layer.Events.JOIN_GAME, a, b, c);
  }
  onCustomizationShow() {
    if (
      this.guestMenu.mode === GuestMenu.MODE_SHOP ||
      this.memberMenu.mode === MemberMenu.MODE_SHOP
    )
      this.onCustomizationCancel();
    else
      this.mainMenuHides.forEach((a) => this.hideFeature(a)),
        this.customizationMenu.show(),
        this.addChild(this.customizationMenu),
        this.emit(Layer.Events.HIDE_MENU),
        this.memberMenu.setMode(MemberMenu.MODE_SHOP);
  }
  onCustomizationCancel() {
    this.customizationMenu.hide();
    this.customizationMenu.parent && this.removeChild(this.customizationMenu);
    this.emit(Layer.Events.SHOW_MENU);
    this.memberMenu.setMode(MemberMenu.MODE_NONE);
  }
  onUserAccess(a, b = "id") {
    this.userMenu.hides.forEach((c) => this.hideFeature(c));
    this.userMenu.load(a, b);
    this.addChild(this.userMenu);
    this.emit(Layer.Events.HIDE_MENU);
  }
  onUserCancel() {
    this.userMenu.parent && this.removeChild(this.userMenu);
    this.emit(Layer.Events.SHOW_MENU);
  }
  onUserUnfriend() {
    this.socialMenu.refresh();
  }
  onRankingShow() {
    this.rankingMenu.hides.forEach((a) => this.hideFeature(a));
    if (
      this.guestMenu.mode === GuestMenu.MODE_RANKING ||
      this.memberMenu.mode === MemberMenu.MODE_RANKING
    )
      this.onRankingCancel();
    else {
      switch (this.setup) {
        case Layer.SETUP_GUEST:
          this.guestMenu.setMode(GuestMenu.MODE_RANKING);
          break;
        case Layer.SETUP_MEMBER:
          this.memberMenu.setMode(MemberMenu.MODE_RANKING);
      }
      this.addChild(this.rankingMenu);
      this.emit(Layer.Events.HIDE_MENU);
      this.rankingMenu.show();
    }
  }
  onMemberShow() {
    this.memberBrowserMenu.hides.forEach((a) => this.hideFeature(a));
    if (
      this.guestMenu.mode === GuestMenu.MODE_MEMBER ||
      this.memberMenu.mode === MemberMenu.MODE_MEMBER
    )
      this.onMemberCancel();
    else {
      this.memberBrowserMenu.show();
      this.addChild(this.memberBrowserMenu);
      switch (this.setup) {
        case Layer.SETUP_GUEST:
          this.guestMenu.setMode(GuestMenu.MODE_MEMBER);
          break;
        case Layer.SETUP_MEMBER:
          this.memberMenu.setMode(MemberMenu.MODE_MEMBER);
      }
      this.emit(Layer.Events.HIDE_MENU);
    }
  }
  onMemberCancel() {
    this.memberBrowserMenu.parent && this.removeChild(this.memberBrowserMenu);
    this.memberBrowserMenu.hide();
    this.emit(Layer.Events.SHOW_MENU);
    this.memberMenu.setMode(MemberMenu.MODE_NONE);
    this.guestMenu.setMode(GuestMenu.MODE_NONE);
  }
  onClanBrowserShow() {
    this.clanBrowserMenu.hides.forEach((a) => this.hideFeature(a));
    if (
      this.guestMenu.mode === GuestMenu.MODE_CLAN ||
      this.memberMenu.mode === MemberMenu.MODE_CLAN
    )
      this.onClanBrowserCancel();
    else {
      this.emit(Layer.Events.HIDE_MENU);
      switch (this.setup) {
        case Layer.SETUP_GUEST:
          this.guestMenu.setMode(GuestMenu.MODE_CLAN);
          break;
        case Layer.SETUP_MEMBER:
          this.memberMenu.setMode(MemberMenu.MODE_CLAN);
      }
      this.addChild(this.clanBrowserMenu);
      this.clanBrowserMenu.show();
    }
  }
  onClanBrowserCancel() {
    this.memberMenu.setMode(MemberMenu.MODE_NONE);
    this.guestMenu.setMode(GuestMenu.MODE_NONE);
    this.clanBrowserMenu.parent && this.removeChild(this.clanBrowserMenu);
    this.clanBrowserMenu.hide();
    this.emit(Layer.Events.SHOW_MENU);
  }
  onRankingCancel() {
    this.rankingMenu.parent && this.removeChild(this.rankingMenu);
    this.rankingMenu.hide();
    this.emit(Layer.Events.SHOW_MENU);
    this.memberMenu.setMode(MemberMenu.MODE_NONE);
    this.guestMenu.setMode(GuestMenu.MODE_NONE);
  }
  onLoadingCancel() {
    this.loadingMenu.parent && this.removeChild(this.loadingMenu);
    this.loadingMenu.hide();
  }
  onNewsAccess() {
    this.newsMenu.hides.forEach((a) => this.hideFeature(a));
    if (
      this.guestMenu.mode === GuestMenu.MODE_NEWS ||
      this.memberMenu.mode === MemberMenu.MODE_NEWS
    )
      this.onNewsCancel();
    else {
      switch (this.setup) {
        case Layer.SETUP_GUEST:
          this.guestMenu.setMode(GuestMenu.MODE_NEWS);
          break;
        case Layer.SETUP_MEMBER:
          this.memberMenu.setMode(MemberMenu.MODE_NEWS);
      }
      this.newsMenu.show();
      this.addChild(this.newsMenu);
      this.emit(Layer.Events.HIDE_MENU);
    }
  }
  onNewsCancel() {
    this.newsMenu.parent && this.removeChild(this.newsMenu);
    this.emit(Layer.Events.SHOW_MENU);
    this.memberMenu.setMode(MemberMenu.MODE_NONE);
    this.guestMenu.setMode(GuestMenu.MODE_NONE);
  }
  onPartnerShow() {
    this.partnerMenu.hides.forEach((a) => this.hideFeature(a));
    if (this.guestMenu.mode === GuestMenu.MODE_PARTNER) this.onPartnerCancel();
    else
      this.guestMenu.setMode(GuestMenu.MODE_PARTNER),
        this.partnerMenu.show(),
        this.addChild(this.partnerMenu),
        this.emit(Layer.Events.HIDE_MENU);
  }
  onPartnerCancel() {
    this.partnerMenu.parent && this.removeChild(this.partnerMenu);
    this.emit(Layer.Events.SHOW_MENU);
    this.memberMenu.setMode(MemberMenu.MODE_NONE);
    this.guestMenu.setMode(GuestMenu.MODE_NONE);
  }
  onMenuAccess() {
    this.mainMenuHides.forEach((a) => this.hideFeature(a));
    switch (this.setup) {
      case Layer.SETUP_GUEST:
        this.guestMenu.setMode(GuestMenu.MODE_NONE);
        break;
      case Layer.SETUP_MEMBER:
        this.memberMenu.setMode(MemberMenu.MODE_NONE);
    }
    this.emit(Layer.Events.SHOW_MENU);
  }
  onClanAccess(a) {
    if (
      this.guestMenu.mode === GuestMenu.MODE_RANKING ||
      this.memberMenu.mode === MemberMenu.MODE_RANKING
    )
      this.onRankingCancel();
    else if (
      this.guestMenu.mode === GuestMenu.MODE_MEMBER ||
      this.memberMenu.mode === MemberMenu.MODE_MEMBER
    )
      this.onMemberCancel();
    this.clanMenu.hides.forEach((b) => this.hideFeature(b));
    this.clanMenu.show(a);
    this.addChild(this.clanMenu);
    this.emit(Layer.Events.HIDE_MENU);
  }
  onClanCancel() {
    this.clanMenu.parent && this.removeChild(this.clanMenu);
    this.clanMenu.hide();
    this.emit(Layer.Events.SHOW_MENU);
  }
  onServerCreateResult(a) {
    this.serverCreationMenu.setCreatedStatus(a);
  }
  onServerReject(a) {
    switch (a.mode) {
      case 1:
        this.serverListMenu.setPasswordInvalid();
    }
    this.loadingMenu.parent && this.loadingMenu.setTitle(a.info);
  }
  onServerFull() {
    this.loadingMenu.parent && this.loadingMenu.setTitle("This region is full.");
  }
  onConnectionError() {
    this.loadingMenu.parent && this.loadingMenu.setTitle("Connection failed.");
  }
  async onServerAuthFailed() {
    this.loadingMenu.parent && this.loadingMenu.setTitle("Access denied.");
    await this.updateCredentialsIfExpired(!0);
  }
  onRenameAccess() {
    this.renameMenu.hides.forEach((a) => this.hideFeature(a));
    this.addChild(this.renameMenu);
    this.renameMenu.show();
  }
  async onRenameCompleted() {
    let a = await APIClient.getCredentials(App.Credential.id);
    a.success && this.emit(Layer.Events.UPDATE_CREDENTIAL, a.credential, !0);
  }
  onRenameCancel() {
    this.renameMenu.parent && this.removeChild(this.renameMenu);
    this.emit(Layer.Events.SHOW_MENU);
  }
  onLogoutAccess() {
    this.logoutMenu.hides.forEach((a) => this.hideFeature(a));
    this.addChild(this.logoutMenu);
    this.logoutMenu.show();
  }
  onLogoutCancel() {
    this.logoutMenu.parent && this.removeChild(this.logoutMenu);
    this.emit(Layer.Events.SHOW_MENU);
  }
  onServerDetailAccess(a) {
    this.serverDetailMenu.hides.forEach((b) => this.hideFeature(b));
    this.serverDetailMenu.show(a);
    this.addChild(this.serverDetailMenu);
  }
  onServerDetailCancel() {
    this.serverDetailMenu.parent && this.removeChild(this.serverDetailMenu);
  }
  onRewardsAccess() {
    this.rewardsMenu.hides.forEach((a) => this.hideFeature(a));
    this.rewardsMenu.parent || this.addChild(this.rewardsMenu);
    this.rewardsMenu.show();
  }
  onRewardsCancel() {
    this.rewardsMenu.parent && this.removeChild(this.rewardsMenu);
    this.rewardsMenu.hide();
  }
  onRewardsClaimed(a, b) {
    a && this.emit(Layer.Events.REWARDS_CLAIMED, b);
  }
  onRewardedAdFinished(a) {
    a ? this.rewardsMenu.claimRewards() : this.rewardsMenu.displayWarning();
  }
  onRewardedShopAdFinished(a, b = !1) {
    a
      ? b
        ? this.customizationMenu.claimRewards()
        : this.customizationMenu.displayRewardDialog()
      : this.customizationMenu.displayWarning();
  }
}
Layer.MODE_MENU = "menu";
Layer.MODE_GAME = "game";
Layer.SETUP_GUEST = "guest_setup";
Layer.SETUP_MEMBER = "member_setup";
Layer.Events = {
  DISCONNECT: "disconnect",
  LOGIN_ACCESS: "login_access",
  LOGIN_SUBMIT: "login_submit",
  LOGIN_CANCEL: "login_cancel",
  LOGOUT: "logout",
  RECOVER_ACCESS: "recover_access",
  RECOVER_SUBMIT: "recover_submit",
  RECOVER_CANCEL: "recover_cancel",
  REGISTER_ACCESS: "register_access",
  REGISTER_SUBMIT: "register_submit",
  REGISTER_CANCEL: "register_cancel",
  PROFILE_ACCESS: "profile_access",
  PROFILE_CANCEL: "profile_cancel",
  PROFILE_RENAME: "profile_rename",
  HIDE_MENU: "hide_menu",
  SHOW_MENU: "show_menu",
  UPDATE_CREDENTIAL: "update_credential",
  CUSTOMIZATION_ACCESS: "customization_access",
  CUSTOMIZATION_CANCEL: "customization_cancel",
  USER_ACCESS: "user_access",
  USER_CANCEL: "user_cancel",
  USER_UNFRIEND: "user_unfriend",
  RANKING_ACCESS: "ranking_access",
  RANKING_CANCEL: "ranking_cancel",
  MEMBER_ACCESS: "member_access",
  MEMBER_CANCEL: "member_cancel",
  NEWS_ACCESS: "news_access",
  NEWS_CANCEL: "news_cancel",
  PARTNER_ACCESS: "partner_access",
  PARTNER_CANCEL: "partner_cancel",
  LEAVE_CLAN: "leave_clan",
  CREATE_CLAN: "create_clan",
  JOIN_CLAN: "join_clan",
  JOIN_GAME: "join_game",
  JOIN_GAME_FAIL: "join_game_fail",
  JOIN_SERVER: "join_server",
  CREATE_SERVER: "create_server",
  SERVER_LIST_REFRESH: "server_list_refresh",
  SERVER_LIST_CANCEL: "server_list_cancel",
  SERVER_CREATION_CANCEL: "server_creation_cancel",
  SERVER_CREATION_INIT: "server_creation_init",
  SERVER_CREATION_REGION: "server_creation_region",
  SERVER_CREATION_JOIN_LOBBY: "server_creation_join_lobby",
  SERVER_CREATION_SESSION_INIT: "server_creation_session_init",
  SERVER_CREATED: "server_created",
  CLAN_CHAT_ACCESS: "clan_chat_access",
  CLAN_CHAT_CANCEL: "clan_chat_cancel",
  LOADING_CANCEL: "loading_cancel",
  CLAN_BROWSER_ACCESS: "clan_browser_access",
  CLAN_BROWSER_CANCEL: "clan_browser_cancel",
  CLAN_ACCESS: "clan_access",
  CLAN_CANCEL: "clan_cancel",
  RENAME_ACCESS: "rename_access",
  RENAME_SUBMIT: "rename_submit",
  RENAME_CANCEL: "rename_cancel",
  RENAME_COMPLETED: "rename_completed",
  LOGOUT_CANCEL: "logout_cancel",
  LOGOUT_ACCESS: "logout_access",
  JOYSTICK_MOVE_STATE: "joystick_move_state",
  JOYSTICK_TARGET_STATE: "joystick_target_state",
  DISPLAY_HELP: "display_help",
  MUTE_TOGGLE: "mute_toggle",
  SERVER_DETAIL_ACCESS: "server_detail_access",
  SERVER_DETAIL_CANCEL: "server_detail_cancel",
  MENU_ACCESS: "menu_access",
  GUEST_PROFILE_ACCESS: "guest_profile_access",
  GUEST_PROFILE_HIDE: "guest_profile_hide",
  SETTINGS_ACCESS: "settings_access",
  SETTINGS_HIDE: "settings_hide",
  ESCAPE_MENU_ACCESS: "escape_menu_access",
  REWARDS_ACCESS: "rewards_access",
  REWARDS_CLAIMED: "rewards_claimed",
  REWARDS_CANCEL: "rewards_cancel",
};
var assetloader = {};
class AssetLoader {
  constructor(a, b) {
    this.target = a;
    this.dir = b;
    this.onProgress = this.onComplete = null;
  }
  async load(a) {
    for (let c in a) {
      let d = a[c];
      for (let e = 0; e < d.length; e++) {
        var b = this.dir + "/" + c;
        PIXI.Assets.add(b, b + "/" + d[e].file);
        b = await PIXI.Assets.load(b);
        this.target[c] = b;
      }
    }
    this.onProgress({ progress: 1 });
    this.onComplete();
  }
}
var protocol = {};
Protocol = {
  CONNECT: "connection",
  CONNECTED: "onconnected",
  DISCONNECT: "disconnect",
  DISCONNECTED: "ondisconnected",
  ECHO: "a",
  ECHO_RESP: "b",
  INFO: "c",
  SESSION: "d",
  Session: {
    REGISTER: "e",
    CREATE: "f",
    CREATE_RESP: "g",
    JOIN_MODE: "h",
    JOIN_RESP: "i",
    JOIN_GAME: "j",
    LEAVE: "k",
    LEAVE_RESP: "l",
    LIST_GAMES: "m",
    LIST_GAMES_RESP: "n",
    CLIENT_AUTH: "o1",
  },
  GAME: "p",
  GAME_BIN: "q",
  Game: {
    UPDATE: "r",
    REQ: "t",
    INPUT: "v",
    INFO: "w",
    MESSAGE: "x",
    COMMAND: "y",
    ACTION: "z",
    STATUS: "aa",
    TRIGGER_RESPAWN: "ab",
  },
  SIGNAL_FULL: "ad",
};
var thumbnail = {};
class Thumbnail extends PIXI.Sprite {
  constructor(a, b, c = !0, d = !1) {
    super();
    this.interactive = c;
    this.displayAura = d;
    this.w = a;
    this.h = b;
    this.s = 0.004 * this.w;
    this.numParticles = 64;
    this.customization = {};
    this.offsetY = this.offsetX = this.time = 0;
    this.head = new PIXI.Sprite();
    this.head.x = -2;
    this.head.y = 0.179 * -this.h;
    this.head.scale.x = this.head.scale.y = this.s;
    this.head.anchor.x = 0.5;
    this.head.anchor.y = 0.75;
    this.head.rotation = -0.15;
    this.face = new PIXI.Sprite();
    this.face.rotation = -0;
    this.torsoUpper = new PIXI.Sprite();
    this.torsoUpper.scale.x = this.torsoUpper.scale.y = 1.2 * this.s;
    this.torsoUpper.x = 0;
    this.torsoUpper.y = 0.105 * -this.h;
    this.torsoUpper.anchor.x = 0.5;
    this.torsoUpper.anchor.y = 0.4;
    this.torsoUpper.rotation = -0.1;
    this.torsoLower = new PIXI.Sprite();
    this.torsoLower.x = 2;
    this.torsoLower.y = 0.03 * -this.h;
    this.torsoLower.scale.x = this.torsoLower.scale.y = 1 * this.s;
    this.torsoLower.anchor.x = 0.5;
    this.torsoLower.anchor.y = 0.4;
    this.torsoLower.rotation = -0.1;
    this.armLeftUpper = new PIXI.Sprite();
    this.armLeftUpper.x = -12;
    this.armLeftUpper.y = 0.14 * -this.h;
    this.armLeftUpper.scale.x = this.armLeftUpper.scale.y = 1 * this.s;
    this.armLeftUpper.anchor.x = 0.6;
    this.armLeftUpper.anchor.y = 0.23;
    this.armLeftUpper.rotation = -0.05;
    this.armLeftLower = new PIXI.Sprite();
    this.armLeftLower.x = -17;
    this.armLeftLower.y = 0.02 * this.h;
    this.armLeftLower.scale.x = this.armLeftLower.scale.y = 0.95 * this.s;
    this.armLeftLower.anchor.x = 0.6;
    this.armLeftLower.anchor.y = 0.23;
    this.armLeftLower.rotation = 0.55 * Math.PI;
    this.armRightUpper = new PIXI.Sprite();
    this.armRightUpper.x = 15;
    this.armRightUpper.y = 0.17 * -this.h;
    this.armRightUpper.scale.x = this.armRightUpper.scale.y = 1 * this.s;
    this.armRightUpper.anchor.x = 0.55;
    this.armRightUpper.anchor.y = 0.23;
    this.armRightUpper.rotation = -0.3;
    this.armRightLower = new PIXI.Sprite();
    this.armRightLower.x = 22;
    this.armRightLower.y = 0.02 * -this.h;
    this.armRightLower.scale.x = 0.95 * -this.s;
    this.armRightLower.scale.y = 0.95 * this.s;
    this.armRightLower.anchor.x = 0.66;
    this.armRightLower.anchor.y = 0.23;
    this.armRightLower.rotation = 0.26 * Math.PI;
    this.legLeftUpper = new PIXI.Sprite();
    this.legLeftUpper.x = -1;
    this.legLeftUpper.y = 0.085 * this.h;
    this.legLeftUpper.scale.x = this.legLeftUpper.scale.y = 1 * this.s;
    this.legLeftUpper.anchor.x = 0.55;
    this.legLeftUpper.anchor.y = 0.31;
    this.legLeftUpper.rotation = 0.23 * Math.PI;
    this.legLeftLower = new PIXI.Sprite();
    this.legLeftLower.x = 10;
    this.legLeftLower.y = 0.25 * this.h;
    this.legLeftLower.scale.x = this.legLeftLower.scale.y = 1 * this.s;
    this.legLeftLower.anchor.x = 0.58;
    this.legLeftLower.anchor.y = 0.36;
    this.legLeftLower.rotation = 0.3 * -Math.PI;
    this.legRightUpper = new PIXI.Sprite();
    this.legRightUpper.x = 9;
    this.legRightUpper.y = 0.07 * this.h;
    this.legRightUpper.scale.x = this.legRightUpper.scale.y = 1 * this.s;
    this.legRightUpper.anchor.x = 0.55;
    this.legRightUpper.anchor.y = 0.3;
    this.legRightUpper.rotation = 0.01 * Math.PI;
    this.legRightLower = new PIXI.Sprite();
    this.legRightLower.x = -19;
    this.legRightLower.y = 0.21 * this.h;
    this.legRightLower.scale.x = this.legRightLower.scale.y = 1 * this.s;
    this.legRightLower.anchor.x = 0.58;
    this.legRightLower.anchor.y = 0.36;
    this.legRightLower.rotation = 0.22 * -Math.PI;
    this.bandana = new PIXI.Sprite(App.CombinedTextures.bandana_team_alpha);
    this.bandana.x = this.head.x + 13;
    this.bandana.y = this.head.y - 16;
    this.bandana.rotation = 0.32 * Math.PI;
    this.bandana.scale.x = 0.9 * this.s;
    this.bandana.scale.y = 0.5 * this.s;
    this.bandana.anchor.x = 0;
    this.bandana.anchor.y = 0.5;
    this.bandana.tint = 12255232;
    this.ninja = new PIXI.Container();
    this.ninja.x = 0.5 * this.w;
    this.ninja.y = 0.5 * this.h;
    this.aura = new PIXI.Sprite();
    this.aura.x = 0;
    this.aura.y = 0;
    this.aura.scale.x = this.aura.scale.y = 1.4;
    this.aura.anchor.x = this.aura.anchor.y = 0.5;
    this.aura.visible = this.displayAura;
    this.aura.rotation = Math.PI;
    this.on("mouseover", () => {
      this.aura.visible = !0;
    });
    this.on("mouseout", () => {
      this.aura.visible = !1;
    });
    this.ninja.addChild(this.aura);
    this.ninja.addChild(this.bandana);
    this.ninja.addChild(this.legRightLower);
    this.ninja.addChild(this.legLeftUpper);
    this.ninja.addChild(this.legLeftLower);
    this.ninja.addChild(this.legRightUpper);
    this.ninja.addChild(this.armLeftUpper);
    this.ninja.addChild(this.armLeftLower);
    this.ninja.addChild(this.torsoLower);
    this.ninja.addChild(this.torsoUpper);
    this.ninja.addChild(this.armRightLower);
    this.ninja.addChild(this.armRightUpper);
    this.ninja.addChild(this.head);
    this.head.addChild(this.face);
    this.bodyparts = [
      this.head,
      this.armLeftUpper,
      this.armLeftLower,
      this.torsoLower,
      this.torsoUpper,
      this.armRightUpper,
      this.armRightLower,
      this.legLeftUpper,
      this.legLeftLower,
      this.legRightUpper,
      this.legRightLower,
      this.bandana,
    ];
    this.addChild(this.ninja);
  }
  generateCharacter() {
    const a = App.CombinedTextures;
    var b = this.customization;
    this.aura.tint = void 0 === b.orb ? 16777215 : b.orb.data.energy;
    this.face.rotation = 0;
    this.face.vr = 0;
    let c = "head_alpha";
    if (b.hair) {
      var d = !1;
      b.face && b.face.cdata && !1 === b.face.cdata.hair && (d = !0);
      d ? (c += "_slick") : 0 < b.hair.texture.length && (c += "_" + b.hair.texture);
    }
    var e = "torsoupper";
    b.torso && 0 < b.torso.texture.length && (e += "_" + b.torso.texture);
    d = "energy_shell";
    this.aura.alpha = 1;
    b.orb &&
      (b.orb.cdata && b.orb.cdata.custom
        ? ((this.aura.visible = !1), (this.aura.alpha = 0))
        : 0 < b.orb.texture.length && (d += "_" + b.orb.texture));
    var f = "torsolower";
    this.torsoLower.x = 2;
    this.torsoLower.y = 0.03 * -this.h;
    this.torsoLower.anchor.x = 0.5;
    this.torsoLower.anchor.y = 0.4;
    if (b.belt && 0 < b.belt.texture.length) {
      f += "_" + b.belt.texture;
      var g = b.belt.cdata;
      void 0 !== g &&
        (void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.torsoLower.anchor.x = g.ax), (this.torsoLower.anchor.y = g.ay)),
        void 0 !== g.ox &&
          void 0 !== g.ox &&
          ((this.torsoLower.x = g.ox), (this.torsoLower.y = g.oy)),
        void 0 !== g.s && (this.torsoLower.scale.x = this.torsoLower.scale.y = this.s * g.s));
    }
    var h = "armleftlower";
    this.armLeftLower.x = -17;
    this.armLeftLower.y = 0.02 * this.h;
    this.armLeftLower.anchor.x = 0.6;
    this.armLeftLower.anchor.y = 0.23;
    b.armleftlower &&
      0 < b.armleftlower.texture.length &&
      ((h += "_" + b.armleftlower.texture),
      (g = b.armleftlower.cdata),
      void 0 !== g &&
        (void 0 !== g.ox &&
          void 0 !== g.oy &&
          ((this.armLeftLower.x = g.ox), (this.armLeftLower.y = g.oy)),
        void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.armLeftLower.anchor.x = g.ax), (this.armLeftLower.anchor.y = g.ay))));
    var m = "armleftupper";
    this.armLeftUpper.x = -13;
    this.armLeftUpper.y = 0.14 * -this.h;
    this.armLeftUpper.anchor.x = 0.55;
    this.armLeftUpper.anchor.y = 0.23;
    b.armleftupper &&
      0 < b.armleftupper.texture.length &&
      ((m += "_" + b.armleftupper.texture),
      (g = b.armleftupper.cdata),
      void 0 !== g &&
        (void 0 !== g.ox &&
          void 0 !== g.oy &&
          ((this.armLeftUpper.x = g.ox), (this.armLeftUpper.y = g.oy)),
        void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.armLeftUpper.anchor.x = g.ax), (this.armLeftUpper.anchor.y = g.ay))));
    var n = "armrightupper";
    this.armRightUpper.x = 15;
    this.armRightUpper.y = 0.17 * -this.h;
    this.armRightUpper.anchor.x = 0.55;
    this.armRightUpper.anchor.y = 0.23;
    b.armrightupper &&
      0 < b.armrightupper.texture.length &&
      ((n += "_" + b.armrightupper.texture),
      (g = b.armrightupper.cdata),
      void 0 !== g &&
        (void 0 !== g.ox &&
          void 0 !== g.oy &&
          ((this.armRightUpper.x = g.ox), (this.armRightUpper.y = g.oy)),
        void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.armRightUpper.anchor.x = g.ax), (this.armRightUpper.anchor.y = g.ay))));
    var l = "armrightlower";
    this.armRightLower.x = 22;
    this.armRightLower.y = 0.02 * -this.h;
    this.armRightLower.anchor.x = 0.66;
    this.armRightLower.anchor.y = 0.23;
    b.armrightlower &&
      0 < b.armrightlower.texture.length &&
      ((l += "_" + b.armrightlower.texture),
      (g = b.armrightlower.cdata),
      void 0 !== g &&
        (void 0 !== g.ox &&
          void 0 !== g.oy &&
          ((this.armRightLower.x = g.ox), (this.armRightLower.y = g.oy)),
        void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.armRightLower.anchor.x = g.ax), (this.armRightLower.anchor.y = g.ay))));
    var k = "legleftlower";
    this.legLeftLower.x = 10;
    this.legLeftLower.y = 0.25 * this.h;
    this.legLeftLower.anchor.x = 0.58;
    this.legLeftLower.anchor.y = 0.36;
    b.legleftlower &&
      (0 < b.legleftlower.texture.length && (k += "_" + b.legleftlower.texture),
      (g = b.legleftlower.cdata),
      void 0 !== g &&
        (void 0 !== g.ox &&
          void 0 !== g.oy &&
          ((this.legLeftLower.x = g.ox), (this.legLeftLower.y = g.oy)),
        void 0 !== g.ax &&
          void 0 !== g.ay &&
          ((this.legLeftLower.anchor.x = g.ax), (this.legLeftLower.anchor.y = g.ay))));
    g = "legrightlower";
    this.legRightLower.x = -19;
    this.legRightLower.y = 0.21 * this.h;
    this.legRightLower.anchor.x = 0.58;
    this.legRightLower.anchor.y = 0.36;
    if (b.legrightlower) {
      0 < b.legrightlower.texture.length && (g += "_" + b.legrightlower.texture);
      var p = b.legrightlower.cdata;
      void 0 !== p &&
        (void 0 !== p.ox &&
          void 0 !== p.oy &&
          ((this.legRightLower.x = p.ox), (this.legRightLower.y = p.oy)),
        void 0 !== p.ax &&
          void 0 !== p.ay &&
          ((this.legRightLower.anchor.x = p.ax), (this.legRightLower.anchor.y = p.ay)));
    }
    let r = "legleftupper";
    this.legLeftUpper.x = -1;
    this.legLeftUpper.y = 0.085 * this.h;
    this.legLeftUpper.anchor.x = 0.55;
    this.legLeftUpper.anchor.y = 0.31;
    b.legleftupper &&
      (0 < b.legleftupper.texture.length && (r += "_" + b.legleftupper.texture),
      (p = b.legleftupper.cdata),
      void 0 !== p &&
        (void 0 !== p.ox &&
          void 0 !== p.oy &&
          ((this.legLeftUpper.x = p.ox), (this.legLeftUpper.y = p.oy)),
        void 0 !== p.ax &&
          void 0 !== p.ay &&
          ((this.legLeftUpper.anchor.x = p.ax), (this.legLeftUpper.anchor.y = p.ay))));
    p = "legrightupper";
    this.legRightUpper.x = 9;
    this.legRightUpper.y = 0.07 * this.h;
    this.legRightUpper.anchor.x = 0.55;
    this.legRightUpper.anchor.y = 0.3;
    if (b.legrightupper) {
      0 < b.legrightupper.texture.length && (p += "_" + b.legrightupper.texture);
      let q = b.legrightupper.cdata;
      void 0 !== q &&
        (void 0 !== q.ox &&
          void 0 !== q.oy &&
          ((this.legRightUpper.x = q.ox), (this.legRightUpper.y = q.oy)),
        void 0 !== q.ax &&
          void 0 !== q.ay &&
          ((this.legRightUpper.anchor.x = q.ax), (this.legRightUpper.anchor.y = q.ay)));
    }
    b.face
      ? (this.face.removeChildren(),
        (this.face.tint = 16777215),
        b.face.cdata && b.face.cdata.custom && this.initializeCustomFaceFx(b.face.cdata.custom),
        0 < b.face.texture.length
          ? ((this.face.texture = a["face_" + b.face.texture]),
            (this.face.visible = !0),
            (b = b.face.cdata),
            void 0 !== b &&
              (void 0 !== b.ax && void 0 !== b.ay
                ? ((this.face.anchor.x = b.ax), (this.face.anchor.y = b.ay))
                : ((this.face.anchor.x = 0), (this.face.anchor.y = 0)),
              void 0 !== b.ox && void 0 !== b.ox
                ? ((this.face.x = b.ox), (this.face.y = b.oy))
                : ((this.face.x = 0), (this.face.y = 0)),
              b.vr && (this.face.vr = 0),
              void 0 !== b.s && (this.face.scale.x = this.face.scale.y = this.s * b.s * 0.95)))
          : (this.face.visible = !1))
      : (this.face.visible = !1);
    b = a[e];
    f = a[f];
    e = a[m];
    h = a[h];
    n = a[n];
    l = a[l];
    m = a[r];
    k = a[k];
    p = a[p];
    g = a[g];
    d = a[d];
    this.head.texture = a[c];
    this.torsoUpper.texture = b;
    this.torsoLower.texture = f;
    this.armLeftUpper.texture = e;
    this.armLeftLower.texture = h;
    this.armRightUpper.texture = n;
    this.armRightLower.texture = l;
    this.legLeftUpper.texture = m;
    this.legLeftLower.texture = k;
    this.legRightUpper.texture = p;
    this.legRightLower.texture = g;
    this.aura.texture = d;
  }
  initializeCustomFaceFx(a) {
    let b = new PIXI.Sprite(App.CombinedTextures[ParticleEffects.FireEyes.tex]);
    b.scale.x = b.scale.y = 0.5;
    b.x = -30;
    b.y = -33;
    switch (a) {
      case FaceRedFireEyes.ID:
        this.face.tint = 16711680;
        this.face.addChild(b);
        break;
      case FaceFireEyes.ID:
        this.face.tint = 16777215;
        this.face.addChild(b);
        break;
      case FacePinkFireEyes.ID:
        this.face.tint = 16738740;
        this.face.addChild(b);
        break;
      case FaceGreenFireEyes.ID:
        this.face.tint = 65280;
        this.face.addChild(b);
        break;
      case FaceBlueFireEyes.ID:
        this.face.tint = 255;
        this.face.addChild(b);
        break;
      case FaceYellowFireEyes.ID:
        this.face.tintt = 16776960;
        this.face.addChild(b);
        break;
      case FaceOrangeFireEyes.ID:
        (this.face.tint = 16753920), this.face.addChild(b);
    }
  }
  applyCustomization(a) {
    this.customization = {};
    a && (this.customization = a);
    this.generateCharacter();
  }
}
class App extends PIXI.Container {
  constructor() {
    super();
    this.credential = {};
    this.servers = [];
    this.status = {};
    this.stage = this.pixi = null;
    this.settings = {};
    this.gameplayStopped = !0;
    this.threadUpdate = this.hasResized = this.resizeOnLoad = this.matchStarted = !1;
    this.client = new Client();
    this.client.addListener(Protocol.INFO, (a) => this.onInfo(a.data));
    this.client.addListener(Protocol.DISCONNECT, (a) => this.onDisconnect());
    this.client.addListener(Protocol.SESSION, (a) => this.onSessionData(a.data));
    this.client.addListener(Client.CONNECT, (a) => this.onConnect(a));
    this.client.addListener(Client.AUTH_FAILED, (a) => this.onRegisterFailed(a));
    this.client.addListener(Client.SERVER_FULL, (a) => this.onServerFull(a));
    this.client.addListener(Client.CONNECTION_ERROR, (a) => this.onConnectionError(a));
    this.client.onCloseForImmediateReconnect =
      this.onClientDisconnectForImmediateReconnect.bind(this);
    App.Client = this.client;
    this.authenticated = !1;
    this.user = new User();
    this.game = null;
    this.matchStarted = !1;
    this.background =
      this.adLoaderBackground =
      this.onConnectRetryMode =
      this.gameOutputListener =
      this.gameBinInputListener =
      this.gameInputListener =
        null;
    this.onMouseDownListener = this.onMouseDown.bind(this);
    this.onMouseMoveListener = this.onMouseMove.bind(this);
    this.inCommercialBreak = !1;
    this.startTime = Date.now();
    this.autoJoinGame = null;
    this.autoJoinOnCreate = !1;
    this.checkInterval = null;
    this.lastUpdateTime = Date.now();
    this.hasLoaded = !1;
    this.redrawTimeout = this.adFaderInterval = this.adLoaderTimeout = null;
    this.stepCount = 0;
    this.stepCallback = (a) => (App.DisplayFrameTime ? this.onStepDev(a) : this.onStep(a));
    this.totalFrameTime = [];
    this.logicFrameTime = [];
    this.renderFrameTime = [];
    this.lastServerReload = Date.now();
    this.lastBannerReload = Date.now();
    this.adElement = document.getElementById("adwrapper");
    document.addEventListener("visibilitychange", () => this.setFocus(document.hidden ? !1 : !0));
  }
  async load() {
    switch (App.WhiteLabel) {
      case App.WhiteLabel_CG:
        App.CrazySDK.init();
        App.CrazySDK.addEventListener("adStarted", () => this.adStarted());
        App.CrazySDK.addEventListener("adError", () => this.adError());
        App.CrazySDK.addEventListener("adFinished", () => this.adFinished());
        App.CrazySDK.addEventListener("bannerRendered", (a) => {
          console.log(`Banner for container ${a.containerId} has been rendered!`);
        });
        App.CrazySDK.addEventListener("bannerError", (a) => {
          console.log(`Banner render error: ${a.error}`);
        });
        App.CrazySDK.addEventListener("adblockDetectionExecuted", (a) => {
          App.AdblockDetected = a.hasAdblock ? !0 : !1;
        });
        this.proceed();
        break;
      case App.WhiteLabel_POKI:
      case App.WhiteLabel_POKI_MAIN:
        App.PokiSDK &&
          App.PokiSDK.init()
            .then(() => {
              console.log("Poki SDK successfully initialized");
              App.AdblockDetected = !1;
              App.PokiSDK.gameLoadingStart();
              this.proceed();
            })
            .catch(() => {
              console.log("Initialized, but the user likely has adblock");
              App.AdblockDetected = !0;
              App.PokiSDK.gameLoadingStart();
              this.proceed();
            });
        PokiSDK.setDebug(!1);
        break;
      default:
        this.proceed();
    }
  }
  async proceed() {
    App.UpdatePreloader(0.2);
    var a = Registry.Instance.retrieve(Registry.Key.CREDENTIAL);
    const b = Registry.Instance.retrieve(Registry.Key.MASTER);
    App.FirstRun = b ? b.firstRun : !1;
    try {
      App.FirstRun
        ? ((this.credential = await APIClient.postAutoRegistration()),
          this.credential.credentials
            ? (Registry.Instance.store(Registry.Key.AUTOGEN, {
                name: this.credential.name,
                password: btoa(this.credential.password),
              }),
              (this.credential = this.credential.credentials),
              Registry.Instance.store(Registry.Key.CREDENTIAL, this.credential),
              (Registry.Instance.credential = this.credential))
            : (this.credential = await this.fetchGuestCredential()))
        : (this.credential =
            a &&
            void 0 !== a.accounttype &&
            !1 !== a.available &&
            null !== a.playerid &&
            null !== a.id &&
            void 0 !== a.level
              ? a
              : await this.fetchGuestCredential());
    } catch (c) {
      this.credential = App.DefaultCredential;
    }
    (a = Registry.Instance.retrieve(Registry.Key.AUTOGEN)) && !0 !== a.error && (App.Autogen = !0);
    this.credential || (this.credential = App.DefaultCredential);
    App.Credential = this.credential;
    App.UpdatePreloader(0.3);
    this.settings = Registry.Instance[Registry.Key.SETTINGS];
    this.settings.sound.enabled || Howler.mute(!0);
    a = {
      backgroundColor: 0,
      antialias: this.settings.graphics.aa,
      transparent: !1,
      resolution: App.DevicePixelRatio,
      autoDensity: !0,
      width: App.ClientWidth,
      height: App.ClientHeight,
    };
    PIXI.settings.WRAP_MODE = PIXI.WRAP_MODES.REPEAT;
    PIXI.Mesh.BATCHABLE_SIZE = 65536;
    PIXI.GraphicsGeometry.BATCHABLE_SIZE = 65536;
    this.pixi = new PIXI.Application(a);
    App.Renderer = this.pixi.renderer;
    App.Renderer.view.oncontextmenu = (c) => c.preventDefault();
    this.view = this.pixi.view;
    this.view.style.display = "block";
    this.view.id = "view";
    App.Stage = this.stage = this.pixi.stage;
    document.body.appendChild(this.view);
    window.onresize = () => this.onResize();
    App.UpdatePreloader(0.4);
    this.interpreter = new Interpreter(this);
    this.interpreter.addCommand(App.CMD_CONNECT, this.onCmdConnect);
    this.interpreter.addCommand(App.CMD_DISCONNECT, this.onCmdDisconnect);
    this.interpreter.addCommand(App.CMD_UNLINK, this.onCmdUnlink);
    this.interpreter.on(Interpreter.INVALID_COMMAND, (c) => this.onCmdInvalid(c));
    a = new AssetLoader(App.Assets, App.RESOURCE_FOLDER);
    a.onProgress = (c) => {
      App.UpdatePreloader(0.4 + 0.6 * c.progress);
    };
    a.onComplete = () => this.start();
    a.load(App.RESOURCES);
  }
  async fetchGuestCredential(a) {
    return await APIClient.getGuestCredentials(
      void 0 !== a && null !== a ? a : "Ninja" + Math.floor(1e3 * Math.random())
    );
  }
  async start() {
    switch (App.WhiteLabel) {
      case App.WhiteLabel_POKI:
      case App.WhiteLabel_POKI_MAIN:
        App.PokiSDK && App.PokiSDK.gameLoadingFinished();
    }
    App.RemovePreloader();
    App.CombinedTextures = App.Assets.combined.textures;
    App.GenerateTexturesFromSheet(App.Assets.seamless.textures);
    App.Console = new CommandConsole();
    App.Console.ignoreInput = !0;
    App.Console.linkInterpreter(this.interpreter);
    App.Layer = new Layer();
    App.Layer.on(Layer.Events.DISCONNECT, this.onLayerDisconnect.bind(this));
    App.Layer.on(Layer.Events.HIDE_MENU, this.onLayerHideMenu.bind(this));
    App.Layer.on(Layer.Events.SHOW_MENU, this.onLayerShowMenu.bind(this));
    App.Layer.on(Layer.Events.UPDATE_CREDENTIAL, this.onLayerUpdateCredential.bind(this));
    App.Layer.on(Layer.Events.JOIN_GAME, this.onLayerJoinGame.bind(this));
    App.Layer.on(Layer.Events.JOIN_SERVER, this.onLayerJoinServer.bind(this));
    App.Layer.on(Layer.Events.CREATE_SERVER, this.onLayerCreateServer.bind(this));
    App.Layer.on(Layer.Events.RENAME_COMPLETED, this.onLayerRenameCompleted.bind(this));
    App.Layer.on(Layer.Events.JOYSTICK_MOVE_STATE, this.onJoystickMoveState.bind(this));
    App.Layer.on(Layer.Events.JOYSTICK_TARGET_STATE, this.onJoystickTargetState.bind(this));
    App.Layer.on(Layer.Events.DISPLAY_HELP, this.onLayerDisplayHelp.bind(this));
    App.Layer.on(Layer.Events.MUTE_TOGGLE, this.onLayerMute.bind(this));
    App.Layer.on(Layer.Events.SETTINGS_ACCESS, this.onLayerShowSettings.bind(this));
    App.Layer.on(Layer.Events.SETTINGS_HIDE, this.onLayerHideSettings.bind(this));
    App.Layer.on(Layer.Events.ESCAPE_MENU_ACCESS, this.onEscapeMenuAccess.bind(this));
    App.Layer.on(Layer.Events.REWARDS_CLAIMED, this.onRewardsClaimed.bind(this));
    App.Layer.resize(App.ClientWidth, App.ClientHeight);
    await App.Layer.setMode(Layer.MODE_MENU);
    App.Stats = new Stats();
    App.Stats.x = App.ClientWidth - 12;
    App.Stats.y = 12;
    this.cursor = new PIXI.Sprite(App.CombinedTextures.mouse_pointer);
    this.adLoaderBackground = new PIXI.Graphics();
    this.adLoaderBackground.beginFill(0, 1);
    this.adLoaderBackground.drawRect(0, 0, 10, 10);
    this.adLoaderBackground.endFill();
    this.adLoaderBackground.width = App.ClientWidth;
    this.adLoaderBackground.height = App.ClientHeight;
    this.adLoaderBackground.interactive = !0;
    this.adLoaderBackground.on("mousemove", (b) => {
      this.cursor.x = b.data.global.x;
      this.cursor.y = b.data.global.y;
    });
    this.continueButton = new Button("adbtn");
    this.continueButton.setText("- Click here to continue -");
    this.continueButton.addListener(Button.BUTTON_RELEASED, this.onTriggerVideoAd.bind(this));
    this.continueButton.setTint(16763904);
    this.continueButton.scale.x = this.continueButton.scale.y = 1.1;
    this.gradient = new Gradient(App.ClientWidth, App.ClientHeight);
    this.gradient.sc = 1;
    this.gradient.minY = -1e3;
    this.gradient.maxY = 0;
    this.gradient.colors("#FFCC65", "#465eff");
    this.gradient.offset(0);
    this.gradient.interactive = !0;
    this.gradient.on("touchstart", () => {
      this.cursor.visible = !1;
    });
    this.sky = new PIXI.Graphics();
    this.sky.pivot.x = 0.5;
    this.sky.beginFill(16777215, 1);
    for (var a = 0; 300 > a; a++) {
      let b = Math.random() * App.ClientHeight * 0.75;
      this.sky.drawCircle(
        Math.random() * App.ClientWidth,
        b,
        (0.5 + 0.5 * Math.random()) * (1 - (1 / App.ClientHeight) * 0.75 * b) + 0.5
      );
    }
    this.sky.endFill();
    this.sky.beginFill(16777045, 1);
    this.sky.drawCircle(100, 500, 100);
    this.sky.endFill();
    this.background = new Background(6, 5, 600, 150, 50, 50);
    this.background.draw("generic", 5263964);
    this.background.x = 0;
    this.background.y = -200;
    App.WhiteLabel === App.WhiteLabel_POKI_MAIN &&
      App.Domain !== App.WhiteLabel_CG &&
      ((this.pokiLogo = new PIXI.Sprite(App.CombinedTextures["poki-badge"])),
      (this.pokiLogo.scale.x = this.pokiLogo.scale.y = 1 * App.Scale),
      (this.pokiLogo.anchor.x = 1),
      (this.pokiLogo.anchor.y = 1),
      (this.pokiLogo.interactive = !0),
      this.pokiLogo.on("touchstart", () => window.open("https://poki.com/en/g/ninja-io", "_blank")),
      this.pokiLogo.on("mousedown", () => window.open("https://poki.com/en/g/ninja-io", "_blank")),
      this.pokiLogo.on(
        "mouseover",
        () => (this.pokiLogo.scale.x = this.pokiLogo.scale.y = 1.05 * App.Scale)
      ),
      this.pokiLogo.on(
        "mouseout",
        () => (this.pokiLogo.scale.x = this.pokiLogo.scale.y = 1 * App.Scale)
      ));
    this.youtubeLogo = new PIXI.Sprite(App.CombinedTextures.youtube_logo);
    this.youtubeLogo.scale.x = this.youtubeLogo.scale.y = 0.45 * App.Scale;
    this.youtubeLogo.interactive = !0;
    this.youtubeLogo.on("mouseover", () => {
      this.youtubeLogo.scale.x = this.youtubeLogo.scale.y = 0.5 * App.Scale;
      AudioEffects.ButtonHover.audio.play();
    });
    this.youtubeLogo.on(
      "mouseout",
      () => (this.youtubeLogo.scale.x = this.youtubeLogo.scale.y = 0.45 * App.Scale)
    );
    this.youtubeLogo.on("mousedown", () =>
      window.open("https://www.youtube.com/channel/UCET8PfVdLECAMYwDYIUY3rA", "_blank")
    );
    this.youtubeLogo.on("touchstart", () =>
      window.open("https://www.youtube.com/channel/UCET8PfVdLECAMYwDYIUY3rA", "_blank")
    );
    this.twitterLogo = new PIXI.Sprite(App.CombinedTextures.twitter_logo);
    this.twitterLogo.scale.x = this.twitterLogo.scale.y = 0.4 * App.Scale;
    this.twitterLogo.interactive = !0;
    this.twitterLogo.on("mouseover", () => {
      this.twitterLogo.scale.x = this.twitterLogo.scale.y = 0.45 * App.Scale;
      AudioEffects.ButtonHover.audio.play();
    });
    this.twitterLogo.on(
      "mouseout",
      () => (this.twitterLogo.scale.x = this.twitterLogo.scale.y = 0.4 * App.Scale)
    );
    this.twitterLogo.on("mousedown", () =>
      window.open("https://twitter.com/ninjaio_game", "_blank")
    );
    this.twitterLogo.on("touchstart", () =>
      window.open("https://twitter.com/ninjaio_game", "_blank")
    );
    this.redditLogo = new PIXI.Sprite(App.CombinedTextures.reddit_logo);
    this.redditLogo.scale.x = this.redditLogo.scale.y = 0.4 * App.Scale;
    this.redditLogo.interactive = !0;
    this.redditLogo.on("mouseover", () => {
      this.redditLogo.scale.x = this.redditLogo.scale.y = 0.45 * App.Scale;
      AudioEffects.ButtonHover.audio.play();
    });
    this.redditLogo.on(
      "mouseout",
      () => (this.redditLogo.scale.x = this.redditLogo.scale.y = 0.4 * App.Scale)
    );
    this.redditLogo.on("mousedown", () =>
      window.open("https://www.reddit.com/r/ninjaio", "_blank")
    );
    this.redditLogo.on("touchstart", () =>
      window.open("https://www.reddit.com/r/ninjaio", "_blank")
    );
    App.SelectedMode = Registry.GetLocalStorageItem(App.ModePreference);
    App.FirstRun
      ? (App.SelectedMode = Game.MODE_TR)
      : "string" !== App.SelectedMode &&
        ((a = Math.random()),
        (App.SelectedMode =
          0.3 > a ? Game.MODE_TDM : 0.3 <= a && 0.6 > a ? Game.MODE_CTF : Game.MODE_DM));
    this.showMenu();
    this.cursor.x = 0.5 * App.ClientWidth;
    this.cursor.y = 0.5 * App.ClientHeight;
    this.cursor.anchor.x = 0;
    this.cursor.anchor.y = 0;
    this.cursor.scale.x = this.cursor.scale.y = 0.25;
    App.IsMobile
      ? ((this.cursor.visible = !1), setInterval(() => this.onResize(!0), 5e3))
      : this.stage.addChild(App.Console);
    this.stage.addChild(App.Stats);
    this.stage.addChild(App.Layer);
    App.WhiteLabel === App.WhiteLabel_POKI_MAIN &&
      App.Domain !== App.WhiteLabel_CG &&
      this.stage.addChild(this.pokiLogo);
    this.stage.addChild(this.cursor);
    requestAnimationFrame(this.stepCallback);
    this.hasLoaded = !0;
    this.onResize();
    this.menu.resize();
  }
  onMouseDown() {
    Dropdown.CollapseInstances();
    document.hasFocus() || window.focus();
  }
  onMouseMove(a) {
    a.stopPropagation();
    this.cursor.x = a.data.global.x;
    this.cursor.y = a.data.global.y;
    1 > this.scale.x
      ? ((this.background.x =
          700 + 0.02 * (-a.data.global.x - 0.5 * App.ClientWidth) + -400 * (1 - this.scale.x)),
        (this.background.y = -100 + 0.02 * -a.data.global.y),
        (this.sky.x = 0.01 * -a.data.global.x + -400 * (1 - this.scale.x)))
      : ((this.background.x = 700 + 0.02 * (-a.data.global.x - 0.5 * App.ClientWidth)),
        (this.background.y = -100 + 0.02 * -a.data.global.y),
        (this.sky.x = 0.01 * -a.data.global.x));
    this.sky.y = 0.01 * -a.data.global.y;
  }
  showMenu() {
    App.Console.ignoreInput = !0;
    App.Console.onConsoleInputFocus(!1);
    if (App.WhiteLabel !== App.WhiteLabel_NONE || 1300 > App.ClientWidth) App.Console.visible = !1;
    App.Stage.on("mousedown", this.onMouseDownListener);
    App.Stage.on("mousemove", this.onMouseMoveListener);
    this.menu = new Menu(this.servers);
    switch (App.WhiteLabel) {
      case App.WhiteLabel_CG:
        this.adElement &&
          ((this.adElement.style.display = "block"),
          App.CrazySDK.requestResponsiveBanner(["banner-container"]));
        break;
      case App.WhiteLabel_POKI_MAIN:
        this.adElement &&
          App.PokiSDK &&
          ((this.adElement.style.display = "block"),
          App.PokiSDK.displayAd(this.adElement, "728x90"));
        break;
      default:
        this.adElement &&
          window.aiptag &&
          ((this.adElement.style.display = "block"),
          aiptag.cmd.display.push(function () {
            aipDisplayTag.display("ninja-io_300x250");
          }));
    }
    this.menu.on(Menu.GUEST_NAME_CHANGE, (a) => this.onGuestNameChange(a));
    this.menu.on(Menu.CUSTOMIZATION_ACCESS, () => App.Layer.onCustomizationShow());
    this.menu.on(Menu.SERVER_CREATION_ACCESS, () => App.Layer.onServerCreationShow());
    this.menu.on(Menu.SERVER_LISTING_ACCESS, () => App.Layer.onServerListingShow());
    this.menu.on(Menu.RENAME_ACCESS, () => App.Layer.onRenameAccess());
    this.menu.on(Menu.JOIN_GAME_MODE, (a) => this.onRequestJoinGameMode(a));
    this.menu.on(Menu.JOIN_SERVER, (a, b) => this.onRequestChooseServer(a, b));
    this.menu.on(Menu.REWARDS_ACCESS, () => App.Layer.onRewardsAccess());
    this.menu.on(Menu.NEWS_ACCESS, () => App.Layer.onNewsAccess());
    this.menu.setPlayerData({
      name: this.credential.username,
      guest: -1 === this.credential.playerid ? !0 : !1,
      customization: this.credential.customization,
    });
    this.menu.setServerData(this.servers);
    this.menu.setServerStatus(this.status);
    this.menu.init();
    this.stage.addChild(this.gradient);
    this.stage.addChild(this.sky);
    this.stage.addChild(this.background);
    this.stage.addChild(this.menu);
    App.WhiteLabel !== App.WhiteLabel_POKI &&
      ((this.youtubeLogo.x = 0.5 * App.ClientWidth + 320),
      (this.redditLogo.x = 0.5 * App.ClientWidth + 362),
      (this.twitterLogo.x = 0.5 * App.ClientWidth + 400),
      (this.youtubeLogo.y = 5),
      (this.twitterLogo.y = 3),
      (this.redditLogo.y = 4),
      this.stage.addChild(this.youtubeLogo),
      this.stage.addChild(this.twitterLogo),
      this.stage.addChild(this.redditLogo));
    this.onResize();
    App.Console.parent && this.stage.setChildIndex(App.Console, this.stage.children.length - 1);
    App.Layer.parent && this.stage.setChildIndex(App.Layer, this.stage.children.length - 1);
    this.checkInterval ||
      ((this.checkInterval = setInterval(() => {
        let a = Date.now();
        6e4 <= a - this.lastServerReload && ((this.lastServerReload = a), this.requestServerList());
        if (6e4 <= a - this.lastBannerReload)
          switch (((this.lastBannerReload = a), App.WhiteLabel)) {
            case App.WhiteLabel_CG:
              this.adElement &&
                ((this.adElement.style.display = "block"),
                App.CrazySDK.requestResponsiveBanner(["banner-container"]));
          }
      }, App.CheckIntervalRate)),
      this.requestServerList());
    App.WhiteLabel === App.WhiteLabel_POKI_MAIN &&
      App.Domain !== App.WhiteLabel_CG &&
      this.stage.addChild(this.pokiLogo);
  }
  setFocus(a) {
    if ((App.HasFocus = a))
      this.game ? (this.game.focus(), this.game.resize()) : this.menu && this.menu.resize();
  }
  onConnect() {
    this.onConnectRetryMode &&
      (this.onRequestJoinGameMode(this.onConnectRetryMode), (this.onConnectRetryMode = null));
    App.ConnectedServer = App.SelectedServer;
  }
  async onDisconnect() {
    null !== this.game && this.leaveGame(!0);
  }
  onStep(a) {
    const b = a - this.lastUpdateTime;
    0 > b && (this.lastUpdateTime = a);
    App.Time = App.StartTime + a;
    13 < b &&
      ((this.lastUpdateTime = a),
      (App.FrameTime = (60 * b) / 1e3),
      this.game
        ? this.game.step(b)
        : (App.Layer && App.Layer.update(), this.menu && this.menu.active && this.menu.step()),
      App.Renderer && App.Renderer.render(this.stage, { clear: !1 }));
    this.stepCount++;
    requestAnimationFrame(this.stepCallback);
  }
  onStepDev(a) {
    var b = 0,
      c = 0,
      d = 0;
    let e = 0,
      f = 0,
      g = 0;
    b = performance.now();
    c = a - this.lastUpdateTime;
    0 > c && (this.lastUpdateTime = a);
    App.Time = App.StartTime + a;
    13 < c &&
      ((this.lastUpdateTime = a),
      (App.FrameTime = (60 * c) / 1e3),
      this.game
        ? ((d = performance.now()), this.game.step(c), (e = performance.now()))
        : (App.Layer && App.Layer.update(), this.menu && this.menu.active && this.menu.step()),
      (f = performance.now()),
      App.Renderer && App.Renderer.render(this.stage, { clear: !1 }),
      (g = performance.now()));
    c = performance.now();
    20 > a % 1e3 && 60 <= this.totalFrameTime.length
      ? ((a = (this.totalFrameTime.reduce((h, m) => h + m) / this.totalFrameTime.length)
          .toFixed(3)
          .padEnd(4, "0")),
        (b = (this.logicFrameTime.reduce((h, m) => h + m) / this.logicFrameTime.length)
          .toFixed(3)
          .padEnd(4, "0")),
        (d = (this.renderFrameTime.reduce((h, m) => h + m) / this.renderFrameTime.length)
          .toFixed(3)
          .padEnd(4, "0")),
        App.Console.log("FT: " + a + " L: " + b + " R: " + d),
        (this.totalFrameTime = []),
        (this.logicFrameTime = []),
        (this.renderFrameTime = []))
      : (this.totalFrameTime.push(c - b),
        this.logicFrameTime.push(e - d),
        this.renderFrameTime.push(g - f));
    requestAnimationFrame(this.stepCallback);
  }
  async onRequestChooseServer(a, b) {
    await this.applyServerSettings(a);
    b();
  }
  onLayerJoinServer(a) {
    let b = null;
    for (let c = 0; c < this.servers.length; c++)
      if (this.servers[c].id === a) {
        b = this.servers[c];
        break;
      }
    this.applyServerSettings(b);
  }
  async applyServerSettings(a) {
    await App.Layer.updateCredentialsIfExpired();
    App.SelectedServer = a;
    this.client.setServer(App.SelectedServer);
    this.menu.selectServer(a.id);
    Registry.SetLocalStorageItem(App.ServerPreference, App.SelectedServer.uid);
  }
  onLayerCreateServer(a) {
    if (this.client.isConnected()) this.client.emit({ type: Protocol.Session.CREATE, params: a });
    else
      App.Layer.onServerCreateResult({
        success: !1,
        info: "Server creation failed. \nNot connected to any server.\nGold will be refunded automatically.",
      });
  }
  onLayerRenameCompleted() {
    this.menu.setPlayerData({
      name: this.credential.username,
      guest: -1 === this.credential.playerid ? !0 : !1,
      customization: this.credential.customization,
    });
  }
  onJoystickMoveState(a) {
    this.game && this.game.updateJoystickMoveState(a);
  }
  onJoystickTargetState(a) {
    this.game && this.game.updateJoystickTargetState(a);
  }
  onRegisterFailed() {
    this.authenticated = !1;
    App.Layer.onServerAuthFailed();
  }
  onClientDisconnectForImmediateReconnect() {
    this.client.connect();
  }
  async onRequestJoinGameMode(a) {
    await App.Layer.updateCredentialsIfExpired();
    App.Layer.onJoinGameMode();
    this.client.isConnected()
      ? ((App.SelectedMode = a),
        Registry.SetLocalStorageItem(App.ModePreference, App.SelectedMode),
        this.requestJoinGameMode(a))
      : ((this.onConnectRetryMode = a), this.client.connect());
  }
  async requestServerList() {
    let a;
    try {
      if (((a = await APIClient.getServers()), !a))
        throw "server query failed, fallback to default";
    } catch (d) {
      a = App.DefaultServers;
    }
    this.servers = a.servers;
    this.servers.sort(() => 0.5 - Math.random());
    this.status = a.status;
    let b = this.servers[0];
    if (App.FirstRun) {
      var c = App.GetNearestGeoServer(this.servers);
      c && (b = c);
    }
    if (0 < this.servers.length) {
      if (App.FirstRun) App.SelectedServer = b;
      else {
        c = Registry.GetLocalStorageItem(App.ServerPreference);
        for (let d = 0; d < this.servers.length; d++) {
          let e = this.servers[d];
          if (e.uid === c || null === c) {
            App.SelectedServer = e;
            break;
          }
        }
      }
      App.Servers = this.servers;
    }
    null === App.SelectedServer && (App.SelectedServer = b);
    this.client.setServer(App.SelectedServer);
    null !== this.menu &&
      (0 < this.servers.length && this.menu.setServerData(this.servers),
      this.menu.setServerStatus(this.status),
      this.menu.setServerHeadline(a.headline));
  }
  requestJoinGame(a) {}
  requestJoinGameMode(a) {
    this.autoJoinOnCreate = !0;
    this.client.emit({ type: Protocol.Session.JOIN_MODE, mode: a });
  }
  requestLeaveGame(a) {
    this.client.emit({ type: Protocol.Session.LEAVE });
  }
  onSessionData(a) {
    switch (a.type) {
      case Protocol.Session.CREATE_RESP:
        a.success &&
          this.autoJoinOnCreate &&
          this.client.emit({ type: Protocol.Session.JOIN_GAME, name: a.name });
        this.autoJoinOnCreate || (App.Console.log(a.info), App.Layer.onServerCreateResult(a));
        this.autoJoinOnCreate = !1;
        break;
      case Protocol.Session.JOIN_RESP:
        this.onJoinResp(a);
        this.autoJoinOnCreate = !1;
        break;
      case Protocol.Session.LEAVE_RESP:
        this.onLeaveResp(a);
        break;
      case Protocol.Session.INFO:
        this.onInfo(a);
        break;
      case Protocol.Session.CLIENT_AUTH:
        this.onClientAuth(a);
    }
  }
  onClientAuth(a) {
    App.Console.log("connection established");
    null !== this.autoJoinGame
      ? (App.Console.log("Joining game " + this.autoJoinGame.name + "..."),
        this.client.emit({
          type: Protocol.Session.JOIN_GAME,
          name: this.autoJoinGame.name,
          password: this.autoJoinGame.password,
        }),
        (this.autoJoinGame = null))
      : a.authenticated && (this.authenticated = !0);
  }
  onServerFull() {
    App.Layer.onServerFull();
  }
  onConnectionError() {
    App.Layer.onConnectionError();
  }
  onInfo(a) {
    App.Console.log(a.info);
  }
  onJoinResp(a) {
    if (a.granted) this.initGameMode(a.sid);
    else App.Layer.onServerReject(a);
  }
  onLeaveResp(a) {
    a.granted && this.leaveGame();
  }
  async leaveGame() {
    this.gameInputListener && this.client.removeListener(Protocol.GAME, this.gameInputListener);
    this.gameBinInputListener &&
      this.client.removeListener(Protocol.GAME_BIN, this.gameBinInputListener);
    this.gameOutputListener && this.game.removeListener(Protocol.GAME, this.gameOutputListener);
    this.adLoaderBackground &&
      this.adLoaderBackground.parent &&
      (this.stage.removeChild(this.adLoaderBackground),
      this.stage.removeChild(this.continueButton));
    this.gameOutputListener = this.gameBinInputListener = this.gameInputListener = null;
    this.stage.removeChild(this.game);
    this.game.shutdown();
    this.game = null;
    App.Stage.removeListener("mousedown");
    App.Stage.removeListener("mousemove");
    App.Stage.removeListener("mouseup");
    switch (App.WhiteLabel) {
      case App.WhiteLabel_CG:
        App.CrazySDK.gameplayStop();
        break;
      case App.WhiteLabel_POKI_MAIN:
      case App.WhiteLabel_POKI:
        !this.gameplayStopped &&
          App.PokiSDK &&
          ((this.gameplayStopped = !0), console.log("gameplayStop"), App.PokiSDK.gameplayStop());
    }
    this.adLoaderTimeout && clearTimeout(this.adLoaderTimeout);
    this.adFaderInterval && clearInterval(this.adFaderInterval);
    await App.Layer.setMode(Layer.MODE_MENU);
    this.showMenu();
    this.stage.addChild(this.cursor);
    this.interactive = this.stage.interactive = !1;
    this.client.disconnect();
  }
  onGameData(a) {
    this.client.emit(a);
  }
  initGameMode(a) {
    App.Console.visible = !0;
    this.game = new Game(a);
    switch (App.WhiteLabel) {
      case App.WhiteLabel_CG:
        App.CrazySDK.gameplayStart();
        break;
      case App.WhiteLabel_POKI:
      case App.WhiteLabel_POKI_MAIN:
        App.PokiSDK &&
          (this.muteIfRequired(!0),
          (this.adPlaying = !0),
          console.log("commercialBreak"),
          App.PokiSDK.commercialBreak().then(() => {
            this.adPlaying = !1;
            this.muteIfRequired(!1);
            null !== this.game &&
              this.gameplayStopped &&
              ((this.gameplayStopped = !1),
              console.log("gameplayStart"),
              App.PokiSDK.gameplayStart());
          }));
    }
    this.game.onDisplayAdButton = this.onDisplayAdButton.bind(this);
    App.WhiteLabel === App.WhiteLabel_POKI_MAIN &&
      App.PokiSDK &&
      App.PokiSDK.destroyAd(this.adElement);
    this.adElement &&
      (window.aiptag || App.CrazySDK || App.PokiSDK) &&
      (this.adElement.style.display = "none");
    App.Console.ignoreInput = !1;
    this.stage.removeChild(this.gradient);
    this.stage.removeChild(this.sky);
    this.stage.removeChild(this.background);
    App.WhiteLabel !== App.WhiteLabel_POKI &&
      (this.stage.removeChild(this.youtubeLogo),
      this.stage.removeChild(this.twitterLogo),
      this.stage.removeChild(this.redditLogo));
    App.WhiteLabel === App.WhiteLabel_POKI_MAIN &&
      App.Domain !== App.WhiteLabel_CG &&
      this.stage.removeChild(this.pokiLogo);
    this.gameOutputListener = this.onGameData.bind(this);
    this.game.on(Protocol.GAME, this.gameOutputListener);
    this.game.on(Layer.Events.DISCONNECT, () => this.onLayerDisconnect());
    this.game.on(Game.MATCH_START, () => {
      this.matchStarted = !0;
      switch (App.WhiteLabel) {
        case App.WhiteLabel_CG:
          App.CrazySDK.gameplayStart();
          break;
        case App.WhiteLabel_POKI:
        case App.WhiteLabel_POKI_MAIN:
          App.PokiSDK &&
            this.gameplayStopped &&
            !this.adPlaying &&
            ((this.gameplayStopped = !1),
            console.log("gameplayStart"),
            App.PokiSDK.gameplayStart());
      }
    });
    this.game.on(Game.MATCH_END, () => {
      this.matchStarted = !1;
      switch (App.WhiteLabel) {
        case App.WhiteLabel_CG:
          App.CrazySDK.gameplayStop();
          break;
        case App.WhiteLabel_POKI:
        case App.WhiteLabel_POKI_MAIN:
          App.PokiSDK &&
            !this.gameplayStopped &&
            ((this.gameplayStopped = !0), console.log("gameplayStop"), App.PokiSDK.gameplayStop());
      }
    });
    this.gameInputListener = (b) => this.game.onData(b.data);
    this.gameBinInputListener = (b) => this.game.onBinData(b.data);
    this.client.addListener(Protocol.GAME, this.gameInputListener);
    this.client.addListener(Protocol.GAME_BIN, this.gameBinInputListener);
    this.stage.removeChild(this.menu);
    this.stage.removeChild(this.cursor);
    this.menu = null;
    Dropdown.RemoveInstances();
    App.Stage.removeListener("mousedown", this.onMouseDownListener);
    this.stage.addChildAt(this.game, 0);
    this.game.resize();
    this.interactive = this.stage.interactive = !1;
    this.checkInterval && (clearInterval(this.checkInterval), (this.checkInterval = null));
    App.Layer.setMode(Layer.MODE_GAME);
  }
  onCmdConnect() {
    App.Console.log("command not implemented");
  }
  onCmdDisconnect() {
    App.Console.log("command not implemented");
  }
  onCmdUnlink() {
    App.Console.unlinkInterpreter(this.interpreter);
    App.Console.log("command interpreter unlinked");
  }
  onCmdInvalid(a) {}
  onDisplayAdButton() {
    switch (App.WhiteLabel) {
      case App.WhiteLabel_CG:
        App.CrazySDK.gameplayStop();
    }
    this.adLoaderTimeout = setTimeout(() => {
      this.menu ||
        (this.continueButton.parent ||
          ((this.adLoaderBackground.alpha = 0),
          this.stage.addChild(this.adLoaderBackground),
          this.stage.addChild(this.continueButton)),
        this.stage.addChild(this.cursor),
        (this.adFaderInterval = setInterval(() => {
          this.adLoaderBackground.alpha += 0.04;
          0.8 <= this.adLoaderBackground.alpha &&
            (clearInterval(this.adFaderInterval), (this.adLoaderBackground.alpha = 0.8));
        }, 50)));
    }, 5e3);
  }
  onTriggerVideoAd() {
    switch (App.WhiteLabel) {
      case App.WhiteLabel_CG:
        App.CrazySDK.requestAd("midgame");
        break;
      case App.WhiteLabel_POKI:
      case App.WhiteLabel_POKI_MAIN:
        App.PokiSDK &&
          (this.muteIfRequired(!0),
          (this.adPlaying = !0),
          console.log("commercialBreak"),
          App.PokiSDK.commercialBreak().then(() => {
            this.adPlaying = !1;
            console.log("Commercial break finished, proceeding to game");
            this.gameplayStopped &&
              this.matchStarted &&
              ((this.gameplayStopped = !1),
              console.log("gameplayStart"),
              App.PokiSDK.gameplayStart());
            this.muteIfRequired(!1);
          }));
        break;
      default:
        "undefined" !== typeof adplayer &&
          aiptag.cmd.player.push(function () {
            adplayer.startPreRoll();
          });
    }
    this.adLoaderBackground &&
      this.adLoaderBackground.parent &&
      ((this.adLoaderBackground.alpha = 0),
      this.stage.removeChild(this.adLoaderBackground),
      this.stage.removeChild(this.continueButton));
    this.menu ||
      (this.stage.removeChild(this.cursor),
      (this.interactive = !1),
      this.stage.removeChild(this.gradient),
      this.stage.removeChild(this.sky),
      this.stage.removeChild(this.background));
  }
  drawBackground() {
    this.background.setup(6, 5, 600, 150, 50, 50);
    this.background.draw("generic", 5263964);
    this.gradient.resize(App.ClientWidth, App.ClientHeight);
    this.sky.clear();
    this.sky.beginFill(16777215, 1);
    for (let a = 0; 300 > a; a++) {
      let b = Math.random() * App.ClientHeight * 0.75;
      this.sky.drawCircle(
        Math.random() * App.ClientWidth,
        b,
        (0.5 + 0.5 * Math.random()) * (1 - (1 / App.ClientHeight) * 0.75 * b) + 0.5
      );
    }
    this.sky.endFill();
    this.sky.beginFill(16777045, 1);
    this.sky.drawCircle(100, 500, 100);
    this.sky.endFill();
  }
  onResize(a = !1) {
    App.WindowResized = !0;
    var b = App.ClientWidth;
    let c = App.ClientHeight,
      d = !1;
    this.hasLoaded || (this.resizeOnLoad = !0);
    App.Renderer &&
      (App.IsMobile
        ? ((App.ClientWidth = window.innerWidth), (App.ClientHeight = window.innerHeight))
        : ((App.ClientWidth = window.innerWidth > screen.width ? screen.width : window.innerWidth),
          (App.ClientHeight =
            window.innerHeight > screen.height ? screen.height : window.innerHeight)),
      (d = b !== App.ClientWidth || c !== App.ClientHeight));
    (d || this.resizeOnLoad) &&
      this.hasLoaded &&
      ((App.Console.visible = 1300 > App.ClientWidth && null === this.game ? !1 : !0),
      (this.adLoaderBackground.width = App.ClientWidth),
      (this.adLoaderBackground.height = App.ClientHeight),
      (b = Math.min(
        App.ClientWidth / App.ReferenceWidth,
        (0.85 * App.ClientHeight) / App.ReferenceHeight
      )),
      (App.Scale = b),
      this.menu &&
        ((this.menu.scale.x = this.menu.scale.y = b),
        (this.menu.x = 0.5 * (App.ClientWidth - App.ReferenceWidth * b)),
        (this.menu.y = 7 * (1 - b) - 5)),
      (App.Layer.scale.x = App.Layer.scale.y = b),
      (App.Layer.x =
        -(App.ClientWidth - App.ReferenceWidth) * b * 0.5 +
        0.5 * (App.ClientWidth - App.ReferenceWidth * b)),
      (App.Layer.y = 4),
      App.Layer.resize(App.ClientWidth, App.ClientHeight),
      null !== this.redrawTimeout &&
        (clearTimeout(this.redrawTimeout), (this.redrawTimeout = null)),
      this.hasResized &&
        (this.redrawTimeout = setTimeout(() => {
          this.hasLoaded && null !== this.menu && (a || this.drawBackground());
          this.redrawTimeout = null;
        }, 500)),
      this.hasLoaded &&
        ((this.continueButton.x = 0.5 * (App.ClientWidth - this.continueButton.width)),
        (this.continueButton.y = 0.5 * App.ClientHeight),
        (this.youtubeLogo.y = 5 * App.Scale),
        (this.redditLogo.y = 4 * App.Scale),
        (this.twitterLogo.y = 3 * App.Scale),
        (this.youtubeLogo.x = 0.5 * App.ClientWidth + 320 * App.Scale),
        (this.redditLogo.x = 0.5 * App.ClientWidth + 362 * App.Scale),
        (this.twitterLogo.x = 0.5 * App.ClientWidth + 400 * App.Scale),
        (this.youtubeLogo.scale.x = this.youtubeLogo.scale.y = 0.45 * App.Scale),
        (this.redditLogo.scale.x = this.redditLogo.scale.y = 0.4 * App.Scale),
        (this.twitterLogo.scale.x = this.twitterLogo.scale.y = 0.4 * App.Scale),
        this.pokiLogo &&
          ((this.pokiLogo.x = App.ClientWidth - 8),
          (this.pokiLogo.y = App.ClientHeight - 8),
          (this.pokiLogo.scale.x = this.pokiLogo.scale.y = 1 * App.Scale))),
      App.Renderer.resize(App.ClientWidth, App.ClientHeight));
    App.Stats && (App.Stats.x = App.ClientWidth - 12);
    this.setFocus(!0);
    this.hasResized = !0;
  }
  onLayerDisconnect() {
    this.client.emit({ type: Protocol.Session.LEAVE });
  }
  onLayerShowSettings() {
    this.menu && this.menu.showSettings();
  }
  onLayerHideSettings() {
    this.menu && this.menu.hideSettings();
  }
  onEscapeMenuAccess() {
    if (this.game) this.game.onEscapeMenuAccess();
  }
  onRewardsClaimed() {
    this.menu && this.menu.hideRewardButton();
  }
  onLayerMute(a) {
    this.game &&
      (this.game.mute(a), a && (Registry.Instance[Registry.Key.SETTINGS].sound.enabled = !a));
  }
  onLayerDisplayHelp() {
    this.game && this.game.displayHelp();
  }
  onLayerHideMenu() {
    this.menu && (this.menu.hideItems(), (this.menu.active = !1));
  }
  onLayerShowMenu() {
    this.menu && (this.menu.showItems(), (this.menu.active = !0), this.menu.hideSettings());
  }
  onLayerJoinGame(a, b, c) {
    if (!this.client.isConnected() || (App.SelectedServer && App.SelectedServer.id !== b))
      for (let d = 0; d < this.servers.length; d++) {
        let e = this.servers[d];
        if (e.id === b) {
          App.SelectedServer = e;
          this.autoJoinGame = { name: a, password: c };
          this.menu.selectServer(b);
          this.client.setServer(App.SelectedServer);
          this.client.connect();
          break;
        }
      }
    else
      this.client.setServer(App.SelectedServer),
        this.client.emit({ type: Protocol.Session.JOIN_GAME, name: a, password: c });
  }
  async onGuestNameChange(a) {
    App.Credential = this.credential = await this.fetchGuestCredential(a);
  }
  async onLayerUpdateCredential(a, b) {
    this.credential = !1 === a.available ? await this.fetchGuestCredential() : a;
    App.Credential = this.credential;
    b
      ? (Registry.Instance.store(Registry.Key.CREDENTIAL, a), (Registry.Instance.credential = a))
      : (Registry.Instance.store(Registry.Key.CREDENTIAL, { available: !1 }),
        (Registry.Instance.credential = { available: !1 }));
    this.menu &&
      (this.menu.setPlayerData({
        name: this.credential.username,
        guest: -1 === this.credential.playerid ? !0 : !1,
        customization: this.credential.customization,
      }),
      this.client.isConnected() && this.client.disconnect(!0),
      this.menu.checkRewards(!0));
  }
  adStarted() {
    this.muteIfRequired(!0);
  }
  adFinished() {
    this.muteIfRequired(!1);
    if (App.ShowRewardedAd) App.Layer.onRewardedAdFinished(!0);
    if (App.ShowRewardedShopAd) App.Layer.onRewardedShopAdFinished(!0, !0);
    App.ShowRewardedAd = !1;
    App.ShowRewardedShopAd = !1;
  }
  adError() {
    this.muteIfRequired(!1);
    if (App.ShowRewardedAd) App.Layer.onRewardedAdFinished(!1);
    if (App.ShowRewardedShopAd) App.Layer.onRewardedShopAdFinished(!1, !0);
    App.ShowRewardedAd = !1;
    App.ShowRewardedShopAd = !1;
  }
  muteIfRequired(a) {
    null !== this.game &&
      (a
        ? this.settings && this.settings.sound
          ? this.settings.sound.enabled && this.game.mute(!0)
          : this.game.mute(!0)
        : this.settings && this.settings.sound
        ? this.settings.sound.enabled && this.game.mute(!1)
        : this.game.mutePref || this.game.mute(!1));
  }
}
App.UpdatePreloader = function (a) {
  void 0 !== window.setPreloaderPercentage && window.setPreloaderPercentage(a);
};
App.RemovePreloader = function () {
  const a = document.getElementById("preloader");
  let b = 1;
  const c = setInterval(() => {
    a && (0 < b - 0.025 ? ((a.style.opacity = b), (b -= 0.025)) : (a.remove(), clearInterval(c)));
  }, 1e3 / 60);
};
App.GenerateTexturesFromSheet = function (a) {
  for (let b in a)
    App.CombinedTextures[b] = App.Renderer.generateTexture(new PIXI.Sprite(a[b]), {
      scaleMode: PIXI.SCALE_MODES.LINEAR,
      resolution: 1,
      multisample: PIXI.MSAA_QUALITY.HIGH,
    });
};
App.CrazySDK = null;
App.PokiSDK = null;
App.WhiteLabel_NONE = "ninja.io";
App.WhiteLabel_CG = "cg";
App.WhiteLabel_POKI = "poki";
App.WhiteLabel_POKI_MAIN = "poki_main";
let whitelabel = window.location.host.split(".")[1] ? window.location.host.split(".")[0] : !1;
App.Domain = whitelabel;
switch (whitelabel) {
  case App.WhiteLabel_CG:
    App.WhiteLabel = App.WhiteLabel_POKI_MAIN;
    App.PokiSDK = window.PokiSDK;
    break;
  case App.WhiteLabel_POKI:
    App.WhiteLabel = App.WhiteLabel_POKI;
    window.PokiSDK && (App.PokiSDK = window.PokiSDK);
    break;
  default:
    (App.WhiteLabel = App.WhiteLabel_POKI_MAIN), (App.PokiSDK = window.PokiSDK);
}
"remove" in Element.prototype ||
  (Element.prototype.remove = function () {
    this.parentNode && this.parentNode.removeChild(this);
  });
let mobileDetect = new MobileDetect(navigator.userAgent);
App.IsMobile = mobileDetect.mobile();
App.CMD_CONNECT = "connect";
App.CMD_DISCONNECT = "disconnect";
App.CMD_UNLINK = "unlink";
App.CheckIntervalRate = 1e4;
App.ServerPreference = "server_preference";
App.ModePreference = "mode_preference";
App.Renderer = null;
App.Stage = null;
App.Console = null;
App.Stats = null;
App.Layer = null;
App.ClientVersion = "0.3.0";
App.HasFocus = !0;
App.Scale = 1;
App.StartTime = Date.now();
App.Time = App.StartTime;
App.FrameTime = 0;
App.LastRewardCheck = 0;
App.HadRewards = !1;
App.ShowRewardedAd = !1;
App.AdblockDetected = !1;
App.ShowRewardedShopAd = !1;
App.WindowResized = !1;
App.HelpDisplayed = !1;
App.ReferenceWidth = 860;
App.ReferenceHeight = 560;
App.DevicePixelRatio = window.devicePixelRatio;
App.ClientWidth = window.innerWidth > screen.width ? screen.width : window.innerWidth;
App.ClientHeight = window.innerHeight > screen.height ? screen.height : window.innerHeight;
App.ConnectedServer = {};
App.Servers = [];
App.SelectedServer = null;
App.SelectedMode = null;
App.TransformedMouseX = 0.5 * App.ClientWidth;
App.TransformedMouseY = 0.5 * App.ClientHeight;
App.Client = {};
App.AssetTree = {};
App.Assets = {};
App.UIVisible = !1;
App.FieldHasFocus = !1;
App.Autogen = !1;
App.FirstRun = !1;
App.Credential = {};
App.DisplayFrameTime = !1;
App.Customization = {
  HAIR: [],
  TORSO: [],
  ORB: [],
  FACE: [],
  BELT: [],
  ARMLEFTLOWER: [],
  ARMLEFTUPPER: [],
  ARMRIGHTLOWER: [],
  ARMRIGHTUPPER: [],
  LEGLEFTLOWER: [],
  LEGLEFTUPPER: [],
  LEGRIGHTLOWER: [],
  LEGRIGHTUPPER: [],
  EXTRA: [],
};
App.TimeToColourMap = [
  1381653, 5263964, 6910590, 8557987, 10271433, 10933980, 11331555, 11727327, 10682326, 8650663,
  8650642, 10354563, 10092383, 12123972, 13762089, 14810665, 16514601, 16707113, 16701225, 16691497,
  15234048, 10768128, 7353856, 4267776,
];
App.ContinentMap = { Europe: "eu_west", America: "na_east", Asia: "as_south", Africa: "eu_west" };
App.GetNearestGeoServer = (a) => {
  var b = Intl.DateTimeFormat().resolvedOptions().timeZone;
  b = b.substring(0, b.indexOf("/"));
  b = App.ContinentMap[b];
  void 0 === b && (b = "eu_west");
  let c = null;
  for (let d = 0; d < a.length; d++) {
    let e = a[d];
    if (e.region === b)
      if (null === c) {
        if (((c = e), 100 > parseInt(c.players))) break;
      } else if (100 <= parseInt(c.players) && 100 > parseInt(e.players)) {
        c = e;
        break;
      }
  }
  return c;
};
App.RESOURCE_FOLDER = "./assets-dev";
App.RESOURCES = {
  combined: [{ id: "combined", file: "combined.json" }],
  seamless: [{ id: "seamless", file: "seamless.json" }],
  fonts: [{ id: "opensans", file: "opensans.fnt" }],
};
App.DefaultCredential = JSON.parse(
  LZString.decompressFromBase64(
    "N4IglgJiBcB2CuAbRAaEAXAngBwKYxAGMAnXCXWdMAQ0RDXgGddjZqBbfaEWMWAK2r0Q2RNUwtIMALQBGNIlwA3XHWjyMYdIoIBxeLkbphjANZhkMAAxpqhQgHt4lLHgIBzA0eHZiDiPCE6IwwwAC+aIRM6A7sYABe1FQOsKERRGKwAPpS0HKRmVlsnATChIV+OtzC1BAQxKVhQA"
  )
);
App.DefaultCredential.version = App.ClientVersion;
App.DefaultServers = JSON.parse(
  LZString.decompressFromBase64(
    "N4IgzgpgTgbtYgFwG1QEsAmSQCYBsIANCAK6bYCiA0gKwDsAtgBoDGAckSAHYCGDE2NgEEAzB2IYA9gx5ou2FjxwA6LnIBWPZWkmcALmj0AbAYhBtJUPQAsABEP5Q0i2yM48MGKBDAIzARgAWQOUcfzplPGVwt2IAB0s9bBoADhEAThxOSBYSb2x/Tm8Acx15M14AfQgeMCTiOp49Ej8QSS4jOQF4ox4AT3hsAFpOYr4fYc4GSQwJxFA9GoYAERqbGT0Wa0mJNesNrZ2QRTjm7wAVawgAMV7iyYBfB8J0LDMcGk4yN5AAWRgUgAJACSYBgABlOLx+IIhDhxCApDI5NguH0WCo1FxNNpdMQDMZTOZEnYHNBnDxbFliB4vD5Wv48BF/EFooEaNERIV4olkmlMtkILl8gEihBSu1UTxqrV6uA9E0Wth2p0uN0QHFegMoK0RsQxvxdVMZnNQCczhBLjc7kdZk19k1DmY9SBFnxVvaDttnSAni8QOR3tTSIGQOoKGB/MCAB7WABCUPG2AAykJ/AikbJyuAeP5VBotDp9IYTNghGA0JTuSBad5fMk83R0tFUtEcAAGTgJKx8jLBnJ5InVkplbC1SpgSQkGzZBXNVoqrpdrWDH368ZG4jTWZ+M08U6Dq23Hj3NeupYe9aO70gF12q+bG8jP2vbBhL6hlgABT6cZYcagQFExhMwKAAVXhThMxRMwIBITEC1xYtCUoPJJDiCAqXcTw6wZQI83SDkaBEaIgi7XkzFSPtBWFIcxQlbM4MqAB3Hw5UaedlQ6Jcen6Vdb1GDcjm3U1z3dPYvVtCTr1tGZiggAAjHgjCMI5zUPK5j1PASXwDH4cECD8fjoFhk2uZMAC0AC88W4JMzGEdMoOkLMFFzfNsULWyCVLBySXsRwKVsata3pAomVIkIgiilJq27JJKP5fshUHAp6NHCppRqOpZ0VBduLVZc+J1I4DTmAStxNXcxJWaTHzU/cLSPG0z3vB16oCTtdNDHBYhDH51ECMCAHEaAUugADNgKJVNIIkFyYJzBDPKQ/ESyJctKywmkcLCyjG2bRk8xZcie0S6iGhSkUQGHcUMprMAJynGcGjnJUzEXQreO1TcQDK36ROqt1as9GSz3Ui5NJairETqp0QBSX1nlfd5O2Ib4UwAYRSL8MExnA+mmygwKc+bkUYkg8yxHEizWlDQLQjDguwul6325Q6A5JtlBENGNQokAqIFS7aLS4gR0lWCSBYtjcs4j6CvVTVit+/7hKqpA9wPSHrRPI5gcvdr4bvOGnyR/0eroIzsF+PpfmBX4mAUtAibMVMxGc8nsDAHgSOprzkN8kBNspPrQrZm6MmUdJm3SPMmVOhLBaSmjUtFcW7slh6nunbZXryrjVSVlcSrPNWz0BzXYdBjqYYN02Gu1y0ob1n0ngAXXz+XQBIOIMCaORTwm5TIC3ekTyJX1iCuDwi6rnyiQAdQgIwWGkTC9EkWwbEwthEJ0Ww4hIBTOhYWwFIgBUAEIoJ8FgnFOe695Wg+0DAWwSC4WYoFsHgWAMOAthZhwCMOhfgXA9DKFsJjK4LAADW28ri2DVMxd+VxvC2AmpYZBEBmIfziGvBgg9MFrEHGAG+TwgA==="
  )
);
class AudioManager {
  constructor(a) {
    this.muted = !1;
    this.parent = a;
    this.queue = [];
    this.onAgentStateChangeListener = this.onAgentStateChange.bind(this);
    this.onAddedListener = this.onAdded.bind(this);
    this.onContactListener = this.onContact.bind(this);
    this.onRemovedListener = this.onRemoved.bind(this);
    this.onCreateEffectListener = this.onCreateEffect.bind(this);
    this.parent.on(ModelEvent.AGENT_STATE, this.onAgentStateChangeListener);
    this.parent.on(ModelEvent.GAMEOBJECT_ADDED, this.onAddedListener);
    this.parent.on(ModelEvent.GAMEOBJECT_CONTACT, this.onContactListener);
    this.parent.on(ModelEvent.GAMEOBJECT_DELETED, this.onRemovedListener);
    this.parent.on(ModelEvent.CREATE_EFFECT, this.onCreateEffectListener);
  }
  update(a) {
    if (0 !== this.queue.length) {
      var b = this.queue.length;
      for (let c = 0; c < b; c++) {
        let d = this.queue[c];
        d.delay -= a;
        0 >= d.delay &&
          (d.agent.alive && AudioManager.PlayEffect(d.audio, d.agent, !0),
          this.queue.splice(c, 1),
          c--,
          b--);
      }
    }
  }
  clear() {
    this.queue = [];
  }
  mute() {
    Howler.mute(!0);
    this.parent.removeListener(ModelEvent.AGENT_STATE, this.onAgentStateChangeListener);
    this.parent.removeListener(ModelEvent.GAMEOBJECT_ADDED, this.onAddedListener);
    this.parent.removeListener(ModelEvent.GAMEOBJECT_CONTACT, this.onContactListener);
    this.parent.removeListener(ModelEvent.GAMEOBJECT_DELETED, this.onRemovedListener);
    this.parent.removeListener(ModelEvent.CREATE_EFFECT, this.onCreateEffectListener);
    this.muted = !0;
  }
  unmute() {
    Howler.mute(!1);
    this.parent.on(ModelEvent.AGENT_STATE, this.onAgentStateChangeListener);
    this.parent.on(ModelEvent.GAMEOBJECT_ADDED, this.onAddedListener);
    this.parent.on(ModelEvent.GAMEOBJECT_CONTACT, this.onContactListener);
    this.parent.on(ModelEvent.GAMEOBJECT_DELETED, this.onRemovedListener);
    this.parent.on(ModelEvent.CREATE_EFFECT, this.onCreateEffectListener);
    this.muted = !1;
  }
  onAgentStateChange(a) {
    let b = a.agent;
    a = a.state;
    switch (a.s) {
      case StateChange.Item.INIT_USE:
        this.onInitUseFX(b, a.t);
        break;
      case StateChange.Item.USE:
        this.onUseFX(b, a.t);
        break;
      case StateChange.Item.RELOAD:
        if (0 === a.c) this.onReload(b, a.t);
    }
  }
  onAdded(a) {
    if (a.audio && a.audio.onAdded) {
      let c = a.audio;
      for (let d = 0; d < c.onAdded.length; d++) {
        var b = c.onAdded[d];
        b instanceof Array
          ? ((b = b[Math.floor(Math.random() * b.length)]),
            void 0 !== b.volume && b.volume(b.volume),
            AudioManager.PlayEffect(b, a))
          : (void 0 !== b.volume && b.volume(b.volume), AudioManager.PlayEffect(b, a));
      }
    }
  }
  onCreateEffect(a) {
    if (a.type === ParticleEffects.LOCAL_SAW) {
      var b = a.cat;
      b === EntityCategory.LIMB || b === EntityCategory.LOCAL || b === EntityCategory.AGENT
        ? ((b =
            AudioEffects.BodyImpact instanceof Array
              ? AudioEffects.BodyImpact[Math.floor(Math.random() * AudioEffects.BodyImpact.length)]
              : AudioEffects.BodyImpact),
          b.audio.volume(1),
          AudioManager.PlayEffect(b, a.go))
        : ((b = ParticleEffects.ChainsawRaycast[PP.AUDIO]),
          b.audio.volume(1),
          AudioManager.PlayEffect(b, a.go));
    }
  }
  onInitUseFX(a, b) {
    if (!(AudioManager.CamDistance(a.p) > 0.75 * App.ClientWidth)) {
      b = ItemMap[b].onInitUse.audio;
      for (let c = 0, d = b.length; c < d; c++)
        b[c].audio.stereo(AudioManager.Stereo(a.p)), AudioManager.PlayEffect(b[c], a, !0);
    }
  }
  onUseFX(a, b) {
    if (!(AudioManager.CamDistance(a.p) > 0.75 * App.ClientWidth))
      if (((b = ItemMap[b].onUse), 1 === b.audio.length))
        b.audio[0].audio.stereo(AudioManager.Stereo(a.p)),
          b.postUseAudio &&
            this.queue.push({
              audio: b.postUseAudio[0].audio,
              delay: b.postUseAudio[0].delay,
              agent: a,
            }),
          AudioManager.PlayEffect(b.audio[0], a, !0);
      else
        for (let c = 0, d = b.length; c < d; c++)
          b[c].audio.stereo(AudioManager.Stereo(a.p)), AudioManager.PlayEffect(b[c], a, !0);
  }
  onRemoved(a) {
    if (!(AudioManager.CamDistance(a.p) > 0.75 * App.ClientWidth)) {
      var b = a.audio;
      if (b && b.onRemove)
        for (let d = 0; d < b.onRemove.length; d++) {
          var c = b.onRemove[d];
          c instanceof Array
            ? ((c = c[Math.floor(Math.random() * c.length)]),
              c.audio.stereo(AudioManager.Stereo(a.p)),
              c.audio.play())
            : (c.audio.stereo(AudioManager.Stereo(a.p)), c.audio.play());
        }
    }
  }
  onContact(a) {
    if (!(AudioManager.CamDistance(a.go.p) > 0.75 * App.ClientWidth)) {
      var b = a.go.audio;
      if (b) {
        let f = [];
        var c = !1;
        if (b.checkAltContact) {
          if (3 === a.contact.a.body.m_type) c = this.parent.bodies[a.contact.b.body.m_userData];
          else {
            c = a.contact.a.body.m_userData;
            var d = a.contact.b.body.m_userData;
            c = a.go.id === c ? this.parent.bodies[d] : this.parent.bodies[c];
          }
          c && c.audio && c.audio.altContact ? ((f = c.audio.altContact), (c = !0)) : (c = !1);
        }
        !c && b.onContact && (f = b.onContact);
        for (b = 0; b < f.length; b++)
          if (((c = f[b]), c instanceof Array)) {
            c = c[Math.floor(Math.random() * c.length)];
            d = a.go.p;
            if (c.delta) {
              var e = Clamp(0.05, 0.5, 0.4 * Math.sqrt(d.vx * d.vx + d.vy * d.vy));
              c.audio.volume(e);
            }
            c.audio.stereo(AudioManager.Stereo(d));
            c.audio.play();
          } else
            (d = a.go.p),
              c.delta &&
                ((e = Clamp(0.05, 0.5, 0.4 * Math.sqrt(d.vx * d.vx + d.vy * d.vy))),
                c.audio.volume(e)),
              c.audio.stereo(AudioManager.Stereo(d)),
              c.audio.play();
      }
    }
  }
  onReload(a, b) {
    AudioManager.CamDistance(a.p) > 0.75 * App.ClientWidth ||
      void 0 !== ItemMap[b].reloadAudio ||
      (AudioEffects.Reload.audio.stereo(AudioManager.Stereo(a.p)),
      AudioEffects.Reload.audio.play());
  }
}
AudioManager.Cam = null;
AudioManager.CamDistance = function (a) {
  let b = -AudioManager.Cam.x + 0.5 * App.ClientWidth - a.x;
  a = -AudioManager.Cam.y + 0.5 * App.ClientHeight - a.y;
  return Math.sqrt(b * b + a * a);
};
AudioManager.Stereo = function (a) {
  a = ((a.x - (-AudioManager.Cam.x + 0.5 * App.ClientWidth)) / (0.5 * App.ClientWidth)) * 0.5;
  return -1 > a ? -1 : 1 < a ? 1 : a;
};
AudioManager.PlayEffect = function (a, b, c) {
  (!c && AudioManager.CamDistance(b.p) > 0.75 * App.ClientWidth) ||
    (Array.isArray(a) && (a = a[Math.floor(Math.random() * a.length)]),
    a.single
      ? a.audio.playing(b.id)
        ? a.audio.seek() > a.sub_end && a.audio.seek(a.sub_start)
        : a.audio.play()
      : (b.p && a.audio.stereo(AudioManager.Stereo(b.p)), a.audio.play()));
};
var audiofx = {},
  AudioFolder =
    App.WhiteLabel === App.WhiteLabel_POKI
      ? App.RESOURCE_FOLDER + "/audio/"
      : "." + App.RESOURCE_FOLDER + "/audio/",
  AudioEffects = {
    Victory: { audio: new Howl({ src: [AudioFolder + "victory.mp3"] }) },
    ButtonHover: { audio: new Howl({ src: [AudioFolder + "buttonhover.mp3"], volume: 0.2 }) },
    ButtonClick: { audio: new Howl({ src: [AudioFolder + "buttonclick.mp3"], volume: 0.2 }) },
    SMGFire: { audio: new Howl({ src: [AudioFolder + "smg-shot.mp3"] }) },
    MAC10Fire: { audio: new Howl({ src: [AudioFolder + "mac10-shot-1.mp3"], volume: 0.15 }) },
    ShotgunFire: { audio: new Howl({ src: [AudioFolder + "shotgun-shot.mp3"] }) },
    ShotgunPump: { audio: new Howl({ src: [AudioFolder + "sg-pump.mp3"], volume: 0.4 }) },
    BarrettFire: { audio: new Howl({ src: [AudioFolder + "barrett-shot.mp3"], volume: 0.5 }) },
    RifleFire: { audio: new Howl({ src: [AudioFolder + "rifle-shot.mp3"] }) },
    AK47Fire: { audio: new Howl({ src: [AudioFolder + "ak47-shot.mp3"] }) },
    BowFire: { audio: new Howl({ src: [AudioFolder + "bow-shot-1.mp3"], volume: 0.75 }) },
    CarbineFire: { audio: new Howl({ src: [AudioFolder + "carbine-shot-1.mp3"], volume: 0.75 }) },
    ShockrifleFire: { audio: new Howl({ src: [AudioFolder + "shockrifle-shot.mp3"] }) },
    RLRocketFire: { audio: new Howl({ src: [AudioFolder + "rl-launch.mp3"], volume: 0.75 }) },
    DeagleFire: { audio: new Howl({ src: [AudioFolder + "deagle-shot.mp3"] }) },
    FlamethrowerFire: {
      audio: new Howl({ src: [AudioFolder + "flamethrower-shot.mp3"] }),
      single: !0,
      sub_start: 0.3,
      sub_end: 1.4,
    },
    EnergyJetFeet: {
      audio: new Howl({ src: [AudioFolder + "jetfeet.mp3"], volume: 0.5 }),
      single: !0,
      sub_start: 0.2,
      sub_end: 0.66,
    },
    ArrowImpact: [
      { audio: new Howl({ src: [AudioFolder + "arrow-impact-1.mp3"], volume: 0.15 }) },
      { audio: new Howl({ src: [AudioFolder + "arrow-impact-2.mp3"], volume: 0.15 }) },
      { audio: new Howl({ src: [AudioFolder + "arrow-impact-3.mp3"], volume: 0.15 }) },
    ],
    RLImpact: [
      { audio: new Howl({ src: [AudioFolder + "rl-impact-1.mp3"], volume: 0.5 }) },
      { audio: new Howl({ src: [AudioFolder + "rl-impact-2.mp3"], volume: 0.5 }) },
    ],
    X75Fire: { audio: new Howl({ src: [AudioFolder + "x75-shot.mp3"], volume: 0.5 }) },
    X75Impact: [
      { audio: new Howl({ src: [AudioFolder + "x75-impact-1.mp3"], volume: 0.5 }) },
      { audio: new Howl({ src: [AudioFolder + "x75-impact-2.mp3"], volume: 0.5 }) },
      { audio: new Howl({ src: [AudioFolder + "x75-impact-3.mp3"], volume: 0.5 }) },
    ],
    Walk: { audio: new Howl({ src: [AudioFolder + "walk-1.mp3"], volume: 1.5 }) },
    Flip: { audio: new Howl({ src: [AudioFolder + "flip-1.mp3"] }) },
    Tap: { audio: new Howl({ src: [AudioFolder + "metal-tap.mp3"] }), delta: 0.5 },
    ChainsawNeutral: { audio: new Howl({ src: [AudioFolder + "chainsaw-neutral.mp3"] }) },
    ChainsawEngaged: {
      audio: new Howl({ src: [AudioFolder + "chainsaw-engaged.mp3"] }),
      single: !0,
      sub_start: 0.4,
      sub_end: 0.7,
    },
    MinigunEngaged: {
      audio: new Howl({ src: [AudioFolder + "minigun.mp3"] }),
      single: !0,
      sub_start: 0.64,
      sub_end: 0.96,
      immediate: !0,
    },
    Fly: {
      audio: new Howl({ src: [AudioFolder + "fly.mp3"] }),
      single: !0,
      sub_start: 0.2,
      sub_end: 1.1,
    },
    ExplosionCluster: [
      { audio: new Howl({ src: [AudioFolder + "explosion-cluster-1.mp3"], volume: 0.75 }) },
      { audio: new Howl({ src: [AudioFolder + "explosion-cluster-2.mp3"] }) },
    ],
    ExplosionNade: [
      { audio: new Howl({ src: [AudioFolder + "explosion-nade.mp3"], volume: 0.5 }) },
    ],
    ExplosionNadeLauncher: [
      { audio: new Howl({ src: [AudioFolder + "explosion-1.mp3"], volume: 0.5 }) },
    ],
    ShurikenDrop: {
      audio: new Howl({ src: [AudioFolder + "shuriken-drop.mp3"] }),
      delta: 0.1,
      single: !0,
    },
    LawLaunch: { audio: new Howl({ src: [AudioFolder + "law-launch.mp3"] }) },
    NadeLauncher: { audio: new Howl({ src: [AudioFolder + "nadelauncher.mp3"] }) },
    Reload: { audio: new Howl({ src: [AudioFolder + "reloading.mp3"] }) },
    AmmoPickup: [{ audio: new Howl({ src: [AudioFolder + "ammo-pickup-1.mp3"], volume: 0.8 }) }],
    RicochetTiny: { audio: new Howl({ src: [AudioFolder + "ricochet-1.mp3"] }) },
    Thud: [
      { audio: new Howl({ src: [AudioFolder + "impact-1.mp3"] }), delta: 1 },
      { audio: new Howl({ src: [AudioFolder + "impact-2.mp3"] }), delta: 1 },
    ],
    LightThud: {
      audio: new Howl({ src: [AudioFolder + "light-thud.mp3"], volume: 0.5 }),
      delta: 0.1,
    },
    HeavyThud: { audio: new Howl({ src: [AudioFolder + "heavy-thud.mp3"] }), delta: 1 },
    LaserGunShot1: { audio: new Howl({ src: [AudioFolder + "lasergun-shot-1.mp3"] }) },
    LaserGunImpact: [
      { audio: new Howl({ src: [AudioFolder + "laser-impact-2.mp3"] }) },
      { audio: new Howl({ src: [AudioFolder + "laser-impact-3.mp3"] }) },
    ],
    LaserImpact1: { audio: new Howl({ src: [AudioFolder + "laser-impact-1.mp3"] }) },
    PulseGunShot: { audio: new Howl({ src: [AudioFolder + "lasergun-shot-3.mp3"] }) },
    BotZap: { audio: new Howl({ src: [AudioFolder + "bot-zap.mp3"] }) },
    BotDeath: { audio: new Howl({ src: [AudioFolder + "explosion-cluster-1.mp3"] }) },
    LinkGunEngaged: {
      audio: new Howl({ src: [AudioFolder + "linkgun-engaged.mp3"], volume: 0.5 }),
      single: !0,
      sub_start: 0.05,
      sub_end: 0.15,
    },
    PulseGunImpact: {
      audio: new Howl({ src: [AudioFolder + "laser-impact-4.mp3"], volume: 0.25 }),
    },
    Rico: [
      { audio: new Howl({ src: [AudioFolder + "rico-1.mp3"], volume: 0.25 }) },
      { audio: new Howl({ src: [AudioFolder + "rico-2.mp3"], volume: 0.25 }) },
      { audio: new Howl({ src: [AudioFolder + "rico-3.mp3"], volume: 0.25 }) },
    ],
    BodyImpact: [
      { audio: new Howl({ src: [AudioFolder + "body-impact-1.mp3"], volume: 0.25, delta: 0.1 }) },
      { audio: new Howl({ src: [AudioFolder + "body-impact-2.mp3"], volume: 0.25, delta: 0.1 }) },
      { audio: new Howl({ src: [AudioFolder + "body-impact-3.mp3"], volume: 0.25, delta: 0.1 }) },
      { audio: new Howl({ src: [AudioFolder + "body-impact-4.mp3"], volume: 0.25, delta: 0.1 }) },
    ],
    Throw: [
      { audio: new Howl({ src: [AudioFolder + "throw-1.mp3"], volume: 0.25 }) },
      { audio: new Howl({ src: [AudioFolder + "throw-2.mp3"], volume: 0.25 }) },
    ],
    WaterSplash: [
      { audio: new Howl({ src: [AudioFolder + "splash-1.mp3"], volume: 0.2 }) },
      { audio: new Howl({ src: [AudioFolder + "splash-2.mp3"], volume: 0.2 }) },
      { audio: new Howl({ src: [AudioFolder + "splash-3.mp3"], volume: 0.2 }) },
    ],
    SnowballImpact: [
      { audio: new Howl({ src: [AudioFolder + "snowball-impact-1.mp3"], volume: 0.35 }) },
      { audio: new Howl({ src: [AudioFolder + "snowball-impact-2.mp3"], volume: 0.35 }) },
      { audio: new Howl({ src: [AudioFolder + "snowball-impact-3.mp3"], volume: 0.35 }) },
    ],
    GoldPickup: [
      { audio: new Howl({ src: [AudioFolder + "gold-pickup-1.mp3"], volume: 0.75 }) },
      { audio: new Howl({ src: [AudioFolder + "gold-pickup-2.mp3"], volume: 0.75 }) },
      { audio: new Howl({ src: [AudioFolder + "gold-pickup-3.mp3"], volume: 0.75 }) },
    ],
    GoldDrop: { audio: new Howl({ src: [AudioFolder + "gold-drop-1.mp3"], volume: 0.1 }) },
    Objective: { audio: new Howl({ src: [AudioFolder + "flag-cap.mp3"], volume: 0.5 }) },
    GrabObjective: { audio: new Howl({ src: [AudioFolder + "flag-grab.mp3"], volume: 0.7 }) },
    Powerup: { audio: new Howl({ src: [AudioFolder + "powerup.mp3"], volume: 0.25 }) },
    Teleport: { audio: new Howl({ src: [AudioFolder + "teleport.mp3"], volume: 0.5 }) },
    Spawn: { audio: new Howl({ src: [AudioFolder + "spawn.mp3"], volume: 0.2 }) },
    Jump: { audio: new Howl({ src: [AudioFolder + "jump.mp3"], volume: 0.5 }) },
    ItemSpawn: { audio: new Howl({ src: [AudioFolder + "item-spawn.mp3"], volume: 0.3 }) },
    BallBounce: { audio: new Howl({ src: [AudioFolder + "ball-bounce.mp3"], volume: 0.3 }) },
  };
var background = {};
class Background extends PIXI.Graphics {
  constructor(a = 6, b = 10, c = 500, d = 150, e = 200, f = 150) {
    super();
    this.mountains = a;
    this.amplitude = b;
    this.stepWidth = c;
    this.stepHeight = d;
    this.varyX = e;
    this.varyY = f;
    this.lastY = this.lastX = 0;
  }
  setup(a = 6, b = 10, c = 500, d = 150, e = 200, f = 150) {
    this.mountains = a;
    this.amplitude = b;
    this.stepWidth = c;
    this.stepHeight = d;
    this.varyX = e;
    this.varyY = f;
    this.lastY = this.lastX = 0;
  }
  center(a, b) {
    this.x = 0.2 * a;
    this.y = 0.2 * b;
  }
  update(a) {
    let b = a.x - this.lastX,
      c = a.y - this.lastY;
    this.lastX = a.x;
    this.lastY = a.y;
    this.y = -1500 > this.y + 0.2 * c ? -1500 : this.y + 0.2 * c;
    this.x += 0.2 * b;
  }
  draw(a, b) {
    if (0 !== b && 16777215 !== b) {
      this.clear();
      var c = 0,
        d = 600;
      switch (a) {
        case "dust":
          this.amplitude = 3;
          this.varyX = 200;
          this.varyY = 30;
          this.stepWidth = 500;
          this.stepHeight = 50;
          d = 400;
          break;
        case "stars":
          this.amplitude = 10;
          this.varyX = 200;
          this.varyY = 150;
          this.stepWidth = 500;
          this.stepHeight = 150;
          break;
        default:
          (this.amplitude = 10),
            (this.varyX = 200),
            (this.varyY = 150),
            (this.stepWidth = 500),
            (this.stepHeight = 150);
      }
      a = 4 + 4 * Math.random();
      a = Background.ChangeBrightness(b, -a, 0.5);
      this.generate(a, c, d, 1, 4);
      c += 200;
      d += 150;
      a = 14 + 4 * Math.random();
      a = Background.ChangeBrightness(b, -a, 1);
      this.generate(a, c, d, 1, 5);
    }
  }
  generate(a, b, c, d = 1, e = 5) {
    var f = this.stepWidth;
    let g = this.stepHeight,
      h = [],
      m = [],
      n = (b -= 0.5 * (this.mountains * f - 0.5 * App.ClientWidth));
    for (let k = 0; k < this.mountains; k++) {
      var l = f + (-this.varyX + Math.random() * this.varyX * 2);
      let p = { x: n, y: c },
        r = { x: n + 0.5 * l, y: c - (g + (-this.varyY + Math.random() * this.varyY * 2)) };
      l = { x: n + l, y: c + (-this.varyY + Math.random() * this.varyY * 2) };
      n = l.x;
      c = l.y;
      h.push([p, r], [r, l]);
    }
    for (f = 0; f < e; f++) h = this.subdivide(h, this.amplitude);
    for (e = 0; e < h.length; e++) m.push(h[e][0], h[e][1]);
    m.push({ x: n + 1e3, y: c + 2e3 });
    m.push({ x: b - 1e3, y: c + 2e3 });
    this.beginFill(a, d);
    this.drawPolygon(m);
    this.endFill();
  }
  subdivide(a, b) {
    let c = [];
    for (let e = 0; e < a.length; e++) {
      var d = a[e];
      let f = d[0];
      d = d[1];
      let g = { x: f.x + 0.5 * (d.x - f.x), y: f.y + 0.5 * (d.y - f.y) };
      g.y += -b + Math.random() * b * 2;
      c.push([f, g], [g, d]);
    }
    return c;
  }
}
Background.ChangeBrightness = function (a, b) {
  let c = (a >> 16) + b;
  255 < c ? (c = 255) : 0 > c && (c = 0);
  let d = ((a >> 8) & 255) + b;
  255 < d ? (d = 255) : 0 > d && (d = 0);
  a = (a & 255) + b;
  255 < a ? (a = 255) : 0 > a && (a = 0);
  return a | (d << 8) | (c << 16);
};
class Camera {
  constructor() {
    this.y = this.x = 0;
    this.target = null;
    this.shaking = 0;
    this.scale = 1.8;
    this.tracking = !1;
  }
  position(a, b) {
    this.x = a;
    this.y = b;
  }
  move(a, b) {
    this.x += a;
    this.y += b;
  }
  shake(a) {
    a = a || this.shaking;
    let b = 0.5 * a,
      c = -a + Math.random() * a * 2,
      d = -a + Math.random() * a * 2;
    this.x += Math.abs(c) < b ? (0 > c ? -b : b) : c;
    this.y += Math.abs(d) < b ? (0 > d ? -b : b) : d;
    this.shaking = 0 < a - 0.1 ? a - 0.1 : 0;
  }
  jerk(a, b) {
    this.x += a * Math.cos(b);
    this.y += a * Math.sin(b);
  }
}
var gradient = {};
class Gradient extends PIXI.Graphics {
  constructor(a, b) {
    super();
    this.w = a;
    this.h = b;
    this.c1 = "#729fcf";
    this.c2 = "#204a87";
    this.drawTimeout = null;
  }
  resize(a, b) {
    this.w = a;
    this.h = b;
    this.colors(this.c2, this.c1);
  }
  colors(a, b) {
    this.c1 = b;
    this.c2 = a;
    null !== this.drawTimeout && (clearTimeout(this.drawTimeout), (this.drawTimeout = null));
    this.drawTimeout = setTimeout(() => {
      this.parent && this.draw();
    }, 100);
  }
  draw() {
    !1 !== this.generateGradientTexture() &&
      (this.clear(),
      this.beginTextureFill({ texture: this.generateGradientTexture() }),
      this.drawRect(0, 0, this.w, this.h, 8),
      this.endFill());
  }
  offset(a) {}
  generateGradientTexture() {
    const a = document.createElement("canvas");
    a.width = this.w;
    a.height = this.h;
    const b = a.getContext("2d");
    if (null === b) return !1;
    let c = b.createLinearGradient(0, 0, 0, this.h);
    c.addColorStop(0, this.c1);
    c.addColorStop(1, this.c2);
    b.fillStyle = c;
    b.fillRect(0, 0, this.w, this.h);
    return PIXI.Texture.from(a);
  }
}
var canvas = {};
class Canvas extends PIXI.utils.EventEmitter {
  constructor() {
    super();
    this.settings = Registry.Instance[Registry.Key.SETTINGS];
    this.manager = null;
    this.displayed = [];
    this.dynamicObjects = {};
    this.emitters = {};
    this.players = {};
    this.dissolve = [];
    this.staticBuffer = [];
    this.lineSegments = [];
    this.fb = null;
    this.onStaticObjectAddedBinding = this.onStaticObjectAdded.bind(this);
    this.onGameObjectAddedBinding = this.onGameObjectAdded.bind(this);
    this.gradient = new Gradient(App.ClientWidth, App.ClientHeight);
    this.gradient.interactive = !0;
    this.world = new PIXI.Container();
    this.parallax = new Parallax();
    this.background = new Background();
    this._1 = new PIXI.Container();
    this._2 = new PIXI.Graphics();
    this._3 = new PIXI.Container();
    this._4 = new PIXI.Container();
    this._5 = new PIXI.Container();
    this._2.lineStyle(3, 0, 0.2);
    this.bgParticleContainer = new ParticleContainer();
    this.fgParticleContainer = new ParticleContainer();
    this.world.addChild(this._1);
    this.world.addChild(this.bgParticleContainer);
    this.world.addChild(this._2);
    this.world.addChild(this._3);
    this.world.addChild(this._4);
    this.world.addChild(this._5);
    this.world.addChild(this.fgParticleContainer);
    this.labelContainer = new LabelContainer();
    this.fxMap = {
      [ParticleEffects.LOCAL_PUNCH]: this.punchFx.bind(this),
      [ParticleEffects.LOCAL_EXP]: this.explosionFx.bind(this),
      [ParticleEffects.LOCAL_SAW]: this.sawFx.bind(this),
      [ParticleEffects.LOCAL_LINK_GUN]: this.linkGunFx.bind(this),
    };
    this.world.filterArea = App.Renderer.screen;
    this.energyBoundaryRadius = 5e6;
    this.hasEnergyBoundary = !1;
    this.staticEmitters = {};
    this.background.interactiveChildren = !1;
    this.parallax.interactiveChildren = !1;
    this.world.interactiveChildren = !1;
    this.labelContainer.interactiveChildren = !1;
    this.layers = [this.gradient, this.background, this.parallax, this.world, this.labelContainer];
    this.ropes = {};
    this.cam = new Camera();
    this.cam.scale =
      1.6 / (App.ClientWidth > App.ClientHeight ? 1920 / App.ClientWidth : 1080 / App.ClientHeight);
    this.mouse = { x: 0.5 * App.ClientWidth, y: 0.5 * App.ClientHeight };
    this.frameCount = 0;
    this.rightdown = !1;
    this.lineSize = 0.6 * PC.PM_RATIO;
    this.minDelta = 0.8 * PC.PM_RATIO;
    this.setBackgroundGradient("000000", "265d93", -2e3, 2e3);
    this.zoomFunction = null;
    App.Stage.on("mousemove", (a) => this.onMouseMove(a));
    App.Stage.on("mouseup", (a) => this.onMouseUp(a));
    App.Stage.on("mousedown", (a) => this.onMouseDown(a));
    App.TransformedMouseX = this.mouse.x / this.cam.scale;
    App.TransformedMouseY = this.mouse.y / this.cam.scale;
    App.WindowResized = !0;
    this.gradient.on("rightdown", this.onRightDown.bind(this));
    this.gradient.on("rightup", this.onRightUp.bind(this));
    this.gradient.interactive = !0;
  }
  setManager(a) {
    this.manager = a;
    a.on(ModelEvent.ENERGY_RADIUS, this.onEnergyRadiusChange.bind(this));
    a.on(ModelEvent.GAMEOBJECT_ADDED, this.onStaticObjectAddedBinding);
    a.on(ModelEvent.GAMEOBJECT_DELETED, this.onGameObjectRemoved.bind(this));
    a.on(ModelEvent.GAMEOBJECT_CONTACT, this.onGameObjectContact.bind(this));
    a.on(ModelEvent.UPDATE_LABEL, (b) => this.labelContainer.onUpdateLabel(b));
    a.on(ModelEvent.REMOVE_LABEL, (b) => this.labelContainer.onRemoveLabel(b));
    a.on(ModelEvent.AGENT_STATE, this.onAgentStateChange.bind(this));
    a.on(ModelEvent.CLEAR, this.onClear.bind(this));
    a.on(ModelEvent.PLAYER_SCORE, this.onPlayerScore.bind(this));
    a.on(ModelEvent.CREATE_EFFECT, (b) => this.fxMap[b.type](b));
    a.on(ModelEvent.UPDATE_ENVIRONMENT, this.onUpdateEnvironment.bind(this));
    a.on(ModelEvent.FOCUS, this.onFocus.bind(this));
    a.on(ModelEvent.PLAYER_DEATH, this.onPlayerDeath.bind(this));
    a.on(ModelEvent.PLAYER_COMBO, this.onPlayerCombo.bind(this));
    a = 1;
    a = App.ClientWidth > App.ClientHeight ? 1920 / App.ClientWidth : 1080 / App.ClientHeight;
    this.gradient.hitArea = new PIXI.Rectangle(0, 0, App.ClientWidth * a, App.ClientHeight * a);
  }
  onEnergyRadiusChange(a) {
    this.hasEnergyBoundary ||
      ((this.energyBoundary = new PIXI.Graphics()),
      this.energyBoundary.lineStyle(10, 0, 0, 0),
      this.energyBoundary.drawCircle(0, 0, 1e3),
      this.energyBoundary.endFill(),
      (this.energyBoundary.width = this.energyBoundary.height = 2 * this.energyBoundaryRadius),
      this.world.addChild(this.energyBoundary),
      (this.hasEnergyBoundary = !0));
    this.energyBoundaryRadius = a;
    this.energyBoundary.width = this.energyBoundary.height = 40 * a;
  }
  initDMVictoryAnimation(a) {
    this.zoomFunction = () => {
      5 > this.cam.scale
        ? ((this.cam.scale += 0.002),
          this.emit(CanvasEvent.SCALE, this.cam.scale),
          (this.parallax.scale.x = this.parallax.scale.y = 1))
        : (this.zoomFunction = null);
    };
    this.cam.target = a;
  }
  initCTFVictoryAnimation(a) {
    this.zoomFunction = () => {
      5 > this.cam.scale
        ? ((this.cam.scale += 0.002),
          this.emit(CanvasEvent.SCALE, this.cam.scale),
          (this.parallax.scale.x = this.parallax.scale.y = 1))
        : (this.zoomFunction = null);
    };
    this.cam.target = a;
  }
  endVictoryAnimation() {
    this.zoomFunction && (this.zoomFunction = null);
    this.cam.tracking = !1;
    this.cam.target = null;
    App.WindowResized = !0;
  }
  onUpdateEnvironment(a) {
    if (a) {
      var b = a.weather;
      a = a.gradient;
      this.setBackgroundGradient(a.topColor, a.bottomColor, a.topY, a.bottomY);
      this.setParallax(b);
      this.background.center(0, 0.5 * (parseInt(a.topY) - parseInt(a.bottomY)));
      this.background.draw(b.precipitation.type, parseInt(a.topColor, 16));
      a = this.background.parent.getChildIndex(this.background);
      var c = this.parallax.parent.getChildIndex(this.parallax);
      "stars" === b.precipitation.type
        ? c > a && this.background.parent.setChildIndex(this.background, c)
        : c < a && this.parallax.parent.setChildIndex(this.parallax, a);
    }
  }
  setBackgroundGradient(a, b, c, d) {
    this.gradient.minY = parseInt(d);
    this.gradient.maxY = parseInt(c);
    this.gradient.colors("#" + a, "#" + b);
  }
  setParallax(a) {
    this.parallax.initialize(a);
  }
  onPlayerDeath(a) {
    let b = a.victim;
    var c = a.killer;
    (a = a.local) &&
      c.sid === a &&
      b.sid !== a &&
      ((c = ParticleEffects.XP10),
      (c.origin = 4),
      (c.point = { x: b.p.x / PC.PM_RATIO, y: b.p.y / PC.PM_RATIO }),
      (c.n = 1),
      this.createEffect(c, b));
  }
  onPlayerCombo() {}
  initial() {
    this.manager.removeListener(ModelEvent.GAMEOBJECT_ADDED, this.onStaticObjectAddedBinding);
    this.manager.on(ModelEvent.GAMEOBJECT_ADDED, this.onGameObjectAddedBinding);
    this.processStaticBuffer();
  }
  onStaticObjectAdded(a) {
    let b = BaseSprite.Create(a);
    if (b && ((a.visual = b), a.update(), a.visual.update && a.visual.update(), a.at))
      for (let d = 0; d < a.at.length; d++) {
        var c = a.at[d];
        switch (c.type) {
          case GameAttribute.EMITTER:
            c = new ParticleEmitter(
              a,
              [ParticleEffects[c.et]],
              null,
              parseFloat(c.f),
              0,
              -1,
              parseFloat(c.p),
              parseFloat(c.w),
              parseFloat(c.h)
            );
            0 === a.p.type || 1 === a.p.type
              ? (void 0 === this.staticEmitters[a.id] && (this.staticEmitters[a.id] = []),
                this.staticEmitters[a.id].push({ go: a, emitter: c }))
              : this.addEmitter(a, c);
            break;
          case GameAttribute.LABEL:
            let e = new PIXI.Text(c.text, {
              fontFamily: "Arial",
              fontSize: c.size + "px",
              align: "center",
              fill: parseInt(c.color, 16),
              fontWeight: "bold",
              stroke: "black",
              strokeThickness: 1,
              lineJoin: "round",
            });
            e.tint = parseInt(c.color, 16);
            e.anchor.x = 0.5;
            e.anchor.y = 0.5;
            e.resolution = 2;
            b.addChild(e);
        }
      }
    this.addStaticObject(a);
  }
  onGameObjectAdded(a) {
    if (a.isPlayer) this.addPlayer(a);
    else {
      if (a.p.prefab) {
        a.visual = SpriteFactory.CreateSprite(a.g);
        a.update();
        if (void 0 !== a.g.emitters)
          for (var b = 0; b < a.g.emitters.length; b++) {
            var c = a.g.emitters[b];
            c.parent = a;
            this.addEmitter(a, c);
          }
        if (void 0 !== a.g.trails)
          for (b = 0; b < a.g.trails.length; b++) this.createRope(a, a.g.trails[b]);
      } else if ((b = BaseSprite.Create(a)))
        if (((a.visual = b), a.update(), a.visual.update && a.visual.update(), a.at))
          for (b = 0; b < a.at.length; b++)
            switch (((c = a.at[b]), c.type)) {
              case GameAttribute.EMITTER:
                let d = new ParticleEmitter(a, [ParticleEffects[c.et]]);
                d.probability = parseFloat(c.p);
                d.frequency = parseFloat(c.f);
                d.width = parseFloat(c.w);
                d.height = parseFloat(c.h);
                this.addEmitter(a, d);
            }
      this.addDynamicObject(a);
    }
    if (a.g.onAdd) this.onAddFX(a);
  }
  processStaticBuffer() {
    let a = this.staticBuffer.length;
    if (0 !== a) {
      this.fb = new Flatbush(a);
      for (var b = 0; b < a; b++) {
        var c = this.staticBuffer[b];
        let d = c.visual.x + c.bounds.x,
          e = c.visual.y + c.bounds.y;
        this.fb.add(d, e, d + c.bounds.width, e + c.bounds.height);
      }
      a = this.lineSegments.length;
      for (b = 0; b < a; b++)
        (c = this.lineSegments[b]),
          ParticleContainer.AddLineSegment(c),
          (1 !== c.l && 4 !== c.l) || this.addLineSegment(c);
      this.fb.finish();
      ParticleContainer.ProcessCollisionMesh();
    }
  }
  addPlayer(a) {
    for (let b = 0; 11 > b; b++) {
      let c = a.bodyparts[b];
      c.visual.z = 500 + b;
      this.addDynamicObject(c);
    }
    this.addDynamicObject(a);
    a.onRequestCreateRope = this.createRope.bind(this);
    a.onRequestCreateEffect = this.createEffect.bind(this);
    a.onRequestCreateEmitter = this.addEmitter.bind(this, a);
    a.onRequestRemoveEmitter = this.removeEmitter.bind(this, a);
    this.labelContainer.addLabel(a.id, a, a.torsoupper, {
      text: a.name,
      size: 14,
      alpha: 0.8,
      color: "#A8DBFB",
    });
    a.onSpawn();
    a.update(!0);
    a.isLocal && this.labelContainer.setVisibleTeam(a.team);
    this.players[a.id] = a;
  }
  addDynamicObject(a) {
    a.visual &&
      ((a.visual.layer = "_3"),
      (this.dynamicObjects[a.id] = a),
      this._3.addChild(a.visual),
      void 0 !== a.g.z && (a.visual.z = a.g.z),
      a.p.bullet || this.applyZIndex(a));
  }
  addStaticObject(a) {
    a.visual &&
      ((a.visual.layer = "_" + Math.ceil((a.g.z + 0.1) / 200)),
      (a.visual.z = a.g.z),
      this.staticBuffer.push(a));
    if (!a.p.s) {
      var b = BaseSprite.ExtractOutline(a);
      if (0 < b.length) {
        a = Math.ceil((a.g.z + 0.1) / 200);
        for (let c = 0; c < b.length; c++) {
          let d = b[c];
          d.l = a;
          this.isOverlappingLineSegment(d) || this.lineSegments.push(d);
        }
      }
    }
  }
  isOverlappingLineSegment(a, b = 16) {
    for (let c = 0, d = this.lineSegments.length; c < d; c++) {
      let e = this.lineSegments[c],
        f = e.x1 - a.x1,
        g = e.y1 - a.y1;
      if (f * f + g * g > b)
        if (((f = e.x1 + e.x2 - a.x1), (g = e.y1 + e.y2 - a.y1), f * f + g * g > b)) continue;
        else {
          if (((f = e.x1 - (a.x1 + a.x2)), (g = e.y1 - (a.y1 + a.y2)), f * f + g * g > b)) continue;
        }
      else if (
        ((f = e.x1 + e.x2 - (a.x1 + a.x2)), (g = e.y1 + e.y2 - (a.y1 + a.y2)), f * f + g * g > b)
      )
        continue;
      this.lineSegments.splice(c, 1);
      return !0;
    }
    return !1;
  }
  addLineSegment(a) {
    this._2.moveTo(a.x1, a.y1);
    this._2.lineTo(a.x2 + a.x1, a.y2 + a.y1);
  }
  onAgentStateChange(a) {
    let b = a.agent;
    a = a.state;
    switch (a.s) {
      case StateChange.Item.USE:
        this.onUseFX(b, a.t);
        if (b.primaryItem && b.primaryItem.onUse) b.primaryItem.onUse();
        break;
      case StateChange.Agent.ALIVE:
        if (!b.alive)
          for (let c in b.ragdoll)
            if (((a = b.ragdoll[c]), !a.attached)) {
              let d = new ParticleEmitter(null, [ParticleEffects.GoreTrail]);
              d.parent = a;
              d.probability = 0.3;
              d.ttl = 140 + Math.round(80 * Math.random());
              d.sub = [ParticleEffects.GoreTrailWater];
              this.addEmitter(a, d);
            }
    }
  }
  onPlayerScore(a) {
    a = a.player;
    let b = new ParticleEmitter(
      a,
      [ParticleEffects.CaptureObjectiveParticles],
      null,
      1,
      1,
      50,
      1,
      40,
      60
    );
    this.addEmitter(a, b);
  }
  onGameObjectRemoved(a) {
    if (a.g.onTrigger && a.triggered) this.onTriggerFX(a);
    if (a.g.onRemove) this.onRemoveFX(a);
    if (a.g.onRemoveContact) this.onRemoveContactFX(a);
    if (2 === a.p.type || 1 === a.p.type) {
      if (a.isPlayer) {
        let b = Date.now().toString();
        a.stopJetting();
        a.onDissolve();
        for (let c in a.ragdoll) {
          let d = a.ragdoll[c];
          delete this.emitters[d.id];
          delete this.dynamicObjects[d.id];
          let e = d.id + b;
          d.id = e;
          this.dynamicObjects[e] = d;
          this.dissolve.push(d);
          this.addEmitter(
            d,
            new ParticleEmitter(
              d,
              [ParticleEffects.Dissolve, ParticleEffects.DissolveElectric],
              null,
              4,
              1,
              100,
              0.5,
              0,
              0,
              16777215,
              1
            )
          );
        }
        delete this.players[a.id];
      }
      this.removeDynamicObject(a);
    } else this.removeStaticObject(a);
  }
  onGameObjectContact(a) {
    let b = a.go,
      c = a.contact;
    if (
      b.g.onContact &&
      (this.onContactFX(b, c) && b.g.onRemoveContact && (b.g.onRemoveContact = null),
      b.g.hideOnContact && (this.dynamicObjects[b.id].visual.alpha = 0),
      b.contact && b.contact.damage)
    ) {
      if (a.target)
        if (a.target.isPlayer) this.onPlayerDamage(a.target, b, a.ref.id, c);
        else {
          if (a.target.p.isBot) this.onBotDamage(a.target, b, c);
        }
      else if (void 0 != c.a.body._parent)
        this.onPlayerDamage(this.dynamicObjects[c.a.body._parent], b, c.a.ref.id, c);
      else if (void 0 != c.b.body._parent)
        this.onPlayerDamage(this.dynamicObjects[c.b.body._parent], b, c.b.ref.id, c);
      else if (c.a.body.isBot) this.onBotDamage(c.a.body, b, c);
      else if (c.b.body.isBot) this.onBotDamage(c.b.body, b, c);
      return;
    }
    b.isPlayer &&
      ((a = ParticleEffects.BounceImpact),
      (a.origin = 4),
      (a.point = c.p),
      (a.n = 3),
      this.createEffect(a, b));
  }
  onPlayerDamage(a, b, c, d) {
    if (void 0 !== a) {
      if (b.g.onImpact)
        for (let e = 0; e < b.g.onImpact.length; e++) {
          let f = b.g.onImpact[e];
          f.parent = a.ragdoll[c];
          this.addEmitter(f.parent, f);
        }
      if (void 0 !== d.o && void 0 !== d.tr && d.o.team !== d.tr.team && (a = a.addInjury(c, 0)))
        for (b = 0; b < a.length; b++) this.addEmitter(a[b].parent, a[b]);
    }
  }
  onBotDamage(a, b, c) {
    if (b.g.onImpact)
      for (let d = 0; d < b.g.onImpact.length; d++) {
        let e = b.g.onImpact[d];
        e.parent = a;
        this.addEmitter(e.parent, e);
      }
    if (a.g.onDamage)
      for (b = 0; b < a.g.onDamage.length; b++) this.createEffect(a.g.onDamage[b], a, c);
  }
  addEmitter(a, b) {
    if (a && !b.attached) {
      if (void 0 !== b.id)
        if (void 0 === a.g.emitterIds) a.g.emitterIds = [b.id];
        else if (-1 !== a.g.emitterIds.indexOf(b.id)) return;
      b.attached = !0;
      var c = this.emitters[a.id];
      c || ((c = this.emitters[a.id] = []), (c.id = a.id));
      c.push(b);
    }
  }
  updateEmitters(a) {
    let b = this.emitters[a.id],
      c = 0;
    if (b) {
      let d = b.length;
      for (; 0 < d; ) {
        let e = b[--d];
        if (-1 !== e.ttl && 0 === e.ttl)
          b.splice(d, 1),
            void 0 !== e.id && a.g.emitterIds.splice(a.g.emitterIds.indexOf(e.id), 1),
            c++,
            0 === b.length && delete this.emitters[a.id];
        else if ((e.ttl--, e.count++ === e.frequency)) {
          e.count = 0;
          let f = e.sub ? (e.parent.p.sub ? e.sub : e.emits) : e.emits;
          if (void 0 !== f.length)
            for (let g = 0; g < f.length; g++) {
              if (1 > e.probability && e.probability < Math.random()) continue;
              let h = f[g];
              h.offset = e.area
                ? {
                    x: e.offset.x - 0.5 * e.width + Math.random() * e.width,
                    y: e.offset.y - 0.5 * e.height + Math.random() * e.height,
                  }
                : e.offset;
              void 0 !== e.tint && (h.tt = e.tint);
              this.createEffect(h, e.parent);
            }
          else
            (f.offset = e.area
              ? {
                  x: e.offset.x - 0.5 * e.width + Math.random() * e.width,
                  y: e.offset.y - 0.5 * e.height + Math.random() * e.height,
                }
              : e.offset),
              void 0 !== e.tint && (f.tt = e.tint),
              this.createEffect(f, e.parent);
        }
      }
    }
    return c;
  }
  removeEmitter(a, b) {
    let c = this.emitters[a.id];
    c &&
      (void 0 !== b.id && a.g.emitterIds.splice(a.g.emitterIds.indexOf(b.id), 1),
      (b.attached = !1),
      (b = c.indexOf(b)),
      c.splice(b, 1),
      0 === c.length && delete this.emitters[a.id]);
  }
  requestLocalObject(a, b) {
    var c = { l: a.local };
    a.p1
      ? ((c.p1 = a.p1), (c.p2 = a.p2))
      : (a.exp && (c.exp = a.exp), (c.x = b.p.x / PC.PM_RATIO), (c.y = b.p.y / PC.PM_RATIO));
    1 === a._r && (c.r = Math.random() * Math.PI * 2);
    if (1 === a._v) {
      if (((c.vx = b.p.vx), (c.vy = b.p.vy), a.randV)) {
        var d = a.randV;
        c.vx += d.minX + Math.random() * d.rangeX;
        c.vy += d.minY + Math.random() * d.rangeY;
      }
    } else
      a.randV &&
        ((d = a.randV),
        (c.vx = d.minX + Math.random() * d.rangeX),
        (c.vy = d.minY + Math.random() * d.rangeY));
    a.vrs && (c.vr = a.vrs.min + Math.random() * a.vrs.max);
    c = { ttl: a.ttl, pr: a.prefab, p: c };
    a.type && ((c.type = a.type), (c.id = b.id));
    this.emit(CanvasEvent.REQUEST_LOCAL_OBJECT, c);
  }
  onSubmerge(a) {
    let b = a.go;
    if (a.splash && !a.ss) {
      a = ParticleEffects.WaterSplash;
      for (let c = 0; 4 > c; c++)
        (a.origin = 4),
          (a.point = { x: b.p.x / PC.PM_RATIO, y: (b.p.y + (b.isPlayer ? 20 : 0)) / PC.PM_RATIO }),
          (a.n = 1),
          this.createEffect(a, b);
    }
    if (void 0 !== b.p.prefab || b.isPlayer)
      (a = new ParticleEmitter(b, [ParticleEffects.WaterBubbles], null, 1, 1, -1, 1, 30, 30)),
        void 0 === b._bubbles && ((b._bubbles = a), this.addEmitter(b, a));
  }
  onSurface(a) {
    let b = a.go;
    if (a.splash) {
      a = ParticleEffects.WaterSplashExit;
      for (let c = 0; 4 > c; c++)
        (a.origin = 4),
          (a.point = {
            x: (b.p.x - 0.2 * b.p.vx) / PC.PM_RATIO,
            y: (b.p.y + (b.isPlayer ? 20 : 0) - 0.2 * b.p.vy) / PC.PM_RATIO,
          }),
          (a.n = 3),
          this.createEffect(a, b);
    }
    void 0 !== b._bubbles && (this.removeEmitter(b, b._bubbles), delete b._bubbles);
  }
  punchFx(a) {
    let b = a.go,
      c = a.point;
    a = a.c;
    a === EntityCategory.LIMB || a === EntityCategory.LOCAL || a === EntityCategory.AGENT
      ? ((a = b.p.sub ? ParticleEffects.GoreTrailWater : ParticleEffects.Bloodsplat3),
        (a.origin = 4),
        (a.point = c),
        (a.n = 3),
        this.createEffect(a, b),
        (a.origin = void 0),
        (a.point = void 0),
        (a.n = 1))
      : ((a = ParticleEffects.PunchImpact), (a.origin = 4), (a.point = c), this.createEffect(a, b));
  }
  explosionFx(a) {
    let b = a.go;
    a.exp.p.exp.mod
      ? this.addEmitter(b, new ParticleEmitter(b, [ParticleEffects.Plasma1], null, 1, 1, 200, 0.2))
      : (this.addEmitter(
          b,
          new ParticleEmitter(
            b,
            [ParticleEffects.SmokeTrail2],
            null,
            4,
            1,
            200,
            0.2,
            0,
            0,
            16777215,
            1
          )
        ),
        b.p.sub ||
          this.addEmitter(
            b,
            new ParticleEmitter(
              b,
              [ParticleEffects.FlameTrail2],
              null,
              4,
              1,
              200,
              0.2,
              0,
              0,
              16777215,
              2
            )
          ));
  }
  sawFx(a) {
    let b = a.go,
      c = a.point;
    var d = a.c;
    d === EntityCategory.LIMB || d === EntityCategory.LOCAL || d === EntityCategory.AGENT
      ? ((a = b.p.sub ? ParticleEffects.GoreTrailWater : ParticleEffects.Bloodsplat3),
        (a.origin = 4),
        (a.point = c),
        (a.n = 10),
        this.createEffect(a, b),
        (a.origin = void 0),
        (a.point = void 0),
        (a.n = 1))
      : ((d = a.normal),
        (a = ParticleEffects.ChainsawSparks),
        (a.origin = 4),
        (a.point = c),
        this.createEffect(a, b),
        (a = ParticleEffects.ChainsawSparks2),
        (a.origin = 4),
        (a.point = c),
        (a.nx = d.x * a.nm),
        (a.ny = d.y * a.nm),
        this.createEffect(a, b));
  }
  linkGunFx(a) {
    let b = a.go;
    var c = a.point,
      d = a.c;
    a.impact &&
      (d === EntityCategory.LIMB || d === EntityCategory.LOCAL || d === EntityCategory.AGENT
        ? ((d = b.p.sub ? ParticleEffects.GoreTrailWater : ParticleEffects.Bloodsplat3),
          (d.origin = 4),
          (d.point = c),
          (d.n = 10),
          this.createEffect(d, b),
          (d.n = 1),
          (d.origin = void 0),
          (d.point = void 0),
          (d = ParticleEffects.LinkGunRayImpact),
          (d.origin = 4),
          (d.point = c),
          this.createEffect(d, b),
          (d.origin = void 0),
          (d.point = void 0),
          (d.n = 1),
          a.target &&
            this.addEmitter(
              a.target,
              new ParticleEmitter(a.target, [ParticleEffects.PlasmaElectric], null, 1, 1, 200, 0.2)
            ))
        : ((d = ParticleEffects.LinkGunRayImpact),
          (d.origin = 4),
          (d.point = c),
          this.createEffect(d, b),
          (d.origin = void 0),
          (d.point = void 0)));
    c = b.id + "_lg";
    a.origin.x += (0.3 * b.p.vx) / 20;
    a.origin.y += (0.3 * b.p.vy) / 20;
    this.createLinkGunBeam(c, a.origin, a.point, a.impact);
  }
  createRope(a, b = null, c = null) {
    let d, e;
    a &&
      ((d =
        null === b
          ? new FastRope(App.CombinedTextures[b.FX.tex], a)
          : new b(App.CombinedTextures[b.FX.tex], a)),
      (e = null === c ? a.id : c));
    this.ropes[e] = d;
    this._3.addChild(d);
    return d;
  }
  createLinkGunBeam(a, b, c, d) {
    let e = c.x - b.x;
    c = c.y - b.y;
    var f = Math.sqrt(e * e + c * c);
    if (void 0 === this.ropes[a]) {
      var g = [];
      for (var h = 0; 16 > h; h++) {
        var m = new PIXI.Point(
          20 * b.x + ((20 * e) / 16) * h * 1.1,
          20 * b.y + ((20 * c) / 16) * h * 1.1
        );
        g.push(m);
      }
      a = this.ropes[a] = new PIXI.SimpleRope(App.CombinedTextures.ray_gun_beam, g, -1);
      a.alpha = 1.1;
      a.alphaDrop = 0.1;
      a.ttl = 10;
      this._3.addChild(a);
    } else a = this.ropes[a];
    f = 1 * f + 1;
    for (g = 0; 16 > g; g++)
      (m = h = 0),
        0 === g ||
          (15 === g && d) ||
          ((h = 0.5 * -f + Math.random() * f), (m = 0.5 * -f + Math.random() * f)),
        (m = 20 * b.y + ((20 * c) / 16) * g * 1.0625 + m),
        (a.geometry.points[g].x = 20 * b.x + ((20 * e) / 16) * g * 1.0625 + h),
        (a.geometry.points[g].y = m);
  }
  createEffect(a, b, c) {
    a[PP.DYNAMIC_ALT] &&
      this.dynamicObjects[c.a.body.m_userData] &&
      this.dynamicObjects[c.b.body.m_userData] &&
      (a = a[PP.DYNAMIC_ALT]);
    if (b) {
      if (a[PP.CAM_SHAKE] && (a[PP.GLOBAL] || b.isLocal)) {
        var d = b.p.x + (this.cam.x - 0.5 * App.ClientWidth),
          e = b.p.y + (this.cam.y - 0.5 * App.ClientHeight);
        d * d + e * e < App.ClientWidth * App.ClientWidth && this.cam.shake(a[PP.CAM_SHAKE]);
      }
      a[PP.CAM_JERK] && (a[PP.GLOBAL] || b.isLocal) && this.cam.jerk(a[PP.CAM_JERK], b.facing);
      if (App.HasFocus && b.visual && b.visual.parent)
        if (
          (a[PP.AMOUNT_RANDOM] &&
            (a[PP.AMOUNT] =
              a[PP.AMOUNT_RANDOM].min +
              Math.random() * (a[PP.AMOUNT_RANDOM].max - a[PP.AMOUNT_RANDOM].min)),
          a[PP.LOCAL])
        )
          for (
            c = a[PP.TYPE],
              c === ParticleEffects.LOCAL_LINK_GUN || c === ParticleEffects.LOCAL_SAW
                ? ((c = -b.getWeaponRotation()),
                  (d = b.getPrimaryAnchor(a.origin)),
                  (a.p1 = {
                    x: (-this.cam.x + d.x / 1 / this.cam.scale) / PC.PM_RATIO,
                    y: (-this.cam.y + d.y / 1 / this.cam.scale) / PC.PM_RATIO,
                  }),
                  (a.p2 = {
                    x: a.p1.x + (a.delta * Math.cos(c)) / PC.PM_RATIO,
                    y: a.p1.y + (a.delta * Math.sin(c)) / PC.PM_RATIO,
                  }))
                : c === ParticleEffects.LOCAL_EXP
                ? (a.exp = b.p.explosive)
                : c === ParticleEffects.LOCAL_PUNCH &&
                  ((c = b.facing + Math.PI),
                  (d = b.getPrimaryAnchor(a.origin)),
                  (a.p1 = {
                    x: (-this.cam.x + d.x / 1 / this.cam.scale) / PC.PM_RATIO,
                    y: (-this.cam.y + d.y / 1 / this.cam.scale) / PC.PM_RATIO,
                  }),
                  (a.p2 = {
                    x: a.p1.x + (a.delta * Math.cos(c) * 0.25) / PC.PM_RATIO,
                    y: a.p1.y + (a.delta * Math.sin(c) * 0.25) / PC.PM_RATIO,
                  })),
              c = a[PP.AMOUNT];
            0 < c--;

          )
            this.requestLocalObject(a, b);
        else {
          if (a[PP.ORIGIN])
            if (((d = a[PP.ORIGIN]), 1 === d || 2 === d))
              (d = b.getPrimaryAnchor(d)),
                (a.x = -this.cam.x + d.x / 1 / this.cam.scale + 0.24 * b.p.vx),
                (a.y = -this.cam.y + d.y / 1 / this.cam.scale + 0.24 * b.p.vy);
            else if (4 === d) (a.x = a.point.x * PC.PM_RATIO), (a.y = a.point.y * PC.PM_RATIO);
            else if (3 === d) {
              e = a[PP.ANCHOR_RELATIVE].x;
              let f = a[PP.ANCHOR_RELATIVE].y;
              d = Math.sqrt(e * e + f * f);
              0 !== d
                ? ((e = Math.atan2(f, e)),
                  (a.x = b.p.x + d * Math.cos(e + b.visual.rotation)),
                  (a.y = b.p.y + d * Math.sin(e + b.visual.rotation)))
                : ((a.x = b.p.x), (a.y = b.p.y));
            } else
              c
                ? ((a.x = c.p.x * PC.PM_RATIO), (a.y = c.p.y * PC.PM_RATIO))
                : ((a.x = b.p.x), (a.y = b.p.y));
          else
            c
              ? ((a.x = c.p.x * PC.PM_RATIO), (a.y = c.p.y * PC.PM_RATIO))
              : ((a.x = b.p.x), (a.y = b.p.y));
          a.offset && ((a.x += a.offset.x), (a.y += a.offset.y));
          switch (a[PP.VELOCITY]) {
            case 1:
              a.vx = -b.p.vx * (a[PP.VELOCITY_MULTIPLIER] || 0);
              a.vy = -b.p.vy * (a[PP.VELOCITY_MULTIPLIER] || 0);
              break;
            case 2:
              a.vx = a.vy = 0;
              break;
            case 3:
              a.vx = a[PP.VELOCITY_MULTIPLIER] * Math.cos(-b.getWeaponRotation()) + 0.24 * b.p.vx;
              a.vy = a[PP.VELOCITY_MULTIPLIER] * Math.sin(-b.getWeaponRotation()) + 0.24 * b.p.vy;
              break;
            case 4:
              c =
                Math.sqrt(b.p.vx * b.p.vx + b.p.vy * b.p.vy) *
                (Math.random() + 0.5) *
                a[PP.VELOCITY_MULTIPLIER];
              a.vx = -1.5 + 3 * Math.random();
              a.vy = (3 > c ? 3 : c) * (0 > b.p.vy ? 1 : -1);
              break;
            case 5:
              a.vx = b.p.vx * (a[PP.VELOCITY_MULTIPLIER] || 0);
              a.vy = b.p.vy * (a[PP.VELOCITY_MULTIPLIER] || 0);
              break;
            case 6:
              c = a[PP.DELTA_RANDOM]
                ? a[PP.DELTA_RANDOM].min +
                  Math.random() * (a[PP.DELTA_RANDOM].max - a[PP.DELTA_RANDOM].min)
                : a.d;
              a.vx = c * Math.cos(b.visual.rotation - 0.5 * Math.PI);
              a.vy = c * Math.sin(b.visual.rotation - 0.5 * Math.PI);
              break;
            case 7:
              c = Math.sqrt(b.p.vx * b.p.vx + b.p.vy * b.p.vy) * a[PP.VELOCITY_MULTIPLIER];
              d = Math.atan2(b.p.vy, b.p.vx);
              3 > c && (c = 3);
              a.vx = c * Math.cos(d + (-0.4 + 0.8 * Math.random()));
              a.vy = c * Math.sin(d + (-0.4 + 0.8 * Math.random()));
              break;
            case 8:
              c && c.normal
                ? ((a.vx = c.normal.x), (a.vy = c.normal.y))
                : ((a.vx = a.nx || 0), (a.vy = a.ny || 0));
              a[PP.NORMAL_MULTIPLIER] &&
                ((a.vx *= a[PP.NORMAL_MULTIPLIER]), (a.vy *= a[PP.NORMAL_MULTIPLIER]));
              break;
            case 9:
              a.vx = -a[PP.VELOCITY_MULTIPLIER] * Math.cos(-b.getWeaponRotation()) + 0.24 * b.p.vx;
              a.vy = -a[PP.VELOCITY_MULTIPLIER] * Math.sin(-b.getWeaponRotation()) + 0.24 * b.p.vy;
              break;
            case 10:
              a.vx =
                2 * Math.cos(b.p.r - 0.5 * Math.PI + (-0.3 + 0.6 * Math.random())) + b.p.vx / 7;
              a.vy =
                2 * Math.sin(b.p.r - 0.5 * Math.PI + (-0.3 + 0.6 * Math.random())) + b.p.vy / 7;
              a.x -= b.p.vx / 7;
              a.y -= b.p.vy / 7;
              break;
            case 11:
              c = Math.atan2(a.offset.y, a.offset.x);
              a.vx = -1 * Math.cos(c) + b.p.vx / 5;
              a.vy = -0.5 * Math.sin(c) + b.p.vy / 5;
              a.x -= b.p.vx / 5;
              a.y -= b.p.vy / 5;
              break;
            case 12:
              c = Math.atan2(a.offset.y, a.offset.x);
              a.vx = 5 * Math.cos(c) + b.p.vx / 5;
              a.vy = 5 * Math.sin(c) + b.p.vy / 5;
              a.x -= b.p.vx / 5;
              a.y -= b.p.vy / 5;
              break;
            default:
              void 0 !== a[PP.EJECTION_DELTA]
                ? ((c = -a[PP.EJECTION_ANGLE] + Math.random() * a[PP.EJECTION_ANGLE] * 2),
                  (d =
                    a[PP.EJECTION_DELTA].min +
                    Math.random() * (a[PP.EJECTION_DELTA].max - a[PP.EJECTION_DELTA].min)),
                  (e =
                    b.getWeaponRotation() +
                    (b.facingDir === Player.FACING_LEFT ? 1.5 * Math.PI : 0.5 * Math.PI)),
                  (a.vx = d * Math.cos(e + c) + b.p.vx / PC.PM_RATIO),
                  (a.vy = d * -Math.sin(e + c) + b.p.vy / PC.PM_RATIO))
                : (a.vx = a.vy = 0);
          }
          switch (a._r) {
            case 1:
              a.r = Math.atan2(b.p.vy, b.p.vx);
              break;
            case 2:
              a.r = Math.random() * Math.PI * 2;
              break;
            case 3:
              a.r = -b.getWeaponRotation();
              break;
            case 4:
              a.r = -b.getWeaponRotation() + 0.5 * Math.PI;
              break;
            case 5:
              a.r = -b.getWeaponRotation() + Math.PI;
              break;
            case 6:
              a.r = b.p.r;
              break;
            case 7:
              a.r = b.visual.lastRotation;
          }
          a[PP.ANGULAR_RANDOM] &&
            (a[PP.ANGULAR] = a[PP.ANGULAR_RANDOM].min + Math.random() * a[PP.ANGULAR_RANDOM].max);
          a[PP.SCALE_FACTOR] &&
            (a.s = Math.sqrt(b.p.vx * b.p.vx + b.p.vy * b.p.vy) * a[PP.SCALE_FACTOR]);
          a[PP.APPEAR] && (a.appear = a[PP.APPEAR]);
          if (a[PP.FOREGROUND]) {
            if (
              (this.fgParticleContainer.spawn(a, a[PP.AMOUNT]),
              !1 !== this.settings.graphics.shockwaveFx && a[PP.FILTERS])
            )
              for (c = a[PP.FILTERS].length; 0 < c; )
                (d = new a[PP.FILTERS][--c](
                  new PIXI.Point(b.visual.x + this.cam.x, b.visual.y + this.cam.y)
                )),
                  (d.radius = 200 * this.cam.scale),
                  (d.origin = { x: b.visual.x, y: b.visual.y }),
                  this.addFilter(d);
          } else this.bgParticleContainer.spawn(a, a[PP.AMOUNT]);
        }
    }
  }
  onContactFX(a, b) {
    var c;
    let d;
    void 0 != b.a.body._parent
      ? (c = this.dynamicObjects[b.a.body._parent])
      : void 0 != b.b.body._parent && (c = this.dynamicObjects[b.b.body._parent]);
    if (void 0 !== c && c.g.onImpact)
      (d = c.g.onImpact),
        c.p.sub
          ? a.g.onAgentContactSubmerged && (d = d.concat(a.g.onAgentContactSubmerged))
          : a.g.onAgentContact && (d = d.concat(a.g.onAgentContact));
    else if (
      ((d = a.g.onContact), void 0 !== a.g.onRemoveContact && b.b.body && 2 === b.b.body.m_type)
    )
      return !1;
    for (c = 0; c < d.length; c++) this.createEffect(d[c], a, b);
    return !0;
  }
  onAddFX(a) {
    let b = a.g.onAdd;
    for (let c = 0; c < b.length; c++) this.createEffect(b[c], a);
  }
  onRemoveFX(a) {
    if (!a.triggered) {
      let b = a.g.onRemove;
      for (let c = 0; c < b.length; c++) this.createEffect(b[c], a);
    }
  }
  onRemoveContactFX(a) {
    let b = a.g.onRemoveContact;
    for (let c = 0; c < b.length; c++) this.createEffect(b[c], a);
  }
  onTriggerFX(a) {
    let b = a.g.onTrigger;
    for (let c = 0; c < b.length; c++) this.createEffect(b[c], a);
  }
  onUseFX(a, b) {
    if ((b = ItemMap[b])) {
      b = b.onUse.visual;
      for (let c = 0; c < b.length; c++) this.createEffect(b[c], a);
    }
  }
  removeStaticObject(a) {
    a.visual && a.visual.parent && this[a.visual.layer].removeChild(a.visual);
  }
  removeDynamicObject(a) {
    void 0 !== this.emitters[a.id] && delete this.emitters[a.id];
    a.visual && a.visual.parent && this._3.removeChild(a.visual);
    delete this.dynamicObjects[a.id];
  }
  getCamera() {
    return this.cam;
  }
  updateCameraPosition() {
    let a = 0;
    var b = 0;
    if (this.cam.target) {
      var c = this.dynamicObjects[this.cam.target];
      c &&
        ((b = -c.p.y + (App.ClientHeight - this.mouse.y) / this.cam.scale),
        (a = 0.2 * (-c.p.x + (App.ClientWidth - this.mouse.x) / this.cam.scale - this.cam.x)),
        (b = 0.2 * (b - this.cam.y)));
    } else {
      let d = App.TransformedMouseX - (App.ClientWidth / this.cam.scale) * 0.5,
        e = App.TransformedMouseY - (App.ClientHeight / this.cam.scale) * 0.5;
      c = Math.sqrt(d * d + e * e);
      100 < c &&
        ((b = Math.atan2(e, d)), (a = -c * Math.cos(b) * 0.04), (b = -c * Math.sin(b) * 0.04));
    }
    this.cam.x += a;
    this.cam.y += b;
  }
  applyZIndex(a) {
    let b = a.visual.z,
      c = this[a.visual.layer],
      d = c.children.length,
      e = d - 1;
    for (; 0 < e && c.children[e - 1].z > b; ) e--;
    e < d - 1 && c.setChildIndex(a.visual, e);
  }
  update(a) {
    if (App.WindowResized) {
      var b = App.ClientWidth > App.ClientHeight ? 1920 / App.ClientWidth : 1080 / App.ClientHeight;
      this.cam.scale = 1.6 / b;
      this.emit(CanvasEvent.SCALE, this.cam.scale);
      this.parallax.scale.x = this.parallax.scale.y = 1;
      App.WindowResized = !1;
      this.parallax.distribute();
      this.gradient.resize(App.ClientWidth * b, App.ClientHeight * b);
      this.gradient.hitArea = new PIXI.Rectangle(0, 0, App.ClientWidth * b, App.ClientHeight * b);
    }
    this.frameCount++;
    this.updateCameraPosition();
    this.world.filters && this.updateFilters(a);
    if (a) null !== this.zoomFunction && this.zoomFunction();
    else {
      for (var c in this.emitters)
        (a = this.dynamicObjects[c] || this.emitters[c][0].parent),
          a.visual.parent && this.updateEmitters(a);
      this.bgParticleContainer.update();
      this.fgParticleContainer.update();
      this.cam.shaking && this.cam.shake();
    }
    for (var d in this.ropes)
      (c = this.ropes[d]),
        0 === c.ttl ? (this._3.removeChild(c), delete this.ropes[d]) : (c.alpha -= c.alphaDrop),
        void 0 !== c.update && c.update(),
        c.ttl--;
    this.world.x = this.cam.x * this.cam.scale;
    this.world.y = this.cam.y * this.cam.scale;
    this.parallax.update(this.cam);
    this.background.update(this.cam);
    this.labelContainer.update(
      this.cam,
      this.mouse.x / this.cam.scale,
      this.mouse.y / this.cam.scale
    );
    if (null !== this.fb) {
      d = this.fb.search(
        -this.cam.x - 40,
        -this.cam.y - 40,
        -this.cam.x + 40 + App.ClientWidth / this.cam.scale,
        -this.cam.y + 40 + App.ClientHeight / this.cam.scale
      );
      for (let f = 0, g = this.displayed.length; f < g; f++)
        if (((a = this.displayed[f]), (c = this.staticBuffer[a]), -1 === d.indexOf(a))) {
          if (c.visual.parent) {
            if (this.staticEmitters[c.id]) {
              a = this.staticEmitters[c.id];
              b = a.length;
              for (var e = 0; e < b; e++) this.removeEmitter(c, a[e].emitter);
            }
            this[c.visual.layer].removeChild(c.visual);
          }
        } else if (c.visual.parent) c.g.updateUniforms && (c.visual.shader.uniforms.t += 1);
        else if (
          (this[c.visual.layer].addChild(c.visual),
          c.p.prefab || this.applyZIndex(c),
          this.staticEmitters[c.id])
        )
          for (a = this.staticEmitters[c.id], b = a.length, e = 0; e < b; e++)
            (a[e].emitter.attached = !1), this.addEmitter(c, a[e].emitter);
      this.displayed = d;
    }
    if (0 < this.dissolve.length)
      for (d = 0; d < this.dissolve.length; d++)
        (c = this.dissolve[d]),
          (c.visual.y -= 0.1),
          (c.visual.alpha -= 0.01),
          0.01 > c.visual.alpha && (this.removeDynamicObject(c), fastSplice(this.dissolve, d), d--);
  }
  addFilter(a) {
    let b = this.world.filters;
    this.world.filters = b ? b.concat([a]) : [a];
  }
  updateFilters(a) {
    let b = this.world.filters,
      c = b.length;
    for (; 0 < c; ) {
      let d = b[--c];
      if (void 0 !== d.time && !a)
        if (1 > d.time) d.time += 0.05;
        else {
          this.removeFilter(c);
          break;
        }
      d.center &&
        ((d.center.x = 1 * (d.origin.x + this.cam.x) * this.cam.scale),
        (d.center.y = 1 * (d.origin.y + this.cam.y) * this.cam.scale));
    }
  }
  removeFilter(a) {
    1 >= this.world.filters.length ? (this.world.filters = null) : this.world.filters.splice(a, 1);
  }
  onRightDown() {
    this.rightdown = !0;
    App.UIVisible || this.emit(CanvasEvent.RIGHT_DOWN);
  }
  onRightUp() {
    this.rightdown = !1;
    App.UIVisible || this.emit(CanvasEvent.RIGHT_UP);
  }
  onMouseDown(a) {
    document.hasFocus() || window.focus();
    App.UIVisible || this.emit(CanvasEvent.MOUSE_DOWN);
  }
  onMouseUp(a) {
    this.emit(CanvasEvent.MOUSE_UP);
  }
  onMouseMove(a) {
    this.mousePositionFromEvent(a);
    this.emit(CanvasEvent.MOUSE_MOVE, this.mouse);
  }
  mousePositionFromNormalizedVector(a, b = 0.35) {
    let c = 0.5 * App.ClientWidth + a.x * App.ClientWidth * b;
    a = 0.5 * App.ClientHeight + a.y * App.ClientWidth * b;
    this.mouse.x = c;
    this.mouse.y = a;
    App.TransformedMouseX = c / this.cam.scale;
    App.TransformedMouseY = a / this.cam.scale;
  }
  mousePositionFromEvent(a) {
    this.mouse.x = a.data.global.x;
    this.mouse.y = a.data.global.y;
    App.TransformedMouseX = this.mouse.x / this.cam.scale;
    App.TransformedMouseY = this.mouse.y / this.cam.scale;
  }
  isTouchEvent(a) {
    return void 0 !== a.data && "touch" === a.data.pointerType;
  }
  onClear() {
    this.bgParticleContainer.clear();
    this.fgParticleContainer.clear();
    this.world.filters = [];
    this.labelContainer.clear();
    this.emitters = {};
    this.background.clear();
    this._2.clear();
    this._2.lineStyle(3, 0, 0.2);
    this._1.children.forEach((a) => a.destroy({ children: !0 }));
    this._2.children.forEach((a) => a.destroy({ children: !0 }));
    this._3.children.forEach((a) => a.destroy({ children: !0 }));
    this._4.children.forEach((a) => a.destroy({ children: !0 }));
    this._5.children.forEach((a) => a.destroy({ children: !0 }));
    this._1.removeChildren();
    this._2.removeChildren();
    this._3.removeChildren();
    this._4.removeChildren();
    this._5.removeChildren();
    this.displayed = [];
    this.dynamicObjects = {};
    this.emitters = {};
    this.players = {};
    this.ropes = {};
    this.dissolve = [];
    BaseSprite.MeshIDMap = {};
    BaseSprite.MeshIDGroups = [];
    this.staticEmitters = {};
    this.parallax.clear();
    this.staticBuffer = [];
    this.lineSegments = [];
    this.fb = null;
    this.manager.on(ModelEvent.GAMEOBJECT_ADDED, this.onStaticObjectAddedBinding);
    this.manager.removeListener(ModelEvent.GAMEOBJECT_ADDED, this.onGameObjectAddedBinding);
  }
  onFocus() {}
}
Canvas.MouseDownListener = function (a) {
  2 !== a.button &&
    this.rightdown &&
    ((a.data = { global: { x: a.offsetX, y: a.offsetY } }), this.onMouseDown(a));
};
Canvas.MouseUpListener = function (a) {
  2 !== a.button &&
    this.rightdown &&
    ((a.data = { global: { x: a.offsetX, y: a.offsetY } }), this.onMouseUp(a));
};
Canvas.BoundMouseDownListener = null;
Canvas.BoundMouseUpListener = null;
Canvas.BoundRightDownListener = null;
Canvas.BoundRightUpListener = null;
var canvasevent = {};
function CanvasEvent(a, b) {
  CustomEvent.call(this, a, b);
}
CanvasEvent.MOUSE_DOWN = "c_md";
CanvasEvent.MOUSE_UP = "c_mu";
CanvasEvent.MOUSE_MOVE = "c_m";
CanvasEvent.RIGHT_DOWN = "c_rd";
CanvasEvent.RIGHT_UP = "c_ru";
CanvasEvent.REQUEST_LOCAL_OBJECT = "c_rlo";
CanvasEvent.SCALE = "c_sc";
var energydragon = {};
class EnergyDragon extends PIXI.Sprite {
  constructor(a, b, c, d) {
    super();
    this.target = a;
    this.trail = { ...ParticleEffects.EnergyDragonball };
    this.tint = this.trail.tt = d;
    this.theta = 0;
    this.torsoloweremitter1 = new ParticleEmitter(this.target.torsolower, this.trail);
    this.torsoloweremitter2 = new ParticleEmitter(this.target.torsolower, this.trail);
    this.torsoloweremitter3 = new ParticleEmitter(this.target.torsolower, this.trail);
    this.emitter = [this.torsoloweremitter1, this.torsoloweremitter2, this.torsoloweremitter3];
  }
  update(a) {
    this.theta += 0 > this.target.p.vx ? -0.15 : 0.15;
    this.torsoloweremitter1.offset.x = 35 * Math.cos(this.theta);
    this.torsoloweremitter1.offset.y = 35 * Math.sin(this.theta);
    this.torsoloweremitter2.offset.x = 35 * Math.cos(this.theta + Math.PI / 1.5);
    this.torsoloweremitter2.offset.y = 35 * Math.sin(this.theta + Math.PI / 1.5);
    this.torsoloweremitter3.offset.x = 35 * Math.cos(this.theta + Math.PI / 0.75);
    this.torsoloweremitter3.offset.y = 35 * Math.sin(this.theta + Math.PI / 0.75);
    AudioManager.PlayEffect(AudioEffects.Fly, this.target);
  }
}
EnergyDragon.Material = {};
EnergyDragon.ID = "dragon";
var energyjetfeet = {};
class EnergyJetFeet extends PIXI.Sprite {
  constructor(a, b, c, d) {
    super();
    this.target = a;
    this.trail = { ...ParticleEffects.EnergyJetFeet };
    this.tint = this.trail.tt = d;
    this.leftlegemitter = new ParticleEmitter(this.target.legleftlower, [this.trail]);
    this.rightlegemitter = new ParticleEmitter(this.target.legrightlower, [this.trail]);
    this.emitter = [this.leftlegemitter, this.rightlegemitter];
  }
  update(a) {
    this.leftlegemitter.offset.x =
      10 * Math.cos(this.target.legleftlower.visual.rotation - 0.5 * Math.PI);
    this.leftlegemitter.offset.y =
      10 * Math.sin(this.target.legleftlower.visual.rotation - 0.5 * Math.PI);
    this.rightlegemitter.offset.x =
      10 * Math.cos(this.target.legrightlower.visual.rotation - 0.5 * Math.PI);
    this.rightlegemitter.offset.y =
      10 * Math.sin(this.target.legrightlower.visual.rotation - 0.5 * Math.PI);
    AudioManager.PlayEffect(AudioEffects.EnergyJetFeet, this.target);
  }
}
EnergyJetFeet.Material = {};
EnergyJetFeet.ID = "jetfeet";
var energyjetfeet2 = {};
class EnergyJetFeet2 extends PIXI.Sprite {
  constructor(a, b, c, d) {
    super();
    this.target = a;
    this.trail = { ...ParticleEffects.EnergyJetFeet2 };
    this.tint = this.trail.tt = d;
    this.leftlegemitter = new ParticleEmitter(this.target.legleftlower, [
      this.trail,
      ParticleEffects.EnergyJetGlow,
    ]);
    this.rightlegemitter = new ParticleEmitter(this.target.legrightlower, [
      this.trail,
      ParticleEffects.EnergyJetGlow,
    ]);
    this.emitter = [this.leftlegemitter, this.rightlegemitter];
  }
  update(a) {
    this.leftlegemitter.offset.x =
      8 * Math.cos(this.target.legleftlower.visual.rotation - 0.5 * Math.PI);
    this.leftlegemitter.offset.y =
      8 * Math.sin(this.target.legleftlower.visual.rotation - 0.5 * Math.PI);
    this.rightlegemitter.offset.x =
      8 * Math.cos(this.target.legrightlower.visual.rotation - 0.5 * Math.PI);
    this.rightlegemitter.offset.y =
      8 * Math.sin(this.target.legrightlower.visual.rotation - 0.5 * Math.PI);
    AudioManager.PlayEffect(AudioEffects.EnergyJetFeet, this.target);
  }
}
EnergyJetFeet2.Material = {};
EnergyJetFeet2.ID = "jetfeet2";
var energyvacuum = {};
class EnergyVacuum extends PIXI.Sprite {
  constructor(a, b, c, d) {
    super();
    this.target = a;
    this.trail = { ...ParticleEffects.EnergyVacuum };
    this.tint = this.trail.tt = d;
    this.theta = this.index = 0;
    this.torsoloweremitter1 = new ParticleEmitter(this.target.torsolower, this.trail);
    this.torsoloweremitter2 = new ParticleEmitter(this.target.torsolower, this.trail);
    this.emitter = [this.torsoloweremitter1, this.torsoloweremitter2];
  }
  update(a) {
    this.theta += 0 > this.target.p.vx ? -0.03 : 0.03;
    this.index = 8 === this.index + 1 ? 0 : this.index + 1;
    a = (this.index * Math.PI) / 4 + this.theta;
    this.torsoloweremitter1.offset.x = 35 * Math.cos(a);
    this.torsoloweremitter1.offset.y = 35 * Math.sin(a);
    this.torsoloweremitter2.offset.x = 35 * Math.cos(a + Math.PI);
    this.torsoloweremitter2.offset.y = 35 * Math.sin(a + Math.PI);
    AudioManager.PlayEffect(AudioEffects.Fly, this.target);
  }
}
EnergyVacuum.Material = {};
EnergyVacuum.ID = "vacuum";
var fastrope = {};
class FastRope extends PIXI.Mesh {
  constructor(a, b, c = null, d = null, e = null) {
    d = new PIXI.RopeGeometry(
      a.height,
      null === d ? [new PIXI.Point(), new PIXI.Point(), new PIXI.Point(), new PIXI.Point()] : d,
      0
    );
    a = null === e ? new PIXI.MeshMaterial(a) : e;
    super(d, a);
    this.autoUpdate = !0;
    this.target = b;
    this.ttl = -1;
    this.target
      ? ((this.x = this.target.p.x), (this.y = this.target.p.y))
      : ((this.x = c.x), (this.y = c.y));
    this.vy = this.vx = this.alphaDrop = 0;
    this.delta = 20;
    this.points = this.geometry.points;
  }
  _render(a) {
    const b = this.geometry;
    if (this.autoUpdate || b._width !== this.shader.texture.height)
      (b._width = this.shader.texture.height), b.update();
    super._render(a);
  }
  update() {
    this.target
      ? ((this.points[0].x = this.target.p.x), (this.points[0].y = this.target.p.y))
      : ((this.points[0].x += this.vx), (this.points[0].y += this.vy));
    for (let b = 1; b < this.points.length; b++) {
      let c = this.points[b];
      var a = this.points[b].x - this.points[b - 1].x;
      let d = this.points[b].y - this.points[b - 1].y;
      Math.sqrt(a * a + d * d) > this.delta &&
        ((a = Math.atan2(d, a)),
        (c.x = this.points[b - 1].x + this.delta * Math.cos(a)),
        (c.y = this.points[b - 1].y + this.delta * Math.sin(a)));
    }
  }
}
var blackcape = {};
class BlackCape extends FastRope {
  constructor(a, b) {
    let c = [];
    for (var d = 0; 6 > d; d++) c.push(new PIXI.Point(0, 21.4 * d));
    d = new PIXI.MeshMaterial(a, { program: BlackCape.Program, uniforms: { t: 0, v: [0, 0] } });
    super(a, b, null, c, d);
    this.x = this.target.torsoupper.p.x;
    this.y = this.target.torsoupper.p.y;
    this.targetScale = 0.33;
    this.scale.x = this.targetScale;
    this.scale.y = this.targetScale;
    this.delta = 21.4;
    this.counter = this.wave = 0;
  }
  update() {
    this.counter += 0.01;
    let a = this.target.torsoupper.p.vx,
      b = this.target.torsoupper.p.vy;
    this.shader.uniforms.t += 0.005 * Math.sqrt(a * a + b * b) + 0.05;
    this.shader.uniforms.v[0] = a;
    this.shader.uniforms.v[1] = b;
    this.wave = -0.4 * Math.abs(Math.sin(0.2 * this.counter));
    var c = this.target.torsoupper.p.r;
    let d = PC.GRAVITY.y;
    void 0 !== this.target.animations[Animation.ROLL_LEFT]
      ? (d *= -4)
      : void 0 !== this.target.animations[Animation.ROLL_RIGHT]
      ? (d *= -4)
      : void 0 !== this.target.animations[Animation.PRONE_LEFT]
      ? (d = 2)
      : void 0 !== this.target.animations[Animation.PRONE_RIGHT]
      ? (d = 2)
      : (this.rotation = 0);
    this.target.facingDir === Player.FACING_LEFT
      ? ((this.scale.x = this.targetScale),
        (a = 0 < a ? 0.2 * a : a - 0.5),
        (this.x = this.target.torsoupper.p.x - 7 * Math.cos(c - 0.75)),
        (this.y = this.target.torsoupper.p.y - 7 * Math.sin(c - 0.75)))
      : ((this.scale.x = -this.targetScale),
        (a *= -1),
        (a = 0 < a ? 0.2 * a : a - 0.5),
        (this.x = this.target.torsoupper.p.x - 7 * Math.cos(c - 2.5)),
        (this.y = this.target.torsoupper.p.y - 7 * Math.sin(c - 2.5)));
    for (c = 1; 6 > c; c++) {
      let f = this.points[c],
        g = this.points[c - 1];
      f.x -= 0.2 * a * c + this.wave * (6 - c) * 0.1;
      f.y -= 0.4 * b - d * (0.8 - 0.1 * c) * 0.2;
      var e = f.x - g.x;
      let h = f.y - g.y;
      e * e + h * h > this.delta * this.delta &&
        ((e = Math.atan2(h, e)),
        (f.x = g.x + this.delta * Math.cos(e)),
        (f.y = g.y + this.delta * Math.sin(e)));
    }
  }
}
BlackCape.FX = { tex: "blackcape" };
BlackCape.ID = "blackcape";
BlackCape.VertexSource =
  "\nprecision mediump float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\nuniform float t;\nuniform vec2 v;\n\nvarying vec2 vTextureCoord;\nvoid main(void)\n{\n    float mx = aVertexPosition.x / 5.0;\n    float my = aVertexPosition.y / 5.0;\n    float delta = length(aVertexPosition) / 128.0;\n    float frequency = delta * length(v) * 0.125 + t;\n    float amplitude = delta * delta * 0.004;\n    vec2 offset = vec2(sin(frequency + my) * amplitude, sin(frequency + mx) * amplitude);\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy + offset, 0.0, 1.0);\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}";
BlackCape.FragmentSource =
  "\nprecision mediump float;\nvarying vec2 vTextureCoord;\nuniform vec4 uColor;\nuniform float t;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    float m = 1.0 - abs(sin(vTextureCoord.x * 150.0 - t * 0.5)) * 0.25;\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * vec4(uColor.rgb * m, uColor.a);\n}\n";
BlackCape.Program = new PIXI.Program(BlackCape.VertexSource, BlackCape.FragmentSource, "blackcape");
var bluecape = {};
class BlueCape extends BlackCape {
  constructor(a, b) {
    super(a, b);
  }
  update() {
    super.update();
  }
}
BlueCape.FX = { tex: "bluecape" };
BlueCape.ID = "bluecape";
var camocape = {};
class CamoCape extends BlackCape {
  constructor(a, b) {
    super(a, b);
  }
  update() {
    super.update();
  }
}
CamoCape.FX = { tex: "camocape" };
CamoCape.ID = "camocape";
var camocape_desert = {};
class CamoCapeDesert extends BlackCape {
  constructor(a, b) {
    super(a, b);
  }
  update() {
    super.update();
  }
}
CamoCapeDesert.FX = { tex: "camocape_desert" };
CamoCapeDesert.ID = "camocape_desert";
var camocape_jungle = {};
class CamoCapeJungle extends BlackCape {
  constructor(a, b) {
    super(a, b);
  }
  update() {
    super.update();
  }
}
CamoCapeJungle.FX = { tex: "camocape_jungle" };
CamoCapeJungle.ID = "camocape_jungle";
var camocape_winter = {};
class CamoCapeWinter extends BlackCape {
  constructor(a, b) {
    super(a, b);
  }
  update() {
    super.update();
  }
}
CamoCapeWinter.FX = { tex: "camocape_winter" };
CamoCapeWinter.ID = "camocape_winter";
var greencape = {};
class GreenCape extends BlackCape {
  constructor(a, b) {
    super(a, b);
  }
  update() {
    super.update();
  }
}
GreenCape.FX = { tex: "greencape" };
GreenCape.ID = "greencape";
var redcape = {};
class RedCape extends BlackCape {
  constructor(a, b) {
    super(a, b);
  }
  update() {
    super.update();
  }
}
RedCape.FX = { tex: "redcape" };
RedCape.ID = "redcape";
var yellowcape = {};
class YellowCape extends BlackCape {
  constructor(a, b) {
    super(a, b);
  }
  update() {
    super.update();
  }
}
YellowCape.FX = { tex: "yellowcape" };
YellowCape.ID = "yellowcape";
var pinkcape = {};
class PinkCape extends BlackCape {
  constructor(a, b) {
    super(a, b);
  }
  update() {
    super.update();
  }
}
PinkCape.FX = { tex: "pinkcape" };
PinkCape.ID = "pinkcape";
var orangecape = {};
class OrangeCape extends BlackCape {
  constructor(a, b) {
    super(a, b);
  }
  update() {
    super.update();
  }
}
OrangeCape.FX = { tex: "orangecape" };
OrangeCape.ID = "orangecape";
var extra = {};
class Extra {
  constructor() {}
}
Extra.Map = {
  blackcape: BlackCape,
  greencape: GreenCape,
  redcape: RedCape,
  yellowcape: YellowCape,
  bluecape: BlueCape,
  pinkcape: PinkCape,
  orangecape: OrangeCape,
  camocape: CamoCape,
  camocape_jungle: CamoCapeJungle,
  camocape_winter: CamoCapeWinter,
  camocape_desert: CamoCapeDesert,
};
var facefireeyes = {};
class FaceFireEyes extends PIXI.Sprite {
  constructor(a) {
    super();
    this.target = a;
    this.trail = { ...ParticleEffects.FireEyes };
    this.emitter = new ParticleEmitter(this.target.head, this.trail);
  }
  update(a) {
    a =
      this.target.facingDir === Player.FACING_LEFT
        ? this.target.head.p.r - 0.5
        : this.target.head.p.r + 0.5 + Math.PI;
    this.emitter.offset.x = 6 * Math.cos(a);
    this.emitter.offset.y = 4 * Math.sin(a);
  }
}
FaceFireEyes.ID = "fireeyes";
var faceredfireeyes = {};
class FaceRedFireEyes extends PIXI.Sprite {
  constructor(a) {
    super();
    this.target = a;
    this.trail1 = { ...ParticleEffects.FireEyes };
    this.trail1.tt = 16711680;
    this.trail2 = { ...ParticleEffects.FireEyesCenter };
    this.trail2.tt = 16777215;
    this.emitter1 = new ParticleEmitter(this.target.head, this.trail1);
    this.emitter2 = new ParticleEmitter(this.target.head, this.trail2);
    this.emitter = [this.emitter2, this.emitter1];
  }
  update(a) {
    a =
      this.target.facingDir === Player.FACING_LEFT
        ? this.target.head.p.r - 0.5
        : this.target.head.p.r + 0.5 + Math.PI;
    this.emitter1.offset.x = 6 * Math.cos(a);
    this.emitter1.offset.y = 4 * Math.sin(a);
    this.emitter2.offset.x = this.emitter1.offset.x;
    this.emitter2.offset.y = this.emitter1.offset.y;
  }
}
FaceRedFireEyes.ID = "fireeyesred";
var facegreenfireeyes = {};
class FaceGreenFireEyes extends PIXI.Sprite {
  constructor(a) {
    super();
    this.target = a;
    this.trail1 = { ...ParticleEffects.FireEyes };
    this.trail1.tt = 65280;
    this.trail2 = { ...ParticleEffects.FireEyesCenter };
    this.trail2.tt = 16777215;
    this.emitter1 = new ParticleEmitter(this.target.head, this.trail1);
    this.emitter2 = new ParticleEmitter(this.target.head, this.trail2);
    this.emitter = [this.emitter2, this.emitter1];
  }
  update(a) {
    a =
      this.target.facingDir === Player.FACING_LEFT
        ? this.target.head.p.r - 0.5
        : this.target.head.p.r + 0.5 + Math.PI;
    this.emitter1.offset.x = 6 * Math.cos(a);
    this.emitter1.offset.y = 4 * Math.sin(a);
    this.emitter2.offset.x = this.emitter1.offset.x;
    this.emitter2.offset.y = this.emitter1.offset.y;
  }
}
FaceGreenFireEyes.ID = "fireeyesgreen";
var facebluefireeyes = {};
class FaceBlueFireEyes extends PIXI.Sprite {
  constructor(a) {
    super();
    this.target = a;
    this.trail1 = { ...ParticleEffects.FireEyes };
    this.trail1.tt = 255;
    this.trail2 = { ...ParticleEffects.FireEyesCenter };
    this.trail2.tt = 16777215;
    this.emitter1 = new ParticleEmitter(this.target.head, this.trail1);
    this.emitter2 = new ParticleEmitter(this.target.head, this.trail2);
    this.emitter = [this.emitter2, this.emitter1];
  }
  update(a) {
    a =
      this.target.facingDir === Player.FACING_LEFT
        ? this.target.head.p.r - 0.5
        : this.target.head.p.r + 0.5 + Math.PI;
    this.emitter1.offset.x = 6 * Math.cos(a);
    this.emitter1.offset.y = 4 * Math.sin(a);
    this.emitter2.offset.x = this.emitter1.offset.x;
    this.emitter2.offset.y = this.emitter1.offset.y;
  }
}
FaceBlueFireEyes.ID = "fireeyesblue";
var faceyellowfireeyes = {};
class FaceYellowFireEyes extends PIXI.Sprite {
  constructor(a) {
    super();
    this.target = a;
    this.trail1 = { ...ParticleEffects.FireEyes };
    this.trail1.tt = 16776960;
    this.trail2 = { ...ParticleEffects.FireEyesCenter };
    this.trail2.tt = 16777215;
    this.emitter1 = new ParticleEmitter(this.target.head, this.trail1);
    this.emitter2 = new ParticleEmitter(this.target.head, this.trail2);
    this.emitter = [this.emitter2, this.emitter1];
  }
  update(a) {
    a =
      this.target.facingDir === Player.FACING_LEFT
        ? this.target.head.p.r - 0.5
        : this.target.head.p.r + 0.5 + Math.PI;
    this.emitter1.offset.x = 6 * Math.cos(a);
    this.emitter1.offset.y = 4 * Math.sin(a);
    this.emitter2.offset.x = this.emitter1.offset.x;
    this.emitter2.offset.y = this.emitter1.offset.y;
  }
}
FaceYellowFireEyes.ID = "fireeyesyellow";
var facepinkfireeyes = {};
class FacePinkFireEyes extends PIXI.Sprite {
  constructor(a) {
    super();
    this.target = a;
    this.trail1 = { ...ParticleEffects.FireEyes };
    this.trail1.tt = 16738740;
    this.trail2 = { ...ParticleEffects.FireEyesCenter };
    this.trail2.tt = 16777215;
    this.emitter1 = new ParticleEmitter(this.target.head, this.trail1);
    this.emitter2 = new ParticleEmitter(this.target.head, this.trail2);
    this.emitter = [this.emitter2, this.emitter1];
  }
  update(a) {
    a =
      this.target.facingDir === Player.FACING_LEFT
        ? this.target.head.p.r - 0.5
        : this.target.head.p.r + 0.5 + Math.PI;
    this.emitter1.offset.x = 6 * Math.cos(a);
    this.emitter1.offset.y = 4 * Math.sin(a);
    this.emitter2.offset.x = this.emitter1.offset.x;
    this.emitter2.offset.y = this.emitter1.offset.y;
  }
}
FacePinkFireEyes.ID = "fireeyespink";
var faceorangefireeyes = {};
class FaceOrangeFireEyes extends PIXI.Sprite {
  constructor(a) {
    super();
    this.target = a;
    this.trail1 = { ...ParticleEffects.FireEyes };
    this.trail1.tt = 16753920;
    this.trail2 = { ...ParticleEffects.FireEyesCenter };
    this.trail2.tt = 16777215;
    this.emitter1 = new ParticleEmitter(this.target.head, this.trail1);
    this.emitter2 = new ParticleEmitter(this.target.head, this.trail2);
    this.emitter = [this.emitter2, this.emitter1];
  }
  update(a) {
    a =
      this.target.facingDir === Player.FACING_LEFT
        ? this.target.head.p.r - 0.5
        : this.target.head.p.r + 0.5 + Math.PI;
    this.emitter1.offset.x = 6 * Math.cos(a);
    this.emitter1.offset.y = 4 * Math.sin(a);
    this.emitter2.offset.x = this.emitter1.offset.x;
    this.emitter2.offset.y = this.emitter1.offset.y;
  }
}
FaceOrangeFireEyes.ID = "fireeyesorange";
var customface = {};
class CustomFace extends PIXI.Sprite {
  constructor() {
    super();
  }
  update() {}
}
CustomFace.Map = {
  fireeyes: FaceFireEyes,
  fireeyesred: FaceRedFireEyes,
  fireeyesgreen: FaceGreenFireEyes,
  fireeyesblue: FaceBlueFireEyes,
  fireeyesyellow: FaceYellowFireEyes,
  fireeyespink: FacePinkFireEyes,
  fireeyesorange: FaceOrangeFireEyes,
};
var quadmesh = {};
class QuadMesh extends PIXI.Mesh {
  constructor(a) {
    super(QuadMesh.Geometry, a);
  }
}
QuadMesh.Geometry = new PIXI.Geometry();
QuadMesh.Geometry.addAttribute("aVertexPosition", [-45, -45, 45, -45, 45, 45, -45, 45], 2);
QuadMesh.Geometry.addAttribute("aTextureCoord", [0, 0, 1, 0, 1, 1, 0, 1], 2);
QuadMesh.Geometry.addIndex([0, 1, 2, 0, 2, 3]);
QuadMesh.VertexSource =
  "\nprecision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat3 translationMatrix;\nuniform mat3 projectionMatrix;\nvarying vec2 vUvs;\nvoid main() {\n    vUvs = aTextureCoord;\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n}";
QuadMesh.FragmentSource =
  "\nprecision highp float;\nvarying vec2 vUvs;\nuniform vec4 color;\nuniform sampler2D uSampler2;\nvoid main() {\n\tvec4 pixel = texture2D(uSampler2, vUvs);\n\tpixel *= color;\n    gl_FragColor = vec4(pixel.rgb * pixel.a, pixel.a);\n}";
QuadMesh.Program = new PIXI.Program(QuadMesh.VertexSource, QuadMesh.FragmentSource, "energy");
var energy = {};
class Energy extends QuadMesh {
  constructor(a, b, c, d, e) {
    super(new PIXI.MeshMaterial(App.CombinedTextures[b]));
    this.target = a;
    this.trail = e ? { ...e } : { ...ParticleEffects.EnergyTrail };
    this.trail.tex = c;
    this.tint = this.trail.tt = d;
    this.emitter = new ParticleEmitter(this.target.torsolower, this.trail);
    this.scale.x = this.scale.y = 0.9;
  }
  update(a) {
    this.x = a.x;
    this.y = a.y;
    this.rotation = Math.random() * Math.PI * 2;
    AudioManager.PlayEffect(AudioEffects.Fly, this.target);
  }
}
Energy.Material = {};
Energy.Map = {
  vacuum: EnergyVacuum,
  dragon: EnergyDragon,
  jetfeet: EnergyJetFeet,
  jetfeet2: EnergyJetFeet2,
};
var gameshape = {};
GameShape = { BASE: 0, CIRCLE: 1, POLYGON: 2, RECTANGLE: 3 };
var gameobject = {};
class GameObject {
  constructor(a) {
    this.id = a.id;
    this.p = a.p;
    this.g = a.g ?? {};
    this.p.id = a.id;
    this.audio = a.audio;
    this.contact = a.contact;
    this.visual = void 0;
  }
  update() {
    this.visual.x = this.p.x;
    this.visual.y = this.p.y;
    this.visual.rotation = this.p.r;
    this.visual.animate && this.visual.animate(this.p);
  }
}
var entitycategory = {};
const EntityCategory = {
    STATIC_WORLD: 1,
    DYNAMIC_WORLD: 2,
    OPEN_WORLD: 4,
    BARRIER: 8,
    AGENT: 16,
    BULLET: 32,
    LIMB: 64,
    ITEM: 128,
    LOCAL: 256,
    ZONE: 512,
    ENTITY: 1024,
    GRENADE: 2048,
    BRIDGE: 4096,
    PARTICLE: 8192,
    OBJECTIVE: 16384,
    THROWN: 32768,
    BOT: 65536,
    ITEM_BARRIER: 131072,
    BOT_BULLET: 262144,
    LOCAL2: 524288,
  },
  MaskBits = {};
MaskBits[EntityCategory.STATIC_WORLD] = 16777215;
MaskBits[EntityCategory.DYNAMIC_WORLD] = 16777215;
MaskBits[EntityCategory.OPEN_WORLD] = 0;
MaskBits[EntityCategory.BARRIER] =
  EntityCategory.STATIC_WORLD |
  EntityCategory.BULLET |
  EntityCategory.GRENADE |
  EntityCategory.BOT_BULLET;
MaskBits[EntityCategory.AGENT] =
  EntityCategory.DYNAMIC_WORLD |
  EntityCategory.STATIC_WORLD |
  EntityCategory.ITEM |
  EntityCategory.BRIDGE;
MaskBits[EntityCategory.BULLET] =
  EntityCategory.BOT |
  EntityCategory.LOCAL |
  EntityCategory.LIMB |
  EntityCategory.DYNAMIC_WORLD |
  EntityCategory.STATIC_WORLD |
  EntityCategory.BARRIER |
  EntityCategory.GRENADE |
  EntityCategory.ITEM |
  EntityCategory.THROWN;
MaskBits[EntityCategory.LIMB] =
  EntityCategory.BULLET | EntityCategory.GRENADE | EntityCategory.BOT_BULLET;
MaskBits[EntityCategory.ITEM] =
  EntityCategory.DYNAMIC_WORLD |
  EntityCategory.STATIC_WORLD |
  EntityCategory.AGENT |
  EntityCategory.BRIDGE |
  EntityCategory.BULLET |
  EntityCategory.BOT_BULLET |
  EntityCategory.GRENADE |
  EntityCategory.THROWN |
  EntityCategory.ITEM_BARRIER;
MaskBits[EntityCategory.LOCAL] =
  EntityCategory.BULLET |
  EntityCategory.BOT_BULLET |
  EntityCategory.LOCAL |
  EntityCategory.STATIC_WORLD;
MaskBits[EntityCategory.ZONE] = EntityCategory.ENTITY;
MaskBits[EntityCategory.ENTITY] = EntityCategory.ZONE | EntityCategory.OBJECTIVE;
MaskBits[EntityCategory.GRENADE] =
  EntityCategory.BOT |
  EntityCategory.GRENADE |
  EntityCategory.DYNAMIC_WORLD |
  EntityCategory.BULLET |
  EntityCategory.BOT_BULLET |
  EntityCategory.STATIC_WORLD |
  EntityCategory.AGENT |
  EntityCategory.ITEM |
  EntityCategory.BARRIER |
  EntityCategory.LIMB;
MaskBits[EntityCategory.BRIDGE] =
  EntityCategory.STATIC_WORLD |
  EntityCategory.DYNAMIC_WORLD |
  EntityCategory.AGENT |
  EntityCategory.ITEM;
MaskBits[EntityCategory.PARTICLE] = EntityCategory.STATIC_WORLD;
MaskBits[EntityCategory.OBJECTIVE] =
  EntityCategory.STATIC_WORLD | EntityCategory.DYNAMIC_WORLD | EntityCategory.ENTITY;
MaskBits[EntityCategory.THROWN] =
  EntityCategory.STATIC_WORLD |
  EntityCategory.DYNAMIC_WORLD |
  EntityCategory.ITEM |
  EntityCategory.BULLET |
  EntityCategory.BOT_BULLET |
  EntityCategory.THROWN;
MaskBits[EntityCategory.BOT] =
  EntityCategory.STATIC_WORLD |
  EntityCategory.DYNAMIC_WORLD |
  EntityCategory.BRIDGE |
  EntityCategory.BULLET |
  EntityCategory.GRENADE |
  EntityCategory.BOT;
MaskBits[EntityCategory.ITEM_BARRIER] = EntityCategory.STATIC_WORLD | EntityCategory.ITEM;
MaskBits[EntityCategory.BOT_BULLET] =
  EntityCategory.BOT |
  EntityCategory.LOCAL |
  EntityCategory.LIMB |
  EntityCategory.DYNAMIC_WORLD |
  EntityCategory.STATIC_WORLD |
  EntityCategory.BARRIER |
  EntityCategory.GRENADE |
  EntityCategory.ITEM |
  EntityCategory.THROWN;
MaskBits[EntityCategory.LOCAL2] = EntityCategory.STATIC_WORLD | EntityCategory.LOCAL2;
var ghost = {};
class Ghost {
  constructor(a) {
    this.id = a.id;
    this.prefab = PrefabList.Ghost;
    this.p = {
      contact: [this.id],
      prefab: ShapeOptions.COMPOUND,
      type: b2BodyType.b2_dynamicBody,
      isBot: !0,
      id: this.id,
      fixedRotation: !0,
      sleepingAllowed: !1,
      wd: 5,
      bu: 20,
      gs: 0,
      bullet: !1,
      sh: Ghost.Shapes,
      x: a.p.x,
      y: a.p.y,
      vx: a.p.vx,
      vy: a.p.vy,
      gi: -Base62Decode(a.id),
    };
    let b = new ParticleEmitter(null, [ParticleEffects.GlowSquare]);
    b.probability = 0.2;
    this.g = {
      type: PrefabList.Ghost,
      scale: { x: 0.3 * (a.l ? -1 : 1), y: 0.3 },
      offset: { x: 0.5, y: 0.5 },
      emitters: [b],
      onImpact: [],
      onRemove: [
        ParticleEffects.GhostBotDebris1,
        ParticleEffects.GhostBotDebris2,
        ParticleEffects.GhostBotDebris3,
        ParticleEffects.GhostBotExplosion,
        ParticleEffects.GhostBotDamage,
      ],
      onDamage: [ParticleEffects.GhostBotDamage],
    };
    this.audio = Ghost.Audio;
  }
}
Ghost.Shapes = [
  {
    t: GameShape.POLYGON,
    v: [
      { x: -4, y: 14 },
      { x: 26, y: 0 },
      { x: -4, y: -14 },
    ],
    c: EntityCategory.BOT,
    fr: 0.001,
    re: 0.5,
    s: !1,
    d: 2,
  },
];
Ghost.Audio = { onRemove: [AudioEffects.BotDeath] };
var prefablist = {},
  PrefabList = {
    Fist: -1,
    ShotgunPellet: 1,
    SubmachineGunBullet: 2,
    LauncherNade: 3,
    BarrettBullet: 4,
    ShockRifleBullet: 5,
    PulseGunBullet: 6,
    FlameThrowerLiquid: 7,
    RPGRocket: 8,
    RifleBullet: 9,
    LaserGunBullet: 10,
    AK47Bullet: 12,
    Nade: 20,
    ClusterNade: 21,
    ClusterNadeFragment: 22,
    ShurikenBlade: 23,
    SnowballProjectile: 25,
    MinigunBullet: 26,
    MAC10Bullet: 28,
    Arrow: 29,
    RLRocket: 30,
    CarbineBullet: 31,
    GhostLaser: 32,
    X75Nade: 75,
    TinyShrapnel: 101,
    GhostBotDebris1: 102,
    GhostBotDebris2: 103,
    GhostBotDebris3: 104,
    Rifle: 200,
    Shotgun: 201,
    NadeLauncher: 202,
    SubmachineGun: 203,
    Chainsaw: 204,
    Barrett: 205,
    ShockRifle: 207,
    PulseGun: 208,
    FlameThrower: 209,
    RPG: 210,
    LaserGun: 211,
    Shuriken: 212,
    LinkGun: 213,
    DesertEagle: 214,
    Snowball: 215,
    AK47: 216,
    Minigun: 217,
    X75: 218,
    MAC10: 219,
    Bow: 220,
    RocketLauncher: 221,
    Carbine: 222,
    Bouncyball: 300,
    HealthBox: 400,
    NadeBox: 401,
    ClusterNadeBox: 402,
    SnowballBox: 403,
    ShurikenBox: 404,
    Flag: 600,
    ShotgunAmmo: 700,
    RifleAmmo: 701,
    AK47Ammo: 702,
    BarrettAmmo: 703,
    ChainsawAmmo: 704,
    DesertEagleAmmo: 705,
    FlameThrowerAmmo: 706,
    LaserGunAmmo: 707,
    LinkGunAmmo: 708,
    MAC10Ammo: 709,
    MinigunAmmo: 710,
    NadeLauncherAmmo: 711,
    PulseGunAmmo: 712,
    RPGAmmo: 713,
    ShockRifleAmmo: 714,
    SMGAmmo: 715,
    X75Ammo: 716,
    Gold: 800,
    Ghost: 900,
  },
  PrefabClasses = {
    1: ShotgunPellet,
    2: SubmachineGunBullet,
    3: LauncherNade,
    4: BarrettBullet,
    5: ShockRifleBullet,
    6: PulseGunBullet,
    7: FlameThrowerLiquid,
    8: RPGRocket,
    9: RifleBullet,
    10: LaserGunBullet,
    12: AK47Bullet,
    20: Nade,
    21: ClusterNade,
    22: ClusterNadeFragment,
    23: ShurikenBlade,
    24: DesertEagleBullet,
    25: SnowballProjectile,
    26: MinigunBullet,
    27: X75Nade,
    28: MAC10Bullet,
    29: Arrow,
    30: RLRocket,
    31: CarbineBullet,
    32: GhostLaser,
    101: TinyShrapnel,
    102: GhostBotDebris1,
    103: GhostBotDebris2,
    104: GhostBotDebris3,
    200: Rifle,
    201: Shotgun,
    202: NadeLauncher,
    203: SubmachineGun,
    204: Chainsaw,
    205: Barrett,
    207: ShockRifle,
    208: PulseGun,
    209: FlameThrower,
    210: RPG,
    211: LaserGun,
    213: LinkGun,
    214: DesertEagle,
    216: AK47,
    217: Minigun,
    218: X75,
    219: MAC10,
    220: Bow,
    221: RocketLauncher,
    222: Carbine,
    300: Bouncyball,
    400: HealthBox,
    401: NadeBox,
    402: ClusterNadeBox,
    403: SnowballBox,
    404: ShurikenBox,
    600: Flag,
    700: ShotgunAmmo,
    701: RifleAmmo,
    702: AK47Ammo,
    703: BarrettAmmo,
    704: ChainsawAmmo,
    705: DesertEagleAmmo,
    706: FlameThrowerAmmo,
    707: LaserGunAmmo,
    708: LinkGunAmmo,
    709: MAC10Ammo,
    710: MinigunAmmo,
    711: NadeLauncherAmmo,
    712: PulseGunAmmo,
    713: RPGAmmo,
    714: ShockRifleAmmo,
    715: SMGAmmo,
    716: X75Ammo,
    800: Gold,
    900: Ghost,
  };
var shockwavefilter = {};
class ShockwaveFilter extends PIXI.Filter {
  constructor(a, b, c = 0) {
    super(ShockwaveFilter.VertexShader, ShockwaveFilter.FragmentShader);
    this.center = a;
    Object.assign(this, ShockwaveFilter.Defaults, b);
    this.time = c;
  }
  apply(a, b, c, d) {
    this.uniforms.time = this.time;
    a.applyFilter(this, b, c, d);
  }
  get center() {
    return this.uniforms.center;
  }
  set center(a) {
    this.uniforms.center = a;
  }
  get amplitude() {
    return this.uniforms.amplitude;
  }
  set amplitude(a) {
    this.uniforms.amplitude = a;
  }
  get wavelength() {
    return this.uniforms.wavelength;
  }
  set wavelength(a) {
    this.uniforms.wavelength = a;
  }
  get brightness() {
    return this.uniforms.brightness;
  }
  set brightness(a) {
    this.uniforms.brightness = a;
  }
  get speed() {
    return this.uniforms.speed;
  }
  set speed(a) {
    this.uniforms.speed = a;
  }
  get radius() {
    return this.uniforms.radius;
  }
  set radius(a) {
    this.uniforms.radius = a;
  }
}
ShockwaveFilter.Defaults = {
  amplitude: 30,
  wavelength: 160,
  brightness: 1,
  speed: 500,
  radius: -1,
};
ShockwaveFilter.VertexShader =
  "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}";
ShockwaveFilter.FragmentShader =
  "varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nuniform vec2 center;\n\nuniform float amplitude;\nuniform float wavelength;\n// uniform float power;\nuniform float brightness;\nuniform float speed;\nuniform float radius;\n\nuniform float time;\n\nconst float PI = 3.14159;\n\nvoid main()\n{\n    float halfWavelength = wavelength * 0.5 / filterArea.x;\n    float maxRadius = radius / filterArea.x;\n    float currentRadius = time * speed / filterArea.x;\n\n    float fade = 1.0;\n\n    if (maxRadius > 0.0) {\n        if (currentRadius > maxRadius) {\n            gl_FragColor = texture2D(uSampler, vTextureCoord);\n            return;\n        }\n        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);\n    }\n\n    vec2 dir = vec2(vTextureCoord - center / filterArea.xy);\n    dir.y *= filterArea.y / filterArea.x;\n    float dist = length(dir);\n\n    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {\n        gl_FragColor = texture2D(uSampler, vTextureCoord);\n        return;\n    }\n\n    vec2 diffUV = normalize(dir);\n\n    float diff = (dist - currentRadius) / halfWavelength;\n\n    float p = 1.0 - pow(abs(diff), 2.0);\n\n    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );\n    float powDiff = 1.25 * sin(diff * PI) * p * ( amplitude * fade );\n\n    vec2 offset = diffUV * powDiff / filterArea.xy;\n\n    // Do clamp :\n    vec2 coord = vTextureCoord + offset;\n    vec2 clampedCoord = clamp(coord, filterClamp.xy, filterClamp.zw);\n    vec4 color = texture2D(uSampler, clampedCoord);\n    if (coord != clampedCoord) {\n        color *= max(0.0, 1.0 - length(coord - clampedCoord));\n    }\n\n    // No clamp :\n    // gl_FragColor = texture2D(uSampler, vTextureCoord + offset);\n\n    color.rgb *= 1.0 + (brightness - 1.0) * p * fade;\n\n    gl_FragColor = color;\n}\n";
var particleeffects = {},
  PP = {
    AMOUNT: "n",
    TEXTURE: "tex",
    TTL: "ttl",
    SCALE: "s",
    SCALE_CHANGE: "vs",
    SCALE_RANDOM: "rs",
    ALPHA: "a",
    ALPHA_CHANGE: "va",
    GRAVITY_SCALE: "gs",
    ROTATION: "_r",
    ANGULAR: "vr",
    ANGULAR_RANDOM: "vrs",
    VELOCITY_RANDOM: "randV",
    ORIGIN: "origin",
    FOREGROUND: "_fg",
    FILTERS: "filters",
    ANCHOR: "anchor",
    ANCHOR_RELATIVE: "arl",
    COLLIDE: "collide",
    NORMAL: "normal",
    VELOCITY_MULTIPLIER: "vm",
    VELOCITY: "_v",
    EJECTION_ANGLE: "ea",
    EJECTION_DELTA: "ed",
    DELTA_RANDOM: "dr",
    VELOCITY_ALPHA_TTL: "vat",
    PREFAB: "prefab",
    TYPE: "type",
    RAY_DELTA: "delta",
    LOCAL: "local",
    AMOUNT_RANDOM: "rn",
    SCALE_FACTOR: "sf",
    NORMAL_MULTIPLIER: "nm",
    APPEAR: "_appear",
    CAM_JERK: "cj",
    CAM_SHAKE: "cs",
    GLOBAL: "gl",
    AUDIO: "au",
    TINT: "tt",
    DYNAMIC_ALT: "da",
    BUFFER_ID: "bi",
    ROPE: "rp",
    RANDOM_OFFSET: "ro",
  };
const ParticleEffects = { LOCAL_LINK_GUN: 1, LOCAL_SAW: 2, LOCAL_PUNCH: 3, LOCAL_EXP: 4 };
PE = ParticleEffects.TestCross = {};
PE[PP.TEXTURE] = "testcross";
PE[PP.TTL] = 200;
PE[PP.SCALE] = 0.5;
PE[PP.ALPHA] = 0.5;
PE[PP.GRAVITY_SCALE] = 0;
PE = ParticleEffects.TunnelSparks = {};
PE[PP.TEXTURE] = "sparks2";
PE[PP.ANCHOR] = { x: 0.5, y: 0.5 };
PE[PP.TTL] = 20;
PE[PP.SCALE] = 1.5;
PE[PP.SCALE_CHANGE] = -0.05;
PE[PP.ALPHA] = 1e-4;
PE[PP.ROTATION] = 6;
PE[PP.ALPHA_CHANGE] = 0.04;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.ArrowImpactDynamic = {};
PE[PP.TEXTURE] = "arrow";
PE[PP.TTL] = 40;
PE[PP.SCALE] = 0.6;
PE[PP.ALPHA] = 1;
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.ROTATION] = 7;
PE[PP.ANCHOR] = { x: 0.6, y: 0.5 };
PE[PP.VELOCITY] = 5;
PE[PP.VELOCITY_MULTIPLIER] = 0.1;
PE[PP.ALPHA_CHANGE] = -0.025;
PE[PP.ANGULAR] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.3, max: 0.6 };
PE[PP.BUFFER_ID] = "arrow2";
PE[PP.COLLIDE] = !0;
PE = ParticleEffects.ArrowImpactStatic = {};
PE[PP.TEXTURE] = "arrow";
PE[PP.TTL] = 300;
PE[PP.SCALE] = 0.6;
PE[PP.ALPHA] = 1;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.ROTATION] = 7;
PE[PP.ANCHOR] = { x: 0.6, y: 0.5 };
PE[PP.VELOCITY_ALPHA_TTL] = 10;
PE[PP.ALPHA_CHANGE] = 0;
PE[PP.DYNAMIC_ALT] = ParticleEffects.ArrowImpactDynamic;
PE = ParticleEffects.XP10 = {};
PE[PP.TEXTURE] = "10xp";
PE[PP.TTL] = 40;
PE[PP.ALPHA] = 1.6;
PE[PP.ALPHA_CHANGE] = -0.04;
PE[PP.SCALE] = 0.3;
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.FOREGROUND] = !0;
PE[PP.VELOCITY_RANDOM] = { minX: -0.5, rangeX: 1, minY: -1, rangeY: 0.01 };
PE = ParticleEffects.PlayerSpawn = {};
PE[PP.AMOUNT] = 5;
PE[PP.TEXTURE] = "playerspawn";
PE[PP.TTL] = 30;
PE[PP.ALPHA] = 0.3;
PE[PP.SCALE] = 2;
PE[PP.SCALE_CHANGE] = -0.025;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.05, max: 0.1 };
PE[PP.GRAVITY_SCALE] = 0.01;
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.ShockRifleOrbImpact = {};
PE[PP.TEXTURE] = "shockrifle_orb_impact";
PE[PP.TTL] = 6;
PE[PP.SCALE] = 0.8;
PE[PP.SCALE_CHANGE] = 0.05;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 2;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.Electricity1 = {};
PE[PP.TEXTURE] = "electricity1";
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.8;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.GhostLaserTrail = {};
PE[PP.TEXTURE] = "flare1";
PE[PP.TTL] = 10;
PE[PP.SCALE] = 0.5;
PE[PP.SCALE_CHANGE] = -0.05;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = 0.1;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE = ParticleEffects.Electricity2 = {};
PE[PP.TEXTURE] = "electricity1";
PE[PP.TTL] = 20;
PE[PP.SCALE] = 0.4;
PE[PP.SCALE_CHANGE] = -0.02;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.05;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.Plasma1 = {};
PE[PP.TEXTURE] = "plasma1";
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.35;
PE[PP.SCALE_RANDOM] = { min: 0.35, max: 0.7 };
PE[PP.SCALE_CHANGE] = 1e-5;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.PlasmaElectric = {};
PE[PP.TEXTURE] = "plasma_electric";
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.5;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.FOREGROUND] = !0;
PE[PP.SCALE_RANDOM] = { min: 0.3, max: 0.9 };
PE = ParticleEffects.PlasmaSparks = {};
PE[PP.TEXTURE] = "plasma_electric";
PE[PP.TTL] = 100;
PE[PP.SCALE] = 0.5;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.FOREGROUND] = !0;
PE[PP.SCALE_RANDOM] = { min: 0.3, max: 0.9 };
PE[PP.ORIGIN] = 4;
PE = ParticleEffects.NadeExplosion = {};
PE[PP.TEXTURE] = "explosion";
PE[PP.TTL] = 16;
PE[PP.SCALE] = 0.2;
PE[PP.SCALE_CHANGE] = 0.09;
PE[PP.ALPHA_CHANGE] = -0.015;
PE[PP.ROTATION] = 2;
PE[PP.ORIGIN] = "";
PE[PP.FOREGROUND] = !0;
PE[PP.FILTERS] = [ShockwaveFilter];
PE[PP.CAM_SHAKE] = 5;
PE[PP.GLOBAL] = !0;
PE = ParticleEffects.PlasmaNadeExplosion = {};
PE[PP.TEXTURE] = "plasma_exp";
PE[PP.TTL] = 8;
PE[PP.SCALE] = 0.1;
PE[PP.SCALE_CHANGE] = 0.15;
PE[PP.ALPHA] = 1.15;
PE[PP.ALPHA_CHANGE] = -0.1;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.2, max: 0.4 };
PE[PP.ORIGIN] = "";
PE[PP.FOREGROUND] = !0;
PE[PP.FILTERS] = [ShockwaveFilter];
PE[PP.CAM_SHAKE] = 2;
PE[PP.GLOBAL] = !0;
PE = ParticleEffects.TeleportTwirl = {};
PE[PP.TEXTURE] = "twirl";
PE[PP.TTL] = 16;
PE[PP.SCALE] = 1;
PE[PP.ROTATION] = 2;
PE[PP.ORIGIN] = "";
PE[PP.ALPHA] = 1e-5;
PE[PP.ALPHA_CHANGE] = 0;
PE[PP.FOREGROUND] = !0;
PE[PP.GLOBAL] = !0;
PE = ParticleEffects.ClusterNadeExplosion = {};
PE[PP.TEXTURE] = "explosion3";
PE[PP.TTL] = 10;
PE[PP.SCALE] = 0.04;
PE[PP.SCALE_CHANGE] = 0.06;
PE[PP.ALPHA_CHANGE] = -0.015;
PE[PP.ROTATION] = 2;
PE[PP.ORIGIN] = "";
PE[PP.FOREGROUND] = !0;
PE[PP.FILTERS] = [ShockwaveFilter];
PE[PP.CAM_SHAKE] = 2;
PE[PP.GLOBAL] = !0;
PE = ParticleEffects.LauncherNadeExplosion = {};
PE[PP.TEXTURE] = "explosion2";
PE[PP.TTL] = 14;
PE[PP.SCALE] = 0.08;
PE[PP.SCALE_CHANGE] = 0.05;
PE[PP.ALPHA_CHANGE] = -0.07;
PE[PP.ROTATION] = 2;
PE[PP.ORIGIN] = "";
PE[PP.FOREGROUND] = !0;
PE[PP.FILTERS] = [ShockwaveFilter];
PE[PP.CAM_SHAKE] = 5;
PE[PP.GLOBAL] = !0;
PE = ParticleEffects.RLNadeExplosion = {};
PE[PP.TEXTURE] = "explosion";
PE[PP.TTL] = 14;
PE[PP.SCALE] = 0.2;
PE[PP.SCALE_CHANGE] = 0.1;
PE[PP.ALPHA_CHANGE] = -0.07;
PE[PP.ROTATION] = 2;
PE[PP.ORIGIN] = "";
PE[PP.FOREGROUND] = !0;
PE[PP.FILTERS] = [ShockwaveFilter];
PE[PP.CAM_SHAKE] = 3;
PE[PP.GLOBAL] = !0;
PE = ParticleEffects.NadeExplosionSmoke = {};
PE[PP.TEXTURE] = "smoke1";
PE[PP.TTL] = 75;
PE[PP.SCALE] = 0.6;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 1.6 };
PE[PP.SCALE_CHANGE] = 0.02;
PE[PP.ALPHA] = 0.8;
PE[PP.ALPHA_CHANGE] = -0.0106;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.002, max: 0.004 };
PE[PP.GRAVITY_SCALE] = -0.02;
PE[PP.FOREGROUND] = !0;
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE[PP.TINT] = 16777215;
PE = ParticleEffects.RLSmoke = {};
PE[PP.TEXTURE] = "smoke1";
PE[PP.TTL] = 50;
PE[PP.SCALE] = 0.6;
PE[PP.SCALE_RANDOM] = { min: 0.1, max: 0.4 };
PE[PP.SCALE_CHANGE] = 0.02;
PE[PP.ALPHA] = 0.8;
PE[PP.ALPHA_CHANGE] = -0.016;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.002, max: 0.004 };
PE[PP.GRAVITY_SCALE] = -0.01;
PE[PP.FOREGROUND] = !0;
PE[PP.VELOCITY_RANDOM] = { minX: -1.5, rangeX: 3, minY: -1.5, rangeY: 3 };
PE[PP.TINT] = 16777215;
PE[PP.COLLIDE] = !0;
PE = ParticleEffects.ClusterNadeExplosionSmoke = {};
PE[PP.TEXTURE] = "smoke1";
PE[PP.TTL] = 75;
PE[PP.SCALE] = 0.2;
PE[PP.SCALE_RANDOM] = { min: 0.3, max: 1 };
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.ALPHA] = 0.8;
PE[PP.ALPHA_CHANGE] = -0.0106;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.002, max: 0.004 };
PE[PP.GRAVITY_SCALE] = -0.02;
PE[PP.FOREGROUND] = !0;
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE[PP.TINT] = 16777215;
PE = ParticleEffects.NadeExplosionParticles = {};
PE[PP.AMOUNT] = 16;
PE[PP.TEXTURE] = "tinyspark";
PE[PP.TTL] = 100;
PE[PP.SCALE] = 0.4;
PE[PP.SCALE_RANDOM] = { min: 0.6, max: 1.8 };
PE[PP.ALPHA_CHANGE] = -0.01;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY] = 5;
PE[PP.GRAVITY_SCALE] = 0.3;
PE[PP.FOREGROUND] = !0;
PE[PP.VELOCITY_RANDOM] = { minX: -20, rangeX: 40, minY: -30, rangeY: 40 };
PE = ParticleEffects.CaptureObjectiveParticles = {};
PE[PP.AMOUNT] = 10;
PE[PP.TEXTURE] = "playercapture";
PE[PP.TTL] = 10;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.1;
PE[PP.SCALE] = 0.1;
PE[PP.SCALE_CHANGE] = 0.05;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = -1;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.WaterBubbles = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "waterbubble";
PE[PP.TTL] = 120;
PE[PP.ALPHA] = 0.9;
PE[PP.ALPHA_CHANGE] = -0.045;
PE[PP.SCALE_RANDOM] = { min: 0.04, max: 0.14 };
PE[PP.SCALE_CHANGE] = -3e-4;
PE[PP.GRAVITY_SCALE] = -0.002;
PE[PP.FOREGROUND] = !0;
PE[PP.VELOCITY_RANDOM] = { minX: -0.1, rangeX: 0.2, minY: -0.1, rangeY: 0.2 };
PE = ParticleEffects.RifleMuzzleFlash = {};
PE[PP.TEXTURE] = "muzzleflash1";
PE[PP.ANCHOR] = { x: 0, y: 0.5 };
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.25;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 3;
PE[PP.ORIGIN] = 1;
PE[PP.FOREGROUND] = !0;
PE[PP.CAM_JERK] = 3;
PE = ParticleEffects.X75MuzzleFlash = {};
PE[PP.TEXTURE] = "muzzleflash2";
PE[PP.ANCHOR] = { x: 0, y: 0.5 };
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.25;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 3;
PE[PP.ORIGIN] = 1;
PE[PP.FOREGROUND] = !0;
PE[PP.CAM_JERK] = 3;
PE = ParticleEffects.LaserGunMuzzleFlash = {};
PE[PP.TEXTURE] = "lasermuzzleflash1";
PE[PP.ANCHOR] = { x: 0, y: 0.5 };
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.75;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 3;
PE[PP.ORIGIN] = 1;
PE[PP.FOREGROUND] = !1;
PE[PP.CAM_JERK] = 3;
PE = ParticleEffects.LinkGunMuzzleFlash = {};
PE[PP.TEXTURE] = "link_gun_muzzle_flash";
PE[PP.ANCHOR] = { x: 0.3, y: 0.5 };
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.45;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 3;
PE[PP.ORIGIN] = 1;
PE[PP.FOREGROUND] = !0;
PE[PP.CAM_JERK] = 3;
PE = ParticleEffects.GreenLaserImpact = {};
PE[PP.TEXTURE] = "greenlaserimpact";
PE[PP.TTL] = 6;
PE[PP.SCALE] = 0.3;
PE[PP.SCALE_CHANGE] = 0.05;
PE[PP.ALPHA_CHANGE] = -0.06;
PE[PP.ROTATION] = 2;
PE[PP.ORIGIN] = "";
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.ShockRifleMuzzleFlash = {};
PE[PP.TEXTURE] = "shockriflemuzzleflash";
PE[PP.ANCHOR] = { x: 0, y: 0.5 };
PE[PP.TTL] = 3;
PE[PP.SCALE] = 0.8;
PE[PP.ALPHA_CHANGE] = -0.33;
PE[PP.ROTATION] = 3;
PE[PP.ORIGIN] = 1;
PE[PP.FOREGROUND] = !0;
PE[PP.CAM_JERK] = 3;
PE = ParticleEffects.SMGMuzzleFlash = {};
PE[PP.TEXTURE] = "muzzleflash1";
PE[PP.ANCHOR] = { x: 0, y: 0.5 };
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.15;
PE[PP.ROTATION] = 3;
PE[PP.ORIGIN] = 1;
PE[PP.FOREGROUND] = !0;
PE[PP.CAM_JERK] = 3;
PE = ParticleEffects.MAC10MuzzleFlash = {};
PE[PP.TEXTURE] = "muzzleflash1";
PE[PP.ANCHOR] = { x: 0, y: 0.5 };
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.11;
PE[PP.ROTATION] = 3;
PE[PP.ORIGIN] = 1;
PE[PP.FOREGROUND] = !0;
PE[PP.CAM_JERK] = 3;
PE = ParticleEffects.PulseGunMuzzleFlash = {};
PE[PP.TEXTURE] = "pulsegunmuzzleflash";
PE[PP.ANCHOR] = { x: 0, y: 0.5 };
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.3;
PE[PP.ROTATION] = 3;
PE[PP.ORIGIN] = 1;
PE[PP.FOREGROUND] = !0;
PE[PP.CAM_JERK] = 3;
PE = ParticleEffects.ShotgunMuzzleFlash = {};
PE[PP.TEXTURE] = "shotgunmuzzleflash";
PE[PP.ANCHOR] = { x: 0, y: 0.5 };
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.9;
PE[PP.ROTATION] = 3;
PE[PP.ORIGIN] = 1;
PE[PP.FOREGROUND] = !0;
PE[PP.CAM_JERK] = 4;
PE = ParticleEffects.NadeLauncherFireSparks = {};
PE[PP.AMOUNT] = 5;
PE[PP.TEXTURE] = "tinyspark";
PE[PP.TTL] = 30;
PE[PP.SCALE] = 0.6;
PE[PP.SCALE_CHANGE] = -0.01;
PE[PP.ALPHA_CHANGE] = -0.03;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY] = 1;
PE[PP.GRAVITY_SCALE] = 0.2;
PE[PP.COLLIDE] = !0;
PE[PP.CAM_JERK] = 4;
PE = ParticleEffects.LargeRicochet = {};
PE[PP.AMOUNT] = 15;
PE[PP.TEXTURE] = "tinyspark";
PE[PP.TTL] = 100;
PE[PP.SCALE] = 0.3;
PE[PP.SCALE_CHANGE] = 0;
PE[PP.ALPHA] = 0.95;
PE[PP.ALPHA_CHANGE] = -0.01;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY_MULTIPLIER] = 0.01;
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.VELOCITY_RANDOM] = { minX: -8, rangeX: 16, minY: -8, rangeY: 16 };
PE[PP.COLLIDE] = !0;
PE[PP.NORMAL] = !0;
PE = ParticleEffects.MediumRicochet = {};
PE[PP.AMOUNT] = 5;
PE[PP.TEXTURE] = "tinyspark";
PE[PP.TTL] = 40;
PE[PP.SCALE] = 0.4;
PE[PP.SCALE_CHANGE] = 0;
PE[PP.SCALE_RANDOM] = { min: 0.7, max: 1 };
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.01;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY] = 5;
PE[PP.VELOCITY_MULTIPLIER] = 0.05;
PE[PP.GRAVITY_SCALE] = 0.2;
PE[PP.VELOCITY_RANDOM] = { minX: -8, rangeX: 16, minY: -8, rangeY: 16 };
PE[PP.COLLIDE] = !0;
PE[PP.NORMAL] = !0;
PE = ParticleEffects.SmallRicochet = {};
PE[PP.AMOUNT] = 5;
PE[PP.TEXTURE] = "spark";
PE[PP.TTL] = 30;
PE[PP.VELOCITY] = 8;
PE[PP.GRAVITY_SCALE] = 0.2;
PE[PP.SCALE] = 0.7;
PE[PP.SCALE_RANDOM] = { min: 0.7, max: 1 };
PE[PP.ALPHA] = 0.6;
PE[PP.ALPHA_CHANGE] = -0.02;
PE[PP.NORMAL_MULTIPLIER] = 4;
PE[PP.VELOCITY_RANDOM] = { minX: -2, rangeX: 4, minY: -2, rangeY: 4 };
PE = ParticleEffects.TinyRicochet = {};
PE[PP.AMOUNT] = 3;
PE[PP.TEXTURE] = "tinyspark";
PE[PP.TTL] = 30;
PE[PP.VELOCITY] = 8;
PE[PP.GRAVITY_SCALE] = 0.2;
PE[PP.SCALE] = 0.4;
PE[PP.SCALE_RANDOM] = { min: 0.7, max: 1 };
PE[PP.ALPHA] = 0.6;
PE[PP.ROTATION] = 10;
PE[PP.ALPHA_CHANGE] = -0.02;
PE[PP.NORMAL_MULTIPLIER] = 3;
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE = ParticleEffects.Bloodsplat1 = {};
PE[PP.TEXTURE] = "gore3";
PE[PP.TTL] = 60;
PE[PP.SCALE] = 0.2;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.016;
PE[PP.SCALE_CHANGE] = 0.02;
PE[PP.VELOCITY] = 5;
PE[PP.VELOCITY_MULTIPLIER] = 0.1;
PE[PP.GRAVITY_SCALE] = 0.2;
PE[PP.ROTATION] = 2;
PE[PP.VELOCITY_RANDOM] = { minX: -3, rangeX: 6, minY: -3, rangeY: 6 };
PE[PP.COLLIDE] = !0;
PE[PP.FOREGROUND] = !1;
PE = ParticleEffects.Bloodsplat2 = {};
PE[PP.TEXTURE] = "gore2";
PE[PP.ANCHOR] = { x: 0.2, y: 0.5 };
PE[PP.TTL] = 15;
PE[PP.VELOCITY_MULTIPLIER] = 0.05;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.065;
PE[PP.SCALE] = 0.2;
PE[PP.SCALE_CHANGE] = 0.05;
PE[PP.SCALE_RANDOM] = { min: 0.5, max: 1 };
PE[PP.ROTATION] = 1;
PE[PP.VELOCITY] = 5;
PE[PP.COLLIDE] = !0;
PE[PP.FOREGROUND] = !1;
PE = ParticleEffects.Bloodsplat3 = {};
PE[PP.TEXTURE] = "gore4";
PE[PP.TTL] = 60;
PE[PP.SCALE] = 0.3;
PE[PP.ALPHA] = 1;
PE[PP.SCALE_CHANGE] = -0.003;
PE[PP.ALPHA_CHANGE] = -0.015;
PE[PP.GRAVITY_SCALE] = 0.2;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY_RANDOM] = { minX: -5, rangeX: 10, minY: -5, rangeY: 10 };
PE[PP.COLLIDE] = !0;
PE[PP.FOREGROUND] = !1;
PE = ParticleEffects.GoreTrail = {};
PE[PP.TEXTURE] = "gore3";
PE[PP.TTL] = 50;
PE[PP.SCALE] = 0.05;
PE[PP.ALPHA] = 1;
PE[PP.SCALE_CHANGE] = 0.02;
PE[PP.ALPHA_CHANGE] = -0.02;
PE[PP.VELOCITY_MULTIPLIER] = 0.1;
PE[PP.GRAVITY_SCALE] = 0.3;
PE[PP.VELOCITY] = 6;
PE[PP.SCALE_RANDOM] = { min: 0.1, max: 2 };
PE[PP.DELTA_RANDOM] = { min: 1, max: 4 };
PE[PP.COLLIDE] = !0;
PE[PP.FOREGROUND] = !1;
PE = ParticleEffects.GoreTrailWater = {};
PE[PP.TEXTURE] = "gore3";
PE[PP.TTL] = 200;
PE[PP.SCALE] = 0.05;
PE[PP.ALPHA] = 0.8;
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.ALPHA_CHANGE] = -0.004;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.VELOCITY_RANDOM] = { minX: -0.1, rangeX: 0.2, minY: -0.1, rangeY: 0.2 };
PE[PP.SCALE_RANDOM] = { min: 0.1, max: 2 };
PE[PP.COLLIDE] = !1;
PE[PP.FOREGROUND] = !1;
PE = ParticleEffects.Bleeding = {};
PE[PP.TEXTURE] = "gore1";
PE[PP.TTL] = 40;
PE[PP.SCALE] = 0.25;
PE[PP.SCALE_CHANGE] = 1e-4;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.025;
PE[PP.VELOCITY_MULTIPLIER] = 0.1;
PE[PP.GRAVITY_SCALE] = 0.3;
PE[PP.ROTATION] = 10;
PE[PP.DELTA_RANDOM] = { min: 0.1, max: 0.3 };
PE[PP.FOREGROUND] = !0;
PE[PP.COLLIDE] = !0;
PE = ParticleEffects.BleedingInWater = {};
PE[PP.TEXTURE] = "gore1";
PE[PP.TTL] = 100;
PE[PP.SCALE] = 0.25;
PE[PP.SCALE_CHANGE] = 1e-4;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.01;
PE[PP.VELOCITY_MULTIPLIER] = 0.001;
PE[PP.GRAVITY_SCALE] = 0.005;
PE[PP.ROTATION] = 10;
PE[PP.DELTA_RANDOM] = { min: 0.1, max: 0.3 };
PE[PP.FOREGROUND] = !0;
PE[PP.COLLIDE] = !0;
PE = ParticleEffects.LauncherNadeSparkTrail = {};
PE[PP.TEXTURE] = "flame2";
PE[PP.TTL] = 3;
PE[PP.SCALE] = 0.9;
PE[PP.SCALE_RANDOM] = { min: 0.5, max: 0.7 };
PE[PP.SCALE_CHANGE] = -0.1;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.3;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY] = 1;
PE[PP.VELOCITY_MULTIPLIER] = 0.05;
PE[PP.GRAVITY_SCALE] = 0.2;
PE = ParticleEffects.LauncherNadeSmokeTrail = {};
PE[PP.TEXTURE] = "smoke3";
PE[PP.TTL] = 25;
PE[PP.SCALE] = 0.9;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 1.6 };
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.ALPHA] = 0.3;
PE[PP.ALPHA_CHANGE] = -0.012;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.002, max: 0.004 };
PE[PP.GRAVITY_SCALE] = -0.02;
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE = ParticleEffects.X75NadeSparkTrail = {};
PE[PP.TEXTURE] = "green-exp";
PE[PP.TTL] = 20;
PE[PP.SCALE] = 0.4;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 0.6 };
PE[PP.SCALE_CHANGE] = -0.02;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.05;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE[PP.GRAVITY_SCALE] = 0.2;
PE = ParticleEffects.BulletTrail = {};
PE[PP.TEXTURE] = "bullettrail";
PE[PP.TTL] = 30;
PE[PP.SCALE] = 1.9;
PE[PP.ALPHA] = 0.18;
PE[PP.ALPHA_CHANGE] = -0.01;
PE[PP.ROTATION] = 1;
PE[PP.ANCHOR] = { x: 0.4, y: 0.5 };
PE = ParticleEffects.ArrowTrail = {};
PE[PP.TEXTURE] = "bullettrail";
PE[PP.TTL] = 20;
PE[PP.SCALE] = 0.5;
PE[PP.ALPHA] = 0.5;
PE[PP.ALPHA_CHANGE] = -0.02;
PE[PP.ROTATION] = 1;
PE[PP.ANCHOR] = { x: 1.5, y: 0.5 };
PE = ParticleEffects.TinyBulletTrail = {};
PE[PP.TEXTURE] = "bullettrail2";
PE[PP.TTL] = 5;
PE[PP.SCALE] = 0.5;
PE[PP.ALPHA] = 0.5;
PE[PP.ALPHA_CHANGE] = -0.1;
PE[PP.ROTATION] = 1;
PE[PP.ANCHOR] = { x: 0.4, y: 0.5 };
PE[PP.SCALE_FACTOR] = 0.0033;
PE = ParticleEffects.MAC10BulletTrail = {};
PE[PP.TEXTURE] = "bullettrail2";
PE[PP.TTL] = 5;
PE[PP.SCALE] = 0.5;
PE[PP.ALPHA] = 0.2;
PE[PP.ALPHA_CHANGE] = -0.04;
PE[PP.ROTATION] = 1;
PE[PP.ANCHOR] = { x: 0.4, y: 0.5 };
PE[PP.SCALE_FACTOR] = 4e-4;
PE = ParticleEffects.PulseGunOrbTrail = {};
PE[PP.TEXTURE] = "pulsegun_orb_trail";
PE[PP.TTL] = 20;
PE[PP.SCALE] = 0.3;
PE[PP.SCALE_CHANGE] = 0.03;
PE[PP.ALPHA] = 0.18;
PE[PP.ALPHA_CHANGE] = -0.01;
PE[PP.ROTATION] = 1;
PE[PP.ANCHOR] = { x: 0.9, y: 0.5 };
PE = ParticleEffects.Teleport1 = {};
PE[PP.TEXTURE] = "flag1";
PE[PP.TTL] = 100;
PE[PP.SCALE] = 0;
PE[PP.SCALE_CHANGE] = 0.04;
PE[PP.ALPHA] = 0.4;
PE[PP.ALPHA_CHANGE] = -0.004;
PE[PP.ROTATION] = 0;
PE[PP.ANGULAR] = 0.01;
PE[PP.GRAVITY_SCALE] = 0;
PE = ParticleEffects.Flag1 = {};
PE[PP.TEXTURE] = "flag1";
PE[PP.TTL] = 100;
PE[PP.SCALE] = 1;
PE[PP.SCALE_CHANGE] = 0;
PE[PP.ALPHA] = 0.6;
PE[PP.ALPHA_CHANGE] = -0.006;
PE[PP.ROTATION] = 2;
PE = ParticleEffects.GoldGlitter = {};
PE[PP.TEXTURE] = "glitter";
PE[PP.TTL] = 50;
PE[PP.SCALE] = 0.3;
PE[PP.SCALE_CHANGE] = -0.02;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.02;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = 0;
PE = ParticleEffects.SnowFlake = {};
PE[PP.TEXTURE] = "precip_snow";
PE[PP.TTL] = 330;
PE[PP.SCALE] = 0.1;
PE[PP.SCALE_CHANGE] = 0;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.003;
PE[PP.ROTATION] = 0.01;
PE[PP.GRAVITY_SCALE] = 0;
PE = ParticleEffects.Glitter = {};
PE[PP.TEXTURE] = "glitter";
PE[PP.TTL] = 5;
PE[PP.SCALE] = 0.3;
PE[PP.SCALE_CHANGE] = -0.06;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.06;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = -0.1;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.GlitterTail = {};
PE[PP.TEXTURE] = "glitter";
PE[PP.TTL] = 30;
PE[PP.SCALE] = 0.2;
PE[PP.SCALE_CHANGE] = -0.005;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.0333;
PE[PP.GRAVITY_SCALE] = -0.03;
PE[PP.FOREGROUND] = !1;
PE = ParticleEffects.EnergyShell = {};
PE[PP.TEXTURE] = "energy_shell";
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.64;
PE[PP.ALPHA] = 1;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.ROTATION] = 2;
PE[PP.FOREGROUND] = !0;
PE[PP.TINT] = !0;
PE = ParticleEffects.EnergyTrail = {};
PE[PP.TEXTURE] = "energy_trail_electric";
PE[PP.TTL] = 20;
PE[PP.SCALE] = 0.64;
PE[PP.SCALE_RANDOM] = { min: 0.1, max: 1 };
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.05;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.VELOCITY] = 6;
PE[PP.ROTATION] = 2;
PE = ParticleEffects.ChainsawSmoke = {};
PE[PP.TEXTURE] = "smoke3";
PE[PP.TTL] = 14;
PE[PP.SCALE] = 0.1;
PE[PP.SCALE_CHANGE] = 0.03;
PE[PP.ALPHA] = 0.8;
PE[PP.ALPHA_CHANGE] = -0.06;
PE[PP.ORIGIN] = 1;
PE[PP.GRAVITY_SCALE] = -0.2;
PE[PP.EJECTION_ANGLE] = 0.15;
PE[PP.EJECTION_DELTA] = { min: 2, max: 4 };
PE[PP.FOREGROUND] = !0;
PE[PP.CAM_SHAKE] = 1;
PE = ParticleEffects.MinigunSmoke = {};
PE[PP.TEXTURE] = "smoke3";
PE[PP.TTL] = 40;
PE[PP.SCALE] = 0.1;
PE[PP.SCALE_CHANGE] = 0.05;
PE[PP.ALPHA] = 0.11;
PE[PP.ALPHA_CHANGE] = -0.002;
PE[PP.ORIGIN] = 1;
PE[PP.GRAVITY_SCALE] = -0.05;
PE[PP.FOREGROUND] = !0;
PE[PP.CAM_SHAKE] = 1;
PE[PP.AMOUNT] = 1;
PE = ParticleEffects.ChainsawSparks = {};
PE[PP.TEXTURE] = "spark1";
PE[PP.ANCHOR] = { x: 0.5, y: 0 };
PE[PP.TTL] = 10;
PE[PP.SCALE] = 0.4;
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY] = 2;
PE[PP.ALPHA_CHANGE] = -0.07;
PE[PP.VELOCITY_RANDOM] = { minX: -5, rangeX: 10, minY: -5, rangeY: 10 };
PE = ParticleEffects.ChainsawSparks2 = {};
PE[PP.TEXTURE] = "spark";
PE[PP.TTL] = 30;
PE[PP.VELOCITY] = 8;
PE[PP.GRAVITY_SCALE] = 0.2;
PE[PP.ALPHA] = 0.6;
PE[PP.ALPHA_CHANGE] = -0.02;
PE[PP.NORMAL_MULTIPLIER] = 2;
PE[PP.FOREGROUND] = !0;
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE = ParticleEffects.PunchImpact = {};
PE[PP.TEXTURE] = "dust2";
PE[PP.TTL] = 30;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.ALPHA] = 0.6;
PE[PP.ALPHA_CHANGE] = -0.02;
PE[PP.NORMAL_MULTIPLIER] = 1;
PE[PP.FOREGROUND] = !0;
PE[PP.SCALE] = 0.5;
PE[PP.SCALE_CHANGE] = 0.05;
PE[PP.SCALE_RANDOM] = { min: 0.1, max: 0.5 };
PE = ParticleEffects.BounceImpact = {};
PE[PP.AMOUNT] = 2;
PE[PP.TEXTURE] = "bounce";
PE[PP.TTL] = 30;
PE[PP.GRAVITY_SCALE] = 0.04;
PE[PP.SCALE] = 0.3;
PE[PP.SCALE_CHANGE] = 0.003;
PE[PP.ALPHA] = 0.4;
PE[PP.ALPHA_CHANGE] = -0.012;
PE[PP.ROTATION] = 2;
PE[PP.VELOCITY] = 2;
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE = ParticleEffects.WaterSplash = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "watersplash";
PE[PP.TTL] = 40;
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.SCALE_RANDOM] = { min: 0.2, max: 0.9 };
PE[PP.SCALE_CHANGE] = 0.02;
PE[PP.ALPHA] = 0.6;
PE[PP.ALPHA_CHANGE] = -0.015;
PE[PP.ROTATION] = 2;
PE[PP.VELOCITY] = 4;
PE[PP.VELOCITY_MULTIPLIER] = 0.02;
PE[PP.COLLIDE] = !0;
PE = ParticleEffects.WaterSplashExit = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "watersplash";
PE[PP.TTL] = 40;
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.SCALE_RANDOM] = { min: 0.2, max: 0.5 };
PE[PP.SCALE_CHANGE] = 0.02;
PE[PP.ALPHA] = 0.6;
PE[PP.ALPHA_CHANGE] = -0.015;
PE[PP.ROTATION] = 2;
PE[PP.VELOCITY] = 7;
PE[PP.VELOCITY_MULTIPLIER] = 0.03;
PE[PP.COLLIDE] = !0;
PE = ParticleEffects.SparkTrail1 = {};
PE[PP.TEXTURE] = "spark1";
PE[PP.ANCHOR] = { x: 0.5, y: 0 };
PE[PP.TTL] = 10;
PE[PP.SCALE] = 0.4;
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY] = 2;
PE[PP.ALPHA_CHANGE] = -0.07;
PE[PP.VELOCITY_RANDOM] = { minX: -5, rangeX: 10, minY: -5, rangeY: 10 };
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.SparkTrail2 = {};
PE[PP.TEXTURE] = "spark2";
PE[PP.AMOUNT] = 2;
PE[PP.ANCHOR] = { x: 0.5, y: 0 };
PE[PP.TTL] = 10;
PE[PP.SCALE] = 0.4;
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY] = 2;
PE[PP.ALPHA_CHANGE] = -0.07;
PE[PP.VELOCITY_RANDOM] = { minX: -5, rangeX: 10, minY: -5, rangeY: 10 };
PE = ParticleEffects.LinkGunRayImpact = {};
PE[PP.TEXTURE] = "link_ray_impact";
PE[PP.AMOUNT] = 1;
PE[PP.ANCHOR] = { x: 0.5, y: 0.5 };
PE[PP.TTL] = 5;
PE[PP.SCALE] = 0.25;
PE[PP.SCALE_CHANGE] = 0.3;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY] = 2;
PE[PP.ALPHA_CHANGE] = -0.2;
PE[PP.VELOCITY_RANDOM] = { minX: -2, rangeX: 4, minY: -2, rangeY: 4 };
PE = ParticleEffects.SmokeTrail1 = {};
PE[PP.TEXTURE] = "smoke3";
PE[PP.TTL] = 50;
PE[PP.SCALE] = 0.3;
PE[PP.SCALE_CHANGE] = 0.02;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 1.6 };
PE[PP.ALPHA] = 0.3;
PE[PP.ALPHA_CHANGE] = -0.006;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.002, max: 0.004 };
PE[PP.GRAVITY_SCALE] = -0.02;
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE = ParticleEffects.SmokeTrail2 = {};
PE[PP.TEXTURE] = "smoke4";
PE[PP.TTL] = 50;
PE[PP.SCALE] = 0.9;
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 0.8 };
PE[PP.ALPHA] = 0.5;
PE[PP.ALPHA_CHANGE] = -0.01;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.002, max: 0.004 };
PE[PP.GRAVITY_SCALE] = -0.01;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.Dissolve = {};
PE[PP.TEXTURE] = "smoke4";
PE[PP.TTL] = 10;
PE[PP.SCALE] = 0.9;
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 0.8 };
PE[PP.ALPHA] = 0.5;
PE[PP.ALPHA_CHANGE] = -0.05;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.002, max: 0.004 };
PE[PP.GRAVITY_SCALE] = -0.01;
PE[PP.FOREGROUND] = !1;
PE = ParticleEffects.DissolveElectric = {};
PE[PP.TEXTURE] = "plasma_electric";
PE[PP.TTL] = 1;
PE[PP.SCALE] = 0.3;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.FOREGROUND] = !0;
PE[PP.SCALE_RANDOM] = { min: 0.3, max: 0.9 };
PE = ParticleEffects.FlameTrail2 = {};
PE[PP.TEXTURE] = "flame3";
PE[PP.TTL] = 20;
PE[PP.SCALE] = 0.15;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 0.8 };
PE[PP.SCALE_CHANGE] = 0.015;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.05;
PE[PP.ROTATION] = 2;
PE[PP.VELOCITY] = 1;
PE[PP.GRAVITY_SCALE] = -0.1;
PE[PP.FOREGROUND] = !1;
PE = ParticleEffects.FlameThrowerTrail = {};
PE[PP.TEXTURE] = "flame3";
PE[PP.TTL] = 15;
PE[PP.SCALE] = 0.2;
PE[PP.SCALE_RANDOM] = { min: 0.8, max: 0.9 };
PE[PP.SCALE_CHANGE] = 0.045;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.075;
PE[PP.ROTATION] = 2;
PE[PP.VELOCITY] = 1;
PE[PP.GRAVITY_SCALE] = -0.1;
PE[PP.FOREGROUND] = !1;
PE = ParticleEffects.FlameThrowerPilot = {};
PE[PP.TEXTURE] = "flame5";
PE[PP.ANCHOR] = { x: 0.5, y: 0.5 };
PE[PP.TTL] = 25;
PE[PP.SCALE] = 0.35;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.05;
PE[PP.ROTATION] = 4;
PE[PP.VELOCITY] = 3;
PE[PP.VELOCITY_MULTIPLIER] = 10;
PE[PP.GRAVITY_SCALE] = 0.09;
PE[PP.ORIGIN] = 1;
PE[PP.COLLIDE] = !0;
PE[PP.APPEAR] = 4;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.FlameBlast1 = {};
PE[PP.AMOUNT] = 2;
PE[PP.TEXTURE] = "flame4";
PE[PP.TTL] = 10;
PE[PP.SCALE] = 0.1;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 0.8 };
PE[PP.SCALE_CHANGE] = 0.05;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.1;
PE[PP.ROTATION] = 2;
PE[PP.VELOCITY] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.1, max: 0.2 };
PE[PP.VELOCITY_RANDOM] = { minX: -0.1, rangeX: 0.2, minY: -0.1, rangeY: 0.2 };
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.BallTrail = {};
PE[PP.TEXTURE] = "ball";
PE[PP.TTL] = 10;
PE[PP.SCALE] = 0.45;
PE[PP.ALPHA] = 0.3;
PE[PP.ALPHA_CHANGE] = -0.1;
PE[PP.ROTATION] = 6;
PE[PP.VELOCITY] = 1;
PE[PP.GRAVITY_SCALE] = 0;
PE = ParticleEffects.ShotgunCartridge = {};
PE[PP.TEXTURE] = "tinycartridge";
PE[PP.TTL] = 150;
PE[PP.SCALE] = 0.25;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = 0;
PE[PP.ROTATION] = 4;
PE[PP.ANGULAR_RANDOM] = { min: -0.15, max: 0.3 };
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.ORIGIN] = 2;
PE[PP.EJECTION_DELTA] = { min: 3.5, max: 5 };
PE[PP.EJECTION_ANGLE] = 0.15;
PE[PP.COLLIDE] = !0;
PE[PP.VELOCITY_ALPHA_TTL] = 16;
PE = ParticleEffects.SMGCartridge = {};
PE[PP.TEXTURE] = "tinycartridge";
PE[PP.TTL] = 150;
PE[PP.SCALE] = 0.2;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = 0;
PE[PP.ROTATION] = 4;
PE[PP.ANGULAR_RANDOM] = { min: -0.15, max: 0.3 };
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.ORIGIN] = 2;
PE[PP.EJECTION_DELTA] = { min: 3.5, max: 5 };
PE[PP.EJECTION_ANGLE] = 0.15;
PE[PP.COLLIDE] = !0;
PE[PP.VELOCITY_ALPHA_TTL] = 16;
PE = ParticleEffects.RifleCartridge = {};
PE[PP.TEXTURE] = "smallcartridge";
PE[PP.TTL] = 150;
PE[PP.SCALE] = 0.25;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = 0;
PE[PP.ROTATION] = 4;
PE[PP.ANGULAR_RANDOM] = { min: -0.15, max: 0.3 };
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.ORIGIN] = 2;
PE[PP.EJECTION_DELTA] = { min: 3.5, max: 5 };
PE[PP.EJECTION_ANGLE] = 0.15;
PE[PP.COLLIDE] = !0;
PE[PP.VELOCITY_ALPHA_TTL] = 16;
PE = ParticleEffects.X75Cartridge = {};
PE[PP.TEXTURE] = "green-exp";
PE[PP.TTL] = 60;
PE[PP.SCALE] = 0.1;
PE[PP.SCALE_CHANGE] = -0.004;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = 0.018;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.5, max: 1 };
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.ORIGIN] = 2;
PE[PP.EJECTION_DELTA] = { min: 2, max: 3 };
PE[PP.EJECTION_ANGLE] = 0.15;
PE[PP.COLLIDE] = !0;
PE[PP.VELOCITY_ALPHA_TTL] = 16;
PE = ParticleEffects.MinigunCartridge = {};
PE[PP.TEXTURE] = "smallcartridge";
PE[PP.TTL] = 150;
PE[PP.SCALE] = 0.18;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = 0;
PE[PP.ROTATION] = 4;
PE[PP.ANGULAR_RANDOM] = { min: -0.15, max: 0.3 };
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.ORIGIN] = 2;
PE[PP.EJECTION_DELTA] = { min: 3.5, max: 5 };
PE[PP.EJECTION_ANGLE] = 0.15;
PE[PP.COLLIDE] = !0;
PE[PP.VELOCITY_ALPHA_TTL] = 16;
PE = ParticleEffects.ShockRifleCartridge = {};
PE[PP.AMOUNT] = 5;
PE[PP.TEXTURE] = "shockriflecartridge";
PE[PP.TTL] = 20;
PE[PP.SCALE] = 0.25;
PE[PP.SCALE_RANDOM] = { min: 0.1, max: 1 };
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = 0;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.ORIGIN] = 2;
PE[PP.COLLIDE] = !1;
PE[PP.FOREGROUND] = !0;
PE[PP.VELOCITY_ALPHA_TTL] = 16;
PE[PP.VELOCITY_RANDOM] = { minX: -2, rangeX: 4, minY: -2, rangeY: 4 };
PE = ParticleEffects.SnowPuff = {};
PE[PP.AMOUNT] = 5;
PE[PP.TEXTURE] = "snowpuff";
PE[PP.TTL] = 30;
PE[PP.SCALE] = 1;
PE[PP.SCALE_CHANGE] = 0.03;
PE[PP.SCALE_RANDOM] = { min: 1, max: 2 };
PE[PP.ALPHA] = 0.6;
PE[PP.ALPHA_CHANGE] = -0.02;
PE[PP.ROTATION] = 2;
PE[PP.GRAVITY_SCALE] = 0.05;
PE[PP.COLLIDE] = !0;
PE[PP.FOREGROUND] = !0;
PE[PP.NORMAL_MULTIPLIER] = 30;
PE[PP.VELOCITY_RANDOM] = { minX: -2, rangeX: 4, minY: -2, rangeY: 4 };
PE = ParticleEffects.SnowballTrail = {};
PE[PP.TEXTURE] = "snowpuff";
PE[PP.AMOUNT] = 1;
PE[PP.ANCHOR] = { x: 0.5, y: 0 };
PE[PP.TTL] = 40;
PE[PP.SCALE] = 0.2;
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.ALPHA] = 1;
PE[PP.ROTATION] = 10;
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.ALPHA_CHANGE] = -0.025;
PE[PP.ROTATION] = 2;
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE = ParticleEffects.BarrettCartridge = {};
PE[PP.TEXTURE] = "smallcartridge";
PE[PP.TTL] = 150;
PE[PP.SCALE] = 0.3;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = 0;
PE[PP.ROTATION] = 4;
PE[PP.ANGULAR_RANDOM] = { min: -0.15, max: 0.3 };
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.ORIGIN] = 2;
PE[PP.EJECTION_DELTA] = { min: 3.5, max: 5 };
PE[PP.EJECTION_ANGLE] = 0.15;
PE[PP.COLLIDE] = !0;
PE[PP.VELOCITY_ALPHA_TTL] = 16;
PE = ParticleEffects.NadeLauncherCartridge = {};
PE[PP.TEXTURE] = "m79cartridge";
PE[PP.TTL] = 150;
PE[PP.SCALE] = 0.3;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = 0;
PE[PP.ROTATION] = 4;
PE[PP.ANGULAR_RANDOM] = { min: -0.15, max: 0.3 };
PE[PP.GRAVITY_SCALE] = 0.1;
PE[PP.ORIGIN] = 2;
PE[PP.EJECTION_DELTA] = { min: 3.5, max: 5 };
PE[PP.EJECTION_ANGLE] = 0.15;
PE[PP.COLLIDE] = !0;
PE[PP.VELOCITY_ALPHA_TTL] = 16;
PE = ParticleEffects.HealParticles = {};
PE[PP.AMOUNT] = 10;
PE[PP.TEXTURE] = "healparticle";
PE[PP.TTL] = 40;
PE[PP.ALPHA] = 1;
PE[PP.SCALE] = 0.6;
PE[PP.SCALE_RANDOM] = { min: 0.6, max: 1 };
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.ANGULAR_RANDOM] = { min: -0.05, max: 0.1 };
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.ItemSpawnParticles = {};
PE[PP.AMOUNT] = 10;
PE[PP.TEXTURE] = "spark";
PE[PP.TTL] = 20;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.05;
PE[PP.SCALE] = 1;
PE[PP.SCALE_RANDOM] = { min: 2, max: 3 };
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.ANGULAR_RANDOM] = { min: -0.05, max: 0.1 };
PE[PP.VELOCITY_RANDOM] = { minX: -2, rangeX: 4, minY: -2, rangeY: 4 };
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.NadeParticles = {};
PE[PP.AMOUNT] = 10;
PE[PP.TEXTURE] = "nadeparticle";
PE[PP.TTL] = 40;
PE[PP.ALPHA] = 1;
PE[PP.SCALE] = 0.6;
PE[PP.SCALE_RANDOM] = { min: 0.6, max: 1 };
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.ANGULAR_RANDOM] = { min: -0.05, max: 0.05 };
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.ClusterNadeParticles = {};
PE[PP.AMOUNT] = 10;
PE[PP.TEXTURE] = "clusternadeparticle";
PE[PP.TTL] = 40;
PE[PP.ALPHA] = 1;
PE[PP.SCALE] = 0.6;
PE[PP.SCALE_RANDOM] = { min: 0.6, max: 1 };
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.ANGULAR_RANDOM] = { min: -0.05, max: 0.1 };
PE[PP.VELOCITY_RANDOM] = { minX: -1, rangeX: 2, minY: -1, rangeY: 2 };
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.AmmoPickupParticles = {};
PE[PP.AMOUNT] = 20;
PE[PP.TEXTURE] = "spark";
PE[PP.TTL] = 70;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.014;
PE[PP.SCALE] = 0.6;
PE[PP.SCALE_RANDOM] = { min: 0.6, max: 1.2 };
PE[PP.GRAVITY_SCALE] = 0.25;
PE[PP.ANGULAR_RANDOM] = { min: -0.05, max: 0.1 };
PE[PP.VELOCITY_RANDOM] = { minX: -6, rangeX: 12, minY: -6, rangeY: 12 };
PE[PP.FOREGROUND] = !1;
PE[PP.COLLIDE] = !0;
PE = ParticleEffects.GoldPickupParticles = {};
PE[PP.AMOUNT] = 10;
PE[PP.TEXTURE] = "glitter";
PE[PP.TTL] = 5;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.2;
PE[PP.SCALE] = 1;
PE[PP.SCALE_CHANGE] = -0.15;
PE[PP.ANGULAR_RANDOM] = { min: -0.3, max: 0.6 };
PE[PP.VELOCITY_RANDOM] = { minX: -6, rangeX: 12, minY: -6, rangeY: 12 };
PE[PP.FOREGROUND] = !0;
PE[PP.COLLIDE] = !0;
PE = ParticleEffects.EnergyBoundaryParticles = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "smoke1";
PE[PP.TTL] = 150;
PE[PP.ALPHA] = 1e-4;
PE[PP.ALPHA_CHANGE] = 0.025;
PE[PP.SCALE] = 1.2;
PE[PP.SCALE_CHANGE] = -0.006;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.FOREGROUND] = !0;
PE[PP.TINT] = 8912896;
PE = ParticleEffects.SmallDustEmitter = {};
PE[PP.TEXTURE] = "dust1";
PE[PP.TTL] = 350;
PE[PP.SCALE] = 0.9;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 3.6 };
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.ALPHA] = 0.02;
PE[PP.ALPHA_CHANGE] = 0.0015;
PE[PP.VELOCITY_ALPHA_TTL] = 40;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.002, max: 0.004 };
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.VELOCITY_RANDOM] = { minX: -2, rangeX: -0.5, minY: -0.5, rangeY: 1 };
PE = ParticleEffects.SteamEmitter = {};
PE[PP.TEXTURE] = "smoke1";
PE[PP.TTL] = 800;
PE[PP.SCALE] = 0.9;
PE[PP.SCALE_RANDOM] = { min: 0.2, max: 0.4 };
PE[PP.SCALE_CHANGE] = 0.001;
PE[PP.ALPHA] = 0.04;
PE[PP.ALPHA_CHANGE] = 2e-4;
PE[PP.VELOCITY_ALPHA_TTL] = 140;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.002, max: 0.004 };
PE[PP.GRAVITY_SCALE] = 0.001;
PE[PP.VELOCITY_RANDOM] = { minX: 0.05, rangeX: 0.1, minY: 0.1, rangeY: 0.6 };
PE[PP.COLLIDE] = !0;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.TinyShrapnel = {};
PE[PP.AMOUNT_RANDOM] = { min: 1, max: 3 };
PE[PP.TTL] = 90;
PE[PP.LOCAL] = 1;
PE[PP.PREFAB] = PrefabList.TinyShrapnel;
PE[PP.VELOCITY_RANDOM] = { minX: -20, rangeX: 40, minY: -20, rangeY: 40 };
PE = ParticleEffects.GhostBotDebris1 = {};
PE[PP.AMOUNT] = 1;
PE[PP.TTL] = 180;
PE[PP.LOCAL] = 1;
PE[PP.ROTATION] = 1;
PE[PP.PREFAB] = PrefabList.GhostBotDebris1;
PE[PP.TYPE] = "prefab";
PE[PP.VELOCITY] = 1;
PE[PP.VELOCITY_RANDOM] = { minX: -20, rangeX: 40, minY: -20, rangeY: 40 };
PE[PP.ANGULAR_RANDOM] = { min: -10, max: 20 };
PE = ParticleEffects.GhostBotDebris2 = {};
PE[PP.AMOUNT] = 1;
PE[PP.TTL] = 180;
PE[PP.LOCAL] = 1;
PE[PP.ROTATION] = 1;
PE[PP.PREFAB] = PrefabList.GhostBotDebris2;
PE[PP.TYPE] = "prefab";
PE[PP.VELOCITY] = 1;
PE[PP.VELOCITY_RANDOM] = { minX: -20, rangeX: 40, minY: -20, rangeY: 40 };
PE[PP.ANGULAR_RANDOM] = { min: -10, max: 20 };
PE = ParticleEffects.GhostBotDebris3 = {};
PE[PP.AMOUNT] = 1;
PE[PP.TTL] = 180;
PE[PP.LOCAL] = 1;
PE[PP.ROTATION] = 1;
PE[PP.PREFAB] = PrefabList.GhostBotDebris3;
PE[PP.TYPE] = "prefab";
PE[PP.VELOCITY] = 1;
PE[PP.VELOCITY_RANDOM] = { minX: -20, rangeX: 40, minY: -20, rangeY: 40 };
PE[PP.ANGULAR_RANDOM] = { min: -10, max: 20 };
PE = ParticleEffects.FistRaycast = {};
PE[PP.AMOUNT] = 1;
PE[PP.LOCAL] = 1;
PE[PP.ROTATION] = 3;
PE[PP.TYPE] = ParticleEffects.LOCAL_PUNCH;
PE[PP.RAY_DELTA] = 24;
PE[PP.ORIGIN] = "hands";
PE = ParticleEffects.ChainsawRaycast = {};
PE[PP.AMOUNT] = 1;
PE[PP.LOCAL] = 1;
PE[PP.ROTATION] = 3;
PE[PP.TYPE] = ParticleEffects.LOCAL_SAW;
PE[PP.RAY_DELTA] = 45.5;
PE[PP.ORIGIN] = 1;
PE[PP.AUDIO] = AudioEffects.LightThud;
PE = ParticleEffects.LinkGunRaycast = {};
PE[PP.AMOUNT] = 1;
PE[PP.LOCAL] = 1;
PE[PP.ROTATION] = 3;
PE[PP.TYPE] = ParticleEffects.LOCAL_LINK_GUN;
PE[PP.RAY_DELTA] = 700;
PE[PP.ORIGIN] = 1;
PE[PP.AUDIO] = AudioEffects.LightThud;
PE = ParticleEffects.NadeShockWave = {};
PE[PP.AMOUNT] = 1;
PE[PP.LOCAL] = 1;
PE[PP.TYPE] = ParticleEffects.LOCAL_EXP;
PE = ParticleEffects.X75NadeShrapnel = {};
PE[PP.TEXTURE] = "green-exp";
PE[PP.AMOUNT_RANDOM] = { min: 4, max: 8 };
PE[PP.TTL] = 30;
PE[PP.VELOCITY] = 2;
PE[PP.VELOCITY_RANDOM] = { minX: -10, rangeX: 20, minY: -10, rangeY: 20 };
PE[PP.SCALE] = 0.2;
PE[PP.SCALE_RANDOM] = { min: 0.2, max: 0.35 };
PE[PP.SCALE_CHANGE] = -1e-4;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.5, max: 1 };
PE[PP.GRAVITY_SCALE] = 0.2;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.033;
PE[PP.COLLIDE] = !0;
PE = ParticleEffects.RPG_BACKBLAST = {};
PE[PP.TEXTURE] = "rpg_backblast";
PE[PP.ANCHOR] = { x: 0, y: 0.5 };
PE[PP.TTL] = 4;
PE[PP.SCALE] = 0.3;
PE[PP.SCALE_CHANGE] = 0.3;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.2;
PE[PP.ROTATION] = 5;
PE[PP.ORIGIN] = 2;
PE[PP.FOREGROUND] = !0;
PE[PP.CAM_JERK] = 8;
PE = ParticleEffects.RPG_MUZZLEBLAST = {};
PE[PP.TEXTURE] = "muzzleflash3";
PE[PP.ANCHOR] = { x: 0, y: 0.5 };
PE[PP.TTL] = 3;
PE[PP.SCALE] = 0.3;
PE[PP.SCALE_CHANGE] = 0.1;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.3;
PE[PP.ROTATION] = 3;
PE[PP.ORIGIN] = 1;
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.RPGFlameTrail = {};
PE[PP.TEXTURE] = "flame6";
PE[PP.TTL] = 1;
PE[PP.ANCHOR] = { x: 0.5, y: 1.5 };
PE[PP.SCALE] = 0.9;
PE[PP.SCALE_RANDOM] = { min: 0.5, max: 0.7 };
PE[PP.SCALE_CHANGE] = -0.1;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.3;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY] = 1;
PE[PP.VELOCITY_MULTIPLIER] = 0.05;
PE[PP.GRAVITY_SCALE] = 0.2;
PE = ParticleEffects.RPGBackBlastSmoke = {};
PE[PP.AMOUNT] = 3;
PE[PP.TEXTURE] = "smoke3";
PE[PP.ORIGIN] = 2;
PE[PP.TTL] = 50;
PE[PP.SCALE] = 0.9;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 1.6 };
PE[PP.SCALE_CHANGE] = 0.04;
PE[PP.ALPHA] = 0.3;
PE[PP.ALPHA_CHANGE] = -0.006;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.02, max: 0.04 };
PE[PP.GRAVITY_SCALE] = -0.02;
PE[PP.VELOCITY] = 9;
PE[PP.VELOCITY_MULTIPLIER] = 2;
PE[PP.COLLIDE] = !0;
PE = ParticleEffects.RPGNadeSmokeTrail = {};
PE[PP.TEXTURE] = "smoke3";
PE[PP.ORIGIN] = 3;
PE[PP.ANCHOR_RELATIVE] = { x: 50, y: 0 };
PE[PP.TTL] = 50;
PE[PP.SCALE] = 0.9;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 1.6 };
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.ALPHA] = 0.3;
PE[PP.ALPHA_CHANGE] = -0.006;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.002, max: 0.004 };
PE[PP.GRAVITY_SCALE] = -0.02;
PE[PP.VELOCITY_RANDOM] = { minX: -0.4, rangeX: 0.8, minY: -0.4, rangeY: 0.8 };
PE = ParticleEffects.RLRocketSmokeTrail = {};
PE[PP.TEXTURE] = "smoke3";
PE[PP.ORIGIN] = 3;
PE[PP.ANCHOR_RELATIVE] = { x: -30, y: 0 };
PE[PP.TTL] = 50;
PE[PP.SCALE] = 0.3;
PE[PP.SCALE_RANDOM] = { min: 0.4, max: 1.6 };
PE[PP.SCALE_CHANGE] = 0.01;
PE[PP.ALPHA] = 0.3;
PE[PP.ALPHA_CHANGE] = -0.006;
PE[PP.ROTATION] = 2;
PE[PP.ANGULAR] = 2;
PE[PP.ANGULAR_RANDOM] = { min: -0.002, max: 0.004 };
PE[PP.GRAVITY_SCALE] = -0.01;
PE[PP.VELOCITY_RANDOM] = { minX: -0.4, rangeX: 0.8, minY: -0.4, rangeY: 0.8 };
PE = ParticleEffects.RLRocketFlameTrail = {};
PE[PP.TEXTURE] = "flame6";
PE[PP.TTL] = 1;
PE[PP.ANCHOR] = { x: 0.5, y: 1.4 };
PE[PP.SCALE] = 0.6;
PE[PP.SCALE_RANDOM] = { min: 0.5, max: 0.7 };
PE[PP.SCALE_CHANGE] = -0.1;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.3;
PE[PP.ROTATION] = 10;
PE[PP.VELOCITY] = 1;
PE[PP.VELOCITY_MULTIPLIER] = 0.05;
PE[PP.GRAVITY_SCALE] = 0;
PE = ParticleEffects.EnergyJetFeet = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "glitter";
PE[PP.TTL] = 40;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.025;
PE[PP.SCALE] = 0.7;
PE[PP.SCALE_CHANGE] = -0.0175;
PE[PP.ANGULAR_RANDOM] = { min: -0.3, max: 0.6 };
PE[PP.VELOCITY] = 10;
PE[PP.FOREGROUND] = !1;
PE[PP.COLLIDE] = !0;
PE[PP.GRAVITY_SCALE] = 0;
PE = ParticleEffects.EnergyJetFeet2 = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "jetboot2fx";
PE[PP.TTL] = 4;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.2;
PE[PP.SCALE] = -1;
PE[PP.SCALE_CHANGE] = 0.2;
PE[PP.ROTATION] = 6;
PE[PP.VELOCITY] = 12;
PE[PP.FOREGROUND] = !1;
PE[PP.COLLIDE] = !1;
PE[PP.GRAVITY_SCALE] = 0;
PE = ParticleEffects.EnergyJetGlow = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "glitterglow";
PE[PP.TTL] = 10;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.05;
PE[PP.SCALE] = 0.4;
PE[PP.SCALE_CHANGE] = -0.04;
PE[PP.VELOCITY_RANDOM] = { minX: -1.5, rangeX: 3, minY: -1.5, rangeY: 3 };
PE[PP.VELOCITY] = 12;
PE[PP.FOREGROUND] = !1;
PE[PP.COLLIDE] = !0;
PE[PP.GRAVITY_SCALE] = 0;
PE = ParticleEffects.EnergyVacuum = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "glitterglow";
PE[PP.TTL] = 30;
PE[PP.ALPHA] = 0.01;
PE[PP.ALPHA_CHANGE] = 0.032;
PE[PP.SCALE] = 0.8;
PE[PP.SCALE_CHANGE] = -0.026;
PE[PP.VELOCITY] = 11;
PE[PP.FOREGROUND] = !1;
PE[PP.COLLIDE] = !1;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.ROTATION] = 2;
PE = ParticleEffects.EnergyDragonball = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "glitterglow";
PE[PP.TTL] = 30;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.025;
PE[PP.SCALE] = 0.4;
PE[PP.SCALE_CHANGE] = -0.012;
PE[PP.VELOCITY] = 11;
PE[PP.FOREGROUND] = !1;
PE[PP.COLLIDE] = !1;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.ROTATION] = 2;
PE = ParticleEffects.FireEyes = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "glitterglow";
PE[PP.TTL] = 14;
PE[PP.ALPHA] = 1.1;
PE[PP.ALPHA_CHANGE] = -0.065;
PE[PP.SCALE] = 0.22;
PE[PP.SCALE_CHANGE] = -0.013;
PE[PP.VELOCITY] = 11;
PE[PP.VELOCITY_RANDOM] = { minX: -0.6, rangeX: 1.2, minY: -0.3, rangeY: 0.6 };
PE[PP.FOREGROUND] = !0;
PE[PP.COLLIDE] = !1;
PE[PP.GRAVITY_SCALE] = -0.05;
PE[PP.ROTATION] = 2;
PE = ParticleEffects.FireEyesCenter = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "glitterglow";
PE[PP.TTL] = 5;
PE[PP.ALPHA] = 1.1;
PE[PP.ALPHA_CHANGE] = -0.15;
PE[PP.SCALE] = 0.125;
PE[PP.SCALE_CHANGE] = -0.015;
PE[PP.VELOCITY] = 11;
PE[PP.VELOCITY_RANDOM] = { minX: -0.6, rangeX: 1.2, minY: -0.3, rangeY: 0.6 };
PE[PP.FOREGROUND] = !0;
PE[PP.COLLIDE] = !1;
PE[PP.GRAVITY_SCALE] = -0.05;
PE[PP.ROTATION] = 2;
PE = ParticleEffects.GlowSquare = {};
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "glowsquare";
PE[PP.TTL] = 30;
PE[PP.SCALE] = 0.4;
PE[PP.SCALE_CHANGE] = -0.01;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.03;
PE[PP.GRAVITY_SCALE] = -0;
PE[PP.VELOCITY_RANDOM] = { minX: -0.3, rangeX: 0.6, minY: -0.3, rangeY: 0.6 };
PE[PP.FOREGROUND] = !1;
PE[PP.COLLIDE] = !1;
PE = ParticleEffects.GhostBotDamage = {};
PE[PP.TEXTURE] = "spark1";
PE[PP.AMOUNT] = 4;
PE[PP.TTL] = 5;
PE[PP.SCALE] = 0.5;
PE[PP.SCALE_CHANGE] = -0.0025;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0;
PE[PP.GRAVITY_SCALE] = 0;
PE[PP.FOREGROUND] = !1;
PE[PP.NORMAL_MULTIPLIER] = 12;
PE[PP.VELOCITY_RANDOM] = { minX: -6, rangeX: 12, minY: -6, rangeY: 12 };
PE[PP.VELOCITY] = 8;
PE[PP.NORMAL] = !0;
PE[PP.COLLIDE] = !1;
PE[PP.ROTATION] = 10;
PE = ParticleEffects.GhostBotExplosion = {};
PE[PP.TEXTURE] = "explosion3";
PE[PP.TTL] = 10;
PE[PP.SCALE] = 0.04;
PE[PP.SCALE_CHANGE] = 0.06;
PE[PP.ALPHA_CHANGE] = -0.015;
PE[PP.ROTATION] = 2;
PE[PP.ORIGIN] = "";
PE[PP.FOREGROUND] = !0;
PE = ParticleEffects.RopeParticle = {};
PE[PP.ROPE] = !0;
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "ray_gun_beam";
PE[PP.TTL] = 20;
PE[PP.ALPHA] = 1;
PE[PP.ALPHA_CHANGE] = -0.05;
PE[PP.SCALE] = 0.2;
PE[PP.SCALE_CHANGE] = -0.01;
PE[PP.VELOCITY_RANDOM] = { minX: -0.3, rangeX: 0.3, minY: -0.3, rangeY: 0.3 };
PE[PP.FOREGROUND] = !0;
PE[PP.COLLIDE] = !0;
PE[PP.GRAVITY_SCALE] = -0.01;
PE[PP.ROTATION] = 2;
PE = ParticleEffects.BulletTrailRope = {};
PE[PP.ROPE] = !0;
PE[PP.TEXTURE] = "bullettrail";
PE[PP.TTL] = -1;
PE = ParticleEffects.BandanaRope = {};
PE[PP.ROPE] = !0;
PE[PP.AMOUNT] = 1;
PE[PP.TEXTURE] = "bandana_team_juliett";
var bandanarope = {};
class BandanaRope extends PIXI.SimpleRope {
  constructor(a, b) {
    super(a, [new PIXI.Point(), new PIXI.Point(), new PIXI.Point(), new PIXI.Point()]);
    this.target = b;
    this.ttl = -1;
    this.scale.x = this.scale.y = 0.15;
    this.x = this.target.p.x;
    this.y = this.target.p.y;
    this.alphaDrop = this.vy = this.vx = 0;
    this.delta = 45;
    this.points = this.geometry.points;
  }
  update() {
    var a =
      this.target.facingDir === Player.FACING_LEFT
        ? this.target.head.p.r + 0.1
        : this.target.head.p.r - 0.1 + Math.PI;
    this.x = this.target.head.p.x - 6 * Math.cos(a);
    this.y = this.target.head.p.y - 6 * Math.sin(a);
    for (a = 1; 4 > a; a++) {
      let c = this.points[a],
        d = this.points[a - 1];
      c.x -= this.target.p.vx;
      c.y -= this.target.p.vy - PC.GRAVITY.y * (0.6 - 0.1 * a);
      var b = c.x - d.x;
      let e = c.y - d.y;
      b * b + e * e > this.delta * this.delta &&
        ((b = Math.atan2(e, b)),
        (c.x = d.x + this.delta * Math.cos(b)),
        (c.y = d.y + this.delta * Math.sin(b)));
    }
  }
}
BandanaRope.FX = ParticleEffects.BandanaRope;
var bullettrailrope = {};
class BulletTrailRope extends PIXI.SimpleRope {
  constructor(a, b) {
    super(a, [new PIXI.Point(), new PIXI.Point(), new PIXI.Point(), new PIXI.Point()]);
    this.target = b;
    this.ttl = -1;
    this.x = this.target.p.x;
    this.y = this.target.p.y;
    this.alphaDrop = 0;
    this.scale.x = 1.25;
    this.scale.y = 1.25;
    this.vy = this.vx = 0;
    this.delta = 20;
    this.points = this.geometry.points;
  }
  update() {
    this.x = this.target.p.x;
    this.y = this.target.p.y;
    for (let b = 1; 4 > b; b++) {
      let c = this.points[b],
        d = this.points[b - 1];
      c.x -= this.target.p.vx;
      c.y -= this.target.p.vy;
      var a = c.x - d.x;
      let e = c.y - d.y;
      a * a + e * e > this.delta * this.delta &&
        ((a = Math.atan2(e, a)),
        (c.x = d.x + this.delta * Math.cos(a)),
        (c.y = d.y + this.delta * Math.sin(a)));
    }
  }
}
BulletTrailRope.FX = ParticleEffects.BulletTrailRope;
function ParticleEmitter(a, b, c, d, e, f, g, h, m, n, l) {
  this.parent = a;
  this.emits = b;
  this.offset = c || { x: 0, y: 0 };
  this.frequency = d ?? 0;
  this.count = e ?? 0;
  this.ttl = f || -1;
  this.probability = g ?? 1;
  this.width = h ?? 0;
  this.height = m ?? 0;
  if (0 !== this.width || 0 !== this.height) this.area = !0;
  void 0 !== n && (this.tint = n);
  void 0 !== l && (this.id = l);
}
function AnchorBase() {
  this.anchors = {};
  this.addAnchor = function (a, b) {
    this.anchors[a] = b;
    b.visible = !1;
    this.addChild(b);
  };
  this.getAnchorTransform = function (a) {
    a = this.anchors[a];
    a.visible = !0;
    a.updateTransform();
    a.visible = !1;
    return { x: a.worldTransform.tx, y: a.worldTransform.ty };
  };
}
var basesprite = {};
class BaseSprite extends PIXI.Container {
  constructor(a) {
    super();
    this.go = a;
    this.bounds = { x: 0, y: 0, width: 1, height: 1 };
  }
  update() {
    this.updateGraphics();
  }
  updateGraphics() {
    let a = this.go.g;
    this.removeChildren();
    this.scale.x = a.sx ?? 1;
    this.scale.y = a.sy ?? 1;
    if (void 0 === a.pf)
      1 === a.t
        ? this.constructColoredMesh(BaseSprite.ColorMap[a.c])
        : 2 === a.t && this.constructTexturedMesh(App.CombinedTextures[a.tx]);
    else if (2 === a.t && App.CombinedTextures[a.tx]) {
      let b = new PIXI.Sprite(App.CombinedTextures[a.tx]);
      b.x = 0.5 * -b.width;
      b.y = 0.5 * -b.height;
      b.alpha = void 0 !== a.a ? a.a : 1;
      b.rotation = a.r ?? 0;
      void 0 !== a.c && (b.tint = parseInt(BaseSprite.ColorMap[a.c], 16));
      this.addChild(b);
    }
    this.go.bounds = this.getLocalBounds();
  }
  constructTexturedMesh(a) {
    let b = this.go.p.sh || [],
      c = this.go.g,
      d;
    for (let e = 0, f = b.length; e < f; e++) {
      let g = b[e];
      g.t === GameShape.POLYGON
        ? ((d = this.constructPolyMesh(a, c.uv, g, c)),
          (this.go.bounds = polyBounds(polyRotateCopy(g.v, this.rotation))))
        : g.t === GameShape.RECTANGLE
        ? ((d = this.constructRectMesh(a, c.uv, g, c)), (this.go.bounds = d.getBounds()))
        : g.t === GameShape.CIRCLE &&
          ((d = this.constructCircleMesh(a, c.uv, g, c)), (this.go.bounds = d.getBounds()));
      d &&
        ((d.alpha = void 0 !== c.a ? c.a : 1),
        (d.x = -(c.ox || 0)),
        (d.y = -(c.oy || 0)),
        (d.rotation = c.r || 0),
        this.addChild(d));
    }
  }
  constructPolyMesh(a, b, c, d) {
    let e = [c.v[0].x, c.v[0].y, c.v[1].x, c.v[1].y, c.v[2].x, c.v[2].y];
    if (void 0 === d.vc) {
      c = void 0 !== d.a ? d.a : 1;
      let h = void 0 !== d.c ? BaseSprite.ColorMap[d.c] : "ffffff";
      var f;
      if (void 0 === d.v) var g = (f = d = BaseSprite.DefaultColor);
      else {
        g = d.v[0] && void 0 !== d.v[0].c ? BaseSprite.ColorMap[d.v[0].c] : "ffffffff";
        f = d.v[1] && void 0 !== d.v[1].c ? BaseSprite.ColorMap[d.v[1].c] : "ffffffff";
        let m = d.v[2] && void 0 !== d.v[2].c ? BaseSprite.ColorMap[d.v[2].c] : "ffffffff";
        g = d.v[0] ? uintToArr(g, d.v[0].mu ?? 1) : BaseSprite.DefaultColor;
        f = d.v[1] ? uintToArr(f, d.v[1].mu ?? 1) : BaseSprite.DefaultColor;
        d = d.v[2] ? uintToArr(m, d.v[2].mu ?? 1) : BaseSprite.DefaultColor;
      }
      b = new PIXI.Geometry()
        .addAttribute("aVertexPosition", e, 2)
        .addAttribute("aColor", g.concat(f, d), 4)
        .addAttribute("aUvs", b, 2);
      d = {};
      d.uSampler2 = a;
      d.color = uintToArr("ff" + h, 1);
      d.color[3] *= c;
      a = new PIXI.Shader(BaseSprite.Program, d);
      a = new PIXI.Mesh(b, a);
      a.alpha = c;
      return a;
    }
    return new PIXI.SimpleMesh(
      a,
      new Float32Array(e),
      new Float32Array(b),
      new Uint16Array([0, 1, 2]),
      PIXI.DRAW_MODES.TRIANGLE_STRIP
    );
  }
  constructRectMesh(a, b, c, d) {
    let e = c.o.x,
      f = c.o.y;
    var g = Math.sqrt(c.w * c.w + c.h * c.h),
      h = Math.atan2(c.h, c.w) + (c.r || 0);
    let m = Math.atan2(c.w, c.h) + (c.r || 0);
    c = Math.cos(h + Math.PI) * g + e;
    h = Math.sin(h + Math.PI) * g + f;
    let n = Math.cos(m + 0.5 * Math.PI) * g + e;
    g = Math.sin(m + 0.5 * Math.PI) * g + f;
    a = new PIXI.SimpleMesh(
      a,
      new Float32Array([
        c,
        h,
        n,
        g,
        -1 * c + 2 * e,
        -1 * h + 2 * f,
        -1 * n + 2 * e,
        -1 * g + 2 * f,
      ]),
      new Float32Array(b),
      new Uint16Array([0, 1, 3, 2]),
      PIXI.DRAW_MODES.TRIANGLE_STRIP
    );
    a.tint = parseInt(void 0 !== d.c ? BaseSprite.ColorMap[d.c] : "ffffff", 16);
    return a;
  }
  constructCircleMesh(a, b, c, d) {
    let e = 8 + Math.ceil(c.radius / 3),
      f = (2 * Math.PI) / e,
      g = polyCenterArr(b),
      h = [],
      m = [],
      n = [g.x, g.y];
    var l = g.x - b[0],
      k = g.y - b[1];
    l = Math.sqrt(l * l + k * k);
    b = Math.atan2(b[3] - b[1], b[2] - b[0]);
    for (k = 0; k < e + 1; k++) {
      var p = f * k;
      h.push(Math.cos(p + (c.r || 0)) * c.radius, Math.sin(p + (c.r || 0)) * c.radius);
      var r = Math.atan2(h[2 * k] / c.radius, h[2 * k + 1] / c.radius);
      p = g.x + l * Math.cos(r + b);
      r = g.y + l * Math.sin(r + b);
      h[2 * k] += c.o.x;
      h[2 * k + 1] += c.o.y;
      n.push(p, r);
      0 < k && m.push(0, k);
    }
    h.unshift(c.o.x, c.o.y);
    m.push(0, 1);
    a = new PIXI.SimpleMesh(
      a,
      new Float32Array(h),
      new Float32Array(n),
      new Uint16Array(m),
      PIXI.DRAW_MODES.TRIANGLE_STRIP
    );
    a.tint = parseInt(void 0 !== d.c ? BaseSprite.ColorMap[d.c] : "ffffff", 16);
    return a;
  }
  constructColoredMesh(a) {
    let b = new PIXI.Graphics();
    b.beginFill(parseInt(a, 16), 1);
    b.drawRect(0, 0, 128, 128);
    b.endFill();
    a = App.Renderer.generateTexture(b);
    this.constructTexturedMesh(a);
  }
}
BaseSprite.MeshIDMap = {};
BaseSprite.MeshIDGroups = [];
BaseSprite.TextureIDMap = [];
BaseSprite.ColorMap = [];
BaseSprite.Create = function (a) {
  var b = a.p.sh || [];
  a.g.tx = BaseSprite.TextureIDMap[a.g.tx];
  if (
    1 === b.length &&
    b[0].t === GameShape.POLYGON &&
    void 0 === a.g.pf &&
    App.CombinedTextures[a.g.tx]
  ) {
    if (void 0 !== a.g.g && "" !== a.g.g && void 0 !== BaseSprite.MeshIDGroups[a.g.g]) {
      var c = BaseSprite.MeshIDGroups[a.g.g];
      b = a.g.g;
      void 0 === BaseSprite.MeshIDMap[b] && (BaseSprite.MeshIDMap[b] = []);
      BaseSprite.MeshIDMap[b].push(a);
      a.transform &&
        (BaseSprite.MeshIDMap[b].transform = { type: a.transform, options: a.transformOptions });
      if (BaseSprite.MeshIDMap[b].length < c)
        return (a.bounds = polyBounds(polyRotateCopy(a.p.sh[0].v, a.p.r || 0))), null;
      c = BaseSprite.MeshIDMap[b];
      delete BaseSprite.MeshIDMap[b];
      return BaseSprite.CreateGroupedMesh(a, c);
    }
    return BaseSprite.CreateMesh(a);
  }
  return new BaseSprite(a);
};
BaseSprite.CreateMesh = function (a) {
  let b = a.g;
  var c = a.p.sh[0].v;
  c = [c[0].x, c[0].y, c[1].x, c[1].y, c[2].x, c[2].y];
  var d, e;
  if (void 0 === b.v) var f = (d = e = BaseSprite.DefaultColor);
  else
    (f = b.v[0] && void 0 !== b.v[0].c ? BaseSprite.ColorMap[b.v[0].c] : "ffffffff"),
      (d = b.v[1] && void 0 !== b.v[1].c ? BaseSprite.ColorMap[b.v[1].c] : "ffffffff"),
      (e = b.v[2] && void 0 !== b.v[2].c ? BaseSprite.ColorMap[b.v[2].c] : "ffffffff"),
      (f = b.v[0] ? uintToArr(f, b.v[0].mu ?? 1) : BaseSprite.DefaultColor),
      (d = b.v[1] ? uintToArr(d, b.v[1].mu ?? 1) : BaseSprite.DefaultColor),
      (e = b.v[2] ? uintToArr(e, b.v[2].mu ?? 1) : BaseSprite.DefaultColor);
  c = new PIXI.Geometry()
    .addAttribute("aVertexPosition", c, 2)
    .addAttribute("aColor", f.concat(d, e), 4)
    .addAttribute("aUvs", b.uv, 2);
  let g = void 0 !== b.a ? b.a : 1;
  f = {
    uSampler2: App.CombinedTextures[b.tx],
    color: uintToArr("ff" + (void 0 !== b.c ? BaseSprite.ColorMap[b.c] : "ffffff"), 1),
  };
  f.color[3] *= g;
  f = new PIXI.Shader(BaseSprite.Program, f);
  let h = new PIXI.Mesh(c, f);
  a.bounds = polyBounds(polyRotateCopy(a.p.sh[0].v, a.p.r ?? 0));
  h.go = a;
  h.update = () => {
    h.scale.x = b.sx ?? 1;
    h.scale.y = b.sy ?? 1;
    h.alpha = g;
  };
  return h;
};
BaseSprite.CreateGroupedMesh = function (a, b) {
  var c = [],
    d = [];
  let e = b.length;
  for (let q = 0; q < e; q++) {
    var f = b[q],
      g = f.g,
      h = 0 !== f.p.r ? polyRotateCopy(f.p.sh[0].v, f.p.r || 0) : f.p.sh[0].v,
      m = a.p.x - f.p.x;
    f = a.p.y - f.p.y;
    h = [h[0].x - m, h[0].y - f, h[1].x - m, h[1].y - f, h[2].x - m, h[2].y - f];
    d.push(g.uv[0], g.uv[1], g.uv[2], g.uv[3], g.uv[4], g.uv[5]);
    var n = void 0;
    void 0 === g.v
      ? (m = n = g = BaseSprite.DefaultColor)
      : ((m = g.v[0] && void 0 !== g.v[0].c ? BaseSprite.ColorMap[g.v[0].c] : "ffffffff"),
        (n = g.v[1] && void 0 !== g.v[1].c ? BaseSprite.ColorMap[g.v[1].c] : "ffffffff"),
        (f = g.v[2] && void 0 !== g.v[2].c ? BaseSprite.ColorMap[g.v[2].c] : "ffffffff"),
        (m = g.v[0] ? uintToArr(m, g.v[0].mu ?? 1) : BaseSprite.DefaultColor),
        (n = g.v[1] ? uintToArr(n, g.v[1].mu ?? 1) : BaseSprite.DefaultColor),
        (g = g.v[2] ? uintToArr(f, g.v[2].mu ?? 1) : BaseSprite.DefaultColor));
    c.push(
      new PIXI.Geometry()
        .addAttribute("aVertexPosition", h, 2)
        .addAttribute("aColor", m.concat(n, g), 4)
    );
  }
  let l = a.g;
  c = PIXI.Geometry.merge(c);
  c.addAttribute("aUvs", d);
  let k = void 0 !== l.a ? l.a : 1;
  d = {
    uSampler2: App.CombinedTextures[l.tx],
    color: uintToArr("ff" + (void 0 !== l.c ? BaseSprite.ColorMap[l.c] : "ffffff"), 1),
  };
  d.color[3] *= k;
  if (b.transform)
    switch (((b = b.transform), b.type)) {
      case GameAttribute.T_TRANSFORM:
        d.t = Math.floor(1e4 * Math.random());
        a.g.updateUniforms = !0;
        d.va = [parseFloat(b.options.vha), parseFloat(b.options.vva)];
        d.vf = [parseFloat(b.options.vhf), parseFloat(b.options.vvf)];
        d.vl = [parseFloat(b.options.vlx), parseFloat(b.options.vly)];
        d.vo = [parseFloat(b.options.vox), parseFloat(b.options.voy)];
        var p = BaseSprite.TransformProgram;
        break;
      case GameAttribute.T_FLUID:
        d.t = Math.floor(1e4 * Math.random());
        a.g.updateUniforms = !0;
        d.w = b.options.w;
        p = BaseSprite.FluidProgram;
        break;
      case GameAttribute.T_UV_ROTATE:
        d.t = Math.floor(1e4 * Math.random());
        a.g.updateUniforms = !0;
        d.av = parseFloat(b.options.av);
        d.p = [parseFloat(b.options.px), parseFloat(b.options.py)];
        d.os = parseInt(b.options.os, 10);
        p = new PIXI.Program(
          BaseSprite.ColoredVertexSource,
          BaseSprite.UVRotateFragmentSource,
          "def_uv_rotate"
        );
        break;
      case GameAttribute.T_TRANSFORM | GameAttribute.T_UV_ROTATE:
        d.t = Math.floor(1e4 * Math.random());
        a.g.updateUniforms = !0;
        d.av = parseFloat(b.options.av);
        d.os = parseInt(b.options.os, 10);
        d.p = [parseFloat(b.options.px), parseFloat(b.options.py)];
        d.va = [parseFloat(b.options.vha), parseFloat(b.options.vva)];
        d.vf = [parseFloat(b.options.vhf), parseFloat(b.options.vvf)];
        d.vl = [parseFloat(b.options.vlx), parseFloat(b.options.vly)];
        d.vo = [parseFloat(b.options.vox), parseFloat(b.options.voy)];
        p = new PIXI.Program(
          BaseSprite.TransformVertexSource,
          BaseSprite.UVRotateFragmentSource,
          "tr_uv_rotate"
        );
        break;
      case GameAttribute.T_UV_TRANSLATE:
        d.t = Math.floor(1e4 * Math.random());
        a.g.updateUniforms = !0;
        d.v = [parseFloat(b.options.vx), parseFloat(b.options.vy)];
        p = new PIXI.Program(
          BaseSprite.ColoredVertexSource,
          BaseSprite.UVTranslateFragmentSource,
          "def_uv_translate"
        );
        break;
      case GameAttribute.T_TRANSFORM | GameAttribute.T_UV_TRANSLATE:
        (d.t = Math.floor(1e4 * Math.random())),
          (a.g.updateUniforms = !0),
          (d.v = [parseFloat(b.options.vx), parseFloat(b.options.vy)]),
          (d.va = [parseFloat(b.options.vha), parseFloat(b.options.vva)]),
          (d.vf = [parseFloat(b.options.vhf), parseFloat(b.options.vvf)]),
          (d.vl = [parseFloat(b.options.vlx), parseFloat(b.options.vly)]),
          (d.vo = [parseFloat(b.options.vox), parseFloat(b.options.voy)]),
          (p = new PIXI.Program(
            BaseSprite.TransformVertexSource,
            BaseSprite.UVTranslateFragmentSource,
            "tr_uv_translate"
          ));
    }
  else p = BaseSprite.Program;
  p = new PIXI.Shader(p, d);
  let r = new PIXI.Mesh(c, p);
  r.go = a;
  r.update = () => {
    r.scale.x = l.sx ?? 1;
    r.scale.y = l.sy ?? 1;
    r.alpha = k;
    r.rotation = 0;
    a.bounds = r.getLocalBounds();
  };
  return r;
};
BaseSprite.ExtractOutline = function (a) {
  let b = a.p.sh || [],
    c = [];
  for (let d = 0, e = b.length; d < e; d++)
    if (b[d].c == EntityCategory.STATIC_WORLD && b[d].t === GameShape.POLYGON) {
      let f = polyRotateCopy(b[d].v, a.p.r || 0);
      c.push({ x1: a.p.x + f[0].x, y1: a.p.y + f[0].y, x2: f[1].x - f[0].x, y2: f[1].y - f[0].y });
      c.push({ x1: a.p.x + f[1].x, y1: a.p.y + f[1].y, x2: f[2].x - f[1].x, y2: f[2].y - f[1].y });
      c.push({ x1: a.p.x + f[2].x, y1: a.p.y + f[2].y, x2: f[0].x - f[2].x, y2: f[0].y - f[2].y });
    }
  return c;
};
BaseSprite.ColoredVertexSource =
  "\nprecision highp float;\nattribute vec2 aVertexPosition;\nattribute vec4 aColor;\nattribute vec2 aUvs;\nuniform mat3 translationMatrix;\nuniform mat3 projectionMatrix;\nvarying vec2 vUvs;\nvarying vec4 vColor;\nvoid main() {\n    vUvs = aUvs;\n    vColor = aColor;\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n}";
BaseSprite.ColoredFragmentSource =
  "\nprecision highp float;\nvarying vec4 vColor;\nvarying vec2 vUvs;\nuniform vec4 color;\nuniform sampler2D uSampler2;\nvoid main() {\n\tvec4 pixel = texture2D(uSampler2, vUvs);\n\tpixel *= color * vColor;\n  gl_FragColor = vec4(pixel.rgb * pixel.a, pixel.a);\n}";
BaseSprite.DefaultColor = [1, 1, 1, 1];
BaseSprite.Program = new PIXI.Program(
  BaseSprite.ColoredVertexSource,
  BaseSprite.ColoredFragmentSource,
  "bsp"
);
BaseSprite.TransformVertexSource =
  "\nprecision highp float;\nattribute vec2 aVertexPosition;\nattribute vec4 aColor;\nattribute vec2 aUvs;\nuniform mat3 translationMatrix;\nuniform mat3 projectionMatrix;\nuniform float t;\nuniform vec2 va;\nuniform vec2 vf;\nuniform vec2 vl;\nuniform vec2 vo;\nvarying vec2 vUvs;\nvarying vec4 vColor;\nvoid main() {\n    vUvs = aUvs;\n    vColor = aColor;\n    vec2 pos = vec2(aVertexPosition);\n    float dx = 0.0;\n    float dy = 0.0;\n    if (vo.x != 0.0 && vo.y != 0.0) {\n      dx = clamp(vo.x == 0.0 ? 100.0 : vo.x - pos.x, -100.0, 100.0);\n      dy = clamp(vo.y == 0.0 ? 100.0 : vo.y - pos.y, -100.0, 100.0);\n    } else if (vo.y == 0.0){\n      dx = clamp(vo.x == 0.0 ? 100.0 : vo.x - pos.x, -100.0, 100.0);\n      dy = 0.0;\n    } else if (vo.x == 0.0){\n      dx = 0.0;\n      dy = clamp(vo.y == 0.0 ? 100.0 : vo.y - pos.y, -100.0, 100.0);\n    }\n    pos.x += sin(t * 0.01 * vf.x + 1.0 / vl.x * pos.y) * va.x * dy * 0.01;\n    pos.y += sin(t * 0.01 * vf.y + 1.0 / vl.y * pos.x) * va.y * dx * 0.01;\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(pos, 1.0)).xy, 0.0, 1.0);\n}";
BaseSprite.TransformFragmentSource =
  "\nprecision highp float;\nvarying vec4 vColor;\nvarying vec2 vUvs;\nuniform vec4 color;\nuniform vec2 vo;\nuniform sampler2D uSampler2;\nvoid main() {\n\tvec4 pixel = texture2D(uSampler2, vUvs);\n\tpixel *= color * vColor;\n  gl_FragColor = vec4(pixel.rgb * pixel.a, pixel.a);\n}";
BaseSprite.DefaultColor = [1, 1, 1, 1];
BaseSprite.TransformProgram = new PIXI.Program(
  BaseSprite.TransformVertexSource,
  BaseSprite.TransformFragmentSource,
  "transform"
);
BaseSprite.FluidVertexSource =
  "\nprecision highp float;\nattribute vec2 aVertexPosition;\nattribute vec4 aColor;\nattribute vec2 aUvs;\nuniform mat3 translationMatrix;\nuniform mat3 projectionMatrix;\nuniform float t;\nuniform float w;\nvarying vec2 vUvs;\nvarying vec4 vColor;\nvarying vec2 vPos;\nvoid main() {\n    vUvs = aUvs;\n    vColor = aColor;\n    vPos = aVertexPosition;\n    vPos[1] -= 15.0 + sin(t * 0.04 + aVertexPosition.x * 0.1) * w;\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(vPos, 1.0)).xy, 0.0, 1.0);\n}";
BaseSprite.FluidFragmentSource =
  "\nprecision highp float;\nvarying vec4 vColor;\nvarying vec2 vUvs;\nvarying vec2 vPos;\nuniform vec4 color;\nuniform sampler2D uSampler2;\nuniform float t;\nvoid main() {\n\tvec4 pixel = texture2D(uSampler2, vUvs + vec2(sin(t * 0.01) * 0.1, cos(t * 0.001)));\n  float shine = -(sin(t * 0.04 + vPos.x * 0.004) + 0.4) * 0.2;\n\tpixel *= color * vColor + vec4(shine, shine, shine, 0.0);\n  gl_FragColor = vec4(pixel.rgb * pixel.a, pixel.a);\n}";
BaseSprite.FluidProgram = new PIXI.Program(
  BaseSprite.FluidVertexSource,
  BaseSprite.FluidFragmentSource,
  "fluid"
);
BaseSprite.UVTranslateFragmentSource =
  "\nprecision highp float;\nvarying vec4 vColor;\nvarying vec2 vUvs;\nuniform vec4 color;\nuniform float t;\nuniform vec2 v;\nuniform sampler2D uSampler2;\nvoid main() {\n\tvec4 pixel = texture2D(uSampler2, vUvs + t * 0.01 * v);\n\tpixel *= color * vColor;\n  gl_FragColor = vec4(pixel.rgb * pixel.a, pixel.a);\n}";
BaseSprite.UVRotateFragmentSource =
  "\nprecision highp float;\nvarying vec4 vColor;\nvarying vec2 vUvs;\nuniform vec4 color;\nuniform float t;\nuniform float av;\nuniform int os;\nuniform vec2 p;\nuniform sampler2D uSampler2;\nvoid main() {\n  vec2 diff = vUvs - p;\n  float theta = atan(diff.y, diff.x);\n  float delta = length(diff);\n  vec2 pos = vec2(delta * cos(theta + t * av), delta * sin(theta + t * av));\n\tvec4 pixel = texture2D(uSampler2, pos);\n\tpixel *= color * vColor;\n  gl_FragColor = vec4(pixel.rgb * pixel.a, pixel.a);\n}";
class GoldSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.gold);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.16;
    this.scale.y = 0.16;
  }
  animate(a) {}
  init() {
    this.alpha = 1;
  }
}
class BallSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.ball);
    this.rotation = Math.PI;
    this.anchor.x = 0.15;
    this.anchor.y = 0.5;
  }
  pointLeft() {
    this.scale.x = -1.3;
    this.scale.y = -1.3;
  }
  pointRight() {
    this.scale.x = -1.3;
    this.scale.y = 1.3;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class FlagSprite extends PIXI.Sprite {
  constructor(a) {
    super();
    this.flagPole = new PIXI.Sprite(App.CombinedTextures.flagpole);
    this.cloth = "flag_" + Team.Colors[a.team];
    this.flagPole.scale.x = 2;
    this.flagPole.scale.y = 2;
    this.flagPole.anchor.x = this.flagPole.anchor.y = 0.5;
    this.verts = [0, 10, 80, 10, 80, -50, 0, -115];
    this.mesh = this.constructMesh();
    this.p2v = { x: 0, y: 0 };
    this.p3v = { x: 0, y: 0 };
    this.p2 = { x: 0, y: 10 };
    this.p3 = { x: 0, y: -115 };
    this.flagStretch = 100;
    this.time = 0;
    this.d0s = Math.sqrt(100);
    this.a0s = Math.atan2(10, 0);
    this.d1s = Math.sqrt(13225);
    this.a1s = Math.atan2(-115, 0);
    this.addChild(this.flagPole);
    this.addChild(this.mesh);
  }
  pointLeft() {
    this.scale.x = -0.5;
    this.scale.y = -0.5;
  }
  pointRight() {
    this.scale.x = -0.5;
    this.scale.y = 0.5;
  }
  animate(a) {
    var b = a.x,
      c = a.y,
      d = a.vx || 0,
      e = a.vy || 0,
      f = this.mesh,
      g = 0;
    0.01 < d * d + e * e && 0.5 < Math.abs(d)
      ? (this.time = 0)
      : 40 <= ++this.time && (g = Math.sin(0.05 * (this.time - 40)) * Math.PI * 0.7);
    f.rotation = -a.r + g;
    a = this.d0s * Math.cos(this.a0s - f.rotation);
    g = this.d0s * Math.sin(this.a0s - f.rotation);
    var h = this.d1s * Math.cos(this.a1s - f.rotation),
      m = this.d1s * Math.sin(this.a1s - f.rotation);
    this.p2v.x = 0.2 * (this.p2v.x + 0.5 * PC.GRAVITY.x);
    this.p2v.y = 0.2 * (this.p2v.y + 0.5 * PC.GRAVITY.y);
    var n = this.p2.x + this.p2v.x - (a + b),
      l = this.p2.y + this.p2v.y - (g + c),
      k = Math.atan2(l, n);
    n * n + l * l > this.flagStretch * this.flagStretch &&
      ((this.p2v.x = 0.5 * -d),
      (this.p2v.y = 0.5 * -e),
      (this.p2.x = a + b + (this.flagStretch - 1) * Math.cos(k)),
      (this.p2.y = g + c + (this.flagStretch - 1) * Math.sin(k)));
    this.p2.x += this.p2v.x;
    this.p2.y += this.p2v.y;
    this.p3v.x = 0.7 * (this.p3v.x + 0.5 * PC.GRAVITY.x);
    this.p3v.y = 0.7 * (this.p3v.y + 0.5 * PC.GRAVITY.y);
    n = this.p3.x + this.p3v.x - (h + b);
    l = this.p3.y + this.p3v.y - (m + c);
    k = Math.atan2(l, n);
    n * n + l * l > this.flagStretch * this.flagStretch &&
      ((this.p3v.x = 0.7 * -d),
      (this.p3v.y = 0.7 * -e),
      (this.p3.x = h + b + (this.flagStretch - 1) * Math.cos(k)),
      (this.p3.y = m + c + (this.flagStretch - 1) * Math.sin(k)));
    this.p3.x += this.p3v.x;
    this.p3.y += this.p3v.y;
    f.vertices[0] = a;
    f.vertices[1] = g;
    f.vertices[2] = this.p2.x - b;
    f.vertices[3] = this.p2.y - c;
    f.vertices[4] = this.p3.x - b;
    f.vertices[5] = this.p3.y - c;
    f.vertices[6] = h;
    f.vertices[7] = m;
  }
  init(a) {
    this.alpha = 1;
    this.p2.x = a.x;
    this.p2.y = a.y + 10;
    this.p3.x = a.x;
    this.p3.y = a.y - 115;
  }
  constructMesh() {
    return new PIXI.SimpleMesh(
      App.CombinedTextures[this.cloth],
      new Float32Array(this.verts),
      new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]),
      new Uint16Array([0, 1, 2, 0, 2, 3]),
      PIXI.DRAW_MODES.TRIANGLE_STRIP
    );
  }
}
class AK47AmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.ak47_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.56;
    this.scale.x = 0.3;
    this.scale.y = 0.3;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class BarrettAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.barrett_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.38;
    this.scale.y = 0.38;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class ChainsawAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.chainsaw_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.65;
    this.scale.x = 0.55;
    this.scale.y = 0.55;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class ClusterNadeBoxSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.clusternadebox);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.32;
    this.scale.y = 0.32;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class DesertEagleAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.deagle_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.32;
    this.scale.y = 0.32;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class FlameThrowerAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.flamethrower_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.5;
    this.scale.y = 0.5;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class HealthBoxSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.healthbox);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.32;
    this.scale.y = 0.32;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class LaserGunAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.lasergun_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.37;
    this.scale.y = 0.37;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class LinkGunAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.linkgun_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.35;
    this.scale.y = 0.35;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class MAC10AmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.mac10_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.38;
    this.scale.y = 0.38;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class MinigunAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.minigun_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.4;
    this.scale.y = 0.4;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class NadeBoxSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.nadebox);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.32;
    this.scale.y = 0.32;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class NadeLauncherAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.m79_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.28;
    this.scale.y = 0.28;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class PulseGunAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.pulsegun_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.35;
    this.scale.y = 0.35;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class RifleAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.m16_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.38;
    this.scale.y = 0.38;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class RPGAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.rpg_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.4;
    this.scale.y = 0.4;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class ShockRifleAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.shockrifle_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.4;
    this.scale.y = 0.4;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class ShotgunAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.shotgun_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.25;
    this.scale.y = 0.25;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class ShurikenBoxSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.shurikenbox);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.35;
    this.scale.y = 0.35;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class SMGAmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.smg_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.4;
    this.scale.y = 0.4;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class SnowballBoxSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.snowballbox);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.4;
    this.scale.y = 0.4;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class X75AmmoSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.x75_ammo);
    this.rotation = Math.PI;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.3;
    this.scale.y = 0.3;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class AK47Sprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.ak47);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.32;
    this.anchor.y = 0.36;
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 200;
    this.fireAnchor.y = -16;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -4;
    this.addAnchor(2, this.ejectionAnchor);
  }
  pointLeft() {
    this.scale.x = -0.725;
    this.scale.y = -0.725;
  }
  pointRight() {
    this.scale.x = -0.725;
    this.scale.y = 0.725;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class BarrettSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.barrett);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.2;
    this.anchor.y = 0.7;
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 400;
    this.fireAnchor.y = -30;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
  }
  pointLeft() {
    this.scale.x = -0.55;
    this.scale.y = -0.55;
  }
  pointRight() {
    this.scale.x = -0.55;
    this.scale.y = 0.55;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class BowSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.bow_item);
    AnchorBase.call(this);
    this.activeTexture = "bow1";
    this.rotation = Math.PI;
    this.anchor.x = 0.22;
    this.anchor.y = 0.58;
    this.frame = 0;
    this.customOffset = !0;
    this.secondaryRotation = 0 * Math.PI;
    this.secondaryAnchor = { x: 0.7, y: 0.4 };
    this.secondaryScale = { x: -1.8, y: 1.8 };
    this.animateWhenUsing = !0;
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 200;
    this.fireAnchor.y = -15;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 20;
    this.ejectionAnchor.y = -4;
    this.addAnchor(2, this.ejectionAnchor);
    this.gearArmOffset = { x: -4, y: -4 };
    this.gearArmOffsetAnimating = { x: 18, y: -36 };
  }
  pointLeft() {
    this.scale.x = -0.8;
    this.scale.y = -1;
  }
  pointRight() {
    this.scale.x = -0.8;
    this.scale.y = 1;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  animateUsage(a = !0) {
    this.activeTexture = "bow" + BowSprite.Textures[this.frame];
    this.texture = App.CombinedTextures[this.activeTexture];
    a
      ? ((this.anchor.x = 0.22 + BowSprite.Anchor[this.frame].x),
        (this.anchor.y = 0.58 - BowSprite.Anchor[this.frame].y))
      : ((this.anchor.x = 0.22), (this.anchor.y = 0.58));
    this.frame = this.frame + 1 === BowSprite.Textures.length ? 0 : this.frame + 1;
  }
  applyDefaultTexture() {
    this.activeTexture = "bow1";
    this.texture = App.CombinedTextures[this.activeTexture];
    this.anchor.x = 0.22;
    this.anchor.y = 0.58;
  }
  init() {
    this.alpha = 1;
  }
}
BowSprite.prototype = Object.create(PIXI.Sprite.prototype);
BowSprite.prototype.constructor = BowSprite;
AnchorBase.call(BowSprite.prototype);
BowSprite.Textures = [2, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4];
BowSprite.Anchor = [
  { x: 0, y: 0 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
  { x: -0.2, y: -0.11 },
];
class CarbineSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.m1carbine);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.26;
    this.anchor.y = 0.6;
    this.secondaryScale = { x: 0.85, y: 0.85 };
    this.secondaryRotation = 1.08 * Math.PI;
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 280;
    this.fireAnchor.y = -30;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 60;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
    this.gearArmOffset = { x: -8, y: -4 };
  }
  pointLeft() {
    this.scale.x = -0.55;
    this.scale.y = -0.55;
  }
  pointRight() {
    this.scale.x = -0.55;
    this.scale.y = 0.55;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class ChainsawSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.chainsaw);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.15;
    this.anchor.y = 0.6;
    this.origin = { x: 0.5, y: 0 };
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 0;
    this.fireAnchor.y = 0;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
  }
  pointLeft() {
    this.scale.x = -0.8;
    this.scale.y = -0.8;
  }
  pointRight() {
    this.scale.x = -0.8;
    this.scale.y = 0.8;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
  onUse() {
    this.anchor.x = 0.15 + (-0.015 + 0.03 * Math.random());
    this.anchor.y = 0.6 + (-0.015 + 0.03 * Math.random());
  }
}
class DesertEagleSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.deagle);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.18;
    this.anchor.y = 0.4;
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 100;
    this.fireAnchor.y = -14;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
    this.gearArmOffset = { x: -8, y: -2 };
  }
  pointLeft() {
    this.scale.x = -0.5;
    this.scale.y = -0.5;
  }
  pointRight() {
    this.scale.x = -0.5;
    this.scale.y = 0.5;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class FistSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.fists);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.32;
    this.anchor.y = 0.36;
  }
  pointLeft() {
    this.scale.x = -0.725;
    this.scale.y = -0.725;
  }
  pointRight() {
    this.scale.x = -0.725;
    this.scale.y = 0.725;
  }
}
class FlameThrowerSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.flamethrower);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.27;
    this.anchor.y = 0.48;
    this.origin = { x: 0.5, y: 0 };
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 2;
    this.fireAnchor.y = -20;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
  }
  pointLeft() {
    this.scale.x = -0.85;
    this.scale.y = -0.85;
  }
  pointRight() {
    this.scale.x = -0.85;
    this.scale.y = 0.85;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class LaserGunSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.lasergun);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.27;
    this.anchor.y = 0.7;
    this.origin = { x: 0.5, y: 0 };
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 200;
    this.fireAnchor.y = -20;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
    this.gearArmOffset = { x: 0, y: -2 };
  }
  pointLeft() {
    this.scale.x = -0.525;
    this.scale.y = -0.525;
  }
  pointRight() {
    this.scale.x = -0.525;
    this.scale.y = 0.525;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
    this.scale.x = this.scale.y = 1.05;
  }
}
class LinkGunSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.link_gun);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.29;
    this.anchor.y = 0.6;
    this.origin = { x: 0.5, y: 0 };
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 0;
    this.fireAnchor.y = -16;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
  }
  pointLeft() {
    this.scale.x = -0.8;
    this.scale.y = -0.8;
  }
  pointRight() {
    this.scale.x = -0.8;
    this.scale.y = 0.8;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
  onUse() {}
}
class MAC10Sprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.mac10);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.24;
    this.anchor.y = 0.48;
    this.origin = { x: 0.5, y: 0 };
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 166;
    this.fireAnchor.y = -16;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
  }
  pointLeft() {
    this.scale.x = -0.55;
    this.scale.y = -0.55;
  }
  pointRight() {
    this.scale.x = -0.55;
    this.scale.y = 0.55;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class MinigunSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.minigun);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.2;
    this.anchor.y = 0.48;
    this.origin = { x: 1, y: 0 };
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 290;
    this.fireAnchor.y = 20;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
  }
  pointLeft() {
    this.scale.x = -0.565;
    this.scale.y = -0.565;
  }
  pointRight() {
    this.scale.x = -0.565;
    this.scale.y = 0.565;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class NadeLauncherSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.m79);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.3;
    this.anchor.y = 0.7;
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 200;
    this.fireAnchor.y = -12;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
  }
  pointLeft() {
    this.scale.x = -0.7;
    this.scale.y = -0.9;
  }
  pointRight() {
    this.scale.x = -0.7;
    this.scale.y = 0.9;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class PulseGunSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.pulsegun);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.15;
    this.anchor.y = 0.48;
    this.origin = { x: 0.3, y: 0.2 };
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 186;
    this.fireAnchor.y = -20;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
    this.scale.x = this.scale.y = 1.5;
  }
  pointLeft() {
    this.scale.x = -0.75;
    this.scale.y = -0.75;
  }
  pointRight() {
    this.scale.x = -0.75;
    this.scale.y = 0.75;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class RifleSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.rifle_m16);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.27;
    this.anchor.y = 0.62;
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 200;
    this.fireAnchor.y = -20;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
    this.gearArmOffset = { x: -8, y: -6 };
  }
  pointLeft() {
    this.scale.x = -0.85;
    this.scale.y = -0.85;
  }
  pointRight() {
    this.scale.x = -0.85;
    this.scale.y = 0.85;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class RocketLauncherSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.rocketlauncher);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.3;
    this.anchor.y = 0.7;
    this.secondaryScale = { x: -0.7, y: 0.7 };
    this.secondaryAnchor = { x: 0.7, y: 0.4 };
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 200;
    this.fireAnchor.y = -12;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
    this.gearArmOffset = { x: 0, y: 2 };
  }
  pointLeft() {
    this.scale.x = -0.425;
    this.scale.y = -0.425;
  }
  pointRight() {
    this.scale.x = -0.425;
    this.scale.y = 0.425;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class RPGSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.rpg);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.3;
    this.anchor.y = 0.7;
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 200;
    this.fireAnchor.y = -12;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = -100;
    this.ejectionAnchor.y = -30;
    this.addAnchor(2, this.ejectionAnchor);
  }
  pointLeft() {
    this.scale.x = -0.7;
    this.scale.y = -0.7;
  }
  pointRight() {
    this.scale.x = -0.7;
    this.scale.y = 0.7;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class ShockRifleSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.shockrifle);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.2;
    this.anchor.y = 0.5;
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 200;
    this.fireAnchor.y = -12;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
    this.scale.x = 1;
    this.scale.y = 1;
  }
  pointLeft() {
    this.scale.x = -0.5;
    this.scale.y = -0.5;
  }
  pointRight() {
    this.scale.x = -0.5;
    this.scale.y = 0.5;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class ShotgunSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.shotgun_m2);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.3;
    this.anchor.y = 0.4;
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 180;
    this.fireAnchor.y = -12;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
    this.gearArmOffset = { x: -10, y: 0 };
  }
  pointLeft() {
    this.scale.x = -0.9;
    this.scale.y = -0.9;
  }
  pointRight() {
    this.scale.x = -0.9;
    this.scale.y = 0.9;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class SubmachineGunSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.mp5);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.27;
    this.anchor.y = 0.48;
    this.origin = { x: 0.5, y: 0 };
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 130;
    this.fireAnchor.y = -20;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
    this.gearArmOffset = { x: -8, y: 2 };
  }
  pointLeft() {
    this.scale.x = -0.85;
    this.scale.y = -0.85;
  }
  pointRight() {
    this.scale.x = -0.85;
    this.scale.y = 0.85;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
class X75Sprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.x75);
    AnchorBase.call(this);
    this.rotation = Math.PI;
    this.anchor.x = 0.35;
    this.anchor.y = 0.525;
    this.fireAnchor = new PIXI.Container();
    this.fireAnchor.x = 200;
    this.fireAnchor.y = -12;
    this.addAnchor(1, this.fireAnchor);
    this.ejectionAnchor = new PIXI.Container();
    this.ejectionAnchor.x = 40;
    this.ejectionAnchor.y = -8;
    this.addAnchor(2, this.ejectionAnchor);
  }
  pointLeft() {
    this.scale.x = -0.55;
    this.scale.y = -0.55;
  }
  pointRight() {
    this.scale.x = -0.55;
    this.scale.y = 0.55;
  }
  animate(a) {
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
  init() {
    this.alpha = 1;
  }
}
Prefabs = {
  LINE_SPRITE: "line",
  CIRCLE_SPRITE: "circle",
  RECTANGLE_SPRITE: "rectangle",
  NADE_SPRITE: "nadesprite",
  HEAD_SPRITE: "playerHead",
  TORSO_UPPER_SPRITE: "torsoUpper",
  TORSO_LOWER_SPRITE: "torsoLower",
  ARM_LEFTUPPER_SPRITE: "armLeftUpper",
  ARM_LEFTLOWER_SPRITE: "armLeftLower",
  ARM_RIGHTUPPER_SPRITE: "armRightUpper",
  ARM_RIGHTLOWER_SPRITE: "armRightLower",
  LEG_LEFTUPPER_SPRITE: "legLeftUpper",
  LEG_LEFTLOWER_SPRITE: "legLeftLower",
  LEG_RIGHTUPPER_SPRITE: "legRightUpper",
  LEG_RIGHTLOWER_SPRITE: "legRightLower",
  FIREBALL: "fireballsprite",
  TINYSHRAPNEL: "tinyshrapnelsprite",
  GHOST_SPRITE: "ghost",
};
class GhostSprite extends PIXI.Sprite {
  constructor() {
    super();
    this.trail = new TrailSprite();
    this.trail.alpha = 0.3;
    this.trail.x = 2;
    this.trail.anchor.x = 0.1;
    this.addChild(this.trail);
    this.nade = new PIXI.Sprite(App.CombinedTextures.bot);
    this.nade.anchor.x = this.nade.anchor.y = 0.5;
    this.nade.scale.x = this.nade.scale.y = 2;
    this.addChild(this.nade);
    this.scale.x = this.scale.y = 1;
    this.frame = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.trail.rotation = -this.rotation + Math.atan2(a.vy, a.vx) + Math.PI);
    3 < this.frame &&
      ((this.trail.scale.x = 3.3 + 0.7 * b),
      (this.trail.scale.y = 3.5),
      (this.trail.alpha = 0.005 * b));
  }
}
class CircleSprite extends PIXI.Sprite {
  constructor(a) {
    const b = new PIXI.Graphics();
    b.beginFill(16777215, 1);
    b.drawCircle(0, 0, a.data.radius);
    b.endFill();
    super(App.Renderer.generateTexture(b));
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.bounds = { x: -50, y: -50, width: 100, height: 100 };
  }
}
class LineSprite extends PIXI.Sprite {
  constructor(a) {
    const b = Math.sqrt(a.data.dx * a.data.dx + a.data.dy * a.data.dy),
      c = a.data.size || 3;
    a = void 0 !== a.data.rounded ? a.data.rounded : !0;
    const d = new PIXI.Graphics();
    d.beginFill(16777215, 1);
    a && (d.drawCircle(0, 0.5 * c, 0.5 * c), d.drawCircle(b, 0.5 * c, 0.5 * c));
    d.drawRect(0, 0, b, c);
    d.endFill();
    super(App.Renderer.generateTexture(d));
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.alpha = 0.8;
    this.bounds = { x: -50, y: -50, width: 100, height: 100 };
  }
}
class GhostBotDebrisSprite1 extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.dronepiece1);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.65;
    this.scale.y = 0.65;
    this.alpha = 1;
  }
  animate(a) {
    this.rotation = a.r + Math.PI;
    20 > a.ttl && (this.alpha -= 0.05);
  }
}
class GhostBotDebrisSprite2 extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.dronepiece2);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.65;
    this.scale.y = 0.65;
    this.alpha = 1;
  }
  animate(a) {
    this.rotation = a.r + Math.PI;
    20 > a.ttl && (this.alpha -= 0.05);
  }
}
class GhostBotDebrisSprite3 extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.dronepiece3);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.65;
    this.scale.y = 0.65;
    this.alpha = 1;
  }
  animate(a) {
    this.rotation = a.r + Math.PI;
    20 > a.ttl && (this.alpha -= 0.05);
  }
}
class TinyShrapnelSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.debris1);
    this.anchor.x = 0.5;
    this.anchor.y = 0;
    this.scale.x = 0.05 + 0.2 * Math.random();
    this.scale.y = 0.05 + 0.2 * Math.random();
    this.alpha = 1;
    this.vr = -0.1 + 0.2 * Math.random();
  }
  animate(a) {
    this.rotation += this.vr;
    this.alpha -= 0.01;
  }
}
TinyShrapnelSprite.TEXTURE = null;
class TrailSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.trail);
    this.scale.x = this.scale.y = 0.3;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
  }
}
class AK47BulletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.streak);
    this.anchor.x = 0.25;
    this.anchor.y = 0.5;
    this.scale.y = 0.35;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.rotation = fastAtan2(a.vy, a.vx) + Math.PI);
    5 < this.frame && ((this.scale.x = 0.02 + 0.01 * b), (this.alpha = 0.4));
  }
}
class ArrowSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.arrow);
    this.anchor.x = 0;
    this.anchor.y = 0.5;
    this.scale.x = 0.6;
    this.scale.y = 0.6;
    this.lastRotation = this.currentRotation = this.rotation;
  }
  animate(a) {
    this.lastRotation = this.currentRotation;
    this.currentRotation = Math.atan2(a.vy, a.vx);
    this.rotation = this.currentRotation + Math.PI;
  }
  init() {}
}
class BarrettBulletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.streak);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.y = 0.3;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.rotation = fastAtan2(a.vy, a.vx) + Math.PI);
    3 < this.frame && ((this.scale.x = 0.09 + 0.005 * b), (this.alpha = 0.6));
  }
}
class CarbineBulletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.streak);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.y = 0.2;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.rotation = fastAtan2(a.vy, a.vx) + Math.PI);
    2 < this.frame && ((this.scale.x = 0.05 + 0.004 * b), (this.alpha = 0.6));
  }
}
class DesertEagleBulletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.streak);
    this.anchor.x = 0.25;
    this.anchor.y = 0.5;
    this.scale.y = 0.45;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.rotation = fastAtan2(a.vy, a.vx) + Math.PI);
    5 < this.frame && ((this.scale.x = 0.02 + 0.01 * b), (this.alpha = 0.4));
  }
}
class FlameThrowerLiquidSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.flame4);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.1;
    this.scale.y = 0.1;
    this.alpha = 0;
    this.lastY = this.lastX = null;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    null === this.lastX && ((this.lastX = this.px - a.vx), (this.lastY = this.py - a.vy));
    this.rotation = Math.atan2(a.y - this.lastY, a.x - this.lastX) + Math.PI;
    4 < this.frame &&
      ((this.alpha = 40 < this.frame ? 0 : 1 - 0.04 * this.frame), (this.scale.x = 0.5));
    this.lastX = a.x;
    this.lastY = a.y;
    this.alpha = 0;
  }
  init() {}
}
class GhostLaserSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.flare1);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.08;
    this.scale.y = 0.08;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    this.rotation = Math.random() * Math.PI * 2;
    this.scale.x = this.scale.y = 0.08 + 0.5 * Math.sin(0.2 * this.frame);
    4 < this.frame
      ? (this.alpha = 1)
      : ((this.alpha += 0.25), (this.scale.x += 0.1), (this.scale.y += 0.1));
  }
}
class LaserGunBulletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.laser_green);
    this.anchor.x = 0.2;
    this.anchor.y = 0.5;
    this.scale.y = 0.2;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    this.rotation = Math.atan2(a.vy, a.vx) + Math.PI;
    4 < this.frame &&
      ((this.scale.x = 0.03 + 0.005 * Math.sqrt(a.vx * a.vx + a.vy * a.vy)), (this.alpha = 0.8));
  }
  init() {}
}
class LauncherNadeSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.launcher_nade);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.6;
    this.scale.y = 0.6;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    0.1 < Math.sqrt(a.vx * a.vx + a.vy * a.vy) &&
      (this.rotation = Math.atan2(a.vy, a.vx) + 0.5 * Math.PI);
    5 < this.frame && (this.alpha = 0.5);
  }
  init() {}
}
LauncherNadeSprite.prototype = Object.create(PIXI.Sprite.prototype);
LauncherNadeSprite.TEXTURE = null;
class MAC10BulletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.streak);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.y = 0.2;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.rotation = fastAtan2(a.vy, a.vx) + Math.PI);
    1 < this.frame && ((this.scale.x = 0.01 + 0.005 * b), (this.alpha = 0.6 - 0.015 * this.frame));
  }
  init() {}
}
class MinigunBulletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.streak);
    this.anchor.x = 0.75;
    this.anchor.y = 0.5;
    this.scale.y = 0.16;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    if (4 < this.frame) {
      let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
      0.1 < b && (this.rotation = Math.atan2(a.vy, a.vx) + Math.PI);
      this.scale.x = 0.01 + 0.002 * b;
      this.alpha = 0.4;
    }
  }
  init() {}
}
class PulseGunBulletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.pulsegun_orb_blue);
    this.anchor.x = 0.1;
    this.anchor.y = 0.5;
    this.scale.x = 0.2;
    this.scale.y = 0.3;
    this.frame = 0;
  }
  animate(a) {
    this.frame++;
    0.1 < Math.sqrt(a.vx * a.vx + a.vy * a.vy) && (this.rotation = fastAtan2(a.vy, a.vx) + Math.PI);
    3 < this.frame &&
      ((this.alpha = 1), (this.scale.x = 0.2 + 0.02 * (50 < this.frame ? 50 : this.frame)));
  }
  init() {
    this.frame = this.alpha = 0;
  }
}
class RifleBulletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.streak);
    this.anchor.x = 0.25;
    this.anchor.y = 0.5;
    this.scale.y = 0.3;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.rotation = fastAtan2(a.vy, a.vx) + Math.PI);
    5 < this.frame && ((this.scale.x = 0.02 + 0.01 * b), (this.alpha = 0.4));
  }
}
class RLRocketSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.rl_rocket);
    this.anchor.x = 1;
    this.anchor.y = 0.5;
    this.scale.x = 0.3;
    this.scale.y = 0.3;
    this.frame = this.alpha = this.rotation = 0;
  }
  animate(a) {
    this.frame++;
    0.1 < Math.sqrt(a.vx * a.vx + a.vy * a.vy) && (this.rotation = Math.atan2(a.vy, a.vx));
    3 < this.frame && (this.alpha = 1);
  }
  init() {}
}
RLRocketSprite.TEXTURE = null;
class RPGRocketSprite extends PIXI.Sprite {
  constructor() {
    super();
    this.graphic = new PIXI.Sprite(App.CombinedTextures.rpg_rocket);
    this.graphic.anchor.x = 1;
    this.graphic.anchor.y = 0.5;
    this.graphic.scale.x = 0.6;
    this.graphic.scale.y = 0.6;
    this.graphic.rotation = Math.PI;
    this.addChild(this.graphic);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
  }
  animate(a) {
    this.frame++;
    0.1 < Math.sqrt(a.vx * a.vx + a.vy * a.vy) && (this.rotation = fastAtan2(a.vy, a.vx) + Math.PI);
    3 < this.frame && (this.alpha = 1);
  }
  init() {
    this.frame = this.alpha = 0;
  }
}
RPGRocketSprite.TEXTURE = null;
class ShockRifleBulletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.shockrifle_orb);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.8;
    this.scale.y = 0.8;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    this.rotation = a.r;
    this.scale.x = this.scale.y = 0.8 + 0.1 * Math.sin(0.5 * this.frame);
    4 < this.frame
      ? (this.alpha = 1)
      : ((this.alpha += 0.25), (this.scale.x += 0.1), (this.scale.y += 0.1));
  }
}
class ShotgunPelletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.shotgun_pellet);
    this.anchor.x = 0.5;
    this.anchor.y = 0.2;
    this.scale.x = 0.4;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.rotation = Math.atan2(a.vy, a.vx) + 0.5 * Math.PI;
    7 < this.frame++ &&
      ((this.scale.y = 0.02 + 0.02 * Math.sqrt(a.vx * a.vx + a.vy * a.vy)), (this.alpha = 0.5));
  }
}
class SubmachineGunBulletSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.streak);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.y = 0.28;
    this.frame = this.alpha = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.rotation = Math.atan2(a.vy, a.vx) + Math.PI);
    4 < this.frame && ((this.scale.x = 0.01 + 0.006 * b), (this.alpha = 0.4));
  }
}
class X75NadeSprite extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures["green-exp"]);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.scale.x = 0.4;
    this.scale.y = 0.4;
    this.rotation = 0.5 * -Math.PI;
  }
  animate(a) {
    this.frame++;
    this.rotation = Math.random() * Math.PI * 2;
    5 < this.frame && (this.alpha = 1);
  }
  init() {
    this.frame = this.alpha = 0;
  }
}
X75NadeSprite.TEXTURE = null;
class RectangleSprite extends PIXI.Sprite {
  constructor(a) {
    const b = new PIXI.Graphics();
    b.beginFill(16755200, 1);
    b.drawRect(0, 0, a.data.width, a.data.height);
    b.endFill();
    super(App.Renderer.generateTexture(b));
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.alpha = 0.8;
    this.bounds = { x: -50, y: -50, width: 100, height: 100 };
  }
}
class ClusterNadeFragmentSprite extends PIXI.Sprite {
  constructor() {
    super();
    this.trail = new TrailSprite();
    this.trail.alpha = 0.3;
    this.trail.x = 2;
    this.trail.anchor.x = 0.1;
    this.addChild(this.trail);
    this.nade = new PIXI.Sprite(App.CombinedTextures.clusternadefragment);
    this.nade.anchor.x = this.nade.anchor.y = 0.5;
    this.addChild(this.nade);
    this.scale.x = this.scale.y = 0.16;
    this.frame = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.trail.rotation = -this.rotation + fastAtan2(a.vy, a.vx) + Math.PI);
    3 < this.frame &&
      ((this.trail.scale.x = 1.5 + 0.7 * b),
      (this.trail.scale.y = 2),
      (this.trail.alpha = 0.005 * b));
  }
}
class ClusterNadeSprite extends PIXI.Sprite {
  constructor() {
    super();
    this.trail = new TrailSprite();
    this.trail.alpha = 0.3;
    this.trail.x = 2;
    this.trail.anchor.x = 0.1;
    this.addChild(this.trail);
    this.nade = new PIXI.Sprite(App.CombinedTextures.clustergrenade);
    this.nade.anchor.x = this.nade.anchor.y = 0.5;
    this.nade.scale.x = this.nade.scale.y = 1.1;
    this.addChild(this.nade);
    this.scale.x = this.scale.y = 0.156;
    this.frame = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.trail.rotation = -this.rotation + fastAtan2(a.vy, a.vx) + Math.PI);
    3 < this.frame &&
      ((this.trail.scale.x = 3.5 + 0.7 * b),
      (this.trail.scale.y = 3.7),
      (this.trail.alpha = 0.005 * b));
  }
}
class NadeSprite extends PIXI.Sprite {
  constructor() {
    super();
    this.trail = new TrailSprite();
    this.trail.alpha = 0.3;
    this.trail.x = 2;
    this.trail.anchor.x = 0.1;
    this.addChild(this.trail);
    this.nade = new PIXI.Sprite(App.CombinedTextures.handgrenade);
    this.nade.anchor.x = this.nade.anchor.y = 0.5;
    this.nade.scale.x = this.nade.scale.y = 1;
    this.addChild(this.nade);
    this.scale.x = this.scale.y = 0.156;
    this.frame = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.trail.rotation = -this.rotation + fastAtan2(a.vy, a.vx) + Math.PI);
    3 < this.frame &&
      ((this.trail.scale.x = 3.5 + 0.7 * b),
      (this.trail.scale.y = 3.7),
      (this.trail.alpha = 0.005 * b));
  }
}
class ShurikenBladeSprite extends PIXI.Sprite {
  constructor() {
    super();
    this.trail = new TrailSprite();
    this.trail.alpha = 0.3;
    this.trail.x = 2;
    this.trail.anchor.x = 0.1;
    this.trail.anchor.y = 0.5;
    this.addChild(this.trail);
    this.shuriken = new PIXI.Sprite(App.CombinedTextures.shuriken);
    this.shuriken.anchor.x = this.shuriken.anchor.y = 0.5;
    this.shuriken.scale.x = this.shuriken.scale.y = 3;
    this.addChild(this.shuriken);
    this.scale.x = this.scale.y = 0.065;
    this.frame = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.trail.rotation = -this.rotation + fastAtan2(a.vy, a.vx) + Math.PI);
    3 < this.frame &&
      ((this.trail.scale.x = 3.3 + 0.7 * b),
      (this.trail.scale.y = 3.5),
      (this.trail.alpha = 0.0025 * b));
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
}
class SnowballProjectileSprite extends PIXI.Sprite {
  constructor() {
    super();
    this.trail = new TrailSprite();
    this.trail.alpha = 0.3;
    this.trail.x = 2;
    this.trail.anchor.x = 0.1;
    this.addChild(this.trail);
    this.snowball = new PIXI.Sprite(App.CombinedTextures.snowball);
    this.snowball.anchor.x = this.snowball.anchor.y = 0.5;
    this.snowball.scale.x = this.snowball.scale.y = 2.3;
    this.addChild(this.snowball);
    this.scale.x = this.scale.y = 0.066;
    this.frame = 0;
  }
  animate(a) {
    this.frame++;
    let b = Math.sqrt(a.vx * a.vx + a.vy * a.vy);
    0.1 < b && (this.trail.rotation = -this.rotation + fastAtan2(a.vy, a.vx) + Math.PI);
    3 < this.frame &&
      ((this.trail.scale.x = 3.3 + 0.7 * b),
      (this.trail.scale.y = 3.5),
      (this.trail.alpha = 0.0025 * b));
    200 > --a.ttl && (this.alpha = 0.7 + 0.3 * Math.sin(a.ttl / 5));
  }
}
let rdScale = 0.26;
class HeadSprite extends PIXI.Sprite {
  constructor(a) {
    void 0 === a.team && (a.team = "alpha");
    let b = "head_" + a.team,
      c,
      d = !1;
    if (a.customization) {
      var e = a.customization[Customization.FACE];
      if (e && 0 < e.texture.length) {
        let f = e.cdata,
          g = !0;
        f && (void 0 !== f.custom && !1 === f.sprite && (g = !1), !1 === f.hair && (d = !0));
        g &&
          ((c = new PIXI.Sprite(App.CombinedTextures["face_" + e.texture])),
          f &&
            (void 0 !== f.ax && ((c.anchor.x = f.ax), (c.anchor.y = f.ay)),
            void 0 !== f.ox ? ((c.x = 2 + f.ox), (c.y = 24 + f.oy)) : ((c.x = 2), (c.y = 24)),
            f.vr && (c.vr = 0)));
      }
      if (((e = a.customization[Customization.HAIR]) && 0 < e.texture.length) || d)
        b += "_" + (d ? "slick" : e.texture);
    }
    super(App.CombinedTextures[b]);
    void 0 !== c &&
      ((this.face = c),
      this.addChild(c),
      a.customization.face.cdata && (this.data = a.customization.face.cdata));
    this.decal = App.CombinedTextures.head_gore;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.z = 10;
    this.scale.x = -rdScale;
    this.scale.y = -rdScale;
  }
  animate(a) {
    this.face &&
      (this.data.fr && (this.face.rotation = 0 > this.scale.x ? -this.rotation : this.rotation),
      this.data.vr && ((this.face.vr += this.data.vr), (this.face.rotation += this.face.vr)));
  }
  init(a) {
    this.alpha = 1;
  }
}
class TorsoUpperSprite extends PIXI.Sprite {
  constructor(a) {
    let b = "torsoupper";
    a.customization &&
      (a = a.customization[Customization.TORSO]) &&
      0 < a.texture.length &&
      (b += "_" + a.texture);
    super();
    this.sprite = new PIXI.Sprite(App.CombinedTextures[b]);
    this.sprite.anchor.x = this.sprite.anchor.y = 0.5;
    this.sprite.y = 8;
    this.addChild(this.sprite);
    this.decal = App.CombinedTextures.torsoupper_gore;
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    this.z = 10;
    this.scale.x = 1.35 * rdScale;
    this.scale.y = 1.35 * -rdScale;
  }
}
class TorsoLowerSprite extends PIXI.Sprite {
  constructor(a) {
    let b = "torsolower",
      c = {};
    a.customization &&
      ((c = a.customization[Customization.BELT] || {}),
      c.texture && 0 < c.texture.length && (b += "_" + c.texture));
    super(App.CombinedTextures[b]);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    c.cdata &&
      ((this.x = c.cdata.ox ? c.cdata.ox : 0),
      (this.y = c.cdata.oy ? c.cdata.oy : 0),
      void 0 !== c.cdata.ax &&
        ((this.anchor.x = 0 + c.cdata.ax), (this.anchor.y = 0 + c.cdata.ay)));
    this.decal = App.CombinedTextures.torsolower_gore;
    this.z = 10;
    this.scale.x = rdScale;
    this.scale.y = -rdScale;
  }
}
class ArmLeftUpperSprite extends PIXI.Sprite {
  constructor(a) {
    let b = "armleftupper",
      c = {};
    a.customization &&
      ((c = a.customization[Customization.ARMLEFTUPPER] || {}),
      c.texture && 0 < c.texture.length && (b += "_" + c.texture));
    super(App.CombinedTextures[b]);
    this.anchor.x = 0.625;
    this.anchor.y = 0.25;
    c.cdata &&
      ((this.x = c.cdata.ox ? c.cdata.ox : 0),
      (this.y = c.cdata.oy ? c.cdata.oy : 0),
      void 0 !== c.cdata.ax &&
        ((this.anchor.x = 0 + c.cdata.ax), (this.anchor.y = 0 + c.cdata.ay)));
    this.decal = App.CombinedTextures.armleftupper_gore;
    this.z = 10;
    this.scale.x = rdScale;
    this.scale.y = -rdScale;
  }
}
class ArmLeftLowerSprite extends PIXI.Sprite {
  constructor(a) {
    let b = "armleftlower",
      c = {};
    a.customization &&
      ((c = a.customization[Customization.ARMLEFTLOWER] || {}),
      c.texture && 0 < c.texture.length && (b += "_" + c.texture));
    super(App.CombinedTextures[b]);
    this.anchor.x = 0.52;
    this.anchor.y = 0.17;
    c.cdata &&
      ((this.x = c.cdata.ox ? c.cdata.ox : 0),
      (this.y = c.cdata.oy ? c.cdata.oy : 0),
      void 0 !== c.cdata.ax &&
        ((this.anchor.x = 0 + c.cdata.ax), (this.anchor.y = 0 + c.cdata.ay)));
    this.decal = App.CombinedTextures.armleftlower_gore;
    this.z = 10;
    this.scale.x = -rdScale;
    this.scale.y = -rdScale;
  }
}
class ArmRightUpperSprite extends PIXI.Sprite {
  constructor(a) {
    let b = "armrightupper",
      c = {};
    a.customization &&
      ((c = a.customization[Customization.ARMRIGHTUPPER] || {}),
      c.texture && 0 < c.texture.length && (b += "_" + c.texture));
    super(App.CombinedTextures[b]);
    this.anchor.x = 0.343;
    this.anchor.y = 0.25;
    c.cdata &&
      ((this.x = c.cdata.ox ? c.cdata.ox : 0),
      (this.y = c.cdata.oy ? c.cdata.oy : 0),
      void 0 !== c.cdata.ax &&
        ((this.anchor.x = -0.1 + c.cdata.ax), (this.anchor.y = 0.05 + c.cdata.ay)));
    this.decal = App.CombinedTextures.armrightupper_gore;
    this.z = 10;
    this.scale.x = -rdScale;
    this.scale.y = -rdScale;
  }
}
class ArmRightLowerSprite extends PIXI.Sprite {
  constructor(a) {
    let b = "armrightlower",
      c = {};
    a.customization &&
      ((c = a.customization[Customization.ARMRIGHTLOWER] || {}),
      c.texture && 0 < c.texture.length && (b += "_" + c.texture));
    super(App.CombinedTextures[b]);
    this.anchor.x = 0.52;
    this.anchor.y = 0.17;
    c.cdata &&
      ((this.x = c.cdata.ox ? c.cdata.ox : 0),
      (this.y = c.cdata.oy ? c.cdata.oy : 0),
      void 0 !== c.cdata.ax &&
        ((this.anchor.x = 0 + c.cdata.ax), (this.anchor.y = 0 + c.cdata.ay)));
    this.decal = App.CombinedTextures.armrightlower_gore;
    this.z = 10;
    this.scale.x = rdScale;
    this.scale.y = -rdScale;
  }
}
class LegLeftUpperSprite extends PIXI.Sprite {
  constructor(a) {
    let b = "legleftupper",
      c = {};
    a.customization &&
      ((c = a.customization[Customization.LEGLEFTUPPER] || {}),
      c.texture && 0 < c.texture.length && (b += "_" + c.texture));
    super(App.CombinedTextures[b]);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    c.cdata &&
      ((this.x = c.cdata.ox ? c.cdata.ox : 0),
      (this.y = c.cdata.oy ? c.cdata.oy : 0),
      void 0 !== c.cdata.ax &&
        ((this.anchor.x = -0.05 + c.cdata.ax), (this.anchor.y = 0.2 + c.cdata.ay)));
    this.decal = App.CombinedTextures.legleftupper_gore;
    this.z = 10;
    this.scale.x = rdScale;
    this.scale.y = -rdScale;
  }
}
class LegLeftLowerSprite extends PIXI.Sprite {
  constructor(a) {
    let b = "legrightlower",
      c = {};
    a.customization &&
      ((c = a.customization[Customization.LEGRIGHTLOWER] || {}),
      c.texture && 0 < c.texture.length && (b += "_" + c.texture));
    super(App.CombinedTextures[b]);
    this.anchor.x = 0.58;
    this.anchor.y = 0.51;
    c.cdata &&
      ((this.x = c.cdata.ox ? c.cdata.ox : 0),
      (this.y = c.cdata.oy ? c.cdata.oy : 0),
      void 0 !== c.cdata.ax &&
        ((this.anchor.x = 0 + c.cdata.ax), (this.anchor.y = 0.15 + c.cdata.ay)));
    this.decal = App.CombinedTextures.legrightlower_gore;
    this.z = 10;
    this.scale.x = rdScale;
    this.scale.y = -rdScale;
  }
}
class LegRightUpperSprite extends PIXI.Sprite {
  constructor(a) {
    let b = "legrightupper",
      c = {};
    a.customization &&
      ((c = a.customization[Customization.LEGRIGHTUPPER] || {}),
      c.texture && 0 < c.texture.length && (b += "_" + c.texture));
    super(App.CombinedTextures[b]);
    this.anchor.x = 0.5;
    this.anchor.y = 0.5;
    c.cdata &&
      ((this.x = c.cdata.ox ? c.cdata.ox : 0),
      (this.y = c.cdata.oy ? c.cdata.oy : 0),
      void 0 !== c.cdata.ax &&
        ((this.anchor.x = -0.05 + c.cdata.ax), (this.anchor.y = 0.2 + c.cdata.ay)));
    this.decal = App.CombinedTextures.legrightupper_gore;
    this.z = 10;
    this.scale.x = rdScale;
    this.scale.y = -rdScale;
  }
}
class LegRightLowerSprite extends PIXI.Sprite {
  constructor(a) {
    let b = "legleftlower",
      c = {};
    a.customization &&
      ((c = a.customization[Customization.LEGLEFTLOWER] || {}),
      c.texture && 0 < c.texture.length && (b += "_" + c.texture));
    super(App.CombinedTextures[b]);
    this.anchor.x = 0.58;
    this.anchor.y = 0.51;
    c.cdata &&
      ((this.x = c.cdata.ox ? c.cdata.ox : 0),
      (this.y = c.cdata.oy ? c.cdata.oy : 0),
      void 0 !== c.cdata.ax &&
        ((this.anchor.x = -0 + c.cdata.ax), (this.anchor.y = 0.15 + c.cdata.ay)));
    this.decal = App.CombinedTextures.legleftlower_gore;
    this.z = 10;
    this.scale.x = rdScale;
    this.scale.y = -rdScale;
  }
}
var itemlist = {},
  ItemList = {
    Fists: "i0",
    Shotgun: "i1",
    SubmachineGun: "i2",
    NadeLauncher: "i3",
    Barrett: "i4",
    ShockRifle: "i5",
    PulseGun: "i6",
    FlameThrower: "i7",
    RPG: "i8",
    Rifle: "i9",
    LaserGun: "i10",
    LinkGun: "i11",
    AK47: "i12",
    HandGrenade: "i20",
    ClusterGrenade: "i21",
    Shuriken: "i23",
    Snowball: "i25",
    Chainsaw: "i30",
    DesertEagle: "i31",
    Minigun: "i32",
    X75: "i33",
    MAC10: "i34",
    Bow: "i35",
    RocketLauncher: "i36",
    Carbine: "i37",
    Bouncyball: "i40",
    HealthBox: "i80",
    NadeBox: "i81",
    ClusterNadeBox: "i82",
    SnowballBox: "i83",
    ShurikenBox: "i84",
    Flag: "i100",
    ShotgunAmmo: "i700",
    RifleAmmo: "i701",
    AK47Ammo: "i702",
    BarrettAmmo: "i703",
    ChainsawAmmo: "i704",
    DesertEagleAmmo: "i705",
    FlameThrowerAmmo: "i706",
    LaserGunAmmo: "i707",
    LinkGunAmmo: "i708",
    MAC10Ammo: "i709",
    MinigunAmmo: "i710",
    NadeLauncherAmmo: "i711",
    PulseGunAmmo: "i712",
    RPGAmmo: "i713",
    ShockRifleAmmo: "i714",
    SMGAmmo: "i715",
    X75Ammo: "i716",
    Gold: "i800",
  },
  ItemMap = { Equip: { PRIMARY: 1, SECONDARY: 2, BELT: 3, OTHER: 4 } };
ItemMap[ItemList.Fists] = {
  title: "Fists",
  onUse: { visual: [], audio: [] },
  equip: ItemMap.Equip.OTHER,
};
ItemMap[ItemList.Rifle] = {
  title: "Rifle",
  onUse: {
    visual: [ParticleEffects.RifleMuzzleFlash, ParticleEffects.RifleCartridge],
    audio: [AudioEffects.RifleFire],
  },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.LaserGun] = {
  title: "Lasergun",
  onUse: {
    visual: [ParticleEffects.LaserGunMuzzleFlash, ParticleEffects.RifleCartridge],
    audio: [AudioEffects.LaserGunShot1],
  },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.Shotgun] = {
  title: "Shotgun",
  onUse: {
    visual: [ParticleEffects.ShotgunMuzzleFlash, ParticleEffects.ShotgunCartridge],
    audio: [AudioEffects.ShotgunFire],
    postUseAudio: [{ audio: AudioEffects.ShotgunPump, delay: 150 }],
  },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.SubmachineGun] = {
  title: "SMG",
  onUse: {
    visual: [ParticleEffects.SMGMuzzleFlash, ParticleEffects.SMGCartridge],
    audio: [AudioEffects.SMGFire],
  },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.PulseGun] = {
  title: "Pulse Gun",
  onUse: {
    visual: [ParticleEffects.PulseGunMuzzleFlash, ParticleEffects.SMGCartridge],
    audio: [AudioEffects.PulseGunShot],
  },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.FlameThrower] = {
  title: "Flamer",
  onUse: { visual: [ParticleEffects.FlameThrowerPilot], audio: [AudioEffects.FlamethrowerFire] },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.NadeLauncher] = {
  title: "M79",
  onUse: {
    visual: [
      ParticleEffects.RifleMuzzleFlash,
      ParticleEffects.NadeLauncherCartridge,
      ParticleEffects.NadeLauncherFireSparks,
    ],
    audio: [AudioEffects.NadeLauncher],
  },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.RocketLauncher] = {
  title: "Avenger",
  onUse: { visual: [ParticleEffects.RifleMuzzleFlash], audio: [AudioEffects.RLRocketFire] },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.Chainsaw] = {
  title: "Chainsaw",
  onUse: {
    visual: [ParticleEffects.ChainsawSmoke, ParticleEffects.ChainsawRaycast],
    audio: [AudioEffects.ChainsawEngaged],
  },
  equip: ItemMap.Equip.SECONDARY,
};
ItemMap[ItemList.DesertEagle] = {
  title: "Deagles",
  onUse: {
    visual: [
      ParticleEffects.RifleMuzzleFlash,
      ParticleEffects.RifleCartridge,
      ParticleEffects.RifleCartridge,
    ],
    audio: [AudioEffects.DeagleFire],
  },
  equip: ItemMap.Equip.SECONDARY,
};
ItemMap[ItemList.Minigun] = {
  title: "Minigun",
  onUse: {
    visual: [
      ParticleEffects.RifleMuzzleFlash,
      ParticleEffects.MinigunCartridge,
      ParticleEffects.MinigunSmoke,
    ],
    audio: [AudioEffects.MinigunEngaged],
  },
  onInitUse: { audio: [AudioEffects.MinigunEngaged] },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.LinkGun] = {
  title: "Link Gun",
  onUse: {
    visual: [ParticleEffects.LinkGunMuzzleFlash, ParticleEffects.LinkGunRaycast],
    audio: [AudioEffects.LinkGunEngaged],
  },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.AK47] = {
  title: "AK-47",
  onUse: {
    visual: [ParticleEffects.RifleMuzzleFlash, ParticleEffects.RifleCartridge],
    audio: [AudioEffects.AK47Fire],
  },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.X75] = {
  title: "X75",
  onUse: {
    visual: [ParticleEffects.X75MuzzleFlash, ParticleEffects.X75Cartridge],
    audio: [AudioEffects.X75Fire],
  },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.MAC10] = {
  title: "MAC-10",
  onUse: {
    visual: [ParticleEffects.MAC10MuzzleFlash, ParticleEffects.MinigunCartridge],
    audio: [AudioEffects.MAC10Fire],
  },
  equip: ItemMap.Equip.SECONDARY,
};
ItemMap[ItemList.Bow] = {
  title: "Bow",
  onUse: { visual: [], audio: [AudioEffects.BowFire] },
  onInitUse: { audio: [] },
  equip: ItemMap.Equip.SECONDARY,
  reloadAudio: null,
};
ItemMap[ItemList.Barrett] = {
  title: "Barrett",
  onUse: {
    visual: [ParticleEffects.RifleMuzzleFlash, ParticleEffects.BarrettCartridge],
    audio: [AudioEffects.BarrettFire],
  },
  equip: ItemMap.Equip.PRIMARY,
  resizeReticle: { min: 1, max: 2 },
};
ItemMap[ItemList.Carbine] = {
  title: "Carbine",
  onUse: {
    visual: [ParticleEffects.RifleMuzzleFlash, ParticleEffects.BarrettCartridge],
    audio: [AudioEffects.CarbineFire],
  },
  equip: ItemMap.Equip.PRIMARY,
  resizeReticle: { min: 1, max: 1.3 },
};
ItemMap[ItemList.ShockRifle] = {
  title: "Shock Rifle",
  onUse: {
    visual: [ParticleEffects.ShockRifleMuzzleFlash, ParticleEffects.ShockRifleCartridge],
    audio: [AudioEffects.ShockrifleFire],
  },
  equip: ItemMap.Equip.PRIMARY,
};
ItemMap[ItemList.Bouncyball] = {
  title: "Ball",
  onUse: { visual: [], audio: [] },
  equip: ItemMap.Equip.SECONDARY,
};
ItemMap[ItemList.HealthBox] = { title: "Healthbox", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.NadeBox] = { title: "Nadebox", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.ClusterNadeBox] = { title: "ClusterNadebox", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.SnowballBox] = { title: "Snowballbox", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.ShurikenBox] = { title: "Shurikenbox", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.Flag] = { title: "Flag", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.RPG] = {
  title: "RPG",
  onUse: {
    visual: [
      ParticleEffects.RPG_MUZZLEBLAST,
      ParticleEffects.RPG_BACKBLAST,
      ParticleEffects.RPGBackBlastSmoke,
    ],
    audio: [AudioEffects.LawLaunch],
  },
  equip: ItemMap.Equip.SECONDARY,
};
ItemMap[ItemList.HandGrenade] = {
  title: "Hand grenade",
  onUse: { visual: [], audio: [] },
  equip: ItemMap.Equip.BELT,
  amount: 2,
};
ItemMap[ItemList.ClusterGrenade] = {
  title: "Cluster grenade",
  onUse: { visual: [], audio: [] },
  equip: ItemMap.Equip.BELT,
  amount: 2,
};
ItemMap[ItemList.Shuriken] = {
  title: "Shuriken",
  onUse: { visual: [], audio: [] },
  equip: ItemMap.Equip.BELT,
  amount: 3,
};
ItemMap[ItemList.Snowball] = {
  title: "Snowball",
  onUse: { visual: [], audio: [] },
  equip: ItemMap.Equip.BELT,
  amount: 5,
};
ItemMap[ItemList.AK47Ammo] = { title: "AK-47 ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.BarrettAmmo] = { title: "Barrett ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.ChainsawAmmo] = { title: "Chainsaw ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.DesertEagleAmmo] = {
  title: "Desert Eagle ammo",
  onUse: { visual: [], audio: [] },
};
ItemMap[ItemList.FlameThrowerAmmo] = { title: "Flamer ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.LaserGunAmmo] = { title: "Lasergun ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.LinkGunAmmo] = { title: "Link Gun ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.MAC10Ammo] = { title: "MAC-10 ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.MinigunAmmo] = { title: "Minigun ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.NadeLauncherAmmo] = {
  title: "Nadelauncher ammo",
  onUse: { visual: [], audio: [] },
};
ItemMap[ItemList.PulseGunAmmo] = { title: "Pulse Gun ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.RifleAmmo] = { title: "Rifle ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.RPGAmmo] = { title: "RPG ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.ShockRifleAmmo] = { title: "Schockrifle ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.ShotgunAmmo] = { title: "Shotgun ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.SMGAmmo] = { title: "SMG ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.X75Ammo] = { title: "X75 ammo", onUse: { visual: [], audio: [] } };
ItemMap[ItemList.Gold] = { title: "Gold", onUse: { visual: [], audio: [] } };
var shurikenicon = {};
class ShurikenIcon extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.shuriken);
    this.anchor.x = this.anchor.y = 0.5;
  }
}
var clustergrenadeicon = {};
class ClusterGrenadeIcon extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.clustergrenade);
    this.anchor.x = this.anchor.y = 0.5;
  }
}
var handgrenadeicon = {};
class HandGrenadeIcon extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.handgrenade);
    this.anchor.x = this.anchor.y = 0.5;
  }
}
var snowballicon = {};
class SnowballIcon extends PIXI.Sprite {
  constructor() {
    super(App.CombinedTextures.snowball);
    this.anchor.x = this.anchor.y = 0.5;
  }
}
class SpriteFactory {}
SpriteFactory.CreateSprite = function (a) {
  let b = new SpriteMap[a.type](a);
  void 0 !== a.scale && ((b.scale.x = a.scale.x), (b.scale.y = a.scale.y));
  void 0 !== a.offset && ((b.anchor.x = a.offset.x), (b.anchor.y = a.offset.y));
  return b;
};
let SpriteMap = {};
SpriteMap.i0 = FistSprite;
SpriteMap[PrefabList.RifleBullet] = RifleBulletSprite;
SpriteMap[PrefabList.AK47Bullet] = AK47BulletSprite;
SpriteMap[PrefabList.DesertEagleBullet] = DesertEagleBulletSprite;
SpriteMap[PrefabList.ShockRifleBullet] = ShockRifleBulletSprite;
SpriteMap[PrefabList.ShotgunPellet] = ShotgunPelletSprite;
SpriteMap[PrefabList.SubmachineGunBullet] = SubmachineGunBulletSprite;
SpriteMap[PrefabList.PulseGunBullet] = PulseGunBulletSprite;
SpriteMap[PrefabList.FlameThrowerLiquid] = FlameThrowerLiquidSprite;
SpriteMap[PrefabList.RPGRocket] = RPGRocketSprite;
SpriteMap[PrefabList.RLRocket] = RLRocketSprite;
SpriteMap[PrefabList.LauncherNade] = LauncherNadeSprite;
SpriteMap[PrefabList.BarrettBullet] = BarrettBulletSprite;
SpriteMap[PrefabList.CarbineBullet] = CarbineBulletSprite;
SpriteMap[PrefabList.GhostLaser] = GhostLaserSprite;
SpriteMap[PrefabList.LaserGunBullet] = LaserGunBulletSprite;
SpriteMap[PrefabList.MinigunBullet] = MinigunBulletSprite;
SpriteMap[PrefabList.X75Nade] = X75NadeSprite;
SpriteMap[PrefabList.MAC10Bullet] = MAC10BulletSprite;
SpriteMap[PrefabList.Nade] = NadeSprite;
SpriteMap[PrefabList.ShurikenBlade] = ShurikenBladeSprite;
SpriteMap[PrefabList.SnowballProjectile] = SnowballProjectileSprite;
SpriteMap[PrefabList.ClusterNade] = ClusterNadeSprite;
SpriteMap[PrefabList.ClusterNadeFragment] = ClusterNadeFragmentSprite;
SpriteMap[PrefabList.TinyShrapnel] = TinyShrapnelSprite;
SpriteMap[PrefabList.GhostBotDebris1] = GhostBotDebrisSprite1;
SpriteMap[PrefabList.GhostBotDebris2] = GhostBotDebrisSprite2;
SpriteMap[PrefabList.GhostBotDebris3] = GhostBotDebrisSprite3;
SpriteMap[PrefabList.Rifle] = RifleSprite;
SpriteMap[PrefabList.AK47] = AK47Sprite;
SpriteMap[PrefabList.DesertEagle] = DesertEagleSprite;
SpriteMap[PrefabList.Shotgun] = ShotgunSprite;
SpriteMap[PrefabList.NadeLauncher] = NadeLauncherSprite;
SpriteMap[PrefabList.RPG] = RPGSprite;
SpriteMap[PrefabList.SubmachineGun] = SubmachineGunSprite;
SpriteMap[PrefabList.LaserGun] = LaserGunSprite;
SpriteMap[PrefabList.PulseGun] = PulseGunSprite;
SpriteMap[PrefabList.Minigun] = MinigunSprite;
SpriteMap[PrefabList.X75] = X75Sprite;
SpriteMap[PrefabList.MAC10] = MAC10Sprite;
SpriteMap[PrefabList.FlameThrower] = FlameThrowerSprite;
SpriteMap[PrefabList.Chainsaw] = ChainsawSprite;
SpriteMap[PrefabList.LinkGun] = LinkGunSprite;
SpriteMap[PrefabList.Barrett] = BarrettSprite;
SpriteMap[PrefabList.Carbine] = CarbineSprite;
SpriteMap[PrefabList.Bow] = BowSprite;
SpriteMap[PrefabList.RocketLauncher] = RocketLauncherSprite;
SpriteMap[PrefabList.ShockRifle] = ShockRifleSprite;
SpriteMap[PrefabList.HealthBox] = HealthBoxSprite;
SpriteMap[PrefabList.NadeBox] = NadeBoxSprite;
SpriteMap[PrefabList.ClusterNadeBox] = ClusterNadeBoxSprite;
SpriteMap[PrefabList.ShurikenBox] = ShurikenBoxSprite;
SpriteMap[PrefabList.SnowballBox] = SnowballBoxSprite;
SpriteMap[PrefabList.Bouncyball] = BallSprite;
SpriteMap[PrefabList.Flag] = FlagSprite;
SpriteMap[ItemList.Shotgun] = ShotgunSprite;
SpriteMap[ItemList.NadeLauncher] = NadeLauncherSprite;
SpriteMap[ItemList.Chainsaw] = ChainsawSprite;
SpriteMap[ItemList.LinkGun] = LinkGunSprite;
SpriteMap[ItemList.SubmachineGun] = SubmachineGunSprite;
SpriteMap[ItemList.LaserGun] = LaserGunSprite;
SpriteMap[ItemList.PulseGun] = PulseGunSprite;
SpriteMap[ItemList.FlameThrower] = FlameThrowerSprite;
SpriteMap[ItemList.Rifle] = RifleSprite;
SpriteMap[ItemList.AK47] = AK47Sprite;
SpriteMap[ItemList.DesertEagle] = DesertEagleSprite;
SpriteMap[ItemList.Barrett] = BarrettSprite;
SpriteMap[ItemList.Carbine] = CarbineSprite;
SpriteMap[ItemList.Bow] = BowSprite;
SpriteMap[ItemList.RocketLauncher] = RocketLauncherSprite;
SpriteMap[ItemList.ShockRifle] = ShockRifleSprite;
SpriteMap[ItemList.RPG] = RPGSprite;
SpriteMap[ItemList.Minigun] = MinigunSprite;
SpriteMap[ItemList.X75] = X75Sprite;
SpriteMap[ItemList.MAC10] = MAC10Sprite;
SpriteMap[ItemList.Shuriken + "_"] = ShurikenIcon;
SpriteMap[ItemList.ClusterGrenade + "_"] = ClusterGrenadeIcon;
SpriteMap[ItemList.HandGrenade + "_"] = HandGrenadeIcon;
SpriteMap[ItemList.Snowball + "_"] = SnowballIcon;
SpriteMap[PrefabList.ShotgunAmmo] = ShotgunAmmoSprite;
SpriteMap[PrefabList.AK47Ammo] = AK47AmmoSprite;
SpriteMap[PrefabList.BarrettAmmo] = BarrettAmmoSprite;
SpriteMap[PrefabList.ChainsawAmmo] = ChainsawAmmoSprite;
SpriteMap[PrefabList.DesertEagleAmmo] = DesertEagleAmmoSprite;
SpriteMap[PrefabList.FlameThrowerAmmo] = FlameThrowerAmmoSprite;
SpriteMap[PrefabList.LaserGunAmmo] = LaserGunAmmoSprite;
SpriteMap[PrefabList.LinkGunAmmo] = LinkGunAmmoSprite;
SpriteMap[PrefabList.MAC10Ammo] = MAC10AmmoSprite;
SpriteMap[PrefabList.MinigunAmmo] = MinigunAmmoSprite;
SpriteMap[PrefabList.NadeLauncherAmmo] = NadeLauncherAmmoSprite;
SpriteMap[PrefabList.PulseGunAmmo] = PulseGunAmmoSprite;
SpriteMap[PrefabList.RifleAmmo] = RifleAmmoSprite;
SpriteMap[PrefabList.RPGAmmo] = RPGAmmoSprite;
SpriteMap[PrefabList.ShockRifleAmmo] = ShockRifleAmmoSprite;
SpriteMap[PrefabList.SMGAmmo] = SMGAmmoSprite;
SpriteMap[PrefabList.X75Ammo] = X75AmmoSprite;
SpriteMap[PrefabList.Arrow] = ArrowSprite;
SpriteMap[PrefabList.Ghost] = GhostSprite;
SpriteMap[ItemList.Bouncyball] = BallSprite;
SpriteMap[ItemList.Flag] = FlagSprite;
SpriteMap[PrefabList.Gold] = GoldSprite;
SpriteMap[Prefabs.LINE_SPRITE] = LineSprite;
SpriteMap[Prefabs.CIRCLE_SPRITE] = CircleSprite;
SpriteMap[Prefabs.RECTANGLE_SPRITE] = RectangleSprite;
SpriteMap[Prefabs.HEAD_SPRITE] = HeadSprite;
SpriteMap[Prefabs.TORSO_UPPER_SPRITE] = TorsoUpperSprite;
SpriteMap[Prefabs.TORSO_LOWER_SPRITE] = TorsoLowerSprite;
SpriteMap[Prefabs.ARM_LEFTUPPER_SPRITE] = ArmLeftUpperSprite;
SpriteMap[Prefabs.ARM_LEFTLOWER_SPRITE] = ArmLeftLowerSprite;
SpriteMap[Prefabs.ARM_RIGHTUPPER_SPRITE] = ArmRightUpperSprite;
SpriteMap[Prefabs.ARM_RIGHTLOWER_SPRITE] = ArmRightLowerSprite;
SpriteMap[Prefabs.LEG_LEFTUPPER_SPRITE] = LegLeftUpperSprite;
SpriteMap[Prefabs.LEG_LEFTLOWER_SPRITE] = LegLeftLowerSprite;
SpriteMap[Prefabs.LEG_RIGHTUPPER_SPRITE] = LegRightUpperSprite;
SpriteMap[Prefabs.LEG_RIGHTLOWER_SPRITE] = LegRightLowerSprite;
var label = {};
class Label extends PIXI.Container {
  constructor(a, b, c, d) {
    super();
    this.id = a;
    this.go = b;
    this.attached = c;
    this.edge = !1;
    this.team = -1;
    this.chatBubble = void 0;
    b.isPlayer &&
      ((b.onRequestDisplayChatBubble = () => this.displayChatBubble()),
      (b.onRequestHideChatBubble = () => this.hideChatBubble()));
    this.marker = null;
    this.tintColor = Team.LabelColors[b.team];
    this.text = new PIXI.BitmapText(d, Label.FontText);
    this.hw = 0.5 * this.text.width + 10;
    this.hh = 0.5 * this.text.height + 10;
    -1 !== b.team && (this.text.tint = this.tintColor);
    this.subText = new PIXI.BitmapText("", Label.FontSubText);
    a = Math.max(Math.floor((b.level / 160) * 10) + 1);
    this.skillTag = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + (16 < a ? 16 : a)]);
    this.skillTag.scale.x = this.skillTag.scale.y = 0.4;
    this.skillTag.x = 0.5 * -this.skillTag.width;
    this.skillTag.y = -85;
    this.skillTag.visible = !1;
    this.addChild(this.skillTag);
    this.text.x = 0.5 * -this.text.width;
    this.text.y = -60;
    this.time = 0;
    if ((this.inClan = -1 !== b.clanId && void 0 !== b.clanId && null !== b.clanId))
      (this.clanTag = new PIXI.BitmapText(b.clanName, Label.FontClanTag)),
        (this.clanTag.alpha = 0.2),
        (this.clanTag.x = 0.5 * -this.clanTag.width),
        (this.clanTag.y = -100),
        (this.clanTag.tint = 10040012),
        this.addChild(this.clanTag);
    b.isLocal
      ? ((this.marker = new PIXI.Sprite(App.CombinedTextures.marker)),
        (this.marker.x = 0),
        (this.marker.y = -40),
        (this.marker.alpha = 0.5),
        (this.marker.scale.x = this.marker.scale.y = 0.5),
        (this.marker.anchor.x = this.marker.anchor.y = 0.5),
        this.addChild(this.marker),
        (this.markerTime = 0))
      : (this.skillTag.alpha = 0.8);
  }
  displayChatBubble() {
    void 0 === this.chatBubble &&
      ((this.chatBubble = new PIXI.Sprite(App.CombinedTextures["chat-ingame"])),
      (this.chatBubble.anchor.x = 0.5),
      (this.chatBubble.anchor.y = 0.5),
      (this.chatBubble.scale.x = this.chatBubble.scale.y = 0.6),
      (this.chatBubble.alpha = 0.6),
      (this.chatBubble.y = -40));
    this.chatBubble.parent ||
      (this.addChild(this.chatBubble),
      (this.chatBubble.scale.x = this.go.facingDir === Player.FACING_RIGHT ? -0.6 : 0.6));
  }
  hideChatBubble() {
    void 0 !== this.chatBubble && this.chatBubble.parent && this.removeChild(this.chatBubble);
  }
  setText(a) {
    this.text.text = a;
    this.hw = 0.5 * this.text.width + 10;
    this.hh = 0.5 * this.text.height + 10;
    this.text.x = 0.5 * -this.text.width;
    this.text.y = -60;
  }
  setSubText(a) {
    this.time = 90 + 5 * a.length;
    this.subText.text = a;
    this.subText.x = 0.5 * -this.subText.width;
    this.subText.y = -80;
    this.subText.alpha = 1;
  }
  showTitle() {
    this.inClan && !this.clanTag.parent && this.addChild(this.clanTag);
    this.text.parent || this.addChild(this.text);
  }
  hideTitle() {
    this.inClan && this.clanTag.parent && this.removeChild(this.clanTag);
    this.text.parent && this.removeChild(this.text);
  }
  showSubTitle() {
    this.subText.parent || this.addChild(this.subText);
  }
  hideSubTitle() {
    this.subText.parent && this.removeChild(this.subText);
  }
  update(a, b, c) {
    this.x = this.attached.p.x + a.x;
    this.y = this.attached.p.y + a.y;
    this.go.isLocal ||
      (this.x - 10 > (App.ClientWidth - this.hw) / a.scale
        ? ((this.x = (App.ClientWidth - this.hw) / a.scale - 10), (this.edge = !0))
        : this.x < this.hw
        ? ((this.x = this.hw), (this.edge = !0))
        : (this.edge = !1),
      this.y - 16 > (App.ClientHeight - this.hh) / a.scale
        ? ((this.y = (App.ClientHeight - this.hh) / a.scale - 16), (this.edge = !0))
        : 60 > this.y && ((this.y = 60), (this.edge = !0)));
    this.edge && -1 !== this.go.team
      ? this.go.team !== this.team
        ? (this.visible = !1)
        : ((this.visible = !0),
          this.showTitle(),
          (this.text.alpha = this.skillTag.alpha = 0.5),
          this.inClan && (this.clanTag.alpha = 0.5),
          this.hideSubTitle(),
          (this.text.tint = this.go.alive ? this.tintColor : 6710886),
          this.inClan && this.clanTag.parent && this.removeChild(this.clanTag))
      : ((this.visible = !0),
        40 > Math.abs(b - this.x) && 50 > Math.abs(c - this.y)
          ? (this.showTitle(),
            (this.text.alpha = this.skillTag.alpha = 0.2),
            this.inClan &&
              ((this.clanTag.alpha = 0.2), this.clanTag.parent || this.addChild(this.clanTag)),
            (this.text.tint = this.go.alive ? this.tintColor : 6710886),
            (this.skillTag.visible = !0))
          : (this.hideTitle(), (this.skillTag.visible = !1)),
        this.marker &&
          ((a = Math.sin(this.markerTime)),
          (this.marker.y = -40 + 5 * a),
          (this.marker.alpha = 0.5 + 0.25 * a),
          (this.markerTime += 0.05)));
    0 < this.time &&
      (this.edge || this.showSubTitle(),
      this.time--,
      20 > this.time && (this.subText.alpha = 1 - 0.05 * (20 - this.time)),
      (0 === this.time || this.edge) && this.hideSubTitle());
  }
}
Label.FontText = { fontName: "Open Sans", fontSize: 22 };
Label.FontSubText = { fontName: "Open Sans", fontSize: 20 };
Label.FontClanTag = { fontName: "Open Sans", fontSize: 22 };
var labelcontainer = {};
class LabelContainer extends PIXI.Container {
  constructor() {
    super();
    this.labels = {};
    this.visibleTeam = -1;
  }
  update(a, b, c) {
    for (let d in this.labels) this.labels[d].update(a, b, c);
  }
  clear() {
    this.labels = {};
    this.children.forEach((a) => a.destroy({ children: !0 }));
    this.removeChildren();
  }
  onUpdateLabel(a) {
    let b = this.labels[a.id];
    void 0 !== a.text && b.setText(a.text);
    void 0 !== a.subText && b.setSubText(a.subText);
  }
  addLabel(a, b, c, d) {
    b = new Label(a, b, c, d.text || "");
    this.labels[a] = b;
    this.addChild(b);
    -1 !== this.visibleTeam && (b.team = this.visibleTeam);
  }
  onRemoveLabel(a) {
    a = a.id;
    let b = this.labels[a];
    b.parent && this.removeChild(b);
    delete this.labels[a];
  }
  setVisibleTeam(a) {
    this.visibleTeam = a;
    for (let b in this.labels) this.labels[b].team = a;
  }
}
var parallax = {};
class Parallax extends PIXI.ParticleContainer {
  constructor() {
    super(160, { position: !0, rotation: !0, batchSize: 160 });
    this.maxParticles = 160;
    this.minParticles = 20;
    this.count = 0;
    this.particles = [];
    this.intensity = 1;
    this.margin = 100;
    this._facedirection = this.rotate = !1;
    this._rotation = 0;
    this._drop = { min: 1, max: 2 };
    this._scale = { min: 1, max: 1 };
    this._alpha = { min: 1, max: 1 };
    this._direction = { min: -0.2, max: 0.2 };
    this._angular = { min: -0.05, max: 0.05 };
    this._dirOffset = { min: -5, max: 5 };
    this.lastY = this.lastX = this._dir = 0;
    this.type = "rain";
  }
  clear() {
    this.particles = [];
    this.children.forEach((a) => a.destroy({ children: !0 }));
    this.removeChildren();
  }
  initialize(a) {
    this.type = a.precipitation.type;
    this.rotate = !1;
    this._drop = { min: 1, max: 2 };
    this._scale = { min: 1, max: 1 };
    this._alpha = { min: 1, max: 1 };
    this._direction = { min: -0.2, max: 0.2 };
    this._offset = { min: -0.2, max: 0.2 };
    this._dir = this._rotation = 0;
    this.children.forEach((c) => c.destroy({ children: !0 }));
    this.removeChildren();
    switch (this.type) {
      case "dust":
        var b = App.CombinedTextures.precip_dust;
        this.rotate = !0;
        this._drop.min = 0.05;
        this._drop.max = 0.1;
        this._scale.min = 2.1;
        this._scale.max = 3.3;
        this._alpha.min = 0.01;
        this._alpha.max = 0.05;
        this._direction.min = -0.1;
        this._direction.max = 0.1;
        this._angular = { min: -0.01, max: 0.01 };
        this._dir = 0;
        this._dirOffset =
          this._dirOffset.min + (this._dirOffset.max - this._dirOffset.min) * Math.random();
        break;
      case "rain":
        b = App.CombinedTextures.precip_rain;
        this.rotate = !1;
        this._drop.min = 5;
        this._drop.max = 8;
        this._scale.min = 0.3;
        this._scale.max = 1;
        this._alpha.min = 0.1;
        this._alpha.max = 0.3;
        this._direction.min = -0.3;
        this._direction.max = 0.3;
        this._dirOffset = { min: -5, max: 5 };
        this._dir =
          this._dirOffset.min + (this._dirOffset.max - this._dirOffset.min) * Math.random();
        this._facedirection = !0;
        break;
      case "snow":
        b = App.CombinedTextures.precip_snow;
        this.rotate = !0;
        this._drop.min = 1.5;
        this._drop.max = 4;
        this._scale.min = 0.1;
        this._scale.max = 0.3;
        this._alpha.min = 0.1;
        this._alpha.max = 0.3;
        this._direction.min = -0.4;
        this._direction.max = 0.8;
        this._angular.min = -0.2;
        this._angular.min = 0.2;
        this._dir = 0;
        this._dirOffset =
          this._dirOffset.min + (this._dirOffset.max - this._dirOffset.min) * Math.random();
        break;
      case "stars":
        b = App.CombinedTextures.precip_star;
        this._drop.min = 0;
        this._drop.max = 0;
        this._scale.min = 0.9;
        this._scale.max = 2.5;
        this._direction.min = -1e-7;
        this._direction.max = -5e-7;
        this._angular.min = -0.02;
        this._angular.min = 0.02;
        this.rotate = !0;
        this._dir = 0;
        this._dirOffset =
          this._dirOffset.min + (this._dirOffset.max - this._dirOffset.min) * Math.random();
        break;
      case "matrix":
        break;
      default:
        this.count = 0;
        return;
    }
    this.count = Math.round(a.precipitation.intensity * this.maxParticles);
    this.count > this.maxParticles
      ? (this.count = this.maxParticles)
      : this.count < this.minParticles && (this.count = this.minParticles);
    for (let c = 0, d = this.count; c < d; c++)
      (a = new PIXI.Sprite(b)),
        (a.x = -this.margin + Math.random() * (App.ClientWidth + 2 * this.margin)),
        (a.y = -this.margin + Math.random() * (App.ClientHeight + 2 * this.margin)),
        (a.alpha = this._alpha.min + (this._alpha.max - this._alpha.min) * Math.random()),
        (a.speed = this._drop.min + (this._drop.max - this._drop.min) * Math.random()),
        (a.scale.x = a.scale.y =
          this._scale.min + (this._scale.max - this._scale.min) * Math.random()),
        (a.direction =
          this._direction.min + (this._direction.max - this._direction.min) * Math.random()),
        this.rotate
          ? ((a.rotation = Math.random() * Math.PI * 2),
            (a.anchor.x = a.anchor.y = 0.5),
            (a.angular =
              this._angular.min + (this._angular.max - this._angular.min) * Math.random()))
          : (a.rotation = this._facedirection
              ? Math.atan2(-a.direction - this._dir, a.speed)
              : this._rotation),
        this.addChild(a);
  }
  distribute() {
    for (let a = 0, b = this.children.length; a < b; a++) {
      let c = this.children[a];
      c.x = -this.margin + Math.random() * (App.ClientWidth + 2 * this.margin);
      c.y = -this.margin + Math.random() * (App.ClientHeight + 2 * this.margin);
    }
  }
  update(a) {
    let b = a.x - this.lastX,
      c = a.y - this.lastY;
    "stars" === this.type && ((b *= 0.2), (c *= 0.2));
    this.lastX = a.x;
    this.lastY = a.y;
    a = this.children.length;
    let d = App.ClientWidth + 2 * this.margin,
      e = App.ClientHeight + 2 * this.margin;
    for (; 0 < a--; ) {
      let f = this.children[a];
      f.x += (f.direction + this._dir) * f.scale.x * 3 + 0.5 * b;
      f.y += f.speed * f.scale.x * 3 + 0.5 * c;
      this.rotate && (f.rotation += f.angular);
      f.y > App.ClientHeight + this.margin
        ? (f.y -= e)
        : f.y < -this.margin
        ? (f.y += e)
        : f.x < -this.margin
        ? (f.x += d)
        : f.x > App.ClientWidth + this.margin && (f.x -= d);
    }
  }
}
var Customization = {
  HAIR: "hair",
  ENERGY: "energy",
  TORSO: "torso",
  FACE: "face",
  BELT: "belt",
  ARMLEFTLOWER: "armleftlower",
  ARMLEFTUPPER: "armleftupper",
  ARMRIGHTLOWER: "armrightlower",
  ARMRIGHTUPPER: "armrightupper",
  LEGLEFTLOWER: "legleftlower",
  LEGLEFTUPPER: "legleftupper",
  LEGRIGHTLOWER: "legrightlower",
  LEGRIGHTUPPER: "legrightupper",
};
const GameCommands = {
  CLEAR: "clear",
  MESSAGE: "say",
  SHUTDOWN: "shutdown",
  LOAD: "load",
  SPAWN: "spawn",
  PAUSE: "pause",
  SPECTATE: "spec",
  JOIN: "join",
  PREFERENCE: "pref",
  KILL: "kill",
  EXPLODE: "explode",
  LOGIN: "login",
  CLIENTS: "clients",
  COMMANDS: "commands",
  KICK: "kick",
  BAN: "ban",
  DANCE: "dance",
  BALANCE: "balance",
  PARAMS: "params",
  MEMSTATS: "memstats",
  WAVE: "wave",
  SALUTE: "salute",
  BUSY: "busy",
  DONE: "done",
  LOG_PERF: "logperf",
  SPAWN_BOT: "spawnbot",
};
function GameStatus(a, b) {
  this.t = a;
  this.s = b;
}
GameStatus.Player = { JOIN: 0, LEAVE: 1, SPEC: 2, LIST: 3 };
GameStatus.Game = { RUNNING: 20, PAUSED: 21, GAMEOVER: 22, COUNTDOWN: 23, LEADER: 24, TEAM: 25 };
GameStatus.Settings = { WORLD: 40 };
class ActionTable extends PIXI.Container {
  constructor() {
    super();
    this.tableWidth = 420;
    this.tableHeight = 200;
    this.maxChars = 50;
    for (this.spaceStr = ""; this.spaceStr.length < this.maxChars; ) this.spaceStr += " ";
    this.maxLines = 7;
    this.textFields = [];
    this.icons = [];
    this.bravoFlagCount = this.alphaFlagCount = null;
  }
  register(a, b) {
    this.addRow(a, b || null);
  }
  setMode(a) {
    switch (a) {
      case Game.MODE_CTF:
        this.displayCTFUI();
        break;
      case Game.MODE_DM:
        this.displayDMUI();
        break;
      case Game.MODE_TDM:
        this.displayTDMUI();
        break;
      case Game.MODE_DB:
        this.displayDBUI();
    }
  }
  displayCTFUI() {
    var a = new PIXI.Sprite(App.CombinedTextures.flag_alpha);
    a.x = this.tableWidth - 80;
    a.y = 300;
    a.scale.x = a.scale.y = 0.4;
    a.alpha = 0.6;
    this.addChild(a);
    this.alphaFlagCount = new PIXI.Text("0", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16711680,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaFlagCount.x = a.x + a.width + 8;
    this.alphaFlagCount.y = a.y + 5;
    this.alphaFlagCount.alpha = 0.7;
    this.addChild(this.alphaFlagCount);
    a = new PIXI.Sprite(App.CombinedTextures.flag_bravo);
    a.x = this.tableWidth - 80;
    a.y = 350;
    a.scale.x = a.scale.y = 0.4;
    a.alpha = 0.6;
    this.addChild(a);
    this.bravoFlagCount = new PIXI.Text("0", {
      fontName: "Arial",
      fontSize: 22,
      fill: 255,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoFlagCount.x = a.x + a.width + 8;
    this.bravoFlagCount.y = a.y + 5;
    this.bravoFlagCount.alpha = 0.7;
    this.addChild(this.bravoFlagCount);
  }
  updateFlagScore(a) {
    this.alphaFlagCount.text = a.alphaPoints;
    this.bravoFlagCount.text = a.bravoPoints;
  }
  updateTDMScore(a) {
    this.alphaFlagCount.text = a.alphaPoints;
    this.bravoFlagCount.text = a.bravoPoints;
  }
  updateDBScore(a) {
    this.alphaFlagCount.text = a.alphaPoints;
    this.bravoFlagCount.text = a.bravoPoints;
  }
  updateTRScore(a) {}
  displayDMUI() {
    for (var a = 0; 5 > a; a++) {
      this["p" + (a + 1)] = new PIXI.BitmapText(a + 1 + ". empty", {
        fontName: "Open Sans",
        fontSize: 25,
      });
      var b = this["p" + (a + 1)];
      b.tint = 11184810;
      b.alpha = 0.9;
      b.x = 240;
      b.y = 160 + 25 * a;
      this.addChild(b);
      this["ps" + (a + 1)] = new PIXI.BitmapText("", { fontName: "Open Sans", fontSize: 25 });
      b = this["ps" + (a + 1)];
      b.tint = 11184810;
      b.alpha = 0.9;
      b.x = 400;
      b.y = 160 + 25 * a;
      this.addChild(b);
    }
    this.pLocal = new PIXI.BitmapText("..", { fontName: "Open Sans", fontSize: 25 });
    this.pLocal.tint = 8765929;
    this.pLocal.x = 240;
    this.pLocal.y = 295;
    this.addChild(this.pLocal);
  }
  displayTDMUI() {
    var a = new PIXI.Sprite(App.CombinedTextures.tdm_alpha);
    a.x = this.tableWidth - 80;
    a.y = 300;
    a.scale.x = a.scale.y = 0.35;
    a.alpha = 0.6;
    this.addChild(a);
    this.alphaFlagCount = new PIXI.Text("0", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16711680,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaFlagCount.x = a.x + a.width + 8;
    this.alphaFlagCount.y = a.y + 7;
    this.alphaFlagCount.alpha = 0.7;
    this.addChild(this.alphaFlagCount);
    a = new PIXI.Sprite(App.CombinedTextures.tdm_bravo);
    a.x = this.tableWidth - 80;
    a.y = 350;
    a.scale.x = a.scale.y = 0.35;
    a.alpha = 0.6;
    this.addChild(a);
    this.bravoFlagCount = new PIXI.Text("0", {
      fontName: "Arial",
      fontSize: 22,
      fill: 255,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoFlagCount.x = a.x + a.width + 8;
    this.bravoFlagCount.y = a.y + 7;
    this.bravoFlagCount.alpha = 0.7;
    this.addChild(this.bravoFlagCount);
  }
  displayDBUI() {
    var a = new PIXI.Sprite(App.CombinedTextures.db_alpha);
    a.x = this.tableWidth - 80;
    a.y = 300;
    a.scale.x = a.scale.y = 0.35;
    a.alpha = 0.6;
    this.addChild(a);
    this.alphaFlagCount = new PIXI.Text("0", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16711680,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaFlagCount.x = a.x + a.width + 8;
    this.alphaFlagCount.y = a.y + 7;
    this.alphaFlagCount.alpha = 0.7;
    this.addChild(this.alphaFlagCount);
    a = new PIXI.Sprite(App.CombinedTextures.db_bravo);
    a.x = this.tableWidth - 80;
    a.y = 350;
    a.scale.x = a.scale.y = 0.35;
    a.alpha = 0.6;
    this.addChild(a);
    this.bravoFlagCount = new PIXI.Text("0", {
      fontName: "Arial",
      fontSize: 22,
      fill: 255,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoFlagCount.x = a.x + a.width + 8;
    this.bravoFlagCount.y = a.y + 7;
    this.bravoFlagCount.alpha = 0.7;
    this.addChild(this.bravoFlagCount);
  }
  updateTopListing(a) {
    for (var b = 0; 5 > b; b++) {
      var c = this["p" + (b + 1)],
        d = this["ps" + (b + 1)];
      b < a.top.length
        ? ((c.text = b + 1 + ". " + a.top[b].name.substring(0, 12) + ".. "),
          (c.tint = a.top[b].color),
          (d.text = a.top[b].kills),
          (d.tint = a.top[b].color))
        : ((c.text = b + 1 + " empty"), (c.tint = 11184810), (d.text = ""), (d.tint = 11184810));
    }
    a.local &&
      ((this.pLocal.visible = 5 > a.local.index ? !1 : !0),
      (this.pLocal.text = a.local.index + 1 + ". You       .. " + a.local.kills));
  }
  addRow(a, b) {
    var c = this.spaceStr.substring(0, this.maxChars - a.length) + a;
    a = this.textFields.length;
    this.icons.push(b);
    c = new PIXI.BitmapText(c, ActionTable.FontRow);
    c.anchor.x = 1;
    c.x = this.tableWidth - 58;
    c.y = 5 + 21 * a;
    c.alpha = 0.6;
    this.addChild(c);
    this.textFields.push(c);
    b &&
      ((b.x = this.tableWidth - 34),
      (b.y = 16 + 21 * a),
      (b.scale.x = b.scale.y = 0.225),
      (b.rotation = 1.9 * Math.PI),
      this.addChild(b));
    if (a === this.maxLines) {
      this.removeChild(this.textFields.splice(0, 1)[0]);
      b = this.icons[0];
      this.icons.splice(0, 1);
      b && this.removeChild(b);
      for (b = 0; b < this.textFields.length; b++) this.textFields[b].y -= 21;
      for (b = 0; b < this.icons.length; b++) null !== this.icons[b] && (this.icons[b].y -= 21);
    }
  }
  getWidth() {
    return this.tableWidth;
  }
  getHeight() {
    return this.tableHeight;
  }
}
ActionTable.FontRow = { fontName: "Open Sans", fontSize: 21 };
class AmmoBar extends PIXI.Container {
  constructor() {
    super();
    EventDispatcher.call(this);
    this.barWidth = 348;
    this.barHeight = 36;
    this.value = this.maxValue = AmmoBar.MAX_VALUE;
    this.itemTitle = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 38,
      align: "center",
    });
    this.itemTitle.x = 3;
    this.itemTitle.y = -34;
    this.addChild(this.itemTitle);
    this.ammoCount = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 38,
      align: "center",
    });
    this.ammoCount.x = 240;
    this.ammoCount.y = 0;
    this.addChild(this.ammoCount);
    this.ammoIcon = new PIXI.Sprite(App.CombinedTextures.ammo_icon);
    this.ammoIcon.x = 6;
    this.ammoIcon.y = 2;
    this.addChild(this.ammoIcon);
    this.beltItemTitle = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 38,
      align: "center",
    });
    this.beltItemTitle.x = 366;
    this.beltItemTitle.y = -34;
    this.addChild(this.beltItemTitle);
    this.beltAmmoCount = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 38,
      align: "center",
    });
    this.beltAmmoCount.x = 385;
    this.beltAmmoCount.y = 1;
    this.beltAmmoCount.text = "Empty";
    this.addChild(this.beltAmmoCount);
    this.beltItemTitle.visible = !1;
    this.beltAmmoAmount = 0;
    this.beltIcon = null;
    this.background = new PIXI.Graphics();
    this.background.beginFill(3355443, 0.1);
    this.background.drawRect(0, 0, this.barWidth, this.barHeight);
    this.background.drawRect(this.barWidth + 24, 0, 100, this.barHeight);
    this.background.endFill();
    this.bar = new PIXI.Container();
    this.addChild(this.background);
    this.addChild(this.bar);
    this.numElements = 10;
    this.elements = [];
    for (var a = 0; a < this.numElements; a++) {
      var b = new PIXI.Sprite(App.CombinedTextures.ammo_bar_element);
      b.x = 42 + 20 * a;
      b.y = 2;
      this.elements.push(b);
      this.bar.addChild(b);
    }
    this.margin = 4;
  }
  setValue(a) {
    this.value = a;
    this.update();
    0 >= this.value
      ? ((this.ammoCount.tint = 16724736), (this.ammoCount.text = "reload.."))
      : (this.value > 0.35 * this.maxValue
          ? (this.ammoCount.tint = 16777215)
          : this.value <= 0.35 * this.maxValue && (this.ammoCount.tint = 16755200),
        (this.ammoCount.text = "x" + this.value));
    this.ammoCount.x = 298 - 0.5 * this.ammoCount.width;
  }
  getValue() {
    return this.value;
  }
  setMaxValue(a) {
    this.maxValue = a;
    this.setValue(this.maxValue);
  }
  subtract() {
    this.setValue(this.getValue() - 1);
  }
  update() {
    for (
      var a = Math.ceil((this.numElements / this.maxValue) * this.value), b = 0;
      b < this.numElements;
      b++
    )
      this.elements[b].alpha = b < a ? 1 : 0.2;
  }
  setItem(a) {
    a
      ? (this.itemTitle.text = ItemMap[a.t].title)
      : ((this.itemTitle.text = "Fists"),
        (this.ammoCount.tint = 16777215),
        (this.ammoCount.text = ""),
        (this.value = 0),
        this.update());
  }
  setBeltItem(a) {
    this.beltIcon && (this.removeChild(this.beltIcon), (this.beltIcon = null));
    a
      ? ((this.beltIcon = new SpriteMap[a.t.substring(1)]()),
        (this.beltIcon.x = this.beltItemTitle.x + 18),
        (this.beltIcon.y = this.beltItemTitle.y + 50),
        (this.beltIcon.width = 0.35),
        (this.beltIcon.height = 0.35),
        this.addChild(this.beltIcon),
        (this.beltItemTitle.text = ItemMap[a.t].title),
        (this.beltAmmoCount.text = "x" + ItemMap[a.t].amount),
        (this.beltAmmoCount.x = 420),
        (this.beltAmmoAmount = parseInt(ItemMap[a.t].amount)),
        (this.beltItemTitle.visible = !0))
      : ((this.beltItemTitle.text = ""),
        (this.beltAmmoCount.text = "Empty"),
        (this.itemTitle.text = ""));
  }
  decrementBeltValue(a) {
    this.beltAmmoAmount--;
    0 >= this.beltAmmoAmount
      ? ((this.beltItemTitle.visible = !1),
        (this.beltAmmoCount.text = "Empty"),
        this.beltIcon && (this.beltIcon.visible = !1),
        (this.beltAmmoCount.x = 395))
      : (this.beltAmmoCount.text = "x" + this.beltAmmoAmount.toString());
  }
  getWidth() {
    return this.barWidth;
  }
  getHeight() {
    return this.barHeight;
  }
}
AmmoBar.MAX_VALUE = 100;
var escapemenu = {};
class EscapeMenu extends PIXI.Graphics {
  constructor() {
    super();
    this.mute = Registry.Instance[Registry.Key.SETTINGS].sound.enabled
      ? EscapeMenu.MUTE_NO
      : EscapeMenu.MUTE_YES;
    this.interactive = !0;
    this.lineStyle(3, 3355443, 1, 2);
    this.beginFill(3355443, 0.9);
    this.drawRect(0, 0, 360, 324);
    this.endFill();
    this.lineStyle(1, 16777215, 0.1, 0);
    this.beginFill(0, 0.3);
    this.drawRect(10, 10, 340, 304);
    this.endFill();
    this.drawRect(15, 42, 330, 2);
    this.closeButton = new PIXI.Sprite(App.CombinedTextures.exit);
    this.closeButton.x = this.width - 48;
    this.closeButton.y = 4;
    this.closeButton.interactive = !0;
    this.closeButton.on("mouseover", () => AudioEffects.ButtonHover.audio.play());
    this.closeButton.on("mousedown", () => {
      AudioEffects.ButtonClick.audio.play();
      this.emit(EscapeMenu.CLOSE);
    });
    this.closeButton.on("touchstart", () => {
      AudioEffects.ButtonClick.audio.play();
      this.emit(EscapeMenu.CLOSE);
    });
    this.addChild(this.closeButton);
    this.title = new PIXI.Text("Menu (ESC)", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.title.resolution = 1.5 * App.DevicePixelRatio;
    this.title.x = 0.5 * (this.width - this.title.width);
    this.title.y = 16;
    this.addChild(this.title);
    this.muteButton = new EscapeMenuButton(
      this.mute === EscapeMenu.MUTE_YES ? EscapeMenu.MUTE_NO : EscapeMenu.MUTE_YES,
      16777215,
      this.mute === EscapeMenu.MUTE_YES ? "mute_icon" : "unmute_icon"
    );
    this.muteButton.x = 0.5 * (this.width - this.muteButton.width);
    this.muteButton.y = 60;
    this.muteButton.on("mousedown", () => this.onMute());
    this.muteButton.on("touchstart", () => this.onMute());
    this.addChild(this.muteButton);
    this.controlsButton = new EscapeMenuButton("Controls (H)", 16777215);
    this.controlsButton.x = 0.5 * (this.width - this.controlsButton.width);
    this.controlsButton.y = 120;
    this.controlsButton.on("mousedown", () => this.emit(EscapeMenu.CONTROLS));
    this.controlsButton.on("touchstart", () => this.emit(EscapeMenu.CONTROLS));
    this.addChild(this.controlsButton);
    this.weaponMenuButton = new EscapeMenuButton("Weapons (G)", 16777215);
    this.weaponMenuButton.x = 0.5 * (this.width - this.weaponMenuButton.width);
    this.weaponMenuButton.y = 180;
    this.weaponMenuButton.on("mousedown", () => this.emit(EscapeMenu.WEAPONS));
    this.weaponMenuButton.on("touchstart", () => this.emit(EscapeMenu.WEAPONS));
    this.addChild(this.weaponMenuButton);
    this.escapeButton = new EscapeMenuButton("Leave / Exit", 16711680);
    this.escapeButton.x = 0.5 * (this.width - this.escapeButton.width);
    this.escapeButton.y = 250;
    this.escapeButton.on("mousedown", () => this.emit(EscapeMenu.EXIT));
    this.escapeButton.on("touchstart", () => this.emit(EscapeMenu.EXIT));
    this.addChild(this.escapeButton);
  }
  onMute() {
    this.mute = this.mute === EscapeMenu.MUTE_NO ? EscapeMenu.MUTE_YES : EscapeMenu.MUTE_NO;
    this.muteButton.setTitle(
      this.mute === EscapeMenu.MUTE_YES ? EscapeMenu.MUTE_NO : EscapeMenu.MUTE_YES
    );
    this.muteButton.setIcon(this.mute === EscapeMenu.MUTE_YES ? "mute_icon" : "unmute_icon");
    this.emit(EscapeMenu.MUTE, this.mute === EscapeMenu.MUTE_YES);
  }
  setMuted(a) {
    this.mute = a ? EscapeMenu.MUTE_YES : EscapeMenu.MUTE_NO;
    this.muteButton.setTitle(
      this.mute === EscapeMenu.MUTE_YES ? EscapeMenu.MUTE_NO : EscapeMenu.MUTE_YES
    );
    this.muteButton.setIcon(this.mute === EscapeMenu.MUTE_YES ? "mute_icon" : "unmute_icon");
  }
}
EscapeMenu.CLOSE = "close";
EscapeMenu.MUTE = "mute";
EscapeMenu.CONTROLS = "controls";
EscapeMenu.SETTINGS = "settings";
EscapeMenu.WEAPONS = "weapons";
EscapeMenu.EXIT = "exit";
EscapeMenu.MUTE_NO = "Sound OFF";
EscapeMenu.MUTE_YES = "Sound ON";
class EscapeMenuButton extends PIXI.Graphics {
  constructor(a, b = 16777215, c = null) {
    super();
    this.beginFill(16777215, 0.2);
    this.drawRect(0, 0, 180, 30);
    this.endFill();
    this.interactive = !0;
    this.title = new PIXI.Text(a, {
      fontName: "Arial",
      fontSize: 20,
      fill: b,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.title.resolution = 1.5 * App.DevicePixelRatio;
    this.title.x = 0.5 * (this.width - this.title.width);
    this.title.y = 0.5 * (this.height - this.title.height) + 1;
    this.addChild(this.title);
    this.tint = 10066329;
    c &&
      ((this.icon = new PIXI.Sprite(App.CombinedTextures[c])),
      (this.icon.x = this.title.x + this.title.width + 4),
      this.addChild(this.icon));
    this.on("mouseover", () => this.onMouseOver());
    this.on("mouseout", () => this.onMouseOut());
    this.on("mousedown", () => this.onMouseDown());
  }
  setTitle(a) {
    this.title.text = a;
    this.title.x = 0.5 * (this.width - this.title.width);
    this.icon && (this.icon.x = this.title.x + this.title.width + 4);
  }
  onMouseOver() {
    this.tint = 16777215;
    AudioEffects.ButtonHover.audio.play();
  }
  onMouseOut() {
    this.tint = 10066329;
  }
  onMouseDown() {
    AudioEffects.ButtonClick.audio.play();
  }
  setIcon(a) {
    this.icon.texture = App.CombinedTextures[a];
  }
}
class GameoverDisplay extends PIXI.Container {
  constructor() {
    super();
    EventDispatcher.call(this);
    this._width = App.ClientWidth;
    this._height = 100;
    this.gameoverTitle = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 40,
      fill: "#FFD700",
      align: "center",
      dropShadow: !0,
      dropShadowColor: "#000000",
      dropShadowDistance: 2,
      dropShadowAngle: 0.25 * Math.PI,
    });
    this.addChild(this.gameoverTitle);
    this.countdownClock = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 40,
      fill: "#DDDDDD",
      align: "center",
      dropShadow: !0,
      dropShadowColor: "#000000",
      dropShadowDistance: 2,
      dropShadowAngle: 0.25 * Math.PI,
    });
    this.addChild(this.countdownClock);
  }
  setContent(a) {
    this.gameoverTitle.text = a.msg;
    this.gameoverTitle.tint = 16766720;
    this.gameoverTitle.x = 0.5 * (this._width - this.gameoverTitle.width);
    this.gameoverTitle.y = -30;
    this.countdownClock.y = 10;
    this.count = a.countdown;
    a.completed ? this.hideClock() : this.showClock();
  }
  updateCountdown(a) {
    this.count--;
    this.countdownClock.text = "New game starting in .. " + a;
    this.countdownClock.x = 0.5 * (this._width - this.countdownClock.width);
  }
  getWidth() {
    return this._width;
  }
  getHeight() {
    return this._height;
  }
  showClock() {
    this.countdownClock.visible = !0;
  }
  hideClock() {
    this.countdownClock.visible = !1;
  }
}
var goldcount = {};
class GoldCount extends PIXI.Container {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.beginFill(3355443, 0.1);
    this.background.drawRect(0, 0, 116, 36);
    this.background.endFill();
    this.addChild(this.background);
    this.goldIcon = new PIXI.Sprite(App.CombinedTextures.gold1);
    this.goldIcon.x = 6;
    this.goldIcon.y = -1;
    this.goldIcon.scale.x = this.goldIcon.scale.y = 0.65;
    this.addChild(this.goldIcon);
    this.goldText = new PIXI.BitmapText("0", { fontName: "Open Sans", fontSize: 38 });
    this.goldText.x = this.goldIcon.x + this.goldIcon.width + 10;
    this.goldText.y = this.goldIcon.y + 2;
    this.addChild(this.goldText);
    this.gold = 0;
  }
  increment(a) {
    this.gold += a;
    this.goldText.text = this.gold.toString();
  }
  setValue(a) {
    this.gold = a;
    this.goldText.text = this.gold.toString();
  }
}
class HealthBar extends PIXI.Container {
  constructor() {
    super();
    EventDispatcher.call(this);
    this.barWidth = 262;
    this.barHeight = 36;
    this.value = 100;
    this.healthIcon = new PIXI.Sprite(App.CombinedTextures.health_icon);
    this.healthIcon.x = 6;
    this.healthIcon.y = 2;
    this.addChild(this.healthIcon);
    this.maxValue = HealthBar.MAX_VALUE;
    this.background = new PIXI.Graphics();
    this.background.beginFill(3355443, 0.1);
    this.background.drawRect(0, 0, this.barWidth, this.barHeight);
    this.background.endFill();
    this.bar = new PIXI.Container();
    this.addChild(this.background);
    this.addChild(this.bar);
    this.numElements = 10;
    this.elements = [];
    for (var a = 0; a < this.numElements; a++) {
      var b = new PIXI.Sprite(App.CombinedTextures.health_bar_element);
      b.x = 42 + 20 * a;
      b.y = 2;
      this.elements.push(b);
      this.bar.addChild(b);
    }
    this.margin = 4;
  }
  setValue(a) {
    this.value = a;
    this.update();
  }
  getValue() {
    return this.value;
  }
  update() {
    let a = Math.ceil((this.numElements / this.maxValue) * this.value);
    for (let b = 0; b < this.numElements; b++) this.elements[b].alpha = b < a ? 1 : 0.2;
  }
  getWidth() {
    return this.barWidth;
  }
  getHeight() {
    return this.barHeight;
  }
}
HealthBar.MAX_VALUE = 100;
var playerdropdown = {};
class PlayerDropdown extends PIXI.Container {
  constructor() {
    super();
    this.target = null;
    this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 0.9);
    this.background.drawRoundedRect(0, 0, 210, 72, 4);
    this.background.endFill();
    this.muteRow = new PlayerDropdownActionRow("Mute", PlayerDropdown.Action.MUTE, 15597568);
    this.unmuteRow = new PlayerDropdownActionRow("Unmute", PlayerDropdown.Action.UNMUTE, 15597568);
    this.inviteRow = new PlayerDropdownActionRow(
      "Send friend invitation",
      PlayerDropdown.Action.INVITE,
      16763904
    );
    this.inviteRow.on("mousedown", () => this.onInvite());
    this.muteRow.on("mousedown", () => this.onMute());
    this.unmuteRow.on("mousedown", () => this.onUnmute());
    this.inviteRow.on("touchstart", () => this.onInvite());
    this.muteRow.on("touchstart", () => this.onMute());
    this.unmuteRow.on("touchstart", () => this.onUnmute());
    this.on("mouseout", () => {
      this.parent && this.parent.removeChild(this);
    });
    this.muteRow.x = 10;
    this.unmuteRow.x = 10;
    this.inviteRow.x = 10;
    this.muteRow.y = 7;
    this.unmuteRow.y = 7;
    this.inviteRow.y = 43;
    this.unmuteRow.visible = !1;
    this.addChild(this.background);
    this.addChild(this.muteRow);
    this.addChild(this.unmuteRow);
    this.addChild(this.inviteRow);
  }
  async onInvite() {
    this.parent && this.parent.removeChild(this);
    let a = await APIClient.postInviteFriend(this.target.name, App.Credential.id);
    a.success
      ? App.Console.log("Friend invitation sent to " + this.target.name)
      : App.Console.log(a.error);
  }
  onMute() {
    -1 === Game.Muted.indexOf(this.target.sid) &&
      (Game.Muted.push(this.target.sid),
      (this.muteRow.visible = !1),
      (this.unmuteRow.visible = !0));
  }
  onUnmute() {
    -1 !== Game.Muted.indexOf(this.target.sid) &&
      (Game.Muted.splice(Game.Muted.indexOf(this.target.sid), 1),
      (this.muteRow.visible = !0),
      (this.unmuteRow.visible = !1));
  }
  show() {
    -1 !== Game.Muted.indexOf(this.target.sid)
      ? ((this.muteRow.visible = !1), (this.unmuteRow.visible = !0))
      : ((this.muteRow.visible = !0), (this.unmuteRow.visible = !1));
  }
}
PlayerDropdown.Action = { MUTE: "mute", UNMUTE: "unmute", INVITE: "invite" };
class PlayerDropdownActionRow extends PIXI.Container {
  constructor(a, b, c) {
    super();
    this.actionText = new PIXI.Text(a, {
      fontName: "Arial",
      fontSize: 18,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.interactive = !0;
    this.hitArea = new PIXI.Rectangle(0, 0, 200, 30);
    this.actionText.tint = c;
    this.actionText.alpha = 0.7;
    this.on("mouseover", () => {
      this.actionText.alpha = 1;
    });
    this.on("mouseout", () => {
      this.actionText.alpha = 0.7;
    });
    this.addChild(this.actionText);
  }
}
var dm_leaderboard = {};
class LeaderboardDM extends PIXI.Container {
  constructor() {
    super();
    EventDispatcher.call(this);
    this._width = App.ClientWidth - 400;
    this._height = 560;
    this.invalidated = !0;
    this.dropdown = new PlayerDropdown();
    this.background = new PIXI.Graphics();
    this.background.lineStyle(3, 3355443, 1, 2);
    this.background.beginFill(0, 0.3);
    this.background.drawRect(0, 0, 590, 420);
    this.background.endFill();
    this.addChild(this.background);
    this.titleField = new PIXI.Text("Leaderboard", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleField.x = 230;
    this.titleField.y = 12;
    this.titleField.resolution = 1.5 * App.DevicePixelRatio;
    this.addChild(this.titleField);
    this.killsTitleField = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.deathsTitleField = new PIXI.Text("Deaths", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.ratioTitleField = new PIXI.Text("Ratio", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillTitleField = new PIXI.Text("Level", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.killsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.deathsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.ratioTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.skillTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.table = new PIXI.Container();
    this.addChild(this.table);
    this.killsTitleField.x = 264;
    this.killsTitleField.y = 42;
    this.deathsTitleField.x = 340;
    this.deathsTitleField.y = 42;
    this.ratioTitleField.x = 434;
    this.ratioTitleField.y = 42;
    this.skillTitleField.x = 524;
    this.skillTitleField.y = 42;
    this.addChild(this.killsTitleField);
    this.addChild(this.deathsTitleField);
    this.addChild(this.ratioTitleField);
    this.addChild(this.skillTitleField);
    this.rows = new OrderedContainer();
    this.rowLabel = new DMRowLabel();
  }
  validate() {
    this.invalidated &&
      (this.rows.sortMethodMultiple(-1, "getDeaths", 1, "getKills"),
      this.update(),
      (this.invalidated = !1));
  }
  reset() {
    this.rows.iterate(function (a, b) {
      b.setDeaths(0);
      b.setKills(0);
      return !0;
    });
  }
  hide() {
    this.hideDropdown();
    this.hideClientInfo();
    for (var a = 0, b = this.rows.getSize(); a < b; a++) this.rows.getIndex(a).unmark();
  }
  updateTeamPoints() {}
  addClient(a) {
    if (this.rows.getById(a.sid)) this.updateClient(a);
    else {
      var b = new DMLeaderboardRow(a);
      b.on("mouseover", (c) => {
        this.displayClientInfo(c);
        b.mark();
        AudioEffects.ButtonHover.audio.play();
      });
      b.on("mouseout", () => {
        this.hideClientInfo();
        b.unmark();
      });
      b.on("mousemove", (c) => this.moveClientInfo(c));
      b.on("rightdown", (c) => this.displayDropdown(c));
      b.on("mousedown", () => {
        a.guest || this.dispatchEvent(new HudEvent(HudEvent.DISPLAY_PROFILE, { name: a.name }));
      });
      b.on("touchstart", () => {
        a.guest || this.dispatchEvent(new HudEvent(HudEvent.DISPLAY_PROFILE, { name: a.name }));
      });
      this.rows.add(b, a.sid);
      this.table.addChild(b);
      this.visible
        ? (this.rows.sortMethodMultiple(-1, "getDeaths", 1, "getKills"), this.update())
        : (this.invalidated = !0);
    }
  }
  displayDropdown(a) {
    const b = a.target;
    "guest" !== App.Credential.accounttype &&
      b.name !== App.Credential.username &&
      (this.dropdown.target === b && this.dropdown.parent
        ? this.hideDropdown()
        : ((this.dropdown.target = b),
          this.addChild(this.dropdown),
          this.dropdown.show(),
          (this.dropdown.x = a.data.global.x - this.x - 10),
          (this.dropdown.y = a.data.global.y - this.y - 4)));
  }
  hideDropdown() {
    this.dropdown.parent && this.removeChild(this.dropdown);
  }
  removeClient(a) {
    var b = this.rows.getById(a.sid);
    b && this.table.removeChild(b);
    this.rows.getById(a.sid) && this.rows.remove(a.sid);
    this.update();
  }
  displayClientInfo(a) {
    this.rowLabel.update(
      a.target.name,
      a.target.title,
      a.target.level,
      a.target.skill,
      a.target.skillIndex,
      a.target.clanName
    );
    this.rowLabel.parent || this.addChild(this.rowLabel);
  }
  hideClientInfo() {
    this.rowLabel.parent && this.removeChild(this.rowLabel);
  }
  moveClientInfo(a) {
    this.rowLabel.parent &&
      ((this.rowLabel.x = a.data.global.x - this.x),
      (this.rowLabel.y = a.data.global.y - (this.y + this.rowLabel.height)));
  }
  updateClient(a) {
    var b = this.rows.getIndexById(a.sid);
    if ((b = this.rows.getIndex(b)))
      void 0 !== a.kills && b.setKills(b.getKills() + a.kills),
        void 0 !== a.deaths && b.setDeaths(b.getDeaths() + a.deaths),
        void 0 !== a.level && b.setSkill(a.level);
    this.visible
      ? (this.rows.sortMethodMultiple(-1, "getDeaths", 1, "getKills"), this.update())
      : (this.invalidated = !0);
  }
  update() {
    for (var a = [], b = null, c = 0, d = this.rows.getSize(); c < d; c++) {
      var e = this.rows.getIndex(c);
      5 > c && a.push({ name: e.name, color: Team.HexColors[e.team], kills: e.kills });
      e.local && (b = { name: e.name, index: c, kills: e.kills });
      e.x = 135;
      e.y = 68 + 28 * c;
    }
    this.dispatchEvent(new HudEvent(HudEvent.LEADERBOARD_UPDATE, { top: a, local: b }));
  }
  getWidth() {
    return this._width;
  }
  getHeight() {
    return this._height;
  }
}
class DMLeaderboardRow extends PIXI.Sprite {
  constructor(a) {
    super();
    this.sid = a.sid;
    this.name = a.name;
    this.local = a.local || !1;
    this.title = a.title;
    this.clanId = a.clan_id;
    this.clanName = a.clan_name;
    this.skill = a.skill;
    this.team = a.team;
    this.ratio = 0;
    this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.05);
    this.background.drawRect(-130, -4, 580, 28, 4);
    this.background.beginFill(16777215, 0.2);
    this.background.drawRect(-128, -2, 576, 24, 4);
    this.background.endFill();
    this.hitArea = new PIXI.Rectangle(-130, 0, 580, 20);
    a
      ? (a.record
          ? ((this.kills = a.record.kills || 0), (this.deaths = a.record.deaths || 0))
          : (this.deaths = this.kills = 0),
        (this.level = a.level || 0),
        (this.title = a.title || "guest"))
      : ((this.kills = this.deaths = this.damage = this.level = 0), (this.title = "guest"));
    this.leaderboardRow = new PIXI.Sprite(App.CombinedTextures.leaderboard_row);
    this.leaderboardRow.anchor.x = 0.5;
    this.leaderboardRow.anchor.y = 0.5;
    this.leaderboardRow.x = 150;
    this.leaderboardRow.y = 8;
    this.leaderboardRow.scale.x = 2.8;
    this.nameField = new PIXI.Text(this.name, {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.killsField = new PIXI.Text(this.kills.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.deathsField = new PIXI.Text(this.deaths.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.ratioField = new PIXI.Text(this.ratio.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillField = new PIXI.Text(this.level.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.nameField.tint = Team.HexColors[a.team];
    this.nameField.resolution = 1.5 * App.DevicePixelRatio;
    this.nameField.anchor.x = 0.5;
    this.killsField.anchor.x = 0.5;
    this.deathsField.anchor.x = 0.5;
    this.ratioField.anchor.x = 0.5;
    this.skillField.anchor.x = 0.5;
    this.nameField.x = 10;
    this.killsField.x = 145;
    this.deathsField.x = 230;
    this.ratioField.x = 320;
    this.skillField.x = 410;
    this.addChild(this.leaderboardRow);
    this.addChild(this.nameField);
    this.addChild(this.killsField);
    this.addChild(this.deathsField);
    this.addChild(this.ratioField);
    this.addChild(this.skillField);
    this.skillIndex = Math.max(Math.floor((this.level / 160) * 10) + 1);
    this.skillIndex = 16 < this.skillIndex ? 16 : this.skillIndex;
    this.skillTag = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + this.skillIndex]);
    this.skillTag.x = -130;
    this.skillTag.y = -10;
    this.skillTag.scale.x = this.skillTag.scale.y = 0.5;
    this.addChild(this.skillTag);
    this.updateRatio();
  }
  setName(a) {
    this.name = a;
    this.nameField.text = this.name;
  }
  setKills(a) {
    this.kills = a;
    this.killsField.text = this.kills.toString();
    this.updateRatio();
  }
  setDeaths(a) {
    this.deaths = a;
    this.deathsField.text = this.deaths.toString();
    this.updateRatio();
  }
  setSkill(a) {
    this.level = a;
    this.skillField.text = this.level.toString();
  }
  updateRatio() {
    this.ratio = this.kills / (0 < this.deaths ? this.deaths : 1);
    this.ratioField.text = ToPrecision(2, this.ratio).toString();
  }
  getKills() {
    return this.kills;
  }
  getDeaths() {
    return this.deaths;
  }
  getDamage() {
    return this.damage;
  }
  getRatio() {
    return this.ratio;
  }
  getskill() {
    return this.level;
  }
  mark() {
    this.background.parent || this.addChildAt(this.background, 0);
  }
  unmark() {
    this.background.parent && this.removeChild(this.background);
  }
}
class DMRowLabel extends PIXI.Container {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.beginFill(0, 0.8);
    this.background.drawRoundedRect(0, 0, 300, 130, 5, 5);
    this.background.endFill();
    this.addChild(this.background);
    this.nameFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.descTitle = new PIXI.Text(
      "Left-click to view full profile.\nRight-click to display additional options.",
      {
        fontName: "Arial",
        fontSize: 14,
        fill: 13412864,
        strokeThickness: 3,
        lineJoin: "round",
        wordWrap: !0,
        wordWrapWidth: 280,
      }
    );
    this.nameField = new PIXI.Text("Name:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleField = new PIXI.Text("Title:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillField = new PIXI.Text("Level & skill:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanField = new PIXI.Text("Clan:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.addChild(this.nameFieldTitle);
    this.addChild(this.titleFieldTitle);
    this.addChild(this.skillFieldTitle);
    this.addChild(this.clanFieldTitle);
    this.addChild(this.descTitle);
    this.addChild(this.nameField);
    this.addChild(this.titleField);
    this.addChild(this.skillField);
    this.addChild(this.clanField);
    this.nameField.x = 70;
    this.titleField.x = 70;
    this.skillField.x = 70;
    this.clanField.x = 70;
    this.descTitle.x = 10;
    this.nameField.y = 5;
    this.titleField.y = 25;
    this.skillField.y = 45;
    this.clanField.y = 65;
    this.descTitle.y = 85;
    this.nameFieldTitle.x = 125;
    this.titleFieldTitle.x = 125;
    this.skillFieldTitle.x = 165;
    this.clanFieldTitle.x = 125;
    this.nameFieldTitle.y = 5;
    this.titleFieldTitle.y = 25;
    this.skillFieldTitle.y = 45;
    this.clanFieldTitle.y = 65;
    this.skillTag = null;
  }
  update(a, b, c, d, e, f) {
    this.nameFieldTitle.text = a;
    this.titleFieldTitle.text = b;
    this.skillFieldTitle.text = c + " - " + Game.MapSkillToTitle(d);
    this.clanFieldTitle.text = f;
    null !== this.skillTag && this.skillTag.parent && this.removeChild(this.skillTag);
    this.skillTag = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + e]);
    this.addChild(this.skillTag);
  }
}
var tdm_leaderboard = {};
class LeaderboardTDM extends PIXI.Container {
  constructor() {
    super();
    EventDispatcher.call(this);
    this._width = App.ClientWidth - 300;
    this._height = 600;
    this.invalidated = !0;
    this.dropdown = new PlayerDropdown();
    this.background = new PIXI.Graphics();
    this.background.lineStyle(3, 3355443, 1, 2);
    this.background.beginFill(0, 0.3);
    this.background.drawRect(0, 0, 1010, 300);
    this.background.endFill();
    this.addChild(this.background);
    this.alphaTitleField = new PIXI.Text("Alpha", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16711680,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoTitleField = new PIXI.Text("Bravo", {
      fontName: "Arial",
      fontSize: 22,
      fill: 255,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaKillsTitleField = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaDeathsTitleField = new PIXI.Text("Deaths", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaRatioTitleField = new PIXI.Text("Ratio", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaSkillTitleField = new PIXI.Text("Level", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoKillsTitleField = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoDeathsTitleField = new PIXI.Text("Deaths", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoRatioTitleField = new PIXI.Text("Ratio", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoSkillTitleField = new PIXI.Text("Level", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaKillsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaDeathsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaRatioTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaSkillTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoKillsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoRatioTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoSkillTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaTitleField.tint = 15597568;
    this.bravoTitleField.tint = 238;
    this.alphaTitleField.x = 20;
    this.alphaTitleField.y = 20;
    this.bravoTitleField.x = 520;
    this.bravoTitleField.y = 20;
    this.alphaKillsTitleField.x = 210;
    this.alphaKillsTitleField.y = 66;
    this.alphaKillsTitleField.tint = 13421568;
    this.alphaDeathsTitleField.x = 280;
    this.alphaDeathsTitleField.y = 66;
    this.alphaDeathsTitleField.tint = 13421568;
    this.alphaRatioTitleField.x = 370;
    this.alphaRatioTitleField.y = 66;
    this.alphaRatioTitleField.tint = 13421568;
    this.alphaSkillTitleField.x = 450;
    this.alphaSkillTitleField.y = 66;
    this.alphaSkillTitleField.tint = 13421568;
    this.bravoKillsTitleField.x = 715;
    this.bravoKillsTitleField.y = 66;
    this.bravoKillsTitleField.tint = 13421568;
    this.bravoDeathsTitleField.x = 785;
    this.bravoDeathsTitleField.y = 66;
    this.bravoDeathsTitleField.tint = 13421568;
    this.bravoRatioTitleField.x = 875;
    this.bravoRatioTitleField.y = 66;
    this.bravoRatioTitleField.tint = 13421568;
    this.bravoSkillTitleField.x = 955;
    this.bravoSkillTitleField.y = 66;
    this.bravoSkillTitleField.tint = 13421568;
    this.alphaFlag = new PIXI.Sprite(App.CombinedTextures.tdm_alpha);
    this.alphaFlag.scale.x = this.alphaFlag.scale.y = 0.4;
    this.bravoFlag = new PIXI.Sprite(App.CombinedTextures.tdm_bravo);
    this.bravoFlag.scale.x = this.bravoFlag.scale.y = 0.4;
    this.alphaPoints = new PIXI.Text("0 x", {
      fontName: "Arial",
      fontSize: 22,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaPoints.x = 42;
    this.alphaPoints.y = 50;
    this.alphaFlag.x = this.alphaPoints.x + 40;
    this.alphaFlag.y = this.alphaPoints.y - 5;
    this.bravoPoints = new PIXI.Text("0 x", {
      fontName: "Arial",
      fontSize: 22,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoPoints.x = 545;
    this.bravoPoints.y = 50;
    this.bravoFlag.x = this.bravoPoints.x + 40;
    this.bravoFlag.y = this.bravoPoints.y - 5;
    this.bravoPointsTotal = this.alphaPointsTotal = 0;
    this.addChild(this.alphaPoints);
    this.addChild(this.bravoPoints);
    this.addChild(this.alphaFlag);
    this.addChild(this.bravoFlag);
    this.addChild(this.alphaTitleField);
    this.addChild(this.bravoTitleField);
    this.addChild(this.alphaKillsTitleField);
    this.addChild(this.alphaDeathsTitleField);
    this.addChild(this.alphaRatioTitleField);
    this.addChild(this.alphaSkillTitleField);
    this.addChild(this.bravoKillsTitleField);
    this.addChild(this.bravoDeathsTitleField);
    this.addChild(this.bravoRatioTitleField);
    this.addChild(this.bravoSkillTitleField);
    this.table = new PIXI.Container();
    this.addChild(this.table);
    this.rowsAlpha = new OrderedContainer();
    this.rowsBravo = new OrderedContainer();
    this.rowLabel = new TDMRowLabel();
  }
  validate() {
    this.invalidated &&
      (this.rowsAlpha.sortMethodMultiple(-1, "getDeaths", 1, "getKills"),
      this.rowsBravo.sortMethodMultiple(-1, "getDeaths", 1, "getKills"),
      this.update(),
      (this.invalidated = !1));
  }
  reset() {
    this.rowsAlpha.iterate(function (a, b) {
      b.setDeaths(0);
      b.setKills(0);
      b.setSkill(0);
      return !0;
    });
    this.rowsBravo.iterate(function (a, b) {
      b.setDeaths(0);
      b.setKills(0);
      b.setSkill(0);
      return !0;
    });
    this.bravoPointsTotal = this.alphaPointsTotal = 0;
    this.alphaPoints.text = "0 x";
    this.bravoPoints.text = "0 x";
  }
  getTeamRows(a) {
    switch (parseInt(a.team, 10)) {
      case LeaderboardTDM.TEAM_ALPHA:
        return this.rowsAlpha;
      case LeaderboardTDM.TEAM_BRAVO:
        return this.rowsBravo;
    }
  }
  hide() {
    this.hideDropdown();
    this.hideClientInfo();
    for (var a = 0, b = this.rowsAlpha.getSize(); a < b; a++) {
      var c = this.rowsAlpha.getIndex(a);
      c.unmark();
    }
    a = 0;
    for (b = this.rowsBravo.getSize(); a < b; a++) (c = this.rowsBravo.getIndex(a)), c.unmark();
  }
  addClient(a) {
    var b = this.getTeamRows(a);
    if (b.getById(a.sid)) this.updateClient(a, !0);
    else {
      var c = new LeaderboardTDMRow(a);
      c.on("mouseover", (d) => {
        this.displayClientInfo(d);
        c.mark();
        AudioEffects.ButtonHover.audio.play();
      });
      c.on("mouseout", () => {
        this.hideClientInfo();
        c.unmark();
      });
      c.on("mousemove", (d) => this.moveClientInfo(d));
      c.on("rightdown", (d) => this.displayDropdown(d));
      c.on("mousedown", () => {
        a.guest || this.dispatchEvent(new HudEvent(HudEvent.DISPLAY_PROFILE, { name: a.name }));
      });
      c.on("touchstart", () => {
        a.guest || this.dispatchEvent(new HudEvent(HudEvent.DISPLAY_PROFILE, { name: a.name }));
      });
      b.add(c, a.sid);
      this.table.addChild(c);
      this.updateClient(a, !0);
      this.visible
        ? (b.sortMethodMultiple(-1, "getDeaths", 1, "getKills"), this.update())
        : (this.invalidated = !0);
    }
  }
  displayDropdown(a) {
    const b = a.target;
    "guest" !== App.Credential.accounttype &&
      b.name !== App.Credential.username &&
      (this.dropdown.target === b && this.dropdown.parent
        ? this.hideDropdown()
        : ((this.dropdown.target = b),
          this.addChild(this.dropdown),
          this.dropdown.show(),
          (this.dropdown.x = a.data.global.x - this.x),
          (this.dropdown.y = a.data.global.y - this.y)));
  }
  hideDropdown() {
    this.dropdown.parent && this.removeChild(this.dropdown);
  }
  removeClient(a) {
    var b = this.getTeamRows(a);
    if (b) {
      var c = b.getById(a.sid);
      c && this.table.removeChild(c);
      b.getById(a.sid) && b.remove(a.sid);
      this.update();
    }
  }
  displayClientInfo(a) {
    this.rowLabel.update(
      a.target.name,
      a.target.title,
      a.target.level,
      a.target.skill,
      a.target.skillIndex,
      a.target.clanName
    );
    this.rowLabel.parent || this.addChild(this.rowLabel);
  }
  hideClientInfo() {
    this.rowLabel.parent && this.removeChild(this.rowLabel);
  }
  moveClientInfo(a) {
    this.rowLabel.parent &&
      ((this.rowLabel.x = a.data.global.x - this.x), (this.rowLabel.y = a.data.global.y - this.y));
  }
  updateTeamPoints(a) {
    this.alphaPointsTotal = a[0];
    this.bravoPointsTotal = a[1];
    this.alphaPoints.text = this.alphaPointsTotal + " x";
    this.bravoPoints.text = this.bravoPointsTotal + " x";
    this.dispatchEvent(
      new HudEvent(HudEvent.LEADERBOARD_UPDATE, {
        alphaPoints: this.alphaPointsTotal,
        bravoPoints: this.bravoPointsTotal,
      })
    );
  }
  updateClient(a, b) {
    let c = this.getTeamRows(a);
    var d = c.getIndexById(a.sid);
    if ((d = c.getIndex(d))) {
      if (void 0 !== a.kills && (d.setKills(d.getKills() + a.kills), !b && 0 < a.kills))
        switch (a.team) {
          case LeaderboardTDM.TEAM_ALPHA:
            this.alphaPointsTotal++;
            this.alphaPoints.text = this.alphaPointsTotal + " x";
            break;
          case LeaderboardTDM.TEAM_BRAVO:
            this.bravoPointsTotal++, (this.bravoPoints.text = this.bravoPointsTotal + " x");
        }
      void 0 !== a.deaths && d.setDeaths(d.getDeaths() + a.deaths);
      void 0 !== a.damage && d.setDamage(d.getDamage() + a.damage);
      void 0 !== a.level && d.setSkill(a.level);
    }
    this.visible
      ? (c.sortMethodMultiple(-1, "getDeaths", 1, "getKills"), this.update())
      : (this.invalidated = !0);
    this.dispatchEvent(
      new HudEvent(HudEvent.LEADERBOARD_UPDATE, {
        alphaPoints: this.alphaPointsTotal,
        bravoPoints: this.bravoPointsTotal,
      })
    );
  }
  update() {
    for (var a = 0, b = this.rowsAlpha.getSize(); a < b; a++) {
      var c = this.rowsAlpha.getIndex(a);
      c.x = 100;
      c.y = 90 + 28 * a;
    }
    a = 0;
    for (b = this.rowsBravo.getSize(); a < b; a++)
      (c = this.rowsBravo.getIndex(a)), (c.x = 605), (c.y = 90 + 28 * a);
  }
  getWidth() {
    return this._width;
  }
  getHeight() {
    return this._height;
  }
}
LeaderboardTDM.TEAM_ALPHA = 0;
LeaderboardTDM.TEAM_BRAVO = 1;
class LeaderboardTDMRow extends PIXI.Sprite {
  constructor(a) {
    super();
    this.sid = a.sid;
    this.name = a.name;
    this.local = a.local || !1;
    this.title = a.title;
    this.clanId = a.clan_id;
    this.clanName = a.clan_name;
    this.skill = a.skill;
    this.ratio = 0;
    this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.05);
    this.background.drawRect(-90, -4, 480, 28, 4);
    this.background.beginFill(16777215, 0.2);
    this.background.drawRect(-88, -2, 476, 24, 4);
    this.background.endFill();
    this.hitArea = new PIXI.Rectangle(-90, 0, 480, 20);
    a
      ? (a.record
          ? ((this.kills = a.record.kills || 0), (this.deaths = a.record.deaths || 0))
          : (this.deaths = this.kills = 0),
        (this.damage = a.damage || 0),
        (this.level = a.level || 0),
        (this.title = a.title || "guest"))
      : ((this.kills = this.deaths = this.damage = this.level = 0), (this.title = "guest"));
    this.leaderboardRow = new PIXI.Sprite(App.CombinedTextures.leaderboard_row);
    this.leaderboardRow.anchor.x = 0.5;
    this.leaderboardRow.anchor.y = 0.5;
    this.leaderboardRow.x = 150;
    this.leaderboardRow.y = 8;
    this.leaderboardRow.scale.x = 2.8;
    this.nameField = new PIXI.Text(this.name, {
      fontName: "Arial",
      fontSize: 16,
      fill: this.local ? 15658496 : 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.killsField = new PIXI.Text(this.kills.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.deathsField = new PIXI.Text(this.deaths.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.ratioField = new PIXI.Text(this.ratio.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillField = new PIXI.Text(this.level.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.nameField.resolution = 1.5 * App.DevicePixelRatio;
    this.level = a.level;
    this.skillIndex = Math.max(Math.floor((this.level / 160) * 10) + 1);
    this.skillIndex = 16 < this.skillIndex ? 16 : this.skillIndex;
    this.skillTag = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + this.skillIndex]);
    this.skillTag.x = -100;
    this.skillTag.y = -10;
    this.skillTag.scale.x = this.skillTag.scale.y = 0.5;
    this.addChild(this.skillTag);
    this.nameField.anchor.x = 0;
    this.killsField.anchor.x = 0.5;
    this.deathsField.anchor.x = 0.5;
    this.ratioField.anchor.x = 0.5;
    this.skillField.anchor.x = 0.5;
    this.nameField.x = -65;
    this.killsField.x = 125;
    this.deathsField.x = 210;
    this.ratioField.x = 290;
    this.skillField.x = 370;
    this.addChild(this.leaderboardRow);
    this.addChild(this.nameField);
    this.addChild(this.killsField);
    this.addChild(this.deathsField);
    this.addChild(this.ratioField);
    this.addChild(this.skillField);
    this.updateRatio();
  }
  setName(a) {
    this.name = a;
    this.nameField.text = this.name;
  }
  setKills(a) {
    this.kills = a;
    this.killsField.text = this.kills.toString();
    this.updateRatio();
  }
  setDeaths(a) {
    this.deaths = a;
    this.deathsField.text = this.deaths.toString();
    this.updateRatio();
  }
  setDamage(a) {
    this.damage = a;
  }
  setSkill(a) {
    this.level = a;
    this.skillField.text = this.level.toString();
  }
  updateRatio() {
    this.ratio = this.kills / (0 < this.deaths ? this.deaths : 1);
    this.ratioField.text = ToPrecision(2, this.ratio).toString();
  }
  getKills() {
    return this.kills;
  }
  getDeaths() {
    return this.deaths;
  }
  getDamage() {
    return this.damage;
  }
  getRatio() {
    return this.ratio;
  }
  getSkill() {
    return this.level;
  }
  mark() {
    this.background.parent || this.addChildAt(this.background, 0);
  }
  unmark() {
    this.background.parent && this.removeChild(this.background);
  }
}
class TDMRowLabel extends PIXI.Container {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.beginFill(0, 0.7);
    this.background.drawRoundedRect(0, 0, 300, 130, 5, 5);
    this.background.endFill();
    this.addChild(this.background);
    this.nameFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.descTitle = new PIXI.Text(
      "Left-click to view full profile.\nRight-click to display additional options.",
      {
        fontName: "Arial",
        fontSize: 14,
        fill: 13412864,
        strokeThickness: 3,
        lineJoin: "round",
        wordWrap: !0,
        wordWrapWidth: 280,
      }
    );
    this.nameField = new PIXI.Text("Name:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleField = new PIXI.Text("Title:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillField = new PIXI.Text("Level & skill:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanField = new PIXI.Text("Clan:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.nameField.tint = 13421568;
    this.titleField.tint = 13421568;
    this.skillField.tint = 13421568;
    this.clanField.tint = 13421568;
    this.addChild(this.nameFieldTitle);
    this.addChild(this.titleFieldTitle);
    this.addChild(this.skillFieldTitle);
    this.addChild(this.clanFieldTitle);
    this.addChild(this.descTitle);
    this.addChild(this.nameField);
    this.addChild(this.titleField);
    this.addChild(this.skillField);
    this.addChild(this.clanField);
    this.nameField.x = 70;
    this.titleField.x = 70;
    this.skillField.x = 70;
    this.clanField.x = 70;
    this.descTitle.x = 10;
    this.nameField.y = 5;
    this.titleField.y = 25;
    this.skillField.y = 45;
    this.clanField.y = 65;
    this.descTitle.y = 85;
    this.nameFieldTitle.x = 125;
    this.titleFieldTitle.x = 125;
    this.skillFieldTitle.x = 165;
    this.clanFieldTitle.x = 125;
    this.nameFieldTitle.y = 5;
    this.titleFieldTitle.y = 25;
    this.skillFieldTitle.y = 45;
    this.clanFieldTitle.y = 65;
    this.skillTag = null;
  }
  update(a, b, c, d, e, f) {
    this.nameFieldTitle.text = a;
    this.titleFieldTitle.text = b;
    this.skillFieldTitle.text = c + " - " + Game.MapSkillToTitle(d);
    this.clanFieldTitle.text = f;
    null !== this.skillTag && this.skillTag.parent && this.removeChild(this.skillTag);
    this.skillTag = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + e]);
    this.addChild(this.skillTag);
  }
}
var ctf_leaderboard = {};
class LeaderboardCTF extends PIXI.Container {
  constructor() {
    super();
    EventDispatcher.call(this);
    this._width = App.ClientWidth - 300;
    this._height = 600;
    this.invalidated = !0;
    this.dropdown = new PlayerDropdown();
    this.background = new PIXI.Graphics();
    this.background.lineStyle(3, 3355443, 1, 2);
    this.background.beginFill(0, 0.3);
    this.background.drawRect(0, 0, 1010, 300);
    this.background.endFill();
    this.addChild(this.background);
    this.alphaTitleField = new PIXI.Text("Alpha", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16711680,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoTitleField = new PIXI.Text("Bravo", {
      fontName: "Arial",
      fontSize: 22,
      fill: 255,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaKillsTitleField = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaDeathsTitleField = new PIXI.Text("Deaths", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaRatioTitleField = new PIXI.Text("Ratio", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaPointsTitleField = new PIXI.Text("Points", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaSkillTitleField = new PIXI.Text("Level", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoKillsTitleField = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoDeathsTitleField = new PIXI.Text("Deaths", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoRatioTitleField = new PIXI.Text("Ratio", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoPointsTitleField = new PIXI.Text("Points", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoSkillTitleField = new PIXI.Text("Level", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaKillsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaDeathsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaRatioTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaPointsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaSkillTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoKillsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoRatioTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoPointsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoSkillTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaTitleField.x = 20;
    this.alphaTitleField.y = 20;
    this.bravoTitleField.x = 520;
    this.bravoTitleField.y = 20;
    this.alphaKillsTitleField.x = 210;
    this.alphaKillsTitleField.y = 66;
    this.alphaDeathsTitleField.x = 260;
    this.alphaDeathsTitleField.y = 66;
    this.alphaRatioTitleField.x = 330;
    this.alphaRatioTitleField.y = 66;
    this.alphaPointsTitleField.x = 390;
    this.alphaPointsTitleField.y = 66;
    this.alphaSkillTitleField.x = 450;
    this.alphaSkillTitleField.y = 66;
    this.bravoKillsTitleField.x = 713;
    this.bravoKillsTitleField.y = 66;
    this.bravoDeathsTitleField.x = 767;
    this.bravoDeathsTitleField.y = 66;
    this.bravoRatioTitleField.x = 835;
    this.bravoRatioTitleField.y = 66;
    this.bravoPointsTitleField.x = 895;
    this.bravoPointsTitleField.y = 66;
    this.bravoSkillTitleField.x = 955;
    this.bravoSkillTitleField.y = 66;
    this.alphaFlag = new PIXI.Sprite(App.CombinedTextures.flag_alpha);
    this.alphaFlag.scale.x = this.alphaFlag.scale.y = 0.4;
    this.bravoFlag = new PIXI.Sprite(App.CombinedTextures.flag_bravo);
    this.bravoFlag.scale.x = this.bravoFlag.scale.y = 0.4;
    this.alphaPoints = new PIXI.Text("0 x", {
      fontName: "Arial",
      fontSize: 22,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaPoints.x = 42;
    this.alphaPoints.y = 50;
    this.alphaFlag.x = this.alphaPoints.x + 40;
    this.alphaFlag.y = this.alphaPoints.y - 5;
    this.bravoPoints = new PIXI.Text("0 x", {
      fontName: "Arial",
      fontSize: 22,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoPoints.x = 545;
    this.bravoPoints.y = 50;
    this.bravoFlag.x = this.bravoPoints.x + 40;
    this.bravoFlag.y = this.bravoPoints.y - 5;
    this.bravoPointsTotal = this.alphaPointsTotal = 0;
    this.addChild(this.alphaPoints);
    this.addChild(this.bravoPoints);
    this.addChild(this.alphaFlag);
    this.addChild(this.bravoFlag);
    this.addChild(this.alphaTitleField);
    this.addChild(this.bravoTitleField);
    this.addChild(this.alphaKillsTitleField);
    this.addChild(this.alphaDeathsTitleField);
    this.addChild(this.alphaRatioTitleField);
    this.addChild(this.alphaPointsTitleField);
    this.addChild(this.alphaSkillTitleField);
    this.addChild(this.bravoKillsTitleField);
    this.addChild(this.bravoDeathsTitleField);
    this.addChild(this.bravoRatioTitleField);
    this.addChild(this.bravoPointsTitleField);
    this.addChild(this.bravoSkillTitleField);
    this.table = new PIXI.Container();
    this.addChild(this.table);
    this.rowsAlpha = new OrderedContainer();
    this.rowsBravo = new OrderedContainer();
    this.rowLabel = new CTFRowLabel();
  }
  validate() {
    this.invalidated &&
      (this.rowsAlpha.sortMethodMultiple(-1, "getDeaths", 1, "getKills", 1, "getPoints"),
      this.rowsBravo.sortMethodMultiple(-1, "getDeaths", 1, "getKills", 1, "getPoints"),
      this.update(),
      (this.invalidated = !1));
  }
  reset() {
    this.rowsAlpha.iterate(function (a, b) {
      b.setDeaths(0);
      b.setPoints(0);
      b.setKills(0);
      b.setSkill(0);
      return !0;
    });
    this.rowsBravo.iterate(function (a, b) {
      b.setDeaths(0);
      b.setPoints(0);
      b.setKills(0);
      b.setSkill(0);
      return !0;
    });
    this.bravoPointsTotal = this.alphaPointsTotal = 0;
    this.alphaPoints.text = "0 x";
    this.bravoPoints.text = "0 x";
  }
  hide() {
    this.hideDropdown();
    this.hideClientInfo();
    for (var a = 0, b = this.rowsAlpha.getSize(); a < b; a++) {
      var c = this.rowsAlpha.getIndex(a);
      c.unmark();
    }
    a = 0;
    for (b = this.rowsBravo.getSize(); a < b; a++) (c = this.rowsBravo.getIndex(a)), c.unmark();
  }
  getTeamRows(a) {
    switch (parseInt(a.team, 10)) {
      case LeaderboardCTF.TEAM_ALPHA:
        return this.rowsAlpha;
      case LeaderboardCTF.TEAM_BRAVO:
        return this.rowsBravo;
    }
  }
  addClient(a) {
    var b = this.getTeamRows(a);
    if (b.getById(a.sid)) this.updateClient(a, !0);
    else {
      var c = new LeaderboardRow(a);
      c.on("mouseover", (d) => {
        this.displayClientInfo(d);
        c.mark();
        AudioEffects.ButtonHover.audio.play();
      });
      c.on("mouseout", () => {
        this.hideClientInfo();
        c.unmark();
      });
      c.on("mousemove", (d) => this.moveClientInfo(d));
      c.on("rightdown", (d) => this.displayDropdown(d));
      c.on("mousedown", () => {
        a.guest || this.dispatchEvent(new HudEvent(HudEvent.DISPLAY_PROFILE, { name: a.name }));
      });
      c.on("touchstart", () => {
        a.guest || this.dispatchEvent(new HudEvent(HudEvent.DISPLAY_PROFILE, { name: a.name }));
      });
      b.add(c, a.sid);
      this.table.addChild(c);
      this.updateClient(a, !0);
      this.visible
        ? (b.sortMethodMultiple(-1, "getDeaths", 1, "getKills", 1, "getPoints"), this.update())
        : (this.invalidated = !0);
    }
  }
  displayDropdown(a) {
    const b = a.target;
    "guest" !== App.Credential.accounttype &&
      b.name !== App.Credential.username &&
      (this.dropdown.target === b && this.dropdown.parent
        ? this.hideDropdown()
        : ((this.dropdown.target = b),
          this.addChild(this.dropdown),
          this.dropdown.show(),
          (this.dropdown.x = a.data.global.x - this.x),
          (this.dropdown.y = a.data.global.y - this.y)));
  }
  hideDropdown() {
    this.dropdown.parent && this.removeChild(this.dropdown);
  }
  removeClient(a) {
    var b = this.getTeamRows(a);
    if (b) {
      var c = b.getById(a.sid);
      c && this.table.removeChild(c);
      b.getById(a.sid) && b.remove(a.sid);
      this.update();
    }
  }
  displayClientInfo(a) {
    this.rowLabel.update(
      a.target.name,
      a.target.title,
      a.target.level,
      a.target.skill,
      a.target.skillIndex,
      a.target.clanName
    );
    this.rowLabel.parent || this.addChild(this.rowLabel);
  }
  hideClientInfo() {
    this.rowLabel.parent && this.removeChild(this.rowLabel);
  }
  moveClientInfo(a) {
    this.rowLabel.parent &&
      ((this.rowLabel.x = a.data.global.x - this.x), (this.rowLabel.y = a.data.global.y - this.y));
  }
  updateTeamPoints(a) {
    this.alphaPointsTotal = a[0];
    this.bravoPointsTotal = a[1];
    this.alphaPoints.text = this.alphaPointsTotal + " x";
    this.bravoPoints.text = this.bravoPointsTotal + " x";
    this.dispatchEvent(
      new HudEvent(HudEvent.LEADERBOARD_UPDATE, {
        alphaPoints: this.alphaPointsTotal,
        bravoPoints: this.bravoPointsTotal,
      })
    );
  }
  updateClient(a, b) {
    var c = this.getTeamRows(a),
      d = c.getIndexById(a.sid);
    if ((d = c.getIndex(d))) {
      void 0 !== a.kills && d.setKills(d.getKills() + a.kills);
      void 0 !== a.deaths && d.setDeaths(d.getDeaths() + a.deaths);
      if (void 0 !== a.points && (d.setPoints(d.getPoints() + a.points), !b))
        switch (a.team) {
          case LeaderboardCTF.TEAM_ALPHA:
            this.alphaPointsTotal++;
            this.alphaPoints.text = this.alphaPointsTotal + " x";
            break;
          case LeaderboardCTF.TEAM_BRAVO:
            this.bravoPointsTotal++, (this.bravoPoints.text = this.bravoPointsTotal + " x");
        }
      void 0 !== a.damage && d.setDamage(d.getDamage() + a.damage);
      void 0 !== a.level && d.setSkill(a.level);
    }
    this.visible
      ? (c.sortMethodMultiple(-1, "getDeaths", 1, "getKills", 1, "getPoints"), this.update())
      : (this.invalidated = !0);
    this.dispatchEvent(
      new HudEvent(HudEvent.LEADERBOARD_UPDATE, {
        alphaPoints: this.alphaPointsTotal,
        bravoPoints: this.bravoPointsTotal,
      })
    );
  }
  update() {
    for (var a = 0, b = this.rowsAlpha.getSize(); a < b; a++) {
      var c = this.rowsAlpha.getIndex(a);
      c.x = 100;
      c.y = 90 + 28 * a;
    }
    a = 0;
    for (b = this.rowsBravo.getSize(); a < b; a++)
      (c = this.rowsBravo.getIndex(a)), (c.x = 605), (c.y = 90 + 28 * a);
  }
  getWidth() {
    return this._width;
  }
  getHeight() {
    return this._height;
  }
}
LeaderboardCTF.TEAM_ALPHA = 0;
LeaderboardCTF.TEAM_BRAVO = 1;
class LeaderboardRow extends PIXI.Sprite {
  constructor(a) {
    super();
    this.sid = a.sid;
    this.name = a.name;
    this.local = a.local || !1;
    this.title = a.title;
    this.clanId = a.clan_id;
    this.clanName = a.clan_name;
    this.skill = a.skill;
    this.ratio = 0;
    this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.05);
    this.background.drawRect(-94, -4, 488, 28, 4);
    this.background.beginFill(16777215, 0.2);
    this.background.drawRect(-92, -2, 484, 24, 4);
    this.background.endFill();
    this.hitArea = new PIXI.Rectangle(-90, 0, 480, 20);
    a
      ? (a.record
          ? ((this.kills = a.record.kills || 0),
            (this.deaths = a.record.deaths || 0),
            (this.points = a.record.points || 0))
          : (this.points = this.deaths = this.kills = 0),
        (this.damage = a.damage || 0),
        (this.level = a.level || 0),
        (this.title = a.title || "guest"))
      : ((this.kills = this.deaths = this.points = this.damage = this.level = 0),
        (this.title = "guest"));
    this.leaderboardRow = new PIXI.Sprite(App.CombinedTextures.leaderboard_row);
    this.leaderboardRow.anchor.x = 0.5;
    this.leaderboardRow.anchor.y = 0.5;
    this.leaderboardRow.x = 150;
    this.leaderboardRow.y = 8;
    this.leaderboardRow.scale.x = 2.8;
    this.nameField = new PIXI.Text(this.name, {
      fontName: "Arial",
      fontSize: 16,
      fill: this.local ? 15658496 : 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.killsField = new PIXI.Text(this.kills.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.deathsField = new PIXI.Text(this.deaths.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.ratioField = new PIXI.Text(this.ratio.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.pointsField = new PIXI.Text(this.points.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillField = new PIXI.Text(this.level.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.nameField.resolution = 1.5 * App.DevicePixelRatio;
    this.level = a.level;
    this.skillIndex = Math.max(Math.floor((this.level / 160) * 10) + 1);
    this.skillIndex = 16 < this.skillIndex ? 16 : this.skillIndex;
    this.skillTag = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + this.skillIndex]);
    this.skillTag.x = -100;
    this.skillTag.y = -10;
    this.skillTag.scale.x = this.skillTag.scale.y = 0.5;
    this.addChild(this.skillTag);
    this.nameField.anchor.x = 0;
    this.killsField.anchor.x = 0.5;
    this.deathsField.anchor.x = 0.5;
    this.ratioField.anchor.x = 0.5;
    this.pointsField.anchor.x = 0.5;
    this.skillField.anchor.x = 0.5;
    this.nameField.x = -65;
    this.killsField.x = 125;
    this.deathsField.x = 190;
    this.ratioField.x = 250;
    this.pointsField.x = 310;
    this.skillField.x = 370;
    this.addChild(this.leaderboardRow);
    this.addChild(this.nameField);
    this.addChild(this.killsField);
    this.addChild(this.deathsField);
    this.addChild(this.ratioField);
    this.addChild(this.pointsField);
    this.addChild(this.skillField);
    this.updateRatio();
  }
  setName(a) {
    this.name = a;
    this.nameField.text = this.name;
  }
  setKills(a) {
    this.kills = a;
    this.killsField.text = this.kills.toString();
    this.updateRatio();
  }
  setDeaths(a) {
    this.deaths = a;
    this.deathsField.text = this.deaths.toString();
    this.updateRatio();
  }
  setPoints(a) {
    this.points = a;
    this.pointsField.text = this.points.toString();
  }
  setDamage(a) {
    this.damage = a;
  }
  setSkill(a) {
    this.level = a;
    this.skillField.text = this.level.toString();
  }
  updateRatio() {
    this.ratio = this.kills / (0 < this.deaths ? this.deaths : 1);
    this.ratioField.text = ToPrecision(2, this.ratio).toString();
  }
  getKills() {
    return this.kills;
  }
  getDeaths() {
    return this.deaths;
  }
  getPoints() {
    return this.points;
  }
  getDamage() {
    return this.damage;
  }
  getRatio() {
    return this.ratio;
  }
  getSkill() {
    return this.level;
  }
  mark() {
    this.background.parent || this.addChildAt(this.background, 0);
  }
  unmark() {
    this.background.parent && this.removeChild(this.background);
  }
}
class CTFRowLabel extends PIXI.Container {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.beginFill(0, 0.7);
    this.background.drawRoundedRect(0, 0, 300, 130, 5, 5);
    this.background.endFill();
    this.addChild(this.background);
    this.nameFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.descTitle = new PIXI.Text(
      "Left-click to view full profile.\nRight-click to display additional options.",
      {
        fontName: "Arial",
        fontSize: 14,
        fill: 13412864,
        strokeThickness: 3,
        lineJoin: "round",
        wordWrap: !0,
        wordWrapWidth: 280,
      }
    );
    this.nameField = new PIXI.Text("Name:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleField = new PIXI.Text("Title:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillField = new PIXI.Text("Level & skill:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanField = new PIXI.Text("Clan:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.addChild(this.nameFieldTitle);
    this.addChild(this.titleFieldTitle);
    this.addChild(this.skillFieldTitle);
    this.addChild(this.clanFieldTitle);
    this.addChild(this.descTitle);
    this.addChild(this.nameField);
    this.addChild(this.titleField);
    this.addChild(this.skillField);
    this.addChild(this.clanField);
    this.nameField.x = 70;
    this.titleField.x = 70;
    this.skillField.x = 70;
    this.clanField.x = 70;
    this.descTitle.x = 10;
    this.nameField.y = 5;
    this.titleField.y = 25;
    this.skillField.y = 45;
    this.clanField.y = 65;
    this.descTitle.y = 85;
    this.nameFieldTitle.x = 125;
    this.titleFieldTitle.x = 125;
    this.skillFieldTitle.x = 165;
    this.clanFieldTitle.x = 125;
    this.nameFieldTitle.y = 5;
    this.titleFieldTitle.y = 25;
    this.skillFieldTitle.y = 45;
    this.clanFieldTitle.y = 65;
    this.skillTag = null;
  }
  update(a, b, c, d, e, f) {
    this.nameFieldTitle.text = a;
    this.titleFieldTitle.text = b;
    this.skillFieldTitle.text = c + " - " + Game.MapSkillToTitle(d);
    this.clanFieldTitle.text = f;
    null !== this.skillTag && this.skillTag.parent && this.removeChild(this.skillTag);
    this.skillTag = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + e]);
    this.addChild(this.skillTag);
  }
}
var db_leaderboard = {};
class LeaderboardDB extends PIXI.Container {
  constructor() {
    super();
    EventDispatcher.call(this);
    this._width = App.ClientWidth - 300;
    this._height = 600;
    this.invalidated = !0;
    this.dropdown = new PlayerDropdown();
    this.background = new PIXI.Graphics();
    this.background.lineStyle(3, 3355443, 1, 2);
    this.background.beginFill(0, 0.3);
    this.background.drawRect(0, 0, 1010, 300);
    this.background.endFill();
    this.addChild(this.background);
    this.alphaTitleField = new PIXI.Text("Alpha", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16711680,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoTitleField = new PIXI.Text("Bravo", {
      fontName: "Arial",
      fontSize: 22,
      fill: 255,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaKillsTitleField = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaDeathsTitleField = new PIXI.Text("Deaths", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaRatioTitleField = new PIXI.Text("Ratio", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaSkillTitleField = new PIXI.Text("Level", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoKillsTitleField = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoDeathsTitleField = new PIXI.Text("Deaths", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoRatioTitleField = new PIXI.Text("Ratio", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoSkillTitleField = new PIXI.Text("Level", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaKillsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaDeathsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaRatioTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaSkillTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoKillsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoRatioTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.bravoSkillTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.alphaTitleField.tint = 15597568;
    this.bravoTitleField.tint = 238;
    this.alphaTitleField.x = 20;
    this.alphaTitleField.y = 20;
    this.bravoTitleField.x = 520;
    this.bravoTitleField.y = 20;
    this.alphaKillsTitleField.x = 210;
    this.alphaKillsTitleField.y = 66;
    this.alphaKillsTitleField.tint = 13421568;
    this.alphaDeathsTitleField.x = 280;
    this.alphaDeathsTitleField.y = 66;
    this.alphaDeathsTitleField.tint = 13421568;
    this.alphaRatioTitleField.x = 370;
    this.alphaRatioTitleField.y = 66;
    this.alphaRatioTitleField.tint = 13421568;
    this.alphaSkillTitleField.x = 450;
    this.alphaSkillTitleField.y = 66;
    this.alphaSkillTitleField.tint = 13421568;
    this.bravoKillsTitleField.x = 715;
    this.bravoKillsTitleField.y = 66;
    this.bravoKillsTitleField.tint = 13421568;
    this.bravoDeathsTitleField.x = 785;
    this.bravoDeathsTitleField.y = 66;
    this.bravoDeathsTitleField.tint = 13421568;
    this.bravoRatioTitleField.x = 875;
    this.bravoRatioTitleField.y = 66;
    this.bravoRatioTitleField.tint = 13421568;
    this.bravoSkillTitleField.x = 955;
    this.bravoSkillTitleField.y = 66;
    this.bravoSkillTitleField.tint = 13421568;
    this.alphaFlag = new PIXI.Sprite(App.CombinedTextures.db_alpha);
    this.alphaFlag.scale.x = this.alphaFlag.scale.y = 0.4;
    this.bravoFlag = new PIXI.Sprite(App.CombinedTextures.db_bravo);
    this.bravoFlag.scale.x = this.bravoFlag.scale.y = 0.4;
    this.alphaPoints = new PIXI.Text("0 x", {
      fontName: "Arial",
      fontSize: 22,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.alphaPoints.x = 42;
    this.alphaPoints.y = 50;
    this.alphaFlag.x = this.alphaPoints.x + 40;
    this.alphaFlag.y = this.alphaPoints.y - 5;
    this.bravoPoints = new PIXI.Text("0 x", {
      fontName: "Arial",
      fontSize: 22,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.bravoPoints.x = 545;
    this.bravoPoints.y = 50;
    this.bravoFlag.x = this.bravoPoints.x + 40;
    this.bravoFlag.y = this.bravoPoints.y - 5;
    this.bravoPointsTotal = this.alphaPointsTotal = 0;
    this.addChild(this.alphaPoints);
    this.addChild(this.bravoPoints);
    this.addChild(this.alphaFlag);
    this.addChild(this.bravoFlag);
    this.addChild(this.alphaTitleField);
    this.addChild(this.bravoTitleField);
    this.addChild(this.alphaKillsTitleField);
    this.addChild(this.alphaDeathsTitleField);
    this.addChild(this.alphaRatioTitleField);
    this.addChild(this.alphaSkillTitleField);
    this.addChild(this.bravoKillsTitleField);
    this.addChild(this.bravoDeathsTitleField);
    this.addChild(this.bravoRatioTitleField);
    this.addChild(this.bravoSkillTitleField);
    this.table = new PIXI.Container();
    this.addChild(this.table);
    this.rowsAlpha = new OrderedContainer();
    this.rowsBravo = new OrderedContainer();
    this.rowLabel = new DBRowLabel();
  }
  validate() {
    this.invalidated &&
      (this.rowsAlpha.sortMethodMultiple(-1, "getDeaths", 1, "getKills"),
      this.rowsBravo.sortMethodMultiple(-1, "getDeaths", 1, "getKills"),
      this.update(),
      (this.invalidated = !1));
  }
  reset() {
    this.rowsAlpha.iterate(function (a, b) {
      b.setDeaths(0);
      b.setKills(0);
      b.setSkill(0);
      return !0;
    });
    this.rowsBravo.iterate(function (a, b) {
      b.setDeaths(0);
      b.setKills(0);
      b.setSkill(0);
      return !0;
    });
    this.bravoPointsTotal = this.alphaPointsTotal = 0;
    this.alphaPoints.text = "0 x";
    this.bravoPoints.text = "0 x";
  }
  getTeamRows(a) {
    switch (parseInt(a.team, 10)) {
      case LeaderboardDB.TEAM_ALPHA:
        return this.rowsAlpha;
      case LeaderboardDB.TEAM_BRAVO:
        return this.rowsBravo;
    }
  }
  hide() {
    this.hideDropdown();
    this.hideClientInfo();
    for (var a = 0, b = this.rowsAlpha.getSize(); a < b; a++) {
      var c = this.rowsAlpha.getIndex(a);
      c.unmark();
    }
    a = 0;
    for (b = this.rowsBravo.getSize(); a < b; a++) (c = this.rowsBravo.getIndex(a)), c.unmark();
  }
  addClient(a) {
    var b = this.getTeamRows(a);
    if (b.getById(a.sid)) this.updateClient(a, !0);
    else {
      var c = new LeaderboardDBRow(a);
      c.on("mouseover", (d) => {
        this.displayClientInfo(d);
        c.mark();
        AudioEffects.ButtonHover.audio.play();
      });
      c.on("mouseout", () => {
        this.hideClientInfo();
        c.unmark();
      });
      c.on("mousemove", (d) => this.moveClientInfo(d));
      c.on("rightdown", (d) => this.displayDropdown(d));
      c.on("mousedown", () => {
        a.guest || this.dispatchEvent(new HudEvent(HudEvent.DISPLAY_PROFILE, { name: a.name }));
      });
      c.on("touchstart", () => {
        a.guest || this.dispatchEvent(new HudEvent(HudEvent.DISPLAY_PROFILE, { name: a.name }));
      });
      b.add(c, a.sid);
      this.table.addChild(c);
      this.updateClient(a, !0);
      this.visible
        ? (b.sortMethodMultiple(-1, "getDeaths", 1, "getKills"), this.update())
        : (this.invalidated = !0);
    }
  }
  displayDropdown(a) {
    const b = a.target;
    "guest" !== App.Credential.accounttype &&
      b.name !== App.Credential.username &&
      (this.dropdown.target === b && this.dropdown.parent
        ? this.hideDropdown()
        : ((this.dropdown.target = b),
          this.addChild(this.dropdown),
          this.dropdown.show(),
          (this.dropdown.x = a.data.global.x - this.x),
          (this.dropdown.y = a.data.global.y - this.y)));
  }
  hideDropdown() {
    this.dropdown.parent && this.removeChild(this.dropdown);
  }
  removeClient(a) {
    var b = this.getTeamRows(a);
    if (b) {
      var c = b.getById(a.sid);
      c && this.table.removeChild(c);
      b.getById(a.sid) && b.remove(a.sid);
      this.update();
    }
  }
  displayClientInfo(a) {
    this.rowLabel.update(
      a.target.name,
      a.target.title,
      a.target.level,
      a.target.skill,
      a.target.skillIndex,
      a.target.clanName
    );
    this.rowLabel.parent || this.addChild(this.rowLabel);
  }
  hideClientInfo() {
    this.rowLabel.parent && this.removeChild(this.rowLabel);
  }
  moveClientInfo(a) {
    this.rowLabel.parent &&
      ((this.rowLabel.x = a.data.global.x - this.x), (this.rowLabel.y = a.data.global.y - this.y));
  }
  registerTeamPoint(a) {
    0 === a ? this.alphaPointsTotal++ : 1 === a && this.bravoPointsTotal++;
    this.alphaPoints.text = this.alphaPointsTotal + " x";
    this.bravoPoints.text = this.bravoPointsTotal + " x";
    this.dispatchEvent(
      new HudEvent(HudEvent.LEADERBOARD_UPDATE, {
        alphaPoints: this.alphaPointsTotal,
        bravoPoints: this.bravoPointsTotal,
      })
    );
  }
  updateTeamPoints(a) {
    this.alphaPointsTotal = a[0];
    this.bravoPointsTotal = a[1];
    this.alphaPoints.text = this.alphaPointsTotal + " x";
    this.bravoPoints.text = this.bravoPointsTotal + " x";
    this.dispatchEvent(
      new HudEvent(HudEvent.LEADERBOARD_UPDATE, {
        alphaPoints: this.alphaPointsTotal,
        bravoPoints: this.bravoPointsTotal,
      })
    );
  }
  updateClient(a, b) {
    b = this.getTeamRows(a);
    var c = b.getIndexById(a.sid);
    if ((c = b.getIndex(c)))
      void 0 !== a.kills && c.setKills(c.getKills() + a.kills),
        void 0 !== a.deaths && c.setDeaths(c.getDeaths() + a.deaths),
        void 0 !== a.damage && c.setDamage(c.getDamage() + a.damage),
        void 0 !== a.level && c.setSkill(a.level);
    this.visible
      ? (b.sortMethodMultiple(-1, "getDeaths", 1, "getKills"), this.update())
      : (this.invalidated = !0);
    this.dispatchEvent(
      new HudEvent(HudEvent.LEADERBOARD_UPDATE, {
        alphaPoints: this.alphaPointsTotal,
        bravoPoints: this.bravoPointsTotal,
      })
    );
  }
  update() {
    for (var a = 0, b = this.rowsAlpha.getSize(); a < b; a++) {
      var c = this.rowsAlpha.getIndex(a);
      c.x = 100;
      c.y = 90 + 28 * a;
    }
    a = 0;
    for (b = this.rowsBravo.getSize(); a < b; a++)
      (c = this.rowsBravo.getIndex(a)), (c.x = 605), (c.y = 90 + 28 * a);
  }
  getWidth() {
    return this._width;
  }
  getHeight() {
    return this._height;
  }
}
LeaderboardDB.TEAM_ALPHA = 0;
LeaderboardDB.TEAM_BRAVO = 1;
class LeaderboardDBRow extends PIXI.Sprite {
  constructor(a) {
    super();
    this.sid = a.sid;
    this.name = a.name;
    this.local = a.local || !1;
    this.title = a.title;
    this.clanId = a.clan_id;
    this.clanName = a.clan_name;
    this.skill = a.skill;
    this.ratio = 0;
    this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.05);
    this.background.drawRect(-94, -4, 488, 28, 4);
    this.background.beginFill(16777215, 0.2);
    this.background.drawRect(-92, -2, 484, 24, 4);
    this.background.endFill();
    this.hitArea = new PIXI.Rectangle(-90, 0, 480, 20);
    a
      ? (a.record
          ? ((this.kills = a.record.kills || 0), (this.deaths = a.record.deaths || 0))
          : (this.deaths = this.kills = 0),
        (this.damage = a.damage || 0),
        (this.level = a.level || 0),
        (this.title = a.title || "guest"))
      : ((this.kills = this.deaths = this.damage = this.level = 0), (this.title = "guest"));
    this.leaderboardRow = new PIXI.Sprite(App.CombinedTextures.leaderboard_row);
    this.leaderboardRow.anchor.x = 0.5;
    this.leaderboardRow.anchor.y = 0.5;
    this.leaderboardRow.x = 150;
    this.leaderboardRow.y = 8;
    this.leaderboardRow.scale.x = 2.8;
    this.nameField = new PIXI.Text(this.name, {
      fontName: "Arial",
      fontSize: 16,
      fill: this.local ? 15658496 : 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.killsField = new PIXI.Text(this.kills.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.deathsField = new PIXI.Text(this.deaths.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.ratioField = new PIXI.Text(this.ratio.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillField = new PIXI.Text(this.level.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.nameField.resolution = 1.5 * App.DevicePixelRatio;
    this.level = a.level;
    this.skillIndex = Math.max(Math.floor((this.level / 160) * 10) + 1);
    this.skillIndex = 16 < this.skillIndex ? 16 : this.skillIndex;
    this.skillTag = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + this.skillIndex]);
    this.skillTag.x = -100;
    this.skillTag.y = -10;
    this.skillTag.scale.x = this.skillTag.scale.y = 0.5;
    this.addChild(this.skillTag);
    this.nameField.anchor.x = 0;
    this.killsField.anchor.x = 0.5;
    this.deathsField.anchor.x = 0.5;
    this.ratioField.anchor.x = 0.5;
    this.skillField.anchor.x = 0.5;
    this.nameField.x = -65;
    this.killsField.x = 125;
    this.deathsField.x = 210;
    this.ratioField.x = 290;
    this.skillField.x = 370;
    this.addChild(this.leaderboardRow);
    this.addChild(this.nameField);
    this.addChild(this.killsField);
    this.addChild(this.deathsField);
    this.addChild(this.ratioField);
    this.addChild(this.skillField);
    this.updateRatio();
  }
  setName(a) {
    this.name = a;
    this.nameField.text = this.name;
  }
  setKills(a) {
    this.kills = a;
    this.killsField.text = this.kills.toString();
    this.updateRatio();
  }
  setDeaths(a) {
    this.deaths = a;
    this.deathsField.text = this.deaths.toString();
    this.updateRatio();
  }
  setDamage(a) {
    this.damage = a;
  }
  setSkill(a) {
    this.level = a;
    this.skillField.text = this.level.toString();
  }
  updateRatio() {
    this.ratio = this.kills / (0 < this.deaths ? this.deaths : 1);
    this.ratioField.text = ToPrecision(2, this.ratio).toString();
  }
  getKills() {
    return this.kills;
  }
  getDeaths() {
    return this.deaths;
  }
  getDamage() {
    return this.damage;
  }
  getRatio() {
    return this.ratio;
  }
  getSkill() {
    return this.level;
  }
  mark() {
    this.background.parent || this.addChildAt(this.background, 0);
  }
  unmark() {
    this.background.parent && this.removeChild(this.background);
  }
}
class DBRowLabel extends PIXI.Container {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.beginFill(0, 0.7);
    this.background.drawRoundedRect(0, 0, 300, 130, 5, 5);
    this.background.endFill();
    this.addChild(this.background);
    this.nameFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.descTitle = new PIXI.Text(
      "Left-click to view full profile.\nRight-click to display additional options.",
      {
        fontName: "Arial",
        fontSize: 14,
        fill: 13412864,
        strokeThickness: 3,
        lineJoin: "round",
        wordWrap: !0,
        wordWrapWidth: 280,
      }
    );
    this.nameField = new PIXI.Text("Name:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleField = new PIXI.Text("Title:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillField = new PIXI.Text("Level & skill:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanField = new PIXI.Text("Clan:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.nameField.tint = 13421568;
    this.titleField.tint = 13421568;
    this.skillField.tint = 13421568;
    this.clanField.tint = 13421568;
    this.addChild(this.nameFieldTitle);
    this.addChild(this.titleFieldTitle);
    this.addChild(this.skillFieldTitle);
    this.addChild(this.clanFieldTitle);
    this.addChild(this.descTitle);
    this.addChild(this.nameField);
    this.addChild(this.titleField);
    this.addChild(this.skillField);
    this.addChild(this.clanField);
    this.nameField.x = 70;
    this.titleField.x = 70;
    this.skillField.x = 70;
    this.clanField.x = 70;
    this.descTitle.x = 10;
    this.nameField.y = 5;
    this.titleField.y = 25;
    this.skillField.y = 45;
    this.clanField.y = 65;
    this.descTitle.y = 85;
    this.nameFieldTitle.x = 125;
    this.titleFieldTitle.x = 125;
    this.skillFieldTitle.x = 165;
    this.clanFieldTitle.x = 125;
    this.nameFieldTitle.y = 5;
    this.titleFieldTitle.y = 25;
    this.skillFieldTitle.y = 45;
    this.clanFieldTitle.y = 65;
    this.skillTag = null;
  }
  update(a, b, c, d, e, f) {
    this.nameFieldTitle.text = a;
    this.titleFieldTitle.text = b;
    this.skillFieldTitle.text = c + " - " + Game.MapSkillToTitle(d);
    this.clanFieldTitle.text = f;
    null !== this.skillTag && this.skillTag.parent && this.removeChild(this.skillTag);
    this.skillTag = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + e]);
    this.addChild(this.skillTag);
  }
}
var tr_leaderboard = {};
class LeaderboardTR extends PIXI.Container {
  constructor() {
    super();
    EventDispatcher.call(this);
    this._width = App.ClientWidth - 400;
    this._height = 560;
    this.invalidated = !0;
    this.dropdown = new PlayerDropdown();
    this.background = new PIXI.Graphics();
    this.background.lineStyle(3, 3355443, 1, 2);
    this.background.beginFill(0, 0.3);
    this.background.drawRect(0, 0, 590, 420);
    this.background.endFill();
    this.addChild(this.background);
    this.titleField = new PIXI.Text("Leaderboard", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleField.x = 230;
    this.titleField.y = 12;
    this.titleField.resolution = 1.5 * App.DevicePixelRatio;
    this.addChild(this.titleField);
    this.killsTitleField = new PIXI.Text("Kills", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.deathsTitleField = new PIXI.Text("Deaths", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.ratioTitleField = new PIXI.Text("Ratio", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillTitleField = new PIXI.Text("Level", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.killsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.deathsTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.ratioTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.skillTitleField.resolution = 1.5 * App.DevicePixelRatio;
    this.table = new PIXI.Container();
    this.addChild(this.table);
    this.killsTitleField.x = 264;
    this.killsTitleField.y = 42;
    this.deathsTitleField.x = 340;
    this.deathsTitleField.y = 42;
    this.ratioTitleField.x = 434;
    this.ratioTitleField.y = 42;
    this.skillTitleField.x = 524;
    this.skillTitleField.y = 42;
    this.addChild(this.killsTitleField);
    this.addChild(this.deathsTitleField);
    this.addChild(this.ratioTitleField);
    this.addChild(this.skillTitleField);
    this.rows = new OrderedContainer();
    this.rowLabel = new TRRowLabel();
  }
  validate() {
    this.invalidated &&
      (this.rows.sortMethodMultiple(-1, "getDeaths", 1, "getKills"),
      this.update(),
      (this.invalidated = !1));
  }
  reset() {
    this.rows.iterate(function (a, b) {
      b.setDeaths(0);
      b.setKills(0);
      return !0;
    });
  }
  hide() {
    this.hideDropdown();
    this.hideClientInfo();
    for (var a = 0, b = this.rows.getSize(); a < b; a++) this.rows.getIndex(a).unmark();
  }
  updateTeamPoints() {}
  addClient(a) {
    if (this.rows.getById(a.sid)) this.updateClient(a);
    else {
      var b = new TRLeaderboardRow(a);
      b.on("mouseover", (c) => {
        this.displayClientInfo(c);
        b.mark();
        AudioEffects.ButtonHover.audio.play();
      });
      b.on("mouseout", () => {
        this.hideClientInfo();
        b.unmark();
      });
      b.on("mousemove", (c) => this.moveClientInfo(c));
      b.on("rightdown", (c) => this.displayDropdown(c));
      b.on("mousedown", () => {
        a.guest || this.dispatchEvent(new HudEvent(HudEvent.DISPLAY_PROFILE, { name: a.name }));
      });
      b.on("touchstart", () => {
        a.guest || this.dispatchEvent(new HudEvent(HudEvent.DISPLAY_PROFILE, { name: a.name }));
      });
      this.rows.add(b, a.sid);
      this.table.addChild(b);
      this.visible
        ? (this.rows.sortMethodMultiple(-1, "getDeaths", 1, "getKills"), this.update())
        : (this.invalidated = !0);
    }
  }
  displayDropdown(a) {
    const b = a.target;
    "guest" !== App.Credential.accounttype &&
      b.name !== App.Credential.username &&
      (this.dropdown.target === b && this.dropdown.parent
        ? this.hideDropdown()
        : ((this.dropdown.target = b),
          this.addChild(this.dropdown),
          this.dropdown.show(),
          (this.dropdown.x = a.data.global.x - this.x - 10),
          (this.dropdown.y = a.data.global.y - this.y - 4)));
  }
  hideDropdown() {
    this.dropdown.parent && this.removeChild(this.dropdown);
  }
  removeClient(a) {
    var b = this.rows.getById(a.sid);
    b && this.table.removeChild(b);
    this.rows.getById(a.sid) && this.rows.remove(a.sid);
    this.update();
  }
  displayClientInfo(a) {
    this.rowLabel.update(
      a.target.name,
      a.target.title,
      a.target.level,
      a.target.skill,
      a.target.skillIndex,
      a.target.clanName
    );
    this.rowLabel.parent || this.addChild(this.rowLabel);
  }
  hideClientInfo() {
    this.rowLabel.parent && this.removeChild(this.rowLabel);
  }
  moveClientInfo(a) {
    this.rowLabel.parent &&
      ((this.rowLabel.x = a.data.global.x - this.x),
      (this.rowLabel.y = a.data.global.y - (this.y + this.rowLabel.height)));
  }
  updateClient(a) {
    var b = this.rows.getIndexById(a.sid);
    if ((b = this.rows.getIndex(b)))
      void 0 !== a.kills && b.setKills(b.getKills() + a.kills),
        void 0 !== a.deaths && b.setDeaths(b.getDeaths() + a.deaths),
        void 0 !== a.level && b.setSkill(a.level);
    this.visible
      ? (this.rows.sortMethodMultiple(-1, "getDeaths", 1, "getKills"), this.update())
      : (this.invalidated = !0);
  }
  update() {
    for (var a = [], b = null, c = 0, d = this.rows.getSize(); c < d; c++) {
      var e = this.rows.getIndex(c);
      5 > c && a.push({ name: e.name, color: Team.HexColors[e.team], kills: e.kills });
      e.local && (b = { name: e.name, index: c, kills: e.kills });
      e.x = 135;
      e.y = 68 + 28 * c;
    }
    this.dispatchEvent(new HudEvent(HudEvent.LEADERBOARD_UPDATE, { top: a, local: b }));
  }
  getWidth() {
    return this._width;
  }
  getHeight() {
    return this._height;
  }
}
class TRLeaderboardRow extends PIXI.Sprite {
  constructor(a) {
    super();
    this.sid = a.sid;
    this.name = a.name;
    this.local = a.local || !1;
    this.title = a.title;
    this.clanId = a.clan_id;
    this.clanName = a.clan_name;
    this.skill = a.skill;
    this.team = a.team;
    this.ratio = 0;
    this.interactive = !0;
    this.background = new PIXI.Graphics();
    this.background.beginFill(16777215, 0.05);
    this.background.drawRect(-130, -4, 580, 28, 4);
    this.background.beginFill(16777215, 0.2);
    this.background.drawRect(-128, -2, 576, 24, 4);
    this.background.endFill();
    this.hitArea = new PIXI.Rectangle(-130, 0, 580, 20);
    a
      ? (a.record
          ? ((this.kills = a.record.kills || 0), (this.deaths = a.record.deaths || 0))
          : (this.deaths = this.kills = 0),
        (this.level = a.level || 0),
        (this.title = a.title || "guest"))
      : ((this.kills = this.deaths = this.damage = this.level = 0), (this.title = "guest"));
    this.leaderboardRow = new PIXI.Sprite(App.CombinedTextures.leaderboard_row);
    this.leaderboardRow.anchor.x = 0.5;
    this.leaderboardRow.anchor.y = 0.5;
    this.leaderboardRow.x = 150;
    this.leaderboardRow.y = 8;
    this.leaderboardRow.scale.x = 2.8;
    this.nameField = new PIXI.Text(this.name, {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.killsField = new PIXI.Text(this.kills.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.deathsField = new PIXI.Text(this.deaths.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.ratioField = new PIXI.Text(this.ratio.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillField = new PIXI.Text(this.level.toString(), {
      fontName: "Arial",
      fontSize: 16,
      fill: 15658734,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.nameField.tint = Team.HexColors[a.team];
    this.nameField.resolution = 1.5 * App.DevicePixelRatio;
    this.nameField.anchor.x = 0.5;
    this.killsField.anchor.x = 0.5;
    this.deathsField.anchor.x = 0.5;
    this.ratioField.anchor.x = 0.5;
    this.skillField.anchor.x = 0.5;
    this.nameField.x = 10;
    this.killsField.x = 145;
    this.deathsField.x = 230;
    this.ratioField.x = 320;
    this.skillField.x = 410;
    this.addChild(this.leaderboardRow);
    this.addChild(this.nameField);
    this.addChild(this.killsField);
    this.addChild(this.deathsField);
    this.addChild(this.ratioField);
    this.addChild(this.skillField);
    this.skillIndex = Math.max(Math.floor((this.level / 160) * 10) + 1);
    this.skillIndex = 16 < this.skillIndex ? 16 : this.skillIndex;
    this.skillTag = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + this.skillIndex]);
    this.skillTag.x = -130;
    this.skillTag.y = -10;
    this.skillTag.scale.x = this.skillTag.scale.y = 0.5;
    this.addChild(this.skillTag);
    this.updateRatio();
  }
  setName(a) {
    this.name = a;
    this.nameField.text = this.name;
  }
  setKills(a) {
    this.kills = a;
    this.killsField.text = this.kills.toString();
    this.updateRatio();
  }
  setDeaths(a) {
    this.deaths = a;
    this.deathsField.text = this.deaths.toString();
    this.updateRatio();
  }
  setSkill(a) {
    this.level = a;
    this.skillField.text = this.level.toString();
  }
  updateRatio() {
    this.ratio = this.kills / (0 < this.deaths ? this.deaths : 1);
    this.ratioField.text = ToPrecision(2, this.ratio).toString();
  }
  getKills() {
    return this.kills;
  }
  getDeaths() {
    return this.deaths;
  }
  getDamage() {
    return this.damage;
  }
  getRatio() {
    return this.ratio;
  }
  getskill() {
    return this.level;
  }
  mark() {
    this.background.parent || this.addChildAt(this.background, 0);
  }
  unmark() {
    this.background.parent && this.removeChild(this.background);
  }
}
class TRRowLabel extends PIXI.Container {
  constructor() {
    super();
    this.background = new PIXI.Graphics();
    this.background.beginFill(0, 0.8);
    this.background.drawRoundedRect(0, 0, 300, 130, 5, 5);
    this.background.endFill();
    this.addChild(this.background);
    this.nameFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanFieldTitle = new PIXI.Text("", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421772,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.descTitle = new PIXI.Text(
      "Left-click to view full profile.\nRight-click to display additional options.",
      {
        fontName: "Arial",
        fontSize: 14,
        fill: 13412864,
        strokeThickness: 3,
        lineJoin: "round",
        wordWrap: !0,
        wordWrapWidth: 280,
      }
    );
    this.nameField = new PIXI.Text("Name:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.titleField = new PIXI.Text("Title:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.skillField = new PIXI.Text("Level & skill:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.clanField = new PIXI.Text("Clan:", {
      fontName: "Arial",
      fontSize: 16,
      fill: 13421568,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.addChild(this.nameFieldTitle);
    this.addChild(this.titleFieldTitle);
    this.addChild(this.skillFieldTitle);
    this.addChild(this.clanFieldTitle);
    this.addChild(this.descTitle);
    this.addChild(this.nameField);
    this.addChild(this.titleField);
    this.addChild(this.skillField);
    this.addChild(this.clanField);
    this.nameField.x = 70;
    this.titleField.x = 70;
    this.skillField.x = 70;
    this.clanField.x = 70;
    this.descTitle.x = 10;
    this.nameField.y = 5;
    this.titleField.y = 25;
    this.skillField.y = 45;
    this.clanField.y = 65;
    this.descTitle.y = 85;
    this.nameFieldTitle.x = 125;
    this.titleFieldTitle.x = 125;
    this.skillFieldTitle.x = 165;
    this.clanFieldTitle.x = 125;
    this.nameFieldTitle.y = 5;
    this.titleFieldTitle.y = 25;
    this.skillFieldTitle.y = 45;
    this.clanFieldTitle.y = 65;
    this.skillTag = null;
  }
  update(a, b, c, d, e, f) {
    this.nameFieldTitle.text = a;
    this.titleFieldTitle.text = b;
    this.skillFieldTitle.text = c + " - " + Game.MapSkillToTitle(d);
    this.clanFieldTitle.text = f;
    null !== this.skillTag && this.skillTag.parent && this.removeChild(this.skillTag);
    this.skillTag = new PIXI.Sprite(App.CombinedTextures["skill_icon_" + e]);
    this.addChild(this.skillTag);
  }
}
class Hud extends PIXI.Container {
  constructor(a) {
    super();
    EventDispatcher.call(this);
    this.manager = a;
    this.manager.on(ModelEvent.PLAYER_STATE, this.onPlayerState.bind(this));
    this.manager.on(ModelEvent.PLAYER_SPAWN, this.onPlayerSpawn.bind(this));
    this.manager.on(ModelEvent.PLAYER_DEATH, this.onPlayerDeath.bind(this));
    this.manager.on(ModelEvent.PLAYER_COMBO, this.onPlayerCombo.bind(this));
    this.manager.on(ModelEvent.FOCUS, this.onFocus.bind(this));
    this.manager.on(ModelEvent.UPDATE_ENVIRONMENT, this.onUpdateEnvironment.bind(this));
    this.keyboardMapping = InputState.InvertMapping(
      Registry.Instance[Registry.Key.SETTINGS].controls.keyBindings
    );
    this.textBar = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 32,
      fill: "#FF0000",
      align: "center",
    });
    this.textBar.x = 0.5 * App.ClientWidth;
    this.textBar.y = App.ClientHeight - 170;
    this.textBar.alpha = 1;
    this.textBar.visible = !1;
    this.textBarInterval = this.textBarTimeout = null;
    this.comboBar = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 32,
      fill: "#FF0000",
      align: "center",
    });
    this.comboBar.x = 0.5 * App.ClientWidth;
    this.comboBar.y = App.ClientHeight - 95;
    this.comboBar.alpha = 1;
    this.comboBar.visible = !1;
    this.onKeyDownListener = this.onKeyDown.bind(this);
    this.onKeyUpListener = this.onKeyUp.bind(this);
    UserInput.addListener(UserInput.KEY_DOWN, this.onKeyDownListener);
    UserInput.addListener(UserInput.KEY_UP, this.onKeyUpListener);
    this.mode = null;
    this.helpImageFirstDisplay = !1;
    this.damageGraphic = new PIXI.Sprite(App.CombinedTextures.damage);
    this.addChild(this.damageGraphic);
    this.damageGraphic.visible = !1;
    this.damageGraphic.width = App.ClientWidth;
    this.damageGraphic.height = App.ClientHeight;
    this.healthBar = new HealthBar();
    this.healthBar.interactiveChildren = !1;
    this.healthBar.x = 20;
    this.healthBar.y = App.ClientHeight - 32;
    this.healthBar.scale.x = 0.6;
    this.healthBar.scale.y = 0.6;
    this.addChild(this.healthBar);
    this.jetBar = new JetBar();
    this.jetBar.interactiveChildren = !1;
    this.jetBar.x = this.healthBar.x + this.healthBar.width + 20;
    this.jetBar.y = App.ClientHeight - 32;
    this.jetBar.scale.x = 0.6;
    this.jetBar.scale.y = 0.6;
    this.addChild(this.jetBar);
    this.ammoBar = new AmmoBar();
    this.ammoBar.interactiveChildren = !1;
    this.ammoBar.x = this.jetBar.x + this.jetBar.width + 20;
    this.ammoBar.y = App.ClientHeight - 32;
    this.ammoBar.scale.x = 0.6;
    this.ammoBar.scale.y = 0.6;
    this.addChild(this.ammoBar);
    this.goldCount = new GoldCount();
    this.goldCount.interactiveChildren = !1;
    this.goldCount.x = this.ammoBar.x + this.ammoBar.width + 20;
    this.goldCount.y = App.ClientHeight - 32;
    this.goldCount.scale.x = 0.6;
    this.goldCount.scale.y = 0.6;
    this.addChild(this.goldCount);
    this.actionTable = new ActionTable();
    this.actionTable.interactiveChildren = !1;
    1200 > App.ClientWidth && 1e3 <= App.ClientWidth
      ? ((this.actionTable.scale.x = 0.8),
        (this.actionTable.scale.y = 0.8),
        (App.Console.scale.x = 0.8),
        (App.Console.scale.y = 0.8))
      : 1e3 > App.ClientWidth
      ? ((this.actionTable.scale.x = 0.74),
        (this.actionTable.scale.y = 0.74),
        (App.Console.scale.x = 0.74),
        (App.Console.scale.y = 0.74))
      : ((this.actionTable.scale.x = 1),
        (this.actionTable.scale.y = 1),
        (App.Console.scale.x = 1),
        (App.Console.scale.y = 1));
    this.actionTable.x =
      App.ClientWidth - this.actionTable.getWidth() * this.actionTable.scale.x - 12;
    this.actionTable.y = 60;
    this.addChild(this.actionTable);
    this.gameoverDisplay = new GameoverDisplay();
    this.gameoverDisplay.interactiveChildren = !1;
    this.gameoverDisplay.visible = !1;
    this.gameoverDisplay.isActive = !1;
    this.gameoverDisplay.x = 0.5 * (App.ClientWidth - this.gameoverDisplay.getWidth());
    this.gameoverDisplay.y = 40;
    this.weaponMenu = new WeaponMenu();
    this.weaponMenu.x = 0.5 * (App.ClientWidth - this.weaponMenu.width);
    this.weaponMenu.y = 0.5 * (App.ClientHeight - this.weaponMenu.height);
    this.weaponMenu.visible = !1;
    this.weaponMenu.on(HudEvent.SELECT_ITEM, (b) => this.emit(HudEvent.SELECT_ITEM, b));
    this.weaponMenu.on(HudEvent.CLOSE_WEAPON_MENU, () => {
      this.displayWeaponMenu(!1);
      this.emit(HudEvent.SELECT_ITEM, null);
    });
    this.leaderboardUpdateInterval = setInterval(() => this.leaderboard.validate(), 1e3);
    this.addChild(this.textBar);
    this.addChild(this.comboBar);
    this.hideHelpImageInterval = this.displayHelpImageInterval = null;
    this.cache = {};
    this.helpImage = new PIXI.Sprite(App.CombinedTextures.help);
    this.helpImage.interactive = !0;
    this.helpImage.scale.x = this.helpImage.scale.y = 0.05;
    this.helpImage.anchor.x = this.helpImage.anchor.y = 0.5;
    this.helpImage.x = 0.5 * App.ClientWidth;
    this.helpImage.y = 0.5 * App.ClientHeight;
    this.helpImage.on("mousedown", () => this.hideHelpImage());
    this.helpImage.on("touchstart", () => this.hideHelpImage());
    this.closeHelpImageButton = new PIXI.Sprite(App.CombinedTextures.exit);
    this.closeHelpImageButton.x = 252;
    this.closeHelpImageButton.y = -174;
    this.helpImage.addChild(this.closeHelpImageButton);
    this.escapeMenu = new EscapeMenu();
    this.escapeMenu.x = 0.5 * (App.ClientWidth - this.escapeMenu.width);
    this.escapeMenu.y = 0.5 * (App.ClientHeight - this.escapeMenu.height);
    this.escapeMenu.on(EscapeMenu.EXIT, () => this.emit(HudEvent.EXIT));
    this.escapeMenu.on(EscapeMenu.MUTE, (b) => this.emit(HudEvent.MUTE_SOUND, b));
    this.escapeMenu.on(EscapeMenu.CLOSE, () => this.hideEscapeMenu());
    this.escapeMenu.on(EscapeMenu.WEAPONS, () => {
      this.hideEscapeMenu();
      this.displayWeaponMenu(!0);
    });
    this.escapeMenu.on(EscapeMenu.CONTROLS, () => {
      this.hideEscapeMenu();
      this.displayHelpImage();
    });
    App.FirstRun &&
      !App.HelpDisplayed &&
      ((this.helpImageFirstDisplay = !0), this.displayHelpImage(), (App.HelpDisplayed = !0));
  }
  displayHelpImage() {
    if (!this.escapeMenu.parent && this.helpImage.interactive) {
      if (null !== this.displayHelpImageInterval)
        clearInterval(this.displayHelpImageInterval), (this.displayHelpImageInterval = null);
      else if (this.helpImage.parent) {
        this.hideHelpImage();
        return;
      }
      this.helpImage.parent ||
        ((this.helpImage.interactive = !1),
        this.addChild(this.helpImage),
        (this.helpImage.scale.x = this.helpImage.scale.y = 0.05),
        (this.helpImage.x = App.ClientWidth - 180),
        (this.helpImage.y = 13),
        (this.displayHelpImageInterval = setInterval(() => {
          this.helpImage.scale.x += 0.05;
          this.helpImage.scale.y += 0.05;
          let a = this.helpImage.y - 0.5 * App.ClientHeight;
          this.helpImage.x -= 0.25 * (this.helpImage.x - 0.5 * App.ClientWidth);
          this.helpImage.y -= 0.25 * a;
          this.helpImage.scale.x >= App.Scale - 0.05 &&
            (clearInterval(this.displayHelpImageInterval),
            (this.displayHelpImageInterval = null),
            (this.helpImage.scale.x = this.helpImage.scale.y = App.Scale),
            (this.helpImage.x = 0.5 * App.ClientWidth),
            (this.helpImage.y = 0.5 * App.ClientHeight),
            (this.helpImage.interactive = !0));
        }, 17)));
    }
  }
  hideHelpImage() {
    null !== this.hideHelpImageInterval &&
      (clearInterval(this.hideHelpImageInterval), (this.hideHelpImageInterval = null));
    this.helpImage.scale.x = this.helpImage.scale.y = App.Scale;
    this.helpImage.interactive = !1;
    this.hideHelpImageInterval = setInterval(() => {
      this.helpImage.scale.x -= 0.05;
      this.helpImage.scale.y -= 0.05;
      let a = -this.helpImage.y + 13;
      this.helpImage.x += 0.25 * (App.ClientWidth - (this.helpImage.x + 150));
      this.helpImage.y += 0.25 * a;
      0.05 >= this.helpImage.scale.x &&
        (this.helpImage.parent && this.removeChild(this.helpImage),
        this.helpImageFirstDisplay &&
          (this.displayWeaponMenu(!0), (this.helpImageFirstDisplay = !1)),
        clearInterval(this.hideHelpImageInterval),
        (this.hideHelpImageInterval = null),
        (this.helpImage.interactive = !0));
    }, 17);
  }
  displayEscapeMenu() {
    this.escapeMenu.parent || (this.addChild(this.escapeMenu), (App.UIVisible = !0));
  }
  hideEscapeMenu() {
    this.escapeMenu.parent && (this.removeChild(this.escapeMenu), (App.UIVisible = !1));
  }
  setMuted(a) {
    this.escapeMenu.setMuted(a);
  }
  onKeyDown(a) {
    a = a.data;
    if (void 0 !== a.char) {
      var b = a.char.toUpperCase();
      if (27 === a.code) this.escapeMenu.parent ? this.hideEscapeMenu() : this.displayEscapeMenu();
      else
        switch (
          (characterMapCTRL[a.code] && (b = characterMapCTRL[a.code]),
          (b = InputState.GetMappedCharacter(b, this.keyboardMapping)),
          b)
        ) {
          case "G":
            this.displayWeaponMenu(!0);
            break;
          case "H":
            this.displayHelpImage();
            break;
          case "V":
            this.leaderboard.visible ||
              this.escapeMenu.parent ||
              (this.addChild(this.leaderboard),
              (this.leaderboard.visible = !0),
              this.leaderboard.validate()),
              (App.UIVisible = !0);
        }
    }
  }
  onKeyUp(a) {
    a = a.data;
    if (void 0 !== a.char) {
      var b = a.char.toUpperCase();
      characterMapCTRL[a.code] && (b = characterMapCTRL[a.code]);
      b = InputState.GetMappedCharacter(b, this.keyboardMapping);
      switch (b) {
        case "F":
          this.weaponMenu.itemSelected && this.displayWeaponMenu(!1);
          break;
        case "V":
          this.leaderboard.visible &&
            (this.removeChild(this.leaderboard),
            (this.leaderboard.visible = !1),
            this.leaderboard.hide()),
            (App.UIVisible = !1);
      }
    }
  }
  setGameMode(a) {
    this.mode = a;
    if (!this.leaderboard)
      switch (a) {
        case Game.MODE_CTF:
          this.leaderboard = new LeaderboardCTF();
          this.actionTable.setMode(Game.MODE_CTF);
          this.cache.flag_alpha = this.cache.flag_alpha
            ? this.cache.flag_alpha
            : new PIXI.Sprite(App.CombinedTextures.flag_alpha);
          this.cache.flag_bravo = this.cache.flag_bravo
            ? this.cache.flag_bravo
            : new PIXI.Sprite(App.CombinedTextures.flag_bravo);
          this.leaderboard.addListener(
            HudEvent.LEADERBOARD_UPDATE,
            this.updateFlagScore.bind(this)
          );
          break;
        case Game.MODE_DM:
          this.leaderboard = new LeaderboardDM();
          this.actionTable.setMode(Game.MODE_DM);
          this.leaderboard.addListener(
            HudEvent.LEADERBOARD_UPDATE,
            this.updateTopListing.bind(this)
          );
          break;
        case Game.MODE_TDM:
          this.leaderboard = new LeaderboardTDM();
          this.actionTable.setMode(Game.MODE_TDM);
          this.leaderboard.addListener(HudEvent.LEADERBOARD_UPDATE, this.updateTDMScore.bind(this));
          break;
        case Game.MODE_DB:
          this.leaderboard = new LeaderboardDB();
          this.actionTable.setMode(Game.MODE_DB);
          this.leaderboard.addListener(HudEvent.LEADERBOARD_UPDATE, this.updateDBScore.bind(this));
          break;
        case Game.MODE_TR:
          (this.leaderboard = new LeaderboardTR()),
            this.actionTable.setMode(Game.MODE_TR),
            this.leaderboard.addListener(
              HudEvent.LEADERBOARD_UPDATE,
              this.updateTRScore.bind(this)
            );
      }
    this.leaderboard.addListener(HudEvent.DISPLAY_PROFILE, this.onDisplayProfile.bind(this));
    this.leaderboard.visible = !1;
    this.onFocus();
  }
  onDisplayProfile(a) {
    App.Layer.onUserAccess(a.data.name, "name");
    AudioEffects.ButtonClick.audio.play();
  }
  updateFlagScore(a) {
    this.actionTable.updateFlagScore(a.data);
  }
  updateTopListing(a) {
    this.actionTable.updateTopListing(a.data);
  }
  updateTDMScore(a) {
    this.actionTable.updateTDMScore(a.data);
  }
  updateDBScore(a) {
    this.actionTable.updateDBScore(a.data);
  }
  updateTRScore(a) {
    this.actionTable.updateTRScore(a.data);
  }
  onPlayerState(a) {
    let b = a.agent;
    switch (a.state.s) {
      case StateChange.Agent.JET:
        this.setJet(b, a.state);
        break;
      case StateChange.Agent.HEALTH:
        this.setHealth(b);
        break;
      case StateChange.Agent.GOLD:
        this.goldCount.increment(a.state.v);
        break;
      case StateChange.Item.RELOAD:
      case StateChange.Item.USE:
        ItemMap[a.state.t].equip !== ItemMap.Equip.BELT
          ? this.setItemStatus(b, a.state)
          : this.ammoBar.decrementBeltValue(a.state);
        break;
      case StateChange.Item.EQUIP:
        this.setItemStatus(b, a.state);
        break;
      case StateChange.Item.CARRY_PRIMARY:
        this.ammoBar.setItem(a.state);
        break;
      case StateChange.Item.CARRY_BELT:
        this.ammoBar.setBeltItem(a.state);
        break;
      case StateChange.Item.DROP:
      case StateChange.Item.REMOVE_PRIMARY:
        this.ammoBar.setItem(null);
    }
  }
  setAvailableItems(a) {
    for (let b = 0, c = a.length; b < c; b++) this.weaponMenu.addItem(a[b]);
    this.weaponMenu.rearrange();
  }
  displayWeaponMenu(a) {
    null === this.mode ||
      this.mode === Game.MODE_DB ||
      this.weaponMenu.isEmpty ||
      this.helpImage.parent ||
      this.escapeMenu.parent ||
      (a
        ? this.weaponMenu.visible ||
          this.gameoverDisplay.isActive ||
          (this.addChild(this.weaponMenu), (this.weaponMenu.visible = !0))
        : this.weaponMenu.visible &&
          (this.removeChild(this.weaponMenu), (this.weaponMenu.visible = !1)),
      (App.UIVisible = a));
  }
  onPlayerSpawn() {
    this.jetBar.setValue(this.jetBar.maxValue);
    this.weaponMenu.essentialItemSelected ? this.displayWeaponMenu(!1) : this.displayWeaponMenu(!0);
    this.textBar.visible = !1;
  }
  onPlayerDeath(a) {
    let b = a.victim,
      c = a.killer,
      d = a.local,
      e = null;
    a.wep && (e = Game.MapEventWepToIcon(a.wep));
    b === c
      ? (b.sid === d && this.displaySuicide(Game.MapEventWepToIcon(a.wep)),
        this.actionTable.register(c.name + " suicide", e),
        c.bot || this.leaderboard.updateClient({ sid: c.sid, kills: -1, team: c.team }))
      : (b.sid === d
          ? this.displayKilledBy(c, Game.MapEventWepToIcon(a.wep))
          : c.sid === d && this.displayKilled(b, Game.MapEventWepToIcon(a.wep)),
        c.bot || this.leaderboard.updateClient({ sid: c.sid, kills: 1, team: c.team }),
        this.actionTable.register((c.p.isBot ? "bot" : c.name) + " killed " + b.name, e));
    b.bot || this.leaderboard.updateClient({ sid: b.sid, deaths: 1, team: b.team });
    b.sid === d &&
      (this.ammoBar.setBeltItem(null),
      !1 === this.gameoverDisplay.visible &&
        (this.weaponMenuTimeout && clearTimeout(this.weaponMenuTimeout),
        (this.weaponMenuTimeout = setTimeout(() => this.displayWeaponMenu(!0), 1500))));
  }
  onPlayerCombo(a) {
    this.displayCombo(a.type);
  }
  setJet(a, b) {
    this.jetBar.setValue(b.v);
  }
  setHealth(a) {
    this.healthBar.setValue(a.health);
    a.alive
      ? 30 > a.health
        ? ((this.damageGraphic.visible = !0),
          (this.damageGraphic.alpha = (1 / 30) * (30 - a.health)))
        : (this.damageGraphic.visible = !1)
      : (this.damageGraphic.visible = !0);
  }
  setItemStatus(a, b) {
    a.primaryItem &&
      b.t === a.primaryItem.itemType &&
      (void 0 !== b.c
        ? (void 0 !== b.m ? this.ammoBar.setMaxValue(b.m) : this.ammoBar.setValue(0),
          this.ammoBar.setValue(b.c))
        : this.ammoBar.subtract());
  }
  registerKill() {}
  registerScore(a) {
    this.displayScoredBy(a);
    a.bot || this.leaderboard.updateClient({ sid: a.sid, points: 1, team: a.team });
  }
  registerDbRoundWin(a) {
    this.displayDbRoundWon(a);
    this.leaderboard.registerTeamPoint(a);
  }
  onGameobjectAdded() {}
  updateTeamStats(a) {
    a && this.leaderboard.updateTeamPoints(a.teams);
  }
  onModelState() {
    this.gameoverDisplay.x = 0.5 * (App.ClientWidth - this.gameoverDisplay.getWidth());
    this.gameoverDisplay.y = 4;
  }
  setGameoverState(a) {
    this.gameoverDisplay.visible ||
      (this.addChild(this.gameoverDisplay),
      (this.gameoverDisplay.visible = !0),
      (this.gameoverDisplay.isActive = !0));
    this.displayWeaponMenu(!1);
    this.gameoverDisplay.setContent(a);
  }
  setLeaderboard() {
    this.leaderboard.visible ||
      this.escapeMenu.parent ||
      (this.addChild(this.leaderboard),
      (this.leaderboard.visible = !0),
      this.leaderboard.validate());
    this.displayWeaponMenu(!1);
  }
  reset() {
    this.goldCount.setValue(0);
  }
  emptyLeaderboard() {
    this.leaderboard.reset();
    this.textBarInterval && clearInterval(this.textBarInterval);
  }
  setGameoverCount(a) {
    this.gameoverDisplay.updateCountdown(a);
  }
  setSpecMode() {
    this.damageGraphic.visible = !1;
    this.damageGraphic.alpha = 0;
    this.gameoverDisplay.visible &&
      (this.removeChild(this.gameoverDisplay),
      (this.gameoverDisplay.visible = !1),
      (this.gameoverDisplay.isActive = !1));
    this.leaderboard.visible &&
      (this.removeChild(this.leaderboard), (this.leaderboard.visible = !1));
  }
  setPlayMode() {
    this.gameoverDisplay.visible &&
      (this.removeChild(this.gameoverDisplay),
      (this.gameoverDisplay.visible = !1),
      (this.gameoverDisplay.isActive = !1));
    this.leaderboard.visible &&
      (this.removeChild(this.leaderboard), (this.leaderboard.visible = !1));
    this.weaponMenu.essentialItemSelected = !1;
    this.damageGraphic.visible = !0;
    this.damageGraphic.alpha = 0;
  }
  textBarMessage(a, b, c) {
    this.textBar.text = a;
    this.textBar.tint = b;
    this.textBar.x = 0.5 * (App.ClientWidth - this.textBar.width);
    this.showTextBar(this.cache[c]);
  }
  displayScoredBy(a) {
    let b = a.name + " scores for " + Team.Names[a.team] + " team!";
    this.textBar.tint = Team.HexColors[a.team];
    this.textBar.text = b;
    this.textBar.x = 0.5 * (App.ClientWidth - this.textBar.width);
    this.showTextBar(this.cache["flag_" + Team.Names[0 === a.team ? 1 : 0]]);
    this.actionTable.register(b);
  }
  displayDbRoundWon(a) {
    let b;
    -1 !== a
      ? ((b = Team.Names[a] + " team has won this round!"), (this.textBar.tint = Team.HexColors[a]))
      : ((b = "The rounded ended in a draw!"), (this.textBar.tint = 13421772));
    this.textBar.text = b;
    this.textBar.x = 0.5 * (App.ClientWidth - this.textBar.width);
    this.showTextBar();
    this.actionTable.register(b);
  }
  displayTeamKilledBy(a) {
    this.textBar.tint = 16711680;
    this.textBar.text = "Teamkilled by " + a.name;
    this.textBar.x = 0.5 * (App.ClientWidth - this.textBar.width);
    this.showTextBar();
  }
  displayTeamKilled(a) {
    this.textBar.tint = 16711680;
    this.textBar.text = "Warning! You teamkilled " + a.name;
    this.textBar.x = 0.5 * (App.ClientWidth - this.textBar.width);
    this.showTextBar();
  }
  displayKilledBy(a, b) {
    this.textBar.tint = 16711680;
    this.textBar.text = "Killed by " + (a.p.isBot ? "bot" : a.name);
    this.textBar.x = 0.5 * (App.ClientWidth - this.textBar.width);
    this.showTextBar(b);
  }
  displayKilled(a, b) {
    this.textBar.tint = 65280;
    this.textBar.text = "You killed " + a.name;
    this.textBar.x = 0.5 * (App.ClientWidth - this.textBar.width);
    this.showTextBar(b);
  }
  displaySuicide(a) {
    this.textBar.tint = 16711680;
    this.textBar.text = "You killed yourself!";
    this.textBar.x = 0.5 * (App.ClientWidth - this.textBar.width);
    this.showTextBar(a);
  }
  displayCombo(a) {
    let b = "";
    switch (a) {
      case PlayerEvent.DOUBLE:
        b = "Double kill!";
        break;
      case PlayerEvent.TRIPLE:
        b = "Triple kill!";
        break;
      case PlayerEvent.QUAD:
        b = "Quadruple kill!";
        break;
      case PlayerEvent.PENTA:
        b = "Penta kill!";
        break;
      case PlayerEvent.MEGA:
        b = "Mega kill!";
        break;
      case PlayerEvent.MONSTER:
        b = "Monster kill!";
        break;
      case PlayerEvent.GOD:
        b = "Godlike!";
    }
    this.comboBar.tint = 16711680;
    this.comboBar.text = b;
    this.comboBar.x = 0.5 * (App.ClientWidth - this.comboBar.width);
    this.comboBar.visible = !0;
    this.showTextBar(!1);
  }
  showTextBar(a) {
    this.textBar.visible = !0;
    this.textBarTimeout && clearTimeout(this.textBarTimeout);
    this.textBarInterval && clearInterval(this.textBarInterval);
    this.textBar.alpha = 1;
    this.comboBar.alpha = 1;
    this.textBarTimeout = setTimeout(() => this.hideTextBar(), 2500);
    this.textBar._icon &&
      !1 !== a &&
      (this.textBar.removeChild(this.textBar._icon), (this.textBar._icon = null));
    if (a) {
      let b = a.width,
        c = a.height,
        d = b >= c ? (30 < b ? 30 / b : 1) : 30 < c ? 30 / c : 1;
      b === c && (d = 1);
      a.scale.x = 2.4 * a.scale.x * d;
      a.scale.y = 2.4 * a.scale.y * d;
      a.anchor.x = 0.5;
      a.anchor.y = 0.5;
      a.rotation = 1.9 * Math.PI;
      a.x = 0.5 * this.textBar.width;
      a.y = 54;
      this.textBar._icon = a;
      this.textBar.addChild(a);
    }
  }
  hideTextBar() {
    this.textBarInterval && clearInterval(this.textBarInterval);
    this.textBar.alpha = 1;
    this.comboBar.alpha = 1;
    this.textBarInterval = setInterval(() => this._reduceTextBarAlpha(), 100);
  }
  _reduceTextBarAlpha() {
    0.1 >= this.textBar.alpha
      ? ((this.textBar.visible = !1),
        (this.textBar.alpha = 1),
        (this.comboBar.alpha = 1),
        (this.comboBar.visible = !1),
        clearInterval(this.textBarInterval))
      : ((this.textBar.alpha -= 0.1), (this.comboBar.alpha -= 0.1));
  }
  addClient(a) {
    this.leaderboard.addClient(a);
  }
  removeClient(a) {
    this.leaderboard.removeClient(a);
  }
  cleanup() {
    UserInput.removeListener(UserInput.KEY_DOWN, this.onKeyDownListener);
    UserInput.removeListener(UserInput.KEY_UP, this.onKeyUpListener);
    this.textBarInterval && clearInterval(this.textBarInterval);
    this.textBarTimeout && clearTimeout(this.textBarTimeout);
    this.weaponMenuTimeout && clearTimeout(this.weaponMenuTimeout);
    this.leaderboardUpdateInterval && clearInterval(this.leaderboardUpdateInterval);
  }
  onFocus() {
    1200 > App.ClientWidth && 1e3 <= App.ClientWidth
      ? ((this.actionTable.scale.x = 0.8),
        (this.actionTable.scale.y = 0.8),
        (this.leaderboard.scale.x = 0.8 * App.Scale),
        (this.leaderboard.scale.y = 0.8 * App.Scale),
        (this.comboBar.scale.x = 0.8),
        (this.comboBar.scale.y = 0.8),
        (this.textBar.scale.x = 0.8),
        (this.textBar.scale.y = 0.8),
        (this.escapeMenu.scale.x = 0.8 * App.Scale),
        (this.escapeMenu.scale.y = 0.8 * App.Scale),
        (App.Console.scale.x = 0.7),
        (App.Console.scale.y = 0.7),
        (this.weaponMenu.scale.x = this.weaponMenu.scale.y = 0.8 * App.Scale),
        (this.healthBar.scale.x = this.healthBar.scale.y = 0.6),
        (this.ammoBar.scale.x = this.ammoBar.scale.y = 0.6),
        (this.jetBar.scale.x = this.jetBar.scale.y = 0.6),
        (this.goldCount.scale.x = this.goldCount.scale.y = 0.6),
        (this.textBar.y = App.ClientHeight - 120),
        (this.healthBar.y = App.ClientHeight - 26),
        (this.ammoBar.y = App.ClientHeight - 26),
        (this.jetBar.y = App.ClientHeight - 26),
        (this.goldCount.y = App.ClientHeight - 26))
      : 1e3 > App.ClientWidth
      ? ((this.actionTable.scale.x = 0.74),
        (this.actionTable.scale.y = 0.74),
        (this.leaderboard.scale.x = 0.74 * App.Scale),
        (this.leaderboard.scale.y = 0.74 * App.Scale),
        (this.comboBar.scale.x = 0.74),
        (this.comboBar.scale.y = 0.74),
        (this.textBar.scale.x = 0.74),
        (this.textBar.scale.y = 0.74),
        (this.escapeMenu.scale.x = 0.74 * App.Scale),
        (this.escapeMenu.scale.y = 0.74 * App.Scale),
        (App.Console.scale.x = 0.64),
        (App.Console.scale.y = 0.64),
        (this.weaponMenu.scale.x = this.weaponMenu.scale.y = 0.74 * App.Scale),
        (this.healthBar.scale.x = this.healthBar.scale.y = 0.45),
        (this.ammoBar.scale.x = this.ammoBar.scale.y = 0.45),
        (this.jetBar.scale.x = this.jetBar.scale.y = 0.45),
        (this.goldCount.scale.x = this.goldCount.scale.y = 0.45),
        (this.textBar.y = App.ClientHeight - 100),
        (this.healthBar.y = App.ClientHeight - 20),
        (this.ammoBar.y = App.ClientHeight - 20),
        (this.jetBar.y = App.ClientHeight - 20),
        (this.goldCount.y = App.ClientHeight - 20))
      : ((this.actionTable.scale.x = 1),
        (this.actionTable.scale.y = 1),
        (this.leaderboard.scale.x = 1 * App.Scale),
        (this.leaderboard.scale.y = 1 * App.Scale),
        (this.comboBar.scale.x = 1),
        (this.comboBar.scale.y = 1),
        (this.textBar.scale.x = 1),
        (this.textBar.scale.y = 1),
        (this.escapeMenu.scale.x = 1 * App.Scale),
        (this.escapeMenu.scale.y = 1 * App.Scale),
        (App.Console.scale.x = 1),
        (App.Console.scale.y = 1),
        (this.weaponMenu.scale.x = this.weaponMenu.scale.y = 1 * App.Scale),
        (this.healthBar.scale.x = this.healthBar.scale.y = 0.6),
        (this.ammoBar.scale.x = this.ammoBar.scale.y = 0.6),
        (this.jetBar.scale.x = this.jetBar.scale.y = 0.6),
        (this.goldCount.scale.x = this.goldCount.scale.y = 0.6),
        (this.textBar.y = App.ClientHeight - 170),
        (this.healthBar.y = App.ClientHeight - 32),
        (this.ammoBar.y = App.ClientHeight - 32),
        (this.jetBar.y = App.ClientHeight - 32),
        (this.goldCount.y = App.ClientHeight - 32));
    this.helpImage.scale.x = App.Scale;
    this.helpImage.scale.y = App.Scale;
    this.damageGraphic.width = App.ClientWidth;
    this.damageGraphic.height = App.ClientHeight;
    this.actionTable.x = App.ClientWidth - this.actionTable.getWidth() - 12;
    this.gameoverDisplay.x = 0.5 * (App.ClientWidth - this.gameoverDisplay.getWidth());
    this.weaponMenu.x = 0.5 * (App.ClientWidth - this.weaponMenu.width);
    this.weaponMenu.y = 0.5 * (App.ClientHeight - this.weaponMenu.height);
    this.comboBar.x = 0.5 * (App.ClientWidth - this.comboBar.width);
    this.comboBar.y = App.ClientHeight - 90;
    this.textBar.x = 0.5 * (App.ClientWidth - this.textBar.width);
    this.leaderboard.x = 0.5 * (App.ClientWidth - this.leaderboard.width) + 40;
    this.leaderboard.y = 0.45 * (App.ClientHeight - this.leaderboard.height);
    this.actionTable.x =
      App.ClientWidth - this.actionTable.getWidth() * this.actionTable.scale.x - 12;
    this.escapeMenu.x = 0.5 * (App.ClientWidth - this.escapeMenu.width);
    this.escapeMenu.y = 0.5 * (App.ClientHeight - this.escapeMenu.height);
    this.healthBar.x = 20;
    this.jetBar.x = this.healthBar.x + this.healthBar.width + 20;
    this.ammoBar.x = this.jetBar.x + this.jetBar.width + 20;
    this.goldCount.x = this.ammoBar.x + this.ammoBar.width + 20;
    this.helpImage &&
      ((this.helpImage.x = 0.5 * App.ClientWidth), (this.helpImage.y = 0.5 * App.ClientHeight));
  }
  onUpdateEnvironment(a) {
    a.settings && this.jetBar.setMaxValue(a.settings.energy);
  }
}
function HudEvent(a, b) {
  CustomEvent.call(this, a, b);
}
HudEvent.SELECT_ITEM = "selectItem";
HudEvent.CHANGE_KEYBOARD_LAYOUT = "changeKeyboardLayout";
HudEvent.MUTE_SOUND = "muteSound";
HudEvent.EXIT = "exit";
HudEvent.LEADERBOARD_UPDATE = "leaderboardUpdate";
HudEvent.DISPLAY_PROFILE = "displayProfile";
HudEvent.CLOSE_WEAPON_MENU = "closeWeaponMenu";
class JetBar extends PIXI.Container {
  constructor() {
    super();
    EventDispatcher.call(this);
    this.barWidth = 262;
    this.barHeight = 36;
    this.maxValue = JetBar.MAX_VALUE;
    this.healthIcon = new PIXI.Sprite(App.CombinedTextures.energy_icon);
    this.healthIcon.x = 6;
    this.healthIcon.y = 2;
    this.addChild(this.healthIcon);
    this.background = new PIXI.Graphics();
    this.background.beginFill(3355443, 0.1);
    this.background.drawRect(0, 0, this.barWidth, this.barHeight);
    this.background.endFill();
    this.bar = new PIXI.Container();
    this.addChild(this.background);
    this.addChild(this.bar);
    this.numElements = 10;
    this.elements = [];
    for (var a = 0; a < this.numElements; a++) {
      var b = new PIXI.Sprite(App.CombinedTextures.jet_bar_element);
      b.x = 42 + 20 * a;
      b.y = 2;
      this.elements.push(b);
      this.bar.addChild(b);
    }
    this.margin = 4;
  }
  setValue(a) {
    this.value = a;
    this.update();
  }
  getValue() {
    return this.value;
  }
  setMaxValue(a) {
    this.maxValue = a;
    this.setValue(this.maxValue);
  }
  update() {
    let a = Math.ceil((this.numElements / this.maxValue) * this.value);
    for (let b = 0; b < this.numElements; b++) this.elements[b].alpha = b < a ? 1 : 0.2;
  }
  getWidth() {
    return this.barWidth;
  }
  getHeight() {
    return this.barHeight;
  }
}
JetBar.MAX_VALUE = 200;
class Minimap extends PIXI.Container {
  constructor() {
    super();
  }
  addObject(a) {}
}
class WeaponMenu extends PIXI.Graphics {
  constructor() {
    super();
    this.isEmpty = !0;
    this.beginFill(0, 0.3);
    this.lineStyle(3, 3355443, 1, 2);
    this.drawRect(0, 0, 510, 480);
    this.endFill();
    this.primaryTitle = new PIXI.Text("Primary weapons", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16755200,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.primaryTitle.x = 26;
    this.primaryTitle.y = 16;
    this.primaryTitle.resolution = 1.5;
    this.addChild(this.primaryTitle);
    this.secondaryTitle = new PIXI.Text("Secondary weapons", {
      fontName: "Arial",
      fontSize: 22,
      fill: 16755200,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.secondaryTitle.x = 26;
    this.secondaryTitle.y = 290;
    this.secondaryTitle.resolution = 1.5;
    this.addChild(this.secondaryTitle);
    this.closeButton = new PIXI.Sprite(App.CombinedTextures.exit);
    this.closeButton.x = this.width - 52;
    this.closeButton.y = 10;
    this.closeButton.interactive = !0;
    this.closeButton.on("mouseover", () => AudioEffects.ButtonHover.audio.play());
    this.closeButton.on("mousedown", () => {
      AudioEffects.ButtonClick.audio.play();
      this.emit(HudEvent.CLOSE_WEAPON_MENU);
    });
    this.closeButton.on("touchstart", () => {
      AudioEffects.ButtonClick.audio.play();
      this.emit(HudEvent.CLOSE_WEAPON_MENU);
    });
    this.addChild(this.closeButton);
    this.primaryItems = {};
    this.interactive = !0;
    this.essentialItemSelected = !1;
    this.primaryItemId = null;
    this.disabledCount = this.secondaryCount = this.primaryCount = 0;
    this.secondaryItems = {};
    this.secondaryItemSelected = !1;
    this.secondaryItemId = null;
    this.on("touchstart", (c) => c.stopPropagation());
    this.on("mousedown", (c) => c.stopPropagation());
    this.adblockEnabled = !0;
    App.WhiteLabel === App.WhiteLabel_NONE || App.AdblockDetected || (this.adblockEnabled = !1);
    if (this.adblockEnabled) {
      this.adblockTitle = new PIXI.Text("- Disable AdBlock to access all weapons -", {
        fontName: "Arial",
        fontSize: 22,
        fill: 16733440,
        strokeThickness: 3,
        lineJoin: "round",
      });
      this.adblockTitle.resolution = 1.5 * App.DevicePixelRatio;
      this.adblockTitle.x = 0.5 * (this.width - this.adblockTitle.width);
      this.adblockTitle.y = -24;
      this.addChild(this.adblockTitle);
      let c = Math.round(Date.now() / 6e5);
      var a = navigator.language || navigator.userLanguage,
        b = new Date().getTimezoneOffset() / 60;
      a += b.toString();
      for (b = 0; b < a.length; b++) c += a.charCodeAt(b);
      xorshift128_seed(c);
    }
  }
  addItem(a) {
    this.isEmpty = !1;
    let b = ItemMap[a].equip,
      c = new WeaponButton(a, b),
      d = { type: a, sprite: c, equip: b };
    c.on("touchstart", () => {
      c.enabled &&
        (this.emit(HudEvent.SELECT_ITEM, { itemId: a, equip: b }), this.selectItem(b, a));
    });
    c.on("mousedown", () => {
      c.enabled &&
        (this.emit(HudEvent.SELECT_ITEM, { itemId: a, equip: b }), this.selectItem(b, a));
    });
    b === ItemMap.Equip.PRIMARY
      ? ((this.primaryItems[d.type] = d), this.primaryCount++)
      : ((this.secondaryItems[d.type] = d), this.secondaryCount++);
  }
  rearrange() {
    var a = 0,
      b = 0;
    for (var c in this.primaryItems)
      this.primaryItems[c].parent && this.removeChild(this.primaryItems[c]);
    for (let d in this.secondaryItems)
      this.secondaryItems[d].parent && this.removeChild(this.secondaryItems[d]);
    for (let d in this.primaryItems)
      (c = this.primaryItems[d]),
        this.adblockEnabled &&
          this.disabledCount < this.primaryCount - 1 &&
          ((c.enabled = 1 === xorshift128() % 3),
          c.enabled || (this.disabledCount++, (c.sprite.enabled = !1), (c.sprite.alpha = 0.3))),
        this.addChild(c.sprite),
        (c.sprite.x = a + 50),
        (c.sprite.y = b + 75),
        (a += 96),
        480 <= a && ((a = 0), (b += 76));
    this.essentialItemSelected = !1;
    a = 0;
    for (let d in this.secondaryItems)
      (b = this.secondaryItems[d]),
        this.addChild(b.sprite),
        (b.sprite.x = ((96 * a) % 480) + 50),
        (b.sprite.y = 76 * Math.floor((a + 1) / 6) + 345),
        a++;
    this.secondaryItemSelected = !1;
  }
  selectItem(a, b) {
    AudioEffects.ButtonClick.audio.play();
    if (a === ItemMap.Equip.PRIMARY) {
      for (var c in this.primaryItems) {
        var d = this.primaryItems[c];
        c === b ? d.sprite.select() : d.sprite.deselect();
      }
      setTimeout(() => {
        this.visible = App.UIVisible = !1;
        this.parent && this.parent.removeChild(this);
      }, 100);
      this.essentialItemSelected = !0;
      this.primaryItemId = b;
    } else {
      for (d in this.secondaryItems)
        (c = this.secondaryItems[d]), d === b ? c.sprite.select() : c.sprite.deselect();
      this.essentialItemSelected &&
        setTimeout(() => {
          this.visible = App.UIVisible = !1;
          this.parent && this.parent.removeChild(this);
        }, 100);
      this.secondaryItemSelected = !0;
      this.secondaryItemId = b;
      0 === this.primaryCount &&
        setTimeout(() => {
          this.visible = App.UIVisible = !1;
          this.parent && this.parent.removeChild(this);
        }, 100);
    }
    0 === this.primaryCount && (this.essentialItemSelected = !0);
  }
}
class WeaponButton extends PIXI.Container {
  constructor(a, b) {
    super();
    this.itemId = a;
    this.equip = b;
    this.hover = !1;
    this.graphics = new PIXI.Graphics();
    this.graphics.beginFill(this.equip === ItemMap.Equip.SECONDARY ? 16763904 : 16777215, 0.4);
    this.graphics.drawRect(0, 0, 90, 70, 5);
    this.graphics.x = -30;
    this.graphics.y = -20;
    this.graphics.alpha = 0.5;
    this.addChild(this.graphics);
    this.lineGraphic = new PIXI.Graphics();
    this.lineGraphic.lineStyle(2, 16777215, 1);
    this.lineGraphic.drawRect(0, 0, 90, 70, 5);
    this.lineGraphic.x = -30;
    this.lineGraphic.y = -20;
    this.lineGraphic.alpha = 0.4;
    this.equip === ItemMap.Equip.SECONDARY && (this.lineGraphic.tint = 16763904);
    this.icon = new SpriteMap[a]();
    b = this.icon.width;
    let c = this.icon.height,
      d = b >= c ? (60 < b ? 60 / b : 1) : 40 < c ? 40 / c : 1;
    b === c && (d = 0.4);
    this.initialScale = 1.4 * d;
    this.icon.rotation = 0;
    this.icon.anchor.x = this.icon.anchor.y = 0;
    this.icon.scale.x = this.icon.scale.y = this.initialScale;
    this.icon.x = 0.5 * (60 - this.icon.width) - 16;
    this.icon.y = 15;
    this.icon.rotation = -0.2;
    this.addChild(this.icon);
    this.selected = !1;
    this.title = new PIXI.Text(ItemMap[a].title, {
      fontName: "Arial",
      fontSize: 16,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.title.resolution = 1.5 * App.DevicePixelRatio;
    this.title.x = -24;
    this.title.y = -18;
    this.addChild(this.title);
    82 < this.title.width && (this.title.scale.x = this.title.scale.y = 82 / this.title.width);
    this.enabled = this.interactive = !0;
    this.on("mouseover", (e) => this.onMouseOver(e));
    this.on("mouseout", (e) => this.onMouseOut(e));
  }
  onMouseOver(a) {
    this.addChildAt(this.lineGraphic, 1);
    this.lineGraphic.alpha = this.selected ? 0.7 : 0.4;
    this.graphics.alpha = 1;
    this.hover = !0;
    this.equip === ItemMap.Equip.SECONDARY && (this.graphics.tint = 16763904);
    this.scale.x = this.scale.y = 1.3;
    this.parent.setChildIndex(this, this.parent.children.length - 1);
    AudioEffects.ButtonHover.audio.play();
  }
  onMouseOut() {
    this.hover = !1;
    this.selected ? this.select() : (this.deselect(), (this.graphics.tint = 16777215));
    this.scale.x = this.scale.y = 1;
  }
  select() {
    this.selected = !0;
    this.graphics.alpha = 1;
    this.hover && (this.lineGraphic.alpha = 0.7);
  }
  deselect() {
    this.selected = !1;
    this.graphics.alpha = 0.5;
    this.hover ? (this.lineGraphic.alpha = 0.6) : (this.graphics.tint = 16777215);
    this.lineGraphic.parent && this.removeChild(this.lineGraphic);
  }
}
var gamemodes = {},
  GAME_MODES = {
    DEATHMATCH: "deathmatch",
    TEAM_DEATHMATCH: "teamDeathmatch",
    CAPTURE_THE_FLAG: "captureTheFlag",
    DODGEBALL: "dodgeball",
  };
var agent = {};
class Agent extends GameObject {
  constructor(a, b, c, d, e) {
    super({ id: a, p: { x: 0, y: 0, r: 0, vx: 0, vy: 0 } });
    this.visual = new PIXI.Container();
    this.animations = { _: !1 };
    this.prevFacing = this.facing = 0;
    this.health = 1;
    this.alive = !0;
    this.name = b;
    this.team = void 0 !== c ? c : -1;
    this.level = d;
    this.customization = e;
    this.onJet =
      this.onRequestHideChatBubble =
      this.onRequestDisplayChatBubble =
      this.onRequestRemoveEmitter =
      this.onRequestCreateEmitter =
      this.onRequestCreateEffect =
      this.onRequestCreateRope =
      this.extraRope =
      this.extra =
      this.bandana =
      this.face =
      this.energy =
      this.killObject =
        null;
    this.stateChangeMap = {
      [StateChange.Agent.ALIVE]: (f) => this.setAlive(f),
      [StateChange.Agent.TELEPORT]: (f) => this.teleport(f),
      [StateChange.Agent.JET_START]: () => this.startJetting(),
      [StateChange.Agent.JET_STOP]: () => this.stopJetting(),
      [StateChange.Agent.HEALTH]: (f) => this.setHealth(f),
      [StateChange.Item.RELOAD]: () => {},
      [StateChange.Item.EQUIP]: (f) => this.equip(f.t),
      [StateChange.Item.CARRY_PRIMARY]: (f) => this.carryPrimary(f.t),
      [StateChange.Item.CARRY_SECONDARY]: (f) => this.carrySecondary(f.t),
      [StateChange.Item.CARRY_BELT]: (f) => this.carryBelt(f.t),
      [StateChange.Item.DROP]: (f) => this.drop(f.t),
      [StateChange.Item.REMOVE_PRIMARY]: (f) => this.removePrimary(f),
      [StateChange.Item.REMOVE_SECONDARY]: (f) => this.removeSecondary(f),
      [StateChange.Item.REMOVE_BELT]: (f) => this.removBelt(f),
    };
  }
  init() {
    let a = 16777215,
      b = "energy_shell",
      c = "energy_trail_electric",
      d = Energy;
    this.customization &&
      (void 0 !== this.customization.orb &&
        (this.customization.orb.data &&
          void 0 !== this.customization.orb.data.energy &&
          (a = this.customization.orb.data.energy),
        this.customization.orb.cdata && void 0 !== this.customization.orb.cdata.custom
          ? ((d = Energy.Map[this.customization.orb.cdata.custom]),
            (b = "energy_shell_" + this.customization.orb.texture))
          : ((b = "energy_shell_" + this.customization.orb.texture),
            (c = "energy_trail_" + this.customization.orb.cdata.trail))),
      void 0 !== this.customization.face &&
        this.customization.face.cdata &&
        void 0 !== this.customization.face.cdata.custom &&
        (this.face = new CustomFace.Map[this.customization.face.cdata.custom](this)),
      void 0 !== this.customization.extra &&
        this.customization.extra.cdata &&
        void 0 !== this.customization.extra.cdata.custom &&
        (this.extra = Extra.Map[this.customization.extra.cdata.custom]));
    this.energy = new d(this, b, c, a);
  }
  applyState(a) {
    let b = this.stateChangeMap[a.s];
    return b ? b(a) : null;
  }
  setAnimations(a) {
    if (void 0 !== this.animations[Animation.CHAT]) {
      if (void 0 === a[Animation.CHAT]) this.onRequestHideChatBubble();
    } else if (void 0 !== a[Animation.CHAT]) this.onRequestDisplayChatBubble();
    this.animations = a;
    this.animations._ = !0;
  }
  equip(a) {}
  carryPrimary(a) {}
  carrySecondary(a) {}
  carryBelt(a) {}
  removePrimary(a) {}
  removeSecondary(a) {}
  removeBelt(a) {}
  drop(a) {}
  onSpawn() {
    null !== this.extra &&
      this.extra.prototype instanceof FastRope &&
      (this.extraRope = this.onRequestCreateRope(this, this.extra, this.torsoupper.id));
    ParticleEffects.BandanaRope.tex = "bandana_team_" + Team.Names[this.team];
    this.bandana = this.onRequestCreateRope(this, BandanaRope);
    null !== this.face &&
      (this.head.visual.addChild(this.face), this.addEmitter(this.face.emitter));
  }
  onDissolve() {
    this.bandana.alphaDrop = 0.01;
    this.bandana.ttl = 100;
    null !== this.extraRope && ((this.extraRope.ttl = 100), (this.extraRope.alphaDrop = 0.01));
  }
  update() {
    this.jetting && this.energy.update(this.torsolower.p);
    this.face && this.face.update(this.head.p);
  }
  setHealth(a) {
    this.health = a.v;
    a.exp && this.addInjury();
  }
  setAlive(a) {
    this.killObject = a.bid;
    0 === a.v ? ((this.alive = !1), (this.health = 0)) : (this.alive = !0);
    return { i: a.id };
  }
  startJetting() {
    this.addEmitter(this.energy.emitter);
    this.jetting = !0;
    this.visual && !this.energy.parent && this.visual.parent.addChild(this.energy);
  }
  stopJetting() {
    this.jetting && this.removeEmitter(this.energy.emitter);
    this.jetting = !1;
    this.visual && this.energy.parent && this.visual.parent.removeChild(this.energy);
  }
  teleport(a) {
    var b = new ParticleEmitter(this.torsolower, [ParticleEffects.EnergyTrail]);
    b.frequency = 1;
    b.ttl = 100;
    this.onRequestCreateEmitter(b);
    b = new ParticleEmitter(a.from, [ParticleEffects.EnergyTrail]);
    b.frequency = 1;
    b.ttl = 100;
    this.onRequestCreateEmitter(b);
    a = new ParticleEmitter(a.to, [ParticleEffects.EnergyTrail]);
    a.frequency = 1;
    a.ttl = 100;
    this.onRequestCreateEmitter(a);
  }
  addEmitter(a) {
    if (this.onRequestCreateEmitter)
      if (Array.isArray(a)) for (let b = 0; b < a.length; b++) this.onRequestCreateEmitter(a[b]);
      else this.onRequestCreateEmitter(a);
  }
  removeEmitter(a) {
    if (this.onRequestRemoveEmitter)
      if (Array.isArray(a)) for (let b = 0; b < a.length; b++) this.onRequestRemoveEmitter(a[b]);
      else this.onRequestRemoveEmitter(a);
  }
}
var gameattribute = {};
function GameAttribute() {
  this.type = 0;
}
GameAttribute.SPAWN_PLAYER = 1;
GameAttribute.EMITTER = 2;
GameAttribute.BOUNDARY = 3;
GameAttribute.LETHAL = 4;
GameAttribute.DAMAGE = 5;
GameAttribute.HEAL = 6;
GameAttribute.ITEM = 7;
GameAttribute.REVOLUTE_JOINT = 8;
GameAttribute.WELD_JOINT = 9;
GameAttribute.GRAVITY_SCALE = 10;
GameAttribute.FLAG = 11;
GameAttribute.ACCELERATOR = 12;
GameAttribute.TELEPORT = 13;
GameAttribute.ANIMATION = 14;
GameAttribute.WAYPOINT = 15;
GameAttribute.INSERTION = 16;
GameAttribute.LABEL = 17;
GameAttribute.IMMORTAL = 18;
GameAttribute.FLUID = 19;
GameAttribute.TRANSFORM = 20;
GameAttribute.UV_TRANSLATE = 21;
GameAttribute.UV_ROTATE = 22;
GameAttribute.SPAWN_BOT = 23;
GameAttribute.prototype.copyState = function (a) {
  void 0 !== a.type && (this.type = a.type);
};
GameAttribute.T_TRANSFORM = 1;
GameAttribute.T_FLUID = 2;
GameAttribute.T_UV_ROTATE = 4;
GameAttribute.T_UV_TRANSLATE = 8;
function Gold(a) {
  this.id = a.id;
  this.prefab = PrefabList.Gold;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: 1e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    contact: [this.id],
    gs: 0.3,
    wd: 4,
    bu: -5,
    sh: [
      {
        t: GameShape.RECTANGLE,
        c: EntityCategory.ITEM,
        w: 4,
        h: 4,
        fr: 0.9,
        re: 2e-4,
        s: !1,
        d: 1,
      },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.Gold,
    onAdd: [],
    onRemove: [ParticleEffects.GoldPickupParticles],
    emitters: [
      new ParticleEmitter(null, [ParticleEffects.Glitter], { x: 0, y: 0 }, 4, 0, -1, 0.2, 8, 8),
      new ParticleEmitter(null, [ParticleEffects.GlitterTail], { x: 0, y: 0 }, 2, 0, -1, 1, 8, 8),
    ],
    animate: !0,
  };
  this.audio = Gold.Audio;
}
Gold.Audio = {
  onAdded: [AudioEffects.GoldPickup],
  onRemove: [AudioEffects.GoldPickup],
  onContact: [AudioEffects.GoldDrop],
};
function Bouncyball(a) {
  this.id = a.id;
  this.prefab = PrefabList.Bouncyball;
  this.p = {
    contact: [this.id],
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    fixedRotation: !1,
    sleepingAllowed: !0,
    wd: 5,
    bu: 20,
    sh: [
      {
        t: GameShape.CIRCLE,
        c: EntityCategory.ITEM,
        radius: 10.125,
        fr: 0.5,
        re: 0.7,
        s: !1,
        d: 0.3,
      },
    ],
  };
  a.p &&
    (a.p.x && (this.p.x = a.p.x),
    a.p.y && (this.p.y = a.p.y),
    a.p.vx && (this.p.vx = a.p.vx),
    a.p.vy && (this.p.vy = a.p.vy),
    a.p.gi && (this.p.gi = a.p.gi));
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.Bouncyball,
    scale: { x: 0.34 * (a.l ? -1 : 1), y: 0.34 },
    offset: { x: 0.5, y: 0.5 },
    emitters: [],
  };
  this.audio = Bouncyball.Audio;
}
Bouncyball.Audio = { onContact: [AudioEffects.BallBounce] };
var flag = {};
function Flag(a) {
  this.id = a.id;
  this.prefab = PrefabList.Flag;
  this.team = a.team;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: -1,
    ld: 1,
    ad: 3,
    sh: Flag.Shapes,
    gs: 0.6,
    noCache: !0,
  };
  a.p &&
    (a.p.x && (this.p.x = a.p.x),
    a.p.y && (this.p.y = a.p.y),
    a.p.vx && (this.p.vx = a.p.vx),
    a.p.vy && (this.p.vy = a.p.vy),
    a.p.gi && (this.p.gi = a.p.gi));
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.Flag,
    team: this.team,
    scale: { x: 0.25, y: 0.25 },
    offset: { x: 0.5, y: 0.5 },
    emitters: [new ParticleEmitter(null, [ParticleEffects.Flag1], { x: 0, y: 22 }, 4, 0, -1, 1)],
    z: 1,
    animate: !0,
  };
}
Flag.Sprites = Flag.Shapes = [
  {
    t: GameShape.RECTANGLE,
    c: EntityCategory.OBJECTIVE,
    radius: 20,
    w: 3,
    h: 20,
    fr: 0.1,
    re: 0.8,
    s: !1,
    d: 0.01,
  },
  {
    t: GameShape.CIRCLE,
    c: EntityCategory.OBJECTIVE,
    radius: 12,
    fr: 0.1,
    re: 0.8,
    s: !1,
    d: 0.01,
    o: { x: 0, y: 17 },
  },
  {
    t: GameShape.CIRCLE,
    c: EntityCategory.OBJECTIVE,
    radius: 3,
    fr: 0.1,
    re: 0.8,
    s: !1,
    d: 1,
    o: { x: 0, y: 25 },
  },
  {
    t: GameShape.CIRCLE,
    c: EntityCategory.ZONE,
    radius: 35,
    fr: 0.1,
    re: 0.6,
    s: !1,
    d: 1e-4,
    o: { x: 0, y: 0 },
  },
];
function AK47Ammo(a) {
  this.id = a.id;
  this.prefab = PrefabList.AK47Ammo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 8, h: 6, fr: 0.9, re: 0.2, s: !1, d: 2 },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.AK47Ammo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = AK47Ammo.Audio;
}
AK47Ammo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function BarrettAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.BarrettAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.RECTANGLE,
        c: EntityCategory.ITEM,
        w: 10,
        h: 6,
        fr: 0.9,
        re: 0.2,
        s: !1,
        d: 2,
      },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.BarrettAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = BarrettAmmo.Audio;
}
BarrettAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function ChainsawAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.ChainsawAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.RECTANGLE,
        c: EntityCategory.ITEM,
        w: 7,
        h: 10,
        fr: 0.9,
        re: 0.2,
        s: !1,
        d: 2,
      },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.ChainsawAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = ChainsawAmmo.Audio;
}
ChainsawAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function ClusterNadeBox(a) {
  this.id = a.id;
  this.prefab = PrefabList.ClusterNadeBox;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.RECTANGLE,
        c: EntityCategory.ITEM,
        w: 10,
        h: 10,
        fr: 0.5,
        re: 0.6,
        s: !1,
        d: 0.5,
      },
    ],
    wd: 10,
    bu: -1,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.ClusterNadeBox,
    onAdd: [ParticleEffects.ItemSpawnParticles],
    onRemove: [ParticleEffects.ClusterNadeParticles],
    animate: !0,
  };
  this.audio = ClusterNadeBox.Audio;
}
ClusterNadeBox.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.Powerup] };
function DesertEagleAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.DesertEagleAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 8, h: 6, fr: 0.9, re: 0.2, s: !1, d: 2 },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.DesertEagleAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = DesertEagleAmmo.Audio;
}
DesertEagleAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function FlameThrowerAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.FlameThrowerAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.RECTANGLE,
        c: EntityCategory.ITEM,
        w: 7,
        h: 11,
        fr: 0.9,
        re: 0.2,
        s: !1,
        d: 2,
      },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.FlameThrowerAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = FlameThrowerAmmo.Audio;
}
FlameThrowerAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function HealthBox(a) {
  this.id = a.id;
  this.prefab = PrefabList.HealthBox;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.RECTANGLE,
        c: EntityCategory.ITEM,
        w: 10,
        h: 10,
        fr: 0.5,
        re: 0.6,
        s: !1,
        d: 0.5,
      },
    ],
    wd: 10,
    bu: -1,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.HealthBox,
    onAdd: [ParticleEffects.ItemSpawnParticles],
    onRemove: [ParticleEffects.HealParticles],
    animate: !0,
  };
  this.audio = HealthBox.Audio;
}
HealthBox.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.Powerup] };
function LaserGunAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.LaserGunAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 9, h: 6, fr: 0.9, re: 0.2, s: !1, d: 2 },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.LaserGunAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = LaserGunAmmo.Audio;
}
LaserGunAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function LinkGunAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.LinkGunAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.RECTANGLE,
        c: EntityCategory.ITEM,
        w: 9.5,
        h: 7.5,
        fr: 0.9,
        re: 0.2,
        s: !1,
        d: 2,
      },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.LinkGunAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = LinkGunAmmo.Audio;
}
LinkGunAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function MAC10Ammo(a) {
  this.id = a.id;
  this.prefab = PrefabList.MAC10Ammo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 5, h: 8, fr: 0.9, re: 0.2, s: !1, d: 2 },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.MAC10Ammo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = MAC10Ammo.Audio;
}
MAC10Ammo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function MinigunAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.MinigunAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.RECTANGLE,
        c: EntityCategory.ITEM,
        w: 10,
        h: 8,
        fr: 0.9,
        re: 0.2,
        s: !1,
        d: 2,
      },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.MinigunAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = MinigunAmmo.Audio;
}
MinigunAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function NadeBox(a) {
  this.id = a.id;
  this.prefab = PrefabList.NadeBox;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.RECTANGLE,
        c: EntityCategory.ITEM,
        w: 10,
        h: 10,
        fr: 0.5,
        re: 0.6,
        s: !1,
        d: 0.5,
      },
    ],
    wd: 10,
    bu: -1,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.NadeBox,
    onAdd: [ParticleEffects.ItemSpawnParticles],
    onRemove: [ParticleEffects.NadeParticles],
    animate: !0,
  };
  this.audio = NadeBox.Audio;
}
NadeBox.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.Powerup] };
function NadeLauncherAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.NadeLauncherAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 8, h: 6, fr: 0.9, re: 0.2, s: !1, d: 2 },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.NadeLauncherAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = NadeLauncherAmmo.Audio;
}
NadeLauncherAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function PulseGunAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.PulseGunAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 8, h: 5, fr: 0.9, re: 0.2, s: !1, d: 2 },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.PulseGunAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = PulseGunAmmo.Audio;
}
PulseGunAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function RifleAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.RifleAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 9, h: 7, fr: 0.9, re: 0.2, s: !1, d: 2 },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.RifleAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = RifleAmmo.Audio;
}
RifleAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function RPGAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.RPGAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.RECTANGLE,
        c: EntityCategory.ITEM,
        w: 16,
        h: 6,
        fr: 0.9,
        re: 0.2,
        s: !1,
        d: 2,
      },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.RPGAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = RPGAmmo.Audio;
}
RPGAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function ShockRifleAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.ShockRifleAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.RECTANGLE,
        c: EntityCategory.ITEM,
        w: 10,
        h: 5,
        fr: 0.9,
        re: 0.2,
        s: !1,
        d: 2,
      },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.ShockRifleAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = ShockRifleAmmo.Audio;
}
ShockRifleAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function ShotgunAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.ShotgunAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 8, h: 6, fr: 0.9, re: 0.2, s: !1, d: 2 },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.ShotgunAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = ShotgunAmmo.Audio;
}
ShotgunAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function ShurikenBox(a) {
  this.id = a.id;
  this.prefab = PrefabList.ShurikenBox;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.POLYGON,
        c: EntityCategory.ITEM,
        v: [
          { x: -9, y: 9 },
          { x: 9, y: 9 },
          { x: 0, y: -9 },
        ],
        d: 0.5,
        fr: 0.5,
        re: 0.6,
        s: !1,
      },
    ],
    wd: 10,
    bu: -1,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.ShurikenBox,
    onAdd: [ParticleEffects.ItemSpawnParticles],
    onRemove: [ParticleEffects.GoldPickupParticles],
    animate: !0,
  };
  this.audio = ShurikenBox.Audio;
}
ShurikenBox.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.Powerup] };
function SMGAmmo(a) {
  this.id = a.id;
  this.prefab = PrefabList.SMGAmmo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 8, h: 8, fr: 0.9, re: 0.2, s: !1, d: 2 },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.SMGAmmo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = SMGAmmo.Audio;
}
SMGAmmo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function SnowballBox(a) {
  this.id = a.id;
  this.prefab = PrefabList.SnowballBox;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      {
        t: GameShape.POLYGON,
        c: EntityCategory.ITEM,
        v: [
          { x: -10, y: 10 },
          { x: 10, y: 10 },
          { x: 0, y: -10 },
        ],
        fr: 0.5,
        re: 0.6,
        s: !1,
        d: 0.5,
      },
    ],
    wd: 10,
    bu: -1,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.SnowballBox,
    onAdd: [ParticleEffects.ItemSpawnParticles],
    onRemove: [ParticleEffects.ItemSpawnParticles],
    animate: !0,
  };
  this.audio = SnowballBox.Audio;
}
SnowballBox.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.Powerup] };
function X75Ammo(a) {
  this.id = a.id;
  this.prefab = PrefabList.X75Ammo;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 5e3,
    fixedRotation: !1,
    sleepingAllowed: !0,
    sh: [
      { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 8, h: 6, fr: 0.9, re: 0.2, s: !1, d: 2 },
    ],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.X75Ammo,
    onAdd: [],
    onRemove: [ParticleEffects.AmmoPickupParticles],
    animate: !0,
  };
  this.audio = X75Ammo.Audio;
}
X75Ammo.Audio = { onAdded: [AudioEffects.ItemSpawn], onRemove: [AudioEffects.AmmoPickup] };
function AK47(a) {
  this.id = a.id;
  this.prefab = PrefabList.AK47;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: AK47.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.AK47,
    scale: { x: 0.18 * (a.l ? -1 : 1), y: 0.2 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = AK47.Audio;
}
AK47.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 18, h: 3, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
AK47.Audio = { onContact: [AudioEffects.Tap] };
function Barrett(a) {
  this.id = a.id;
  this.prefab = PrefabList.Barrett;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: Barrett.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.Barrett,
    scale: { x: 0.13 * (a.l ? -1 : 1), y: 0.13 },
    offset: { x: 0.5, y: 0.5 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = Barrett.Audio;
}
Barrett.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 22, h: 4, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
Barrett.Audio = { onContact: [AudioEffects.Tap] };
function Bow(a) {
  this.id = a.id;
  this.prefab = PrefabList.Bow;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: Bow.Shapes,
    contact: [this.id],
    bu: 1,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.Bow,
    scale: { x: 0.26 * (a.l ? -1 : 1), y: 0.26 },
    offset: { x: 0.5, y: 0.5 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = Bow.Audio;
}
Bow.Shapes = [
  {
    t: GameShape.POLYGON,
    c: EntityCategory.ITEM,
    v: [
      { x: -20, y: 4 },
      { x: 20, y: 4 },
      { x: 0, y: -7 },
    ],
    fr: 0.7,
    re: 0.3,
    s: !1,
    d: 1,
  },
];
Bow.Audio = { onContact: [AudioEffects.Tap] };
function Carbine(a) {
  this.id = a.id;
  this.prefab = PrefabList.Carbine;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: Carbine.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.Carbine,
    scale: { x: 0.143 * (a.l ? -1 : 1), y: 0.143 },
    offset: { x: 0.5, y: 0.5 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = Carbine.Audio;
}
Carbine.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 22, h: 4, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
Carbine.Audio = { onContact: [AudioEffects.Tap] };
function Chainsaw(a) {
  this.id = a.id;
  this.prefab = PrefabList.Chainsaw;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: Chainsaw.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.Chainsaw,
    scale: { x: 0.18 * (a.l ? -1 : 1), y: 0.2 },
    offset: { x: 0.5, y: 0.5 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = Chainsaw.Audio;
}
Chainsaw.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 18, h: 6, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
Chainsaw.Audio = { onContact: [AudioEffects.Tap] };
function DesertEagle(a) {
  this.id = a.id;
  this.prefab = PrefabList.DesertEagle;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: DesertEagle.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.DesertEagle,
    scale: { x: 0.125 * (a.l ? -1 : 1), y: 0.125 },
    offset: { x: 0.5, y: 0.3 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = Rifle.Audio;
}
DesertEagle.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 7, h: 2, fr: 0.7, re: 0.3, s: !1, d: 5 },
];
DesertEagle.Audio = { onContact: [AudioEffects.Tap] };
function FlameThrower(a) {
  this.id = a.id;
  this.prefab = PrefabList.FlameThrower;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: FlameThrower.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.FlameThrower,
    scale: { x: 0.18 * (a.l ? -1 : 1), y: 0.2 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = FlameThrower.Audio;
}
FlameThrower.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 16, h: 8, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
FlameThrower.Audio = { onContact: [AudioEffects.Tap] };
function LaserGun(a) {
  this.id = a.id;
  this.prefab = PrefabList.LaserGun;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: LaserGun.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.LaserGun,
    scale: { x: 0.14 * (a.l ? -1 : 1), y: 0.14 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = LaserGun.Audio;
}
LaserGun.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 12, h: 3, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
LaserGun.Audio = { onContact: [AudioEffects.Tap], checkAltContact: !0 };
function LinkGun(a) {
  this.id = a.id;
  this.prefab = PrefabList.LinkGun;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: LinkGun.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.LinkGun,
    scale: { x: 0.18 * (a.l ? -1 : 1), y: 0.2 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = LinkGun.Audio;
}
LinkGun.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 18, h: 6, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
LinkGun.Audio = { onContact: [AudioEffects.Tap] };
function MAC10(a) {
  this.id = a.id;
  this.prefab = PrefabList.MAC10;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: MAC10.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.MAC10,
    scale: { x: 0.14 * (a.l ? -1 : 1), y: 0.14 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = MAC10.Audio;
}
MAC10.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 12, h: 3, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
MAC10.Audio = { onContact: [AudioEffects.Tap] };
function Minigun(a) {
  this.id = a.id;
  this.prefab = PrefabList.Minigun;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: Minigun.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.Minigun,
    scale: { x: 0.14 * (a.l ? -1 : 1), y: 0.14 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = Minigun.Audio;
}
Minigun.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 22, h: 4, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
Minigun.Audio = { onContact: [AudioEffects.Tap] };
function NadeLauncher(a) {
  this.id = a.id;
  this.prefab = PrefabList.NadeLauncher;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: NadeLauncher.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.NadeLauncher,
    scale: { x: 0.18 * (a.l ? -1 : 1), y: 0.2 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = NadeLauncher.Audio;
}
NadeLauncher.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 20, h: 3, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
NadeLauncher.Audio = { onContact: [AudioEffects.Tap] };
function PulseGun(a) {
  this.id = a.id;
  this.prefab = PrefabList.PulseGun;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: PulseGun.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.PulseGun,
    scale: { x: 0.18 * (a.l ? -1 : 1), y: 0.2 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = PulseGun.Audio;
}
PulseGun.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 12, h: 3, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
PulseGun.Audio = { onContact: [AudioEffects.Tap] };
function Rifle(a) {
  this.id = a.id;
  this.prefab = PrefabList.Rifle;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: Rifle.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.Rifle,
    scale: { x: 0.18 * (a.l ? -1 : 1), y: 0.2 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = Rifle.Audio;
}
Rifle.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 18, h: 3, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
Rifle.Audio = { onContact: [AudioEffects.Tap] };
function RocketLauncher(a) {
  this.id = a.id;
  this.prefab = PrefabList.RocketLauncher;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: RocketLauncher.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.RocketLauncher,
    scale: { x: 0.12 * (a.l ? -1 : 1), y: 0.12 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = NadeLauncher.Audio;
}
RocketLauncher.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 20, h: 5, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
RocketLauncher.Audio = { onContact: [AudioEffects.Tap] };
function RPG(a) {
  this.id = a.id;
  this.prefab = PrefabList.RPG;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: RPG.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.RPG,
    scale: { x: 0.18 * (a.l ? -1 : 1), y: 0.2 },
    offset: { x: 0.5, y: 0.6 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = RPG.Audio;
}
RPG.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 20, h: 3, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
RPG.Audio = { onContact: [AudioEffects.Tap] };
function ShockRifle(a) {
  this.id = a.id;
  this.prefab = PrefabList.ShockRifle;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: ShockRifle.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.ShockRifle,
    scale: { x: 0.125 * (a.l ? -1 : 1), y: 0.125 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = ShockRifle.Audio;
}
ShockRifle.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 18, h: 3, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
ShockRifle.Audio = { onContact: [AudioEffects.Tap] };
function Shotgun(a) {
  this.id = a.id;
  this.prefab = PrefabList.Shotgun;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: Shotgun.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.Shotgun,
    scale: { x: 0.18 * (a.l ? -1 : 1), y: 0.2 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = Shotgun.Audio;
}
Shotgun.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 18, h: 3, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
Shotgun.Audio = { onContact: [AudioEffects.Tap] };
function SubmachineGun(a) {
  this.id = a.id;
  this.prefab = PrefabList.SubmachineGun;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: SubmachineGun.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.SubmachineGun,
    scale: { x: 0.18 * (a.l ? -1 : 1), y: 0.2 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = SubmachineGun.Audio;
}
SubmachineGun.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 12, h: 3, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
SubmachineGun.Audio = { onContact: [AudioEffects.Tap] };
function X75(a) {
  this.id = a.id;
  this.prefab = PrefabList.X75;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    id: this.id,
    ttl: a.p.ttl || 1500,
    sh: X75.Shapes,
    contact: [this.id],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.X75,
    scale: { x: 0.14 * (a.l ? -1 : 1), y: 0.14 },
    offset: { x: 0.5, y: 0.4 },
    animate: !0,
    onContact: [ParticleEffects.SparkTrail2],
  };
  this.audio = X75.Audio;
}
X75.Shapes = [
  { t: GameShape.RECTANGLE, c: EntityCategory.ITEM, w: 20, h: 3, fr: 0.7, re: 0.3, s: !1, d: 1 },
];
X75.Audio = { onContact: [AudioEffects.Tap] };
var player = {};
class Player extends Agent {
  constructor(a, b, c, d, e, f, g, h) {
    super(a, b, c, d, e);
    this.g = { z: 10, onImpact: [], onAdd: [ParticleEffects.PlayerSpawn], animate: !0 };
    this.bot = this.p.sub = !1;
    this.clanId = f;
    this.clanName = g;
    this.audio = Player.Audio;
    this.input = Player.Input;
    this.gearContainer = new PIXI.Container();
    this.gearContainer.scale.x = this.gearContainer.scale.y = 0.74;
    this.secondaryGearContainer = new PIXI.Container();
    this.secondaryGearContainer.rotation = 90;
    this.secondaryGearContainer.y = 10;
    this.primaryItem = null;
    this.facingDir = h < Math.PI05 && h > -Math.PI05 ? Player.FACING_LEFT : Player.FACING_RIGHT;
    this.animations[
      this.facingDir === Player.FACING_LEFT ? Animation.HOLD_GUN_LEFT : Animation.HOLD_GUN_RIGHT
    ] = 0;
    this.facing = h;
    this.virtualFacing = Math.PI;
    this.health = Player.FULL_HEALTH;
    this.hasTurned = !0;
    this.isLocal = !1;
    this.facingChanged = this.isPlayer = !0;
    this.targeting = !1;
    this.lastInjuredTime = this.age = 0;
    this.head = new GameObject({
      id: this.id + "_head",
      p: { prefab: -1, x: 0, y: 0, r: 0, vx: 0, vy: 0 },
    });
    this.torsoupper = new GameObject({
      id: this.id + "_torsoupper",
      p: { prefab: -1, x: 0, y: 0, r: 0, vx: 0, vy: 0 },
    });
    this.torsolower = new GameObject({
      id: this.id + "_torsolower",
      p: { prefab: -1, x: 0, y: 0, r: 0, vx: 0, vy: 0 },
    });
    this.armleftupper = new GameObject({
      id: this.id + "_armleftupper",
      p: { prefab: -1, x: 0, y: 0, r: 0, vx: 0, vy: 0 },
    });
    this.armleftlower = new GameObject({
      id: this.id + "_armleftlower",
      p: { prefab: -1, x: 0, y: 0, r: 0, vx: 0, vy: 0 },
    });
    this.armrightupper = new GameObject({
      id: this.id + "_armrightupper",
      p: { prefab: -1, x: 0, y: 0, r: 0, vx: 0, vy: 0 },
    });
    this.armrightlower = new GameObject({
      id: this.id + "_armrightlower",
      p: { prefab: -1, x: 0, y: 0, r: 0, vx: 0, vy: 0 },
    });
    this.legleftupper = new GameObject({
      id: this.id + "_legleftupper",
      p: { prefab: -1, x: 0, y: 0, r: 0, vx: 0, vy: 0 },
    });
    this.legleftlower = new GameObject({
      id: this.id + "_legleftlower",
      p: { prefab: -1, x: 0, y: 0, r: 0, vx: 0, vy: 0 },
    });
    this.legrightupper = new GameObject({
      id: this.id + "_legrightupper",
      p: { prefab: -1, x: 0, y: 0, r: 0, vx: 0, vy: 0 },
    });
    this.legrightlower = new GameObject({
      id: this.id + "_legrightlower",
      p: { prefab: -1, x: 0, y: 0, r: 0, vx: 0, vy: 0 },
    });
    this.head.sensitivity = 1.5;
    this.torsoupper.sensitivity = 1;
    this.torsolower.sensitivity = 1;
    this.armleftupper.sensitivity = 0.8;
    this.armleftlower.sensitivity = 0.7;
    this.armrightupper.sensitivity = 0.8;
    this.armrightlower.sensitivity = 0.7;
    this.legleftupper.sensitivity = 0.8;
    this.legleftlower.sensitivity = 0.6;
    this.legrightupper.sensitivity = 0.8;
    this.legrightlower.sensitivity = 0.6;
    this.jetFuel = this.maxJetFuel = Player.ENERGY;
    this.proneRight = this.proneLeft = this.prone = this.crouching = this.jetting = !1;
    this.gearArmOffsetY =
      this.gearArmOffsetX =
      this.reloadCount =
      this.breathing =
      this.moveTimer =
      this.punchCount =
        0;
    this.gearArmRight = SpriteFactory.CreateSprite({
      type: Prefabs.ARM_RIGHTLOWER_SPRITE,
      customization: this.customization,
    });
    this.gearArmLeft = SpriteFactory.CreateSprite({
      type: Prefabs.ARM_LEFTLOWER_SPRITE,
      customization: this.customization,
    });
    this.gearArmRight.visible = !1;
    this.gearArmLeft.visible = !1;
    this.gearArmLeft.scale.x = -0.8;
    this.gearArmRight.scale.x = -0.8;
    this.gearArmLeft.scale.y = 0.8;
    this.gearArmRight.scale.y = 0.8;
    this.gearArmLeft.anchor.y = 0.9;
    this.gearArmRight.anchor.y = 0.9;
    this.gearArmLeft.y = 4;
    this.gearArmRight.y = -4;
    this.gearArmLeft.rotation = 1.6 * Math.PI;
    this.gearArmRight.rotation = 1.4 * Math.PI;
    this.gearContainer.addChild(this.gearArmRight);
    this.gearContainer.addChild(this.gearArmLeft);
    this.head.visual = SpriteFactory.CreateSprite({
      type: Prefabs.HEAD_SPRITE,
      team: Team.Names[c],
      teamIndex: c,
      customization: this.customization,
    });
    this.torsoupper.visual = SpriteFactory.CreateSprite({
      type: Prefabs.TORSO_UPPER_SPRITE,
      team: Team.Names[c],
      teamIndex: c,
      customization: this.customization,
    });
    this.torsoupper.audio = { altContact: [AudioEffects.BodyImpact] };
    this.head.audio =
      this.torsolower.audio =
      this.armleftupper.audio =
      this.armleftlower.audio =
      this.armrightupper.audio =
      this.armrightlower.audio =
      this.legleftupper.audio =
      this.legleftlower.audio =
      this.legrightupper.audio =
      this.legrightlower.audio =
        { onContact: [AudioEffects.LightThud], altContact: [AudioEffects.BodyImpact] };
    a = SpriteFactory.CreateSprite({
      type: Prefabs.TORSO_LOWER_SPRITE,
      customization: this.customization,
    });
    this.torsolower.visual = new PIXI.Container();
    this.torsolower.visual.scale.x = a.scale.x;
    this.torsolower.visual.scale.y = a.scale.y;
    a.scale.x = a.scale.y = 1;
    this.torsolower.visual.addChild(a);
    this.armleftupper.visual = SpriteFactory.CreateSprite({
      type: Prefabs.ARM_LEFTUPPER_SPRITE,
      customization: this.customization,
    });
    this.armleftlower.visual = SpriteFactory.CreateSprite({
      type: Prefabs.ARM_LEFTLOWER_SPRITE,
      customization: this.customization,
    });
    this.armrightupper.visual = SpriteFactory.CreateSprite({
      type: Prefabs.ARM_RIGHTUPPER_SPRITE,
      customization: this.customization,
    });
    this.armrightlower.visual = SpriteFactory.CreateSprite({
      type: Prefabs.ARM_RIGHTLOWER_SPRITE,
      customization: this.customization,
    });
    this.legleftupper.visual = SpriteFactory.CreateSprite({
      type: Prefabs.LEG_LEFTUPPER_SPRITE,
      customization: this.customization,
    });
    this.legleftlower.visual = SpriteFactory.CreateSprite({
      type: Prefabs.LEG_LEFTLOWER_SPRITE,
      customization: this.customization,
    });
    this.legrightupper.visual = SpriteFactory.CreateSprite({
      type: Prefabs.LEG_RIGHTUPPER_SPRITE,
      customization: this.customization,
    });
    this.legrightlower.visual = SpriteFactory.CreateSprite({
      type: Prefabs.LEG_RIGHTLOWER_SPRITE,
      customization: this.customization,
    });
    this.armleftupper.visual.scale.x = -0.26;
    this.armrightupper.visual.scale.x = -0.26;
    this.head.attached = !0;
    this.torsoupper.attached = !0;
    this.torsolower.attached = !0;
    this.armleftupper.attached = !0;
    this.armleftlower.attached = !0;
    this.armrightupper.attached = !0;
    this.armrightlower.attached = !0;
    this.legleftupper.attached = !0;
    this.legleftlower.attached = !0;
    this.legrightupper.attached = !0;
    this.legrightlower.attached = !0;
    this.ragdoll = {
      head: this.head,
      armrightlower: this.armrightlower,
      armrightupper: this.armrightupper,
      torsoupper: this.torsoupper,
      torsolower: this.torsolower,
      armleftlower: this.armleftlower,
      armleftupper: this.armleftupper,
      legrightlower: this.legrightlower,
      legrightupper: this.legrightupper,
      legleftlower: this.legleftlower,
      legleftupper: this.legleftupper,
    };
    this.bodyparts = [
      this.legleftlower,
      this.legleftupper,
      this.legrightlower,
      this.legrightupper,
      this.armleftupper,
      this.armleftlower,
      this.torsolower,
      this.torsoupper,
      this.head,
      this.armrightupper,
      this.armrightlower,
    ];
    this.torsoupper.visual.ref = this.head.visual;
    this.torsoupper.visual.addChild(this.gearContainer);
    this.torsolower.visual.addChildAt(this.secondaryGearContainer, 0);
    this.init();
  }
  init() {
    super.init();
  }
  equip(a) {
    super.equip();
    this.primaryItem && this.gearContainer.removeChild(this.primaryItem);
    this.primaryItem = SpriteFactory.CreateSprite({ type: a });
    this.primaryItem.gearArmOffset
      ? ((this.gearArmOffsetX = this.primaryItem.gearArmOffset.x),
        (this.gearArmOffsetY = this.primaryItem.gearArmOffset.y))
      : (this.gearArmOffsetY = this.gearArmOffsetX = 0);
    this.gearArmLeft.y = 4 + this.gearArmOffsetY;
    this.gearArmRight.y = -(4 + this.gearArmOffsetY);
    this.primaryItem.itemType = a;
    this.gearContainer.addChild(this.primaryItem);
    this.update(!0, !0);
    return null;
  }
  carryPrimary(a) {
    super.carryPrimary();
    this.alive && this.update(!0, !0);
    return null;
  }
  carrySecondary(a) {
    super.carrySecondary();
    this.secondaryItem = SpriteFactory.CreateSprite({ type: a });
    this.secondaryItem.itemType = a;
    this.secondaryItem.pivot.x = this.secondaryItem.pivot.y = 0.5;
    this.secondaryItem.secondaryRotation &&
      (this.secondaryItem.rotation = this.secondaryItem.secondaryRotation);
    this.secondaryItem.secondaryAnchor &&
      ((this.secondaryItem.anchor.x = this.secondaryItem.secondaryAnchor.x),
      (this.secondaryItem.anchor.y = this.secondaryItem.secondaryAnchor.y));
    this.secondaryItem.secondaryScale &&
      ((this.secondaryItem.scale.x = this.secondaryItem.secondaryScale.x),
      (this.secondaryItem.scale.y = this.secondaryItem.secondaryScale.y));
    this.secondaryGearContainer.removeChildren();
    this.secondaryGearContainer.addChild(this.secondaryItem);
    this.alive && this.update(!0, !0);
    return null;
  }
  carryBelt(a) {
    super.carryBelt();
    this.alive && this.update(!0, !0);
    return null;
  }
  removePrimary(a) {
    super.removePrimary();
    this.drop();
    this.alive && this.update(!0, !0);
    return null;
  }
  removeSecondary(a) {
    super.removeSecondary();
    this.secondaryGearContainer.removeChildren();
    this.alive && this.update(!0, !0);
    return null;
  }
  removeBelt(a) {
    super.removeBelt();
    this.alive && this.update(!0, !0);
    return null;
  }
  drop(a) {
    super.drop();
    this.gearContainer.removeChild(this.primaryItem);
    this.primaryItem = null;
    this.armleftlower.visual.alpha = 1;
    this.armrightlower.visual.alpha = 1;
    this.gearArmLeft.visible = !1;
    this.gearArmRight.visible = !1;
  }
  setHealth(a) {
    let b = Math.min(this.health - a.v, 100);
    0 > b
      ? this.removeInjuries(a.v === Player.FULL_HEALTH ? 1 : 0.03)
      : 0 < b && void 0 === a.bid && this.addInjury(null, 0.0025 * b);
    super.setHealth(a);
  }
  setAnimations(a) {
    super.setAnimations(a);
  }
  setLimbGoreTexture(a, b) {
    b.decal &&
      ((a = new PIXI.Sprite(b.decal)), (a.anchor.x = 0.5), (a.anchor.y = 0.5), b.addChild(a));
  }
  setAlive(a) {
    let b = super.setAlive(a);
    b.active = 0;
    0 === a.v && this.isLocal && Player.Input.reset();
    if (a.amp) {
      var c = Player.AMP_TABLE[a.amp];
      let d;
      if ("_" === a.amp[0])
        (c = a.amp.substring(1)), (d = Player.AMP_TABLE[c]), (this.ragdoll[c].attached = !1);
      else {
        d = [];
        for (let e = 0, f = c.length; e < f; e++)
          if (0.5 < Math.random()) {
            d.push(c[e]);
            let g = Player.REV_AMP_TABLE[c[e]];
            for (let h = 0, m = g.length; h < m; h++)
              (this.ragdoll[g[h]].attached = !1),
                this.setLimbGoreTexture(g[h], this.ragdoll[g[h]].visual);
          }
      }
      0 < d.length && (b.detach = d);
    }
    a.bid && (b.bid = a.bid);
    this.stopJetting();
    this.armleftlower.visual.alpha = 1;
    this.armrightlower.visual.alpha = 1;
    this.armleftupper.visual.alpha = 1;
    this.armrightupper.visual.alpha = 1;
    return b;
  }
  addInjury(a, b) {
    var c = [];
    this.lastInjuredTime = App.Time;
    if (a) {
      b = this.ragdoll[a].visual;
      if (!b.injured) {
        b.injured = !0;
        var d = new PIXI.Sprite(App.CombinedTextures["injury" + (Math.round(Math.random()) + 1)]);
        d.decal = !0;
        d.anchor.x = 0.5;
        d.anchor.y = 0.5;
        d.scale.x = 0.3 + 0.3 * Math.random();
        d.scale.y = 0.3 + 0.3 * Math.random();
        d.y = -5 + 10 * Math.random();
        d.rotation = Math.random() * Math.PI * 2;
        b.addChild(d);
        0.2 > Math.random() && c.push(a);
      }
      if (0 < c.length) {
        a = [];
        for (let e = 0, f = c.length; e < f; e++)
          (b = this.ragdoll[c[e]]),
            b.emitter ||
              ((d = new ParticleEmitter(null, [
                this.p.sub ? ParticleEffects.BleedingInWater : ParticleEffects.Bleeding,
              ])),
              (d.parent = b),
              (d.probability = 0.05),
              (b.emitter = d),
              a.push(d));
        return a;
      }
    } else
      for (c = Math.ceil(11 * b), a = 0; a < c; a++)
        (b = this.bodyparts[Math.floor(11 * Math.random())].visual),
          b.injured ||
            ((b.injured = !0),
            (d = new PIXI.Sprite(App.CombinedTextures["injury" + (Math.round(Math.random()) + 1)])),
            (d.decal = !0),
            (d.anchor.x = 0.5),
            (d.anchor.y = 0.5),
            (d.scale.x = 0.3 + 0.3 * Math.random()),
            (d.scale.y = 0.3 + 0.3 * Math.random()),
            (d.y = -5 + 10 * Math.random()),
            (d.rotation = Math.random() * Math.PI * 2),
            b.addChild(d));
    return !1;
  }
  removeInjuries(a) {
    for (let b in this.ragdoll) {
      let c = this.ragdoll[b].visual;
      if (c.injured) {
        this.ragdoll[b].emitter &&
          ((this.ragdoll[b].emitter.ttl = 0), delete this.ragdoll[b].emitter);
        for (let d = 0, e = c.children.length; d < e; d++) {
          let f = c.children[d];
          !0 === f.decal &&
            (0.1 >= f.alpha ? ((c.injured = !1), c.removeChild(f), e--, d--) : (f.alpha -= a));
        }
      }
    }
  }
  hideLeftArm() {
    this.armleftlower.visual.alpha = 0;
    this.armrightlower.visual.alpha = 1;
    this.gearArmLeft.x = 70 + this.gearArmOffsetX;
    this.gearArmLeft.y = this.gearArmOffsetY;
    this.gearArmLeft.visible = !0;
    this.gearArmRight.visible = !1;
  }
  hideRightArm() {
    this.armrightlower.visual.alpha = 0;
    this.armleftlower.visual.alpha = 1;
    this.gearArmRight.x = 70 + this.gearArmOffsetX;
    this.gearArmRight.y = -this.gearArmOffsetY;
    this.gearArmLeft.visible = !1;
    this.gearArmRight.visible = !0;
  }
  update(a, b, c) {
    super.update();
    this.visual.x = this.p.x;
    this.visual.y = this.p.y;
    if (this.alive) {
      a && (this.hasTurned = !0);
      this.animations._ && this.updateBodyOrientation();
      a = this.facingDir === Player.FACING_LEFT;
      this.breathing += 0.07;
      this.breathDisplace = 0.4 * Math.sin(this.breathing);
      this.head.visual.x += this.breathDisplace;
      this.head.visual.y += this.breathDisplace;
      this.torsoupper.visual.x +=
        -this.breathDisplace - 1 * Math.sin(this.torsoupper.visual.rotation);
      if (this.hasTurned || c) {
        c && this.updateFacingDir(this.facing);
        var d = this.visual.parent.getChildIndex(this.armleftupper.visual),
          e = this.visual.parent.getChildIndex(this.armrightupper.visual);
        if (a) {
          this.secondaryGearContainer.rotation = 0.4 * Math.PI;
          this.secondaryGearContainer.x = -20;
          this.secondaryGearContainer.scale.x = 0.6;
          this.secondaryGearContainer.scale.y = 0.6;
          if (!b && d > e) {
            var f = this.head.visual.scale.x;
            this.head.visual.scale.x *= 0 < f ? -1 : 1;
            this.armleftlower.visual.scale.x *= 0 < f ? -1 : 1;
            this.armrightlower.visual.scale.x *= 0 < f ? -1 : 1;
            this.armleftupper.visual.scale.x = -0.26;
            this.armrightupper.visual.scale.x = -0.26;
            this.visual.parent.swapChildren(this.armleftupper.visual, this.armrightupper.visual);
            this.visual.parent.swapChildren(this.armleftlower.visual, this.armrightlower.visual);
            this.armleftupper.visual.z = e;
            this.armrightupper.visual.z = d;
            this.torsoupper.visual.sprite.scale.x = -1;
          }
          this.primaryItem && (this.primaryItem.pointLeft(), this.hideLeftArm());
        } else
          (this.secondaryGearContainer.rotation = 0.6 * Math.PI),
            (this.secondaryGearContainer.x = 20),
            (this.secondaryGearContainer.scale.x = 0.6),
            (this.secondaryGearContainer.scale.y = -0.6),
            !b &&
              d < e &&
              ((f = this.head.visual.scale.x),
              (this.head.visual.scale.x *= 0 > f ? -1 : 1),
              (this.armleftlower.visual.scale.x *= 0 > f ? -1 : 1),
              (this.armrightlower.visual.scale.x *= 0 > f ? -1 : 1),
              (this.armleftupper.visual.scale.x = -0.26),
              (this.armrightupper.visual.scale.x = -0.26),
              this.visual.parent.swapChildren(this.armleftupper.visual, this.armrightupper.visual),
              this.visual.parent.swapChildren(this.armleftlower.visual, this.armrightlower.visual),
              (this.armleftupper.visual.z = e),
              (this.armrightupper.visual.z = d),
              (this.torsoupper.visual.sprite.scale.x = 1)),
            this.primaryItem && (this.primaryItem.pointRight(), this.hideRightArm());
      }
      if (!b) {
        void 0 !== this.animations[Animation.PRONE_LEFT]
          ? (this.proneLeft = this.prone = !0)
          : (this.proneRight =
              void 0 !== this.animations[Animation.PRONE_RIGHT]
                ? (this.prone = !0)
                : (this.proneLeft = this.prone = !1));
        this.alive
          ? this.prone
            ? this.proneLeft
              ? (this.gearContainer.rotation = this.p.r - 0.65 * Math.PI - this.facing)
              : this.proneRight &&
                (this.gearContainer.rotation = this.p.r - 2.35 * Math.PI - this.facing)
            : (this.gearContainer.rotation = -this.facing)
          : (this.gearContainer.rotation = -this.gearContainer.parent.rotation - this.facing);
        this.primaryItem
          ? ((this.crouching = !0),
            this.prone
              ? void 0 !== this.animations[Animation.PRONE_SCOPE_LEFT]
                ? (this.primaryItem.customOffset ||
                    ((this.gearContainer.x = ProneScopeGunLeftAnimation.gearOffset.x + 35),
                    (this.gearContainer.y = ProneScopeGunLeftAnimation.gearOffset.y + 10)),
                  (this.armleftupper.visual.alpha = 0))
                : void 0 !== this.animations[Animation.PRONE_SCOPE_RIGHT] &&
                  (this.primaryItem.customOffset ||
                    ((this.gearContainer.x = ProneScopeGunRightAnimation.gearOffset.x - 35),
                    (this.gearContainer.y = ProneScopeGunRightAnimation.gearOffset.y + 10)),
                  (this.armrightupper.visual.alpha = 0))
              : (void 0 === this.animations[Animation.SCOPE_GUN_LEFT] ||
                this.primaryItem.customOffset
                  ? void 0 === this.animations[Animation.SCOPE_GUN_RIGHT] ||
                    this.primaryItem.customOffset
                    ? ((this.gearContainer.x = 0),
                      (this.gearContainer.y = 25),
                      (this.crouching = !1))
                    : ((this.gearContainer.x = ScopeGunRightAnimation.gearOffset.x),
                      (this.gearContainer.y = ScopeGunRightAnimation.gearOffset.y + 25))
                  : ((this.gearContainer.x = ScopeGunLeftAnimation.gearOffset.x),
                    (this.gearContainer.y = ScopeGunLeftAnimation.gearOffset.y + 25)),
                (this.armleftupper.visual.alpha = 1),
                (this.armrightupper.visual.alpha = 1)),
            (d = Math.abs(this.gearContainer.rotation + 0.5 * Math.PI)),
            (b = !1),
            d < 0.5 * Math.PI
              ? ((d = 0.5 * Math.PI - d), (b = !0))
              : (d = 0.5 * Math.PI - Math.abs(Math.PI - d)),
            (e = !1),
            this.primaryItem &&
              this.primaryItem.animateWhenUsing &&
              (this.primaryItem.applyDefaultTexture(),
              (this.gearArmOffsetX = this.primaryItem.gearArmOffset.x),
              (this.gearArmOffsetY = this.primaryItem.gearArmOffset.y),
              void 0 !== this.animations[Animation.SHOOT_BOW_LEFT] ||
                void 0 !== this.animations[Animation.SHOOT_BOW_RIGHT]) &&
              ((e = !0),
              c || this.primaryItem.animateUsage(!this.crouching),
              (this.gearArmOffsetX = this.primaryItem.gearArmOffsetAnimating.x),
              (this.gearArmOffsetY = this.primaryItem.gearArmOffsetAnimating.y),
              a
                ? (this.armleftupper.visual.rotation = 1.2 * this.facing + 1.4 * Math.PI)
                : (this.armrightupper.visual.rotation =
                    1.2 * this.facing + 1.41 * Math.PI + (b ? 0 : 1.25))),
            a
              ? (b
                  ? this.crouching
                    ? ((this.gearArmLeft.rotation = 1.5 * Math.PI - 0.05 * d),
                      (this.gearArmLeft.x = 70 + this.gearArmOffsetX),
                      (this.gearArmLeft.y = this.gearArmOffsetY),
                      this.primaryItem.customOffset || (this.primaryItem.x = 0),
                      e || (this.armleftupper.visual.rotation = -this.gearContainer.rotation - 1.8))
                    : ((this.gearArmLeft.x = 70 + 5 * d + this.gearArmOffsetX),
                      (this.gearArmLeft.y = this.gearArmOffsetY),
                      (this.primaryItem.x = 5 * d),
                      e
                        ? (this.gearArmLeft.rotation = 1.5 * Math.PI)
                        : ((this.armleftupper.visual.rotation = -this.gearContainer.rotation - 3),
                          (this.gearArmLeft.rotation = 1.5 * Math.PI - 0.15 * d)))
                  : ((this.gearArmLeft.x = 70 + this.gearArmOffsetX),
                    (this.gearArmLeft.y = this.gearArmOffsetY),
                    this.crouching
                      ? ((this.gearArmLeft.rotation = 1.5 * Math.PI + 0.05 * d),
                        e ||
                          (this.armleftupper.visual.rotation = -this.gearContainer.rotation - 1.8))
                      : e ||
                        ((this.armleftupper.visual.rotation = -this.gearContainer.rotation - 3),
                        (this.gearArmLeft.rotation = 1.5 * Math.PI + 0.1 * d))),
                this.prone && (this.gearArmLeft.rotation += 0.3))
              : (b
                  ? this.crouching
                    ? ((this.gearArmRight.rotation = -(0.5 * Math.PI - 0.05 * d)),
                      (this.gearArmRight.x = 70 + this.gearArmOffsetX),
                      (this.gearArmRight.y = -this.gearArmOffsetY),
                      this.primaryItem.customOffset || (this.primaryItem.x = 0),
                      e ||
                        (this.armrightupper.visual.rotation = -this.gearContainer.rotation - 1.3))
                    : ((this.gearArmRight.x = 70 + 5 * d + this.gearArmOffsetX),
                      (this.gearArmRight.y = -this.gearArmOffsetY),
                      (this.primaryItem.x = 5 * d),
                      e
                        ? (this.gearArmRight.rotation = 0.5 * -Math.PI)
                        : ((this.armrightupper.visual.rotation = -this.gearContainer.rotation),
                          (this.gearArmRight.rotation = -(0.5 * Math.PI - 0.15 * d))))
                  : ((this.gearArmRight.x = 70 + this.gearArmOffsetX),
                    (this.gearArmRight.y = -this.gearArmOffsetY),
                    this.crouching
                      ? ((this.gearArmRight.rotation = -(0.5 * Math.PI - 0.05 * d)),
                        e ||
                          (this.armrightupper.visual.rotation = -this.gearContainer.rotation - 1.3))
                      : e ||
                        ((this.armrightupper.visual.rotation = -this.gearContainer.rotation),
                        (this.gearArmRight.rotation = -(0.5 * Math.PI + -0.05 * d)))),
                this.prone && (this.gearArmRight.rotation -= 0.3)),
            void 0 !== this.animations[Animation.THROW_LEFT] ||
            void 0 !== this.animations[Animation.THROW_RIGHT]
              ? ((this.gearArmRight.visible = !1),
                (this.gearArmLeft.visible = !1),
                (this.armleftlower.visual.alpha = 1),
                (this.armrightlower.visual.alpha = 1))
              : c ||
                (void 0 !== this.animations[Animation.RELOAD_LEFT]
                  ? ((this.reloadCount += 0.05 + 0.1 * Math.random()),
                    (this.gearContainer.rotation += 0.07 * Math.cos(this.reloadCount)))
                  : void 0 !== this.animations[Animation.RELOAD_RIGHT]
                  ? ((this.reloadCount += 0.05 + 0.1 * Math.random()),
                    (this.gearContainer.rotation -= 0.07 * Math.cos(this.reloadCount)))
                  : (this.reloadCount = 0)),
            void 0 !== this.animations[Animation.SWITCH_LEFT]
              ? (this.gearContainer.rotation = -this.armrightupper.visual.rotation + 1 * Math.PI)
              : void 0 !== this.animations[Animation.SWITCH_RIGHT]
              ? (this.gearContainer.rotation = -this.armleftupper.visual.rotation)
              : this.prone
              ? a
                ? ((this.gearArmLeft.x -= 14), (this.gearContainer.rotation += 0.33 * Math.PI))
                : ((this.gearArmRight.x -= 14), (this.gearContainer.rotation -= 0.33 * Math.PI))
              : (this.gearContainer.rotation +=
                  this.gearContainer.parent.rotation - Math.PI - this.p.r + 0.5 * Math.PI))
          : (this.prone &&
              ((this.armleftupper.visual.alpha = 1), (this.armrightupper.visual.alpha = 1)),
            void 0 !== this.animations[Animation.PUNCH_LEFT] ||
            void 0 !== this.animations[Animation.PUNCH_RIGHT]
              ? 10 === this.punchCount++ &&
                (this.onRequestCreateEffect(ParticleEffects.FistRaycast, this),
                (this.punchCount = 0))
              : (this.punchCount = 0));
        if (this.jetting) {
          if ((0 <= this.jetFuel - 1 ? --this.jetFuel : (this.jetFuel = 0), this.isLocal))
            this.onJet(this, this.jetFuel);
        } else if (
          !this.input.RM &&
          this.jetFuel < Player.ENERGY &&
          ((this.jetFuel += 0.5), this.isLocal)
        )
          this.onJet(this, this.jetFuel);
        if (100 > this.age) {
          c = 50 < this.age ? 0.02 * (this.age - 50) : 0.05;
          for (let g in this.ragdoll) this.ragdoll[g].visual && (this.ragdoll[g].visual.alpha = c);
          this.bandana.alpha = c;
          this.extraRope && (this.extraRope.alpha = c);
          this.age++;
          if (100 === this.age) {
            for (let g in this.ragdoll)
              this.ragdoll[g].visual && (this.ragdoll[g].visual.alpha = 1);
            this.bandana.alpha = 1;
            this.extraRope && (this.extraRope.alpha = 1);
          }
          this.primaryItem &&
            (this.facingDir === Player.FACING_LEFT
              ? (this.armleftlower.visual.alpha = 0)
              : (this.armrightlower.visual.alpha = 0));
        }
      }
    }
  }
  updateFacing(a) {
    const b = this.getOffset();
    var c = this.p.x + b.x + (a.x - App.TransformedMouseX);
    a = this.p.y + b.y + (a.y - App.TransformedMouseY);
    Player.Input.$ = this.targeting ? Math.floor(Math.sqrt(c * c + a * a)) : 0;
    c = Math.atan2(a, c);
    Math.round(400 * this.facing) !== Math.round(400 * c) &&
      this.updateFacingDir(ToPrecision(3, c));
  }
  updateFacingDir(a, b = !1) {
    if (b) {
      if (this.isLocal) return;
    } else if (((this.virtualFacing = a), (this.facingChanged = !0), this.prone)) {
      this.facingDir ===
        (a < Math.PI05 && a > -Math.PI05 ? Player.FACING_LEFT : Player.FACING_RIGHT) &&
        (this.facing = a);
      return;
    }
    this.facing = a;
    b = this.facingDir;
    this.facingDir = a < Math.PI05 && a > -Math.PI05 ? Player.FACING_LEFT : Player.FACING_RIGHT;
    this.hasTurned = b !== this.facingDir;
  }
  updateBodyOrientation() {
    let a = this.animations,
      b,
      c = this.legleftlower.visual.scale.x;
    void 0 !== a[Animation.WALK_LEFT] || void 0 !== a[Animation.CROUCH_MOVE_LEFT]
      ? (this.moveTimer++,
        (this.secondaryGearContainer.rotation += 0.01 * Math.sin(0.2 * this.moveTimer)),
        (b = 0 > c ? 1 : -1))
      : void 0 !== a[Animation.WALK_RIGHT] || void 0 !== a[Animation.CROUCH_MOVE_RIGHT]
      ? (this.moveTimer++,
        (this.secondaryGearContainer.rotation += 0.01 * Math.sin(0.2 * this.moveTimer)),
        (b = 0 > c ? -1 : 1))
      : (b = this.facingDir === Player.FACING_LEFT ? (0 > c ? 1 : -1) : 0 > c ? -1 : 1);
    c * b !== c &&
      ((this.legleftlower.visual.scale.x *= b),
      (this.legleftupper.visual.scale.x *= b),
      (this.legrightlower.visual.scale.x *= b),
      (this.legrightupper.visual.scale.x *= b));
    a._ = !1;
  }
  getWeaponRotation() {
    return this.gearContainer.rotation - this.gearContainer.parent.rotation;
  }
  getPrimaryAnchor(a) {
    return this.primaryItem
      ? this.primaryItem.getAnchorTransform(a)
      : this.facingDir === Player.FACING_LEFT
      ? {
          x: this.armrightlower.visual.worldTransform.tx,
          y: this.armrightlower.visual.worldTransform.ty,
        }
      : {
          x: this.armleftlower.visual.worldTransform.tx,
          y: this.armleftlower.visual.worldTransform.ty,
        };
  }
  getOffset() {
    let a, b;
    this.prone
      ? ((a = this.facingDir === Player.FACING_LEFT ? -18 : 18), (b = 1))
      : this.crouching
      ? ((a = 0), (b = -7))
      : ((a = 0), (b = -12));
    return { x: a, y: b };
  }
}
Player.Audio = { onContact: [AudioEffects.Thud], onAdded: [AudioEffects.Spawn] };
Player.Input = new InputState();
Player.FACING_LEFT = 0;
Player.FACING_RIGHT = 1;
Player.FULL_HEALTH = 100;
Player.ENERGY = 200;
Player.AMP_TABLE = {
  head: ["neckjoint"],
  torsoupper: ["neckjoint", "torsojoint", "rightshoulderjoint", "leftshoulderjoint"],
  torsolower: ["torsojoint", "righthipjoint", "lefthipjoint"],
  armleftupper: ["leftshoulderjoint", "leftelbowjoint"],
  armleftlower: ["leftelbowjoint"],
  armrightupper: ["rightshoulderjoint", "rightelbowjoint"],
  armrightlower: ["rightelbowjoint"],
  legleftupper: ["lefthipjoint", "leftkneejoint"],
  legleftlower: ["leftkneejoint"],
  legrightupper: ["righthipjoint", "rightkneejoint"],
  legrightlower: ["rightkneejoint"],
  all: "neckjoint torsojoint rightshoulderjoint leftshoulderjoint rightelbowjoint leftelbowjoint righthipjoint lefthipjoint rightkneejoint leftkneejoint".split(
    " "
  ),
};
Player.REV_AMP_TABLE = {
  neckjoint: ["head", "torsoupper"],
  torsojoint: ["torsoupper", "torsolower"],
  rightshoulderjoint: ["armrightupper", "torsoupper"],
  leftshoulderjoint: ["armleftupper", "torsoupper"],
  rightelbowjoint: ["armrightlower", "armrightupper"],
  leftelbowjoint: ["armleftlower", "armleftupper"],
  righthipjoint: ["legrightupper", "torsolower"],
  lefthipjoint: ["legleftupper", "torsolower"],
  rightkneejoint: ["legrightlower", "legrightupper"],
  leftkneejoint: ["legleftlower", "legleftupper"],
};
function GhostBotDebris1(a) {
  this.id = a.id;
  this.type = PrefabList.GhostBotDebris1;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: Box2D.b2BodyType.b2_dynamicBody,
    ld: 0,
    local: !0,
    allowSleep: !1,
    bullet: !1,
    fixedRotation: !1,
    gs: 1,
    sh: [
      {
        c: EntityCategory.PARTICLE,
        t: GameShape.POLYGON,
        v: [
          { x: -16, y: -4 },
          { x: 16, y: -4 },
          { x: 6, y: 7 },
        ],
        fr: 0.5,
        re: 0.2,
        s: !1,
      },
    ],
  };
  Prefab.call(this, a);
  a = Math.random();
  a = new ParticleEmitter(
    null,
    0.4 > a
      ? [ParticleEffects.SmokeTrail1]
      : 0.4 <= a && 0.8 > a
      ? [ParticleEffects.FlameTrail2]
      : [ParticleEffects.SmokeTrail1, ParticleEffects.FlameTrail2]
  );
  a.probability = 0.3;
  this.g = { type: PrefabList.GhostBotDebris1, emitters: [a] };
}
function GhostBotDebris2(a) {
  this.id = a.id;
  this.type = PrefabList.GhostBotDebris2;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: Box2D.b2BodyType.b2_dynamicBody,
    ld: 0,
    local: !0,
    allowSleep: !1,
    bullet: !1,
    fixedRotation: !1,
    gs: 1,
    sh: [
      {
        c: EntityCategory.PARTICLE,
        t: GameShape.POLYGON,
        v: [
          { x: -12, y: -2 },
          { x: 12, y: 9 },
          { x: 0, y: -2 },
        ],
        fr: 0.5,
        re: 0.2,
        s: !1,
      },
    ],
  };
  Prefab.call(this, a);
  a = Math.random();
  a = new ParticleEmitter(
    null,
    0.4 > a
      ? [ParticleEffects.SmokeTrail1]
      : 0.4 <= a && 0.8 > a
      ? [ParticleEffects.FlameTrail2]
      : [ParticleEffects.SmokeTrail1, ParticleEffects.FlameTrail2]
  );
  a.probability = 0.3;
  this.g = { type: PrefabList.GhostBotDebris2, emitters: [a] };
}
function GhostBotDebris3(a) {
  this.id = a.id;
  this.type = PrefabList.GhostBotDebris3;
  this.p = {
    prefab: ShapeOptions.COMPOUND,
    type: Box2D.b2BodyType.b2_dynamicBody,
    ld: 0,
    local: !0,
    allowSleep: !1,
    bullet: !1,
    fixedRotation: !1,
    gs: 1,
    sh: [
      {
        c: EntityCategory.PARTICLE,
        t: GameShape.POLYGON,
        v: [
          { x: -8, y: -4 },
          { x: 8, y: -4 },
          { x: 6, y: 7 },
        ],
        fr: 0.5,
        re: 0.2,
        s: !1,
      },
    ],
  };
  Prefab.call(this, a);
  a = Math.random();
  a = new ParticleEmitter(
    null,
    0.4 > a
      ? [ParticleEffects.SmokeTrail1]
      : 0.4 <= a && 0.8 > a
      ? [ParticleEffects.FlameTrail2]
      : [ParticleEffects.SmokeTrail1, ParticleEffects.FlameTrail2]
  );
  a.probability = 0.3;
  this.g = { type: PrefabList.GhostBotDebris3, emitters: [a] };
}
var b2Body = Box2D.b2Body;
function TinyShrapnel(a) {
  this.id = a.id;
  this.type = PrefabList.TinyShrapnel;
  this.p = {
    prefab: ShapeOptions.CIRCLE,
    type: Box2D.b2BodyType.b2_dynamicBody,
    ld: 0,
    local: !0,
    allowSleep: !1,
    bullet: !1,
    fixedRotation: !0,
    gs: 0.5,
    sh: [{ c: EntityCategory.PARTICLE, radius: 1, fr: 0.001, re: 0.5, s: !1 }],
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.SmokeTrail1]);
  a.probability = 0.3;
  this.g = { type: PrefabList.TinyShrapnel, emitters: [a] };
}
function Prefab(a) {
  a &&
    a.p &&
    (void 0 !== a.p.x && (this.p.x = a.p.x),
    void 0 !== a.p.y && (this.p.y = a.p.y),
    void 0 !== a.p.r && (this.p.r = a.p.r),
    void 0 !== a.p.vx && (this.p.vx = a.p.vx),
    void 0 !== a.p.vy && (this.p.vy = a.p.vy),
    void 0 !== a.p.vr && (this.p.vr = a.p.vr),
    void 0 !== a.p.gi && (this.p.gi = a.p.gi));
}
function AK47Bullet(a) {
  this.id = a.id;
  this.type = PrefabList.AK47Bullet;
  this.contact = { damage: 0.04 };
  this.p = {
    ttl: 350,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.3,
    ricoAngle: 87,
    rico: 2,
    gs: 2,
    bu: -0.25,
    wd: 5,
    pen: 2,
    decay: 0.3,
    id: this.id,
    contact: [this.id],
    d: 0.4,
    fr: 0.1,
    re: 1,
    wttl: 3,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.TinyBulletTrail]);
  this.g = {
    type: PrefabList.AK47Bullet,
    onContact: [ParticleEffects.SmallRicochet, ParticleEffects.SparkTrail2],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.Bloodsplat3],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
    emitters: [a],
  };
  this.audio = AK47Bullet.Audio;
}
AK47Bullet.Audio = { onContact: [AudioEffects.Rico], checkAltContact: !0 };
function Arrow(a) {
  this.id = a.id;
  this.type = PrefabList.Arrow;
  this.contact = { damage: 0, absDamage: 35 };
  this.p = {
    ttl: 500,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.7,
    ricoAngle: 80,
    rico: 0,
    pen: 0,
    wd: 4,
    bu: 0.25,
    decay: 1,
    gs: 2.5,
    id: this.id,
    contact: [this.id],
    track: !1,
    d: 2,
    fr: 0.1,
    re: 0.2,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.ArrowTrail]);
  this.g = {
    type: PrefabList.Arrow,
    onContact: [ParticleEffects.SmallRicochet, ParticleEffects.ArrowImpactStatic],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.Bloodsplat3],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
    emitters: [a],
    onRemoveContact: [ParticleEffects.ArrowImpactDynamic],
  };
  this.audio = Arrow.Audio;
}
Arrow.Audio = { onContact: [AudioEffects.ArrowImpact], checkAltContact: !0 };
function BarrettBullet(a) {
  this.id = a.id;
  this.type = PrefabList.BarrettBullet;
  this.contact = { damage: 0.75 };
  this.p = {
    ttl: 180,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.3,
    gs: 1,
    wd: 5,
    bu: -0.25,
    ricoAngle: 80,
    rico: 2,
    pen: 1,
    decay: 0.5,
    id: this.id,
    contact: [this.id],
    track: !0,
    d: 2,
    fr: 0.1,
    re: 1,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.BulletTrail]);
  this.g = {
    type: PrefabList.BarrettBullet,
    onContact: [
      ParticleEffects.SmallRicochet,
      ParticleEffects.LargeRicochet,
      ParticleEffects.SparkTrail1,
    ],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.Bloodsplat3],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
    emitters: [a],
  };
  this.audio = BarrettBullet.Audio;
}
BarrettBullet.Audio = { onContact: [AudioEffects.Rico], checkAltContact: !0 };
function CarbineBullet(a) {
  this.id = a.id;
  this.type = PrefabList.CarbineBullet;
  this.contact = { damage: 0 };
  this.p = {
    ttl: 180,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.3,
    ricoAngle: 80,
    gs: 1,
    wd: 7,
    bu: -0.25,
    rico: 2,
    pen: 0,
    decay: 0.5,
    id: this.id,
    contact: [this.id],
    track: !0,
    d: 0.5,
    fr: 1,
    re: 1,
    wttl: 2.5,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.CarbineBullet,
    onContact: [
      ParticleEffects.SmallRicochet,
      ParticleEffects.LargeRicochet,
      ParticleEffects.SparkTrail1,
    ],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.Bloodsplat3],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
  };
  this.audio = CarbineBullet.Audio;
}
CarbineBullet.Audio = { onContact: [AudioEffects.Rico], checkAltContact: !0 };
function DesertEagleBullet(a) {
  this.id = a.id;
  this.type = PrefabList.DesertEagleBullet;
  this.contact = { damage: 0.05, absDamage: 10 };
  this.p = {
    ttl: 350,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.9,
    gs: 3,
    wd: 4,
    bu: -0.25,
    ricoAngle: 80,
    rico: 2,
    pen: 0,
    decay: 0.2,
    id: this.id,
    contact: [this.id],
    d: 0.9,
    fr: 1,
    re: 1,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.TinyBulletTrail]);
  this.g = {
    type: PrefabList.DesertEagleBullet,
    onContact: [ParticleEffects.SmallRicochet, ParticleEffects.SparkTrail2],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.Bloodsplat3],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
    emitters: [a],
  };
  this.audio = RifleBullet.Audio;
}
DesertEagleBullet.Audio = { onContact: [AudioEffects.Rico], checkAltContact: !0 };
function FlameThrowerLiquid(a) {
  this.id = a.id;
  this.type = PrefabList.FlameThrowerLiquid;
  this.contact = { damage: 1.6, triggerRatio: 0.01 };
  this.p = {
    ttl: 100,
    prefab: ShapeOptions.CIRCLE,
    type: Box2D.b2BodyType.b2_dynamicBody,
    bullet: !1,
    fixedRotation: !0,
    allowSleep: !1,
    gs: 1,
    id: this.id,
    ricoAngle: 0,
    rico: 5,
    wd: 100,
    pen: 5,
    decay: 1,
    knockback: 5,
    contact: [this.id],
    sh: FlameThrowerLiquid.Shapes,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.FlameThrowerLiquid,
    onContact: [ParticleEffects.FlameThrowerTrail],
    onAgentContact: [ParticleEffects.FlameBlast1, ParticleEffects.SmokeTrail1],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
    emitters: [new ParticleEmitter(null, [ParticleEffects.FlameThrowerTrail], null, 3, 0, -1, 1)],
    onImpact: [new ParticleEmitter(null, [ParticleEffects.FlameTrail2], null, 4, 1, 200, 0.2)],
  };
}
FlameThrowerLiquid.Shapes = [
  { c: EntityCategory.BULLET, radius: 10, d: 0.1, fr: 0.4, re: 0.01, minRestitution: !0 },
];
function GhostLaser(a) {
  this.id = a.id;
  this.type = PrefabList.GhostLaser;
  this.contact = { damage: 10, constant: !0 };
  this.p = {
    ttl: 350,
    prefab: ShapeOptions.PARTICLE,
    ld: 0,
    gs: 0,
    wd: 5,
    bu: 0,
    ricoAngle: 50,
    rico: 1,
    decay: 1,
    knockback: 10,
    id: this.id,
    contact: [this.id],
    d: 1,
    fr: 0.001,
    re: 1,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.GhostLaserTrail]);
  this.g = {
    type: PrefabList.GhostLaser,
    onContact: [],
    onImpact: [],
    onRemove: [ParticleEffects.ShockRifleOrbImpact],
    emitters: [a],
  };
  this.audio = GhostLaser.Audio;
}
GhostLaser.Audio = { onAdded: [AudioEffects.BotZap], onRemove: [AudioEffects.LaserImpact1] };
function LaserGunBullet(a) {
  this.id = a.id;
  this.type = PrefabList.LaserGunBullet;
  this.contact = { damage: 0, absDamage: 10 };
  this.p = {
    ttl: 350,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.5,
    gs: 0,
    wd: 100,
    id: this.id,
    decay: 1,
    ricoAngle: 0,
    rico: 0,
    d: 0.5,
    fr: 1,
    re: 1,
    contact: [this.id],
    wttl: 512,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.LaserGunBullet,
    onContact: [ParticleEffects.TinyRicochet, ParticleEffects.GreenLaserImpact],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.GreenLaserImpact],
  };
  this.audio = LaserGunBullet.Audio;
}
LaserGunBullet.Audio = { onContact: [AudioEffects.LaserGunImpact], checkAltContact: !0 };
function LauncherNade(a) {
  this.id = a.id;
  this.prefab = PrefabList.LauncherNade;
  this.p = {
    ttl: 350,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.5,
    gs: 2,
    ricoAngle: 70,
    rico: 3,
    wd: 2,
    bu: 1,
    decay: 1,
    d: 2,
    fr: 0.001,
    re: 1,
    id: this.id,
    explosive: { damage: 100, radius: 5, blast: 10 },
    contact: [this.id],
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.LauncherNadeSparkTrail]);
  a.probability = 1;
  let b = new ParticleEmitter(null, [ParticleEffects.LauncherNadeSmokeTrail]);
  this.g = {
    type: PrefabList.LauncherNade,
    onContact: [ParticleEffects.SmallRicochet, ParticleEffects.SparkTrail1],
    onRemove: [
      ParticleEffects.NadeExplosionSmoke,
      ParticleEffects.NadeExplosionParticles,
      ParticleEffects.TinyShrapnel,
      ParticleEffects.LauncherNadeExplosion,
      ParticleEffects.NadeShockWave,
    ],
    emitters: [a, b],
  };
  this.audio = LauncherNade.Audio;
}
LauncherNade.Audio = { onRemove: [AudioEffects.ExplosionNadeLauncher] };
function MAC10Bullet(a) {
  this.id = a.id;
  this.type = PrefabList.MAC10Bullet;
  this.contact = { damage: 0.25 };
  this.p = {
    ttl: 25,
    prefab: ShapeOptions.PARTICLE,
    ld: 10,
    wd: 15,
    bu: 0,
    gs: 1,
    d: 0.5,
    fr: 0.001,
    re: 1,
    id: this.id,
    rico: 0,
    decay: 1,
    contact: [this.id],
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.MAC10Bullet,
    onContact: [ParticleEffects.TinyRicochet, ParticleEffects.SparkTrail2],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.Bloodsplat3],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
  };
  this.audio = MAC10Bullet.Audio;
}
MAC10Bullet.Audio = { onContact: [AudioEffects.Rico], checkAltContact: !0 };
function MinigunBullet(a) {
  this.id = a.id;
  this.type = PrefabList.MinigunBullet;
  this.contact = { damage: 0.03 };
  this.p = {
    ttl: 350,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.5,
    gs: 1.2,
    wd: 5,
    bu: -0.25,
    id: this.id,
    ricoAngle: 80,
    rico: 1,
    decay: 1,
    contact: [this.id],
    d: 0.2,
    fr: 0.99,
    re: 0.2,
    wttl: 3,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.TinyBulletTrail]);
  this.g = {
    type: PrefabList.MinigunBullet,
    onContact: [ParticleEffects.TinyRicochet, ParticleEffects.SparkTrail2],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.Bloodsplat3],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
    emitters: [a],
  };
  this.audio = MinigunBullet.Audio;
}
MinigunBullet.Audio = { onContact: [AudioEffects.Rico], checkAltContact: !0 };
function PulseGunBullet(a) {
  this.id = a.id;
  this.type = PrefabList.PulseGunBullet;
  this.contact = { damage: 0.1, absDamage: 10 };
  this.p = {
    ttl: 80,
    prefab: ShapeOptions.PARTICLE,
    update: PulseGunBullet.Update,
    gs: 0,
    bu: 0,
    ld: 1,
    id: this.id,
    ricoAngle: 0,
    wd: 2,
    decay: 1,
    rico: 3,
    knockback: 5,
    contact: [this.id],
    d: 2,
    fr: 0,
    re: 1,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.PulseGunBullet,
    onContact: [
      ParticleEffects.TinyRicochet,
      ParticleEffects.FlameBlast1,
      ParticleEffects.SmokeTrail1,
    ],
    onAgentContact: [ParticleEffects.FlameBlast1, ParticleEffects.SmokeTrail1],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
    emitters: [new ParticleEmitter(null, [ParticleEffects.PulseGunOrbTrail])],
  };
  this.audio = PulseGunBullet.Audio;
}
PulseGunBullet.Update = (a, b) => {
  b = Math.atan2(a.body.vel.y, a.body.vel.x);
  a.body.vel.x = (a.ref.sub ? 60 : 120) * Math.cos(b);
  a.body.vel.y = (a.ref.sub ? 60 : 120) * Math.sin(b);
};
PulseGunBullet.Audio = { onContact: [AudioEffects.PulseGunImpact], checkAltContact: !0 };
function RifleBullet(a) {
  this.id = a.id;
  this.type = PrefabList.RifleBullet;
  this.contact = { damage: 0.1 };
  this.p = {
    ttl: 350,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.3,
    ricoAngle: 80,
    rico: 2,
    wd: 5,
    bu: -0.25,
    pen: 2,
    decay: 0.3,
    id: this.id,
    contact: [this.id],
    d: 0.3,
    fr: 0.1,
    re: 0.2,
    wttl: 3,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.TinyBulletTrail]);
  this.g = {
    type: PrefabList.RifleBullet,
    onContact: [ParticleEffects.SmallRicochet, ParticleEffects.SparkTrail2],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.Bloodsplat3],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
    emitters: [a],
  };
  this.audio = RifleBullet.Audio;
}
RifleBullet.Audio = { onContact: [AudioEffects.Rico], checkAltContact: !0 };
function RLRocket(a) {
  this.id = a.id;
  this.prefab = PrefabList.RLRocket;
  this.p = {
    ttl: 150,
    prefab: ShapeOptions.PARTICLE,
    continuous: !0,
    ld: 0.2,
    gs: 0,
    ricoAngle: 70,
    update: RLRocket.Update,
    fuel: 50,
    rico: 5,
    bu: 1,
    wd: 1.4,
    decay: 1,
    id: this.id,
    explosive: { damage: 35, radius: 3, blast: 4 },
    contact: [this.id],
    d: 2,
    fr: 1,
    re: 1,
    wttl: 1,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.RLRocketSmokeTrail]);
  let b = new ParticleEmitter(
    null,
    [ParticleEffects.RLRocketFlameTrail],
    void 0,
    void 0,
    void 0,
    50
  );
  b.probability = 1;
  this.g = {
    type: PrefabList.RLRocket,
    onContact: [ParticleEffects.SmallRicochet, ParticleEffects.SparkTrail1],
    onRemove: [
      ParticleEffects.RLSmoke,
      ParticleEffects.RLNadeExplosion,
      ParticleEffects.NadeShockWave,
    ],
    emitters: [a, b],
  };
  this.audio = RLRocket.Audio;
}
RLRocket.Update = (a, b) => {
  if (0 === a.ref.fuel) (a.body.gs = 2.5), void 0 !== a.body._gs && (a.body._gs = 2.5);
  else {
    a.ref.fuel--;
    var c = Math.atan2(a.body.vel.y, a.body.vel.x);
    a.body.vel.x += 60 * Math.cos(c) * b;
    a.body.vel.y += 60 * Math.sin(c) * b;
  }
};
RLRocket.Audio = { onRemove: [AudioEffects.RLImpact], checkAltContact: !0 };
function RPGRocket(a) {
  this.id = a.id;
  this.prefab = PrefabList.RPGRocket;
  this.p = {
    ttl: 240,
    prefab: ShapeOptions.PARTICLE,
    ld: 1,
    gs: 5,
    ricoAngle: 70,
    update: RPGRocket.Update,
    wd: 3,
    bu: 10,
    decay: 1,
    rico: 3,
    id: this.id,
    explosive: { damage: 140, radius: 4, blast: 9 },
    contact: [this.id],
    d: 2,
    fr: 1,
    re: 1,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.RPGFlameTrail]);
  a.probability = 1;
  let b = new ParticleEmitter(null, [ParticleEffects.RPGNadeSmokeTrail]);
  this.g = {
    type: PrefabList.RPGRocket,
    onContact: [ParticleEffects.SmallRicochet, ParticleEffects.SparkTrail1],
    onRemove: [
      ParticleEffects.NadeExplosionSmoke,
      ParticleEffects.NadeExplosionParticles,
      ParticleEffects.TinyShrapnel,
      ParticleEffects.LauncherNadeExplosion,
      ParticleEffects.NadeShockWave,
    ],
    emitters: [a, b],
  };
  this.audio = RPGRocket.Audio;
}
RPGRocket.Update = (a, b) => {
  let c = Math.atan2(a.body.vel.y, a.body.vel.x);
  a.body.vel.x += 90 * Math.cos(c) * b;
  a.body.vel.y += 90 * Math.sin(c) * b;
};
RPGRocket.Audio = { onRemove: [AudioEffects.ExplosionNadeLauncher], checkAltContact: !0 };
function ShockRifleBullet(a) {
  this.id = a.id;
  this.type = PrefabList.ShockRifleBullet;
  this.contact = { damage: 6, constant: !0 };
  this.p = {
    ttl: 250,
    prefab: ShapeOptions.CIRCLE,
    type: Box2D.b2BodyType.b2_dynamicBody,
    bullet: !0,
    fixedRotation: !0,
    allowSleep: !1,
    update: ShockRifleBullet.Update,
    ld: 0,
    gs: 0,
    wd: 5,
    bu: 0,
    ricoAngle: 65,
    rico: 1,
    pen: 3,
    noUpdate: !1,
    decay: 1,
    knockback: 4,
    id: this.id,
    contact: [this.id],
    sh: [{ c: EntityCategory.BULLET, radius: 5 }],
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.Electricity1]);
  const b = new ParticleEmitter(null, [ParticleEffects.Electricity2]);
  b.probability = 1;
  this.g = {
    type: PrefabList.ShockRifleBullet,
    onContact: [new ParticleEmitter(null, [ParticleEffects.Electricity1], null, 1, 1, 200, 0.2)],
    onImpact: [new ParticleEmitter(null, [ParticleEffects.Electricity1], null, 1, 1, 200, 0.2)],
    onRemove: [ParticleEffects.ShockRifleOrbImpact],
    emitters: [a, b],
  };
  this.audio = ShockRifleBullet.Audio;
}
ShockRifleBullet.Update = (a, b) => {
  var c = a.body.GetLinearVelocity();
  b = a.ref.sub ? 30 : 55;
  c.x * c.x + c.y * c.y < b * b &&
    ((c = Math.atan2(c.y, c.x)),
    a.body.SetLinearVelocity({ x: b * Math.cos(c), y: b * Math.sin(c) }));
};
ShockRifleBullet.Audio = { onContact: [AudioEffects.LaserImpact1] };
function ShotgunPellet(a) {
  this.type = PrefabList.ShotgunPellet;
  this.id = a.id;
  this.contact = ShotgunPellet.Contact;
  this.p = {
    ttl: 350,
    prefab: ShapeOptions.PARTICLE,
    type: Box2D.b2BodyType.b2_dynamicBody,
    ld: 0.4,
    gs: 2,
    wd: 5,
    bu: -0.25,
    ricoAngle: 70,
    rico: 2,
    pen: 0,
    decay: 1,
    id: this.id,
    contact: [this.id],
    d: 0.4,
    fr: 0.1,
    re: 1,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.ShotgunPellet,
    onContact: [ParticleEffects.TinyRicochet, ParticleEffects.SparkTrail2],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.Bloodsplat3],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
  };
  this.audio = ShotgunPellet.Audio;
}
ShotgunPellet.Contact = { damage: 0.035 };
ShotgunPellet.Audio = { onContact: [AudioEffects.Rico], checkAltContact: !0 };
function SubmachineGunBullet(a) {
  this.id = a.id;
  this.type = PrefabList.SubmachineGunBullet;
  this.contact = { damage: 0.357 };
  this.p = {
    ttl: 350,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.5,
    gs: 1.2,
    wd: 5,
    bu: -0.25,
    decay: 1,
    id: this.id,
    ricoAngle: 80,
    rico: 1,
    contact: [this.id],
    d: 0.3,
    fr: 0.99,
    re: 1,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.TinyBulletTrail]);
  this.g = {
    type: PrefabList.SubmachineGunBullet,
    onContact: [ParticleEffects.TinyRicochet, ParticleEffects.SparkTrail2],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.Bloodsplat3],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
    emitters: [a],
  };
  this.audio = SubmachineGunBullet.Audio;
}
SubmachineGunBullet.Audio = { onContact: [AudioEffects.Rico], checkAltContact: !0 };
function X75Nade(a) {
  this.id = a.id;
  this.prefab = PrefabList.X75Nade;
  this.p = {
    ttl: 60,
    prefab: ShapeOptions.PARTICLE,
    type: Box2D.b2BodyType.b2_dynamicBody,
    bullet: !0,
    fixedRotation: !0,
    allowSleep: !1,
    ignoreExp: !0,
    ld: 0.5,
    fr: 0.999,
    ricoAngle: -1,
    rico: 1,
    gs: 0,
    re: 0.3,
    wd: 1,
    decay: 1,
    bu: 2,
    id: this.id,
    explosive: X75Nade.Explosive,
    contact: [this.id],
    d: 0.05,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.X75NadeSparkTrail]);
  this.g = {
    type: PrefabList.X75Nade,
    onContact: [ParticleEffects.SmallRicochet, ParticleEffects.SparkTrail1],
    onRemove: [
      ParticleEffects.PlasmaNadeExplosion,
      ParticleEffects.NadeShockWave,
      ParticleEffects.X75NadeShrapnel,
    ],
    emitters: [a],
  };
  this.audio = X75Nade.Audio;
}
X75Nade.Explosive = { damage: 60, radius: 3, blast: 4, mod: "x75" };
X75Nade.Audio = { onRemove: [AudioEffects.X75Impact] };
function ClusterNade(a) {
  this.id = a.id;
  this.type = PrefabList.ClusterNade;
  this.p = {
    ttl: 100,
    prime: 98,
    prefab: ShapeOptions.CIRCLE,
    type: b2BodyType.b2_dynamicBody,
    bullet: !0,
    fixedRotation: !1,
    ld: 0.3,
    id: this.id,
    explosive: { damage: 20, radius: 4, blast: 4 },
    sh: [{ c: EntityCategory.THROWN, radius: 4.68, d: 0.5, fr: 0.1, re: 0.6 }],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.ClusterNade,
    onContact: [ParticleEffects.SparkTrail2],
    onRemove: [
      ParticleEffects.ClusterNadeExplosionSmoke,
      ParticleEffects.NadeExplosionParticles,
      ParticleEffects.TinyShrapnel,
      ParticleEffects.ClusterNadeExplosion,
      ParticleEffects.NadeShockWave,
    ],
  };
  this.audio = ClusterNade.Audio;
}
ClusterNade.Audio = { onAdded: [AudioEffects.Throw], onRemove: [AudioEffects.ExplosionCluster] };
b2Body = Box2D.b2Body;
function ClusterNadeFragment(a) {
  this.id = a.id;
  this.type = PrefabList.ClusterNadeFragment;
  this.udContact = !0;
  this.p = {
    ttl: 160,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.05,
    instant: !0,
    ignoreExp: !0,
    id: this.id,
    decay: 1,
    rico: 0,
    maxRico: 0,
    gs: 2,
    d: 4,
    fr: 0.1,
    re: 0.6,
    explosive: { damage: 30, radius: 3, blast: 3 },
    bu: -1,
    wd: 2,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.ClusterNadeFragment,
    onRemove: [
      ParticleEffects.ClusterNadeExplosionSmoke,
      ParticleEffects.NadeExplosionParticles,
      ParticleEffects.TinyShrapnel,
      ParticleEffects.ClusterNadeExplosion,
      ParticleEffects.NadeShockWave,
    ],
  };
  this.audio = ClusterNadeFragment.Audio;
}
ClusterNadeFragment.Audio = { onRemove: [AudioEffects.ExplosionCluster] };
b2Body = Box2D.b2Body;
function Nade(a) {
  this.id = a.id;
  this.type = PrefabList.Nade;
  this.p = {
    ttl: 220,
    prime: 218,
    prefab: ShapeOptions.CIRCLE,
    type: b2BodyType.b2_dynamicBody,
    bullet: !0,
    fixedRotation: !1,
    ld: 0.3,
    contact: [this.id],
    id: this.id,
    explosive: { damage: 140, radius: 5, blast: 9 },
    sh: [{ c: EntityCategory.THROWN, radius: 4.68, d: 0.5, fr: 0.1, re: 0.6 }],
    bu: -5,
    wd: 4,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.Nade,
    onContact: [ParticleEffects.SparkTrail2],
    onRemove: [
      ParticleEffects.NadeExplosionSmoke,
      ParticleEffects.NadeExplosionParticles,
      ParticleEffects.TinyShrapnel,
      ParticleEffects.NadeExplosion,
      ParticleEffects.NadeShockWave,
    ],
  };
  this.audio = Nade.Audio;
}
Nade.Audio = {
  onAdded: [AudioEffects.Throw],
  onContact: [AudioEffects.HeavyThud],
  onRemove: [AudioEffects.ExplosionNade],
};
b2Body = Box2D.b2Body;
function ShurikenBlade(a) {
  this.id = a.id;
  this.type = PrefabList.ShurikenBlade;
  this.p = {
    ttl: 500,
    prime: 499,
    prefab: ShapeOptions.COMPOUND,
    type: b2BodyType.b2_dynamicBody,
    bullet: !0,
    fixedRotation: !1,
    id: this.id,
    contact: [this.id],
    wd: 3,
    bu: 0,
    ad: 0.5,
    sh: ShurikenBlade.Shapes,
    contactInterval: 750,
    lastContactCheck: 0,
  };
  Prefab.call(this, a);
  this.g = {
    type: PrefabList.ShurikenBlade,
    onContact: [ParticleEffects.SparkTrail2],
    onAgentContact: [ParticleEffects.Bloodsplat1, ParticleEffects.Bloodsplat3],
    onAgentContactSubmerged: [ParticleEffects.GoreTrailWater],
    onRemove: [],
  };
  this.audio = ShurikenBlade.Audio;
}
ShurikenBlade.Shapes = [
  {
    t: GameShape.POLYGON,
    c: EntityCategory.THROWN,
    v: [
      { x: -5, y: 5 },
      { x: 5, y: 5 },
      { x: 0, y: -5 },
    ],
    d: 0.25,
    fr: 0.8,
    re: 0.1,
  },
];
ShurikenBlade.Audio = {
  onAdded: [AudioEffects.Throw],
  onContact: [AudioEffects.ShurikenDrop],
  checkAltContact: !0,
};
function SnowballProjectile(a) {
  this.id = a.id;
  this.type = PrefabList.SnowballProjectile;
  this.p = {
    ttl: 600,
    prefab: ShapeOptions.PARTICLE,
    ld: 0.3,
    id: this.id,
    contact: [this.id],
    gs: 2,
    ricoAngle: 80,
    rico: 0,
    pen: 0,
    d: 4,
    fr: 0.1,
    re: 0.6,
    wd: 100,
  };
  Prefab.call(this, a);
  a = new ParticleEmitter(null, [ParticleEffects.SnowballTrail]);
  a.probability = 0.2;
  this.g = {
    type: PrefabList.SnowballProjectile,
    onContact: [ParticleEffects.SnowPuff],
    onAgentContact: [ParticleEffects.SnowPuff],
    onRemove: [ParticleEffects.SnowPuff],
    emitters: [a],
    hideOnContact: !1,
  };
  this.audio = SnowballProjectile.Audio;
}
SnowballProjectile.Audio = {
  onAdded: [AudioEffects.Throw],
  onContact: [AudioEffects.SnowballImpact],
  checkAltContact: !1,
};
var physicsmessage = {},
  PhysicsMessage = {
    ADD: 0,
    REMOVE: 1,
    UPDATE: 2,
    UPDATE_OBJECT: 3,
    ADDED: 4,
    REMOVED: 5,
    UPDATED: 6,
    START: 7,
    STOP: 8,
    FASTER: 9,
    SLOWER: 10,
    RESET: 11,
    APPLY: 12,
    APPLIED: 13,
    SUBMERGE: 14,
    SURFACE: 15,
  };
var physicsconstants = {},
  PC = { GRAVITY: { x: 0, y: 25 }, PM_RATIO: 20 };
var manager = {};
class Manager extends PIXI.utils.EventEmitter {
  constructor(a) {
    super();
    this.sid = a;
    this.p = new PhysicsWorker(this.onPhysicsMessage.bind(this));
    this.localUidPool = new UIDpool(16384);
    this.inBuffer = [];
    this.bodies = {};
    this.explosions = [];
    this.animated = {};
    this.animAttribs = [];
    this.localPlayer = null;
    this.players = {};
    this.teams = [];
    this.audioManager = new AudioManager(this);
    this.suspended = !1;
    this.lastScoringPlayerId = this.onPlayerSpawn = null;
    this.physicsMessageMap = {
      [PhysicsMessage.UPDATE_OBJECT]: this.onUpdateObject.bind(this),
      [PhysicsMessage.UPDATED]: this.onUpdated.bind(this),
      [PhysicsMessage.ADDED]: this.onAdded.bind(this),
      [PhysicsMessage.REMOVED]: this.onRemoved.bind(this),
      [PhysicsMessage.SUBMERGE]: (b) => {
        let c = this.bodies[b.id];
        if (c) {
          c.p.sub = !0;
          var d = 8 < c.p.vx * c.p.vx + c.p.vy * c.p.vy;
          d &&
            AudioManager.PlayEffect(
              AudioEffects.WaterSplash[Math.floor(Math.random() * AudioEffects.WaterSplash.length)],
              c,
              !1
            );
          this.emit(ModelEvent.SUBMERGE, { go: c, ss: b.ss, splash: d });
        }
      },
      [PhysicsMessage.SURFACE]: (b) => {
        if ((b = this.bodies[b.id])) {
          b.p.sub = !1;
          var c = 8 < b.p.vx * b.p.vx + b.p.vy * b.p.vy;
          c &&
            AudioManager.PlayEffect(
              AudioEffects.WaterSplash[Math.floor(Math.random() * AudioEffects.WaterSplash.length)],
              b,
              !1
            );
          this.emit(ModelEvent.SURFACE, { go: b, splash: c });
        }
      },
    };
    this.localObjectMap = {
      [ParticleEffects.LOCAL_SAW]: (b) => {
        let c = this.bodies[b.id],
          d = this.p.raycast(c, b.p.p1, b.p.p2);
        d &&
          this.emit(ModelEvent.CREATE_EFFECT, {
            type: b.type,
            go: c,
            point: d.p,
            c: d.c,
            normal: d.normal,
          });
      },
      [ParticleEffects.LOCAL_PUNCH]: (b) => {
        let c = this.bodies[b.id],
          d = this.p.raycast(c, b.p.p1, b.p.p2);
        d &&
          this.emit(ModelEvent.CREATE_EFFECT, {
            type: b.type,
            go: c,
            point: d.p,
            c: d.c,
            normal: d.normal,
          });
      },
      [ParticleEffects.LOCAL_EXP]: (b) => {
        let c = this.bodies[b.id];
        b.pos = { x: c.p.x, y: c.p.y };
        this.explosions.push(b);
      },
      [ParticleEffects.LOCAL_LINK_GUN]: (b) => {
        let c = this.bodies[b.id],
          d = this.p.raycast(c, b.p.p1, b.p.p2);
        if (d) {
          let e = null;
          null !== d.id && (e = this.bodies[d.id]);
          this.emit(ModelEvent.CREATE_EFFECT, {
            type: b.type,
            origin: b.p.p1,
            point: d.p,
            c: d.c,
            impact: !0,
            target: e,
            go: c,
          });
        } else
          this.emit(ModelEvent.CREATE_EFFECT, {
            type: b.type,
            origin: b.p.p1,
            point: b.p.p2,
            c: d.c,
            impact: !1,
            go: c,
          });
      },
    };
    this.stateChangeAgentMap = {
      [StateChange.Agent.ALIVE]: (b, c) => {
        0 === b.v && this.bodies[b.bid] && this.p.update({ i: b.bid, decay: !0, aid: c.id });
      },
      [StateChange.Agent.HEALTH]: (b, c) => {
        void 0 !== b.bid && this.bodies[b.bid] && this.p.update({ i: b.bid, decay: !0, aid: c.id });
      },
      [StateChange.Agent.COMBO]: (b, c) => {
        c.isLocal && this.emit(ModelEvent.PLAYER_COMBO, { type: b.t, player: c });
        return !1;
      },
      [StateChange.Agent.TELEPORT]: (b, c) => {
        b.to = this.bodies[b.to];
        b.from = this.bodies[b.from];
        AudioManager.PlayEffect(AudioEffects.Teleport, c);
        return !1;
      },
      [StateChange.Agent.INSERTION]: (b, c) => {
        AudioManager.PlayEffect(AudioEffects.Teleport, c);
        return !1;
      },
      [StateChange.Agent.MESSAGE]: (b, c) => {
        if (c) return this.showBotChat(c.id, b.v), !1;
      },
    };
    this.stateChangeModelMap = {
      [StateChange.Model.KILL]: (b) => {
        var c = this.bodies[b.kid];
        if (!c) return !1;
        var d = this.bodies[b.tid];
        if (!d) return !1;
        d = this.players[d.sid];
        if (c.p.isBot)
          return (
            d &&
              this.emit(ModelEvent.PLAYER_DEATH, {
                killer: c,
                victim: d,
                local: this.localPlayer ? this.localPlayer.sid : !1,
                wep: b.w,
              }),
            !1
          );
        (c = this.players[c.sid]) &&
          d &&
          (this.emit(ModelEvent.MODEL_STATE, { state: b.s, killer: c, target: d }),
          this.emit(ModelEvent.PLAYER_DEATH, {
            killer: c,
            victim: d,
            local: this.localPlayer ? this.localPlayer.sid : !1,
            wep: b.w,
          }));
        return !1;
      },
      [StateChange.Model.ENVIRONMENT]: (b) => {
        this.applyEnvironment(b.env);
        return !1;
      },
      [StateChange.Model.ENERGY_RADIUS]: (b) => {
        this.emit(ModelEvent.ENERGY_RADIUS, b.v);
        return !1;
      },
      [StateChange.Model.END_DB_MATCH]: (b) => {
        this.emit(ModelEvent.DB_ROUND_END, b);
        return !1;
      },
      [StateChange.Model.INITIAL]: (b) => {
        this.emit(ModelEvent.INITIAL, b);
        return !1;
      },
    };
    this.stateChangeItemMap = {
      [StateChange.Item.CARRY_OBJECTIVE]: (b) => {
        let c = this.players[this.bodies[b.id].sid];
        void 0 !== c &&
          c.alive &&
          (this.p.connectBodies({ idA: b.id, idB: b.oid }), (b = this.bodies[b.oid])) &&
          (this.emit(ModelEvent.MESSAGE, {
            text: c.name + " captured the " + Team.Colors[b.g.team] + " flag!",
            color: Team.HexColors[c.team],
            icon: "flag_" + Team.Names[b.g.team],
          }),
          AudioManager.PlayEffect(AudioEffects.GrabObjective, c));
        return !1;
      },
      [StateChange.Item.DROP_OBJECTIVE]: (b) => {
        this.p.disconnectBodies({ idA: b.id, idB: b.oid });
        let c = this.players[this.bodies[b.id].sid];
        b = this.bodies[b.oid];
        c && b
          ? (AudioManager.PlayEffect(AudioEffects.Throw, c),
            this.emit(ModelEvent.MESSAGE, {
              text: c.name + " dropped the " + Team.Colors[b.g.team] + " flag!",
              color: Team.HexColors[c.team],
              icon: "flag_" + Team.Names[b.g.team],
            }))
          : console.log("Error: missing player or objective (StateChange.Item.DROP_OBJECTIVE)");
        return !1;
      },
      [StateChange.Item.SCORE_OBJECTIVE]: (b) => {
        this.p.disconnectBodies({ idA: b.id, idB: b.oid });
        b = this.bodies[b.id];
        let c = this.players[b.sid];
        this.lastScoringPlayerId = b.sid;
        this.emit(ModelEvent.PLAYER_SCORE, { player: c });
        App.HasFocus && AudioEffects.Objective.audio.play();
        return !1;
      },
      [StateChange.Item.RETURN_OBJECTIVE]: (b) => {
        (b = this.players[this.bodies[b.id].sid]) &&
          this.emit(ModelEvent.MESSAGE, {
            text: b.name + " returned the flag!",
            color: Team.HexColors[b.team],
            icon: "flag_" + Team.Names[b.team],
          });
        return !1;
      },
    };
    this.stateChangeMap = {
      [StateChange.Agent.RANGE]: (b, c) => {
        let d = this.stateChangeAgentMap[b.s];
        d && d(b, c);
        c = c.applyState(b) || {};
        c.i = b.id;
        return c;
      },
      [StateChange.Model.RANGE]: (b, c) => {
        let d = this.stateChangeModelMap[b.s],
          e = !1;
        d && (e = d(b, c));
        return e;
      },
      [StateChange.Item.RANGE]: (b, c) => {
        let d = this.stateChangeItemMap[b.s];
        return d ? d(b, c) : c.applyState(b);
      },
    };
  }
  preContact(a, b) {
    if (a.contact && void 0 !== a.contact.triggerRatio)
      Math.random() < a.contact.triggerRatio &&
        this.emit(ModelEvent.GAMEOBJECT_CONTACT, { go: a, contact: b });
    else {
      if (a.p.contactInterval)
        if (App.Time > a.p.lastContactCheck + a.p.contactInterval) a.p.lastContactCheck = App.Time;
        else return !1;
      this.emit(ModelEvent.GAMEOBJECT_CONTACT, { go: a, contact: b });
    }
    return !1;
  }
  contact(a, b) {
    if (a.p.contactInterval)
      if (App.Time > a.p.lastContactCheck + a.p.contactInterval) a.p.lastContactCheck = App.Time;
      else return !1;
    let c = null,
      d,
      e;
    if (a.p.prefab === ShapeOptions.PARTICLE) {
      d = b.b.body._parent ? this.bodies[b.b.body._parent] : this.bodies[b.b.ref.id];
      e = b.b.ref;
      if (void 0 !== b.o) {
        var f = this.bodies[b.o];
        f && ((b.o = f), (b.tr = d));
      }
      b.rem && (c = { id: a.id });
    } else if (void 0 !== a.p.ricoAngle)
      if (
        ((f = Math.abs(Math.atan2(b.normal.y, b.normal.x) - Math.atan2(a.p.vy, a.p.vx))),
        (f = f > Math.PI ? 2 * Math.PI - f : f),
        !b.local && (0 >= a.p.rico-- || f < (a.p.ricoAngle * Math.PI) / 180))
      )
        void 0 === a.p.explosive && (c = { id: a.id, type: 2 });
      else if (
        (b.a.body._parent
          ? ((d = this.bodies[b.a.body._parent]), (e = b.a.ref))
          : void 0 != b.b.body._parent && ((d = this.bodies[b.b.body._parent]), (e = b.b.ref)),
        void 0 !== d)
      ) {
        if (d.alive) {
          if (void 0 === b.pen || 0 === b.pen) c = { id: a.id, type: 2 };
          void 0 !== b.o && (f = this.bodies[b.o]) && ((b.o = f), (b.tr = d));
        }
      } else
        this.bodies[b.a.ref.id]
          ? ((d = this.bodies[b.a.ref.id]), (e = b.a.ref))
          : this.bodies[b.b.ref.id] && ((d = this.bodies[b.b.ref.id]), (e = b.b.ref));
    else a.p.instant && (c = { id: a.id, type: 2 });
    this.emit(ModelEvent.GAMEOBJECT_CONTACT, { go: a, contact: b, target: d, ref: e });
    return c ? (this.p.remove(c), !0) : !1;
  }
  processBuffer() {
    for (var a = 0; a < this.inBuffer.length; a++) {
      var b = this.inBuffer[a];
      if (1 === b[""])
        if (b.s) (b = this.applyStateChange(b)) && this.p.update(b);
        else {
          var c = this.instantiate(b);
          if (null !== c && (this.p.add(c.p), b.sharedState))
            for (c = b.sharedState.length; 0 < c--; ) this.applyStateChange(b.sharedState[c]);
        }
      else if (0 === b[""]) {
        if ((c = this.bodies[b.id])) {
          let d = !0;
          void 0 === c.p.rico
            ? ((b.type = c.p.type),
              this.localPlayer && c.id === this.localPlayer.id && (this.localPlayer = null))
            : (c.p.explosive ? (b.type = c.p.type) : ((c.p.ttl = 2), (d = !1)), (c.p.rico = 0));
          d && this.p.remove(b, !0);
        }
      } else this.p.update(b);
    }
    if (0 < this.explosions.length) {
      for (let d = 0, e = this.explosions.length; d < e; d++)
        for (a = this.explosions[d], b = this.p.explosion(a.pos, a.p.exp), c = 0; c < b.length; c++)
          this.emit(ModelEvent.CREATE_EFFECT, {
            type: ParticleEffects.LOCAL_EXP,
            go: this.bodies[b[c]],
            exp: a,
          });
      this.explosions = [];
    }
    this.inBuffer = [];
    this.localPlayer && this.p.updateFacing(this.localPlayer.id, this.localPlayer.facing);
  }
  createLocalPlayer(a, b) {
    this.localPlayer = new Player(
      a.id,
      a.name,
      a.team,
      b.level,
      b.customization,
      b.clan_id,
      b.clan_name,
      a.z / 10
    );
    this.localPlayer.p.type = a.p.type;
    this.localPlayer.p.gi = a.p.gi;
    this.localPlayer.isLocal = !0;
    a.p.a = a.a;
    a.p.local = 1;
    this.bodies[this.localPlayer.id] = this.localPlayer;
    a.p.ragdoll = { id: {} };
    this.localPlayer.sid = a.sid;
    for (let c in this.localPlayer.ragdoll)
      (b = this.localPlayer.ragdoll[c]), (this.bodies[b.id] = b), (a.p.ragdoll.id[c] = b.id);
    this.localPlayer.onJet = this.onPlayerJet.bind(this);
    a.p.smooth = !0;
    this.animated[a.id] = this.localPlayer;
    return a;
  }
  createAgent(a, b) {
    if (a.player) {
      b
        ? (b = new Player(
            a.id,
            a.name,
            a.team,
            b.level,
            b.customization,
            b.clan_id,
            b.clan_name,
            a.z / 10
          ))
        : ((b = new Player(a.id, a.name, 12, 1, a.cust, 0, "", a.z / 10)), (b.bot = !0));
      b.sid = a.sid;
      b.p.gi = a.p.gi;
      a.p.ragdoll = { id: {} };
      a.p.z = a.z;
      a.p.a = a.a;
      this.bodies[b.id] = b;
      for (let c in b.ragdoll)
        (this.bodies[b.ragdoll[c].id] = b.ragdoll[c]), (a.p.ragdoll.id[c] = b.ragdoll[c].id);
    } else b = new Agent(a.id, a.name);
    b.p.type = a.p.type;
    this.animated[a.id] = b;
    return a;
  }
  setCamera(a) {
    this.camera = a;
    AudioManager.Cam = a;
  }
  instantiate(a) {
    if (void 0 !== this.bodies[a.id]) return null;
    if (a.pr) {
      var b = new PrefabClasses[a.pr](a);
      b.p.cid = a.pr;
      a.p.s && (b.p.s = 1);
      void 0 !== a.p.j && (b.p.j = a.p.j);
      void 0 !== a.p.o && (a = this.players[a.p.o]) && (b.p.origin = a.id);
      return this.createGameObject(b);
    }
    return a.player
      ? (void 0 !== a.p.sub && delete a.p.sub,
        (a.p.id = a.id),
        (b = this.onPlayerSpawn(a.sid)),
        a.sid === this.sid ? this.createLocalPlayer(a, b) : this.createAgent(a, b))
      : this.createGameObject(a);
  }
  createGameObject(a) {
    let b = new GameObject(a);
    this.bodies[b.id] = b;
    b.p.track &&
      this.localPlayer &&
      b.p.origin === this.localPlayer.id &&
      (this.localPlayer.crouching || this.localPlayer.prone) &&
      this.localPlayer.input.LM &&
      this.setTrackObject(b.id, !0);
    b.g.animate && (this.animated[b.id] = b);
    if (a.at) {
      b.at = a.at;
      for (let c = 0; c < a.at.length; c++) {
        let d = a.at[c],
          e = !1;
        switch (d.type) {
          case GameAttribute.WELD_JOINT:
          case GameAttribute.REVOLUTE_JOINT:
          case GameAttribute.GRAVITY_SCALE:
            e = !0;
            break;
          case GameAttribute.TRANSFORM:
            e = !0;
            b.transform =
              void 0 === b.transform
                ? GameAttribute.T_TRANSFORM
                : b.transform | GameAttribute.T_TRANSFORM;
            b.transformOptions = { ...b.transformOptions, ...d };
            break;
          case GameAttribute.FLUID:
            e = !0;
            b.transform =
              void 0 === b.transform ? GameAttribute.T_FLUID : b.transform | GameAttribute.T_FLUID;
            b.transformOptions = { ...b.transformOptions, ...d };
            break;
          case GameAttribute.UV_ROTATE:
            b.transform =
              void 0 === b.transform
                ? GameAttribute.T_UV_ROTATE
                : b.transform | GameAttribute.T_UV_ROTATE;
            b.transformOptions = { ...b.transformOptions, ...d };
            break;
          case GameAttribute.UV_TRANSLATE:
            (b.transform =
              void 0 === b.transform
                ? GameAttribute.T_UV_TRANSLATE
                : b.transform | GameAttribute.T_UV_TRANSLATE),
              (b.transformOptions = { ...b.transformOptions, ...d });
        }
        e && (void 0 === b.p.attr && (b.p.attr = []), b.p.attr.push(d));
      }
    }
    return b;
  }
  applySettings(a) {
    this.teams = [];
    for (let b = 0; b < a.teams; b++) this.teams.push(b);
  }
  getLocalPlayer() {
    return this.localPlayer;
  }
  pushUpdates(a) {
    this.inBuffer = this.inBuffer.concat(a);
  }
  requestLocalObject(a) {
    if (void 0 !== this.localObjectMap[a.type]) this.localObjectMap[a.type](a);
    else {
      a.id = "_" + this.localUidPool.get();
      let b = this.instantiate(a);
      null !== b && ((b.p.ttl = a.ttl), (b.p.local = a.p.l), (b.p.id = a.id), this.p.add(b.p));
    }
  }
  applyStateChange(a) {
    let b;
    if (void 0 !== a.id && ((b = this.bodies[a.id]), !b || (b && !b.isPlayer))) return null;
    var c = this.stateChangeMap[Math.floor(a.s / 100)];
    c = c ? c(a, b) : null;
    if (!1 === c) return !1;
    void 0 !== a.id &&
      (b === this.localPlayer && this.emit(ModelEvent.PLAYER_STATE, { agent: b, state: a }),
      this.emit(ModelEvent.AGENT_STATE, { agent: b, state: a }));
    return c;
  }
  clear() {
    this.worldInitialized = !1;
    this.explosions = [];
    this.wayoints = {};
    this.inBuffer = [];
    this.bodies = {};
    this.animated = {};
    this.animAttribs = [];
    this.localPlayer = null;
    this.players = {};
    this.teams = [];
    this.audioManager.clear();
    this.p.pushMessage({ t: PhysicsMessage.RESET });
    this.emit(ModelEvent.CLEAR, {});
  }
  destroy() {
    this.clear();
  }
  getPlayerById(a) {
    return this.players[a];
  }
  getLastScoringPlayer() {
    return null !== this.lastScoringPlayerId ? this.players[this.lastScoringPlayerId] : null;
  }
  trackPlayer(a) {
    (a = this.players[a]) && this.setTrackObject(a.id);
  }
  setTrackObject(a, b = !1) {
    this.camera.target = a;
    this.camera.tracking = b;
  }
  update(a) {
    this.suspended
      ? this.processBuffer()
      : (this.localPlayer && this.localPlayer.updateFacing(this.camera),
        this.processBuffer(),
        this.p.simulate(Math.min(a, 50)),
        this.audioManager.update(a));
  }
  showPlayerChat(a, b) {
    (a = this.players[a]) && this.emit(ModelEvent.UPDATE_LABEL, { id: a.id, subText: b });
  }
  showBotChat(a, b) {
    (a = this.bodies[a]) && this.emit(ModelEvent.UPDATE_LABEL, { id: a.id, subText: b });
  }
  onPlayerJet(a, b) {
    this.emit(ModelEvent.PLAYER_STATE, { agent: a, state: { s: StateChange.Agent.JET, v: b } });
  }
  resume() {
    this.lastScoringPlayer = null;
    this.suspended = !1;
  }
  suspend() {
    App.HasFocus && AudioEffects.Victory.audio.play();
    this.suspended = !0;
  }
  applyEnvironment(a) {
    Player.ENERGY = a.settings ? a.settings.energy : Manager.DefaultEnvironment.settings.energy;
    PC.GRAVITY.x = parseFloat(a.gravity.x);
    PC.GRAVITY.y = parseFloat(a.gravity.y);
    BaseSprite.MeshIDGroups = void 0 !== a.groups ? a.groups : [];
    BaseSprite.TextureIDMap = void 0 !== a.textures ? a.textures : [];
    BaseSprite.ColorMap = void 0 !== a.colors ? a.colors : [];
    this.p.pushMessage({ t: PhysicsMessage.RESET });
    this.emit(ModelEvent.UPDATE_ENVIRONMENT, a);
  }
  focus() {
    this.emit(ModelEvent.FOCUS);
  }
  mute(a) {
    a ? this.audioManager.mute() : this.audioManager.unmute();
  }
  onPhysicsMessage(a) {
    this.physicsMessageMap[a.type](a.data);
  }
  onAdded(a) {
    let b = this.bodies[a.id];
    b.p.x = a.x;
    b.p.y = a.y;
    b.p.r = a.r;
    this.emit(ModelEvent.GAMEOBJECT_ADDED, b);
    if (b.isPlayer) this.onPlayerAdded(b, a);
  }
  onPlayerAdded(a, b) {
    this.players[a.sid] = a;
    this.localPlayer && this.localPlayer.sid === a.sid
      ? (this.emit(ModelEvent.PLAYER_SPAWN, a),
        (this.camera.target = a.torsoupper.id),
        this.setTrackObject(a.torsoupper.id))
      : a.setAnimations(b.anims);
  }
  processContacts(a) {
    let b = a.p.c;
    for (let c = 0, d = b.length; c < d; c++) {
      let e = b[c];
      if (e.t === PhysicsWorker.Contact.CON) {
        if (this.contact(a, e)) return !0;
      } else if (e.t === PhysicsWorker.Contact.PRE && this.preContact(a, e)) return !0;
    }
    return !1;
  }
  onUpdateObject(a) {
    let b = this.bodies[a.id];
    if (b) {
      b.p.x = a.x;
      b.p.y = a.y;
      b.p.r = a.r;
      b.p.vx = a.vx;
      b.p.vy = a.vy;
      if (a.c) {
        if (((b.p.c = a.c), this.processContacts(b))) return;
      } else b.p.c && (b.p.c = []);
      if (void 0 !== b.p.rico && 0 >= b.p.ttl) this.p.remove({ id: a.id, type: 2 });
      else {
        if (void 0 !== a.ax || void 0 !== a.ay) (b.p.ax = a.ax || 0), (b.p.ay = a.ay || 0);
        b.isPlayer &&
          (a.a && b.setAnimations(a.a),
          b.p.ax || b.p.ay
            ? 0.01 !== b.p.fr &&
              ((b.p.fr = 0.01), this.p.update({ i: b.id, fr: b.p.fr, type: b.p.type, local: !0 }))
            : 50 !== b.p.fr &&
              ((b.p.fr = 50), this.p.update({ i: b.id, fr: b.p.fr, type: b.p.type, local: !0 })),
          void 0 !== a.z && b.updateFacingDir(a.z, !0));
        b.g.animate || b.update(null, null, this.suspended);
      }
    }
  }
  onUpdated() {
    for (let a in this.animated) this.animated[a].visual && this.animated[a].update();
  }
  onRemoved(a) {
    let b = a.id,
      c = this.bodies[b];
    if (void 0 === c) console.log("body does not exist: " + b);
    else {
      c.isPlayer
        ? (delete this.players[c.sid],
          c === this.localPlayer && (this.localPlayer = null),
          c.sid === this.lastScoringPlayerId && (this.lastScoringPlayerId = null),
          this.emit(ModelEvent.REMOVE_LABEL, { id: b }))
        : this.camera.target === b &&
          this.localPlayer &&
          this.setTrackObject(this.localPlayer.torsoupper.id);
      a.tr && (c.triggered = !0);
      this.emit(ModelEvent.GAMEOBJECT_DELETED, c);
      if (c.ragdoll) for (let d in c.ragdoll) delete this.bodies[c.ragdoll[d].id];
      c.p.local && this.localUidPool.drop(b.substring(1));
      void 0 !== this.bodies[b] && delete this.bodies[b];
      void 0 !== this.animated[b] && delete this.animated[b];
    }
  }
}
Manager.DefaultEnvironment = {
  weather: { precipitation: { type: "none", intensity: 0 } },
  gravity: PC.GRAVITY,
  gradient: { topColor: "b0e0e6", bottomColor: "3d4e50", topY: -2e3, bottomY: 2e3 },
  settings: { energy: 200 },
};
var modelevent = {};
function ModelEvent(a, b) {
  CustomEvent.call(this, a, b);
}
ModelEvent.ENTER_FRAME = "m_ef";
ModelEvent.GAMEOBJECT_ADDED = "m_goa";
ModelEvent.GAMEOBJECT_UPDATED = "m_gou";
ModelEvent.GAMEOBJECT_DELETED = "m_god";
ModelEvent.GAMEOBJECT_CONTACT = "m_goc";
ModelEvent.UPDATE_LABEL = "m_ul";
ModelEvent.REMOVE_LABEL = "m_rl";
ModelEvent.SAVE_MAP = "m_sm";
ModelEvent.PLAYER_STATE = "m_ps";
ModelEvent.AGENT_STATE = "m_as";
ModelEvent.PLAYER_ACTION = "m_pa";
ModelEvent.PLAYER_TELEPORT = "m_pt";
ModelEvent.MODEL_STATE = "m_ms";
ModelEvent.ENERGY_RADIUS = "m_er";
ModelEvent.PLAYER_DEATH = "m_pd";
ModelEvent.PLAYER_SPAWN = "m_pls";
ModelEvent.CLEAR = "m_cm";
ModelEvent.PLAYER_KILL = "m_pk";
ModelEvent.PLAYER_SCORE = "m_psc";
ModelEvent.CREATE_EFFECT = "m_ce";
ModelEvent.PLAYER_COMBO = "m_pc";
ModelEvent.PLAYER_SPREE = "m_spr";
ModelEvent.UPDATE_ENVIRONMENT = "m_ue";
ModelEvent.FOCUS = "m_fc";
ModelEvent.MESSAGE = "m_m";
ModelEvent.DB_ROUND_END = "m_n";
ModelEvent.INITIAL = "m_i";
ModelEvent.SUBMERGE = "m_sb";
ModelEvent.SURFACE = "m_sr";
var shapeoptions = {};
ShapeOptions = { CIRCLE: 1, RECTANGLE: 2, ROUNDED_RECT: 3, PLAYER: 4, COMPOUND: 5, PARTICLE: 6 };
var rayparticle = {};
class RayParticle {
  constructor(a, b = 0, c = 0, d = 0, e = 0, f = 1, g = 0, h = 1, m = 0, n = 1, l = 2, k = 0) {
    this.m_type = b2BodyType.b2_particleBody;
    this.cat = EntityCategory.BULLET;
    this.mask = MaskBits[EntityCategory.BULLET];
    this.id = a;
    this.pos = b2Vec2.Alloc(b, c);
    this.vel = b2Vec2.Alloc(d, e);
    this.d = f;
    this.fr = g;
    this.re = h;
    this.ld = m;
    this.gs = n;
    this.wd = l;
    this.gi = k;
  }
  free() {
    b2Vec2.Free(this.pos);
    b2Vec2.Free(this.vel);
  }
}
var bodyfactory = {},
  b2Vec2 = Box2D.b2Vec2,
  b2AABB = Box2D.b2AABB,
  b2BodyDef = Box2D.b2BodyDef;
b2Body = Box2D.b2Body;
var b2FixtureDef = Box2D.b2FixtureDef,
  b2FilterData = Box2D.b2FilterData,
  b2Fixture = Box2D.b2Fixture,
  b2World = Box2D.b2World,
  b2PolygonShape = Box2D.b2PolygonShape,
  b2CircleShape = Box2D.b2CircleShape,
  b2Joint = Box2D.b2Joint,
  b2RevoluteJointDef = Box2D.b2RevoluteJointDef,
  b2WeldJointDef = Box2D.b2WeldJointDef;
BodyFactory = {
  world: null,
  free: function (a) {
    this.world.DestroyBody(a);
  },
  createBody: function (a) {
    if (a.prefab === ShapeOptions.PARTICLE) {
      var b = new RayParticle(
        a.id,
        a.x,
        a.y,
        a.vx,
        a.vy,
        a.d ?? 1,
        a.fr ?? 0.9,
        a.re ?? 0.3,
        a.ld ?? 0,
        a.gs ?? 1,
        a.wd,
        a.gi
      );
      b.ttl = a._ttl;
      return b;
    }
    if (0 === a.type && (a.c === EntityCategory.OPEN_WORLD || void 0 === a.sh))
      return {
        GetPosition: () => ({ x: a.x, y: a.y }),
        GetUserData: () => a.id.toString(),
        GetAngle: () => a.r,
        GetType: () => 0,
      };
    let c = this.world.CreateBody(this.getBodyDef(a));
    void 0 !== a.gs && c.SetGravityScale(a.gs);
    void 0 !== a.ld && c.SetLinearDamping(a.ld);
    void 0 !== a.ad && c.SetAngularDamping(a.ad);
    switch (a.prefab) {
      case ShapeOptions.CIRCLE:
        b = ShapeCircle;
        break;
      case ShapeOptions.RECTANGLE:
        b = ShapeRectangle;
        break;
      case ShapeOptions.PLAYER:
        b = ShapePlayer;
        c._player = !0;
        break;
      default:
        b = ShapeCompound;
    }
    return b.call(c, a);
  },
  getBodyDef: function (a) {
    let b = new b2BodyDef();
    b.userData = a.id.toString();
    a.fixedRotation && (b.fixedRotation = !0);
    a.bullet && (b.bullet = !0);
    a.vr && (b.angularVelocity = a.vr);
    (a.vx || a.vy) && b.linearVelocity.Set(a.vx ?? 0, a.vy ?? 0);
    (a.x || a.y) && b.position.Set(a.x ?? 0, a.y ?? 0);
    a.r && (b.angle = a.r);
    if (0 == a.allowSleep || 1 === a.type) b.allowSleep = !1;
    void 0 !== a.type && (b.type = a.type);
    return b;
  },
  createRagdoll: function (a, b) {
    let c = { scale: 0.62 };
    c.head = this.createBody({
      prefab: ShapeOptions.CIRCLE,
      gi: b,
      sh: [{ c: EntityCategory.LIMB, isSensor: !0, radius: 6.2, d: 0.2, fr: 0.99, re: 0.1 }],
      allowSleep: !1,
      id: a.head,
      type: 2,
      x: 0,
      y: 0,
      r: 0,
      ad: 0.9,
    });
    c.torsoupper = this.createBody({
      prefab: ShapeOptions.RECTANGLE,
      gi: b,
      sh: [
        {
          c: EntityCategory.LIMB,
          isSensor: !0,
          width: 6.2,
          height: 6.2,
          d: 0.2,
          fr: 0.99,
          re: 0.1,
        },
      ],
      allowSleep: !1,
      id: a.torsoupper,
      type: 2,
      x: 0,
      y: 0,
      r: 0,
    });
    c.torsolower = this.createBody({
      prefab: ShapeOptions.RECTANGLE,
      gi: b,
      sh: [
        {
          c: EntityCategory.LIMB,
          isSensor: !0,
          width: 6.2,
          height: 6.2,
          d: 0.2,
          fr: 0.99,
          re: 0.1,
        },
      ],
      allowSleep: !1,
      id: a.torsolower,
      type: 2,
      x: 0,
      y: -3.1,
      r: 0,
    });
    c.armleftupper = this.createBody({
      prefab: ShapeOptions.RECTANGLE,
      gi: b,
      sh: [
        {
          c: EntityCategory.LIMB,
          isSensor: !0,
          width: 1.24,
          height: 6.2,
          d: 0.6,
          fr: 0.99,
          re: 0.1,
        },
      ],
      allowSleep: !1,
      id: a.armleftupper,
      type: 2,
      x: 3.1,
      y: 0,
      r: 0.5 * Math.PI,
    });
    c.armleftlower = this.createBody({
      prefab: ShapeOptions.RECTANGLE,
      gi: b,
      sh: [
        {
          c: EntityCategory.LIMB,
          isSensor: !0,
          width: 1.24,
          height: 6.2,
          d: 0.3,
          fr: 0.99,
          re: 0.1,
        },
      ],
      allowSleep: !1,
      id: a.armleftlower,
      type: 2,
      x: 3.1,
      y: 0.62,
      r: 0.5 * Math.PI,
    });
    c.armrightupper = this.createBody({
      prefab: ShapeOptions.RECTANGLE,
      gi: b,
      sh: [
        {
          c: EntityCategory.LIMB,
          isSensor: !0,
          width: 1.24,
          height: 6.2,
          d: 0.6,
          fr: 0.99,
          re: 0.1,
        },
      ],
      allowSleep: !1,
      id: a.armrightupper,
      type: 2,
      x: -3.1,
      y: 0,
      r: 2.8 * Math.PI,
    });
    c.armrightlower = this.createBody({
      prefab: ShapeOptions.RECTANGLE,
      gi: b,
      sh: [
        {
          c: EntityCategory.LIMB,
          isSensor: !0,
          width: 1.24,
          height: 6.2,
          d: 0.3,
          fr: 0.99,
          re: 0.1,
        },
      ],
      allowSleep: !1,
      id: a.armrightlower,
      type: 2,
      x: -3.1,
      y: 0.62,
      r: 3.6 * Math.PI,
    });
    c.legleftupper = this.createBody({
      prefab: ShapeOptions.RECTANGLE,
      gi: b,
      sh: [
        {
          c: EntityCategory.LIMB,
          isSensor: !0,
          width: 1.24,
          height: 8.68,
          d: 0.6,
          fr: 0.99,
          re: 0.1,
        },
      ],
      allowSleep: !1,
      id: a.legleftupper,
      type: 2,
      x: 3.1,
      y: -3 * 0.62,
      r: 1.5 * Math.PI,
    });
    c.legleftlower = this.createBody({
      prefab: ShapeOptions.RECTANGLE,
      gi: b,
      sh: [
        {
          c: EntityCategory.LIMB,
          isSensor: !0,
          width: 1.24,
          height: 6.2,
          d: 0.3,
          fr: 0.99,
          re: 0.1,
        },
      ],
      allowSleep: !1,
      id: a.legleftlower,
      type: 2,
      x: 3.1,
      y: -6 * 0.62,
      r: 0.5 * Math.PI,
    });
    c.legrightupper = this.createBody({
      prefab: ShapeOptions.RECTANGLE,
      gi: b,
      sh: [
        {
          c: EntityCategory.LIMB,
          isSensor: !0,
          width: 1.24,
          height: 8.68,
          d: 0.6,
          fr: 0.99,
          re: 0.1,
        },
      ],
      allowSleep: !1,
      id: a.legrightupper,
      type: 2,
      x: -3.1,
      y: -3 * 0.62,
      r: 1.5 * Math.PI,
    });
    c.legrightlower = this.createBody({
      prefab: ShapeOptions.RECTANGLE,
      gi: b,
      sh: [
        {
          c: EntityCategory.LIMB,
          isSensor: !0,
          width: 1.24,
          height: 6.2,
          d: 0.3,
          fr: 0.99,
          re: 0.1,
        },
      ],
      allowSleep: !1,
      id: a.legrightlower,
      type: 2,
      x: -3.1,
      y: -6 * 0.62,
      r: 0.5 * Math.PI,
    });
    c.torsoupper.contact = !0;
    a = b2Vec2.Alloc(0, -0.2852);
    b = b2Vec2.Alloc(0, 0.2852);
    c.neckjoint = this.joinBodies(
      c.head,
      c.torsoupper,
      a,
      b,
      !1,
      !1,
      0.5 * -Math.PI,
      0.5 * Math.PI
    );
    b2Vec2.Free(a);
    b2Vec2.Free(b);
    a = b2Vec2.Alloc(0, -0.217);
    b = b2Vec2.Alloc(0, 0.217);
    c.torsojoint = this.joinBodies(
      c.torsoupper,
      c.torsolower,
      a,
      b,
      !1,
      !0,
      0.5 * -Math.PI,
      0.5 * Math.PI
    );
    b2Vec2.Free(a);
    b2Vec2.Free(b);
    a = b2Vec2.Alloc(0, 0);
    b = b2Vec2.Alloc(0.248, 0.0868);
    c.leftshoulderjoint = this.joinBodies(
      c.armleftupper,
      c.torsoupper,
      a,
      b,
      !1,
      !1,
      0.5 * -Math.PI,
      0.5 * Math.PI
    );
    b2Vec2.Free(a);
    b2Vec2.Free(b);
    c.leftshoulderjoint.EnableMotor(!0);
    c.leftshoulderjoint.SetMaxMotorTorque(100);
    a = b2Vec2.Alloc(0.0899, -0.78 * 0.62);
    b = b2Vec2.Alloc(0, 0);
    c.leftelbowjoint = this.joinBodies(
      c.armleftupper,
      c.armleftlower,
      a,
      b,
      !1,
      !1,
      0.5 * -Math.PI,
      0.5 * Math.PI
    );
    b2Vec2.Free(a);
    b2Vec2.Free(b);
    c.leftelbowjoint.EnableMotor(!0);
    c.leftelbowjoint.SetMaxMotorTorque(100);
    a = b2Vec2.Alloc(0, 0);
    b = b2Vec2.Alloc(-0.248, 0.0868);
    c.rightshoulderjoint = this.joinBodies(
      c.armrightupper,
      c.torsoupper,
      a,
      b,
      !1,
      !1,
      0.5 * -Math.PI,
      0.5 * Math.PI
    );
    b2Vec2.Free(a);
    b2Vec2.Free(b);
    c.rightshoulderjoint.EnableMotor(!0);
    c.rightshoulderjoint.SetMaxMotorTorque(100);
    a = b2Vec2.Alloc(-0.0899, -0.78 * 0.62);
    b = b2Vec2.Alloc(0, 0);
    c.rightelbowjoint = this.joinBodies(
      c.armrightupper,
      c.armrightlower,
      a,
      b,
      !1,
      !1,
      0.5 * -Math.PI,
      0.5 * Math.PI
    );
    b2Vec2.Free(a);
    b2Vec2.Free(b);
    c.rightelbowjoint.EnableMotor(!0);
    c.rightelbowjoint.SetMaxMotorTorque(100);
    a = b2Vec2.Alloc(0, 0.279);
    b = b2Vec2.Alloc(0.0868, -0.36 * 0.62);
    c.lefthipjoint = this.joinBodies(
      c.legleftupper,
      c.torsolower,
      a,
      b,
      !1,
      !1,
      0.5 * -Math.PI,
      0.5 * Math.PI
    );
    b2Vec2.Free(a);
    b2Vec2.Free(b);
    c.lefthipjoint.EnableMotor(!0);
    c.lefthipjoint.SetMaxMotorTorque(100);
    a = b2Vec2.Alloc(0, -0.248);
    b = b2Vec2.Alloc(0, 0.3038);
    c.leftkneejoint = this.joinBodies(
      c.legleftupper,
      c.legleftlower,
      a,
      b,
      !1,
      !1,
      0.5 * -Math.PI,
      0.5 * Math.PI
    );
    b2Vec2.Free(a);
    b2Vec2.Free(b);
    c.leftkneejoint.EnableMotor(!0);
    c.leftkneejoint.SetMaxMotorTorque(100);
    a = b2Vec2.Alloc(0, 0.279);
    b = b2Vec2.Alloc(-0.0868, -0.36 * 0.62);
    c.righthipjoint = this.joinBodies(
      c.legrightupper,
      c.torsolower,
      a,
      b,
      !1,
      !1,
      0.5 * -Math.PI,
      0.5 * Math.PI
    );
    b2Vec2.Free(a);
    b2Vec2.Free(b);
    c.righthipjoint.EnableMotor(!0);
    c.righthipjoint.SetMaxMotorTorque(100);
    a = b2Vec2.Alloc(0, -0.248);
    b = b2Vec2.Alloc(0, 0.3038);
    c.rightkneejoint = this.joinBodies(
      c.legrightupper,
      c.legrightlower,
      a,
      b,
      !1,
      !1,
      0.5 * -Math.PI,
      0.5 * Math.PI
    );
    b2Vec2.Free(a);
    b2Vec2.Free(b);
    c.rightkneejoint.EnableMotor(!0);
    c.rightkneejoint.SetMaxMotorTorque(100);
    c.bodies = [
      c.head,
      c.torsoupper,
      c.torsolower,
      c.armleftupper,
      c.armleftlower,
      c.armrightupper,
      c.armrightlower,
      c.legleftupper,
      c.legleftlower,
      c.legrightupper,
      c.legrightlower,
    ];
    c.joints = [
      c.neckjoint,
      c.torsojoint,
      c.leftshoulderjoint,
      c.leftelbowjoint,
      c.rightshoulderjoint,
      c.rightelbowjoint,
      c.lefthipjoint,
      c.leftkneejoint,
      c.righthipjoint,
      c.rightkneejoint,
    ];
    c.animations = Animations;
    return c;
  },
  joinBodies: function (a, b, c, d, e, f, g, h) {
    let m = new b2RevoluteJointDef();
    m.bodyA = a;
    m.bodyB = b;
    m.enableLimit = f || !1;
    m.lowerAngle = g || 0;
    m.upperAngle = h || 0;
    m.localAnchorA = c;
    m.localAnchorB = d;
    m.collideConnected = e;
    return this.world.CreateJoint(m);
  },
  weldJoinBodies: function (a, b, c, d, e) {
    let f = new b2WeldJointDef();
    f.bodyA = a;
    f.bodyB = b;
    f.localAnchorA = c;
    f.localAnchorB = d;
    f.referenceAngle = void 0 !== e ? e : b.GetAngle() - a.GetAngle();
    return this.world.CreateJoint(f);
  },
  createJoint: function (a, b, c, d, e) {
    b.x /= PC.PM_RATIO;
    b.y /= PC.PM_RATIO;
    c.x /= PC.PM_RATIO;
    c.y /= PC.PM_RATIO;
    let f;
    switch (a.type) {
      case GameAttribute.REVOLUTE_JOINT:
        f = this.joinBodies(
          d ?? b.owner,
          e ?? c.owner,
          b,
          c,
          parseInt(a.collide, 10),
          parseInt(a.limit, 10),
          parseFloat(a.lowerAngle),
          parseFloat(a.upperAngle)
        );
        parseInt(a.motor, 10) && f.EnableMotor(!0);
        0 !== parseFloat(a.motorTorque) && f.SetMaxMotorTorque(parseFloat(a.motorTorque));
        f.SetUserData(a.id);
        break;
      case GameAttribute.WELD_JOINT:
        (f = this.weldJoinBodies(d ?? b.owner, e ?? c.owner, b, c, a.angle)), f.SetUserData(a.id);
    }
    return f;
  },
};
var animations = {};
function Animation(a, b) {
  this.timeline = [];
  this.frames = a;
  this.frequency = b;
  this.delay = this.frame = 0;
  this.offsets = [{ x: 0, y: 0 }];
  this.frameRepeat = !0;
  this.motorSpeed = 8;
}
Animation.STAND = "0";
Animation.WALK_LEFT = "1";
Animation.WALK_RIGHT = "2";
Animation.CROUCH_LEFT = "3";
Animation.CROUCH_RIGHT = "4";
Animation.CROUCH_MOVE_LEFT = "5";
Animation.CROUCH_MOVE_RIGHT = "6";
Animation.HOLD_GUN_LEFT = "7";
Animation.HOLD_GUN_RIGHT = "8";
Animation.SCOPE_GUN_LEFT = "9";
Animation.SCOPE_GUN_RIGHT = "10";
Animation.THROW_NADE_LEFT = "11";
Animation.THROW_NADE_RIGHT = "12";
Animation.ROLL_LEFT = "13";
Animation.ROLL_RIGHT = "14";
Animation.JUMP_LEFT = "15";
Animation.JUMP_RIGHT = "16";
Animation.THROW_LEFT = "17";
Animation.THROW_RIGHT = "18";
Animation.JET_LEFT = "19";
Animation.JET_RIGHT = "20";
Animation.RELOAD_LEFT = "21";
Animation.RELOAD_RIGHT = "22";
Animation.PUNCH_LEFT = "23";
Animation.PUNCH_RIGHT = "24";
Animation.FALL_LEFT = "25";
Animation.FALL_RIGHT = "26";
Animation.PRONE_LEFT = "27";
Animation.PRONE_RIGHT = "28";
Animation.PRONE_SCOPE_LEFT = "29";
Animation.PRONE_SCOPE_RIGHT = "30";
Animation.PRONE_END = "31";
Animation.PRONE_MOVE_LEFT = "32";
Animation.PRONE_MOVE_RIGHT = "33";
Animation.SWITCH_LEFT = "34";
Animation.SWITCH_RIGHT = "35";
Animation.JUMP_LEFT_2 = "36";
Animation.JUMP_RIGHT_2 = "37";
Animation.SHOOT_BOW_LEFT = "38";
Animation.SHOOT_BOW_RIGHT = "39";
Animation.WAVE_LEFT = "40";
Animation.WAVE_RIGHT = "41";
Animation.SALUTE_LEFT = "42";
Animation.SALUTE_RIGHT = "43";
Animation.CHAT = "44";
Animation.CHAT_END = "45";
Animation.DURATIONS = {};
Animation.DURATIONS[Animation.STAND] = 1;
Animation.DURATIONS[Animation.WALK_LEFT] = 10;
Animation.DURATIONS[Animation.WALK_RIGHT] = 10;
Animation.DURATIONS[Animation.CROUCH_LEFT] = 8;
Animation.DURATIONS[Animation.CROUCH_RIGHT] = 8;
Animation.DURATIONS[Animation.CROUCH_MOVE_LEFT] = 10;
Animation.DURATIONS[Animation.CROUCH_MOVE_RIGHT] = 10;
Animation.DURATIONS[Animation.HOLD_GUN_LEFT] = 1;
Animation.DURATIONS[Animation.HOLD_GUN_RIGHT] = 1;
Animation.DURATIONS[Animation.SCOPE_GUN_LEFT] = 1;
Animation.DURATIONS[Animation.SCOPE_GUN_RIGHT] = 1;
Animation.DURATIONS[Animation.THROW_NADE_LEFT] = 13;
Animation.DURATIONS[Animation.THROW_NADE_RIGHT] = 13;
Animation.DURATIONS[Animation.ROLL_LEFT] = 1;
Animation.DURATIONS[Animation.ROLL_RIGHT] = 1;
Animation.DURATIONS[Animation.JUMP_LEFT] = 4;
Animation.DURATIONS[Animation.JUMP_RIGHT] = 4;
Animation.DURATIONS[Animation.THROW_LEFT] = 4;
Animation.DURATIONS[Animation.THROW_RIGHT] = 4;
Animation.DURATIONS[Animation.JET_LEFT] = 4;
Animation.DURATIONS[Animation.JET_RIGHT] = 4;
Animation.DURATIONS[Animation.RELOAD_LEFT] = 10;
Animation.DURATIONS[Animation.RELOAD_RIGHT] = 10;
Animation.DURATIONS[Animation.PUNCH_LEFT] = 16;
Animation.DURATIONS[Animation.PUNCH_RIGHT] = 16;
Animation.DURATIONS[Animation.FALL_LEFT] = 1;
Animation.DURATIONS[Animation.FALL_RIGHT] = 1;
Animation.DURATIONS[Animation.PRONE_LEFT] = 8;
Animation.DURATIONS[Animation.PRONE_RIGHT] = 8;
Animation.DURATIONS[Animation.PRONE_SCOPE_LEFT] = 1;
Animation.DURATIONS[Animation.PRONE_SCOPE_RIGHT] = 1;
Animation.DURATIONS[Animation.PRONE_END] = 18;
Animation.DURATIONS[Animation.PRONE_MOVE_LEFT] = 24;
Animation.DURATIONS[Animation.PRONE_MOVE_RIGHT] = 24;
Animation.DURATIONS[Animation.SWITCH_LEFT] = 13;
Animation.DURATIONS[Animation.SWITCH_RIGHT] = 13;
Animation.DURATIONS[Animation.JUMP_LEFT_2] = 4;
Animation.DURATIONS[Animation.JUMP_RIGHT_2] = 4;
Animation.DURATIONS[Animation.SHOOT_BOW_LEFT] = 16;
Animation.DURATIONS[Animation.SHOOT_BOW_RIGHT] = 16;
Animation.DURATIONS[Animation.WAVE_LEFT] = 20;
Animation.DURATIONS[Animation.WAVE_RIGHT] = 20;
Animation.DURATIONS[Animation.SALUTE_LEFT] = 1;
Animation.DURATIONS[Animation.SALUTE_RIGHT] = 1;
Animation.DURATIONS[Animation.CHAT] = 1;
Animation.DURATIONS[Animation.CHAT_END] = 1;
Animation.REPEAT = {};
Animation.REPEAT[Animation.STAND] = !1;
Animation.REPEAT[Animation.WALK_LEFT] = !0;
Animation.REPEAT[Animation.WALK_RIGHT] = !0;
Animation.REPEAT[Animation.CROUCH_LEFT] = !1;
Animation.REPEAT[Animation.CROUCH_RIGHT] = !1;
Animation.REPEAT[Animation.CROUCH_MOVE_LEFT] = !0;
Animation.REPEAT[Animation.CROUCH_MOVE_RIGHT] = !0;
Animation.REPEAT[Animation.HOLD_GUN_LEFT] = !1;
Animation.REPEAT[Animation.HOLD_GUN_RIGHT] = !1;
Animation.REPEAT[Animation.SCOPE_GUN_LEFT] = !1;
Animation.REPEAT[Animation.SCOPE_GUN_RIGHT] = !1;
Animation.REPEAT[Animation.THROW_NADE_LEFT] = !1;
Animation.REPEAT[Animation.THROW_NADE_RIGHT] = !1;
Animation.REPEAT[Animation.ROLL_LEFT] = !1;
Animation.REPEAT[Animation.ROLL_RIGHT] = !1;
Animation.REPEAT[Animation.JUMP_LEFT] = !1;
Animation.REPEAT[Animation.JUMP_RIGHT] = !1;
Animation.REPEAT[Animation.THROW_LEFT] = !1;
Animation.REPEAT[Animation.THROW_RIGHT] = !1;
Animation.REPEAT[Animation.JET_LEFT] = !1;
Animation.REPEAT[Animation.JET_RIGHT] = !1;
Animation.REPEAT[Animation.RELOAD_LEFT] = !0;
Animation.REPEAT[Animation.RELOAD_RIGHT] = !0;
Animation.REPEAT[Animation.PUNCH_LEFT] = !0;
Animation.REPEAT[Animation.PUNCH_RIGHT] = !0;
Animation.REPEAT[Animation.FALL_LEFT] = !1;
Animation.REPEAT[Animation.FALL_RIGHT] = !1;
Animation.REPEAT[Animation.PRONE_LEFT] = !1;
Animation.REPEAT[Animation.PRONE_RIGHT] = !1;
Animation.REPEAT[Animation.PRONE_SCOPE_LEFT] = !1;
Animation.REPEAT[Animation.PRONE_SCOPE_RIGHT] = !1;
Animation.REPEAT[Animation.PRONE_END] = !1;
Animation.REPEAT[Animation.PRONE_MOVE_LEFT] = !0;
Animation.REPEAT[Animation.PRONE_MOVE_RIGHT] = !0;
Animation.REPEAT[Animation.SWITCH_LEFT] = !1;
Animation.REPEAT[Animation.SWITCH_RIGHT] = !1;
Animation.REPEAT[Animation.JUMP_LEFT_2] = !1;
Animation.REPEAT[Animation.JUMP_RIGHT_2] = !1;
Animation.REPEAT[Animation.SHOOT_BOW_LEFT] = !0;
Animation.REPEAT[Animation.SHOOT_BOW_RIGHT] = !0;
Animation.REPEAT[Animation.WAVE_LEFT] = !0;
Animation.REPEAT[Animation.WAVE_RIGHT] = !0;
Animation.REPEAT[Animation.SALUTE_LEFT] = !1;
Animation.REPEAT[Animation.SALUTE_RIGHT] = !1;
Animation.REPEAT[Animation.CHAT] = !1;
Animation.REPEAT[Animation.CHAT_END] = !1;
function StandAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.STAND], 0);
  this.timeline.push(
    StandAnimation.tlLeftHip,
    StandAnimation.tlLeftKnee,
    StandAnimation.tlRightHip,
    StandAnimation.tlRightKnee
  );
  this.motorSpeed = 50;
}
StandAnimation.tlLeftHip = { joint: "lefthipjoint", frames: [-0.21] };
StandAnimation.tlLeftKnee = { joint: "leftkneejoint", frames: [-0.21] };
StandAnimation.tlRightHip = { joint: "righthipjoint", frames: [0.21] };
StandAnimation.tlRightKnee = { joint: "rightkneejoint", frames: [0.21] };
function WalkLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.WALK_LEFT], 3);
  this.motorSpeed = 10;
  this.timeline.push(
    WalkLeftAnimation.tlLeftHip,
    WalkLeftAnimation.tlLeftKnee,
    WalkLeftAnimation.tlRightHip,
    WalkLeftAnimation.tlRightKnee
  );
  this.offsets = [
    { x: 0, y: 0.01 },
    { x: 0, y: 0.03 },
    { x: 0, y: 0.05 },
    { x: 0, y: 0.07 },
    { x: 0, y: 0.09 },
    { x: 0, y: 0.09 },
    { x: 0, y: 0.07 },
    { x: 0, y: 0.05 },
    { x: 0, y: 0.03 },
    { x: 0, y: 0.01 },
  ];
  this.soundFx = { 0: AudioEffects.Walk, 5: AudioEffects.Walk };
}
WalkLeftAnimation.tlLeftHip = {
  joint: "lefthipjoint",
  frames: [-0.1, 0.5, 1.3, 0.9, 0.3, -0.3, -0.9, -1.3, -1, -0.6],
};
WalkLeftAnimation.tlLeftKnee = {
  joint: "leftkneejoint",
  frames: [-0.5, -0.9, -1.3, -1.5, -1.3, -1, -0.9, -0.3, -0.1, -0.2],
};
WalkLeftAnimation.tlRightHip = {
  joint: "righthipjoint",
  frames: [-0.3, -0.9, -1.3, -1, -0.6, -0.1, 0.5, 1.3, 0.9, 0.3],
};
WalkLeftAnimation.tlRightKnee = {
  joint: "rightkneejoint",
  frames: [-1.3, -1, -0.9, -0.3, -0.1, -0.2, -0.5, -0.9, -1.3, -1.5],
};
function WalkRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.WALK_RIGHT], 3);
  this.motorSpeed = 10;
  this.timeline.push(
    WalkRightAnimation.tlLeftHip,
    WalkRightAnimation.tlLeftKnee,
    WalkRightAnimation.tlRightHip,
    WalkRightAnimation.tlRightKnee
  );
  this.offsets = [
    { x: 0, y: 0.01 },
    { x: 0, y: 0.03 },
    { x: 0, y: 0.05 },
    { x: 0, y: 0.07 },
    { x: 0, y: 0.09 },
    { x: 0, y: 0.09 },
    { x: 0, y: 0.07 },
    { x: 0, y: 0.05 },
    { x: 0, y: 0.03 },
    { x: 0, y: 0.01 },
  ];
  this.soundFx = { 0: AudioEffects.Walk, 5: AudioEffects.Walk };
}
WalkRightAnimation.tlLeftHip = {
  joint: "lefthipjoint",
  frames: [0.3, 0.9, 1.3, 1, 0.6, 0.1, -0.5, -1.3, -0.9, -0.3],
};
WalkRightAnimation.tlLeftKnee = {
  joint: "leftkneejoint",
  frames: [1.3, 1, 0.9, 0.3, 0.1, 0.2, 0.5, 0.9, 1.3, 1.5],
};
WalkRightAnimation.tlRightHip = {
  joint: "righthipjoint",
  frames: [0.1, -0.5, -1.3, -0.9, -0.3, 0.3, 0.9, 1.3, 1, 0.6],
};
WalkRightAnimation.tlRightKnee = {
  joint: "rightkneejoint",
  frames: [0.5, 0.9, 1.3, 1.5, 1.3, 1, 0.9, 0.3, 0.1, 0.2],
};
WalkRightAnimation.tlRightHip = {
  joint: "righthipjoint",
  frames: [0.1, -0.5, -1.3, -0.9, -0.3, 0.3, 0.9, 1.3, 1, 0.6],
};
function CrouchLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.CROUCH_LEFT], 0);
  this.timeline.push(
    CrouchLeftAnimation.tlLeftHip,
    CrouchLeftAnimation.tlLeftKnee,
    CrouchLeftAnimation.tlRightHip,
    CrouchLeftAnimation.tlRightKnee
  );
  this.offsets = [
    { x: 0, y: 0.08 },
    { x: 0, y: 0.16 },
    { x: 0, y: 0.24 },
    { x: 0, y: 0.32 },
    { x: 0, y: 0.4 },
    { x: 0, y: 0.48 },
    { x: 0, y: 0.56 },
    { x: 0, y: 0.64 },
  ];
  this.frameRepeat = !1;
  this.motorSpeed = 10;
}
CrouchLeftAnimation.tlLeftHip = {
  joint: "lefthipjoint",
  frames: [-1, -1, -1.5, -1.5, -1.6, -1.7, -1.8, -1.8],
};
CrouchLeftAnimation.tlLeftKnee = {
  joint: "leftkneejoint",
  frames: [-0.8, -0.8, -1.3, -1.3, -1.9, -1.9, -1.9, -1.9],
};
CrouchLeftAnimation.tlRightHip = {
  joint: "righthipjoint",
  frames: [0.2, 0.2, 0.2, 0.2, 0.2, 0.3, 0.4, 0.5],
};
CrouchLeftAnimation.tlRightKnee = {
  joint: "rightkneejoint",
  frames: [-0.7, -0.7, -1.2, -1.2, -1.4, -1.6, -1.8, -1.8],
};
function CrouchRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.CROUCH_RIGHT], 0);
  this.timeline.push(
    CrouchRightAnimation.tlLeftHip,
    CrouchRightAnimation.tlLeftKnee,
    CrouchRightAnimation.tlRightHip,
    CrouchRightAnimation.tlRightKnee
  );
  this.offsets = [
    { x: 0, y: 0.08 },
    { x: 0, y: 0.16 },
    { x: 0, y: 0.24 },
    { x: 0, y: 0.32 },
    { x: 0, y: 0.4 },
    { x: 0, y: 0.48 },
    { x: 0, y: 0.56 },
    { x: 0, y: 0.64 },
  ];
  this.frameRepeat = !1;
  this.motorSpeed = 10;
}
CrouchRightAnimation.tlLeftHip = {
  joint: "lefthipjoint",
  frames: [-0.2, -0.2, -0.2, -0.2, -0.2, -0.3, -0.4, -0.5],
};
CrouchRightAnimation.tlLeftKnee = {
  joint: "leftkneejoint",
  frames: [0.7, 0.7, 1.2, 1.2, 1.4, 1.6, 1.8, 1.8],
};
CrouchRightAnimation.tlRightHip = {
  joint: "righthipjoint",
  frames: [1, 1, 1.5, 1.5, 1.6, 1.7, 1.8, 1.8],
};
CrouchRightAnimation.tlRightKnee = {
  joint: "rightkneejoint",
  frames: [0.8, 0.8, 1.3, 1.3, 1.9, 1.9, 1.9, 1.9],
};
function CrouchMoveLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.CROUCH_MOVE_LEFT], 4);
  this.timeline.push(
    CrouchMoveLeftAnimation.tlLeftHip,
    CrouchMoveLeftAnimation.tlLeftKnee,
    CrouchMoveLeftAnimation.tlRightHip,
    CrouchMoveLeftAnimation.tlRightKnee
  );
  this.offsets = [
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
  ];
}
CrouchMoveLeftAnimation.tlLeftHip = {
  joint: "lefthipjoint",
  frames: [-1.4, -1.1, -0.7, -0.2, 0.3, -0.1, -0.6, -1.1, -1.4, -1.7],
};
CrouchMoveLeftAnimation.tlLeftKnee = {
  joint: "leftkneejoint",
  frames: [-1.5, -1.5, -1.5, -1.5, -1.5, -1.5, -1.5, -1.5, -1.5, -1.5],
};
CrouchMoveLeftAnimation.tlRightHip = {
  joint: "righthipjoint",
  frames: [0.1, -0.5, -0.7, -1.4, -1.7, -1.4, -0.7, -0.5, -0, 0.5],
};
CrouchMoveLeftAnimation.tlRightKnee = {
  joint: "rightkneejoint",
  frames: [-1.5, -1.5, -1.5, -1.5, -1.5, -1.5, -1.5, -1.5, -1.5, -1.5],
};
function CrouchMoveRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.CROUCH_MOVE_RIGHT], 4);
  this.timeline.push(
    CrouchMoveRightAnimation.tlLeftHip,
    CrouchMoveRightAnimation.tlLeftKnee,
    CrouchMoveRightAnimation.tlRightHip,
    CrouchMoveRightAnimation.tlRightKnee
  );
  this.offsets = [
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
    { x: 0, y: 0.34 },
  ];
}
CrouchMoveRightAnimation.tlLeftHip = {
  joint: "lefthipjoint",
  frames: [-0.1, 0.5, 0.7, 1.4, 1.7, 1.4, 0.7, 0.5, 0, -0.5],
};
CrouchMoveRightAnimation.tlLeftKnee = {
  joint: "leftkneejoint",
  frames: [1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5],
};
CrouchMoveRightAnimation.tlRightHip = {
  joint: "righthipjoint",
  frames: [1.4, 1.1, 0.7, 0.2, -0.3, 0.1, 0.6, 1.1, 1.4, 1.7],
};
CrouchMoveRightAnimation.tlRightKnee = {
  joint: "rightkneejoint",
  frames: [1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.5],
};
function HoldGunLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.HOLD_GUN_LEFT], 0);
  this.timeline.push(
    HoldGunLeftAnimation.tlLeftShoulder,
    HoldGunLeftAnimation.tlLeftElbow,
    HoldGunLeftAnimation.tlRightShoulder,
    HoldGunLeftAnimation.tlRightElbow
  );
  this.motorSpeed = 30;
  this.frameRepeat = !1;
}
HoldGunLeftAnimation.tlLeftShoulder = { joint: "leftshoulderjoint", frames: [0.1] };
HoldGunLeftAnimation.tlLeftElbow = { joint: "leftelbowjoint", frames: [1] };
HoldGunLeftAnimation.tlRightShoulder = { joint: "rightshoulderjoint", frames: [0.1] };
HoldGunLeftAnimation.tlRightElbow = { joint: "rightelbowjoint", frames: [1.5] };
function HoldGunRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.HOLD_GUN_RIGHT], 0);
  this.timeline.push(
    HoldGunRightAnimation.tlLeftShoulder,
    HoldGunRightAnimation.tlLeftElbow,
    HoldGunRightAnimation.tlRightShoulder,
    HoldGunRightAnimation.tlRightElbow
  );
  this.motorSpeed = 30;
  this.frameRepeat = !1;
}
HoldGunRightAnimation.tlLeftShoulder = { joint: "leftshoulderjoint", frames: [-0.1] };
HoldGunRightAnimation.tlLeftElbow = { joint: "leftelbowjoint", frames: [-1.5] };
HoldGunRightAnimation.tlRightShoulder = { joint: "rightshoulderjoint", frames: [0.1] };
HoldGunRightAnimation.tlRightElbow = { joint: "rightelbowjoint", frames: [-1] };
function ScopeGunLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.SCOPE_GUN_LEFT], 0);
  this.timeline.push(
    ScopeGunLeftAnimation.tlLeftShoulder,
    ScopeGunLeftAnimation.tlLeftElbow,
    ScopeGunLeftAnimation.tlRightShoulder,
    ScopeGunLeftAnimation.tlRightElbow
  );
  this.motorSpeed = 30;
}
ScopeGunLeftAnimation.gearOffset = { x: 8, y: -26 };
ScopeGunLeftAnimation.gearOffsetSteps = 2;
ScopeGunLeftAnimation.tlLeftShoulder = { joint: "leftshoulderjoint", frames: [-0.1] };
ScopeGunLeftAnimation.tlLeftElbow = { joint: "leftelbowjoint", frames: [1.6] };
ScopeGunLeftAnimation.tlRightShoulder = { joint: "rightshoulderjoint", frames: [0.1] };
ScopeGunLeftAnimation.tlRightElbow = { joint: "rightelbowjoint", frames: [2.2] };
function ScopeGunRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.SCOPE_GUN_RIGHT], 0);
  this.timeline.push(
    ScopeGunRightAnimation.tlLeftShoulder,
    ScopeGunRightAnimation.tlLeftElbow,
    ScopeGunRightAnimation.tlRightShoulder,
    ScopeGunRightAnimation.tlRightElbow
  );
  this.motorSpeed = 30;
}
ScopeGunRightAnimation.gearOffset = { x: -8, y: -26 };
ScopeGunRightAnimation.gearOffsetSteps = 2;
ScopeGunRightAnimation.tlLeftShoulder = { joint: "leftshoulderjoint", frames: [-0.1] };
ScopeGunRightAnimation.tlLeftElbow = { joint: "leftelbowjoint", frames: [-2.2] };
ScopeGunRightAnimation.tlRightShoulder = { joint: "rightshoulderjoint", frames: [0.1] };
ScopeGunRightAnimation.tlRightElbow = { joint: "rightelbowjoint", frames: [-1.6] };
function ThrowNadeLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.THROW_NADE_LEFT], 0);
  this.timeline.push(
    ThrowNadeLeftAnimation.tlLeftShoulder,
    ThrowNadeLeftAnimation.tlLeftElbow,
    ThrowNadeLeftAnimation.tlRightShoulder,
    ThrowNadeLeftAnimation.tlRightElbow
  );
  this.frameRepeat = !1;
  this.motorSpeed = 25;
}
ThrowNadeLeftAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [
    -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1,
  ],
};
ThrowNadeLeftAnimation.tlLeftElbow = {
  joint: "leftelbowjoint",
  frames: [1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1],
};
ThrowNadeLeftAnimation.tlRightShoulder = {
  joint: "rightshoulderjoint",
  frames: [-0, -0.3, -0.6, -0.9, -1.2, -1.5, -1.8, -1.5, -1.2, -0.9, -0.6, -0.3, -0],
};
ThrowNadeLeftAnimation.tlRightElbow = {
  joint: "rightelbowjoint",
  frames: [1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1],
};
function ThrowNadeRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.THROW_NADE_RIGHT], 0);
  this.timeline.push(
    ThrowNadeRightAnimation.tlLeftShoulder,
    ThrowNadeRightAnimation.tlLeftElbow,
    ThrowNadeRightAnimation.tlRightShoulder,
    ThrowNadeRightAnimation.tlRightElbow
  );
  this.frameRepeat = !1;
  this.motorSpeed = 25;
}
ThrowNadeRightAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [0, 0.3, 0.6, 0.9, 1.2, 1.5, 1.8, 1.5, 1.2, 0.9, 0.6, 0.3, 0],
};
ThrowNadeRightAnimation.tlLeftElbow = {
  joint: "leftelbowjoint",
  frames: [-1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1],
};
ThrowNadeRightAnimation.tlRightShoulder = {
  joint: "rightshoulderjoint",
  frames: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1],
};
ThrowNadeRightAnimation.tlRightElbow = {
  joint: "rightelbowjoint",
  frames: [-1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1],
};
function RollLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.ROLL_LEFT], 0);
  this.soundFx = { 0: AudioEffects.Flip, finish: !0 };
}
function RollRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.ROLL_RIGHT], 0);
  this.soundFx = { 0: AudioEffects.Flip, finish: !0 };
}
function JumpLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.JUMP_LEFT], 0);
  this.timeline.push(
    JumpLeftAnimation.tlLeftHip,
    JumpLeftAnimation.tlLeftKnee,
    JumpLeftAnimation.tlRightHip,
    JumpLeftAnimation.tlRightKnee
  );
  this.frameRepeat = !1;
  this.motorSpeed = 20;
  this.soundFx = { 0: AudioEffects.Jump, finish: !0 };
}
JumpLeftAnimation.tlLeftHip = { joint: "lefthipjoint", frames: [-2, -2.55, -2.55, -2] };
JumpLeftAnimation.tlLeftKnee = { joint: "leftkneejoint", frames: [-2, -2.55, -2.55, -2.6] };
JumpLeftAnimation.tlRightHip = { joint: "righthipjoint", frames: [-2, -2.55, -2.55, -2] };
JumpLeftAnimation.tlRightKnee = { joint: "rightkneejoint", frames: [-2, -2.55, -2.55, -2.6] };
function JumpRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.JUMP_RIGHT], 0);
  this.timeline.push(
    JumpRightAnimation.tlLeftHip,
    JumpRightAnimation.tlLeftKnee,
    JumpRightAnimation.tlRightHip,
    JumpRightAnimation.tlRightKnee
  );
  this.frameRepeat = !1;
  this.motorSpeed = 20;
  this.soundFx = { 0: AudioEffects.Jump, finish: !0 };
}
JumpRightAnimation.tlLeftHip = { joint: "lefthipjoint", frames: [2, 2.55, 2.55, 2] };
JumpRightAnimation.tlLeftKnee = { joint: "leftkneejoint", frames: [2, 2.55, 2.55, 2.6] };
JumpRightAnimation.tlRightHip = { joint: "righthipjoint", frames: [2, 2.55, 2.55, 2] };
JumpRightAnimation.tlRightKnee = { joint: "rightkneejoint", frames: [2, 2.55, 2.55, 2.6] };
function ThrowLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.THROW_LEFT], 0);
  this.timeline.push(
    ThrowLeftAnimation.tlLeftShoulder,
    ThrowLeftAnimation.tlLeftElbow,
    ThrowLeftAnimation.tlRightShoulder,
    ThrowLeftAnimation.tlRightElbow
  );
  this.motorSpeed = 14;
}
ThrowLeftAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [-1.5, -1.5, -1.5, -1.5],
};
ThrowLeftAnimation.tlLeftElbow = { joint: "leftelbowjoint", frames: [1.5, 1.5, 1.5, 1.5] };
ThrowLeftAnimation.tlRightShoulder = { joint: "rightshoulderjoint", frames: [-2, -2, -2, -2] };
ThrowLeftAnimation.tlRightElbow = { joint: "rightelbowjoint", frames: [1.1, 1.1, 1.1, 1.1] };
function ThrowRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.THROW_RIGHT], 0);
  this.timeline.push(
    ThrowRightAnimation.tlLeftShoulder,
    ThrowRightAnimation.tlLeftElbow,
    ThrowRightAnimation.tlRightShoulder,
    ThrowRightAnimation.tlRightElbow
  );
  this.motorSpeed = 14;
}
ThrowRightAnimation.tlLeftShoulder = { joint: "leftshoulderjoint", frames: [2, 2, 2, 2] };
ThrowRightAnimation.tlLeftElbow = { joint: "leftelbowjoint", frames: [-1.1, -1.1, -1.1, -1.1] };
ThrowRightAnimation.tlRightShoulder = { joint: "rightshoulderjoint", frames: [1.5, 1.5, 1.5, 1.5] };
ThrowRightAnimation.tlRightElbow = { joint: "rightelbowjoint", frames: [-1.5, -1.5, -1.5, -1.5] };
function JetLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.JET_LEFT], 0);
  this.timeline.push(
    JetLeftAnimation.tlLeftHip,
    JetLeftAnimation.tlLeftKnee,
    JetLeftAnimation.tlRightHip,
    JetLeftAnimation.tlRightKnee
  );
  this.frameRepeat = !1;
}
JetLeftAnimation.tlLeftHip = { joint: "lefthipjoint", frames: [-0.55, -0.65, -0.75, -0.85] };
JetLeftAnimation.tlLeftKnee = { joint: "leftkneejoint", frames: [-0.57, -0.9, -1.4, -1.87] };
JetLeftAnimation.tlRightHip = { joint: "righthipjoint", frames: [0, 0, 0, 0] };
JetLeftAnimation.tlRightKnee = { joint: "rightkneejoint", frames: [-0.55, -0.65, -0.75, -0.85] };
function JetRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.JET_RIGHT], 0);
  this.timeline.push(
    JetRightAnimation.tlLeftHip,
    JetRightAnimation.tlLeftKnee,
    JetRightAnimation.tlRightHip,
    JetRightAnimation.tlRightKnee
  );
  this.frameRepeat = !1;
}
JetRightAnimation.tlLeftHip = { joint: "lefthipjoint", frames: [0, 0, 0, 0] };
JetRightAnimation.tlLeftKnee = { joint: "leftkneejoint", frames: [0.55, 0.65, 0.75, 0.85] };
JetRightAnimation.tlRightHip = { joint: "righthipjoint", frames: [0.55, 0.65, 0.75, 0.85] };
JetRightAnimation.tlRightKnee = { joint: "rightkneejoint", frames: [0.57, 0.9, 1.4, 1.87] };
function ReloadLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.RELOAD_LEFT], 4);
  this.timeline.push(
    ReloadLeftAnimation.tlLeftShoulder,
    ReloadLeftAnimation.tlLeftElbow,
    ReloadLeftAnimation.tlRightShoulder,
    ReloadLeftAnimation.tlRightElbow
  );
  this.motorSpeed = 6;
}
ReloadLeftAnimation.gearOffset = { x: 0, y: -40 };
ReloadLeftAnimation.gearOffsetSteps = 2;
ReloadLeftAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [-0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1, -0.1],
};
ReloadLeftAnimation.tlLeftElbow = {
  joint: "leftelbowjoint",
  frames: [1.85, 1.85, 1.85, 1.85, 1.85, 1.85, 1.85, 1.85, 1.85, 1.85],
};
ReloadLeftAnimation.tlRightShoulder = {
  joint: "rightshoulderjoint",
  frames: [0.3, 0.1, -0.1, 0.3, 0.6, 0.9, 0.6, 0.3, 0.1, 0.3],
};
ReloadLeftAnimation.tlRightElbow = {
  joint: "rightelbowjoint",
  frames: [2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2, 2.2],
};
function ReloadRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.RELOAD_RIGHT], 4);
  this.timeline.push(
    ReloadRightAnimation.tlLeftShoulder,
    ReloadRightAnimation.tlLeftElbow,
    ReloadRightAnimation.tlRightShoulder,
    ReloadRightAnimation.tlRightElbow
  );
  this.motorSpeed = 6;
}
ReloadRightAnimation.gearOffset = { x: 0, y: -40 };
ReloadRightAnimation.gearOffsetSteps = 2;
ReloadRightAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [-0.3, -0.1, 0.1, -0.3, -0.6, -0.9, -0.6, -0.3, -0.1, -0.3],
};
ReloadRightAnimation.tlLeftElbow = {
  joint: "leftelbowjoint",
  frames: [-2.2, -2.2, -2.2, -2.2, -2.2, -2.2, -2.2, -2.2, -2.2, -2.2],
};
ReloadRightAnimation.tlRightShoulder = {
  joint: "rightshoulderjoint",
  frames: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1],
};
ReloadRightAnimation.tlRightElbow = {
  joint: "rightelbowjoint",
  frames: [-1.85, -1.85, -1.85, -1.85, -1.85, -1.85, -1.85, -1.85, -1.85, -1.85],
};
function PunchLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.PUNCH_LEFT], 0);
  this.timeline.push(
    PunchLeftAnimation.tlLeftShoulder,
    PunchLeftAnimation.tlLeftElbow,
    PunchLeftAnimation.tlRightShoulder,
    PunchLeftAnimation.tlRightElbow
  );
  this.motorSpeed = 30;
}
PunchLeftAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [
    -2.1, -1.8, -1.5, -1.2, -0.9, -0.6, -0.3, -0.3, -0.3, -0.3, -0.3, -0.6, -0.9, -1.2, -1.5, -1.8,
  ],
};
PunchLeftAnimation.tlLeftElbow = {
  joint: "leftelbowjoint",
  frames: [-0.4, -0.2, -0, 0.2, 0.4, 0.7, 1, 1, 1.7, 1.7, 1.7, 1.7, 1, 0.4, 0.1, -0.2],
};
PunchLeftAnimation.tlRightShoulder = {
  joint: "rightshoulderjoint",
  frames: [
    -0.3, -0.3, -0.6, -0.9, -1.2, -1.5, -1.8, -2.1, -1.8, -1.5, -1.2, -0.9, -0.6, -0.3, -0.3, -0.3,
  ],
};
PunchLeftAnimation.tlRightElbow = {
  joint: "rightelbowjoint",
  frames: [1.7, 1.7, 1, 0.4, 0.1, -0.2, -0.4, -0.2, -0, 0.2, 0.4, 0.7, 1, 1, 1.7, 1.7],
};
function PunchRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.PUNCH_RIGHT], 0);
  this.timeline.push(
    PunchRightAnimation.tlLeftShoulder,
    PunchRightAnimation.tlLeftElbow,
    PunchRightAnimation.tlRightShoulder,
    PunchRightAnimation.tlRightElbow
  );
  this.motorSpeed = 30;
}
PunchRightAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [0.3, 0.3, 0.6, 0.9, 1.2, 1.5, 1.8, 2.1, 1.8, 1.5, 1.2, 0.9, 0.6, 0.3, 0.3, 0.3],
};
PunchRightAnimation.tlLeftElbow = {
  joint: "leftelbowjoint",
  frames: [-1.7, -1.7, -1, -0.4, -0.1, 0.2, 0.4, 0.2, 0, -0.2, -0.4, -0.7, -1, -1, -1.7, -1.7],
};
PunchRightAnimation.tlRightShoulder = {
  joint: "rightshoulderjoint",
  frames: [2.1, 1.8, 1.5, 1.2, 0.9, 0.6, 0.3, 0.3, 0.3, 0.3, 0.3, 0.6, 0.9, 1.2, 1.5, 1.8],
};
PunchRightAnimation.tlRightElbow = {
  joint: "rightelbowjoint",
  frames: [0.4, 0.2, 0, -0.2, -0.4, -0.7, -1, -1, -1.7, -1.7, -1.7, -1.7, -1, -0.4, -0.1, 0.2],
};
function FallLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.FALL_LEFT], 0);
  this.timeline.push(
    FallLeftAnimation.tlLeftHip,
    FallLeftAnimation.tlLeftKnee,
    FallLeftAnimation.tlRightHip,
    FallLeftAnimation.tlRightKnee
  );
  this.motorSpeed = 16;
}
FallLeftAnimation.tlLeftHip = { joint: "lefthipjoint", frames: [-0.3] };
FallLeftAnimation.tlLeftKnee = { joint: "leftkneejoint", frames: [-0.6] };
FallLeftAnimation.tlRightHip = { joint: "righthipjoint", frames: [0.1] };
FallLeftAnimation.tlRightKnee = { joint: "rightkneejoint", frames: [-0.3] };
function FallRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.FALL_RIGHT], 0);
  this.timeline.push(
    FallRightAnimation.tlLeftHip,
    FallRightAnimation.tlLeftKnee,
    FallRightAnimation.tlRightHip,
    FallRightAnimation.tlRightKnee
  );
  this.motorSpeed = 16;
}
FallRightAnimation.tlLeftHip = { joint: "lefthipjoint", frames: [-0.1] };
FallRightAnimation.tlLeftKnee = { joint: "leftkneejoint", frames: [0.3] };
FallRightAnimation.tlRightHip = { joint: "righthipjoint", frames: [0.3] };
FallRightAnimation.tlRightKnee = { joint: "rightkneejoint", frames: [0.6] };
function ProneLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.PRONE_LEFT], 0);
  this.timeline.push(
    ProneLeftAnimation.tlLeftHip,
    ProneLeftAnimation.tlLeftKnee,
    ProneLeftAnimation.tlRightHip,
    ProneLeftAnimation.tlRightKnee
  );
  this.offsets = [
    { x: 0, y: 0.04 },
    { x: 0, y: 0.8 },
    { x: 0, y: 0.12 },
    { x: 0, y: 0.16 },
    { x: 0, y: 0.2 },
    { x: 0, y: 0.24 },
    { x: 0, y: 0.28 },
    { x: 0, y: 0.32 },
  ];
  this.frameRepeat = !1;
  this.motorSpeed = 20;
}
ProneLeftAnimation.tlLeftHip = {
  joint: "lefthipjoint",
  frames: [-0.1, -0.15, -0.2, -0.25, -0.3, -0.35, -0.35, -0.35],
};
ProneLeftAnimation.tlLeftKnee = {
  joint: "leftkneejoint",
  frames: [-0.3, -0.3, -0.3, -0.3, -0.3, -0.3, -0.3, -0.3],
};
ProneLeftAnimation.tlRightHip = {
  joint: "righthipjoint",
  frames: [0.1, 0.1, -0, -0.1, -0.2, -0.3, -0.4, -0.5],
};
ProneLeftAnimation.tlRightKnee = {
  joint: "rightkneejoint",
  frames: [0.1, 0.05, 0, -0.05, -0.1, -0.15, -0.2, -0.25],
};
function ProneRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.PRONE_RIGHT], 0);
  this.timeline.push(
    ProneRightAnimation.tlLeftHip,
    ProneRightAnimation.tlLeftKnee,
    ProneRightAnimation.tlRightHip,
    ProneRightAnimation.tlRightKnee
  );
  this.offsets = [
    { x: 0, y: 0.04 },
    { x: 0, y: 0.8 },
    { x: 0, y: 0.12 },
    { x: 0, y: 0.16 },
    { x: 0, y: 0.2 },
    { x: 0, y: 0.24 },
    { x: 0, y: 0.28 },
    { x: 0, y: 0.32 },
  ];
  this.frameRepeat = !1;
  this.motorSpeed = 20;
}
ProneRightAnimation.tlLeftHip = {
  joint: "lefthipjoint",
  frames: [-0.1, -0.1, 0, 0.1, 0.2, 0.3, 0.4, 0.5],
};
ProneRightAnimation.tlLeftKnee = {
  joint: "leftkneejoint",
  frames: [-0.1, -0.05, -0, 0.05, 0.1, 0.15, 0.2, 0.25],
};
ProneRightAnimation.tlRightHip = {
  joint: "righthipjoint",
  frames: [0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.35, 0.35],
};
ProneRightAnimation.tlRightKnee = {
  joint: "rightkneejoint",
  frames: [0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3],
};
function ProneScopeGunLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.PRONE_SCOPE_LEFT], 0);
  this.timeline.push(
    ProneScopeGunLeftAnimation.tlLeftShoulder,
    ProneScopeGunLeftAnimation.tlLeftElbow,
    ProneScopeGunLeftAnimation.tlRightShoulder,
    ProneScopeGunLeftAnimation.tlRightElbow
  );
  this.motorSpeed = 30;
}
ProneScopeGunLeftAnimation.gearOffset = { x: -15, y: -25 };
ProneScopeGunLeftAnimation.gearOffsetSteps = 2;
ProneScopeGunLeftAnimation.tlLeftShoulder = { joint: "leftshoulderjoint", frames: [-1.5] };
ProneScopeGunLeftAnimation.tlLeftElbow = { joint: "leftelbowjoint", frames: [1.5] };
ProneScopeGunLeftAnimation.tlRightShoulder = { joint: "rightshoulderjoint", frames: [-1] };
ProneScopeGunLeftAnimation.tlRightElbow = { joint: "rightelbowjoint", frames: [1.8] };
function ProneScopeGunRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.PRONE_SCOPE_RIGHT], 0);
  this.timeline.push(
    ProneScopeGunRightAnimation.tlLeftShoulder,
    ProneScopeGunRightAnimation.tlLeftElbow,
    ProneScopeGunRightAnimation.tlRightShoulder,
    ProneScopeGunRightAnimation.tlRightElbow
  );
  this.motorSpeed = 30;
}
ProneScopeGunRightAnimation.gearOffset = { x: 15, y: -25 };
ProneScopeGunRightAnimation.gearOffsetSteps = 2;
ProneScopeGunRightAnimation.tlLeftShoulder = { joint: "leftshoulderjoint", frames: [1] };
ProneScopeGunRightAnimation.tlLeftElbow = { joint: "leftelbowjoint", frames: [-1.8] };
ProneScopeGunRightAnimation.tlRightShoulder = { joint: "rightshoulderjoint", frames: [1.5] };
ProneScopeGunRightAnimation.tlRightElbow = { joint: "rightelbowjoint", frames: [-1.5] };
function ProneEndAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.PRONE_END], 0);
}
function ProneMoveLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.PRONE_MOVE_LEFT], 1);
  this.timeline.push(
    ProneMoveLeftAnimation.tlLeftHip,
    ProneMoveLeftAnimation.tlLeftKnee,
    ProneMoveLeftAnimation.tlRightHip,
    ProneMoveLeftAnimation.tlRightKnee
  );
  this.frameRepeat = !0;
  this.motorSpeed = 7;
}
ProneMoveLeftAnimation.tlLeftHip = {
  joint: "lefthipjoint",
  frames: [
    -0.35, -0.37, -0.39, -0.42, -0.44, -0.46, -0.48, -0.5, -0.52, -0.55, -0.57, -0.59, -0.61, -0.63,
    -0.66, -0.68, -0.7, -0.7, -0.66, -0.61, -0.57, -0.52, -0.48, -0.44, -0.39, -0.35,
  ],
};
ProneMoveLeftAnimation.tlLeftKnee = {
  joint: "leftkneejoint",
  frames: [
    -1, -0.94, -0.88, -0.82, -0.77, -0.71, -0.65, -0.59, -0.53, -0.48, -0.42, -0.36, -0.3, -0.3,
    -0.36, -0.42, -0.47, -0.53, -0.59, -0.65, -0.71, -0.77, -0.82, -0.88, -0.94, -1,
  ],
};
ProneMoveLeftAnimation.tlRightHip = {
  joint: "righthipjoint",
  frames: [
    -1.5, -1.42, -1.33, -1.25, -1.17, -1.08, -1, -0.92, -0.83, -0.75, -0.67, -0.58, -0.5, -0.5,
    -0.58, -0.67, -0.75, -0.83, -0.92, -1, -1.08, -1.17, -1.25, -1.33, -1.42, -1.5,
  ],
};
ProneMoveLeftAnimation.tlRightKnee = {
  joint: "rightkneejoint",
  frames: [
    -0.5, -0.54, -0.58, -0.62, -0.67, -0.71, -0.75, -0.79, -0.83, -0.87, -0.92, -0.96, -1, -1,
    -0.96, -0.92, -0.87, -0.83, -0.79, -0.75, -0.71, -0.67, -0.62, -0.58, -0.54, -0.5,
  ],
};
function ProneMoveRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.PRONE_MOVE_RIGHT], 1);
  this.timeline.push(
    ProneMoveRightAnimation.tlLeftHip,
    ProneMoveRightAnimation.tlLeftKnee,
    ProneMoveRightAnimation.tlRightHip,
    ProneMoveRightAnimation.tlRightKnee
  );
  this.frameRepeat = !0;
  this.motorSpeed = 7;
}
ProneMoveRightAnimation.tlLeftHip = {
  joint: "lefthipjoint",
  frames: [
    1.5, 1.42, 1.33, 1.25, 1.17, 1.08, 1, 0.92, 0.83, 0.75, 0.67, 0.58, 0.5, 0.5, 0.58, 0.67, 0.75,
    0.83, 0.92, 1, 1.08, 1.17, 1.25, 1.33, 1.42, 1.5,
  ],
};
ProneMoveRightAnimation.tlLeftKnee = {
  joint: "leftkneejoint",
  frames: [
    0.5, 0.54, 0.58, 0.63, 0.67, 0.71, 0.75, 0.79, 0.83, 0.88, 0.92, 0.96, 1, 1, 0.96, 0.92, 0.88,
    0.83, 0.79, 0.75, 0.71, 0.67, 0.63, 0.58, 0.54, 0.5,
  ],
};
ProneMoveRightAnimation.tlRightHip = {
  joint: "righthipjoint",
  frames: [
    0.35, 0.38, 0.41, 0.44, 0.47, 0.5, 0.52, 0.55, 0.58, 0.61, 0.64, 0.67, 0.7, 0.7, 0.67, 0.64,
    0.61, 0.58, 0.55, 0.52, 0.5, 0.47, 0.44, 0.41, 0.38, 0.35,
  ],
};
ProneMoveRightAnimation.tlRightKnee = {
  joint: "rightkneejoint",
  frames: [
    1, 0.94, 0.88, 0.83, 0.77, 0.71, 0.65, 0.59, 0.53, 0.48, 0.42, 0.36, 0.3, 0.3, 0.36, 0.42, 0.48,
    0.53, 0.59, 0.65, 0.71, 0.77, 0.83, 0.88, 0.94, 1,
  ],
};
function SwitchLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.SWITCH_LEFT], 0);
  this.timeline.push(
    SwitchLeftAnimation.tlLeftShoulder,
    SwitchLeftAnimation.tlLeftElbow,
    SwitchLeftAnimation.tlRightShoulder,
    SwitchLeftAnimation.tlRightElbow
  );
  this.frameRepeat = !1;
  this.motorSpeed = 15;
}
SwitchLeftAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, -0.1],
};
SwitchLeftAnimation.tlLeftElbow = {
  joint: "leftelbowjoint",
  frames: [1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1],
};
SwitchLeftAnimation.tlRightShoulder = {
  joint: "rightshoulderjoint",
  frames: [-2, -2, -1.9, -1.8, -1.7, -1.6, -1.5, -1.4, -1.3, -1.2, -1.1, -0.5, -0],
};
SwitchLeftAnimation.tlRightElbow = {
  joint: "rightelbowjoint",
  frames: [2.9, 2.9, 2.9, 2.9, 2.9, 2.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1, 1.1],
};
function SwitchRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.SWITCH_RIGHT], 0);
  this.timeline.push(
    SwitchRightAnimation.tlLeftShoulder,
    SwitchRightAnimation.tlLeftElbow,
    SwitchRightAnimation.tlRightShoulder,
    SwitchRightAnimation.tlRightElbow
  );
  this.frameRepeat = !1;
  this.motorSpeed = 15;
}
SwitchRightAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [2, 2, 1.9, 1.8, 1.7, 1.6, 1.5, 1.4, 1.3, 1.2, 1.1, 0.5, 0],
};
SwitchRightAnimation.tlLeftElbow = {
  joint: "leftelbowjoint",
  frames: [-2.9, -2.9, -2.9, -2.9, -2.9, -2.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1],
};
SwitchRightAnimation.tlRightShoulder = {
  joint: "rightshoulderjoint",
  frames: [-1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, 0.1],
};
SwitchRightAnimation.tlRightElbow = {
  joint: "rightelbowjoint",
  frames: [-1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1, -1.1],
};
function JumpLeft2Animation() {
  Animation.call(this, Animation.DURATIONS[Animation.JUMP_LEFT_2], 0);
  this.timeline.push(
    JumpLeft2Animation.tlLeftHip,
    JumpLeft2Animation.tlLeftKnee,
    JumpLeft2Animation.tlRightHip,
    JumpLeft2Animation.tlRightKnee
  );
  this.frameRepeat = !1;
  this.motorSpeed = 20;
}
JumpLeft2Animation.tlLeftHip = { joint: "lefthipjoint", frames: [-0.85, -0.85, -0.85, -0.85] };
JumpLeft2Animation.tlLeftKnee = { joint: "leftkneejoint", frames: [-1.1, -1.1, -1.1, -1.1] };
JumpLeft2Animation.tlRightHip = { joint: "righthipjoint", frames: [0.8, 0.8, 0.8, 0.8] };
JumpLeft2Animation.tlRightKnee = { joint: "rightkneejoint", frames: [-0, -0, -0, -0] };
function JumpRight2Animation() {
  Animation.call(this, Animation.DURATIONS[Animation.JUMP_RIGHT_2], 0);
  this.timeline.push(
    JumpRight2Animation.tlLeftHip,
    JumpRight2Animation.tlLeftKnee,
    JumpRight2Animation.tlRightHip,
    JumpRight2Animation.tlRightKnee
  );
  this.frameRepeat = !1;
  this.motorSpeed = 20;
}
JumpRight2Animation.tlLeftHip = { joint: "lefthipjoint", frames: [-0.8, -0.8, -0.8, -0.8] };
JumpRight2Animation.tlLeftKnee = { joint: "leftkneejoint", frames: [0, 0, 0, 0] };
JumpRight2Animation.tlRightHip = { joint: "righthipjoint", frames: [0.85, 0.85, 0.85, 0.85] };
JumpRight2Animation.tlRightKnee = { joint: "rightkneejoint", frames: [1.1, 1.1, 1.1, 1.1] };
function ShootBowLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.SHOOT_BOW_LEFT], 0);
  this.timeline.push(
    ShootBowLeftAnimation.tlLeftShoulder,
    ShootBowLeftAnimation.tlLeftElbow,
    ShootBowLeftAnimation.tlRightShoulder,
    ShootBowLeftAnimation.tlRightElbow
  );
  this.motorSpeed = 40;
}
ShootBowLeftAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1],
};
ShootBowLeftAnimation.tlLeftElbow = {
  joint: "leftelbowjoint",
  frames: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
};
ShootBowLeftAnimation.tlRightShoulder = {
  joint: "rightshoulderjoint",
  frames: [
    -0.3, -0.3, -0.6, -0.9, -1.2, -1.5, -1.8, -2.1, -1.8, -1.5, -1.2, -0.9, -0.6, -0.3, -0.3, -0.3,
  ],
};
ShootBowLeftAnimation.tlRightElbow = {
  joint: "rightelbowjoint",
  frames: [1.7, 1.7, 1, 0.4, 0.1, -0.2, -0.4, -0.2, -0, 0.2, 0.4, 0.7, 1, 1, 1.7, 1.7],
};
function ShootBowRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.SHOOT_BOW_RIGHT], 0);
  this.timeline.push(
    ShootBowRightAnimation.tlLeftShoulder,
    ShootBowRightAnimation.tlLeftElbow,
    ShootBowRightAnimation.tlRightShoulder,
    ShootBowRightAnimation.tlRightElbow
  );
  this.motorSpeed = 40;
}
ShootBowRightAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [0.3, 0.3, 0.6, 0.9, 1.2, 1.5, 1.8, 2.1, 1.8, 1.5, 1.2, 0.9, 0.6, 0.3, 0.3, 0.3],
};
ShootBowRightAnimation.tlLeftElbow = {
  joint: "leftelbowjoint",
  frames: [-1.7, -1.7, -1, -0.4, -0.1, 0.2, 0.4, 0.2, 0, -0.2, -0.4, -0.7, -1, -1, -1.7, -1.7],
};
ShootBowRightAnimation.tlRightShoulder = {
  joint: "rightshoulderjoint",
  frames: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1],
};
ShootBowRightAnimation.tlRightElbow = {
  joint: "rightelbowjoint",
  frames: [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1],
};
function WaveLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.WAVE_LEFT], 0);
  this.timeline.push(WaveLeftAnimation.tlRightShoulder, WaveLeftAnimation.tlRightElbow);
  this.motorSpeed = 10;
}
WaveLeftAnimation.tlRightShoulder = {
  joint: "rightshoulderjoint",
  frames: [-4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4],
};
WaveLeftAnimation.tlRightElbow = {
  joint: "rightelbowjoint",
  frames: [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0],
};
function WaveRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.WAVE_RIGHT], 0);
  this.timeline.push(WaveRightAnimation.tlLeftShoulder, WaveRightAnimation.tlLeftElbow);
  this.motorSpeed = 10;
}
WaveRightAnimation.tlLeftShoulder = {
  joint: "leftshoulderjoint",
  frames: [4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4],
};
WaveRightAnimation.tlLeftElbow = {
  joint: "leftelbowjoint",
  frames: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
};
function SaluteLeftAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.SALUTE_LEFT], 0);
  this.timeline.push(SaluteLeftAnimation.tlRightShoulder, SaluteLeftAnimation.tlRightElbow);
  this.motorSpeed = 30;
}
SaluteLeftAnimation.tlRightShoulder = { joint: "rightshoulderjoint", frames: [-3] };
SaluteLeftAnimation.tlRightElbow = { joint: "rightelbowjoint", frames: [-1] };
function SaluteRightAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.SALUTE_RIGHT], 0);
  this.timeline.push(SaluteRightAnimation.tlLeftShoulder, SaluteRightAnimation.tlLeftElbow);
  this.motorSpeed = 30;
}
SaluteRightAnimation.tlLeftShoulder = { joint: "leftshoulderjoint", frames: [3] };
SaluteRightAnimation.tlLeftElbow = { joint: "leftelbowjoint", frames: [1] };
function ChatAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.CHAT], 0);
}
function ChatEndAnimation() {
  Animation.call(this, Animation.DURATIONS[Animation.CHAT_END], 0);
}
var Animations = {};
Animations[Animation.STAND] = new StandAnimation();
Animations[Animation.WALK_LEFT] = new WalkLeftAnimation();
Animations[Animation.WALK_RIGHT] = new WalkRightAnimation();
Animations[Animation.CROUCH_LEFT] = new CrouchLeftAnimation();
Animations[Animation.CROUCH_RIGHT] = new CrouchRightAnimation();
Animations[Animation.CROUCH_MOVE_LEFT] = new CrouchMoveLeftAnimation();
Animations[Animation.CROUCH_MOVE_RIGHT] = new CrouchMoveRightAnimation();
Animations[Animation.HOLD_GUN_LEFT] = new HoldGunLeftAnimation();
Animations[Animation.HOLD_GUN_RIGHT] = new HoldGunRightAnimation();
Animations[Animation.SCOPE_GUN_LEFT] = new ScopeGunLeftAnimation();
Animations[Animation.SCOPE_GUN_RIGHT] = new ScopeGunRightAnimation();
Animations[Animation.THROW_NADE_LEFT] = new ThrowNadeLeftAnimation();
Animations[Animation.THROW_NADE_RIGHT] = new ThrowNadeRightAnimation();
Animations[Animation.ROLL_LEFT] = new RollLeftAnimation();
Animations[Animation.ROLL_RIGHT] = new RollRightAnimation();
Animations[Animation.JUMP_LEFT] = new JumpLeftAnimation();
Animations[Animation.JUMP_RIGHT] = new JumpRightAnimation();
Animations[Animation.THROW_LEFT] = new ThrowLeftAnimation();
Animations[Animation.THROW_RIGHT] = new ThrowRightAnimation();
Animations[Animation.JET_LEFT] = new JetLeftAnimation();
Animations[Animation.JET_RIGHT] = new JetRightAnimation();
Animations[Animation.RELOAD_LEFT] = new ReloadLeftAnimation();
Animations[Animation.RELOAD_RIGHT] = new ReloadRightAnimation();
Animations[Animation.PUNCH_LEFT] = new PunchLeftAnimation();
Animations[Animation.PUNCH_RIGHT] = new PunchRightAnimation();
Animations[Animation.FALL_LEFT] = new FallLeftAnimation();
Animations[Animation.FALL_RIGHT] = new FallRightAnimation();
Animations[Animation.PRONE_LEFT] = new ProneLeftAnimation();
Animations[Animation.PRONE_RIGHT] = new ProneRightAnimation();
Animations[Animation.PRONE_SCOPE_LEFT] = new ProneScopeGunLeftAnimation();
Animations[Animation.PRONE_SCOPE_RIGHT] = new ProneScopeGunRightAnimation();
Animations[Animation.PRONE_END] = new ProneEndAnimation();
Animations[Animation.PRONE_MOVE_LEFT] = new ProneMoveLeftAnimation();
Animations[Animation.PRONE_MOVE_RIGHT] = new ProneMoveRightAnimation();
Animations[Animation.SWITCH_LEFT] = new SwitchLeftAnimation();
Animations[Animation.SWITCH_RIGHT] = new SwitchRightAnimation();
Animations[Animation.JUMP_LEFT_2] = new JumpLeft2Animation();
Animations[Animation.JUMP_RIGHT_2] = new JumpRight2Animation();
Animations[Animation.SHOOT_BOW_LEFT] = new ShootBowLeftAnimation();
Animations[Animation.SHOOT_BOW_RIGHT] = new ShootBowRightAnimation();
Animations[Animation.WAVE_LEFT] = new WaveLeftAnimation();
Animations[Animation.WAVE_RIGHT] = new WaveRightAnimation();
Animations[Animation.SALUTE_LEFT] = new SaluteLeftAnimation();
Animations[Animation.SALUTE_RIGHT] = new SaluteRightAnimation();
Animations[Animation.CHAT] = new ChatAnimation();
Animations[Animation.CHAT_END] = new ChatEndAnimation();
var physicsworker = {};
const b2WorldManifold = Box2D.Collision.b2WorldManifold,
  b2ContactListener = Box2D.b2ContactListener,
  b2DestructionListener = Box2D.b2DestructionListener,
  b2Filter = Box2D.b2Filter,
  b2BodyType = Box2D.b2BodyType || Box2D.b2_dynamicBody;
class PhysicsWorker {
  constructor(a) {
    this.count = 0;
    this.onMessage = a;
    this.timeWarp = 0.25;
    this.deltatime = (1 - this.timeWarp) / 60;
    this.continuous = {};
    this.contact = {};
    this.solved = {};
    this.containsFluid = !1;
    this.anchors = {};
    this.joints = {};
    this.fluids = {};
    this.submerged = {};
    this.hasSurfaced = {};
    this.hasSubmerged = {};
    this.entities = {};
    this.dynamics = {};
    this.kinematics = {};
    this.particles = {};
    this.particlesAdded = {};
    this.forcesApplied = [];
    this.expList = [];
    this.world = new b2World(new b2Vec2(PC.GRAVITY.x, PC.GRAVITY.y), !0);
    this.boundExplosionQueryResult = this.onExplosionQueryResult.bind(this);
    this.boundParticleQueryResult = this.onBoundParticleQueryResult.bind(this);
    this.contactListener = new b2ContactListener();
    this.destructionListener = new b2DestructionListener();
    this.destructionListener.SayGoodbyeJoint = this.onDestroyJoint.bind(this);
    this.beginManifold = new b2WorldManifold();
    this.preManifold = new b2WorldManifold();
    this.contactListener.BeginContact = this.beginContact.bind(this);
    this.contactListener.EndContact = this.endContact.bind(this);
    this.contactListener.PreSolve = this.preSolve.bind(this);
    this.world.SetContactListener(this.contactListener);
    this.world.SetDestructionListener(this.destructionListener);
    BodyFactory.world = this.world;
    this.MsgMap = [];
    this.MsgMap[PhysicsMessage.RESET] = this.resetSimulation.bind(this);
  }
  pushMessage(a) {
    this.MsgMap[a.t](a.d);
  }
  raycastBullet(a, b, c) {
    a = PhysicsWorker.RaycastBulletCallbackInst.Set(b, a);
    this.world.RayCast(a, b, c);
    return a.fix && a.pt
      ? {
          body: a.fix.m_body,
          p: a.pt,
          c: a.fix.m_filter.categoryBits,
          normal: a.normal,
          frac: a.frac,
        }
      : !1;
  }
  raycast(a, b, c) {
    const d = PhysicsWorker.RaycastCallbackInst.Set(b, a);
    this.world.RayCast(d, b, c);
    if (d.fix && d.pt) {
      b = d.fix.m_filter.categoryBits;
      c = d.fix.m_body;
      if (b === EntityCategory.LOCAL || b === EntityCategory.LOCAL2) {
        const e = c.m_xf.position.x - a.p.x / PC.PM_RATIO,
          f = c.m_xf.position.y - a.p.y / PC.PM_RATIO,
          g = Math.sqrt(e * e + f * f);
        for (let h = c.m_jointList; h; h = h.m_next) this.world.DestroyJoint(h.joint);
        c.ApplyImpulse(
          {
            x: 0.5 * a.p.vx + (e / g) * 4 + -4 + 8 * Math.random(),
            y: 0.5 * a.p.vy + (f / g) * 4 + -4 + 8 * Math.random(),
          },
          { x: d.pt.x, y: d.pt.y }
        );
      }
      return { p: d.pt, c: b, normal: d.normal, id: c ? c.GetUserData() : null };
    }
    return !1;
  }
  explosion(a, b) {
    let c = [];
    a = { x: a.x / PC.PM_RATIO, y: a.y / PC.PM_RATIO };
    var d = new b2AABB(a.x - b.radius, a.y - b.radius, a.x + b.radius, a.y + b.radius);
    this.world.QueryAABB(this.boundExplosionQueryResult, d);
    for (d = this.expList.length; 0 < d; ) {
      let h = this.expList[--d];
      if (void 0 === this.dynamics[h.m_userData] || this.dynamics[h.m_userData].ignoreExp) continue;
      var e = h.GetPosition(),
        f = e.x - a.x,
        g = e.y - a.y;
      let m = PhysicsWorker.ExplosionRayCallbackInst.Set(a, h);
      this.world.RayCast(m, a, e);
      m.fix ||
        ((e = Math.sqrt(f * f + g * g)),
        (f = Math.atan2(g, f)),
        (g = b.radius - Math.min(b.radius, e)),
        (g = Math.min((b.blast / b.radius) * g * 10, b.blast)),
        h._player ? (g *= 15) : h._parent && (g *= 0.25),
        (f = b2Vec2.Alloc(g * Math.cos(f), g * Math.sin(f))),
        h.ApplyImpulse(f, m.pt),
        b2Vec2.Free(f),
        c.push(h.m_userData));
    }
    this.expList.length = 0;
    return c;
  }
  resetSimulation() {
    this.world = new b2World(new b2Vec2(PC.GRAVITY.x, PC.GRAVITY.y), !0);
    this.world.SetContactListener(this.contactListener);
    this.world.SetDestructionListener(this.destructionListener);
    BodyFactory.world = this.world;
    this.forcesApplied.length = 0;
    this.anchors = {};
    this.joints = {};
    this.continuous = {};
    this.contact = {};
    this.solved = {};
    this.fluids = {};
    this.particlesAdded = {};
    this.containsFluid = !1;
    this.submerged = {};
    this.hasSurfaced = {};
    this.hasSubmerged = {};
    this.dynamics = {};
    this.kinematics = {};
    this.particles = {};
    this.entities = {};
  }
  onDestroyJoint(a) {
    a = a.GetUserData();
    this.joints[a] && (this.joints[a].GetBodyB().SetGravityScale(0.6), delete this.joints[a]);
  }
  connectBodies(a) {
    let b = this.dynamics[a.idA];
    var c = this.dynamics[a.idB];
    if (b && c) {
      var d = {
          type: GameAttribute.REVOLUTE_JOINT,
          motor: 0,
          motorTorque: 0,
          collide: 0,
          limit: 0,
          lowerAngle: 1.5 * Math.PI - 0.9,
          upperAngle: 1.5 * Math.PI + 0.9,
          angle: 0.6 * -Math.PI,
          id: a.idB,
        },
        e = b2Vec2.Alloc(-10, 0),
        f = b2Vec2.Alloc(0, 30);
      c.body.SetGravityScale(-1);
      this.joints[a.idB] = BodyFactory.createJoint(d, e, f, b.body, c.body);
      b2Vec2.Free(e);
      b2Vec2.Free(f);
      c = this.entities[a.idB];
      c.smooth = !0;
      c.slave = !0;
      b.connected = a.idB;
    } else console.log("## warning: cannot join bodies");
  }
  disconnectBodies(a) {
    var b = this.dynamics[a.idB];
    b && b.body
      ? (this.joints[a.idB] && this.world.DestroyJoint(this.joints[a.idB]),
        delete this.joints[a.idB],
        b.body.SetGravityScale(0.6),
        (b = this.entities[a.idB]),
        (b.smooth = !1),
        (b.slave = !1))
      : console.log("## warning: cannot break bodies");
    this.dynamics[a.idA] && delete this.dynamics[a.idA].connected;
  }
  add(a) {
    var b = a.id.toString();
    let c = BodyFactory.createBody(a),
      d = (this.entities[b] = { body: c, ref: a });
    b = { id: b };
    if (c.m_type === b2BodyType.b2_particleBody)
      (this.particles[b.id] = d),
        (b.x = c.pos.x * PC.PM_RATIO),
        (b.y = c.pos.y * PC.PM_RATIO),
        (b.r = 0),
        a.ttl && (d.ref._ttl = a.ttl),
        (this.particlesAdded[b.id] = d);
    else {
      var e = c.GetPosition();
      b.x = e.x * PC.PM_RATIO;
      b.y = e.y * PC.PM_RATIO;
      b.r = c.GetAngle();
      if (a.anchors)
        for (let m = 0, n = a.anchors.length; m < n; m++)
          if (((e = a.anchors[m]), (e.owner = c), (this.anchors[e.id] = e), this.joints[e.id])) {
            var f = this.anchors[this.joints[e.id].attr.anchorA],
              g = this.anchors[this.joints[e.id].attr.anchorB];
            f && g && BodyFactory.createJoint(this.joints[e.id].attr, f, g);
          }
      if (c.m_type === b2BodyType.b2_dynamicBody) {
        this.dynamics[b.id] = d;
        a.ttl && (d.ref._ttl = a.ttl);
        a.ignoreExp && (d.ignoreExp = a.ignoreExp);
        a.contact &&
          ((this.contact[b.id] = { body: c, fixtures: a.contact }),
          void 0 !== a.origin && (this.contact[b.id].origin = a.origin));
        a.continuous && (this.continuous[b.id] = { body: c, f: { x: 0, y: 0 }, changed: !1 });
        1 === a.local && ((d.local = 1), (d.ttl = a.ttl));
        if (a.ragdoll) {
          this.continuous[b.id].isPlayer = !0;
          d.facing = a.z / 10;
          d.active = 1;
          d.ragdoll = BodyFactory.createRagdoll(a.ragdoll.id, a.gi);
          d.animating = {};
          d.animate = a.a || { 0: 0, 8: 0 };
          b.anims = d.animate;
          if (void 0 !== a.fr) for (e = c.m_fixtureList; e; e = e.m_next) e.m_friction = a.fr;
          d.newAnims = !0;
          for (var h in a.ragdoll.id)
            (e = d.ragdoll[h]),
              (e._parent = b.id),
              e.SetPosition(d.body.GetPosition(), !1),
              (f = e.GetUserData()),
              e.contact
                ? ((g = { pen: -1 }), (this.contact[f] = { body: e, fixtures: [f] }))
                : (g = { wd: 6, bu: 0, id: h }),
              (this.entities[f] = this.dynamics[f] = { body: e, ref: g });
        }
        a.smooth && (d.smooth = !0);
        a.s ? c.SetAwake(!1) : c.SetAwake(!0);
      } else c.m_type === b2BodyType.b2_kinematicBody && (this.kinematics[b.id] = d);
      if (a.attr)
        for (h = 0; h < a.attr.length; h++)
          switch (((e = a.attr[h]), e.type)) {
            case GameAttribute.GRAVITY_SCALE:
              d.gOffset = parseFloat(e.offset) / PC.PM_RATIO;
              d.gRatio = parseFloat(e.ratio);
              d.gScale = c.GetGravityScale();
              break;
            case GameAttribute.FLUID:
              this.fluids[b.id] = d;
              d.density = e.d;
              d.ref.wa = parseFloat(e.w);
              this.containsFluid || (this.containsFluid = !0);
              break;
            default:
              (f = { owner: c, attr: e }),
                (this.joints[e.anchorA] = this.joints[e.anchorB] = f),
                this.anchors[e.anchorA] &&
                  this.anchors[e.anchorB] &&
                  BodyFactory.createJoint(f.attr, this.anchors[e.anchorA], this.anchors[e.anchorB]);
          }
    }
    this.onMessage({ type: PhysicsMessage.ADDED, data: b });
  }
  update(a) {
    if (a.decay) {
      var b = this.particles[a.i];
      if (b) {
        var c = this.dynamics[a.aid];
        c &&
          !c.active &&
          b.ref.lastHit !== a.aid &&
          ((b.ref.lastHit = a.aid),
          (b.body.vel.x *= b.ref.decay),
          (b.body.vel.y *= b.ref.decay),
          (a = b.body),
          (a = b2Vec2.Alloc(
            a.d * a.vel.x * PhysicsWorker.TimeDelta,
            a.d * a.vel.y * PhysicsWorker.TimeDelta
          )),
          c.ragdoll.torsoupper.ApplyImpulse(a, c.ragdoll.torsoupper.GetWorldCenter()),
          b2Vec2.Free(a));
      }
    } else {
      if ((b = this.dynamics[a.i])) {
        c = b.body;
        if (void 0 !== a.x && void 0 !== a.y && !b.slave) {
          var d = c.GetPosition();
          var e = a.x - d.x,
            f = a.y - d.y,
            g = Math.sqrt(e * e + f * f);
          if (b.smooth && b.local)
            if (2.5 < g) {
              if (
                ((d = { x: d.x + e, y: d.y + f }),
                void 0 !== b.connected && this.dynamics[b.connected].body.SetPosition(d, !1),
                b.ragdoll)
              )
                for (g = b.ragdoll.bodies.length; 0 < g--; ) {
                  var h = b.ragdoll.bodies[g].GetPosition();
                  b.ragdoll.bodies[g].SetPosition({ x: h.x + e, y: h.y + f }, !1);
                }
            } else
              (g = 1 - Clamp(0.85, 0.98, Math.sqrt(e * e + f * f))),
                (d = { x: d.x + e * g, y: d.y + f * g }),
                b.ragdoll &&
                  ((h = b.ragdoll.head.GetPosition()),
                  b.ragdoll.head.SetPosition({ x: h.x + e * g, y: h.y + f * g }, !1));
          else if (1 < g) {
            if (
              ((d = { x: d.x + e, y: d.y + f }),
              void 0 !== b.connected && this.dynamics[b.connected].body.SetPosition(d, !1),
              b.ragdoll)
            )
              for (g = b.ragdoll.bodies.length; 0 < g--; )
                (h = b.ragdoll.bodies[g].GetPosition()),
                  b.ragdoll.bodies[g].SetPosition({ x: h.x + e, y: h.y + f }, !1);
          } else d = { x: d.x + 0.4 * e, y: d.y + 0.4 * f };
        }
        if (void 0 !== b.ragdoll) {
          void 0 !== a.z && (b.facing = a.z / 10);
          if (void 0 !== a.fr)
            for (e = c.m_fixtureList; e; e = e.m_next)
              if ("-u" !== e.m_userData || b.prone || b.flipping) e.m_friction = a.fr;
          !a.local && b.animate && (b.newAnims = !1);
          if (void 0 !== a.active && ((b.active = a.active), !b.active)) {
            c.SetActive(!1);
            e = { x: 0, y: 0 };
            f = 0;
            if (void 0 !== a.bid) {
              if (((b.ref.killId = a.bid), (g = this.dynamics[a.bid])))
                (e = g.body.m_linearVelocity.Copy()),
                  (e.x *= 0.1),
                  (e.y *= 0.1),
                  g.ref.knockback && ((e.x *= g.ref.knockback), (e.y *= g.ref.knockback)),
                  (f = g.body.GetPosition()),
                  (g = { x: f.x + g.ref.vx, y: f.y + g.ref.vy }),
                  (f = Math.sqrt(e.x * e.x + e.y * e.y) * getDir(c.GetPosition(), f, g));
            } else
              a.exp
                ? ((e = c.m_linearVelocity),
                  (e.x *= -0.5),
                  (e.y *= -0.5),
                  (f = -0.3 + 0.6 * Math.random()))
                : ((e = c.m_linearVelocity), (e.x *= 0.1), (e.y *= 0.1), (f = 0));
            if (void 0 !== a.detach)
              for (let m = 0, n = a.detach.length; m < n; m++) {
                g = b.ragdoll[a.detach[m]];
                h = g.GetBodyA();
                let l = g.GetBodyB();
                this.world.DestroyJoint(g);
                h.m_linearVelocity.x += e.x - 1 + 2 * Math.random();
                h.m_linearVelocity.y += e.y - 1 + 2 * Math.random();
                l.m_linearVelocity.x += e.x - 1 + 2 * Math.random();
                l.m_linearVelocity.y += e.y - 1 + 2 * Math.random();
                h.SetAngularVelocity(f);
                l.SetAngularVelocity(f);
              }
            for (g = b.ragdoll.joints.length; 0 < g--; ) b.ragdoll.joints[g].EnableMotor(!1);
            b.ragdoll.leftelbowjoint.EnableLimit(!0);
            b.ragdoll.rightelbowjoint.EnableLimit(!0);
            for (g = b.ragdoll.bodies.length; 0 < g--; )
              (h = b.ragdoll.bodies[g]),
                (h.m_linearVelocity.x += e.x),
                (h.m_linearVelocity.y += e.y),
                h.SetAngularVelocity(f),
                -1 !== h.m_userData.indexOf("head", 2) || -1 !== h.m_userData.indexOf("torso", 2)
                  ? ((h.m_fixtureList.m_filter.categoryBits = EntityCategory.LOCAL),
                    (h.m_fixtureList.m_filter.maskBits = MaskBits[EntityCategory.LOCAL]))
                  : ((h.m_fixtureList.m_filter.categoryBits = EntityCategory.LOCAL2),
                    (h.m_fixtureList.m_filter.maskBits = MaskBits[EntityCategory.LOCAL2])),
                (h.m_fixtureList.m_filter.groupIndex = 0),
                h.m_fixtureList.SetSensor(!1),
                h.m_fixtureList.SyncFilterData(),
                (h._local = !0);
          }
        } else a.j || c.IsAwake() || c.SetAwake(!0);
        a.a && ((b.animate = a.a), (b.newAnims = !0));
        a.local ||
          ((b = this.continuous[a.i]) &&
            (void 0 !== a.n ||
              void 0 !== a.m ||
              (void 0 === a.n && b.f.x) ||
              (void 0 === a.m && b.f.y)) &&
            b.f.x !== a.n &&
            b.f.y !== a.m &&
            ((b.changed = !0), (b.f.x = a.n || 0), (b.f.y = a.m || 0), (b.count = 3)));
      } else {
        b = this.kinematics[a.i];
        if (!b) return;
        c = b.body;
        void 0 !== a.x && void 0 !== a.y && (d = a);
      }
      void 0 !== d
        ? void 0 !== a.r
          ? c.SetPositionAndAngle(d, a.r, !1)
          : c.SetPosition(d, !1)
        : void 0 !== a.r && c.SetAngle(a.r, !1);
      void 0 !== a.u
        ? c.SetLinearVelocity({ x: a.u, y: void 0 === a.v ? 0 : a.v })
        : void 0 !== a.v
        ? c.SetLinearVelocity({ x: 0, y: a.v })
        : c.m_linearVelocity.x && c.m_linearVelocity.y && c.SetLinearVelocity({ x: 0, y: 0 });
      void 0 !== a.w && c.SetAngularVelocity(a.w);
    }
  }
  updateFacing(a, b) {
    void 0 !== this.dynamics[a] && (this.dynamics[a].facing = b);
  }
  remove(a, b = !1) {
    let c = a.id;
    if (this.particles[c]) {
      var d = this.particles[c];
      b
        ? (d.ref.ttl = 1)
        : (this.onMessage({ type: PhysicsMessage.REMOVED, data: a }),
          delete this.particles[c],
          delete this.entities[c],
          d.body.free());
    } else if (((b = this.entities[c]), void 0 !== b)) {
      if (b.ragdoll)
        for (d = b.ragdoll.bodies.length; 0 < d--; ) {
          let e = b.ragdoll.bodies[d].GetUserData();
          delete this.entities[e];
          delete this.dynamics[e];
          this.world.DestroyBody(b.ragdoll.bodies[d]);
          this.submerged[e] && delete this.submerged[e];
        }
      delete this.entities[c];
      this.continuous[c] && delete this.continuous[c];
      this.contact[c] && delete this.contact[c];
      this.dynamics[c] ? delete this.dynamics[c] : this.kinematics[c] && delete this.kinematics[c];
      this.submerged[c] && delete this.submerged[c];
      BodyFactory.free(b.body);
      this.onMessage({ type: PhysicsMessage.REMOVED, data: a });
    }
  }
  submergeParticle(a, b) {
    void 0 === b.fluids
      ? ((b.fluids = [a]), (b.ref.sub = !0))
      : 0 === b.fluids.length
      ? (b.fluids.push(a), (b.ref.sub = !0))
      : -1 === b.fluids.indexOf(a) && b.fluids.push(a);
  }
  surfaceParticle(a, b) {
    1 < b.fluids.length
      ? b.fluids.splice(b.fluids.indexOf(a), 1)
      : ((b.fluids.length = 0), (b.ref.sub = !1));
  }
  onBoundParticleQueryResult(a) {
    if ((a = a.m_body.m_userData) && this.fluids[a]) {
      let b = PhysicsWorker.ActiveQueryParticle;
      this.submergeParticle(a, b);
      this.onMessage({
        type: PhysicsMessage.SUBMERGE,
        data: { id: b.ref.id, ss: b.ref.ttl > b.ref._ttl - 1 },
      });
    }
    return !0;
  }
  updateParticles(a) {
    PhysicsWorker.TimeDelta = a;
    let b = b2Vec2.Alloc();
    for (let n in this.particles) {
      let l = this.particles[n];
      var c = this.particlesAdded[n];
      let k = l.body;
      c
        ? ((PhysicsWorker.ActiveQueryParticle = l),
          this.world.QueryPoint(this.boundParticleQueryResult, {
            x: k.pos.x,
            y: k.pos.y + k.vel.y * a,
          }),
          (l.ref.wasSubmerged = !1))
        : ((l.ref.wasSubmerged = l.ref.sub),
          (l.ref.ttl -= App.FrameTime * (l.ref.sub ? l.ref.wttl ?? 2 : 1)));
      void 0 !== l.ref.update && l.ref.update(l, a);
      b.x = k.pos.x + a * k.vel.x;
      b.y = k.pos.y + a * k.vel.y;
      var d = 0;
      do {
        var e = void 0;
        let p;
        var f = this.raycastBullet(k, k.pos, b);
        if (f) {
          e = f.body;
          var g = f.normal,
            h = f.p;
          if (void 0 !== e._parent) {
            var m = this.entities[e.m_userData];
            if (void 0 === m.body._local) {
              e = norm(k.vel);
              k.pos.x = h.x + 0.001 * e.x;
              k.pos.y = h.y + 0.001 * e.y;
              e = k.pos.x - b.x;
              p = k.pos.y - b.y;
              e = Math.sqrt(e * e + p * p);
              h = {
                t: PhysicsWorker.Contact.CON,
                a: l,
                b: m,
                p: h,
                normal: g,
                pen: l.ref.pen - 1,
                local: !1,
              };
              void 0 === this.solved[n] ? (this.solved[n] = [h]) : this.solved[n].push(h);
              h.o = l.ref.origin;
              if (void 0 === l.ref.pen) h.rem = !0;
              else if (void 0 === l.ref.lastHit || l.ref.lastHit !== m.body._parent)
                (l.ref.lastHit = m.body._parent),
                  l.ref.pen--,
                  (k.vel.x *= l.ref.decay),
                  (k.vel.y *= l.ref.decay),
                  0 > l.ref.pen && (h.rem = !0);
              b.x = k.pos.x + a * k.vel.x * (1 - f.frac);
              b.y = k.pos.y + a * k.vel.y * (1 - f.frac);
              1e-4 > e && (h.rem = !0);
            } else if (
              ((f = b2Vec2.Alloc(k.d * k.vel.x * a, k.d * k.vel.y * a)),
              e.ApplyImpulse(f, h),
              b2Vec2.Free(f),
              (k.pos.x = h.x + 0.001 * k.vel.x),
              (k.pos.y = h.y + 0.001 * k.vel.y),
              (f = Math.min(Math.max(1 - a * k.ld, 0), 1)),
              (k.vel.x *= f),
              (k.vel.y = (k.vel.y + 20 * k.gs * a) * f),
              (h = {
                t: PhysicsWorker.Contact.CON,
                a: l,
                b: m,
                p: h,
                normal: g,
                pen: l.ref.pen,
                local: !0,
              }),
              (h.o = l.ref.origin),
              void 0 === this.solved[n] ? (this.solved[n] = [h]) : this.solved[n].push(h),
              !(6 > d++))
            )
              break;
          } else {
            if (e.m_type === b2BodyType.b2_dynamicBody)
              (d = b2Vec2.Alloc(k.d * k.vel.x * a, k.d * k.vel.y * a)),
                e.ApplyImpulse(d, h),
                b2Vec2.Free(d);
            else if (this.containsFluid && this.fluids[e.m_userData]) {
              this.submergeParticle(e.m_userData, l);
              g = norm(k.vel);
              k.pos.x = h.x + 0.001 * g.x;
              k.pos.y = h.y + 0.001 * g.y;
              h = k.pos.x - b.x;
              g = k.pos.y - b.y;
              if (0.001 > Math.sqrt(h * h + g * g)) {
                k.pos.x = b.x;
                k.pos.y = b.y;
                break;
              }
              continue;
            }
            0 < l.ref.rico
              ? Math.PI -
                  Math.abs(
                    Math.atan2(g.y * k.vel.x - g.x * k.vel.y, g.x * k.vel.x + g.y * k.vel.y)
                  ) >=
                (Math.PI / 180) * l.ref.ricoAngle
                ? ((d = norm(g)),
                  (m = 2 * dp(k.vel, d)),
                  (k.pos.x = h.x + 0.01 * d.x),
                  (k.pos.y = h.y + 0.01 * d.y),
                  (k.vel.x = (k.vel.x - m * d.x) * l.ref.re),
                  (k.vel.y = (k.vel.y - m * d.y) * l.ref.re),
                  (d = Math.min(Math.max(1 - a * k.ld, 0), 1)),
                  (k.vel.x *= d),
                  (k.vel.y = (k.vel.y + 20 * k.gs * a) * d),
                  (d = {
                    t: PhysicsWorker.Contact.CON,
                    a: l,
                    b: this.entities[e.m_userData],
                    p: h,
                    normal: g,
                    pen: l.ref.pen,
                    local: !1,
                  }),
                  0 >= l.ref.rico-- && (d.rem = !0))
                : ((k.pos.x = h.x),
                  (k.pos.y = h.y),
                  (l.ref.rico = 0),
                  (d = {
                    t: PhysicsWorker.Contact.CON,
                    a: l,
                    b: this.entities[e.m_userData],
                    p: h,
                    normal: g,
                    pen: 0,
                    rem: !0,
                    local: !1,
                  }))
              : ((k.pos.x = h.x),
                (k.pos.y = h.y),
                (d = {
                  t: PhysicsWorker.Contact.CON,
                  a: l,
                  b: this.entities[e.m_userData],
                  p: h,
                  normal: g,
                  pen: 0,
                  rem: !0,
                  local: !1,
                }));
            void 0 === this.solved[n] ? (this.solved[n] = [d]) : this.solved[n].push(d);
            break;
          }
        } else {
          c ||
            ((k.pos.x = b.x),
            (k.pos.y = b.y),
            (d = Math.min(Math.max(1 - a * k.ld, 0), 1)),
            (k.vel.x *= d),
            (k.vel.y = (k.vel.y + 20 * k.gs * a) * d));
          break;
        }
      } while (1);
      if (l.ref.sub)
        if (
          ((l.body.vel.y -= this.fluids[l.fluids[0]].density * (l.ref.bu ?? 0.5) * 100 * a),
          1 === l.fluids.length)
        )
          this.fluids[l.fluids[0]].body.m_fixtureList.TestPoint(l.body.pos) ||
            this.surfaceParticle(l.fluids[0], l);
        else
          for (d = 0; d < l.fluids.length; d++)
            (h = l.fluids[d]),
              this.fluids[h].body.m_fixtureList.TestPoint(l.body.pos) ||
                (this.surfaceParticle(h, l), d--);
      c ||
        ((c = {
          id: n,
          x: k.pos.x * PC.PM_RATIO,
          y: k.pos.y * PC.PM_RATIO,
          j: 1,
          vx: k.vel.x,
          vy: k.vel.y,
          ttl: l.ref.ttl,
          r: 0,
        }),
        this.solved[n] && (c.c = this.solved[n]),
        this.onMessage({ type: PhysicsMessage.UPDATE_OBJECT, data: c }));
      l.ref.sub && !l.ref.wasSubmerged
        ? ((l.body._gs = l.body.gs),
          (l.body._ld = l.body.ld),
          void 0 === l.ref.bu && (l.body.gs = 0.1 * l.body._gs),
          (l.body.ld = void 0 === l.ref.wd ? 2 * body._ld : l.ref.wd),
          this.onMessage({
            type: PhysicsMessage.SUBMERGE,
            data: {
              id: n,
              ss: void 0 !== l.ref.ttl && 0 < l.ref.ttl && l.ref.ttl > l.ref._ttl - 1,
            },
          }))
        : !l.ref.sub &&
          l.ref.wasSubmerged &&
          ((l.body.gs = l.body._gs),
          (l.body.ld = l.body._ld),
          this.onMessage({ type: PhysicsMessage.SURFACE, data: { id: n } }));
      0 > l.ref.ttl && this.remove(n);
    }
    b2Vec2.Free(b);
    this.particlesAdded = {};
  }
  onExplosionQueryResult(a) {
    let b = a.m_body;
    b.m_type === b2BodyType.b2_dynamicBody &&
      0 === (a.m_filter.categoryBits & PhysicsWorker.ExplosionQueryIgnore) &&
      (b._parent && !b._local
        ? ((a = this.dynamics[b._parent].body),
          -1 === this.expList.indexOf(a) && this.expList.push(a))
        : this.expList.push(b));
    return !0;
  }
  simulate(a) {
    var b;
    for (var c in this.continuous) {
      let g = this.continuous[c];
      if (g.isPlayer) {
        let h = g.body.m_linearVelocity;
        0 === g.count || (5 < Math.abs(h.x) && 1 > Math.abs(h.y))
          ? this.applyForce(g.body, { x: g.f.x, y: g.f.y }, g.body.GetWorldCenter())
          : g.count--;
      } else this.applyForce(g.body, { x: g.f.x, y: g.f.y }, g.body.GetWorldCenter());
    }
    this.deltatime = 0.001 * a * (1 - this.timeWarp);
    0 >= this.deltatime ? (this.deltatime = 0.001) : 1 < this.deltatime && (this.deltatime = 1);
    this.updateParticles(this.deltatime);
    this.world.Step(this.deltatime, 4, 2);
    this.clearForces();
    if (this.containsFluid) {
      for (b in this.hasSubmerged)
        (a = this.dynamics[b]),
          void 0 !== a &&
            ((c = a.body),
            a.ref.sub ||
              ((a.ref.sub = !0),
              (c._gs = c.GetGravityScale()),
              (c._ld = c.GetLinearDamping()),
              (c._ad = c.GetAngularDamping()),
              void 0 === a.ref.bu && c.SetGravityScale(0.1 * c._gs),
              c.SetLinearDamping(void 0 === a.ref.wd ? 2 * c._ld : a.ref.wd),
              c.SetAngularDamping(0.5 + 5 * c._ad),
              this.onMessage({
                type: PhysicsMessage.SUBMERGE,
                data: {
                  id: b,
                  ss: void 0 !== a.ref.ttl && 0 < a.ref.ttl && a.ref.ttl > a.ref._ttl - 1,
                },
              }),
              100 === a.ref.wd && (a.ref.ttl = 0)));
      for (d in this.submerged)
        if ((b = this.dynamics[d]))
          (a = b.body),
            this.applyForce(
              a,
              { x: 0, y: -this.fluids[this.submerged[d][0]].density * (b.ref.bu ?? 0.5) },
              a.GetWorldCenter()
            );
      for (e in this.hasSurfaced) {
        var d = this.dynamics[e];
        void 0 !== d &&
          ((b = d.body),
          d.ref.sub &&
            ((d.ref.sub = !1),
            b.SetGravityScale(b._gs),
            b.SetLinearDamping(b._ld),
            b.SetAngularDamping(b._ad),
            delete b._gs,
            delete b._ld,
            delete b._ad,
            this.onMessage({ type: PhysicsMessage.SURFACE, data: { id: e } })));
      }
      this.hasSubmerged = {};
      this.hasSurfaced = {};
    }
    for (f in this.kinematics) {
      var e = this.kinematics[f].body;
      d = e.GetPosition();
      b = e.m_linearVelocity;
      this.onMessage({
        type: PhysicsMessage.UPDATE_OBJECT,
        data: {
          id: f,
          x: d.x * PC.PM_RATIO,
          y: d.y * PC.PM_RATIO,
          r: e.GetAngle(),
          vx: b.x,
          vy: b.y,
        },
      });
    }
    for (let g in this.dynamics)
      if (((e = this.dynamics[g].body), e.IsAwake())) {
        var f = this.dynamics[g];
        d = e.GetPosition();
        b = e.m_linearVelocity;
        b = {
          id: g,
          x: d.x * PC.PM_RATIO,
          y: d.y * PC.PM_RATIO,
          r: e.GetAngle(),
          vx: b.x,
          vy: b.y,
        };
        if (
          void 0 !== f.ref.ttl &&
          0 <= f.ref.ttl &&
          ((f.ref.ttl -= App.FrameTime),
          f.ref.prime &&
            f.ref.ttl < f.ref.prime &&
            ((a = void 0 !== f.ref.explosive ? EntityCategory.GRENADE : EntityCategory.BULLET),
            (f.body.m_fixtureList.m_filter.categoryBits = a),
            (f.body.m_fixtureList.m_filter.maskBits = MaskBits[a]),
            (f.ref.prime = 0)),
          0 >= f.ref.ttl)
        ) {
          this.remove({ type: b2BodyType.b2_dynamicBody, id: g });
          continue;
        }
        void 0 !== f.ref.update && f.ref.update(f, this.deltatime);
        this.continuous[g] &&
          this.continuous[g].changed &&
          ((b.ax = this.continuous[g].f.x),
          (b.ay = this.continuous[g].f.y),
          (this.continuous[g].changed = !1));
        f.gRatio && e.SetGravityScale(f.gScale - (d.y - f.gOffset) * f.gRatio);
        void 0 !== f.facing &&
          f.active &&
          (this.animate(f), f.animate && f.newAnims && (b.a = f.animate), (b.z = f.facing));
        this.solved[g] && (b.c = this.solved[g]);
        this.contact[g] && this.contact[g].fr && (b.fr = this.contact[g].fr);
        this.onMessage({ type: PhysicsMessage.UPDATE_OBJECT, data: b });
      }
    this.solved = {};
    this.onMessage({ type: PhysicsMessage.UPDATED });
  }
  applyForce(a, b, c) {
    a.ApplyForce(b, c);
    this.forcesApplied.push(a);
  }
  clearForces() {
    for (let a = 0; a < this.forcesApplied.length; a++) {
      let b = this.forcesApplied[a];
      0 !== b.m_type && b.ClearForces();
    }
    this.forcesApplied.length = 0;
  }
  submerge(a, b) {
    void 0 !== this.dynamics[b] &&
      (void 0 === this.submerged[b] &&
        ((this.submerged[b] = []), this.hasSurfaced[b] || (this.hasSubmerged[b] = !0)),
      this.hasSurfaced[b] && delete this.hasSurfaced[b],
      this.submerged[b].push(a));
  }
  surface(a, b) {
    if (void 0 !== this.dynamics[b]) {
      var c = this.submerged[b];
      void 0 !== c &&
        (c.splice(c.indexOf(a), 1),
        0 === c.length &&
          (delete this.submerged[b], this.hasSubmerged[b] || (this.hasSurfaced[b] = !0)),
        this.hasSubmerged[b] && delete this.hasSubmerged[b]);
    }
  }
  beginContact(a) {
    if (a.IsTouching()) {
      if (a.m_isSensor) {
        var b = a.m_fixtureA.m_body.m_userData,
          c = a.m_fixtureB.m_body.m_userData;
        if (this.fluids[b]) {
          this.submerge(b, c);
          return;
        }
        if (this.fluids[c]) {
          this.submerge(c, b);
          return;
        }
      }
      b = a.m_fixtureA.m_body.m_userData;
      c = a.m_fixtureB.m_body.m_userData;
      if (void 0 === b || a.m_fixtureB.m_isSensor)
        void 0 === c ||
          a.m_fixtureA.m_isSensor ||
          ((d = new b2WorldManifold()),
          a.GetWorldManifold(d),
          (e = this.entities[b]),
          (c = {
            t: PhysicsWorker.Contact.CON,
            a: e,
            b: this.entities[c],
            p: a.m_fixtureB.m_isSensor ? a.m_fixtureB.m_body.GetPosition() : d.m_points[0].Copy(),
            normal: d.m_normal.Copy(),
            local: !0,
            pen: e.ref.pen,
          }),
          void 0 !== c.pen &&
            0 < c.pen &&
            e.ref.lastHit !== a.m_fixtureB.m_body._parent &&
            (e.ref.pen--, (e.ref.lastHit = a.m_fixtureB.m_body._parent), a.SetEnabled(!1)),
          this.solved[b] ? this.solved[b].push(c) : (this.solved[b] = [c]));
      else {
        var d = new b2WorldManifold();
        a.GetWorldManifold(d);
        var e = this.entities[c];
        b = {
          t: PhysicsWorker.Contact.CON,
          a: this.entities[b],
          b: e,
          p: a.m_fixtureA.m_isSensor ? a.m_fixtureA.m_body.GetPosition() : d.m_points[0].Copy(),
          normal: d.m_normal.Copy(),
          local: !0,
          pen: e.ref.pen,
        };
        void 0 !== b.pen &&
          0 < b.pen &&
          e.ref.lastHit !== a.m_fixtureA.m_body._parent &&
          (e.ref.pen--, (e.ref.lastHit = a.m_fixtureA.m_body._parent), a.SetEnabled(!1));
        this.solved[c] ? this.solved[c].push(b) : (this.solved[c] = [b]);
      }
    }
  }
  preSolve(a) {
    if (a.IsTouching()) {
      var b = a.m_fixtureA,
        c = a.m_fixtureB,
        d = b.m_filter.categoryBits & EntityCategory.BULLET,
        e = c.m_filter.categoryBits & EntityCategory.BULLET;
      null === b.m_body._parent && e
        ? ((d = c.m_body),
          (c = d.m_linearVelocity),
          (d = d.GetMass()),
          (c = b2Vec2.Alloc(
            d * c.x * PhysicsWorker.TimeDelta * 3,
            d * c.y * PhysicsWorker.TimeDelta * 3
          )),
          b.m_body.ApplyImpulse(c, b.m_body.GetWorldCenter()),
          b2Vec2.Free(c),
          a.SetEnabled(!1))
        : null === c.m_body._parent && d
        ? ((d = b.m_body),
          (b = d.m_linearVelocity),
          (d = d.GetMass()),
          (b = b2Vec2.Alloc(
            d * b.x * PhysicsWorker.TimeDelta * 3,
            d * b.y * PhysicsWorker.TimeDelta * 3
          )),
          c.m_body.ApplyImpulse(b, c.m_body.GetWorldCenter()),
          b2Vec2.Free(b),
          a.SetEnabled(!1))
        : c.m_body._parent && d
        ? ((d = b.m_body),
          (b = d.m_linearVelocity),
          (d = d.GetMass()),
          (b = b2Vec2.Alloc(d * b.x * PhysicsWorker.TimeDelta, d * b.y * PhysicsWorker.TimeDelta)),
          c.m_body.ApplyImpulse(b, c.m_body.GetWorldCenter()),
          b2Vec2.Free(b),
          a.SetEnabled(!1))
        : (b.m_body._parent &&
            e &&
            ((e = c.m_body),
            (d = e.m_linearVelocity),
            (e = e.GetMass()),
            (d = b2Vec2.Alloc(
              e * d.x * PhysicsWorker.TimeDelta,
              e * d.y * PhysicsWorker.TimeDelta
            )),
            b.m_body.ApplyImpulse(d, b.m_body.GetWorldCenter()),
            b2Vec2.Free(d),
            a.SetEnabled(!1)),
          (c = c.m_body.m_userData),
          this.contact[b.m_body.m_userData]
            ? a.m_fixtureB.m_filter.categoryBits &
                (EntityCategory.ITEM | EntityCategory.AGENT | EntityCategory.ENTITY) &&
              a.SetEnabled(!1)
            : this.contact[c] &&
              a.m_fixtureA.m_filter.categoryBits &
                (EntityCategory.ITEM | EntityCategory.AGENT | EntityCategory.ENTITY) &&
              a.SetEnabled(!1));
    }
  }
  endContact(a) {
    if (a.m_isSensor) {
      let b = a.m_fixtureA.m_body.m_userData;
      a = a.m_fixtureB.m_body.m_userData;
      this.fluids[b] ? this.surface(b, a) : this.fluids[a] && this.surface(a, b);
    }
  }
  animate(a) {
    const b = a.ragdoll;
    var c = b.animations;
    const d = a.body.GetPosition();
    var e = 0,
      f = a.flipping ? 0.3 * -Math.sin(0.5 * (a.flipAngle - Math.PI05)) * a.flipDir : 0;
    let g;
    if (c) {
      var h = a.body.GetUserData(),
        m = {};
      const r =
        AudioManager.CamDistance({ x: d.x * PC.PM_RATIO, y: d.y * PC.PM_RATIO }) <
        0.75 * App.ClientWidth;
      for (let q in a.animate) {
        if ("_" === q) continue;
        a.animating[q] = m[q] = !0;
        var n = c[q];
        var l = n.offsets.length;
        n[h] || (n[h] = { frame: 0, delay: 0 });
        let t = n[h].frame;
        e += n.offsets[t % l].x;
        f += n.offsets[t % l].y;
        if (n[h].delay === n.frequency) {
          let u = n.timeline.length;
          for (; 0 < u--; )
            (g = n.timeline[u]),
              (l = b[g.joint]),
              l.SetMotorSpeed(ShortAngle(l.GetJointAngle(), g.frames[t]) * n.motorSpeed);
          App.HasFocus &&
            r &&
            n.soundFx &&
            n.soundFx[t] &&
            (n.soundFx.finish
              ? n.soundFx[t].audio.playing() || n.soundFx[t].audio.play()
              : n.soundFx[t].audio.play());
          n[h].delay = 0;
          n[h].frame = t === n.frames - 1 ? (n.frameRepeat ? 0 : t) : t + 1;
        } else n[h].delay++;
      }
      for (let q in a.animating) m[q] || (delete c[q][h], delete a.animating[q]);
    }
    n = a.body.m_linearVelocity;
    c = a.body.GetAngle();
    for (h = b.bodies.length; 0 < h--; ) b.bodies[h].SetLinearVelocity(n);
    a.prone
      ? void 0 !== a.animate[Animation.PRONE_END]
        ? 0.1 < Math.abs(a.proneAngle) &&
          (void 0 !== a.animate[Animation.PRONE_LEFT]
            ? (a.proneAngle += (0.47 * Math.PI) / 14)
            : void 0 !== a.animate[Animation.PRONE_RIGHT] &&
              (a.proneAngle -= (0.47 * Math.PI) / 14))
        : void 0 === a.animate[Animation.PRONE_LEFT] &&
          void 0 === a.animate[Animation.PRONE_RIGHT] &&
          ((a.proneAngle = 0),
          (a.prone = !1),
          a.body.SetAngle(Math.PI05, !1),
          b.torsolower.SetAngle(c + Math.PI05, !1))
      : void 0 !== a.animate[Animation.PRONE_LEFT]
      ? ((a.prone = !0), (a.proneInLeft = 14), (a.proneAngle = 0))
      : void 0 !== a.animate[Animation.PRONE_RIGHT] &&
        ((a.prone = !0), (a.proneInRight = 14), (a.proneAngle = 0));
    if (a.prone) {
      var k = a.facing - (c - Math.PI05 - a.proneAngle);
      n = !1;
      k <= Math.PI05 && k >= -Math.PI05 && (n = !0);
      k = (n ? k - Math.PI : k) + 0.35 * Math.PI;
      c += Math.PI;
      var p;
      void 0 !== a.animate[Animation.PRONE_LEFT]
        ? (p = k + a.proneAngle - 2 * Math.PI)
        : void 0 !== a.animate[Animation.PRONE_RIGHT] && (p = k + a.proneAngle - 0.75 * Math.PI);
      h = Math.abs(1.3 * b.scale);
      m = Math.abs(0.7 * b.scale);
      0 < a.proneInLeft
        ? (a.proneInLeft--,
          (a.proneAngle -= (0.45 * Math.PI) / 14),
          (p = k + a.proneAngle - 2.2 * Math.PI),
          a.body.SetAngle(Math.PI05 + a.proneAngle, !1))
        : 0 < a.proneInRight
        ? (a.proneInRight--,
          (a.proneAngle += (0.45 * Math.PI) / 14),
          (p = k + a.proneAngle - 0.55 * Math.PI),
          a.body.SetAngle(Math.PI05 + a.proneAngle, !1))
        : ((a.proneInLeft = 0),
          (a.proneInRight = 0),
          void 0 === a.animate[Animation.PRONE_END]
            ? (a.proneAngle =
                void 0 === a.animate[Animation.PRONE_LEFT] ? 0.45 * Math.PI : 0.45 * -Math.PI)
            : (a.body.SetPositionAndAngle(d, Math.PI05 + a.proneAngle, !1),
              (p = n ? k + a.proneAngle - 2.2 * Math.PI : k + a.proneAngle - 0.55 * Math.PI)));
      void 0 !== p && b.head.SetAngle(p, !1);
      b.torsoupper.SetPositionAndAngle(
        { x: h * Math.cos(c) + d.x + e, y: h * Math.sin(c) + d.y + f },
        c - Math.PI05 - 0.4 * a.proneAngle,
        !1
      );
      b.torsolower.SetPositionAndAngle(
        { x: m * Math.cos(c) + d.x + e, y: m * Math.sin(c) + d.y + f },
        c - Math.PI05 + 0.4 * a.proneAngle,
        !1
      );
    } else
      (n = a.facing - (c - Math.PI05)),
        (h = !1),
        n <= Math.PI05 && n >= -Math.PI05 && (h = !0),
        (n = h ? n - Math.PI : n),
        (p = c + Math.PI),
        a.flipping
          ? ((c =
              (!a.flipFacingLeft && 1 === a.flipDir) || (a.flipFacingLeft && -1 === a.flipDir)
                ? 1
                : -1),
            (
              1 === a.flipDir
                ? a.flipAngle < 2 * Math.PI + Math.PI05
                : a.flipAngle > -(2 * Math.PI - Math.PI05)
            )
              ? ((a.flipAngle += 0.18 * a.flipDir),
                (k = a.flipAngle + 0.5 * Math.PI),
                b.armrightupper.SetAngle(k, !1),
                b.armleftupper.SetAngle(k, !1),
                b.legrightupper.SetAngle(k, !1),
                b.legleftupper.SetAngle(k, !1),
                b.legrightlower.SetAngle(
                  k + 2.5 * Math.sin(0.5 * (a.flipAngle - Math.PI05)) * c,
                  !1
                ),
                b.legleftlower.SetAngle(
                  k + 1.5 * Math.sin(0.5 * (a.flipAngle - Math.PI05)) * c,
                  !1
                ),
                b.head.SetAngle(
                  a.flipAngle + Math.PI05 + 2 * Math.sin(0.5 * (a.flipAngle - Math.PI05)),
                  !1
                ),
                a.body.SetAngle(a.flipAngle, !1),
                (k = a.flipAngle + Math.PI05))
              : ((a.flipping = !1), (a.flipAngle = Math.PI05), a.body.SetAngle(Math.PI05, !1)))
          : (void 0 !== a.animate[Animation.ROLL_LEFT]
              ? ((a.flipping = !0),
                (a.flipDir = -1),
                (a.flipFacingLeft = h),
                (a.flipAngle = Math.PI05))
              : void 0 !== a.animate[Animation.ROLL_RIGHT] &&
                ((a.flipping = !0),
                (a.flipDir = 1),
                (a.flipFacingLeft = h),
                (a.flipAngle = Math.PI05)),
            (k = p + 0.8 * (n + Math.PI > Math.PI05 ? n - Math.PI : n + Math.PI) - Math.PI05),
            b.head.SetAngle(n, !1)),
        (a = Math.abs(1.3 * b.scale)),
        (c = Math.abs(0.7 * b.scale)),
        void 0 !== k
          ? b.torsoupper.SetPositionAndAngle(
              { x: a * Math.cos(p) + d.x + e, y: a * Math.sin(p) + d.y + f },
              k,
              !1
            )
          : b.torsoupper.SetPosition(
              { x: a * Math.cos(p) + d.x + e, y: a * Math.sin(p) + d.y + f },
              !1
            ),
        b.torsolower.SetPositionAndAngle(
          { x: c * Math.cos(p) + d.x + e, y: c * Math.sin(p) + d.y + f },
          p - Math.PI05,
          !1
        );
  }
}
class ExplosionRayCallback {
  constructor(a, b) {
    this.fix = null;
    this.frac = 0;
    this.pt = a;
    this.body = b;
  }
  Set(a, b) {
    this.fix = null;
    this.frac = 0;
    this.pt = a;
    this.body = b;
    return this;
  }
  ReportFixture(a, b, c, d) {
    if (
      a.m_body.m_type !== b2BodyType.b2_staticBody ||
      (a.m_body.m_type === b2BodyType.b2_staticBody && a.m_isSensor)
    )
      return -1;
    this.fix = a;
    this.frac = d;
    this.pt = b;
    return 1;
  }
}
class RaycastCallback {
  constructor(a, b) {
    this.fix = null;
    this.frac = 0;
    this.pt = a;
    this.origin = b;
  }
  Set(a, b) {
    this.fix = null;
    this.frac = 0;
    this.pt = a;
    this.origin = b;
    return this;
  }
  ReportFixture(a, b, c, d) {
    if (
      a.m_filter.groupIndex === this.origin.p.gi ||
      a.m_filter.categoryBits & RaycastCallback.Passable ||
      (a.m_isSensor && !(a.m_filter.categoryBits & EntityCategory.LIMB))
    )
      return -1;
    this.fix = a;
    this.frac = d;
    this.pt = b;
    this.normal = c;
    return d;
  }
}
RaycastCallback.Passable =
  EntityCategory.OPEN_WORLD |
  EntityCategory.BRIDGE |
  EntityCategory.ZONE |
  EntityCategory.OBJECTIVE |
  EntityCategory.AGENT |
  EntityCategory.ENTITY |
  EntityCategory.ITEM_BARRIER;
class RaycastBulletCallback {
  constructor(a, b) {
    this.fix = null;
    this.frac = 0;
    this.pt = a;
    this.origin = b;
  }
  Set(a, b) {
    this.fix = null;
    this.frac = 0;
    this.pt = a;
    this.origin = b;
    return this;
  }
  ReportFixture(a, b, c, d) {
    if (
      (this.origin.gi && a.m_filter.groupIndex === this.origin.gi) ||
      a.m_filter.categoryBits & RaycastBulletCallback.Passable ||
      (a.m_isSensor &&
        !(a.m_filter.categoryBits & (EntityCategory.LIMB | EntityCategory.STATIC_WORLD)))
    )
      return -1;
    this.fix = a;
    this.frac = d;
    this.pt = b;
    this.normal = c;
    return d;
  }
}
RaycastBulletCallback.Passable =
  EntityCategory.OPEN_WORLD |
  EntityCategory.BRIDGE |
  EntityCategory.ZONE |
  EntityCategory.OBJECTIVE |
  EntityCategory.AGENT |
  EntityCategory.ENTITY |
  EntityCategory.PARTICLE |
  EntityCategory.ITEM_BARRIER;
PhysicsWorker.ExplosionQueryIgnore =
  EntityCategory.OBJECTIVE |
  EntityCategory.ZONE |
  EntityCategory.PARTICLE |
  EntityCategory.AGENT |
  EntityCategory.ITEM_BARRIER;
PhysicsWorker.ExplosionRayCallbackInst = new ExplosionRayCallback();
PhysicsWorker.RaycastCallbackInst = new RaycastCallback();
PhysicsWorker.RaycastBulletCallbackInst = new RaycastBulletCallback();
PhysicsWorker.ActiveQueryParticle = null;
PhysicsWorker.TimeDelta = 1;
PhysicsWorker.Contact = { PRE: 0, CON: 1, PST: 2 };
var shapecircle = {};
function ShapeCircle(a) {
  const b = a.sh[0],
    c = ShapeCircle.FixDef;
  c.filter.categoryBits = b.c;
  c.filter.maskBits = MaskBits[c.filter.categoryBits];
  c.filter.groupIndex = void 0 !== a.gi ? a.gi : 0;
  c.density = b.d ?? 1;
  c.friction = b.fr ?? 0.9;
  c.restitution = b.re ?? 0.3;
  c.isSensor = b.isSensor || !1;
  ShapeCircle.Shape.SetRadius(b.radius / PC.PM_RATIO);
  c.shape = ShapeCircle.Shape;
  a = this.CreateFixture(c);
  b.minRestitution && (a.minRestitution = !0);
  return this;
}
ShapeCircle.FixDef = new b2FixtureDef();
ShapeCircle.Shape = new b2CircleShape();
var shapecompound = {};
function ShapeCompound(a) {
  let b = a.sh || [];
  for (let c = 0; c < b.length; c++) {
    let d = b[c],
      e = ShapeCompound.FixDef;
    e.density = void 0 !== d.d ? d.d : a.d ?? 1;
    e.friction = void 0 !== d.fr ? d.fr : a.fr ?? 0.9;
    e.restitution = void 0 !== d.re ? d.re : a.re ?? 0.3;
    e.isSensor = void 0 !== d.s ? d.s : a.s;
    e.filter.categoryBits =
      2 == a.type && d.c === EntityCategory.STATIC_WORLD ? EntityCategory.DYNAMIC_WORLD : d.c;
    e.filter.maskBits = MaskBits[e.filter.categoryBits];
    e.filter.groupIndex = a.gi ?? 0;
    if (d.t === GameShape.CIRCLE)
      (ShapeCompound.CircleShape.m_radius = d.radius / PC.PM_RATIO),
        d.o && ShapeCompound.CircleShape.m_p.Set(d.o.x / PC.PM_RATIO, d.o.y / PC.PM_RATIO),
        (e.shape = ShapeCompound.CircleShape);
    else {
      if (d.t === GameShape.POLYGON) {
        let f = ShapeCompound.PolyBuffer;
        0 < polyAreaTri(d.v[0], d.v[1], d.v[2])
          ? ((f[0].x = d.v[2].x / PC.PM_RATIO),
            (f[0].y = d.v[2].y / PC.PM_RATIO),
            (f[1].x = d.v[1].x / PC.PM_RATIO),
            (f[1].y = d.v[1].y / PC.PM_RATIO),
            (f[2].x = d.v[0].x / PC.PM_RATIO),
            (f[2].y = d.v[0].y / PC.PM_RATIO))
          : ((f[0].x = d.v[0].x / PC.PM_RATIO),
            (f[0].y = d.v[0].y / PC.PM_RATIO),
            (f[1].x = d.v[1].x / PC.PM_RATIO),
            (f[1].y = d.v[1].y / PC.PM_RATIO),
            (f[2].x = d.v[2].x / PC.PM_RATIO),
            (f[2].y = d.v[2].y / PC.PM_RATIO));
        ShapeCompound.PolygonShape.SetAsVector(f, 3);
      } else
        ShapeCompound.PolygonShape.SetAsOrientedBox(
          d.w / PC.PM_RATIO,
          d.h / PC.PM_RATIO,
          d.o ? new b2Vec2(d.o.x / PC.PM_RATIO, d.o.y / PC.PM_RATIO) : new b2Vec2(0, 0),
          d.r
        );
      e.shape = ShapeCompound.PolygonShape;
    }
    this.CreateFixture(e);
  }
  return this;
}
ShapeCompound.FixDef = new b2FixtureDef();
ShapeCompound.CircleShape = new b2CircleShape();
ShapeCompound.PolygonShape = new b2PolygonShape();
ShapeCompound.PolyBuffer = [new b2Vec2(), new b2Vec2(), new b2Vec2()];
var shapeplayer = {};
function ShapePlayer(a) {
  ShapePlayer.RectFixture1.filter.categoryBits = EntityCategory.AGENT;
  ShapePlayer.RectFixture1.filter.maskBits = MaskBits[EntityCategory.AGENT];
  ShapePlayer.RectFixture1.filter.groupIndex = a.gi || 0;
  ShapePlayer.RectFixture1.density = 2.5;
  ShapePlayer.RectFixture1.friction = 30;
  ShapePlayer.RectFixture1.restitution = 0.01;
  ShapePlayer.RectFixture1.shape = ShapePlayer.RectShape;
  ShapePlayer.RectShape.SetAsBox(0.558, 0.27);
  ShapePlayer.RectFixture1.userData = "-m";
  this.CreateFixture(ShapePlayer.RectFixture1);
  ShapePlayer.RectFixture2.shape = ShapePlayer.RectShape;
  ShapePlayer.RectFixture2.density = 0;
  ShapePlayer.RectFixture2.userData = "-z";
  ShapePlayer.RectFixture2.filter.categoryBits = EntityCategory.ENTITY;
  ShapePlayer.RectFixture2.filter.maskBits = MaskBits[EntityCategory.ENTITY];
  ShapePlayer.RectFixture2.isSensor = !0;
  this.CreateFixture(ShapePlayer.RectFixture2);
  ShapePlayer.CircleShape.m_radius = 0.279;
  ShapePlayer.CircleShape.m_p.Set(-0.558, 0);
  ShapePlayer.CircleFixture.filter.categoryBits = EntityCategory.AGENT;
  ShapePlayer.CircleFixture.filter.maskBits = MaskBits[EntityCategory.AGENT];
  ShapePlayer.CircleFixture.filter.groupIndex = a.gi || 0;
  ShapePlayer.CircleFixture.userData = "-u";
  ShapePlayer.CircleFixture.shape = ShapePlayer.CircleShape;
  ShapePlayer.CircleFixture.density = 2.5;
  ShapePlayer.CircleFixture.friction = 0.1;
  ShapePlayer.CircleFixture.restitution = 0.01;
  this.CreateFixture(ShapePlayer.CircleFixture);
  ShapePlayer.CircleFixture.friction = 30;
  ShapePlayer.CircleShape.m_p.Set(0.658, 0);
  ShapePlayer.CircleFixture.userData = "-l";
  this.CreateFixture(ShapePlayer.CircleFixture).minRestitution = !0;
  this.SetFixedRotation(!0);
  this.SetLinearDamping(0.9);
  this.SetSleepingAllowed(!1);
  ShapePlayer.FeetFixture.density = 0;
  ShapePlayer.FeetFixture.isSensor = !0;
  ShapePlayer.FeetFixture.userData = "-f";
  ShapePlayer.FeetFixture.filter.categoryBits = EntityCategory.AGENT;
  ShapePlayer.FeetFixture.filter.maskBits = MaskBits[EntityCategory.ITEM];
  ShapePlayer.RectShape.SetAsOrientedBox(0.5, 0.2, new b2Vec2(0.558 * 1.5, 0));
  ShapePlayer.FeetFixture.shape = ShapePlayer.RectShape;
  ShapePlayer.FeetFixture.filter.groupIndex = a.gi || 0;
  this.CreateFixture(ShapePlayer.FeetFixture);
  this.SetGravityScale(1);
  this.SetBullet(!1);
  return this;
}
ShapePlayer.RectShape = new b2PolygonShape();
ShapePlayer.CircleShape = new b2CircleShape();
ShapePlayer.CircleFixture = new b2FixtureDef();
ShapePlayer.RectFixture1 = new b2FixtureDef();
ShapePlayer.RectFixture2 = new b2FixtureDef();
ShapePlayer.FeetFixture = new b2FixtureDef();
var shaperectangle = {};
function ShapeRectangle(a) {
  const b = a.sh[0],
    c = ShapeRectangle.FixDef;
  c.filter.categoryBits = b.c;
  c.filter.maskBits = MaskBits[c.filter.categoryBits];
  c.filter.groupIndex = a.gi ?? 0;
  c.density = b.d ?? 1;
  c.friction = b.fr ?? 0.9;
  c.restitution = b.re ?? 0.3;
  c.isSensor = b.isSensor || !1;
  ShapeRectangle.Shape.SetAsBox(b.width / PC.PM_RATIO, b.height / PC.PM_RATIO);
  c.shape = ShapeRectangle.Shape;
  this.CreateFixture(c);
  return this;
}
ShapeRectangle.FixDef = new b2FixtureDef();
ShapeRectangle.Shape = new b2PolygonShape();
var shaperoundedrect = {};
function ShapeRoundedRect(a) {
  var b = a.sh[0],
    c = new b2PolygonShape(),
    d = new b2CircleShape(),
    e = new b2FixtureDef(),
    f = new b2FixtureDef();
  f.filter.categoryBits = b.c;
  f.filter.maskBits = MaskBits[f.filter.categoryBits];
  f.filter.groupIndex = a.gi ?? 0;
  f.density = b.d ?? 1;
  f.friction = b.fr ?? 0.9;
  f.restitution = b.re ?? 0.3;
  f.isSensor = b.isSensor || !1;
  c.SetAsBox(b.width / PC.PM_RATIO, b.height / PC.PM_RATIO);
  f.shape = c;
  this.CreateFixture(f);
  d.m_radius = (b.height * (1.075 - 0.1 * b.height)) / PC.PM_RATIO;
  d.m_p.Set(-b.width / PC.PM_RATIO, 0);
  e.filter.categoryBits = b.c;
  e.filter.maskBits = MaskBits[e.filter.categoryBits];
  e.filter.groupIndex = a.gi || 0;
  e.shape = d;
  e.density = b.d ?? 1;
  e.friction = b.fr ?? 0.9;
  e.restitution = b.re ?? 0.3;
  e.isSensor = b.isSensor || !1;
  this.CreateFixture(e);
  d.m_p.Set(b.width / PC.PM_RATIO, 0);
  this.CreateFixture(e);
  return this;
}
var playerevent = {},
  PlayerEvent = {
    WIN_DM: "win_dm",
    WIN_CTF: "win_ctf",
    LOSE_DM: "lose_dm",
    LOSE_CTF: "lose_ctf",
    WIN_TDM: "win_tdm",
    LOSE_TDM: "lose_tdm",
    WIN_DB: "win_db",
    LOSE_DB: "lose_db",
    WIN_BR: "win_br",
    LOSE_BR: "lose_br",
    KILL: "kill",
    DEATH: "death",
    SCORE: "score",
    DOUBLE: "double",
    TRIPLE: "triple",
    QUAD: "quad",
    PENTA: "penta",
    MEGA: "mega",
    MONSTER: "monster",
    GOD: "god",
    SPREE: "spree",
    SELF: "self",
    TEAM: "team",
    HEAD: "head",
    FIRST: "first",
    GOLD: "gold",
    WIN_DB_MATCH: "win_db_match",
  };
var statechange = {},
  StateChange = {
    ADD: 0,
    Item: {
      RANGE: 1,
      EQUIP: 101,
      CARRY_PRIMARY: 102,
      CARRY_SECONDARY: 103,
      CARRY_BELT: 104,
      REMOVE_PRIMARY: 105,
      REMOVE_SECONDARY: 106,
      REMOVE_BELT: 107,
      DROP: 108,
      USE: 109,
      RELOAD: 110,
      CARRY_OBJECTIVE: 111,
      DROP_OBJECTIVE: 112,
      SCORE_OBJECTIVE: 113,
      RETURN_OBJECTIVE: 114,
      INIT_USE: 115,
    },
    Agent: {
      RANGE: 2,
      HEALTH: 201,
      ALIVE: 202,
      ACTIVE: 203,
      JET_START: 204,
      JET_STOP: 205,
      COMBO: 206,
      TELEPORT: 207,
      INSERTION: 208,
      IDLE: 209,
      GOLD: 210,
      JET: 211,
      MESSAGE: 212,
    },
    Model: {
      RANGE: 3,
      SPAWN: 301,
      KILL: 302,
      SCORE: 303,
      END: 304,
      CLEAR: 305,
      LEADER: 306,
      TEAM: 307,
      EVENT: 308,
      ENVIRONMENT: 309,
      ENERGY_RADIUS: 310,
      END_DB_MATCH: 311,
      MESSAGE: 312,
      INITIAL: 313,
    },
  };
var team = {};
function Team(a) {
  this.index = a;
  this.name = Team.Names[this.index];
  this.color = Team.Colors[this.index];
  this.kills = this.points = 0;
  this.players = new OrderedContainer();
}
Team.Names =
  "alpha bravo charlie delta echo foxtrot gamma hotel india juliett kilo lima zulu".split(" ");
Team.Colors =
  "red blue green yellow orange purple lightblue teal brown grey darkgreen pink zulu".split(" ");
Team.HexColors = [
  16711680, 255, 65280, 16776960, 16753408, 9766884, 41460, 50286, 7941126, 9605778, 22528,
  13259256, 0,
];
Team.LabelColors = [
  16733525, 5592575, 5635925, 16777045, 16753408, 9766884, 41460, 50286, 7941126, 9605778, 22528,
  13259256, 0,
];
var controlstab = {};
class ControlsTab extends PIXI.Container {
  constructor(a) {
    super();
    EventDispatcher.call(this);
    this.settings = a;
    void 0 === this.settings &&
      (this.settings = { keyBindings: InputState.DefaultBindings.QWERTY });
    this.forceRefresh = !1;
    this.marginLeft = 40;
    this.marginTop = 52;
    this.kbMarginTop = this.marginTop + 120;
    this.keyboardTitle = new PIXI.Text("Key bindings", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.keyboardTitle.x = this.marginLeft - 5;
    this.keyboardTitle.y = this.marginTop + 6;
    this.keyboardTitle.resolution = 1.5 * App.DevicePixelRatio;
    this.addChild(this.keyboardTitle);
    this.qwertyButton = new Button("QWERTY");
    this.qwertyButton.setText("Reset default QWERTY");
    this.qwertyButton.x = this.marginLeft + 8;
    this.qwertyButton.y = this.marginTop + 40;
    this.qwertyButton.scale.x = this.qwertyButton.scale.y = 0.8;
    this.addChild(this.qwertyButton);
    this.qwertyButton.addListener(
      Button.BUTTON_RELEASED,
      this.applyDefaultBindings.bind(this, "QWERTY")
    );
    this.azertyButton = new Button("QWERTY");
    this.azertyButton.setText("Reset default AZERTY");
    this.azertyButton.x = this.qwertyButton.x + this.qwertyButton.width + 28;
    this.azertyButton.y = this.marginTop + 40;
    this.azertyButton.scale.x = this.azertyButton.scale.y = 0.8;
    this.addChild(this.azertyButton);
    this.azertyButton.addListener(
      Button.BUTTON_RELEASED,
      this.applyDefaultBindings.bind(this, "AZERTY")
    );
    this.keyboardTitle = new PIXI.Text(
      "Click on a key below and then press a new key to override it.",
      {
        fontName: "Arial",
        fontSize: 16,
        lineHeight: 18,
        fill: 16777215,
        strokeThickness: 2,
        lineJoin: "round",
      }
    );
    this.keyboardTitle.resolution = 1.5 * App.DevicePixelRatio;
    this.keyboardTitle.x = this.marginLeft - 5;
    this.keyboardTitle.y = this.marginTop + 86;
    this.addChild(this.keyboardTitle);
    a = this.settings.keyBindings;
    this.bindingFn = (b) => (this.settings.keyBindings[b.binding] = b.key);
    this.jumpControl = new KeyInput("ctrl_jump", "Jump", a.ctrl_jump, "binding_group");
    this.jumpControl.x = this.marginLeft;
    this.jumpControl.y = this.kbMarginTop;
    this.jumpControl.on(KeyInput.CHANGE, this.bindingFn);
    this.moveLeftControl = new KeyInput(
      "ctrl_move_left",
      "Move left",
      a.ctrl_move_left,
      "binding_group"
    );
    this.moveLeftControl.x = this.marginLeft;
    this.moveLeftControl.y = this.kbMarginTop + 30;
    this.moveLeftControl.on(KeyInput.CHANGE, this.bindingFn);
    this.moveRightControl = new KeyInput(
      "ctrl_move_right",
      "Move right",
      a.ctrl_move_right,
      "binding_group"
    );
    this.moveRightControl.x = this.marginLeft;
    this.moveRightControl.y = this.kbMarginTop + 60;
    this.moveRightControl.on(KeyInput.CHANGE, this.bindingFn);
    this.crouchControl = new KeyInput("ctrl_crouch", "Crouch", a.ctrl_crouch, "binding_group");
    this.crouchControl.x = this.marginLeft;
    this.crouchControl.y = this.kbMarginTop + 90;
    this.crouchControl.on(KeyInput.CHANGE, this.bindingFn);
    this.proneControl = new KeyInput("ctrl_prone", "Prone", a.ctrl_prone, "binding_group");
    this.proneControl.x = this.marginLeft;
    this.proneControl.y = this.kbMarginTop + 120;
    this.proneControl.on(KeyInput.CHANGE, this.bindingFn);
    this.fireControl = new KeyInput("ctrl_fire", "Fire [Left mouse]", a.ctrl_fire, "binding_group");
    this.fireControl.x = this.marginLeft;
    this.fireControl.y = this.kbMarginTop + 150;
    this.fireControl.setFixed();
    this.flyControl = new KeyInput("ctrl_fly", "Fly [Right mouse]", a.ctrl_fly, "binding_group");
    this.flyControl.x = this.marginLeft;
    this.flyControl.y = this.kbMarginTop + 180;
    this.flyControl.setFixed();
    this.reloadControl = new KeyInput("ctrl_reload", "Reload", a.ctrl_reload, "binding_group");
    this.reloadControl.x = this.marginLeft;
    this.reloadControl.y = this.kbMarginTop + 210;
    this.reloadControl.on(KeyInput.CHANGE, this.bindingFn);
    this.throwControl = new KeyInput(
      "ctrl_throw",
      "Throw nade / item",
      a.ctrl_throw,
      "binding_group"
    );
    this.throwControl.x = this.marginLeft + 260;
    this.throwControl.y = this.kbMarginTop;
    this.throwControl.on(KeyInput.CHANGE, this.bindingFn);
    this.dropControl = new KeyInput("ctrl_drop", "Throw weapon", a.ctrl_drop, "binding_group");
    this.dropControl.x = this.marginLeft + 260;
    this.dropControl.y = this.kbMarginTop + 30;
    this.dropControl.on(KeyInput.CHANGE, this.bindingFn);
    this.swapControl = new KeyInput("ctrl_swap", "Swap weapon", a.ctrl_swap, "binding_group");
    this.swapControl.x = this.marginLeft + 260;
    this.swapControl.y = this.kbMarginTop + 60;
    this.swapControl.on(KeyInput.CHANGE, this.bindingFn);
    this.throwFlagControl = new KeyInput(
      "ctrl_flag",
      "Throw flag [Jump + Crouch]",
      a.ctrl_flag,
      "binding_group"
    );
    this.throwFlagControl.x = this.marginLeft + 260;
    this.throwFlagControl.y = this.kbMarginTop + 90;
    this.throwFlagControl.setFixed();
    this.chatControl = new KeyInput("ctrl_chat", "Chat [or ENTER]", a.ctrl_chat, "binding_group");
    this.chatControl.x = this.marginLeft + 260;
    this.chatControl.y = this.kbMarginTop + 120;
    this.chatControl.on(KeyInput.CHANGE, this.bindingFn);
    this.helpControl = new KeyInput("ctrl_help", "Help", a.ctrl_help, "binding_group");
    this.helpControl.x = this.marginLeft + 260;
    this.helpControl.y = this.kbMarginTop + 150;
    this.helpControl.on(KeyInput.CHANGE, this.bindingFn);
    this.weaponMenuControl = new KeyInput(
      "ctrl_weapon",
      "Display weapons",
      a.ctrl_weapon,
      "binding_group"
    );
    this.weaponMenuControl.x = this.marginLeft + 260;
    this.weaponMenuControl.y = this.kbMarginTop + 180;
    this.weaponMenuControl.on(KeyInput.CHANGE, this.bindingFn);
    this.leaderBoardControl = new KeyInput(
      "ctrl_leader",
      "Display leaderboard",
      a.ctrl_leader,
      "binding_group"
    );
    this.leaderBoardControl.x = this.marginLeft + 260;
    this.leaderBoardControl.y = this.kbMarginTop + 210;
    this.leaderBoardControl.on(KeyInput.CHANGE, this.bindingFn);
    this.addChild(this.throwControl);
    this.addChild(this.dropControl);
    this.addChild(this.swapControl);
    this.addChild(this.throwFlagControl);
    this.addChild(this.chatControl);
    this.addChild(this.helpControl);
    this.addChild(this.weaponMenuControl);
    this.addChild(this.leaderBoardControl);
    this.addChild(this.jumpControl);
    this.addChild(this.moveLeftControl);
    this.addChild(this.moveRightControl);
    this.addChild(this.crouchControl);
    this.addChild(this.proneControl);
    this.addChild(this.fireControl);
    this.addChild(this.flyControl);
    this.addChild(this.reloadControl);
    try {
      this.applyBindings(this.settings.keyBindings);
    } catch (b) {
      this.applyBindings(InputState.DefaultBindings.QWERTY);
    }
  }
  applyBindings(a) {
    this.jumpControl.setKey(a.ctrl_jump, !0);
    this.moveLeftControl.setKey(a.ctrl_move_left, !0);
    this.moveRightControl.setKey(a.ctrl_move_right, !0);
    this.crouchControl.setKey(a.ctrl_crouch, !0);
    this.proneControl.setKey(a.ctrl_prone, !0);
    this.fireControl.setKey(a.ctrl_fire, !0);
    this.flyControl.setKey(a.ctrl_fly, !0);
    this.reloadControl.setKey(a.ctrl_reload, !0);
    this.throwControl.setKey(a.ctrl_throw, !0);
    this.dropControl.setKey(a.ctrl_drop, !0);
    this.swapControl.setKey(a.ctrl_swap, !0);
    this.throwFlagControl.setKey(a.ctrl_flag, !0);
    this.chatControl.setKey(a.ctrl_chat, !0);
    this.helpControl.setKey(a.ctrl_help, !0);
    this.weaponMenuControl.setKey(a.ctrl_weapon, !0);
    this.leaderBoardControl.setKey(a.ctrl_leader, !0);
  }
  applyDefaultBindings(a) {
    this.applyBindings(InputState.DefaultBindings[a]);
  }
  getSettings() {
    return this.settings;
  }
  enableInput() {
    this.jumpControl.enable();
    this.moveLeftControl.enable();
    this.moveRightControl.enable();
    this.crouchControl.enable();
    this.proneControl.enable();
    this.fireControl.enable();
    this.flyControl.enable();
    this.reloadControl.enable();
    this.throwControl.enable();
    this.dropControl.enable();
    this.swapControl.enable();
    this.throwFlagControl.enable();
    this.chatControl.enable();
    this.helpControl.enable();
    this.weaponMenuControl.enable();
    this.leaderBoardControl.enable();
  }
  disableInput() {
    this.jumpControl.disable();
    this.moveLeftControl.disable();
    this.moveRightControl.disable();
    this.crouchControl.disable();
    this.proneControl.disable();
    this.fireControl.disable();
    this.flyControl.disable();
    this.reloadControl.disable();
    this.throwControl.disable();
    this.dropControl.disable();
    this.swapControl.disable();
    this.throwFlagControl.disable();
    this.chatControl.disable();
    this.helpControl.disable();
    this.weaponMenuControl.disable();
    this.leaderBoardControl.disable();
  }
}
var dropdown = {};
class Dropdown extends PIXI.Container {
  constructor(a, b, c, d, e = !1) {
    super();
    EventDispatcher.call(this);
    this.id = a;
    this.selectWidth = c;
    this.dropWidth = d;
    this.title = new PIXI.Text(b || "", {
      fontSize: 18,
      fontFamily: "Arial",
      fill: 16763904,
      lineJoin: "round",
      strokeThickness: 3,
      align: "left",
    });
    this.title.x = 4;
    this.title.y = 0;
    this.title.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.hover = !1;
    this.displaySelectedIcon = e;
    this.title.tint = 16755200;
    this.title.resolution = 1.5 * App.DevicePixelRatio;
    this.itemContainer = new PIXI.Container();
    this.itemContainer.x = 82;
    this.itemContainer.y = 28;
    this.displaySelectedIcon &&
      ((this.selectedIcon = new PIXI.Sprite()),
      (this.selectedIcon.x = 75),
      (this.selectedIcon.y = -5),
      (this.selectedIcon.scale.x = this.selectedIcon.scale.y = 0.45));
    this.itemWidth = 180;
    this.background = new PIXI.Graphics();
    this.background.x = 74;
    this.background.y = -4;
    this.background.alpha = 0.75;
    this.itemContainerBackground = new PIXI.Graphics();
    this.itemContainer.addChild(this.itemContainerBackground);
    this.itemContainer.visible = !1;
    this.items = new OrderedContainer();
    this.selected = new PIXI.Text("none", {
      fontSize: 18,
      fontFamily: "Arial",
      fill: 16763904,
      lineJoin: "round",
      strokeThickness: 3,
      align: "left",
    });
    this.selected.resolution = 1.5 * App.DevicePixelRatio;
    this.displaySelectedIcon
      ? ((this.selected.x = 108), (this.selected.y = -2))
      : ((this.selected.x = 80), (this.selected.y = 0));
    this.selected.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.selectedId = null;
    this.interactive = !0;
    this.on("mousedown", () => this.onMouseDown());
    this.on("touchstart", () => this.onMouseDown());
    this.on("mouseover", () => this.onMouseOver());
    this.on("mouseout", () => this.onMouseOut());
    this.expanded = !1;
    this.addChild(this.background);
    this.addChild(this.title);
    this.displaySelectedIcon && this.addChild(this.selectedIcon);
    this.addChild(this.selected);
    this.addChild(this.itemContainer);
    this.dropdownIcon = new PIXI.Graphics();
    this.dropdownIcon.lineStyle(1, 16777215, 0, 0);
    this.dropdownIcon.beginFill(14540253, 0.5);
    this.dropdownIcon.drawPolygon([-6, 0, 6, 0, 0, 10]);
    this.dropdownIcon.endFill();
    this.dropdownIcon.x = this.itemContainer.x + this.selectWidth - 20;
    this.dropdownIcon.y = 6;
    this.addChild(this.dropdownIcon);
    Dropdown.Instances.push(this);
  }
  clear() {
    this.selected.text = "none";
    this.items.clear();
    this.itemContainerBackground.clear();
    this.itemContainer.removeChildren();
    this.itemContainer.addChild(this.itemContainerBackground);
  }
  addItem(a, b, c, d, e, f) {
    c = this.getItem(a, b, c, d, e, f);
    c.x = 0;
    c.y = 30 * this.items.getSize();
    this.items.add(c, b);
    this.itemContainer.addChild(c);
    1 === this.items.getSize() &&
      ((this.selected.fontName = "Arial"),
      (this.selected.fontSize = 12 < a.length ? 24 : 26),
      (this.selected.text = a),
      (this.selectedId = b),
      this.displaySelectedIcon &&
        c.iconSprite &&
        (this.selectedIcon.texture = c.iconSprite.texture));
    this.draw();
  }
  onMouseDown() {
    this.expanded ? this.collapse() : this.expand();
    AudioEffects.ButtonClick.audio.play();
  }
  setTint(a) {
    this.title.tint = a;
  }
  onMouseOver() {
    this.hover = !0;
    this.background.alpha = 1;
    AudioEffects.ButtonHover.audio.play();
  }
  onMouseOut() {
    this.hover = !1;
    this.background.alpha = 0.75;
  }
  getValue() {
    return this.selectedId;
  }
  setValue(a) {
    this.items.iterate((b, c) =>
      b === a
        ? ((this.selected.text = this.items.getById(b).title),
          (this.selectedId = b),
          this.displaySelectedIcon &&
            c.iconSprite &&
            (this.selectedIcon.texture = c.iconSprite.texture),
          !1)
        : !0
    );
  }
  expand() {
    0 < this.items.getSize() && (this.expanded = this.itemContainer.visible = !0);
  }
  collapse() {
    this.expanded = this.itemContainer.visible = !1;
  }
  onItemSelected(a) {
    let b = this.items.getById(a),
      c = b.title;
    this.icon && void 0 !== this.icon.parent && this.removeChild(this.icon);
    0 === c.length &&
      b.iconSprite &&
      ((this.icon = new PIXI.Sprite(b.iconSprite.texture)),
      (this.icon.x = this.selected.x),
      (this.icon.y = this.selected.y - 2),
      this.addChild(this.icon));
    this.selectedIcon.texture = null;
    this.displaySelectedIcon && b.iconSprite && (this.selectedIcon.texture = b.iconSprite.texture);
    this.selected.text = c;
    this.selectedId = a;
    this.collapse();
    this.dispatchEvent(
      new CustomEvent(Button.BUTTON_RELEASED, { id: this.id, value: this.selectedId })
    );
    this.draw();
  }
  getItem(a, b, c, d, e = 0.5, f = 0) {
    let g = new PIXI.Container(),
      h = new PIXI.Text(a, {
        fontSize: 18,
        fontFamily: "Arial",
        fill: 16763904,
        lineJoin: "round",
        strokeThickness: 3,
        align: "left",
      });
    h.resolution = 1.5 * App.DevicePixelRatio;
    h.x = 4;
    h.y = 2;
    h.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    g.interactive = !0;
    g.on("mousedown", (n) => {
      n.stopPropagation();
      this.onItemSelected(b);
    });
    g.on("touchstart", (n) => {
      n.stopPropagation();
      this.onItemSelected(b);
    });
    const m = new PIXI.Graphics();
    m.interactive = !0;
    m.beginFill(6710886, 1);
    m.drawRect(-6, -1, this.dropWidth - 4, 28);
    m.endFill();
    m.alpha = 0.4;
    m.on("mouseover", function () {
      m.alpha = 0.8;
      AudioEffects.ButtonHover.audio.play();
    });
    m.on("mouseout", function () {
      m.alpha = 0.4;
    });
    g.title = a;
    g.addChild(m);
    g.addChild(h);
    a = new PIXI.Text(c, {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 13421772,
      lineJoin: "round",
      strokeThickness: 3,
      align: "left",
    });
    a.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    a.resolution = 1.5 * App.DevicePixelRatio;
    a.x = this.dropWidth - (a.width + 14);
    a.y = 3;
    g.addChild(a);
    void 0 !== d &&
      ((d = new PIXI.Sprite(d)),
      (d.x = 0),
      (d.y = -3 + f),
      (d.scale.x = d.scale.y = e),
      (g.iconSprite = d),
      g.addChild(d),
      (h.x = 34));
    return g;
  }
  draw() {
    this.background.clear();
    this.background.lineStyle(2, 2236962, 0.2, 0);
    this.background.beginFill(5592405, 1);
    this.background.drawRect(0, 0, this.selectWidth, 28);
    this.background.endFill();
    this.itemContainerBackground.x = -8;
    this.itemContainerBackground.y = -3;
    this.itemContainerBackground.clear();
    this.itemContainerBackground.lineStyle(2, 5592405, 0.2, 0);
    this.itemContainerBackground.beginFill(2236962, 1);
    this.itemContainerBackground.drawRect(0, 0, this.dropWidth, 30 * this.items.getSize() + 2);
    this.itemContainerBackground.endFill();
  }
}
Dropdown.Instances = [];
Dropdown.CollapseInstances = () => {
  for (let a = 0; a < Dropdown.Instances.length; a++) {
    let b = Dropdown.Instances[a];
    b.hover || b.collapse();
  }
};
Dropdown.RemoveInstances = () => {
  Dropdown.Instances = [];
};
Dropdown.AddInstance = (a) => {
  for (let b = 0; b < Dropdown.Instances.length; b++) if (Dropdown.Instances[b] === a) return;
  Dropdown.Instances.push(a);
};
Dropdown.RemoveInstance = (a) => {
  for (let b = 0; b < Dropdown.Instances.length; b++)
    if (Dropdown.Instances[b] === a) {
      Dropdown.Instances.splice(b, 1);
      break;
    }
};
var graphicstab = {};
class GraphicsTab extends PIXI.Container {
  constructor(a) {
    super();
    EventDispatcher.call(this);
    this.settings = a;
    void 0 === this.settings
      ? (this.settings = { reticleLine: !0, aa: !1, fxaa: !1, chatLines: 20, chatOpacity: 1 })
      : (void 0 === this.settings.chatLines && (this.settings.chatLines = 20),
        void 0 === this.settings.chatOpacity && (this.settings.chatOpacity = 1));
    this.aaUpdated = this.forceRefresh = !1;
    this.marginLeft = 40;
    this.marginTop = 52;
    this.graphicsTitle = new PIXI.Text("Display settings", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.graphicsTitle.x = this.marginLeft - 5;
    this.graphicsTitle.y = this.marginTop + 6;
    this.addChild(this.graphicsTitle);
    this.reticleLine = new Checkbox("reticle", "Display reticle line", !0);
    this.reticleLine.x = this.marginLeft;
    this.reticleLine.y = this.marginTop + 40;
    this.reticleLine.on(Checkbox.CHANGE, (b) => (this.settings.reticleLine = b));
    this.addChild(this.reticleLine);
    this.enableShockwaves = new Checkbox(
      "shockwaveFx",
      "Enable shockwave effects. Prettier but slower!",
      !1
    );
    this.enableShockwaves.x = this.marginLeft;
    this.enableShockwaves.y = this.marginTop + 90;
    this.enableShockwaves.on(Checkbox.CHANGE, (b) => {
      this.settings.shockwaveFx = b;
    });
    this.addChild(this.enableShockwaves);
    this.chatLinesSlider = new Slider("chatLines", "Console lines", 20, 30, 2);
    this.chatLinesSlider.round = !0;
    this.chatLinesSlider.x = this.marginLeft;
    this.chatLinesSlider.y = this.marginTop + 140;
    this.chatLinesSlider.on(Slider.CHANGE, (b) => (this.settings.chatLines = b));
    this.addChild(this.chatLinesSlider);
    this.chatOpacitySlider = new Slider("chatOpacity", "Console opacity", 0.8, 1);
    this.chatOpacitySlider.x = this.marginLeft + 290;
    this.chatOpacitySlider.y = this.marginTop + 140;
    this.chatOpacitySlider.on(Slider.CHANGE, (b) => (this.settings.chatOpacity = b));
    this.addChild(this.chatOpacitySlider);
    this.enableAA = new Checkbox(
      "aa",
      "Enable anti-aliasing(AA). Prettier but slower!\n(Window will refresh on save)",
      !1
    );
    this.enableAA.x = this.marginLeft;
    this.enableAA.y = this.marginTop + 230;
    this.enableAA.on(Checkbox.CHANGE, (b) => {
      this.settings.aa = b;
      this.aaUpdated = !this.aaUpdated;
      this.forceRefresh = this.checkIfRefreshNeeded();
    });
    this.addChild(this.enableAA);
    try {
      this.reticleLine.setChecked(this.settings.reticleLine),
        this.chatLinesSlider.setValue(
          void 0 !== this.settings.chatLines ? this.settings.chatLines : 20
        ),
        this.chatOpacitySlider.setValue(
          void 0 !== this.settings.chatOpacity ? this.settings.chatOpacity : 1
        ),
        this.enableAA.setChecked(this.settings.aa, !1),
        this.enableShockwaves.setChecked(
          void 0 !== this.settings.shockwaveFx ? this.settings.shockwaveFx : !0
        );
    } catch (b) {
      this.reticleLine.setChecked(!0),
        this.chatLinesSlider.setValue(20),
        this.chatOpacitySlider.setValue(1),
        this.enableAA.setChecked(!1),
        this.enableShockwaves.setChecked(!0);
    }
  }
  getSettings() {
    return this.settings;
  }
  checkIfRefreshNeeded() {
    return this.aaUpdated;
  }
}
var keyinput = {};
class KeyInput extends PIXI.Container {
  constructor(a, b, c, d) {
    super();
    this.id = a;
    this.labelText = b;
    this.key = c;
    this.group = d;
    this.hasFocus = this.fixed = !1;
    this.hitArea = new PIXI.Rectangle(0, 0, 200, 30);
    this.icon = new PIXI.Sprite(App.CombinedTextures.key_input);
    this.icon.scale.x = this.icon.scale.y = 0.4;
    this.interactive = !0;
    this._mousedownListener = this.onMouseDown.bind(this);
    this.on("mousedown", this._mousedownListener);
    this.keyField = new PIXI.Text(this.key, {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 18,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.keyField.resolution = 1.5 * App.DevicePixelRatio;
    this.keyField.x = this.icon.x + 0.5 * (this.icon.width - this.keyField.width);
    this.keyField.y = this.icon.y + 2;
    this.label = new PIXI.Text(this.labelText, {
      fontName: "Arial",
      fontSize: 15,
      lineHeight: 18,
      fill: 16763904,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.label.resolution = 1.5 * App.DevicePixelRatio;
    this.label.x = this.icon.x + 40;
    this.label.y = this.icon.y + 3;
    this.keyDownListener = this.onKeyDown.bind(this);
    this.on("mouseover", () => (this.scale.x = this.scale.y = this.fixed ? 1 : 1.1));
    this.on("mouseout", () => (this.scale.x = this.scale.y = 1));
    this.addChild(this.icon);
    this.addChild(this.keyField);
    this.addChild(this.label);
    KeyInput.RegisterInput(this);
  }
  onMouseDown(a) {
    this.setFocus(!this.hasFocus);
  }
  setFocus(a) {
    if ((this.hasFocus = a))
      for (
        this.keyField.text = "...", this.label.text = "[PRESS A KEY] " + this.labelText, a = 0;
        a < KeyInput.RegisteredGroups[this.group].length;
        a++
      )
        KeyInput.RegisteredGroups[this.group][a] !== this &&
          KeyInput.RegisteredGroups[this.group][a].setFocus(!1);
    else (this.keyField.text = this.key), (this.label.text = this.labelText);
  }
  onKeyDown(a) {
    this.hasFocus &&
      ((this.key =
        void 0 !== characterMapCTRL[a.data.code]
          ? characterMapCTRL[a.data.code]
          : a.data.char.toUpperCase()),
      this.setKey(this.key, !0));
  }
  setFixed() {
    this.removeListener("mousedown", this._mousedownListener);
    this.icon.tint = 16711680;
    this.fixed = !0;
  }
  enable() {
    UserInput.addListener(UserInput.KEY_DOWN, this.keyDownListener);
  }
  disable() {
    UserInput.removeListener(UserInput.KEY_DOWN, this.keyDownListener);
  }
  setKey(a, b) {
    this.key = a;
    this.keyField.text = a;
    this.keyField.x = this.icon.x + 0.5 * (this.icon.width - this.keyField.width);
    this.setFocus(!1);
    b && this.emit(KeyInput.CHANGE, { binding: this.id, key: this.key });
  }
}
KeyInput.CHANGE = "keyinput_change";
KeyInput.RegisterInput = function (a) {
  void 0 === KeyInput.RegisteredGroups[a.group] && (KeyInput.RegisteredGroups[a.group] = []);
  KeyInput.RegisteredGroups[a.group].push(a);
};
KeyInput.DisableAll = function () {
  for (let a in KeyInput.RegisteredGroups)
    for (let b = 0; b < KeyInput.RegisteredGroups[a].length; b++)
      KeyInput.RegisteredGroups[a][b].setFocus(!1);
};
KeyInput.RegisteredGroups = {};
var settingspanel = {};
class SettingsPanel extends PIXI.Container {
  constructor(a, b) {
    super();
    this.settings = Registry.Instance[Registry.Key.SETTINGS];
    this.interactive = !0;
    this.panelWidth = a;
    this.panelHeight = b;
    this.background = new PIXI.Graphics();
    this.background.x = 0;
    this.background.y = 0;
    this.background.lineStyle(1, 16777215, 0.1, 0);
    this.background.beginFill(3355443, 1);
    this.background.drawRect(0, 0, 660, 524);
    this.background.endFill();
    this.background.beginFill(0, 0.3);
    this.background.drawRect(10, 10, 640, 504);
    this.background.endFill();
    this.background.drawRect(15, 42, 630, 2);
    this.addChild(this.background);
    this.applyButton = new Button("save");
    this.applyButton.x = this.panelWidth - 134;
    this.applyButton.y = this.panelHeight - 46;
    this.applyButton.setText("Save & close");
    this.applyButton.scale.x = this.applyButton.scale.y = 0.8;
    this.applyButton.addListener(Button.BUTTON_RELEASED, this.onApplyButtonReleased.bind(this));
    this.applyButton.setTint(16763904);
    this.addChild(this.applyButton);
    this.closeButton = new ImgButton();
    this.closeButton.x = this.panelWidth - 40;
    this.closeButton.y = 14;
    this.closeButton.scale.x = this.closeButton.scale.y = 0.8;
    this.closeButton.on(ImgButton.CLICK, () => this.onCloseButtonReleased());
    this.addChild(this.closeButton);
    this.controlsTab = new ControlsTab(this.settings.controls);
    this.controlsTabButton = new PIXI.Text("Controls", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.controlsTabButton.resolution = 1.5 * App.DevicePixelRatio;
    this.controlsTabButton.anchor.x = this.controlsTabButton.anchor.y = 0.5;
    this.controlsTabButton.x = 60;
    this.controlsTabButton.y = 28;
    this.addChild(this.controlsTabButton);
    this.controlsTabButtonBackground = new PIXI.Graphics();
    this.controlsTabButtonBackground.beginFill(16777215, 0.1);
    this.controlsTabButtonBackground.drawRoundedRect(0, 0, 92, 30, 2);
    this.controlsTabButtonBackground.endFill();
    this.controlsTabButtonBackground.x = 14;
    this.controlsTabButtonBackground.y = 12;
    this.controlsTabButtonBackground.interactive = !0;
    this.controlsTabButtonBackground.on(
      "touchstart",
      this.displayTab.bind(this, SettingsPanel.Tabs.CONTROLS)
    );
    this.controlsTabButtonBackground.on(
      "mousedown",
      this.displayTab.bind(this, SettingsPanel.Tabs.CONTROLS)
    );
    this.controlsTabButtonBackground.on("mouseover", () => {
      this.controlsTabButtonBackground.tint = 11184810;
    });
    this.controlsTabButtonBackground.on("mouseout", () => {
      this.controlsTabButtonBackground.tint = 16777215;
    });
    this.addChild(this.controlsTabButtonBackground);
    this.graphicsTab = new GraphicsTab(this.settings.graphics);
    this.graphicsTabButton = new PIXI.Text("Display", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.graphicsTabButton.resolution = 1.5 * App.DevicePixelRatio;
    this.graphicsTabButton.anchor.x = this.graphicsTabButton.anchor.y = 0.5;
    this.graphicsTabButton.x = 154;
    this.graphicsTabButton.y = 28;
    this.addChild(this.graphicsTabButton);
    this.graphicsTabButtonBackground = new PIXI.Graphics();
    this.graphicsTabButtonBackground.beginFill(16777215, 0.1);
    this.graphicsTabButtonBackground.drawRoundedRect(0, 0, 92, 30, 2);
    this.graphicsTabButtonBackground.endFill();
    this.graphicsTabButtonBackground.x = 110;
    this.graphicsTabButtonBackground.y = 12;
    this.graphicsTabButtonBackground.interactive = !0;
    this.graphicsTabButtonBackground.on(
      "touchstart",
      this.displayTab.bind(this, SettingsPanel.Tabs.GRAPHICS)
    );
    this.graphicsTabButtonBackground.on(
      "mousedown",
      this.displayTab.bind(this, SettingsPanel.Tabs.GRAPHICS)
    );
    this.graphicsTabButtonBackground.on("mouseover", () => {
      this.graphicsTabButtonBackground.tint = 11184810;
    });
    this.graphicsTabButtonBackground.on("mouseout", () => {
      this.graphicsTabButtonBackground.tint = 16777215;
    });
    this.addChild(this.graphicsTabButtonBackground);
    this.soundTab = new SoundTab(this.settings.sound);
    this.soundTabButton = new PIXI.Text("Sound", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.soundTabButton.resolution = 1.5 * App.DevicePixelRatio;
    this.soundTabButton.anchor.x = this.soundTabButton.anchor.y = 0.5;
    this.soundTabButton.x = 250;
    this.soundTabButton.y = 28;
    this.addChild(this.soundTabButton);
    this.soundTabButtonBackground = new PIXI.Graphics();
    this.soundTabButtonBackground.beginFill(16777215, 0.1);
    this.soundTabButtonBackground.drawRoundedRect(0, 0, 92, 30, 2);
    this.soundTabButtonBackground.endFill();
    this.soundTabButtonBackground.x = 206;
    this.soundTabButtonBackground.y = 12;
    this.soundTabButtonBackground.interactive = !0;
    this.soundTabButtonBackground.on(
      "touchstart",
      this.displayTab.bind(this, SettingsPanel.Tabs.SOUND)
    );
    this.soundTabButtonBackground.on(
      "mousedown",
      this.displayTab.bind(this, SettingsPanel.Tabs.SOUND)
    );
    this.soundTabButtonBackground.on("mouseover", () => {
      this.soundTabButtonBackground.tint = 11184810;
    });
    this.soundTabButtonBackground.on("mouseout", () => {
      this.soundTabButtonBackground.tint = 16777215;
    });
    this.addChild(this.soundTabButtonBackground);
    this.displayTab(SettingsPanel.Tabs.CONTROLS);
  }
  show() {
    this.controlsTab.enableInput();
  }
  displayTab(a) {
    AudioEffects.ButtonClick.audio.play();
    switch (a) {
      case SettingsPanel.Tabs.GRAPHICS:
        this.controlsTab.parent && this.removeChild(this.controlsTab);
        this.soundTab.parent && this.removeChild(this.soundTab);
        this.addChild(this.graphicsTab);
        this.soundTabButtonBackground.alpha = 1;
        this.graphicsTabButtonBackground.alpha = 0;
        this.controlsTabButtonBackground.alpha = 1;
        break;
      case SettingsPanel.Tabs.CONTROLS:
        this.graphicsTab.parent && this.removeChild(this.graphicsTab);
        this.soundTab.parent && this.removeChild(this.soundTab);
        this.soundTabButtonBackground.alpha = 1;
        this.graphicsTabButtonBackground.alpha = 1;
        this.controlsTabButtonBackground.alpha = 0;
        this.addChild(this.controlsTab);
        break;
      case SettingsPanel.Tabs.SOUND:
        this.graphicsTab.parent && this.removeChild(this.graphicsTab),
          this.controlsTab.parent && this.removeChild(this.controlsTab),
          (this.soundTabButtonBackground.alpha = 0),
          (this.graphicsTabButtonBackground.alpha = 1),
          (this.controlsTabButtonBackground.alpha = 1),
          this.addChild(this.soundTab);
    }
  }
  onApplyButtonReleased() {
    var a = {
      controls: this.controlsTab.getSettings(),
      graphics: this.graphicsTab.getSettings(),
      sound: this.soundTab.getSettings(),
    };
    this.applySettings(a);
    (this.controlsTab.forceRefresh ||
      this.soundTab.forceRefresh ||
      this.graphicsTab.forceRefresh) &&
      location.reload();
    App.Layer.onSettingsHide();
  }
  applySettings(a) {
    KeyInput.DisableAll();
    Registry.Instance.store(Registry.Key.SETTINGS, a);
    Howler.mute(!a.sound.enabled);
    Howler.volume(a.sound.volume);
    App.Console.reset();
    App.Console.maxLines = a.graphics.chatLines;
    App.Console.targetAlpha = a.graphics.chatOpacity;
    this.controlsTab.disableInput();
  }
  onCloseButtonReleased() {
    KeyInput.DisableAll();
    App.Layer.onSettingsHide();
    this.controlsTab.disableInput();
  }
}
SettingsPanel.Tabs = { GRAPHICS: "graphics", CONTROLS: "controls", SOUND: "sound" };
SettingsPanel.CLOSE = "close";
var slider = {};
class Slider extends PIXI.Container {
  constructor(a, b, c, d, e) {
    super();
    this.id = a;
    this.labelText = b;
    this.range = d;
    this.min = void 0 !== e ? e : 0;
    this.value = (c - this.min) / (this.range - this.min);
    this.size = 200;
    this.round = !1;
    this.onMouseMoveListener = null;
    this.background = new PIXI.Graphics();
    this.background.lineStyle(4, 16777215, 0.2);
    this.background.beginFill(16777215, 0.3);
    this.background.drawRoundedRect(0, 0, this.size, 30, 15);
    this.background.endFill();
    this.background.x = 0;
    this.background.y = 26;
    this.background.on("mousedown", this.onMouseDown.bind(this));
    this.background.on("mouseout", this.onMouseOut.bind(this));
    this.background.on("mouseup", this.onMouseUp.bind(this));
    this.background.interactive = !0;
    this.background.lineStyle(0, 16777215, 0);
    this.background.beginFill(13421772, 0.2);
    this.background.drawPolygon([this.size - 10, 7, this.size - 10, 23, 10, 15]);
    this.background.endFill();
    this.sliderButton = new PIXI.Graphics();
    this.sliderButton.beginFill(16777215, 0.6);
    this.sliderButton.drawRoundedRect(0, 0, 24, 24, 12);
    this.sliderButton.endFill();
    this.sliderButton.x = 4;
    this.sliderButton.y = 29;
    this.label = new PIXI.Text(this.labelText, {
      fontName: "Arial",
      fontSize: 16,
      lineHeight: 18,
      fill: 16777215,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.label.resolution = 1.5 * App.DevicePixelRatio;
    this.label.x = 0.5 * this.size - 2;
    this.label.y = 0;
    this.label.anchor.x = 0.5;
    this.valueLabel = new PIXI.BitmapText(c ? c.toString() : "0", {
      fontName: "Open Sans",
      fontSize: 22,
      fill: "#CCCCCC",
    });
    this.valueLabel.x = this.size + 16;
    this.valueLabel.y = 29;
    this.valueLabel.anchor.x = 0;
    this.volumeMinLabel = new PIXI.Text("min", {
      fontName: "Arial",
      fontSize: 14,
      lineHeight: 18,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.volumeMinLabel.resolution = 1.5 * App.DevicePixelRatio;
    this.volumeMinLabel.x = 10;
    this.volumeMinLabel.y = 5;
    this.volumeMinLabel.tint = 16777215;
    this.volumeMinLabel.alpha = 0.8;
    this.volumeMaxLabel = new PIXI.Text("max", {
      fontName: "Arial",
      fontSize: 14,
      lineHeight: 18,
      fill: 16777215,
      strokeThickness: 2,
      lineJoin: "round",
    });
    this.volumeMaxLabel.resolution = 1.5 * App.DevicePixelRatio;
    this.volumeMaxLabel.x = this.size - 40;
    this.volumeMaxLabel.y = 5;
    this.volumeMaxLabel.tint = 16777215;
    this.volumeMaxLabel.alpha = 0.8;
    this.mouseDownListener = null;
    this.addChild(this.label);
    this.addChild(this.background);
    this.addChild(this.volumeMinLabel);
    this.addChild(this.volumeMaxLabel);
    this.addChild(this.sliderButton);
    this.addChild(this.valueLabel);
    this.updateSliderButtonPosition(this.value);
  }
  onMouseDown(a) {
    null === this.onMouseMoveListener &&
      ((this.onMouseMoveListener = this.onMouseMove.bind(this)),
      this.background.on("mousemove", this.onMouseMoveListener));
    this.value = this.globalToValue(a.data.global);
    this.updateSliderButtonPosition();
    a = this.getOutputValue();
    this.valueLabel.text = this.round ? a.toString() : (Math.round(10 * a) / 10).toString();
    this.emit(Slider.CHANGE, a);
  }
  onMouseMove(a) {
    this.value = this.globalToValue(a.data.global);
    this.updateSliderButtonPosition();
    a = this.getOutputValue();
    this.valueLabel.text = this.round ? a.toString() : (Math.round(10 * a) / 10).toString();
    this.emit(Slider.CHANGE, a);
  }
  getOutputValue() {
    let a = this.min + this.value * (this.range - this.min);
    return this.round ? Math.round(a) : a;
  }
  onMouseOut(a) {
    null !== this.onMouseMoveListener &&
      (this.background.removeListener("mousemove", this.onMouseMoveListener),
      (this.onMouseMoveListener = null));
  }
  onMouseUp(a) {
    null !== this.onMouseMoveListener &&
      (this.background.removeListener("mousemove", this.onMouseMoveListener),
      (this.onMouseMoveListener = null));
  }
  updateSliderButtonPosition() {
    this.sliderButton.x = 4 + this.value * (this.size - (this.sliderButton.width + 8));
  }
  setValue(a) {
    this.value = (a - this.min) / (this.range - this.min);
    this.updateSliderButtonPosition();
    a = this.getOutputValue();
    this.valueLabel.text = this.round ? a.toString() : (Math.round(10 * a) / 10).toString();
  }
  globalToValue(a) {
    a = this.background.toLocal(a);
    a = (0.5 * this.size + 1.1 * (a.x - 0.5 * this.size)) / this.size;
    return 1 < a ? 1 : 0 > a ? 0 : a;
  }
}
Slider.CHANGE = "slider_change";
var soundtab = {};
class SoundTab extends PIXI.Container {
  constructor(a) {
    super();
    EventDispatcher.call(this);
    this.settings = a;
    void 0 === this.settings && (this.settings = { enabled: !0, volume: 1 });
    this.forceRefresh = !1;
    this.marginLeft = 40;
    this.marginTop = 52;
    this.soundTitle = new PIXI.Text("Sound settings", {
      fontName: "Arial",
      fontSize: 18,
      lineHeight: 18,
      fill: 16763904,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.soundTitle.x = this.marginLeft - 5;
    this.soundTitle.y = this.marginTop + 6;
    this.addChild(this.soundTitle);
    this.soundCheck = new Checkbox("enabled", "Enable sound", !0);
    this.soundCheck.x = this.marginLeft;
    this.soundCheck.y = this.marginTop + 40;
    this.soundCheck.on(Checkbox.CHANGE, (b) => (this.settings.enabled = b));
    this.addChild(this.soundCheck);
    this.volumeSlider = new Slider("volume", "Volume", 1, 1);
    this.volumeSlider.x = this.marginLeft;
    this.volumeSlider.y = this.marginTop + 80;
    this.volumeSlider.on(Slider.CHANGE, (b) => (this.settings.volume = b));
    this.addChild(this.volumeSlider);
    try {
      this.soundCheck.setChecked(this.settings.enabled),
        this.volumeSlider.setValue(this.settings.volume);
    } catch (b) {
      this.soundCheck.setChecked(!0), this.volumeSlider.setValue(1);
    }
  }
  getSettings() {
    return this.settings;
  }
}
var table = {};
class Table extends PIXI.Container {
  constructor() {
    super();
    this._titleContainer = new PIXI.Graphics();
    this._rowContainer = new PIXI.Graphics();
    this._titles = [];
    this._rows = [];
    this._colWidth = 200;
    this._rowHeight = 30;
    this.addChild(this._titleContainer);
    this.addChild(this._rowContainer);
    this._rowContainer.x = 0;
    this._rowContainer.y = 40;
  }
  setTitles(a) {
    for (var b, c = 0, d = 0, e = a.length; d < e; d++)
      this._titleContainer.beginFill(3355443, 0.5),
        this._titleContainer.drawRect(c * this._colWidth, 0, this._colWidth, this._rowHeight),
        this._titleContainer.endFill(),
        this._titles.push(b),
        (b = new PIXI.BitmapText(a[d], { fontName: "Open Sans", fontSize: 20, fill: "#CCCCCC" })),
        this._titleContainer.addChild(b),
        (b.x = c * this._colWidth + 0.5 * (this._colWidth - b.width)),
        (b.y = 5),
        c++;
  }
  addRow(a) {
    for (var b = this._rows.length, c = new PIXI.Container(), d, e = 1, f = a.length; e < f; e++)
      (d = new PIXI.BitmapText(a[e], { fontName: "Open Sans", fontSize: 20, fill: "#CCCCCC" })),
        (d.x = this._colWidth * (e - 1) + 0.5 * (this._colWidth - d.width)),
        (d.y = 0),
        c.addChild(d);
    c.id = a[0];
    c.interactive = !0;
    c.on("touchstart", (g) => this.onRowSelected(g));
    c.on("mousedown", (g) => this.onRowSelected(g));
    this._rowContainer.lineStyle(1, 13421772, 0.5);
    this._rowContainer.moveTo(0, b * this._rowHeight - 10);
    this._rowContainer.lineTo(this._titles.length * this._colWidth, b * this._rowHeight - 10);
    c.y = b * this._rowHeight;
    this._rows.push(c);
    this._rowContainer.addChild(c);
  }
  onRowSelected(a) {
    this.dispatchEvent(new CustomEvent(Table.ROW_SELECTED, { id: a.target.id }));
  }
  clear() {
    for (let a = 0, b = this._rows.length; a < b; a++)
      this._rowContainer.removeChild(this._rows[a]);
    this._rows.splice(0, this._rows.length);
    this._rowContainer.clear();
  }
}
Table.ROW_SELECTED = "rowSelected";
(function (a) {
  function b(e) {
    e = e || { fill: 13421772 };
    if (e.default) (e.focused = e.focused || e.default), (e.disabled = e.disabled || e.default);
    else {
      let f = e;
      e = {};
      e.default = e.focused = e.disabled = f;
    }
    return function (f, g, h) {
      h = e[h.toLowerCase()];
      let m = new c.Graphics();
      h.fill && m.beginFill(h.fill);
      h.stroke && m.lineStyle(h.stroke.width || 1, h.stroke.color || 0, h.stroke.alpha || 1);
      h.rounded ? m.drawRoundedRect(0, 0, f, g, h.rounded) : m.drawRect(0, 0, f, g);
      m.endFill();
      m.closePath();
      return m;
    };
  }
  const c = a.PIXI;
  class d extends c.Container {
    constructor(e) {
      super();
      this._input_style = Object.assign(
        {
          position: "absolute",
          background: "none",
          border: "none",
          outline: "none",
          transformOrigin: "0 0",
          lineHeight: "1",
        },
        e.input
      );
      this._box_generator = e.box ? ("function" === typeof e.box ? e.box : new b(e.box)) : null;
      this._input_style.hasOwnProperty("multiline")
        ? ((this._multiline = !!this._input_style.multiline), delete this._input_style.multiline)
        : (this._multiline = !1);
      this._box_cache = {};
      this._previous = {};
      this._dom_added = !1;
      this._dom_visible = !0;
      this._placeholder = "";
      this._placeholderColor = 11119017;
      this._selection = [0, 0];
      this._restrict_value = "";
      this._createDOMInput();
      this.substituteText = !0;
      this._setState("DEFAULT");
      this._addListeners();
    }
    get substituteText() {
      return this._substituted;
    }
    set substituteText(e) {
      this._substituted != e &&
        ((this._substituted = e)
          ? (this._createSurrogate(), (this._dom_visible = !1))
          : (this._destroySurrogate(), (this._dom_visible = !0)),
        (this.placeholder = this._placeholder),
        this._update());
    }
    get placeholder() {
      return this._placeholder;
    }
    set placeholder(e) {
      this._placeholder = e;
      this._substituted
        ? (this._updateSurrogate(), (this._dom_input.placeholder = ""))
        : (this._dom_input.placeholder = e);
    }
    get disabled() {
      return this._disabled;
    }
    set disabled(e) {
      this._disabled = e;
      this._dom_input.disabled = e;
      this._setState(e ? "DISABLED" : "DEFAULT");
    }
    get maxLength() {
      return this._max_length;
    }
    set maxLength(e) {
      this._max_length = e;
      this._dom_input.setAttribute("maxlength", e);
    }
    get restrict() {
      return this._restrict_regex;
    }
    set restrict(e) {
      e instanceof RegExp
        ? ((e = e.toString().slice(1, -1)),
          "^" !== e.charAt(0) && (e = "^" + e),
          "$" !== e.charAt(e.length - 1) && (e += "$"),
          (e = new RegExp(e)))
        : (e = new RegExp("^[" + e + "]*$"));
      this._restrict_regex = e;
    }
    get text() {
      return this._dom_input.value;
    }
    set text(e) {
      this._dom_input.value = e;
      this._substituted && this._updateSurrogate();
    }
    get htmlInput() {
      return this._dom_input;
    }
    focus() {
      this._substituted && !this.dom_visible && this._setDOMInputVisible(!0);
      this._dom_input.focus();
    }
    blur() {
      this._dom_input.blur();
    }
    select() {
      this.focus();
      this._dom_input.select();
    }
    setInputStyle(e, f) {
      this._input_style[e] = f;
      this._dom_input.style[e] = f;
      !this._substituted || ("fontFamily" !== e && "fontSize" !== e) || this._updateFontMetrics();
      this._last_renderer && this._update();
    }
    destroy(e) {
      this._destroyBoxCache();
      super.destroy(e);
    }
    _createDOMInput() {
      this._multiline
        ? ((this._dom_input = document.createElement("textarea")),
          (this._dom_input.style.resize = "none"))
        : ((this._dom_input = document.createElement("input")), (this._dom_input.type = "text"));
      for (let e in this._input_style) this._dom_input.style[e] = this._input_style[e];
    }
    _addListeners() {
      this.on("added", this._onAdded.bind(this));
      this.on("removed", this._onRemoved.bind(this));
      this._dom_input.addEventListener("keydown", this._onInputKeyDown.bind(this));
      this._dom_input.addEventListener("input", this._onInputInput.bind(this));
      this._dom_input.addEventListener("keyup", this._onInputKeyUp.bind(this));
      this._dom_input.addEventListener("focus", this._onFocused.bind(this));
      this._dom_input.addEventListener("blur", this._onBlurred.bind(this));
    }
    _onInputKeyDown(e) {
      this._selection = [this._dom_input.selectionStart, this._dom_input.selectionEnd];
      this.emit("keydown", e.keyCode);
    }
    _onInputInput(e) {
      this._restrict_regex && this._applyRestriction();
      this._substituted && this._updateSubstitution();
      this.emit("input", this.text);
    }
    _onInputKeyUp(e) {
      this.emit("keyup", e.keyCode);
    }
    _onFocused() {
      this._setState("FOCUSED");
      this.emit("focus");
    }
    _onBlurred() {
      this._setState("DEFAULT");
      this.emit("blur");
    }
    _onAdded() {
      document.body.appendChild(this._dom_input);
      this._dom_input.style.display = "none";
      this._dom_added = !0;
    }
    _onRemoved() {
      document.body.removeChild(this._dom_input);
      this._dom_added = !1;
    }
    _setState(e) {
      this.state = e;
      this._updateBox();
      this._substituted && this._updateSubstitution();
    }
    renderWebGL(e) {
      super.renderWebGL(e);
      this._renderInternal(e);
    }
    renderCanvas(e) {
      super.renderCanvas(e);
      this._renderInternal(e);
    }
    render(e) {
      super.render(e);
      this._renderInternal(e);
    }
    _renderInternal(e) {
      this._resolution = e.resolution;
      this._last_renderer = e;
      this._canvas_bounds = this._getCanvasBounds();
      this._needsUpdate() && this._update();
    }
    _update() {
      this._updateDOMInput();
      this._substituted && this._updateSurrogate();
      this._updateBox();
    }
    _updateBox() {
      this._box_generator &&
        (this._needsNewBoxCache() && this._buildBoxCache(),
        this.state != this._previous.state || this._box != this._box_cache[this.state]) &&
        (this._box && this.removeChild(this._box),
        (this._box = this._box_cache[this.state]),
        this.addChildAt(this._box, 0),
        (this._previous.state = this.state));
    }
    _updateSubstitution() {
      "FOCUSED" === this.state
        ? ((this._dom_visible = !0), (this._surrogate.visible = 0 === this.text.length))
        : ((this._dom_visible = !1), (this._surrogate.visible = !0));
      this._updateDOMInput();
      this._updateSurrogate();
    }
    _updateDOMInput() {
      this._canvas_bounds &&
        ((this._dom_input.style.top = (this._canvas_bounds.top || 0) + "px"),
        (this._dom_input.style.left = (this._canvas_bounds.left || 0) + "px"),
        (this._dom_input.style.transform = this._pixiMatrixToCSS(
          this._getDOMRelativeWorldTransform()
        )),
        (this._dom_input.style.opacity = this.worldAlpha),
        this._setDOMInputVisible(this.worldVisible && this._dom_visible),
        (this._previous.canvas_bounds = this._canvas_bounds),
        (this._previous.world_transform = this.worldTransform.clone()),
        (this._previous.world_alpha = this.worldAlpha),
        (this._previous.world_visible = this.worldVisible));
    }
    _applyRestriction() {
      this._restrict_regex.test(this.text)
        ? (this._restrict_value = this.text)
        : ((this.text = this._restrict_value),
          this._dom_input.setSelectionRange(this._selection[0], this._selection[1]));
    }
    _needsUpdate() {
      return (
        !this._comparePixiMatrices(this.worldTransform, this._previous.world_transform) ||
        !this._compareClientRects(this._canvas_bounds, this._previous.canvas_bounds) ||
        this.worldAlpha != this._previous.world_alpha ||
        this.worldVisible != this._previous.world_visible
      );
    }
    _needsNewBoxCache() {
      let e = this._getDOMInputBounds();
      return (
        !this._previous.input_bounds ||
        e.width != this._previous.input_bounds.width ||
        e.height != this._previous.input_bounds.height
      );
    }
    _createSurrogate() {
      this._surrogate_hitbox = new c.Graphics();
      this._surrogate_hitbox.alpha = 0;
      this._surrogate_hitbox.interactive = !0;
      this._surrogate_hitbox.cursor = "text";
      this._surrogate_hitbox.on("pointerdown", this._onSurrogateFocus.bind(this));
      this.addChild(this._surrogate_hitbox);
      this._surrogate_mask = new c.Graphics();
      this.addChild(this._surrogate_mask);
      this._surrogate = new c.Text("", {});
      this.addChild(this._surrogate);
      this._surrogate.mask = this._surrogate_mask;
      this._updateFontMetrics();
      this._updateSurrogate();
    }
    _updateSurrogate() {
      let e = this._deriveSurrogatePadding(),
        f = this._getDOMInputBounds();
      this._surrogate.style = this._deriveSurrogateStyle();
      this._surrogate.style.padding = Math.max.apply(Math, e);
      this._surrogate.y = this._multiline ? e[0] : (f.height - this._surrogate.height) / 2;
      this._surrogate.x = e[3];
      this._surrogate.text = this._deriveSurrogateText();
      switch (this._surrogate.style.align) {
        case "left":
          this._surrogate.x = e[3];
          break;
        case "center":
          this._surrogate.x = 0.5 * f.width - 0.5 * this._surrogate.width;
          break;
        case "right":
          this._surrogate.x = f.width - e[1] - this._surrogate.width;
      }
      this._updateSurrogateHitbox(f);
      this._updateSurrogateMask(f, e);
    }
    _updateSurrogateHitbox(e) {
      this._surrogate_hitbox.clear();
      this._surrogate_hitbox.beginFill(0);
      this._surrogate_hitbox.drawRect(0, 0, e.width, e.height);
      this._surrogate_hitbox.endFill();
      this._surrogate_hitbox.interactive = !this._disabled;
    }
    _updateSurrogateMask(e, f) {
      this._surrogate_mask.clear();
      this._surrogate_mask.beginFill(0);
      this._surrogate_mask.drawRect(f[3], 0, e.width - f[3] - f[1], e.height);
      this._surrogate_mask.endFill();
    }
    _destroySurrogate() {
      this._surrogate &&
        (this.removeChild(this._surrogate),
        this.removeChild(this._surrogate_hitbox),
        this._surrogate.destroy(),
        this._surrogate_hitbox.destroy(),
        (this._surrogate_hitbox = this._surrogate = null));
    }
    _onSurrogateFocus() {
      this._setDOMInputVisible(!0);
      setTimeout(this._ensureFocus.bind(this), 10);
    }
    _ensureFocus() {
      this._hasFocus() || this.focus();
    }
    _deriveSurrogateStyle() {
      let e = new c.TextStyle();
      for (var f in this._input_style)
        switch (f) {
          case "color":
            e.fill = this._input_style.color;
            break;
          case "fontFamily":
          case "fontSize":
          case "fontWeight":
          case "fontVariant":
          case "fontStyle":
            e[f] = this._input_style[f];
            break;
          case "letterSpacing":
            e.letterSpacing = parseFloat(this._input_style.letterSpacing);
            break;
          case "textAlign":
            e.align = this._input_style.textAlign;
        }
      this._multiline &&
        ((e.lineHeight = parseFloat(e.fontSize)),
        (e.wordWrap = !0),
        (e.wordWrapWidth = this._getDOMInputBounds().width));
      0 === this._dom_input.value.length && (e.fill = this._placeholderColor);
      return e;
    }
    _deriveSurrogatePadding() {
      let e = this._input_style.textIndent ? parseFloat(this._input_style.textIndent) : 0;
      if (this._input_style.padding && 0 < this._input_style.padding.length) {
        var f = this._input_style.padding.trim().split(" ");
        if (1 == f.length) {
          var g = parseFloat(f[0]);
          return [g, g, g, g + e];
        }
        if (2 == f.length) return (g = parseFloat(f[0])), (f = parseFloat(f[1])), [g, f, g, f + e];
        if (4 == f.length) return (g = f.map((h) => parseFloat(h))), (g[3] += e), g;
      }
      return [0, 0, 0, e];
    }
    _deriveSurrogateText() {
      return 0 === this._dom_input.value.length
        ? this._placeholder
        : "password" == this._dom_input.type
        ? "\u2022".repeat(this._dom_input.value.length)
        : this._dom_input.value;
    }
    _updateFontMetrics() {
      const e = this._deriveSurrogateStyle().toFontString();
      this._font_metrics = c.TextMetrics.measureFont(e);
    }
    _buildBoxCache() {
      this._destroyBoxCache();
      let e = ["DEFAULT", "FOCUSED", "DISABLED"],
        f = this._getDOMInputBounds();
      for (let g in e) this._box_cache[e[g]] = this._box_generator(f.width, f.height, e[g]);
      this._previous.input_bounds = f;
    }
    _destroyBoxCache() {
      this._box && (this.removeChild(this._box), (this._box = null));
      for (let e in this._box_cache)
        this._box_cache[e].destroy(), (this._box_cache[e] = null), delete this._box_cache[e];
    }
    _hasFocus() {
      return document.activeElement === this._dom_input;
    }
    _setDOMInputVisible(e) {
      this._dom_input.style.display = e ? "block" : "none";
    }
    _getCanvasBounds() {
      var e = this._last_renderer.view.getBoundingClientRect();
      e = { top: e.top, left: e.left, width: e.width, height: e.height };
      e.left += window.scrollX;
      e.top += window.scrollY;
      return e;
    }
    _getDOMInputBounds() {
      let e = !1;
      this._dom_added || (document.body.appendChild(this._dom_input), (e = !0));
      let f = this._dom_input.style.transform,
        g = this._dom_input.style.display;
      this._dom_input.style.transform = "";
      this._dom_input.style.display = "block";
      let h = this._dom_input.getBoundingClientRect();
      this._dom_input.style.transform = f;
      this._dom_input.style.display = g;
      e && document.body.removeChild(this._dom_input);
      return h;
    }
    _getDOMRelativeWorldTransform() {
      let e = this._last_renderer.view.getBoundingClientRect(),
        f = this.worldTransform.clone();
      f.scale(this._resolution, this._resolution);
      f.scale(e.width / this._last_renderer.width, e.height / this._last_renderer.height);
      return f;
    }
    _pixiMatrixToCSS(e) {
      return "matrix(" + [e.a, e.b, e.c, e.d, e.tx, e.ty].join() + ")";
    }
    _comparePixiMatrices(e, f) {
      return e && f
        ? e.a == f.a && e.b == f.b && e.c == f.c && e.d == f.d && e.tx == f.tx && e.ty == f.ty
        : !1;
    }
    _compareClientRects(e, f) {
      return e && f
        ? e.left == f.left && e.top == f.top && e.width == f.width && e.height == f.height
        : !1;
    }
  }
  a.exportTo[0][a.exportTo[1]] = d;
})({ PIXI, exportTo: [PIXI, "TextInput"] });
var menu = {};
class Menu extends PIXI.Container {
  constructor() {
    super();
    this.container = new PIXI.Container();
    this.active = !0;
    this.updating = this.guestMode = !1;
    this.backgroundImage = new PIXI.Graphics();
    this.backgroundImage.y = 40;
    this.backgroundImage.lineStyle(1, 16777215, 0.1, 0);
    this.backgroundImage.beginFill(3355443, 0.9);
    this.backgroundImage.drawRect(0, 0, 660, 524, 10);
    this.backgroundImage.endFill();
    this.backgroundImage.interactive = !0;
    this.container.addChild(this.backgroundImage);
    this.backgroundGraphics = new PIXI.Graphics();
    this.backgroundGraphics.lineStyle(1, 16777215, 0.1, 0);
    this.backgroundGraphics.beginFill(0, 0.3);
    this.backgroundGraphics.drawRect(-8, 0, 408, 292, 10);
    this.backgroundGraphics.endFill();
    this.backgroundGraphics.beginFill(0, 0.05);
    this.backgroundGraphics.lineStyle(3, 16777215, 0.05, 0);
    this.backgroundGraphics.drawRect(-8, 0, 408, 74, 10);
    this.backgroundGraphics.endFill();
    this.backgroundGraphics.beginFill(16777215, 0.02);
    this.backgroundGraphics.lineStyle(1, 16777215, 0.05, 0);
    this.backgroundGraphics.drawRect(-7, 82, 406, 40, 10);
    this.backgroundGraphics.endFill();
    this.backgroundGraphics.beginFill(16777215, 0.02);
    this.backgroundGraphics.lineStyle(1, 16777215, 0.05, 0);
    this.backgroundGraphics.drawRect(-7, 122, 406, 40, 10);
    this.backgroundGraphics.endFill();
    this.container.addChild(this.backgroundGraphics);
    this.backgroundGraphics.y = 48;
    this.settingsBackgroundGraphics = new PIXI.Graphics();
    this.settingsBackgroundGraphics.lineStyle(1, 16777215, 0.1, 0);
    this.settingsBackgroundGraphics.beginFill(0, 0.3);
    this.settingsBackgroundGraphics.drawRect(0, 0, 220, 290, 10);
    this.settingsBackgroundGraphics.endFill();
    this.container.addChild(this.settingsBackgroundGraphics);
    this.settingsBackgroundGraphics.y = 48;
    this.settingsPanel = new SettingsPanel(660, 524);
    this.settingsPanel.y = 40;
    this.backgroundNewsGraphics = new PIXI.Graphics();
    this.backgroundNewsGraphics.lineStyle(1, 16777215, 0.1, 0);
    this.backgroundNewsGraphics.beginFill(0, 0.3);
    this.backgroundNewsGraphics.drawRect(-8, 0, 640, 204, 10);
    this.backgroundNewsGraphics.endFill();
    this.container.addChild(this.backgroundNewsGraphics);
    this.backgroundNewsGraphics.x = 0.5 * App.ReferenceWidth - 290;
    this.backgroundNewsGraphics.y = 350;
    this.snowman = new PIXI.Sprite(App.CombinedTextures.ship);
    this.snowman.y = 375;
    this.snowman.interactive = !0;
    this.container.addChild(this.snowman);
    this.snowman.tint = 11184810;
    this.snowman.scale.x = this.snowman.scale.y = 0.7;
    this.poseImage = new PIXI.Sprite(App.CombinedTextures.pose);
    this.poseImage.y = 350;
    this.poseImage.anchor.x = 0.5;
    this.poseImage.scale.x = this.poseImage.scale.y = 0.775;
    this.poseImage.alpha = 0.7;
    this.container.addChild(this.poseImage);
    this.darkNewsBackground = new PIXI.Graphics();
    this.darkNewsBackground.x = 100;
    this.darkNewsBackground.y = 340;
    this.darkNewsBackground.beginFill(0, 0.2);
    this.darkNewsBackground.lineStyle(1, 16777215, 0.05, 0);
    this.darkNewsBackground.drawRect(20, 20, 400, 100);
    this.darkNewsBackground.endFill();
    this.container.addChild(this.darkNewsBackground);
    this.infoText = new PIXI.Text("Version 0.3.0 beta released", {
      fontSize: 14,
      fontFamily: "Arial",
      fill: 16777215,
      lineJoin: "round",
      strokeThickness: 1,
      align: "left",
    });
    this.infoText.tint = 16763904;
    this.infoText.resolution = 1.5 * App.DevicePixelRatio;
    this.infoText.x = this.darkNewsBackground.x + 26;
    this.infoText.y = this.darkNewsBackground.y + 24;
    this.infoText.interactive = !0;
    this.container.addChild(this.infoText);
    this.infoTextDisc = new PIXI.Text(
      "- Training mode added\n- New damage model\n- Graphics & UI quality improved\n- Performance optimizations",
      {
        fontSize: 12,
        fontFamily: "Arial",
        fill: 16777215,
        lineJoin: "round",
        strokeThickness: 1,
        align: "left",
      }
    );
    this.infoTextDisc.tint = 11184810;
    this.infoTextDisc.resolution = 1.5 * App.DevicePixelRatio;
    this.infoTextDisc.x = this.darkNewsBackground.x + 30;
    this.infoTextDisc.y = this.darkNewsBackground.y + 50;
    this.infoTextDisc.interactive = !0;
    this.container.addChild(this.infoTextDisc);
    this.newsIcon = new PIXI.Sprite(App.CombinedTextures.menu_icon_news);
    this.newsIcon.y = 520;
    this.newsIcon.interactive = !0;
    this.container.addChild(this.newsIcon);
    this.newsIcon.tint = 11184810;
    this.newsIcon.scale.x = this.newsIcon.scale.y = 0.5;
    this.newsText = new PIXI.Text("News", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16763904,
      lineJoin: "round",
      strokeThickness: 3,
      align: "left",
    });
    this.newsText.tint = 11184810;
    this.newsText.resolution = 1.5 * App.DevicePixelRatio;
    this.newsText.y = this.newsIcon.y + 4;
    this.newsText.interactive = !0;
    this.container.addChild(this.newsText);
    this.versionText = new PIXI.Text("v" + App.ClientVersion, {
      fontSize: 12,
      fontFamily: "Arial",
      fill: 8947848,
      lineJoin: "round",
      strokeThickness: 2,
      align: "left",
    });
    this.versionText.y = 514;
    this.versionText.anchor.x = 1;
    this.versionText.resolution = 1.5 * App.DevicePixelRatio;
    this.container.addChild(this.versionText);
    this.newsDescription = new PIXI.Text("", {
      fontSize: 14,
      fontFamily: "Arial",
      fill: 11184810,
      lineJoin: "round",
      strokeThickness: 2,
      align: "left",
    });
    this.newsDescription.y = 493;
    this.newsDescription.resolution = 1.5 * App.DevicePixelRatio;
    this.newsDescription.interactive = !0;
    this.newsIcon.on("mousedown", () => {
      this.emit(Menu.NEWS_ACCESS);
    });
    this.newsText.on("mousedown", () => {
      this.emit(Menu.NEWS_ACCESS);
    });
    this.newsText.on("mouseover", () => {
      this.newsIcon.tint = 16777215;
      this.newsText.tint = 16777215;
    });
    this.newsText.on("mouseout", () => {
      this.newsIcon.tint = 11184810;
      this.newsText.tint = 11184810;
    });
    this.newsIcon.on("mouseover", () => {
      this.newsIcon.tint = 16777215;
      this.newsText.tint = 16777215;
    });
    this.newsIcon.on("mouseout", () => {
      this.newsIcon.tint = 11184810;
      this.newsText.tint = 11184810;
    });
    this.newsDescription.tint = 11184810;
    this.newsDescription.on("mouseover", () => {
      this.newsIcon.tint = 16777215;
      this.newsDescription.tint = 16777215;
    });
    this.newsDescription.on("mouseout", () => {
      this.newsIcon.tint = 11184810;
      this.newsDescription.tint = 11184810;
    });
    this.newsDescription.on("mousedown", () => {
      this.emit(Menu.NEWS_ACCESS);
    });
    this.icon = new PIXI.Sprite(App.CombinedTextures.gamelogo);
    this.icon.y = 46;
    this.icon.scale.x = this.icon.scale.y = 0.5;
    this.container.addChild(this.icon);
    this.contactInfo = new PIXI.Text("Contact: dev@ninja.io", {
      fontSize: 13,
      fontFamily: "Arial",
      fill: 13421772,
      lineJoin: "round",
      strokeThickness: 3,
      align: "left",
    });
    this.contactInfo.resolution = 1.5 * App.DevicePixelRatio;
    this.contactInfo.anchor.x = 1;
    this.contactInfo.y = 531;
    this.contactInfo.interactive = !0;
    App.WhiteLabel !== App.WhiteLabel_POKI &&
      (this.contactInfo.on("mousedown", () => (location.href = "mailto:dev@ninja.io")),
      this.contactInfo.on("touchstart", () => (location.href = "mailto:dev@ninja.io")),
      this.contactInfo.on(
        "mouseover",
        () => (this.contactInfo.scale.x = this.contactInfo.scale.y = 1.1)
      ),
      this.contactInfo.on(
        "mouseout",
        () => (this.contactInfo.scale.x = this.contactInfo.scale.y = 1)
      ));
    this.contactInfo.alpha = 0.8;
    this.container.addChild(this.contactInfo);
    this.gameStatsTitle = new PIXI.Text("Status", {
      fontSize: 15,
      fontFamily: "Arial",
      fill: 16763904,
      lineJoin: "round",
      strokeThickness: 2,
      align: "right",
    });
    this.gameStatsTitle.resolution = 1.5 * App.DevicePixelRatio;
    this.gameStatsTitle.y = 60;
    this.gameStatsTitle.anchor.x = 1;
    this.container.addChild(this.gameStatsTitle);
    this.gameStats = new PIXI.Text("", {
      fontSize: 13,
      fontFamily: "Arial",
      fill: 13421772,
      lineJoin: "round",
      strokeThickness: 2,
      align: "right",
    });
    this.gameStats.resolution = 1.5 * App.DevicePixelRatio;
    this.gameStats.y = 78;
    this.gameStats.anchor.x = 1;
    this.container.addChild(this.gameStats);
    this.newsFlash = new PIXI.Text("Initializing...", {
      fontSize: 14,
      fontFamily: "Arial",
      fill: 16777215,
      lineJoin: "round",
      strokeThickness: 3,
      align: "left",
    });
    this.newsFlash.y = 12;
    this.newsFlash.resolution = 1.5 * App.DevicePixelRatio;
    this.newsFlash.anchor.x = 0.5;
    this.container.addChild(this.newsFlash);
    this.registerHintTitle = new PIXI.Text("Register to customize", {
      fontName: "Arial",
      fontSize: 17,
      lineHeight: 16,
      fill: 16755200,
      strokeThickness: 3,
      lineJoin: "round",
    });
    this.registerHintTitle.y = 230;
    this.registerHintTitle.resolution = 1.5 * App.DevicePixelRatio;
    this.registerHintTitle.visible = !1;
    this.visualizer = new Visualizer(200, 200, !0, !0, !1);
    this.visualizer.y = 56;
    this.visualizer.interactive = !0;
    this.visualizer.on("mousedown", () => {
      this.guestMode ||
        (this.emit(Menu.CUSTOMIZATION_ACCESS), AudioEffects.ButtonClick.audio.play());
    });
    this.visualizer.on("touchstart", () => {
      this.guestMode ||
        (this.emit(Menu.CUSTOMIZATION_ACCESS), AudioEffects.ButtonClick.audio.play());
    });
    this.visualizer.on("mouseover", () => {
      this.registerHintTitle.visible = !0;
      AudioEffects.ButtonHover.audio.play();
    });
    this.visualizer.on("mouseout", () => (this.registerHintTitle.visible = !1));
    this.container.addChild(this.visualizer);
    this.modeTitle = new PIXI.BitmapText("", {
      fontName: "Open Sans",
      fontSize: 22,
      align: "left",
    });
    this.modeTitle.y = 106;
    this.modeTitle.tint = 16755200;
    this.container.addChild(this.modeTitle);
    this.modeTitle.visible = !1;
    this.rewardButton = new PIXI.Sprite(App.CombinedTextures.claim_reward);
    this.rewardButton.y = 210;
    this.rewardButton.interactive = !0;
    this.rewardButton.hitArea = new PIXI.Rectangle(
      -5,
      -5,
      this.rewardButton.width + 10,
      this.rewardButton.height + 13
    );
    this.container.addChild(this.rewardButton);
    this.treasureIcon = new PIXI.Sprite(App.CombinedTextures.treasure);
    this.treasureIcon.y = 200;
    this.treasureIcon.interactive = !1;
    this.container.addChild(this.treasureIcon);
    this.rewardButton.on("mouseover", () => {
      this.rewardButton.scale.x = this.rewardButton.scale.y = 1.04;
      this.treasureIcon.scale.x = this.treasureIcon.scale.y = 1.04;
    });
    this.rewardButton.on("mouseout", () => {
      this.rewardButton.scale.x = this.rewardButton.scale.y = 1;
      this.treasureIcon.scale.x = this.treasureIcon.scale.y = 1;
    });
    this.rewardButton.on("mousedown", () => {
      this.emit(Menu.REWARDS_ACCESS);
    });
    this.rewardButton.on("touchstart", () => {
      this.emit(Menu.REWARDS_ACCESS);
    });
    this.serverListButton = new Button(
      "list",
      App.CombinedTextures.gamelist,
      App.CombinedTextures.gamelist_hover
    );
    this.serverListButton.y = 280;
    this.serverListButton.selected = !0;
    this.serverListButton.setText("");
    this.serverListButton.setTint(16763904);
    this.serverListButton.scale.x = this.serverListButton.scale.y = 0.6;
    this.serverListButton.addListener(
      Button.BUTTON_RELEASED,
      this.onServerListButtonReleased.bind(this)
    );
    this.container.addChild(this.serverListButton);
    this.serverCreateButton = new Button(
      "create",
      App.CombinedTextures.creategame,
      App.CombinedTextures.creategame_hover
    );
    this.serverCreateButton.y = 280;
    this.serverCreateButton.selected = !0;
    this.serverCreateButton.setText("");
    this.serverCreateButton.disable();
    this.serverCreateButton.setTint(16763904);
    this.serverCreateButton.scale.x = this.serverCreateButton.scale.y = 0.6;
    this.serverCreateButton.addListener(
      Button.BUTTON_RELEASED,
      this.onServerCreateButtonReleased.bind(this)
    );
    this.container.addChild(this.serverCreateButton);
    this.regionData = new PIXI.Text("Loading..", {
      fontSize: 15,
      fontFamily: "Arial",
      fill: 16763904,
      lineJoin: "round",
      strokeThickness: 2,
      align: "left",
    });
    this.regionData.resolution = 1.5 * App.DevicePixelRatio;
    this.regionData.pivot.x = 0.5 * this.regionData.width;
    this.regionData.y = 142;
    this.container.addChild(this.regionData);
    this.modeData = new PIXI.Text("Loading..", {
      fontSize: 15,
      fontFamily: "Arial",
      fill: 16763904,
      lineJoin: "round",
      strokeThickness: 2,
      align: "left",
    });
    this.modeData.resolution = 1.5 * App.DevicePixelRatio;
    this.modeData.pivot.x = 0.5 * this.modeData.width;
    this.modeData.y = 182;
    this.container.addChild(this.modeData);
    this.interactive = !0;
    this.nameTitle = new PIXI.Text("", {
      fontSize: 18,
      fontFamily: "Arial",
      fill: 16763904,
      lineJoin: "round",
      strokeThickness: 3,
      align: "center",
    });
    this.nameTitle.anchor.x = 0.5;
    this.nameTitle.resolution = 2;
    this.nameTitle.y = 264;
    this.container.addChild(this.nameTitle);
    this.levelIcon = new PIXI.Sprite();
    this.levelIcon.y = 48;
    this.levelIcon.scale.x = this.levelIcon.scale.y = 0.8;
    this.container.addChild(this.levelIcon);
    this.levelText = new PIXI.Text("", {
      fontSize: 20,
      fontFamily: "Arial",
      fill: 13421772,
      lineJoin: "round",
      strokeThickness: 3,
      align: "center",
    });
    this.levelText.y = this.levelIcon.y + 23;
    this.levelText.anchor.x = 0.5;
    this.levelText.resolution = 1.5 * App.DevicePixelRatio;
    this.container.addChild(this.levelText);
    this.nameField = new InputField("guest_name", !1, 32, !1);
    this.nameField.setDimensions(210, 35);
    this.nameField.forceLowerCase = !1;
    this.nameField.setMaxChars(18);
    this.nameField.hideBorders();
    this.nameField.y = 294;
    this.nameField.centerInput = !0;
    this.nameField.on(InputField.FOCUS, (a) => this.onNamefieldFocus(a));
    this.nameField.setFilter(
      "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-().[]"
    );
    this.skillText = new PIXI.Text("", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 13421772,
      lineJoin: "round",
      strokeThickness: 3,
      align: "center",
    });
    this.skillText.resolution = 1.5 * App.DevicePixelRatio;
    this.skillText.y = 290;
    this.skillText.anchor.x = 0.5;
    this.container.addChild(this.skillText);
    this.clanText = new PIXI.Text("", {
      fontSize: 16,
      fontFamily: "Arial",
      fill: 16755200,
      lineJoin: "round",
      strokeThickness: 3,
      align: "center",
    });
    this.clanText.resolution = 1.5 * App.DevicePixelRatio;
    this.clanText.y = 310;
    this.clanText.anchor.x = 0.5;
    this.clanText.hitArea = new PIXI.Rectangle(0, 0, 0, 0);
    this.container.addChild(this.clanText);
    this.joinButton = new Button(
      "join",
      App.CombinedTextures.playbutton,
      App.CombinedTextures.playbutton_hover,
      1e3
    );
    this.joinButton.y = 216;
    this.joinButton.selected = !0;
    this.joinButton.setText("");
    this.container.addChild(this.joinButton);
    this.joinButton.scale.x = this.joinButton.scale.y = 0.6;
    this.joinButton.addListener(Button.BUTTON_RELEASED, this.onJoinButtonReleased.bind(this));
    this.joinButton.setTint(16763904);
    this.joinButton.disable();
    this.modeContainer = new PIXI.Container();
    this.modeContainer.y = 116;
    this.container.addChild(this.modeContainer);
    this.serverContainer = new PIXI.Container();
    this.serverContainer.y = 80;
    this.container.addChild(this.serverContainer);
    this.serverList = new Dropdown("serverSelect", "Region", 200, 256);
    this.modeList = new Dropdown("modeSelect", "Mode", 200, 220, !0);
    this.playerIsReady = !1;
    this.setMode(Menu.MODE_MAIN);
    this.addChild(this.container);
    this.particleContainer = new ParticleContainer();
    this.container.addChild(this.particleContainer);
    this.resize();
  }
  showSettings() {
    this.container.addChild(this.settingsPanel);
    this.settingsPanel.show();
  }
  hideSettings() {
    this.settingsPanel.parent && this.container.removeChild(this.settingsPanel);
  }
  setServerHeadline(a) {
    this.newsDescription.text !== a.description && (this.newsDescription.text = a.description);
  }
  setServerStatus(a) {
    a.message !== this.newsFlash.text && (this.newsFlash.text = a.message);
    (this.updating = a.updating) && 360 !== parseInt(App.Credential.playerid)
      ? (this.serverCreateButton.disable(), (this.newsFlash.tint = 16711680))
      : ((this.newsFlash.tint = 16777215), this.guestMode || this.serverCreateButton.enable());
  }
  setServerData(a) {
    null === this.joinButton.clickTimeout && this.joinButton.enable();
    this.serverList.clear();
    let b = 0,
      c = 0,
      d = a.length;
    for (var e = 0; e < d; e++) {
      let f = a[e];
      b += parseInt(f.games);
      c += parseInt(f.players);
      this.serverList.addItem(f.title, f.id, f.players + " players");
      ((null !== App.SelectedServer && f.uid === App.SelectedServer.uid) ||
        null === App.SelectedServer) &&
        this.serverList.setValue(f.id);
    }
    this.gameStats.text = b + " games in progress\n" + c + " players online";
    0 < d && this.setLobbyDataText();
    this.serverList.draw();
  }
  setLobbyDataText() {
    if (null === App.SelectedServer)
      (this.regionData.text = "Loading..."), (this.modeData.text = "Loading...");
    else {
      var a = App.SelectedServer.modes[App.SelectedMode];
      this.regionData.text =
        (void 0 !== App.SelectedServer ? App.SelectedServer.players : "0") + " players";
      this.modeData.text = (void 0 !== a ? a.toString() : "0") + " players";
    }
  }
  selectServer(a) {
    this.serverList.setValue(a);
  }
  onServerListButtonReleased() {
    this.emit(Menu.SERVER_LISTING_ACCESS);
  }
  onServerCreateButtonReleased() {
    this.emit(Menu.SERVER_CREATION_ACCESS);
  }
  setPlayerData(a) {
    var b = App.Autogen && null !== App.Credential.id;
    a.guest
      ? ((this.guestMode = !0),
        (this.levelIcon.visible = !1),
        (this.levelText.visible = !1),
        (this.skillText.visible = !1),
        (this.clanText.visible = !1),
        (this.nameTitle.text = "Playing as guest"),
        (this.nameTitle.scale.x = this.nameTitle.scale.y = 1),
        (this.nameTitle.y = 264),
        this.nameField.parent || this.container.addChild(this.nameField),
        this.nameField.setText(a.name),
        this.registerHintTitle.parent || this.container.addChild(this.registerHintTitle),
        this.serverCreateButton.disable())
      : ((this.guestMode = !1),
        (this.levelIcon.visible = !0),
        (this.levelText.visible = !0),
        b
          ? ((this.clanText.visible = !1),
            (this.skillText.visible = !1),
            (this.nameTitle.text = "Playing as"),
            (this.nameTitle.scale.x = this.nameTitle.scale.y = 1),
            (this.nameTitle.y = 264),
            this.nameField.parent || this.container.addChild(this.nameField),
            this.nameField.setText(a.name))
          : ((this.skillText.visible = !0),
            (this.clanText.visible = !0),
            this.nameField.parent && this.container.removeChild(this.nameField),
            (this.nameTitle.text = a.name),
            (this.nameTitle.scale.x = this.nameTitle.scale.y = 1.3),
            (this.nameTitle.y = 260)),
        this.registerHintTitle.parent && this.container.removeChild(this.registerHintTitle),
        (this.updating && 360 !== parseInt(App.Credential.playerid)) ||
          this.serverCreateButton.enable(),
        (this.levelIcon.texture =
          App.CombinedTextures[
            "skill_icon_" + Math.max(Math.floor((App.Credential.level / 160) * 10) + 1)
          ]),
        (this.levelText.text = App.Credential.level.toString()),
        (b = Game.MapSkillToTitle(App.Credential.skill)),
        (this.skillText.text = b + ", level " + App.Credential.level),
        (this.clanText.text =
          -1 !== App.Credential.clan_id && null !== App.Credential.clan_id
            ? "Clan " + App.Credential.clan_role + " of " + App.Credential.clan_name
            : "Freelancer"));
    this.visualizer.applyCustomization(a.customization);
  }
  init() {
    this.modeList.addItem(
      Game.MODE_TITLES[Game.MODE_DM],
      Game.MODE_DM,
      "",
      App.CombinedTextures.dm_icon_notxt
    );
    this.modeList.addItem(
      Game.MODE_TITLES[Game.MODE_TDM],
      Game.MODE_TDM,
      "",
      App.CombinedTextures.tdm_icon_notxt
    );
    this.modeList.addItem(
      Game.MODE_TITLES[Game.MODE_CTF],
      Game.MODE_CTF,
      "",
      App.CombinedTextures.ctf_icon_notxt
    );
    this.modeList.addItem(
      Game.MODE_TITLES[Game.MODE_DB],
      Game.MODE_DB,
      "",
      App.CombinedTextures.db_icon_notxt
    );
    this.modeList.addItem(
      Game.MODE_TITLES[Game.MODE_TR],
      Game.MODE_TR,
      "",
      App.CombinedTextures.tr_icon_notxt
    );
    this.modeList.addListener(Button.BUTTON_RELEASED, this.onModeButtonReleased.bind(this));
    this.modeList.draw();
    this.modeList.setValue(App.SelectedMode);
    this.modeContainer.addChild(this.modeList);
    this.modeContainer.x = 0.5 * App.ReferenceWidth - 224;
    this.modeList.x = -90;
    this.modeList.y = 65;
    this.serverContainer.addChild(this.serverList);
    this.serverList.addListener(Button.BUTTON_RELEASED, this.onServerButtonReleased.bind(this));
    this.serverList.draw();
    this.serverList.x = -90;
    this.serverList.y = 60;
    this.serverContainer.x = 0.5 * App.ReferenceWidth - 224;
    this.checkRewards();
  }
  showRewardButton() {
    this.rewardButton.visible = !0;
    this.treasureIcon.visible = !0;
  }
  hideRewardButton() {
    this.rewardButton.visible = !1;
    this.treasureIcon.visible = !1;
  }
  async checkRewards(a = !1) {
    App.HadRewards || this.hideRewardButton();
    "guest" === App.Credential.accounttype
      ? this.hideRewardButton()
      : (!a && 6e4 > Date.now() - App.LastRewardCheck) ||
        ((a = await APIClient.getRewardsAvailable(App.Credential.id)),
        (App.LastRewardCheck = Date.now()),
        (App.HadRewards = !1),
        a &&
          a.available &&
          0 < parseInt(a.available, 10) &&
          (this.showRewardButton(), (App.HadRewards = !0)));
  }
  setMode(a, b) {
    if (void 0 === b || !1 !== b.success)
      (this.mode = a),
        (this.serverList.visible = !0),
        (this.regionData.visible = !0),
        (this.modeData.visible = !0),
        (this.joinButton.visible = !0),
        (this.modeContainer.visible = !0),
        (this.serverContainer.visible = !0),
        (this.modeTitle.visible = !1);
  }
  onJoinButtonReleased() {
    this.emit(Menu.JOIN_GAME_MODE, App.SelectedMode);
  }
  onMainMenuButtonReleased() {
    this.setMode(Menu.MODE_MAIN);
  }
  onModeButtonReleased(a) {
    App.SelectedMode = a.data.value;
    this.setLobbyDataText();
  }
  onServerButtonReleased(a) {
    a = a.data.value;
    let b = { modes: {} };
    for (let c = 0; c < App.Servers.length; c++)
      if (App.Servers[c].id === a) {
        b = App.Servers[c];
        break;
      }
    this.emit(Menu.JOIN_SERVER, b, this.setLobbyDataText.bind(this));
  }
  resize() {
    this.nameTitle.x = 0.5 * App.ReferenceWidth + 208;
    this.nameField.x = 0.5 * App.ReferenceWidth + 100;
    this.skillText.x = 0.5 * App.ReferenceWidth + 208;
    this.clanText.x = 0.5 * App.ReferenceWidth + 208;
    this.levelIcon.x = 0.5 * App.ReferenceWidth + 106;
    this.levelText.x = this.levelIcon.x + 31;
    this.regionData.x = 0.5 * App.ReferenceWidth;
    this.modeData.x = 0.5 * App.ReferenceWidth;
    this.modeContainer.x = 0.5 * App.ReferenceWidth - 224;
    this.serverContainer.x = 0.5 * App.ReferenceWidth - 224;
    this.icon.x = 0.5 * App.ReferenceWidth - 316;
    this.gameStats.x = 0.5 * App.ReferenceWidth + 78;
    this.gameStatsTitle.x = this.gameStats.x;
    this.newsFlash.x = 0.5 * App.ReferenceWidth;
    this.joinButton.x = this.modeContainer.x - 20;
    this.modeTitle.x = 0.5 * App.ReferenceWidth - 302;
    this.backgroundGraphics.x = 0.5 * App.ReferenceWidth - 312;
    this.backgroundNewsGraphics.x = 0.5 * App.ReferenceWidth - 312;
    this.settingsBackgroundGraphics.x = 0.5 * App.ReferenceWidth + 100;
    this.contactInfo.x = 0.5 * App.ReferenceWidth + 314;
    this.poseImage.x = 0.5 * App.ReferenceWidth;
    this.snowman.x = 0.5 * App.ReferenceWidth - 320;
    this.newsIcon.x = 0.5 * App.ReferenceWidth - 318;
    this.newsText.x = this.newsIcon.x + this.newsIcon.width;
    this.newsDescription.x = 0.5 * App.ReferenceWidth - 250;
    this.versionText.x = 0.5 * App.ReferenceWidth + 313;
    this.serverListButton.x = 0.5 * App.ReferenceWidth - 243;
    this.serverCreateButton.x = this.serverListButton.x + this.serverListButton.width + 3;
    this.visualizer.x = 0.5 * App.ReferenceWidth + 110;
    this.rewardButton.x = this.visualizer.x + 24;
    this.treasureIcon.x = this.visualizer.x + 8;
    this.registerHintTitle.x =
      this.visualizer.x + 0.5 * (this.visualizer.width - this.registerHintTitle.width);
    this.backgroundImage.x = 0.5 * App.ReferenceWidth - 0.5 * this.backgroundImage.width;
    this.settingsPanel.x = 0.5 * App.ReferenceWidth - 330;
  }
  hideItems() {
    this.removeChild(this.container);
  }
  showItems() {
    this.addChild(this.container);
  }
  onNamefieldFocus(a) {
    a && App.Autogen && null !== App.Credential.id
      ? (this.nameField.setFocus(!1), this.emit(Menu.RENAME_ACCESS))
      : a ||
        ((a = this.nameField.getText()),
        4 > a.length && this.nameField.setText("Ninja" + Math.floor(1e3 * Math.random())),
        this.nameField.previousText !== a &&
          this.emit(Menu.GUEST_NAME_CHANGE, this.nameField.getText()));
  }
  step() {
    this.visualizer.update();
    if (this.treasureIcon.visible) {
      let a = ParticleEffects.GoldGlitter;
      a.x = this.treasureIcon.x + 0.5 * this.treasureIcon.width;
      a.y = this.treasureIcon.y + 0.5 * this.treasureIcon.height;
      a.vx = -0.5 + 1 * Math.random();
      a.vy = -0.5 + 1 * Math.random();
      a.vr = -0.3 + 0.6 * Math.random();
      a.a = 1;
      this.particleContainer.spawn(a);
    }
    this.particleContainer.update();
  }
}
Menu.JOIN_GAME_MODE = "JoinGameMode";
Menu.JOIN_SERVER = "joinServer";
Menu.MODE_MAIN = "mainMenu";
Menu.GUEST_NAME_CHANGE = "guestNameChange";
Menu.PROFILE_ACCESS = "profileAccess";
Menu.RENAME_ACCESS = "renameAccess";
Menu.CUSTOMIZATION_ACCESS = "customizationAccess";
Menu.SERVER_LISTING_ACCESS = "serverListingAccess";
Menu.SERVER_CREATION_ACCESS = "serverCreationAccess";
Menu.REWARDS_ACCESS = "rewardsAccess";
Menu.NEWS_ACCESS = "newsAccess";
function User() {
  this.name = "anonymous";
  this.skill = 0;
  this.premium = this.admin = !1;
  this.team = 0;
  this.customization = { hair: "original", energy: "#ffffff" };
}
var commandconsole = {};
class CommandConsole extends PIXI.Container {
  constructor() {
    super();
    this.settings = Registry.Instance[Registry.Key.SETTINGS].graphics;
    this.maxLines = void 0 !== this.settings.chatLines ? this.settings.chatLines : 20;
    this.alpha = this.targetAlpha =
      void 0 !== this.settings.chatOpacity ? this.settings.chatOpacity : 1;
    this.interactiveChildren = !1;
    this.messages = [];
    this.lines = [];
    this.interpreters = [];
    this.active = !1;
    this.consoleInput = new InputField("consoleInput", !0);
    this.consoleInput.filterEnabled = !1;
    this.consoleInput.setDimensions(0.8 * App.ClientWidth, 26);
    this.consoleInput.setMaxChars(80);
    this.consoleInput.x = 5;
    this.consoleInput.y = 200;
    this.onConsoleInputFocus(!1);
    this.consoleInput.addListener(InputField.SUBMIT, this.onConsoleInput.bind(this));
    this.addChild(this.consoleInput);
    this.fadeInterval = this.fadeTimeout = null;
    this.setActive(!1);
  }
  log(a, b) {
    this.cancelFade();
    a = new PIXI.BitmapText(a, CommandConsole.FontMessage);
    a.tint = void 0 === b ? 15658734 : b;
    this.messages.length === this.maxLines &&
      0 < this.maxLines &&
      (this.removeChild(this.messages[0]), this.messages.shift());
    this.messages.push(a);
    this.addChild(a);
    this.update();
    this.consoleInput.visible
      ? (this.consoleInput.y =
          0 < this.messages.length ? this.messages[this.messages.length - 1].y + 20 : 200)
      : this.startFade();
    this.active || ((b = this.messages.length), (this.y = 200 < 20 * b ? 200 - 20 * b : 0));
  }
  cancelFade(a = !0) {
    null !== this.fadeTimeout && (clearTimeout(this.fadeTimeout), (this.fadeTimeout = null));
    null !== this.fadeInterval && (clearInterval(this.fadeInterval), (this.fadeInterval = null));
    a && (this.alpha = this.targetAlpha);
  }
  update() {
    var a = this.messages.length;
    let b = 20 * a - 20,
      c = 0;
    for (--a; 0 <= a; a--) {
      let d = this.messages[a];
      d.x = 5;
      d.y = b - 20 * c;
      c++;
    }
  }
  startFade() {
    this.alpha = this.targetAlpha;
    null !== this.fadeTimeout && clearTimeout(this.fadeTimeout);
    this.fadeTimeout = setTimeout(() => this.startInterval(), 3e3);
  }
  startInterval() {
    clearTimeout(this.fadeTimeout);
    this.fadeTimeout = null;
    this.fadeDelay = 0;
    null !== this.fadeInterval && clearInterval(this.fadeInterval);
    this.fadeInterval = setInterval(() => this.step(), 100);
  }
  step() {
    this.fadeDelay--;
    0.21 < this.alpha && (this.alpha -= 0.1);
    -8 >= this.fadeDelay &&
      (clearInterval(this.fadeInterval),
      (this.fadeInterval = null),
      (this.alpha = 0.2 > this.targetAlpha ? this.targetAlpha : 0.2));
  }
  isActive() {
    return this.active;
  }
  setActive(a) {
    let b = this.messages.length;
    a
      ? ((this.consoleInput.visible = !0),
        this.emit(CommandConsole.SHOW),
        this.onConsoleInputFocus(!0),
        (this.y = 0),
        (this.consoleInput.y =
          0 < this.messages.length ? this.messages[this.messages.length - 1].y + 20 : 200),
        this.cancelFade(!1),
        (this.alpha = 1))
      : ((this.consoleInput.visible = !1),
        this.emit(CommandConsole.HIDE),
        this.onConsoleInputFocus(!1),
        (this.y = 200 < 20 * b ? 200 - 20 * b : 0),
        this.startFade());
    this.active = a;
    this.consoleInput.setFocus(a);
  }
  onConsoleInputFocus(a) {}
  onConsoleInput(a) {
    this.consoleInput.setText("");
    for (var b = 0, c = this.interpreters.length; b < c; b++)
      this.interpreters[b].parse(a.data.value);
    this.onConsoleInputFocus(!1);
    this.setActive(!1);
  }
  addInputString(a) {
    this.consoleInput.setText(this.consoleInput.getText() + a);
  }
  reset() {}
  linkInterpreter(a) {
    this.interpreters.push(a);
  }
  unlinkInterpreter(a) {
    for (var b = 0, c = this.interpreters.length; b < c; b++)
      this.interpreters[b] === a && this.interpreters.splice(b, 1);
  }
}
CommandConsole.FontMessage = { fontName: "Open Sans", fontSize: 25 };
CommandConsole.INPUT = "input";
CommandConsole.SHOW = "show";
CommandConsole.HIDE = "hide;";
function DevLog() {
  this.log = function (a) {
    App.Console.log("\t :: " + this.constructor.name + " :: " + a);
  };
}
var orderedcontainer = {};
function OrderedContainer() {
  this._items = {};
  this._order = [];
}
OrderedContainer.Storage = {};
OrderedContainer.prototype = {
  add: function (a, b) {
    return this._items[b]
      ? null
      : ((this._items[b] = { id: b, item: a }), (this._order[this._order.length] = b), a);
  },
  remove: function (a) {
    delete this._items[a];
    this._order.splice(this._order.indexOf(a), 1);
  },
  removeIndex: function (a) {
    delete this._items[this._order[a]];
    this._order.splice(a, 1);
  },
  getLast: function () {
    return 0 < this._order.length ? this._items[this._order[this._order.length - 1]].item : null;
  },
  getIndex: function (a) {
    return void 0 !== this._order[a] ? this._items[this._order[a]].item : null;
  },
  getIdByIndex: function (a) {
    return 0 < this._order.length && void 0 !== this._order[a]
      ? this._items[this._order[a]].id
      : null;
  },
  moveToIndex: function (a, b) {
    var c = this._order[a];
    this._order.splice(a, 1);
    this._order.splice(b, 0, c);
  },
  getIndexById: function (a) {
    for (var b = 0, c = this.getSize(); b < c; b++)
      if (this._items[this._order[b]].id === a) return b;
    return -1;
  },
  swapByIndex: function (a, b) {
    var c = this._order[a];
    this._order[a] = this._order[b];
    this._order[b] = c;
  },
  getById: function (a) {
    return void 0 !== this._items[a] ? this._items[a].item : null;
  },
  setById: function (a, b) {
    void 0 !== this._items[b] ? (this._items[b] = a) : this.add(a, b);
  },
  getSize: function () {
    return this._order.length;
  },
  iterate: function (a) {
    for (
      var b = 0, c = this._order.length;
      b < c && a(this._items[this._order[b]].id, this._items[this._order[b]].item);
      b++
    );
  },
  clear: function () {
    this._items = {};
    this._order = [];
  },
  sortMethod: function (a) {
    this._order.sort((b, c) => this._items[b].item[a]() < this._items[c].item[a]());
  },
  sortMethodMultiple: function () {
    OrderedContainer.Storage.Instance = this;
    OrderedContainer.Storage.Arguments = arguments;
    this._order.sort(this._compareMethodMultiple);
  },
  _compareMethodMultiple: function (a, b) {
    var c = OrderedContainer.Storage.Instance,
      d = OrderedContainer.Storage.Arguments;
    a = c._items[a].item;
    b = c._items[b].item;
    for (c = d.length - 1; 0 < c; ) {
      var e = d[c],
        f = d[c - 1],
        g = a[e]() * f;
      e = b[e]() * f;
      if (g < e) return 1;
      if (g > e) return -1;
      c -= 2;
    }
    return 0;
  },
  sortMember: function (a) {
    this._order.sort((b, c) => this._items[b].item[a] < this._items[c].item[a]);
  },
  sortMemberMultiple: function () {
    OrderedContainer.Storage.Instance = this;
    OrderedContainer.Storage.Arguments = arguments;
    this._order.sort(this._compareMemberMultiple);
  },
  _compareMemberMultiple: function (a, b) {
    var c = OrderedContainer.Storage.Instance,
      d = OrderedContainer.Storage.Arguments;
    a = c._items[a].item;
    b = c._items[b].item;
    for (c = d.length - 1; 0 < c; ) {
      var e = d[c],
        f = d[c - 1],
        g = a[e] * f;
      e = b[e] * f;
      if (g < e) return 1;
      if (g > e) return -1;
      c -= 2;
    }
    return 0;
  },
};
class Interpreter extends PIXI.utils.EventEmitter {
  constructor(a) {
    super();
    this._target = a || null;
    this._commands = {};
    this._default = null;
    this._validate = function (b) {
      var c = !0;
      if (0 === b.length || 2 > b.length) c = !1;
      0 !== b.indexOf("/") && (c = !1);
      "/" === b.trim() && (c = !1);
      return c;
    };
    this._process = function (b) {
      var c = b.slice(1),
        d = c.indexOf(" "),
        e = null;
      -1 !== d ? ((b = c.substring(0, d)), (e = c.substring(d + 1))) : (b = c);
      (c = this._commands[b])
        ? this._target
          ? c.call(this._target, e)
          : c(e)
        : this.emit(Interpreter.INVALID_COMMAND, { value: b });
    };
    this._dispatchDefault = function (b) {
      if (this._default) {
        var c = this._commands[this._default];
        this._target ? c.call(this._target, b) : c(b);
      }
    };
  }
  parse(a) {
    this._validate(a)
      ? ((a = a.trim()), this._process(a))
      : 0 < a.length && this._dispatchDefault(a);
  }
  addCommand(a, b) {
    this._commands[a] = b;
  }
  removeCommand(a) {
    delete this._commands[a];
    a === this._default && (this._default = null);
  }
  setDefaultCommand(a) {
    this._default = a;
  }
}
Interpreter.INVALID_COMMAND = "invalidCommand";
var stats = {};
class Stats extends PIXI.Sprite {
  constructor() {
    super();
    this.textures = [];
    for (var a = 0; 5 > a; a++) this.textures.push(App.CombinedTextures["ping_" + a]);
    this.anchor.x = this.anchor.y = 0.5;
    this.texture = this.textures[0];
  }
  setPing(a) {
    this.texture =
      this.textures[
        0 <= a && 32 > a
          ? 0
          : 32 <= a && 64 > a
          ? 1
          : 64 <= a && 128 > a
          ? 2
          : 128 <= a && 256 > a
          ? 3
          : 4
      ];
  }
}
window.PointerEvent = null;
let app = new App();
app.load();
var customevent = {};
function CustomEvent(a, b) {
  this.type = a;
  this.data = b || null;
}
var timer = {};
function Timer(a, b) {
  this.callback = a;
  this.delay = b;
  this.expired = !1;
  this.timeoutId = null;
  this.remainingTime = this.initialTime = 0;
}
Timer.prototype.start = function () {
  this.expired = !1;
  this.initialTime = Date.now();
  this.remainingTime = this.delay;
  this.timeoutId = setTimeout(this.onExpire.bind(this), this.delay);
  return this;
};
Timer.prototype.resume = function () {
  this.expired
    ? this.start()
    : ((this.initialTime = Date.now()),
      (this.timeoutId = setTimeout(this.onExpire.bind(this), this.remainingTime)));
};
Timer.prototype.pause = function () {
  this.timeoutId &&
    (clearTimeout(this.timeoutId), (this.remainingTime -= Date.now() - this.initialTime));
};
Timer.prototype.onExpire = function () {
  this.expired = !0;
  this.callback();
};
var uidpool = {};
function UIDpool(a, b) {
  this.taken = 0;
  this.uids = [];
  this.buffered = [[], []];
  this.index = 0;
  for (let c = a - 1; 0 < c; c--) {
    let d = c,
      e = "";
    for (; 0 < d; ) (e = UIDpool.CHARSET[d % 62] + e), (d = Math.floor(d / 62));
    this.uids.push(e);
  }
  0 < a && this.uids.push(UIDpool.CHARSET[0]);
  void 0 !== b &&
    setInterval(() => {
      this.index ^= 1;
      let c = this.buffered[this.index];
      for (let d = 0, e = c.length; d < e; d++) this.uids.push(c[d]);
      this.buffered[this.index] = [];
    }, b);
}
UIDpool.CHARSET = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
UIDpool.prototype.get = function () {
  return this.uids.pop();
};
UIDpool.prototype.dropBuffered = function (a) {
  this.buffered[this.index].push(a);
};
UIDpool.prototype.drop = function (a) {
  this.uids.push(a);
};
